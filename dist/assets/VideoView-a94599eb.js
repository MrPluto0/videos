import{g as Gl,d as Hl,r as Ba,a as Vl,w as Yl,o as zl,c as wr,b as Pr,e as qr,f as vn,h as Ua,u as $l,i as pn,j as Br,F as Ti,k as yi,l as Xl,p as Ql,m as Jl,t as ka,_ as Zl}from"./index-02e188c4.js";function Gs(v,e){return function(){return v.apply(e,arguments)}}const{toString:ql}=Object.prototype,{getPrototypeOf:ha}=Object,ii=(v=>e=>{const t=ql.call(e);return v[t]||(v[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),xr=v=>(v=v.toLowerCase(),e=>ii(e)===v),ai=v=>e=>typeof e===v,{isArray:gn}=Array,Rn=ai("undefined");function eu(v){return v!==null&&!Rn(v)&&v.constructor!==null&&!Rn(v.constructor)&&yr(v.constructor.isBuffer)&&v.constructor.isBuffer(v)}const Hs=xr("ArrayBuffer");function tu(v){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(v):e=v&&v.buffer&&Hs(v.buffer),e}const ru=ai("string"),yr=ai("function"),Vs=ai("number"),si=v=>v!==null&&typeof v=="object",nu=v=>v===!0||v===!1,Yn=v=>{if(ii(v)!=="object")return!1;const e=ha(v);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in v)&&!(Symbol.iterator in v)},iu=xr("Date"),au=xr("File"),su=xr("Blob"),ou=xr("FileList"),lu=v=>si(v)&&yr(v.pipe),uu=v=>{let e;return v&&(typeof FormData=="function"&&v instanceof FormData||yr(v.append)&&((e=ii(v))==="formdata"||e==="object"&&yr(v.toString)&&v.toString()==="[object FormData]"))},fu=xr("URLSearchParams"),cu=v=>v.trim?v.trim():v.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function On(v,e,{allOwnKeys:t=!1}={}){if(v===null||typeof v>"u")return;let n,o;if(typeof v!="object"&&(v=[v]),gn(v))for(n=0,o=v.length;n<o;n++)e.call(null,v[n],n,v);else{const g=t?Object.getOwnPropertyNames(v):Object.keys(v),h=g.length;let i;for(n=0;n<h;n++)i=g[n],e.call(null,v[i],i,v)}}function Ys(v,e){e=e.toLowerCase();const t=Object.keys(v);let n=t.length,o;for(;n-- >0;)if(o=t[n],e===o.toLowerCase())return o;return null}const zs=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),$s=v=>!Rn(v)&&v!==zs;function Zi(){const{caseless:v}=$s(this)&&this||{},e={},t=(n,o)=>{const g=v&&Ys(e,o)||o;Yn(e[g])&&Yn(n)?e[g]=Zi(e[g],n):Yn(n)?e[g]=Zi({},n):gn(n)?e[g]=n.slice():e[g]=n};for(let n=0,o=arguments.length;n<o;n++)arguments[n]&&On(arguments[n],t);return e}const du=(v,e,t,{allOwnKeys:n}={})=>(On(e,(o,g)=>{t&&yr(o)?v[g]=Gs(o,t):v[g]=o},{allOwnKeys:n}),v),hu=v=>(v.charCodeAt(0)===65279&&(v=v.slice(1)),v),gu=(v,e,t,n)=>{v.prototype=Object.create(e.prototype,n),v.prototype.constructor=v,Object.defineProperty(v,"super",{value:e.prototype}),t&&Object.assign(v.prototype,t)},mu=(v,e,t,n)=>{let o,g,h;const i={};if(e=e||{},v==null)return e;do{for(o=Object.getOwnPropertyNames(v),g=o.length;g-- >0;)h=o[g],(!n||n(h,v,e))&&!i[h]&&(e[h]=v[h],i[h]=!0);v=t!==!1&&ha(v)}while(v&&(!t||t(v,e))&&v!==Object.prototype);return e},Eu=(v,e,t)=>{v=String(v),(t===void 0||t>v.length)&&(t=v.length),t-=e.length;const n=v.indexOf(e,t);return n!==-1&&n===t},_u=v=>{if(!v)return null;if(gn(v))return v;let e=v.length;if(!Vs(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=v[e];return t},vu=(v=>e=>v&&e instanceof v)(typeof Uint8Array<"u"&&ha(Uint8Array)),pu=(v,e)=>{const n=(v&&v[Symbol.iterator]).call(v);let o;for(;(o=n.next())&&!o.done;){const g=o.value;e.call(v,g[0],g[1])}},Tu=(v,e)=>{let t;const n=[];for(;(t=v.exec(e))!==null;)n.push(t);return n},yu=xr("HTMLFormElement"),Au=v=>v.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,o){return n.toUpperCase()+o}),Ka=(({hasOwnProperty:v})=>(e,t)=>v.call(e,t))(Object.prototype),Su=xr("RegExp"),Xs=(v,e)=>{const t=Object.getOwnPropertyDescriptors(v),n={};On(t,(o,g)=>{e(o,g,v)!==!1&&(n[g]=o)}),Object.defineProperties(v,n)},Ru=v=>{Xs(v,(e,t)=>{if(yr(v)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=v[t];if(yr(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Du=(v,e)=>{const t={},n=o=>{o.forEach(g=>{t[g]=!0})};return gn(v)?n(v):n(String(v).split(e)),t},Iu=()=>{},Cu=(v,e)=>(v=+v,Number.isFinite(v)?v:e),Ai="abcdefghijklmnopqrstuvwxyz",ja="0123456789",Qs={DIGIT:ja,ALPHA:Ai,ALPHA_DIGIT:Ai+Ai.toUpperCase()+ja},Pu=(v=16,e=Qs.ALPHA_DIGIT)=>{let t="";const{length:n}=e;for(;v--;)t+=e[Math.random()*n|0];return t};function Mu(v){return!!(v&&yr(v.append)&&v[Symbol.toStringTag]==="FormData"&&v[Symbol.iterator])}const Ou=v=>{const e=new Array(10),t=(n,o)=>{if(si(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[o]=n;const g=gn(n)?[]:{};return On(n,(h,i)=>{const r=t(h,o+1);!Rn(r)&&(g[i]=r)}),e[o]=void 0,g}}return n};return t(v,0)},Lu=xr("AsyncFunction"),bu=v=>v&&(si(v)||yr(v))&&yr(v.then)&&yr(v.catch),ut={isArray:gn,isArrayBuffer:Hs,isBuffer:eu,isFormData:uu,isArrayBufferView:tu,isString:ru,isNumber:Vs,isBoolean:nu,isObject:si,isPlainObject:Yn,isUndefined:Rn,isDate:iu,isFile:au,isBlob:su,isRegExp:Su,isFunction:yr,isStream:lu,isURLSearchParams:fu,isTypedArray:vu,isFileList:ou,forEach:On,merge:Zi,extend:du,trim:cu,stripBOM:hu,inherits:gu,toFlatObject:mu,kindOf:ii,kindOfTest:xr,endsWith:Eu,toArray:_u,forEachEntry:pu,matchAll:Tu,isHTMLForm:yu,hasOwnProperty:Ka,hasOwnProp:Ka,reduceDescriptors:Xs,freezeMethods:Ru,toObjectSet:Du,toCamelCase:Au,noop:Iu,toFiniteNumber:Cu,findKey:Ys,global:zs,isContextDefined:$s,ALPHABET:Qs,generateString:Pu,isSpecCompliantForm:Mu,toJSONObject:Ou,isAsyncFn:Lu,isThenable:bu};function zt(v,e,t,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=v,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),o&&(this.response=o)}ut.inherits(zt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ut.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Js=zt.prototype,Zs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(v=>{Zs[v]={value:v}});Object.defineProperties(zt,Zs);Object.defineProperty(Js,"isAxiosError",{value:!0});zt.from=(v,e,t,n,o,g)=>{const h=Object.create(Js);return ut.toFlatObject(v,h,function(r){return r!==Error.prototype},i=>i!=="isAxiosError"),zt.call(h,v.message,e,t,n,o),h.cause=v,h.name=v.name,g&&Object.assign(h,g),h};const xu=null;function qi(v){return ut.isPlainObject(v)||ut.isArray(v)}function qs(v){return ut.endsWith(v,"[]")?v.slice(0,-2):v}function Wa(v,e,t){return v?v.concat(e).map(function(o,g){return o=qs(o),!t&&g?"["+o+"]":o}).join(t?".":""):e}function Nu(v){return ut.isArray(v)&&!v.some(qi)}const Fu=ut.toFlatObject(ut,{},null,function(e){return/^is[A-Z]/.test(e)});function oi(v,e,t){if(!ut.isObject(v))throw new TypeError("target must be an object");e=e||new FormData,t=ut.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(c,y){return!ut.isUndefined(y[c])});const n=t.metaTokens,o=t.visitor||l,g=t.dots,h=t.indexes,r=(t.Blob||typeof Blob<"u"&&Blob)&&ut.isSpecCompliantForm(e);if(!ut.isFunction(o))throw new TypeError("visitor must be a function");function u(E){if(E===null)return"";if(ut.isDate(E))return E.toISOString();if(!r&&ut.isBlob(E))throw new zt("Blob is not supported. Use a Buffer instead.");return ut.isArrayBuffer(E)||ut.isTypedArray(E)?r&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function l(E,c,y){let O=E;if(E&&!y&&typeof E=="object"){if(ut.endsWith(c,"{}"))c=n?c:c.slice(0,-2),E=JSON.stringify(E);else if(ut.isArray(E)&&Nu(E)||(ut.isFileList(E)||ut.endsWith(c,"[]"))&&(O=ut.toArray(E)))return c=qs(c),O.forEach(function(b,L){!(ut.isUndefined(b)||b===null)&&e.append(h===!0?Wa([c],L,g):h===null?c:c+"[]",u(b))}),!1}return qi(E)?!0:(e.append(Wa(y,c,g),u(E)),!1)}const f=[],d=Object.assign(Fu,{defaultVisitor:l,convertValue:u,isVisitable:qi});function _(E,c){if(!ut.isUndefined(E)){if(f.indexOf(E)!==-1)throw Error("Circular reference detected in "+c.join("."));f.push(E),ut.forEach(E,function(O,P){(!(ut.isUndefined(O)||O===null)&&o.call(e,O,ut.isString(P)?P.trim():P,c,d))===!0&&_(O,c?c.concat(P):[P])}),f.pop()}}if(!ut.isObject(v))throw new TypeError("data must be an object");return _(v),e}function Ga(v){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(v).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function ga(v,e){this._pairs=[],v&&oi(v,this,e)}const eo=ga.prototype;eo.append=function(e,t){this._pairs.push([e,t])};eo.toString=function(e){const t=e?function(n){return e.call(this,n,Ga)}:Ga;return this._pairs.map(function(o){return t(o[0])+"="+t(o[1])},"").join("&")};function wu(v){return encodeURIComponent(v).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function to(v,e,t){if(!e)return v;const n=t&&t.encode||wu,o=t&&t.serialize;let g;if(o?g=o(e,t):g=ut.isURLSearchParams(e)?e.toString():new ga(e,t).toString(n),g){const h=v.indexOf("#");h!==-1&&(v=v.slice(0,h)),v+=(v.indexOf("?")===-1?"?":"&")+g}return v}class Bu{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ut.forEach(this.handlers,function(n){n!==null&&e(n)})}}const Ha=Bu,ro={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Uu=typeof URLSearchParams<"u"?URLSearchParams:ga,ku=typeof FormData<"u"?FormData:null,Ku=typeof Blob<"u"?Blob:null,ju=(()=>{let v;return typeof navigator<"u"&&((v=navigator.product)==="ReactNative"||v==="NativeScript"||v==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),Wu=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Lr={isBrowser:!0,classes:{URLSearchParams:Uu,FormData:ku,Blob:Ku},isStandardBrowserEnv:ju,isStandardBrowserWebWorkerEnv:Wu,protocols:["http","https","file","blob","url","data"]};function Gu(v,e){return oi(v,new Lr.classes.URLSearchParams,Object.assign({visitor:function(t,n,o,g){return Lr.isNode&&ut.isBuffer(t)?(this.append(n,t.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},e))}function Hu(v){return ut.matchAll(/\w+|\[(\w*)]/g,v).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Vu(v){const e={},t=Object.keys(v);let n;const o=t.length;let g;for(n=0;n<o;n++)g=t[n],e[g]=v[g];return e}function no(v){function e(t,n,o,g){let h=t[g++];const i=Number.isFinite(+h),r=g>=t.length;return h=!h&&ut.isArray(o)?o.length:h,r?(ut.hasOwnProp(o,h)?o[h]=[o[h],n]:o[h]=n,!i):((!o[h]||!ut.isObject(o[h]))&&(o[h]=[]),e(t,n,o[h],g)&&ut.isArray(o[h])&&(o[h]=Vu(o[h])),!i)}if(ut.isFormData(v)&&ut.isFunction(v.entries)){const t={};return ut.forEachEntry(v,(n,o)=>{e(Hu(n),o,t,0)}),t}return null}const Yu={"Content-Type":void 0};function zu(v,e,t){if(ut.isString(v))try{return(e||JSON.parse)(v),ut.trim(v)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(v)}const li={transitional:ro,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",o=n.indexOf("application/json")>-1,g=ut.isObject(e);if(g&&ut.isHTMLForm(e)&&(e=new FormData(e)),ut.isFormData(e))return o&&o?JSON.stringify(no(e)):e;if(ut.isArrayBuffer(e)||ut.isBuffer(e)||ut.isStream(e)||ut.isFile(e)||ut.isBlob(e))return e;if(ut.isArrayBufferView(e))return e.buffer;if(ut.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(g){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Gu(e,this.formSerializer).toString();if((i=ut.isFileList(e))||n.indexOf("multipart/form-data")>-1){const r=this.env&&this.env.FormData;return oi(i?{"files[]":e}:e,r&&new r,this.formSerializer)}}return g||o?(t.setContentType("application/json",!1),zu(e)):e}],transformResponse:[function(e){const t=this.transitional||li.transitional,n=t&&t.forcedJSONParsing,o=this.responseType==="json";if(e&&ut.isString(e)&&(n&&!this.responseType||o)){const h=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(i){if(h)throw i.name==="SyntaxError"?zt.from(i,zt.ERR_BAD_RESPONSE,this,null,this.response):i}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Lr.classes.FormData,Blob:Lr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ut.forEach(["delete","get","head"],function(e){li.headers[e]={}});ut.forEach(["post","put","patch"],function(e){li.headers[e]=ut.merge(Yu)});const ma=li,$u=ut.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Xu=v=>{const e={};let t,n,o;return v&&v.split(`
`).forEach(function(h){o=h.indexOf(":"),t=h.substring(0,o).trim().toLowerCase(),n=h.substring(o+1).trim(),!(!t||e[t]&&$u[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},Va=Symbol("internals");function Tn(v){return v&&String(v).trim().toLowerCase()}function zn(v){return v===!1||v==null?v:ut.isArray(v)?v.map(zn):String(v)}function Qu(v){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(v);)e[n[1]]=n[2];return e}const Ju=v=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(v.trim());function Si(v,e,t,n,o){if(ut.isFunction(n))return n.call(this,e,t);if(o&&(e=t),!!ut.isString(e)){if(ut.isString(n))return e.indexOf(n)!==-1;if(ut.isRegExp(n))return n.test(e)}}function Zu(v){return v.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function qu(v,e){const t=ut.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(v,n+t,{value:function(o,g,h){return this[n].call(this,e,o,g,h)},configurable:!0})})}class ui{constructor(e){e&&this.set(e)}set(e,t,n){const o=this;function g(i,r,u){const l=Tn(r);if(!l)throw new Error("header name must be a non-empty string");const f=ut.findKey(o,l);(!f||o[f]===void 0||u===!0||u===void 0&&o[f]!==!1)&&(o[f||r]=zn(i))}const h=(i,r)=>ut.forEach(i,(u,l)=>g(u,l,r));return ut.isPlainObject(e)||e instanceof this.constructor?h(e,t):ut.isString(e)&&(e=e.trim())&&!Ju(e)?h(Xu(e),t):e!=null&&g(t,e,n),this}get(e,t){if(e=Tn(e),e){const n=ut.findKey(this,e);if(n){const o=this[n];if(!t)return o;if(t===!0)return Qu(o);if(ut.isFunction(t))return t.call(this,o,n);if(ut.isRegExp(t))return t.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Tn(e),e){const n=ut.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||Si(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let o=!1;function g(h){if(h=Tn(h),h){const i=ut.findKey(n,h);i&&(!t||Si(n,n[i],i,t))&&(delete n[i],o=!0)}}return ut.isArray(e)?e.forEach(g):g(e),o}clear(e){const t=Object.keys(this);let n=t.length,o=!1;for(;n--;){const g=t[n];(!e||Si(this,this[g],g,e,!0))&&(delete this[g],o=!0)}return o}normalize(e){const t=this,n={};return ut.forEach(this,(o,g)=>{const h=ut.findKey(n,g);if(h){t[h]=zn(o),delete t[g];return}const i=e?Zu(g):String(g).trim();i!==g&&delete t[g],t[i]=zn(o),n[i]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return ut.forEach(this,(n,o)=>{n!=null&&n!==!1&&(t[o]=e&&ut.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(o=>n.set(o)),n}static accessor(e){const n=(this[Va]=this[Va]={accessors:{}}).accessors,o=this.prototype;function g(h){const i=Tn(h);n[i]||(qu(o,h),n[i]=!0)}return ut.isArray(e)?e.forEach(g):g(e),this}}ui.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ut.freezeMethods(ui.prototype);ut.freezeMethods(ui);const Wr=ui;function Ri(v,e){const t=this||ma,n=e||t,o=Wr.from(n.headers);let g=n.data;return ut.forEach(v,function(i){g=i.call(t,g,o.normalize(),e?e.status:void 0)}),o.normalize(),g}function io(v){return!!(v&&v.__CANCEL__)}function Ln(v,e,t){zt.call(this,v??"canceled",zt.ERR_CANCELED,e,t),this.name="CanceledError"}ut.inherits(Ln,zt,{__CANCEL__:!0});function ef(v,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?v(t):e(new zt("Request failed with status code "+t.status,[zt.ERR_BAD_REQUEST,zt.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const tf=Lr.isStandardBrowserEnv?function(){return{write:function(t,n,o,g,h,i){const r=[];r.push(t+"="+encodeURIComponent(n)),ut.isNumber(o)&&r.push("expires="+new Date(o).toGMTString()),ut.isString(g)&&r.push("path="+g),ut.isString(h)&&r.push("domain="+h),i===!0&&r.push("secure"),document.cookie=r.join("; ")},read:function(t){const n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function rf(v){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(v)}function nf(v,e){return e?v.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):v}function ao(v,e){return v&&!rf(e)?nf(v,e):e}const af=Lr.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function o(g){let h=g;return e&&(t.setAttribute("href",h),h=t.href),t.setAttribute("href",h),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=o(window.location.href),function(h){const i=ut.isString(h)?o(h):h;return i.protocol===n.protocol&&i.host===n.host}}():function(){return function(){return!0}}();function sf(v){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(v);return e&&e[1]||""}function of(v,e){v=v||10;const t=new Array(v),n=new Array(v);let o=0,g=0,h;return e=e!==void 0?e:1e3,function(r){const u=Date.now(),l=n[g];h||(h=u),t[o]=r,n[o]=u;let f=g,d=0;for(;f!==o;)d+=t[f++],f=f%v;if(o=(o+1)%v,o===g&&(g=(g+1)%v),u-h<e)return;const _=l&&u-l;return _?Math.round(d*1e3/_):void 0}}function Ya(v,e){let t=0;const n=of(50,250);return o=>{const g=o.loaded,h=o.lengthComputable?o.total:void 0,i=g-t,r=n(i),u=g<=h;t=g;const l={loaded:g,total:h,progress:h?g/h:void 0,bytes:i,rate:r||void 0,estimated:r&&h&&u?(h-g)/r:void 0,event:o};l[e?"download":"upload"]=!0,v(l)}}const lf=typeof XMLHttpRequest<"u",uf=lf&&function(v){return new Promise(function(t,n){let o=v.data;const g=Wr.from(v.headers).normalize(),h=v.responseType;let i;function r(){v.cancelToken&&v.cancelToken.unsubscribe(i),v.signal&&v.signal.removeEventListener("abort",i)}ut.isFormData(o)&&(Lr.isStandardBrowserEnv||Lr.isStandardBrowserWebWorkerEnv?g.setContentType(!1):g.setContentType("multipart/form-data;",!1));let u=new XMLHttpRequest;if(v.auth){const _=v.auth.username||"",E=v.auth.password?unescape(encodeURIComponent(v.auth.password)):"";g.set("Authorization","Basic "+btoa(_+":"+E))}const l=ao(v.baseURL,v.url);u.open(v.method.toUpperCase(),to(l,v.params,v.paramsSerializer),!0),u.timeout=v.timeout;function f(){if(!u)return;const _=Wr.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),c={data:!h||h==="text"||h==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:_,config:v,request:u};ef(function(O){t(O),r()},function(O){n(O),r()},c),u=null}if("onloadend"in u?u.onloadend=f:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(f)},u.onabort=function(){u&&(n(new zt("Request aborted",zt.ECONNABORTED,v,u)),u=null)},u.onerror=function(){n(new zt("Network Error",zt.ERR_NETWORK,v,u)),u=null},u.ontimeout=function(){let E=v.timeout?"timeout of "+v.timeout+"ms exceeded":"timeout exceeded";const c=v.transitional||ro;v.timeoutErrorMessage&&(E=v.timeoutErrorMessage),n(new zt(E,c.clarifyTimeoutError?zt.ETIMEDOUT:zt.ECONNABORTED,v,u)),u=null},Lr.isStandardBrowserEnv){const _=(v.withCredentials||af(l))&&v.xsrfCookieName&&tf.read(v.xsrfCookieName);_&&g.set(v.xsrfHeaderName,_)}o===void 0&&g.setContentType(null),"setRequestHeader"in u&&ut.forEach(g.toJSON(),function(E,c){u.setRequestHeader(c,E)}),ut.isUndefined(v.withCredentials)||(u.withCredentials=!!v.withCredentials),h&&h!=="json"&&(u.responseType=v.responseType),typeof v.onDownloadProgress=="function"&&u.addEventListener("progress",Ya(v.onDownloadProgress,!0)),typeof v.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",Ya(v.onUploadProgress)),(v.cancelToken||v.signal)&&(i=_=>{u&&(n(!_||_.type?new Ln(null,v,u):_),u.abort(),u=null)},v.cancelToken&&v.cancelToken.subscribe(i),v.signal&&(v.signal.aborted?i():v.signal.addEventListener("abort",i)));const d=sf(l);if(d&&Lr.protocols.indexOf(d)===-1){n(new zt("Unsupported protocol "+d+":",zt.ERR_BAD_REQUEST,v));return}u.send(o||null)})},$n={http:xu,xhr:uf};ut.forEach($n,(v,e)=>{if(v){try{Object.defineProperty(v,"name",{value:e})}catch{}Object.defineProperty(v,"adapterName",{value:e})}});const ff={getAdapter:v=>{v=ut.isArray(v)?v:[v];const{length:e}=v;let t,n;for(let o=0;o<e&&(t=v[o],!(n=ut.isString(t)?$n[t.toLowerCase()]:t));o++);if(!n)throw n===!1?new zt(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(ut.hasOwnProp($n,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!ut.isFunction(n))throw new TypeError("adapter is not a function");return n},adapters:$n};function Di(v){if(v.cancelToken&&v.cancelToken.throwIfRequested(),v.signal&&v.signal.aborted)throw new Ln(null,v)}function za(v){return Di(v),v.headers=Wr.from(v.headers),v.data=Ri.call(v,v.transformRequest),["post","put","patch"].indexOf(v.method)!==-1&&v.headers.setContentType("application/x-www-form-urlencoded",!1),ff.getAdapter(v.adapter||ma.adapter)(v).then(function(n){return Di(v),n.data=Ri.call(v,v.transformResponse,n),n.headers=Wr.from(n.headers),n},function(n){return io(n)||(Di(v),n&&n.response&&(n.response.data=Ri.call(v,v.transformResponse,n.response),n.response.headers=Wr.from(n.response.headers))),Promise.reject(n)})}const $a=v=>v instanceof Wr?v.toJSON():v;function hn(v,e){e=e||{};const t={};function n(u,l,f){return ut.isPlainObject(u)&&ut.isPlainObject(l)?ut.merge.call({caseless:f},u,l):ut.isPlainObject(l)?ut.merge({},l):ut.isArray(l)?l.slice():l}function o(u,l,f){if(ut.isUndefined(l)){if(!ut.isUndefined(u))return n(void 0,u,f)}else return n(u,l,f)}function g(u,l){if(!ut.isUndefined(l))return n(void 0,l)}function h(u,l){if(ut.isUndefined(l)){if(!ut.isUndefined(u))return n(void 0,u)}else return n(void 0,l)}function i(u,l,f){if(f in e)return n(u,l);if(f in v)return n(void 0,u)}const r={url:g,method:g,data:g,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:i,headers:(u,l)=>o($a(u),$a(l),!0)};return ut.forEach(Object.keys(Object.assign({},v,e)),function(l){const f=r[l]||o,d=f(v[l],e[l],l);ut.isUndefined(d)&&f!==i||(t[l]=d)}),t}const so="1.4.0",Ea={};["object","boolean","number","function","string","symbol"].forEach((v,e)=>{Ea[v]=function(n){return typeof n===v||"a"+(e<1?"n ":" ")+v}});const Xa={};Ea.transitional=function(e,t,n){function o(g,h){return"[Axios v"+so+"] Transitional option '"+g+"'"+h+(n?". "+n:"")}return(g,h,i)=>{if(e===!1)throw new zt(o(h," has been removed"+(t?" in "+t:"")),zt.ERR_DEPRECATED);return t&&!Xa[h]&&(Xa[h]=!0,console.warn(o(h," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(g,h,i):!0}};function cf(v,e,t){if(typeof v!="object")throw new zt("options must be an object",zt.ERR_BAD_OPTION_VALUE);const n=Object.keys(v);let o=n.length;for(;o-- >0;){const g=n[o],h=e[g];if(h){const i=v[g],r=i===void 0||h(i,g,v);if(r!==!0)throw new zt("option "+g+" must be "+r,zt.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new zt("Unknown option "+g,zt.ERR_BAD_OPTION)}}const ea={assertOptions:cf,validators:Ea},Gr=ea.validators;class Jn{constructor(e){this.defaults=e,this.interceptors={request:new Ha,response:new Ha}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=hn(this.defaults,t);const{transitional:n,paramsSerializer:o,headers:g}=t;n!==void 0&&ea.assertOptions(n,{silentJSONParsing:Gr.transitional(Gr.boolean),forcedJSONParsing:Gr.transitional(Gr.boolean),clarifyTimeoutError:Gr.transitional(Gr.boolean)},!1),o!=null&&(ut.isFunction(o)?t.paramsSerializer={serialize:o}:ea.assertOptions(o,{encode:Gr.function,serialize:Gr.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let h;h=g&&ut.merge(g.common,g[t.method]),h&&ut.forEach(["delete","get","head","post","put","patch","common"],E=>{delete g[E]}),t.headers=Wr.concat(h,g);const i=[];let r=!0;this.interceptors.request.forEach(function(c){typeof c.runWhen=="function"&&c.runWhen(t)===!1||(r=r&&c.synchronous,i.unshift(c.fulfilled,c.rejected))});const u=[];this.interceptors.response.forEach(function(c){u.push(c.fulfilled,c.rejected)});let l,f=0,d;if(!r){const E=[za.bind(this),void 0];for(E.unshift.apply(E,i),E.push.apply(E,u),d=E.length,l=Promise.resolve(t);f<d;)l=l.then(E[f++],E[f++]);return l}d=i.length;let _=t;for(f=0;f<d;){const E=i[f++],c=i[f++];try{_=E(_)}catch(y){c.call(this,y);break}}try{l=za.call(this,_)}catch(E){return Promise.reject(E)}for(f=0,d=u.length;f<d;)l=l.then(u[f++],u[f++]);return l}getUri(e){e=hn(this.defaults,e);const t=ao(e.baseURL,e.url);return to(t,e.params,e.paramsSerializer)}}ut.forEach(["delete","get","head","options"],function(e){Jn.prototype[e]=function(t,n){return this.request(hn(n||{},{method:e,url:t,data:(n||{}).data}))}});ut.forEach(["post","put","patch"],function(e){function t(n){return function(g,h,i){return this.request(hn(i||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:g,data:h}))}}Jn.prototype[e]=t(),Jn.prototype[e+"Form"]=t(!0)});const Xn=Jn;class _a{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(g){t=g});const n=this;this.promise.then(o=>{if(!n._listeners)return;let g=n._listeners.length;for(;g-- >0;)n._listeners[g](o);n._listeners=null}),this.promise.then=o=>{let g;const h=new Promise(i=>{n.subscribe(i),g=i}).then(o);return h.cancel=function(){n.unsubscribe(g)},h},e(function(g,h,i){n.reason||(n.reason=new Ln(g,h,i),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new _a(function(o){e=o}),cancel:e}}}const df=_a;function hf(v){return function(t){return v.apply(null,t)}}function gf(v){return ut.isObject(v)&&v.isAxiosError===!0}const ta={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ta).forEach(([v,e])=>{ta[e]=v});const mf=ta;function oo(v){const e=new Xn(v),t=Gs(Xn.prototype.request,e);return ut.extend(t,Xn.prototype,e,{allOwnKeys:!0}),ut.extend(t,e,null,{allOwnKeys:!0}),t.create=function(o){return oo(hn(v,o))},t}const ir=oo(ma);ir.Axios=Xn;ir.CanceledError=Ln;ir.CancelToken=df;ir.isCancel=io;ir.VERSION=so;ir.toFormData=oi;ir.AxiosError=zt;ir.Cancel=ir.CanceledError;ir.all=function(e){return Promise.all(e)};ir.spread=hf;ir.isAxiosError=gf;ir.mergeConfig=hn;ir.AxiosHeaders=Wr;ir.formToJSON=v=>no(ut.isHTMLForm(v)?new FormData(v):v);ir.HttpStatusCode=mf;ir.default=ir;const Ii=ir;var Dn={},Ef={get exports(){return Dn},set exports(v){Dn=v}};(function(v,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,o=/^(?=([^\/?#]*))\1([^]*)$/,g=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,i={buildAbsoluteURL:function(r,u,l){if(l=l||{},r=r.trim(),u=u.trim(),!u){if(!l.alwaysNormalize)return r;var f=i.parseURL(r);if(!f)throw new Error("Error trying to parse base URL.");return f.path=i.normalizePath(f.path),i.buildURLFromParts(f)}var d=i.parseURL(u);if(!d)throw new Error("Error trying to parse relative URL.");if(d.scheme)return l.alwaysNormalize?(d.path=i.normalizePath(d.path),i.buildURLFromParts(d)):u;var _=i.parseURL(r);if(!_)throw new Error("Error trying to parse base URL.");if(!_.netLoc&&_.path&&_.path[0]!=="/"){var E=o.exec(_.path);_.netLoc=E[1],_.path=E[2]}_.netLoc&&!_.path&&(_.path="/");var c={scheme:_.scheme,netLoc:d.netLoc,path:null,params:d.params,query:d.query,fragment:d.fragment};if(!d.netLoc&&(c.netLoc=_.netLoc,d.path[0]!=="/"))if(!d.path)c.path=_.path,d.params||(c.params=_.params,d.query||(c.query=_.query));else{var y=_.path,O=y.substring(0,y.lastIndexOf("/")+1)+d.path;c.path=i.normalizePath(O)}return c.path===null&&(c.path=l.alwaysNormalize?i.normalizePath(d.path):d.path),i.buildURLFromParts(c)},parseURL:function(r){var u=n.exec(r);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(r){for(r=r.split("").reverse().join("").replace(g,"");r.length!==(r=r.replace(h,"")).length;);return r.split("").reverse().join("")},buildURLFromParts:function(r){return r.scheme+r.netLoc+r.path+r.params+r.query+r.fragment}};v.exports=i})()})(Ef);function Qa(v,e){var t=Object.keys(v);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(v);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(v,o).enumerable})),t.push.apply(t,n)}return t}function mr(v){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Qa(Object(t),!0).forEach(function(n){_f(v,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(t)):Qa(Object(t)).forEach(function(n){Object.defineProperty(v,n,Object.getOwnPropertyDescriptor(t,n))})}return v}function _f(v,e,t){return e=pf(e),e in v?Object.defineProperty(v,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):v[e]=t,v}function ar(){return ar=Object.assign?Object.assign.bind():function(v){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(v[n]=t[n])}return v},ar.apply(this,arguments)}function vf(v,e){if(typeof v!="object"||v===null)return v;var t=v[Symbol.toPrimitive];if(t!==void 0){var n=t.call(v,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(v)}function pf(v){var e=vf(v,"string");return typeof e=="symbol"?e:String(e)}const xt=Number.isFinite||function(v){return typeof v=="number"&&isFinite(v)};let Ee=function(v){return v.MEDIA_ATTACHING="hlsMediaAttaching",v.MEDIA_ATTACHED="hlsMediaAttached",v.MEDIA_DETACHING="hlsMediaDetaching",v.MEDIA_DETACHED="hlsMediaDetached",v.BUFFER_RESET="hlsBufferReset",v.BUFFER_CODECS="hlsBufferCodecs",v.BUFFER_CREATED="hlsBufferCreated",v.BUFFER_APPENDING="hlsBufferAppending",v.BUFFER_APPENDED="hlsBufferAppended",v.BUFFER_EOS="hlsBufferEos",v.BUFFER_FLUSHING="hlsBufferFlushing",v.BUFFER_FLUSHED="hlsBufferFlushed",v.MANIFEST_LOADING="hlsManifestLoading",v.MANIFEST_LOADED="hlsManifestLoaded",v.MANIFEST_PARSED="hlsManifestParsed",v.LEVEL_SWITCHING="hlsLevelSwitching",v.LEVEL_SWITCHED="hlsLevelSwitched",v.LEVEL_LOADING="hlsLevelLoading",v.LEVEL_LOADED="hlsLevelLoaded",v.LEVEL_UPDATED="hlsLevelUpdated",v.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",v.LEVELS_UPDATED="hlsLevelsUpdated",v.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",v.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",v.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",v.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",v.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",v.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",v.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",v.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",v.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",v.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",v.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",v.CUES_PARSED="hlsCuesParsed",v.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",v.INIT_PTS_FOUND="hlsInitPtsFound",v.FRAG_LOADING="hlsFragLoading",v.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",v.FRAG_LOADED="hlsFragLoaded",v.FRAG_DECRYPTED="hlsFragDecrypted",v.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",v.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",v.FRAG_PARSING_METADATA="hlsFragParsingMetadata",v.FRAG_PARSED="hlsFragParsed",v.FRAG_BUFFERED="hlsFragBuffered",v.FRAG_CHANGED="hlsFragChanged",v.FPS_DROP="hlsFpsDrop",v.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",v.ERROR="hlsError",v.DESTROYING="hlsDestroying",v.KEY_LOADING="hlsKeyLoading",v.KEY_LOADED="hlsKeyLoaded",v.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",v.BACK_BUFFER_REACHED="hlsBackBufferReached",v}({}),Ft=function(v){return v.NETWORK_ERROR="networkError",v.MEDIA_ERROR="mediaError",v.KEY_SYSTEM_ERROR="keySystemError",v.MUX_ERROR="muxError",v.OTHER_ERROR="otherError",v}({}),st=function(v){return v.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",v.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",v.KEY_SYSTEM_NO_SESSION="keySystemNoSession",v.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",v.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",v.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",v.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",v.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",v.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",v.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",v.MANIFEST_LOAD_ERROR="manifestLoadError",v.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",v.MANIFEST_PARSING_ERROR="manifestParsingError",v.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",v.LEVEL_EMPTY_ERROR="levelEmptyError",v.LEVEL_LOAD_ERROR="levelLoadError",v.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",v.LEVEL_PARSING_ERROR="levelParsingError",v.LEVEL_SWITCH_ERROR="levelSwitchError",v.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",v.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",v.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",v.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",v.FRAG_LOAD_ERROR="fragLoadError",v.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",v.FRAG_DECRYPT_ERROR="fragDecryptError",v.FRAG_PARSING_ERROR="fragParsingError",v.FRAG_GAP="fragGap",v.REMUX_ALLOC_ERROR="remuxAllocError",v.KEY_LOAD_ERROR="keyLoadError",v.KEY_LOAD_TIMEOUT="keyLoadTimeOut",v.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",v.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",v.BUFFER_APPEND_ERROR="bufferAppendError",v.BUFFER_APPENDING_ERROR="bufferAppendingError",v.BUFFER_STALLED_ERROR="bufferStalledError",v.BUFFER_FULL_ERROR="bufferFullError",v.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",v.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",v.INTERNAL_EXCEPTION="internalException",v.INTERNAL_ABORTED="aborted",v.UNKNOWN="unknown",v}({});const tn=function(){},ra={trace:tn,debug:tn,log:tn,warn:tn,info:tn,error:tn};let An=ra;function Tf(v){const e=self.console[v];return e?e.bind(self.console,`[${v}] >`):tn}function yf(v,...e){e.forEach(function(t){An[t]=v[t]?v[t].bind(v):Tf(t)})}function Af(v,e){if(self.console&&v===!0||typeof v=="object"){yf(v,"debug","log","info","warn","error");try{An.log(`Debug logs enabled for "${e}" in hls.js version 1.4.0`)}catch{An=ra}}else An=ra}const We=An,Sf=/^(\d+)x(\d+)$/,Ja=/(.+?)=(".*?"|.*?)(?:,|$)/g;class er{constructor(e){typeof e=="string"&&(e=er.parseAttrList(e));for(const t in e)e.hasOwnProperty(t)&&(t.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let o=0;o<t.length/2;o++)n[o]=parseInt(t.slice(o*2,o*2+2),16);return n}else return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Sf.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const n={},o='"';for(Ja.lastIndex=0;(t=Ja.exec(e))!==null;){let g=t[2];g.indexOf(o)===0&&g.lastIndexOf(o)===g.length-1&&(g=g.slice(1,-1));const h=t[1].trim();n[h]=g}return n}}function Rf(v){return v!=="ID"&&v!=="CLASS"&&v!=="START-DATE"&&v!=="DURATION"&&v!=="END-DATE"&&v!=="END-ON-NEXT"}function Df(v){return v==="SCTE35-OUT"||v==="SCTE35-IN"}class lo{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const n=t.attr;for(const o in n)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==n[o]){We.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=ar(new er({}),n,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const n=new Date(this.attr["END-DATE"]);xt(n.getTime())&&(this._endDate=n)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(xt(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&xt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class fi{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Jt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class uo{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[Jt.AUDIO]:null,[Jt.VIDEO]:null,[Jt.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const n=e.split("@",2),o=[];n.length===1?o[0]=t?t.byteRangeEndOffset:0:o[0]=parseInt(n[1]),o[1]=parseInt(n[0])+o[0],this._byteRange=o}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Dn.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Ci extends uo{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new fi,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const n=Object.keys(this.levelkeys);if(n.length===1)return this._decryptdata=this.levelkeys[n[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!xt(this.programDateTime))return null;const e=xt(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),n=t.length;if(n>1||n===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,o,g,h=!1){const{elementaryStreams:i}=this,r=i[e];if(!r){i[e]={startPTS:t,endPTS:n,startDTS:o,endDTS:g,partial:h};return}r.startPTS=Math.min(r.startPTS,t),r.endPTS=Math.max(r.endPTS,n),r.startDTS=Math.min(r.startDTS,o),r.endDTS=Math.max(r.endDTS,g)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Jt.AUDIO]=null,e[Jt.VIDEO]=null,e[Jt.AUDIOVIDEO]=null}}class If extends uo{constructor(e,t,n,o,g){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new fi,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=o;const h=e.enumeratedString("BYTERANGE");h&&this.setByteRange(h,g),g&&(this.fragOffset=g.fragOffset+g.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const Cf=10;class Pf{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?xt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Cf}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function va(v){return Uint8Array.from(atob(v),e=>e.charCodeAt(0))}function Mf(v){const e=fo(v).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Of(v){const e=function(n,o,g){const h=n[o];n[o]=n[g],n[g]=h};e(v,0,3),e(v,1,2),e(v,4,5),e(v,6,7)}function Lf(v){const e=v.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),o=n[n.length-1].split(",");if(o.length===2){const g=o[0]==="base64",h=o[1];g?(n.splice(-1,1),t=va(h)):t=Mf(h)}}return t}function fo(v){return Uint8Array.from(unescape(encodeURIComponent(v)),e=>e.charCodeAt(0))}var tr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},gr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Za(v){switch(v){case gr.FAIRPLAY:return tr.FAIRPLAY;case gr.PLAYREADY:return tr.PLAYREADY;case gr.WIDEVINE:return tr.WIDEVINE;case gr.CLEARKEY:return tr.CLEARKEY}}var co={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function bf(v){if(v===co.WIDEVINE)return tr.WIDEVINE}function qa(v){switch(v){case tr.FAIRPLAY:return gr.FAIRPLAY;case tr.PLAYREADY:return gr.PLAYREADY;case tr.WIDEVINE:return gr.WIDEVINE;case tr.CLEARKEY:return gr.CLEARKEY}}function Pi(v){const{drmSystems:e,widevineLicenseUrl:t}=v,n=e?[tr.FAIRPLAY,tr.WIDEVINE,tr.PLAYREADY,tr.CLEARKEY].filter(o=>!!e[o]):[];return!n[tr.WIDEVINE]&&t&&n.push(tr.WIDEVINE),n}const ho=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function xf(v,e,t,n){let o;switch(v){case tr.FAIRPLAY:o=["cenc","sinf"];break;case tr.WIDEVINE:case tr.PLAYREADY:o=["cenc"];break;case tr.CLEARKEY:o=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${v}`)}return Nf(o,e,t,n)}function Nf(v,e,t,n){return[{initDataTypes:v,persistentState:n.persistentState||"not-allowed",distinctiveIdentifier:n.distinctiveIdentifier||"not-allowed",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(g=>({contentType:`audio/mp4; codecs="${g}"`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(g=>({contentType:`video/mp4; codecs="${g}"`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function rn(v,e,t){return Uint8Array.prototype.slice?v.slice(e,t):new Uint8Array(Array.prototype.slice.call(v,e,t))}const pa=(v,e)=>e+10<=v.length&&v[e]===73&&v[e+1]===68&&v[e+2]===51&&v[e+3]<255&&v[e+4]<255&&v[e+6]<128&&v[e+7]<128&&v[e+8]<128&&v[e+9]<128,go=(v,e)=>e+10<=v.length&&v[e]===51&&v[e+1]===68&&v[e+2]===73&&v[e+3]<255&&v[e+4]<255&&v[e+6]<128&&v[e+7]<128&&v[e+8]<128&&v[e+9]<128,Zn=(v,e)=>{const t=e;let n=0;for(;pa(v,e);){n+=10;const o=ci(v,e+6);n+=o,go(v,e+10)&&(n+=10),e+=n}if(n>0)return v.subarray(t,t+n)},ci=(v,e)=>{let t=0;return t=(v[e]&127)<<21,t|=(v[e+1]&127)<<14,t|=(v[e+2]&127)<<7,t|=v[e+3]&127,t},Ff=(v,e)=>pa(v,e)&&ci(v,e+6)+10<=v.length-e,wf=v=>{const e=Eo(v);for(let t=0;t<e.length;t++){const n=e[t];if(mo(n))return Wf(n)}},mo=v=>v&&v.key==="PRIV"&&v.info==="com.apple.streaming.transportStreamTimestamp",Bf=v=>{const e=String.fromCharCode(v[0],v[1],v[2],v[3]),t=ci(v,4),n=10;return{type:e,size:t,data:v.subarray(n,n+t)}},Eo=v=>{let e=0;const t=[];for(;pa(v,e);){const n=ci(v,e+6);e+=10;const o=e+n;for(;e+8<o;){const g=Bf(v.subarray(e)),h=Uf(g);h&&t.push(h),e+=g.size+10}go(v,e)&&(e+=10)}return t},Uf=v=>v.type==="PRIV"?kf(v):v.type[0]==="W"?jf(v):Kf(v),kf=v=>{if(v.size<2)return;const e=br(v.data,!0),t=new Uint8Array(v.data.subarray(e.length+1));return{key:v.type,info:e,data:t.buffer}},Kf=v=>{if(v.size<2)return;if(v.type==="TXXX"){let t=1;const n=br(v.data.subarray(t),!0);t+=n.length+1;const o=br(v.data.subarray(t));return{key:v.type,info:n,data:o}}const e=br(v.data.subarray(1));return{key:v.type,data:e}},jf=v=>{if(v.type==="WXXX"){if(v.size<2)return;let t=1;const n=br(v.data.subarray(t),!0);t+=n.length+1;const o=br(v.data.subarray(t));return{key:v.type,info:n,data:o}}const e=br(v.data);return{key:v.type,data:e}},Wf=v=>{if(v.data.byteLength===8){const e=new Uint8Array(v.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}},br=(v,e=!1)=>{const t=Gf();if(t){const u=t.decode(v);if(e){const l=u.indexOf("\0");return l!==-1?u.substring(0,l):u}return u.replace(/\0/g,"")}const n=v.length;let o,g,h,i="",r=0;for(;r<n;){if(o=v[r++],o===0&&e)return i;if(o===0||o===3)continue;switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i+=String.fromCharCode(o);break;case 12:case 13:g=v[r++],i+=String.fromCharCode((o&31)<<6|g&63);break;case 14:g=v[r++],h=v[r++],i+=String.fromCharCode((o&15)<<12|(g&63)<<6|(h&63)<<0);break}}return i};let Mi;function Gf(){return!Mi&&typeof self.TextDecoder<"u"&&(Mi=new self.TextDecoder("utf-8")),Mi}const Mr={hexDump:function(v){let e="";for(let t=0;t<v.length;t++){let n=v[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}},qn=Math.pow(2,32)-1,Hf=[].push,_o={video:1,audio:2,id3:3,text:4};function or(v){return String.fromCharCode.apply(null,v)}function vo(v,e){const t=v[e]<<8|v[e+1];return t<0?65536+t:t}function kt(v,e){const t=po(v,e);return t<0?4294967296+t:t}function po(v,e){return v[e]<<24|v[e+1]<<16|v[e+2]<<8|v[e+3]}function Oi(v,e,t){v[e]=t>>24,v[e+1]=t>>16&255,v[e+2]=t>>8&255,v[e+3]=t&255}function $t(v,e){const t=[];if(!e.length)return t;const n=v.byteLength;for(let o=0;o<n;){const g=kt(v,o),h=or(v.subarray(o+4,o+8)),i=g>1?o+g:n;if(h===e[0])if(e.length===1)t.push(v.subarray(o+8,i));else{const r=$t(v.subarray(o+8,i),e.slice(1));r.length&&Hf.apply(t,r)}o=i}return t}function Vf(v){const e=[],t=v[0];let n=8;const o=kt(v,n);n+=4;const g=0,h=0;t===0?n+=8:n+=16,n+=2;let i=v.length+h;const r=vo(v,n);n+=2;for(let u=0;u<r;u++){let l=n;const f=kt(v,l);l+=4;const d=f&2147483647;if((f&2147483648)>>>31===1)return We.warn("SIDX has hierarchical references (not supported)"),null;const E=kt(v,l);l+=4,e.push({referenceSize:d,subsegmentDuration:E,info:{duration:E/o,start:i,end:i+d-1}}),i+=d,l+=4,n=l}return{earliestPresentationTime:g,timescale:o,version:t,referencesCount:r,references:e}}function To(v){const e=[],t=$t(v,["moov","trak"]);for(let o=0;o<t.length;o++){const g=t[o],h=$t(g,["tkhd"])[0];if(h){let i=h[0],r=i===0?12:20;const u=kt(h,r),l=$t(g,["mdia","mdhd"])[0];if(l){i=l[0],r=i===0?12:20;const f=kt(l,r),d=$t(g,["mdia","hdlr"])[0];if(d){const _=or(d.subarray(8,12)),E={soun:Jt.AUDIO,vide:Jt.VIDEO}[_];if(E){const c=$t(g,["mdia","minf","stbl","stsd"])[0];let y;c&&(y=or(c.subarray(12,16))),e[u]={timescale:f,type:E},e[E]={timescale:f,id:u,codec:y}}}}}}return $t(v,["moov","mvex","trex"]).forEach(o=>{const g=kt(o,4),h=e[g];h&&(h.default={duration:kt(o,12),flags:kt(o,20)})}),e}function Yf(v,e){if(!v||!e)return v;const t=e.keyId;return t&&e.isCommonEncryption&&$t(v,["moov","trak"]).forEach(o=>{const h=$t(o,["mdia","minf","stbl","stsd"])[0].subarray(8);let i=$t(h,["enca"]);const r=i.length>0;r||(i=$t(h,["encv"])),i.forEach(u=>{const l=r?u.subarray(28):u.subarray(78);$t(l,["sinf"]).forEach(d=>{const _=yo(d);if(_){const E=_.subarray(8,24);E.some(c=>c!==0)||(We.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Mr.hexDump(E)} -> ${Mr.hexDump(t)}`),_.set(t,8))}})})}),v}function yo(v){const e=$t(v,["schm"])[0];if(e){const t=or(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return $t(v,["schi","tenc"])[0]}return We.error("[eme] missing 'schm' box"),null}function zf(v,e){return $t(e,["moof","traf"]).reduce((t,n)=>{const o=$t(n,["tfdt"])[0],g=o[0],h=$t(n,["tfhd"]).reduce((i,r)=>{const u=kt(r,4),l=v[u];if(l){let f=kt(o,4);if(g===1){if(f===qn)return We.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),i;f*=qn+1,f+=kt(o,8)}const d=l.timescale||9e4,_=f/d;if(isFinite(_)&&(i===null||_<i))return _}return i},null);return h!==null&&isFinite(h)&&(t===null||h<t)?h:t},null)}function $f(v,e){let t=0,n=0,o=0;const g=$t(v,["moof","traf"]);for(let h=0;h<g.length;h++){const i=g[h],r=$t(i,["tfhd"])[0],u=kt(r,4),l=e[u];if(!l)continue;const f=l.default,d=kt(r,0)|(f==null?void 0:f.flags);let _=f==null?void 0:f.duration;d&8&&(d&2?_=kt(r,12):_=kt(r,8));const E=l.timescale||9e4,c=$t(i,["trun"]);for(let y=0;y<c.length;y++){if(t=Xf(c[y]),!t&&_){const O=kt(c[y],4);t=_*O}l.type===Jt.VIDEO?n+=t/E:l.type===Jt.AUDIO&&(o+=t/E)}}if(n===0&&o===0){let h=0;const i=$t(v,["sidx"]);for(let r=0;r<i.length;r++){const u=Vf(i[r]);u!=null&&u.references&&(h+=u.references.reduce((l,f)=>l+f.info.duration||0,0))}return h}return n||o}function Xf(v){const e=kt(v,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let n=0;const o=kt(v,4);for(let g=0;g<o;g++){if(e&256){const h=kt(v,t);n+=h,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return n}function Qf(v,e,t){$t(e,["moof","traf"]).forEach(n=>{$t(n,["tfhd"]).forEach(o=>{const g=kt(o,4),h=v[g];if(!h)return;const i=h.timescale||9e4;$t(n,["tfdt"]).forEach(r=>{const u=r[0];let l=kt(r,4);if(u===0)l-=t*i,l=Math.max(l,0),Oi(r,4,l);else{l*=Math.pow(2,32),l+=kt(r,8),l-=t*i,l=Math.max(l,0);const f=Math.floor(l/(qn+1)),d=Math.floor(l%(qn+1));Oi(r,4,f),Oi(r,8,d)}})})})}function Jf(v){const e={valid:null,remainder:null},t=$t(v,["moof"]);if(t){if(t.length<2)return e.remainder=v,e}else return e;const n=t[t.length-1];return e.valid=rn(v,0,n.byteOffset-8),e.remainder=rn(v,n.byteOffset-8),e}function nn(v,e){const t=new Uint8Array(v.length+e.length);return t.set(v),t.set(e,v.length),t}function es(v,e){const t=[],n=e.samples,o=e.timescale,g=e.id;let h=!1;return $t(n,["moof"]).map(r=>{const u=r.byteOffset-8;$t(r,["traf"]).map(f=>{const d=$t(f,["tfdt"]).map(_=>{const E=_[0];let c=kt(_,4);return E===1&&(c*=Math.pow(2,32),c+=kt(_,8)),c/o})[0];return d!==void 0&&(v=d),$t(f,["tfhd"]).map(_=>{const E=kt(_,4),c=kt(_,0)&16777215,y=(c&1)!==0,O=(c&2)!==0,P=(c&8)!==0;let b=0;const L=(c&16)!==0;let R=0;const T=(c&32)!==0;let m=8;E===g&&(y&&(m+=8),O&&(m+=4),P&&(b=kt(_,m),m+=4),L&&(R=kt(_,m),m+=4),T&&(m+=4),e.type==="video"&&(h=Zf(e.codec)),$t(f,["trun"]).map(M=>{const p=M[0],C=kt(M,0)&16777215,I=(C&1)!==0;let A=0;const S=(C&4)!==0,x=(C&256)!==0;let F=0;const k=(C&512)!==0;let j=0;const V=(C&1024)!==0,Q=(C&2048)!==0;let $=0;const K=kt(M,4);let Y=8;I&&(A=kt(M,Y),Y+=4),S&&(Y+=4);let re=A+u;for(let ie=0;ie<K;ie++){if(x?(F=kt(M,Y),Y+=4):F=b,k?(j=kt(M,Y),Y+=4):j=R,V&&(Y+=4),Q&&(p===0?$=kt(M,Y):$=po(M,Y),Y+=4),e.type===Jt.VIDEO){let ee=0;for(;ee<j;){const ne=kt(n,re);if(re+=4,qf(h,n[re])){const ae=n.subarray(re,re+ne);Ao(ae,h?2:1,v+$/o,t)}re+=ne,ee+=ne+4}}v+=F/o}}))})})}),t}function Zf(v){if(!v)return!1;const e=v.indexOf("."),t=e<0?v:v.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function qf(v,e){if(v){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Ao(v,e,t,n){const o=So(v);let g=0;g+=e;let h=0,i=0,r=!1,u=0;for(;g<o.length;){h=0;do{if(g>=o.length)break;u=o[g++],h+=u}while(u===255);i=0;do{if(g>=o.length)break;u=o[g++],i+=u}while(u===255);const l=o.length-g;if(!r&&h===4&&g<o.length){if(r=!0,o[g++]===181){const d=vo(o,g);if(g+=2,d===49){const _=kt(o,g);if(g+=4,_===1195456820){const E=o[g++];if(E===3){const c=o[g++],y=31&c,O=64&c,P=O?2+y*3:0,b=new Uint8Array(P);if(O){b[0]=c;for(let L=1;L<P;L++)b[L]=o[g++]}n.push({type:E,payloadType:h,pts:t,bytes:b})}}}}}else if(h===5&&i<l){if(r=!0,i>16){const f=[];for(let E=0;E<16;E++){const c=o[g++].toString(16);f.push(c.length==1?"0"+c:c),(E===3||E===5||E===7||E===9)&&f.push("-")}const d=i-16,_=new Uint8Array(d);for(let E=0;E<d;E++)_[E]=o[g++];n.push({payloadType:h,pts:t,uuid:f.join(""),userData:br(_),userDataBytes:_})}}else if(i<l)g+=i;else if(i>l)break}}function So(v){const e=v.byteLength,t=[];let n=1;for(;n<e-2;)v[n]===0&&v[n+1]===0&&v[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return v;const o=e-t.length,g=new Uint8Array(o);let h=0;for(n=0;n<o;h++,n++)h===t[0]&&(h++,t.shift()),g[n]=v[h];return g}function ec(v){const e=v[0];let t="",n="",o=0,g=0,h=0,i=0,r=0,u=0;if(e===0){for(;or(v.subarray(u,u+1))!=="\0";)t+=or(v.subarray(u,u+1)),u+=1;for(t+=or(v.subarray(u,u+1)),u+=1;or(v.subarray(u,u+1))!=="\0";)n+=or(v.subarray(u,u+1)),u+=1;n+=or(v.subarray(u,u+1)),u+=1,o=kt(v,12),g=kt(v,16),i=kt(v,20),r=kt(v,24),u=28}else if(e===1){u+=4,o=kt(v,u),u+=4;const f=kt(v,u);u+=4;const d=kt(v,u);for(u+=4,h=2**32*f+d,Number.isSafeInteger(h)||(h=Number.MAX_SAFE_INTEGER,We.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),i=kt(v,u),u+=4,r=kt(v,u),u+=4;or(v.subarray(u,u+1))!=="\0";)t+=or(v.subarray(u,u+1)),u+=1;for(t+=or(v.subarray(u,u+1)),u+=1;or(v.subarray(u,u+1))!=="\0";)n+=or(v.subarray(u,u+1)),u+=1;n+=or(v.subarray(u,u+1)),u+=1}const l=v.subarray(u,v.byteLength);return{schemeIdUri:t,value:n,timeScale:o,presentationTime:h,presentationTimeDelta:g,eventDuration:i,id:r,payload:l}}function tc(v,...e){const t=e.length;let n=8,o=t;for(;o--;)n+=e[o].byteLength;const g=new Uint8Array(n);for(g[0]=n>>24&255,g[1]=n>>16&255,g[2]=n>>8&255,g[3]=n&255,g.set(v,4),o=0,n=8;o<t;o++)g.set(e[o],n),n+=e[o].byteLength;return g}function rc(v,e,t){if(v.byteLength!==16)throw new RangeError("Invalid system id");let n,o;if(e){n=1,o=new Uint8Array(e.length*16);for(let i=0;i<e.length;i++){const r=e[i];if(r.byteLength!==16)throw new RangeError("Invalid key");o.set(r,i*16)}}else n=0,o=new Uint8Array;let g;n>0?(g=new Uint8Array(4),e.length>0&&new DataView(g.buffer).setUint32(0,e.length,!1)):g=new Uint8Array;const h=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(h.buffer).setUint32(0,t.byteLength,!1),tc([112,115,115,104],new Uint8Array([n,0,0,0]),v,g,o,h,t||new Uint8Array)}function nc(v){if(!(v instanceof ArrayBuffer)||v.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},t=new DataView(v),n=t.getUint32(0);if(v.byteLength!==n&&n>44||t.getUint32(4)!==1886614376||(e.version=t.getUint32(8)>>>24,e.version>1))return null;e.systemId=Mr.hexDump(new Uint8Array(v,12,16));const g=t.getUint32(28);if(e.version===0){if(n-32<g)return null;e.data=new Uint8Array(v,32,g)}else if(e.version===1){e.kids=[];for(let h=0;h<g;h++)e.kids.push(new Uint8Array(v,32+h*16,16))}return e}let Bn={};class In{static clearKeyUriToKeyIdMap(){Bn={}}constructor(e,t,n,o=[1],g=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=o,this.iv=g,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case gr.FAIRPLAY:case gr.WIDEVINE:case gr.PLAYREADY:case gr.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&We.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const n=ic(e);return new In(this.method,this.uri,"identity",this.keyFormatVersions,n)}const t=Lf(this.uri);if(t)switch(this.keyFormat){case gr.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case gr.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=rc(n,null,t);const o=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),g=String.fromCharCode.apply(null,Array.from(o)),h=g.substring(g.indexOf("<"),g.length),u=new DOMParser().parseFromString(h,"text/xml").getElementsByTagName("KID")[0];if(u){const l=u.childNodes[0]?u.childNodes[0].nodeValue:u.getAttribute("VALUE");if(l){const f=va(l).subarray(0,16);Of(f),this.keyId=f}}break}default:{let n=t.subarray(0,16);if(n.length!==16){const o=new Uint8Array(16);o.set(n,16-n.length),n=o}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n=Bn[this.uri];if(!n){const o=Object.keys(Bn).length%Number.MAX_SAFE_INTEGER;n=new Uint8Array(16),new DataView(n.buffer,12,4).setUint32(0,o),Bn[this.uri]=n}this.keyId=n}return this}}function ic(v){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=v>>8*(15-t)&255;return e}const Ro=/\{\$([a-zA-Z0-9-_]+)\}/g;function ts(v){return Ro.test(v)}function dr(v,e,t){if(v.variableList!==null||v.hasVariableRefs)for(let n=t.length;n--;){const o=t[n],g=e[o];g&&(e[o]=na(v,g))}}function na(v,e){if(v.variableList!==null||v.hasVariableRefs){const t=v.variableList;return e.replace(Ro,n=>{const o=n.substring(2,n.length-1),g=t==null?void 0:t[o];return g===void 0?(v.playlistParsingError||(v.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${o}"`)),n):g})}return e}function rs(v,e,t){let n=v.variableList;n||(v.variableList=n={});let o,g;if("QUERYPARAM"in e){o=e.QUERYPARAM;try{const h=new self.URL(t).searchParams;if(h.has(o))g=h.get(o);else throw new Error(`"${o}" does not match any query parameter in URI: "${t}"`)}catch(h){v.playlistParsingError||(v.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${h.message}`))}}else o=e.NAME,g=e.VALUE;o in n?v.playlistParsingError||(v.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${o}"`)):n[o]=g||""}function ac(v,e,t){const n=e.IMPORT;if(t&&n in t){let o=v.variableList;o||(v.variableList=o={}),o[n]=t[n]}else v.playlistParsingError||(v.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const sc={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function oc(v,e){const t=sc[e];return!!t&&t[v.slice(0,4)]===!0}function Li(v,e){return MediaSource.isTypeSupported(`${e||"video"}/mp4;codecs="${v}"`)}const ns=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,is=/#EXT-X-MEDIA:(.*)/g,lc=/^#EXT(?:INF|-X-TARGETDURATION):/m,as=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),uc=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Rr{static findGroup(e,t){for(let n=0;n<e.length;n++){const o=e[n];if(o.id===t)return o}}static convertAVC1ToAVCOTI(e){const t=e.split(".");if(t.length>2){let n=t.shift()+".";return n+=parseInt(t.shift()).toString(16),n+=("000"+parseInt(t.shift()).toString(16)).slice(-4),n}return e}static resolve(e,t){return Dn.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return lc.test(e)}static parseMasterPlaylist(e,t){const n=ts(e),o={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},g=[];ns.lastIndex=0;let h;for(;(h=ns.exec(e))!=null;)if(h[1]){var i;const u=new er(h[1]);dr(o,u,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const l=na(o,h[2]),f={attrs:u,bitrate:u.decimalInteger("AVERAGE-BANDWIDTH")||u.decimalInteger("BANDWIDTH"),name:u.NAME,url:Rr.resolve(l,t)},d=u.decimalResolution("RESOLUTION");d&&(f.width=d.width,f.height=d.height),fc((u.CODECS||"").split(/[ ,]+/).filter(_=>_),f),f.videoCodec&&f.videoCodec.indexOf("avc1")!==-1&&(f.videoCodec=Rr.convertAVC1ToAVCOTI(f.videoCodec)),(i=f.unknownCodecs)!=null&&i.length||g.push(f),o.levels.push(f)}else if(h[3]){const u=h[3],l=h[4];switch(u){case"SESSION-DATA":{const f=new er(l);dr(o,f,["DATA-ID","LANGUAGE","VALUE","URI"]);const d=f["DATA-ID"];d&&(o.sessionData===null&&(o.sessionData={}),o.sessionData[d]=f);break}case"SESSION-KEY":{const f=ss(l,t,o);f.encrypted&&f.isSupported()?(o.sessionKeys===null&&(o.sessionKeys=[]),o.sessionKeys.push(f)):We.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${l}"`);break}case"DEFINE":{{const f=new er(l);dr(o,f,["NAME","VALUE","QUERYPARAM"]),rs(o,f,t)}break}case"CONTENT-STEERING":{const f=new er(l);dr(o,f,["SERVER-URI","PATHWAY-ID"]),o.contentSteering={uri:Rr.resolve(f["SERVER-URI"],t),pathwayId:f["PATHWAY-ID"]||"."};break}case"START":{o.startTimeOffset=os(l);break}}}const r=g.length>0&&g.length<o.levels.length;return o.levels=r?g:o.levels,o.levels.length===0&&(o.playlistParsingError=new Error("no levels found in manifest")),o}static parseMasterPlaylistMedia(e,t,n){let o;const g={},h=n.levels,i={AUDIO:h.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:h.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let r=0;for(is.lastIndex=0;(o=is.exec(e))!==null;){const u=new er(o[1]),l=u.TYPE;if(l){const f=i[l],d=g[l]||[];g[l]=d,dr(n,u,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const _={attrs:u,bitrate:0,id:r++,groupId:u["GROUP-ID"]||"",instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:l,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?Rr.resolve(u.URI,t):""};if(f!=null&&f.length){const E=Rr.findGroup(f,_.groupId)||f[0];ls(_,E,"audioCodec"),ls(_,E,"textCodec")}d.push(_)}}return g}static parseLevelPlaylist(e,t,n,o,g,h){const i=new Pf(t),r=i.fragments;let u=null,l=0,f=0,d=0,_=0,E=null,c=new Ci(o,t),y,O,P,b=-1,L=!1;for(as.lastIndex=0,i.m3u8=e,i.hasVariableRefs=ts(e);(y=as.exec(e))!==null;){L&&(L=!1,c=new Ci(o,t),c.start=d,c.sn=l,c.cc=_,c.level=n,u&&(c.initSegment=u,c.rawProgramDateTime=u.rawProgramDateTime,u.rawProgramDateTime=null));const M=y[1];if(M){c.duration=parseFloat(M);const p=(" "+y[2]).slice(1);c.title=p||null,c.tagList.push(p?["INF",M,p]:["INF",M])}else if(y[3]){if(xt(c.duration)){c.start=d,P&&cs(c,P,i),c.sn=l,c.level=n,c.cc=_,c.urlId=g,r.push(c);const p=(" "+y[3]).slice(1);c.relurl=na(i,p),us(c,E),E=c,d+=c.duration,l++,f=0,L=!0}}else if(y[4]){const p=(" "+y[4]).slice(1);E?c.setByteRange(p,E):c.setByteRange(p)}else if(y[5])c.rawProgramDateTime=(" "+y[5]).slice(1),c.tagList.push(["PROGRAM-DATE-TIME",c.rawProgramDateTime]),b===-1&&(b=r.length);else{if(y=y[0].match(uc),!y){We.warn("No matches on slow regex match for level playlist!");continue}for(O=1;O<y.length&&!(typeof y[O]<"u");O++);const p=(" "+y[O]).slice(1),C=(" "+y[O+1]).slice(1),I=y[O+2]?(" "+y[O+2]).slice(1):"";switch(p){case"PLAYLIST-TYPE":i.type=C.toUpperCase();break;case"MEDIA-SEQUENCE":l=i.startSN=parseInt(C);break;case"SKIP":{const A=new er(C);dr(i,A,["RECENTLY-REMOVED-DATERANGES"]);const S=A.decimalInteger("SKIPPED-SEGMENTS");if(xt(S)){i.skippedSegments=S;for(let F=S;F--;)r.unshift(null);l+=S}const x=A.enumeratedString("RECENTLY-REMOVED-DATERANGES");x&&(i.recentlyRemovedDateranges=x.split("	"));break}case"TARGETDURATION":i.targetduration=Math.max(parseInt(C),1);break;case"VERSION":i.version=parseInt(C);break;case"EXTM3U":break;case"ENDLIST":i.live=!1;break;case"#":(C||I)&&c.tagList.push(I?[C,I]:[C]);break;case"DISCONTINUITY":_++,c.tagList.push(["DIS"]);break;case"GAP":c.gap=!0,c.tagList.push([p]);break;case"BITRATE":c.tagList.push([p,C]);break;case"DATERANGE":{const A=new er(C);dr(i,A,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),dr(i,A,A.clientAttrs);const S=new lo(A,i.dateRanges[A.ID]);S.isValid||i.skippedSegments?i.dateRanges[S.id]=S:We.warn(`Ignoring invalid DATERANGE tag: "${C}"`),c.tagList.push(["EXT-X-DATERANGE",C]);break}case"DEFINE":{{const A=new er(C);dr(i,A,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in A?ac(i,A,h):rs(i,A,t)}break}case"DISCONTINUITY-SEQUENCE":_=parseInt(C);break;case"KEY":{const A=ss(C,t,i);if(A.isSupported()){if(A.method==="NONE"){P=void 0;break}P||(P={}),P[A.keyFormat]&&(P=ar({},P)),P[A.keyFormat]=A}else We.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${C}"`);break}case"START":i.startTimeOffset=os(C);break;case"MAP":{const A=new er(C);if(dr(i,A,["BYTERANGE","URI"]),c.duration){const S=new Ci(o,t);fs(S,A,n,P),u=S,c.initSegment=u,u.rawProgramDateTime&&!c.rawProgramDateTime&&(c.rawProgramDateTime=u.rawProgramDateTime)}else fs(c,A,n,P),u=c,L=!0;break}case"SERVER-CONTROL":{const A=new er(C);i.canBlockReload=A.bool("CAN-BLOCK-RELOAD"),i.canSkipUntil=A.optionalFloat("CAN-SKIP-UNTIL",0),i.canSkipDateRanges=i.canSkipUntil>0&&A.bool("CAN-SKIP-DATERANGES"),i.partHoldBack=A.optionalFloat("PART-HOLD-BACK",0),i.holdBack=A.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const A=new er(C);i.partTarget=A.decimalFloatingPoint("PART-TARGET");break}case"PART":{let A=i.partList;A||(A=i.partList=[]);const S=f>0?A[A.length-1]:void 0,x=f++,F=new er(C);dr(i,F,["BYTERANGE","URI"]);const k=new If(F,c,t,x,S);A.push(k),c.duration+=k.duration;break}case"PRELOAD-HINT":{const A=new er(C);dr(i,A,["URI"]),i.preloadHint=A;break}case"RENDITION-REPORT":{const A=new er(C);dr(i,A,["URI"]),i.renditionReports=i.renditionReports||[],i.renditionReports.push(A);break}default:We.warn(`line parsed but not handled: ${y}`);break}}}E&&!E.relurl?(r.pop(),d-=E.duration,i.partList&&(i.fragmentHint=E)):i.partList&&(us(c,E),c.cc=_,i.fragmentHint=c,P&&cs(c,P,i));const R=r.length,T=r[0],m=r[R-1];if(d+=i.skippedSegments*i.targetduration,d>0&&R&&m){i.averagetargetduration=d/R;const M=m.sn;i.endSN=M!=="initSegment"?M:0,i.live||(m.endList=!0),T&&(i.startCC=T.cc)}else i.endSN=0,i.startCC=0;return i.fragmentHint&&(d+=i.fragmentHint.duration),i.totalduration=d,i.endCC=_,b>0&&cc(r,b),i}}function ss(v,e,t){var n,o;const g=new er(v);dr(t,g,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const h=(n=g.METHOD)!=null?n:"",i=g.URI,r=g.hexadecimalInteger("IV"),u=g.KEYFORMATVERSIONS,l=(o=g.KEYFORMAT)!=null?o:"identity";i&&g.IV&&!r&&We.error(`Invalid IV: ${g.IV}`);const f=i?Rr.resolve(i,e):"",d=(u||"1").split("/").map(Number).filter(Number.isFinite);return new In(h,f,l,d,r)}function os(v){const t=new er(v).decimalFloatingPoint("TIME-OFFSET");return xt(t)?t:null}function fc(v,e){["video","audio","text"].forEach(t=>{const n=v.filter(o=>oc(o,t));if(n.length){const o=n.filter(g=>g.lastIndexOf("avc1",0)===0||g.lastIndexOf("mp4a",0)===0);e[`${t}Codec`]=o.length>0?o[0]:n[0],v=v.filter(g=>n.indexOf(g)===-1)}}),e.unknownCodecs=v}function ls(v,e,t){const n=e[t];n&&(v[t]=n)}function cc(v,e){let t=v[e];for(let n=e;n--;){const o=v[n];if(!o)return;o.programDateTime=t.programDateTime-o.duration*1e3,t=o}}function us(v,e){v.rawProgramDateTime?v.programDateTime=Date.parse(v.rawProgramDateTime):e!=null&&e.programDateTime&&(v.programDateTime=e.endProgramDateTime),xt(v.programDateTime)||(v.programDateTime=null,v.rawProgramDateTime=null)}function fs(v,e,t,n){v.relurl=e.URI,e.BYTERANGE&&v.setByteRange(e.BYTERANGE),v.level=t,v.sn="initSegment",n&&(v.levelkeys=n),v.initSegment=null}function cs(v,e,t){v.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(o=>e[o].isCommonEncryption)&&n.push(v)}var Xt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Bt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function ds(v){const{type:e}=v;switch(e){case Xt.AUDIO_TRACK:return Bt.AUDIO;case Xt.SUBTITLE_TRACK:return Bt.SUBTITLE;default:return Bt.MAIN}}function bi(v,e){let t=v.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class dc{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(Ee.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(Ee.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.off(Ee.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(Ee.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,o=t.loader,g=n||o,h=new g(t);return this.loaders[e.type]=h,h}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Xt.MANIFEST,url:n,deliveryDirectives:null})}onLevelLoading(e,t){const{id:n,level:o,url:g,deliveryDirectives:h}=t;this.load({id:n,level:o,responseType:"text",type:Xt.LEVEL,url:g,deliveryDirectives:h})}onAudioTrackLoading(e,t){const{id:n,groupId:o,url:g,deliveryDirectives:h}=t;this.load({id:n,groupId:o,level:null,responseType:"text",type:Xt.AUDIO_TRACK,url:g,deliveryDirectives:h})}onSubtitleTrackLoading(e,t){const{id:n,groupId:o,url:g,deliveryDirectives:h}=t;this.load({id:n,groupId:o,level:null,responseType:"text",type:Xt.SUBTITLE_TRACK,url:g,deliveryDirectives:h})}load(e){var t;const n=this.hls.config;let o=this.getInternalLoader(e);if(o){const u=o.context;if(u&&u.url===e.url){We.trace("[playlist-loader]: playlist request ongoing");return}We.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),o.abort()}let g;if(e.type===Xt.MANIFEST?g=n.manifestLoadPolicy.default:g=ar({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),o=this.createInternalLoader(e),(t=e.deliveryDirectives)!=null&&t.part){let u;if(e.type===Xt.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===Xt.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===Xt.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const l=u.partTarget,f=u.targetduration;if(l&&f){const d=Math.max(l*3,f*.8)*1e3;g=ar({},g,{maxTimeToFirstByteMs:Math.min(d,g.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(d,g.maxTimeToFirstByteMs)})}}}const h=g.errorRetry||g.timeoutRetry||{},i={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},r={onSuccess:(u,l,f,d)=>{const _=this.getInternalLoader(f);this.resetInternalLoader(f.type);const E=u.data;if(E.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(u,f,new Error("no EXTM3U delimiter"),d||null,l);return}l.parsing.start=performance.now(),Rr.isMediaPlaylist(E)?this.handleTrackOrLevelPlaylist(u,l,f,d||null,_):this.handleMasterPlaylist(u,l,f,d)},onError:(u,l,f,d)=>{this.handleNetworkError(l,f,!1,u,d)},onTimeout:(u,l,f)=>{this.handleNetworkError(l,f,!0,void 0,u)}};o.load(e,i,r)}handleMasterPlaylist(e,t,n,o){const g=this.hls,h=e.data,i=bi(e,n),r=Rr.parseMasterPlaylist(h,i);if(r.playlistParsingError){this.handleManifestParsingError(e,n,r.playlistParsingError,o,t);return}const{contentSteering:u,levels:l,sessionData:f,sessionKeys:d,startTimeOffset:_,variableList:E}=r;this.variableList=E;const{AUDIO:c=[],SUBTITLES:y,"CLOSED-CAPTIONS":O}=Rr.parseMasterPlaylistMedia(h,i,r);c.length&&!c.some(b=>!b.url)&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(We.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),c.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new er({}),bitrate:0,url:""})),g.trigger(Ee.MANIFEST_LOADED,{levels:l,audioTracks:c,subtitles:y,captions:O,contentSteering:u,url:i,stats:t,networkDetails:o,sessionData:f,sessionKeys:d,startTimeOffset:_,variableList:E})}handleTrackOrLevelPlaylist(e,t,n,o,g){const h=this.hls,{id:i,level:r,type:u}=n,l=bi(e,n),f=xt(i)?i:0,d=xt(r)?r:f,_=ds(n),E=Rr.parseLevelPlaylist(e.data,l,d,_,f,this.variableList);if(u===Xt.MANIFEST){const c={attrs:new er({}),bitrate:0,details:E,name:"",url:l};h.trigger(Ee.MANIFEST_LOADED,{levels:[c],audioTracks:[],url:l,stats:t,networkDetails:o,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=E,this.handlePlaylistLoaded(E,e,t,n,o,g)}handleManifestParsingError(e,t,n,o,g){this.hls.trigger(Ee.ERROR,{type:Ft.NETWORK_ERROR,details:st.MANIFEST_PARSING_ERROR,fatal:t.type===Xt.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:o,stats:g})}handleNetworkError(e,t,n=!1,o,g){let h=`A network ${n?"timeout":"error"+(o?" (status "+o.code+")":"")} occurred while loading ${e.type}`;e.type===Xt.LEVEL?h+=`: ${e.level} id: ${e.id}`:(e.type===Xt.AUDIO_TRACK||e.type===Xt.SUBTITLE_TRACK)&&(h+=` id: ${e.id} group-id: "${e.groupId}"`);const i=new Error(h);We.warn(`[playlist-loader]: ${h}`);let r=st.UNKNOWN,u=!1;const l=this.getInternalLoader(e);switch(e.type){case Xt.MANIFEST:r=n?st.MANIFEST_LOAD_TIMEOUT:st.MANIFEST_LOAD_ERROR,u=!0;break;case Xt.LEVEL:r=n?st.LEVEL_LOAD_TIMEOUT:st.LEVEL_LOAD_ERROR,u=!1;break;case Xt.AUDIO_TRACK:r=n?st.AUDIO_TRACK_LOAD_TIMEOUT:st.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Xt.SUBTITLE_TRACK:r=n?st.SUBTITLE_TRACK_LOAD_TIMEOUT:st.SUBTITLE_LOAD_ERROR,u=!1;break}l&&this.resetInternalLoader(e.type);const f={type:Ft.NETWORK_ERROR,details:r,fatal:u,url:e.url,loader:l,context:e,error:i,networkDetails:t,stats:g};if(o){const d=(t==null?void 0:t.url)||e.url;f.response=mr({url:d,data:void 0},o)}this.hls.trigger(Ee.ERROR,f)}handlePlaylistLoaded(e,t,n,o,g,h){const i=this.hls,{type:r,level:u,id:l,groupId:f,deliveryDirectives:d}=o,_=bi(t,o),E=ds(o),c=typeof o.level=="number"&&E===Bt.MAIN?u:void 0;if(!e.fragments.length){const O=new Error("No Segments found in Playlist");i.trigger(Ee.ERROR,{type:Ft.NETWORK_ERROR,details:st.LEVEL_EMPTY_ERROR,fatal:!1,url:_,error:O,reason:O.message,response:t,context:o,level:c,parent:E,networkDetails:g,stats:n});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const y=e.playlistParsingError;if(y){i.trigger(Ee.ERROR,{type:Ft.NETWORK_ERROR,details:st.LEVEL_PARSING_ERROR,fatal:!1,url:_,error:y,reason:y.message,response:t,context:o,level:c,parent:E,networkDetails:g,stats:n});return}switch(e.live&&h&&(h.getCacheAge&&(e.ageHeader=h.getCacheAge()||0),(!h.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),r){case Xt.MANIFEST:case Xt.LEVEL:i.trigger(Ee.LEVEL_LOADED,{details:e,level:c||0,id:l||0,stats:n,networkDetails:g,deliveryDirectives:d});break;case Xt.AUDIO_TRACK:i.trigger(Ee.AUDIO_TRACK_LOADED,{details:e,id:l||0,groupId:f||"",stats:n,networkDetails:g,deliveryDirectives:d});break;case Xt.SUBTITLE_TRACK:i.trigger(Ee.SUBTITLE_TRACK_LOADED,{details:e,id:l||0,groupId:f||"",stats:n,networkDetails:g,deliveryDirectives:d});break}}}function Do(v,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=v,e.dispatchEvent(t)}function Io(v,e){const t=v.mode;if(t==="disabled"&&(v.mode="hidden"),v.cues&&!v.cues.getCueById(e.id))try{if(v.addCue(e),!v.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){We.debug(`[texttrack-utils]: ${n}`);const o=new self.TextTrackCue(e.startTime,e.endTime,e.text);o.id=e.id,v.addCue(o)}t==="disabled"&&(v.mode=t)}function cn(v){const e=v.mode;if(e==="disabled"&&(v.mode="hidden"),v.cues)for(let t=v.cues.length;t--;)v.removeCue(v.cues[t]);e==="disabled"&&(v.mode=e)}function ia(v,e,t,n){const o=v.mode;if(o==="disabled"&&(v.mode="hidden"),v.cues&&v.cues.length>0){const g=gc(v.cues,e,t);for(let h=0;h<g.length;h++)(!n||n(g[h]))&&v.removeCue(g[h])}o==="disabled"&&(v.mode=o)}function hc(v,e){if(e<v[0].startTime)return 0;const t=v.length-1;if(e>v[t].endTime)return-1;let n=0,o=t;for(;n<=o;){const g=Math.floor((o+n)/2);if(e<v[g].startTime)o=g-1;else if(e>v[g].startTime&&n<t)n=g+1;else return g}return v[n].startTime-e<e-v[o].startTime?n:o}function gc(v,e,t){const n=[],o=hc(v,e);if(o>-1)for(let g=o,h=v.length;g<h;g++){const i=v[g];if(i.startTime>=e&&i.endTime<=t)n.push(i);else if(i.startTime>t)return n}return n}var Sr={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const mc=.25;function aa(){if(!(typeof self>"u"))return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const Un=(()=>{const v=aa();try{new v(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function xi(v,e){return v.getTime()/1e3-e}function Ec(v){return Uint8Array.from(v.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class _c{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Ee.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Ee.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(cn(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return Do(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:o}}}=this;if(!n&&!o)return;const{samples:g}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const h=aa();for(let i=0;i<g.length;i++){const r=g[i].type;if(r===Sr.emsg&&!n||!o)continue;const u=Eo(g[i].data);if(u){const l=g[i].pts;let f=l+g[i].duration;f>Un&&(f=Un),f-l<=0&&(f=l+mc);for(let _=0;_<u.length;_++){const E=u[_];if(!mo(E)){this.updateId3CueEnds(l);const c=new h(l,f,"");c.value=E,r&&(c.type=r),this.id3Track.addCue(c)}}}}}updateId3CueEnds(e){var t;const n=(t=this.id3Track)==null?void 0:t.cues;if(n)for(let o=n.length;o--;){const g=n[o];g.startTime<e&&g.endTime===Un&&(g.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:o}){const{id3Track:g,hls:h}=this;if(!h)return;const{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:r}}=h;if(g&&(i||r)){let u;o==="audio"?u=l=>l.type===Sr.audioId3&&r:o==="video"?u=l=>l.type===Sr.emsg&&i:u=l=>l.type===Sr.audioId3&&r||l.type===Sr.emsg&&i,ia(g,t,n,u)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:n,id3Track:o}=this,{dateRanges:g}=t,h=Object.keys(g);if(o){const l=Object.keys(n).filter(f=>!h.includes(f));for(let f=l.length;f--;){const d=l[f];Object.keys(n[d].cues).forEach(_=>{o.removeCue(n[d].cues[_])}),delete n[d]}}const i=t.fragments[t.fragments.length-1];if(h.length===0||!xt(i==null?void 0:i.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const r=i.programDateTime/1e3-i.start,u=aa();for(let l=0;l<h.length;l++){const f=h[l],d=g[f],_=n[f],E=(_==null?void 0:_.cues)||{};let c=(_==null?void 0:_.durationKnown)||!1;const y=xi(d.startDate,r);let O=Un;const P=d.endDate;if(P)O=xi(P,r),c=!0;else if(d.endOnNext&&!c){const L=h.reduce((R,T)=>{const m=g[T];return m.class===d.class&&m.id!==T&&m.startDate>d.startDate&&R.push(m),R},[]).sort((R,T)=>R.startDate.getTime()-T.startDate.getTime())[0];L&&(O=xi(L.startDate,r),c=!0)}const b=Object.keys(d.attr);for(let L=0;L<b.length;L++){const R=b[L];if(!Rf(R))continue;let T=E[R];if(T)c&&!_.durationKnown&&(T.endTime=O);else{let m=d.attr[R];T=new u(y,O,""),Df(R)&&(m=Ec(m)),T.value={key:R,data:m},T.type=Sr.dateRange,T.id=f,this.id3Track.addCue(T),E[R]=T}}n[f]={cues:E,dateRange:d,durationKnown:c}}}}class vc{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:t,partHoldBack:n,targetduration:o}=e,{liveSyncDuration:g,liveSyncDurationCount:h,lowLatencyMode:i}=this.config,r=this.hls.userConfig;let u=i&&n||t;(r.liveSyncDuration||r.liveSyncDurationCount||u===0)&&(u=g!==void 0?g:h*o);const l=o,f=1;return u+Math.min(this.stallCount*f,l)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,n=this.levelDetails;if(e===null||t===null||n===null)return null;const o=n.edge,g=e-t-this.edgeStalled,h=o-n.totalduration,i=o-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(h,g),i)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Ee.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Ee.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Ee.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Ee.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var n;t.details===st.BUFFER_STALLED_ERROR&&(this.stallCount++,(n=this.levelDetails)!=null&&n.live&&We.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:o,maxLiveSyncPlaybackRate:g}=this.config;if(!o||g===1)return;const h=this.targetLatency;if(h===null)return;const i=n-h,r=Math.min(this.maxLatency,h+t.targetduration),u=i<r;if(t.live&&u&&i>.05&&this.forwardBufferLength>1){const l=Math.min(2,Math.max(1,g)),f=Math.round(2/(1+Math.exp(-.75*i-this.edgeStalled))*20)/20;e.playbackRate=Math.min(l,Math.max(1,f))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const sa=["NONE","TYPE-0","TYPE-1",null];var Sn={No:"",Yes:"YES",v2:"v2"};function pc(v,e){const{canSkipUntil:t,canSkipDateRanges:n,endSN:o}=v,g=e!==void 0?e-o:0;return t&&g<t?n?Sn.v2:Sn.Yes:Sn.No}class hs{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Cn{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>t).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){const t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return(e=this.audioGroupIds)==null?void 0:e[this.urlId]}get textGroupId(){var e;return(e=this.textGroupIds)==null?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function Ni(v,e){const t=e.startPTS;if(xt(t)){let n=0,o;e.sn>v.sn?(n=t-v.start,o=v):(n=v.start-t,o=e),o.duration!==n&&(o.duration=n)}else e.sn>v.sn?v.cc===e.cc&&v.minEndPTS?e.start=v.start+(v.minEndPTS-v.start):e.start=v.start+v.duration:e.start=Math.max(v.start-e.duration,0)}function Co(v,e,t,n,o,g){n-t<=0&&(We.warn("Fragment should have a positive duration",e),n=t+e.duration,g=o+e.duration);let i=t,r=n;const u=e.startPTS,l=e.endPTS;if(xt(u)){const y=Math.abs(u-t);xt(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,i=Math.max(t,u),t=Math.min(t,u),o=Math.min(o,e.startDTS),r=Math.min(n,l),n=Math.max(n,l),g=Math.max(g,e.endDTS)}const f=t-e.start;e.start!==0&&(e.start=t),e.duration=n-e.start,e.startPTS=t,e.maxStartPTS=i,e.startDTS=o,e.endPTS=n,e.minEndPTS=r,e.endDTS=g;const d=e.sn;if(!v||d<v.startSN||d>v.endSN)return 0;let _;const E=d-v.startSN,c=v.fragments;for(c[E]=e,_=E;_>0;_--)Ni(c[_],c[_-1]);for(_=E;_<c.length-1;_++)Ni(c[_],c[_+1]);return v.fragmentHint&&Ni(c[c.length-1],v.fragmentHint),v.PTSKnown=v.alignedSliding=!0,f}function Tc(v,e){let t=null;const n=v.fragments;for(let r=n.length-1;r>=0;r--){const u=n[r].initSegment;if(u){t=u;break}}v.fragmentHint&&delete v.fragmentHint.endPTS;let o=0,g;if(Sc(v,e,(r,u)=>{r.relurl&&(o=r.cc-u.cc),xt(r.startPTS)&&xt(r.endPTS)&&(u.start=u.startPTS=r.startPTS,u.startDTS=r.startDTS,u.maxStartPTS=r.maxStartPTS,u.endPTS=r.endPTS,u.endDTS=r.endDTS,u.minEndPTS=r.minEndPTS,u.duration=r.endPTS-r.startPTS,u.duration&&(g=u),e.PTSKnown=e.alignedSliding=!0),u.elementaryStreams=r.elementaryStreams,u.loader=r.loader,u.stats=r.stats,u.urlId=r.urlId,r.initSegment&&(u.initSegment=r.initSegment,t=r.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(u=>{var l;(!u.initSegment||u.initSegment.relurl===((l=t)==null?void 0:l.relurl))&&(u.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(r=>!r),e.deltaUpdateFailed){We.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let r=e.skippedSegments;r--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=yc(v.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const h=e.fragments;if(o){We.warn("discontinuity sliding from playlist, take drift into account");for(let r=0;r<h.length;r++)h[r].cc+=o}e.skippedSegments&&(e.startCC=e.fragments[0].cc),Ac(v.partList,e.partList,(r,u)=>{u.elementaryStreams=r.elementaryStreams,u.stats=r.stats}),g?Co(e,g,g.startPTS,g.endPTS,g.startDTS,g.endDTS):Po(v,e),h.length&&(e.totalduration=e.edge-h[0].start),e.driftStartTime=v.driftStartTime,e.driftStart=v.driftStart;const i=e.advancedDateTime;if(e.advanced&&i){const r=e.edge;e.driftStart||(e.driftStartTime=i,e.driftStart=r),e.driftEndTime=i,e.driftEnd=r}else e.driftEndTime=v.driftEndTime,e.driftEnd=v.driftEnd,e.advancedDateTime=v.advancedDateTime}function yc(v,e,t){const n=ar({},v);return t&&t.forEach(o=>{delete n[o]}),Object.keys(e).forEach(o=>{const g=new lo(e[o].attr,n[o]);g.isValid?n[o]=g:We.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[o].attr)}"`)}),n}function Ac(v,e,t){if(v&&e){let n=0;for(let o=0,g=v.length;o<=g;o++){const h=v[o],i=e[o+n];h&&i&&h.index===i.index&&h.fragment.sn===i.fragment.sn?t(h,i):n--}}}function Sc(v,e,t){const n=e.skippedSegments,o=Math.max(v.startSN,e.startSN)-e.startSN,g=(v.fragmentHint?1:0)+(n?e.endSN:Math.min(v.endSN,e.endSN))-e.startSN,h=e.startSN-v.startSN,i=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,r=v.fragmentHint?v.fragments.concat(v.fragmentHint):v.fragments;for(let u=o;u<=g;u++){const l=r[h+u];let f=i[u];n&&!f&&u<n&&(f=e.fragments[u]=l),l&&f&&t(l,f)}}function Po(v,e){const t=e.startSN+e.skippedSegments-v.startSN,n=v.fragments;t<0||t>=n.length||oa(e,n[t].start)}function oa(v,e){if(e){const t=v.fragments;for(let n=v.skippedSegments;n<t.length;n++)t[n].start+=e;v.fragmentHint&&(v.fragmentHint.start+=e)}}function Rc(v,e=1/0){let t=1e3*v.targetduration;if(v.updated){const n=v.fragments,o=4;if(n.length&&t*o>e){const g=n[n.length-1].duration*1e3;g<t&&(t=g)}}else t/=2;return Math.round(t)}function Dc(v,e,t){if(!(v!=null&&v.details))return null;const n=v.details;let o=n.fragments[e-n.startSN];return o||(o=n.fragmentHint,o&&o.sn===e)?o:e<n.startSN&&t&&t.sn===e?t:null}function gs(v,e,t){var n;return v!=null&&v.details?Mo((n=v.details)==null?void 0:n.partList,e,t):null}function Mo(v,e,t){if(v)for(let n=v.length;n--;){const o=v[n];if(o.index===t&&o.fragment.sn===e)return o}return null}function ei(v){switch(v.details){case st.FRAG_LOAD_TIMEOUT:case st.KEY_LOAD_TIMEOUT:case st.LEVEL_LOAD_TIMEOUT:case st.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ms(v,e){const t=ei(e);return v.default[`${t?"timeout":"error"}Retry`]}function Ta(v,e){const t=v.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*v.retryDelayMs,v.maxRetryDelayMs)}function Es(v){return mr(mr({},v),{errorRetry:null,timeoutRetry:null})}function ti(v,e,t,n){return!!v&&e<v.maxNumRetry&&(Ic(n)||!!t)}function Ic(v){return v===0&&navigator.onLine===!1||!!v&&(v<400||v>499)}const Oo={search:function(v,e){let t=0,n=v.length-1,o=null,g=null;for(;t<=n;){o=(t+n)/2|0,g=v[o];const h=e(g);if(h>0)t=o+1;else if(h<0)n=o-1;else return g}return null}};function Cc(v,e,t){if(e===null||!Array.isArray(v)||!v.length||!xt(e))return null;const n=v[0].programDateTime;if(e<(n||0))return null;const o=v[v.length-1].endProgramDateTime;if(e>=(o||0))return null;t=t||0;for(let g=0;g<v.length;++g){const h=v[g];if(Pc(e,t,h))return h}return null}function Pn(v,e,t=0,n=0){let o=null;if(v?o=e[v.sn-e[0].sn+1]||null:t===0&&e[0].start===0&&(o=e[0]),o&&la(t,n,o)===0)return o;const g=Oo.search(e,la.bind(null,t,n));return g&&(g!==v||!o)?g:o}function la(v=0,e=0,t){if(t.start<=v&&t.start+t.duration>v)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=v?1:t.start-n>v&&t.start?-1:0}function Pc(v,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>v}function Mc(v,e){return Oo.search(v,t=>t.cc<e?1:t.cc>e?-1:0)}const Oc=3e5;var hr={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},pr={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class Lc{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=We.log.bind(We,"[info]:"),this.warn=We.warn.bind(We,"[warning]:"),this.error=We.error.bind(We,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(Ee.ERROR,this.onError,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Ee.ERROR,this.onError,this),e.off(Ee.ERROR,this.onErrorOut,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Bt.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onError(e,t){var n;if(t.fatal)return;const o=this.hls,g=t.context;switch(t.details){case st.FRAG_LOAD_ERROR:case st.FRAG_LOAD_TIMEOUT:case st.KEY_LOAD_ERROR:case st.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case st.FRAG_GAP:case st.FRAG_PARSING_ERROR:case st.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=hr.SendAlternateToPenaltyBox;return}case st.LEVEL_EMPTY_ERROR:case st.LEVEL_PARSING_ERROR:{var h,i;const r=t.parent===Bt.MAIN?t.level:o.loadLevel;t.details===st.LEVEL_EMPTY_ERROR&&((h=t.context)!=null&&(i=h.levelDetails)!=null&&i.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,r))}return;case st.LEVEL_LOAD_ERROR:case st.LEVEL_LOAD_TIMEOUT:typeof(g==null?void 0:g.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,g.level));return;case st.AUDIO_TRACK_LOAD_ERROR:case st.AUDIO_TRACK_LOAD_TIMEOUT:case st.SUBTITLE_LOAD_ERROR:case st.SUBTITLE_TRACK_LOAD_TIMEOUT:if(g){const r=o.levels[o.loadLevel];if(r&&(g.type===Xt.AUDIO_TRACK&&g.groupId===r.audioGroupId||g.type===Xt.SUBTITLE_TRACK&&g.groupId===r.textGroupId)){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.loadLevel),t.errorAction.action=hr.SendAlternateToPenaltyBox,t.errorAction.flags=pr.MoveAllAlternatesMatchingHost;return}}return;case st.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const r=o.levels[o.loadLevel],u=r==null?void 0:r.attrs["HDCP-LEVEL"];u&&(t.errorAction={action:hr.SendAlternateToPenaltyBox,flags:pr.MoveAllAlternatesMatchingHDCP,hdcpLevel:u})}return;case st.BUFFER_ADD_CODEC_ERROR:case st.REMUX_ALLOC_ERROR:t.errorAction=this.getLevelSwitchAction(t,(n=t.level)!=null?n:o.loadLevel);return;case st.INTERNAL_EXCEPTION:case st.BUFFER_APPENDING_ERROR:case st.BUFFER_APPEND_ERROR:case st.BUFFER_FULL_ERROR:case st.LEVEL_SWITCH_ERROR:case st.BUFFER_STALLED_ERROR:case st.BUFFER_SEEK_OVER_HOLE:case st.BUFFER_NUDGE_ON_STALL:t.errorAction={action:hr.DoNothing,flags:pr.None};return}if(t.type===Ft.KEY_SYSTEM_ERROR){const r=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,r);return}}getPlaylistRetryOrSwitchAction(e,t){var n,o;const g=this.hls,h=ms(g.config.playlistLoadPolicy,e),i=this.playlistError++,r=(n=e.response)==null?void 0:n.code;return ti(h,i,ei(e),r)?{action:hr.RetryRequest,flags:pr.None,retryConfig:h,retryCount:i}:(o=e.context)!=null&&o.deliveryDirectives?{action:hr.DoNothing,flags:pr.None,retryConfig:h||{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},retryCount:i}:this.getLevelSwitchAction(e,t)}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),o=t.levels[n],{fragLoadPolicy:g,keyLoadPolicy:h}=t.config,i=ms(e.details.startsWith("key")?h:g,e),r=t.levels.reduce((f,d)=>f+d.fragmentError,0);if(o){var u;e.details!==st.FRAG_GAP&&o.fragmentError++;const f=(u=e.response)==null?void 0:u.code;if(ti(i,r,ei(e),f))return{action:hr.RetryRequest,flags:pr.None,retryConfig:i,retryCount:r}}const l=this.getLevelSwitchAction(e,n);return i&&(l.retryConfig=i,l.retryCount=r),l}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const o=this.hls.levels[t];if(o&&(o.loadError++,n.autoLevelEnabled)){var g,h;let i=-1;const r=n.levels,u=(g=e.frag)==null?void 0:g.type,{type:l,groupId:f}=(h=e.context)!=null?h:{};for(let d=r.length;d--;){const _=(d+n.loadLevel)%r.length;if(_!==n.loadLevel&&r[_].loadError===0){const E=r[_];if(e.details===st.FRAG_GAP&&e.frag){const c=r[_].details;if(c){const y=Pn(e.frag,c.fragments,e.frag.start);if(y!=null&&y.gap)continue}}else{if(l===Xt.AUDIO_TRACK&&f===E.audioGroupId||l===Xt.SUBTITLE_TRACK&&f===E.textGroupId)continue;if(u===Bt.AUDIO&&o.audioGroupId===E.audioGroupId||u===Bt.SUBTITLE&&o.textGroupId===E.textGroupId)continue}i=_;break}}if(i>-1&&n.loadLevel!==i)return e.levelRetry=!0,{action:hr.SendAlternateToPenaltyBox,flags:pr.None,nextAutoLevel:i}}return{action:hr.SendAlternateToPenaltyBox,flags:pr.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case hr.DoNothing:break;case hr.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==st.FRAG_GAP&&(t.fatal=!0);break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:o,hdcpLevel:g,nextAutoLevel:h}=n;switch(o){case pr.None:this.switchLevel(e,h);break;case pr.MoveAllAlternatesMatchingHost:n.resolved||(n.resolved=this.redundantFailover(e));break;case pr.MoveAllAlternatesMatchingHDCP:g&&(t.maxHdcpLevel=sa[sa.indexOf(g)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}n.resolved||this.switchLevel(e,h)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){const{hls:t,penalizedRenditions:n}=this,o=e.parent===Bt.MAIN?e.level:t.loadLevel,g=t.levels[o],h=g.url.length,i=e.frag?e.frag.urlId:g.urlId;g.urlId===i&&(!e.frag||g.details)&&this.penalizeRendition(g,e);for(let r=1;r<h;r++){const u=(i+r)%h,l=n[u];if(!l||bc(l,e,n[i]))return this.warn(`Switching to Redundant Stream ${u+1}/${h}: "${g.url[u]}" after ${e.details}`),this.playlistError=0,t.levels.forEach(f=>{f.urlId=u}),t.nextLoadLevel=o,!0}return!1}penalizeRendition(e,t){const{penalizedRenditions:n}=this,o=n[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};o.lastErrorPerfMs=performance.now(),o.errors.push(t),o.details=e.details,n[e.urlId]=o}}function bc(v,e,t){if(performance.now()-v.lastErrorPerfMs>Oc)return!0;const n=v.details;if(e.details===st.FRAG_GAP&&n&&e.frag){const o=e.frag.start,g=Pn(null,n.fragments,o);if(g&&!g.gap)return!0}if(t&&v.errors.length<t.errors.length){const o=v.errors[v.errors.length-1];if(n&&o.frag&&e.frag&&Math.abs(o.frag.start-e.frag.start)>n.targetduration*3)return!0}return!1}class ya{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=We.log.bind(We,`${t}:`),this.warn=We.warn.bind(We,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){const n=t==null?void 0:t.renditionReports;if(n){let o=-1;for(let g=0;g<n.length;g++){const h=n[g];let i;try{i=new self.URL(h.URI,t.url).href}catch(r){We.warn(`Could not construct new URL for Rendition Report: ${r}`),i=h.URI||""}if(i===e){o=g;break}else i===e.substring(0,i.length)&&(o=g)}if(o!==-1){const g=n[o],h=parseInt(g["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let i=parseInt(g["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const r=Math.min(t.age-t.partTarget,t.targetduration);i>=0&&r>t.partTarget&&(i+=1)}return new hs(h,i>=0?i:void 0,Sn.No)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,n){const{details:o,stats:g}=t,h=self.performance.now(),i=g.loading.first?Math.max(0,h-g.loading.first):0;if(o.advancedDateTime=Date.now()-i,o.live||n!=null&&n.live){if(o.reloaded(n),n&&this.log(`live playlist ${e} ${o.advanced?"REFRESHED "+o.lastPartSn+"-"+o.lastPartIndex:"MISSED"}`),n&&o.fragments.length>0&&Tc(n,o),!this.canLoad||!o.live)return;let r,u,l;if(o.canBlockReload&&o.endSN&&o.advanced){const y=this.hls.config.lowLatencyMode,O=o.lastPartSn,P=o.endSN,b=o.lastPartIndex,L=b!==-1,R=O===P,T=y?0:b;L?(u=R?P+1:O,l=R?T:b+1):u=P+1;const m=o.age,M=m+o.ageHeader;let p=Math.min(M-o.partTarget,o.targetduration*1.5);if(p>0){if(n&&p>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${p} with playlist age: ${o.age}`),p=0;else{const C=Math.floor(p/o.targetduration);if(u+=C,l!==void 0){const I=Math.round(p%o.targetduration/o.partTarget);l+=I}this.log(`CDN Tune-in age: ${o.ageHeader}s last advanced ${m.toFixed(2)}s goal: ${p} skip sn ${C} to part ${l}`)}o.tuneInGoal=p}if(r=this.getDeliveryDirectives(o,t.deliveryDirectives,u,l),y||!R){this.loadPlaylist(r);return}}else o.canBlockReload&&(r=this.getDeliveryDirectives(o,t.deliveryDirectives,u,l));const f=this.hls.mainForwardBufferInfo,d=f?f.end-f.len:0,_=(o.edge-d)*1e3,E=Rc(o,_);o.updated&&h>this.requestScheduled+E&&(this.requestScheduled=g.loading.start),u!==void 0&&o.canBlockReload?this.requestScheduled=g.loading.first+E-(o.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+E<h?this.requestScheduled=h:this.requestScheduled-h<=0&&(this.requestScheduled+=E);let c=this.requestScheduled-h;c=Math.max(0,c),this.log(`reload live playlist ${e} in ${Math.round(c)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(r),c)}else this.clearTimer()}getDeliveryDirectives(e,t,n,o){let g=pc(e,n);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,o=t.part,g=Sn.No),new hs(n,o,g)}checkRetry(e){const t=e.details,n=ei(e),o=e.errorAction,{action:g,retryCount:h=0,retryConfig:i}=o||{},r=g===hr.RetryRequest&&!!o&&!!i;if(r){var u;if(this.requestScheduled=-1,n&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${h+1}/${i.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const l=Ta(i,h);this.timer=self.setTimeout(()=>this.loadPlaylist(),l),this.warn(`Retrying playlist loading ${h+1}/${i.maxNumRetry} after "${t}" in ${l}ms`)}e.levelRetry=!0,o.resolved=!0}return r}}let Fi;class xc extends ya{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Ee.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(Ee.FRAG_LOADED,this.onFragLoaded,this),e.on(Ee.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Ee.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(Ee.FRAG_LOADED,this.onFragLoaded,this),e.off(Ee.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=[],o={};let g;t.levels.forEach(h=>{var i;const r=h.attrs;((i=h.audioCodec)==null?void 0:i.indexOf("mp4a.40.34"))!==-1&&(Fi||(Fi=/chrome|firefox/i.test(navigator.userAgent)),Fi&&(h.audioCodec=void 0));const{AUDIO:u,CODECS:l,"FRAME-RATE":f,"PATHWAY-ID":d,RESOLUTION:_,SUBTITLES:E}=r,y=`${`${d||"."}-`}${h.bitrate}-${_}-${f}-${l}`;g=o[y],g?g.addFallback(h):(g=new Cn(h),o[y]=g,n.push(g)),ri(g,"audio",u),ri(g,"text",E)}),this.filterAndSortMediaOptions(n,t)}filterAndSortMediaOptions(e,t){let n=[],o=[],g=!1,h=!1,i=!1,r=e.filter(({audioCodec:_,videoCodec:E,width:c,height:y,unknownCodecs:O})=>(g||(g=!!(c&&y)),h||(h=!!E),i||(i=!!_),!(O!=null&&O.length)&&(!_||Li(_,"audio"))&&(!E||Li(E,"video"))));if((g||h)&&i&&(r=r.filter(({videoCodec:_,width:E,height:c})=>!!_||!!(E&&c))),r.length===0){Promise.resolve().then(()=>{if(this.hls){const _=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:_,reason:_.message})}});return}t.audioTracks&&(n=t.audioTracks.filter(_=>!_.audioCodec||Li(_.audioCodec,"audio")),_s(n)),t.subtitles&&(o=t.subtitles,_s(o));const u=r.slice(0);r.sort((_,E)=>_.attrs["HDCP-LEVEL"]!==E.attrs["HDCP-LEVEL"]?(_.attrs["HDCP-LEVEL"]||"")>(E.attrs["HDCP-LEVEL"]||"")?1:-1:_.bitrate!==E.bitrate?_.bitrate-E.bitrate:_.attrs["FRAME-RATE"]!==E.attrs["FRAME-RATE"]?_.attrs.decimalFloatingPoint("FRAME-RATE")-E.attrs.decimalFloatingPoint("FRAME-RATE"):_.attrs.SCORE!==E.attrs.SCORE?_.attrs.decimalFloatingPoint("SCORE")-E.attrs.decimalFloatingPoint("SCORE"):g&&_.height!==E.height?_.height-E.height:0);let l=u[0];if(this.steering&&(r=this.steering.filterParsedLevels(r),r.length!==u.length)){for(let _=0;_<u.length;_++)if(u[_].pathwayId===r[0].pathwayId){l=u[_];break}}this._levels=r;for(let _=0;_<r.length;_++)if(r[_]===l){this._firstLevel=_,this.log(`manifest loaded, ${r.length} level(s) found, first bitrate: ${l.bitrate}`);break}const f=i&&!h,d={levels:r,audioTracks:n,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:h,altAudio:!f&&n.some(_=>!!_.url)};this.hls.trigger(Ee.MANIFEST_PARSED,d),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const l=new Error("invalid level idx"),f=e<0;if(this.hls.trigger(Ee.ERROR,{type:Ft.OTHER_ERROR,details:st.LEVEL_SWITCH_ERROR,level:e,fatal:f,error:l,reason:l.message}),f)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,o=this.currentLevel,g=o?o.attrs["PATHWAY-ID"]:void 0,h=t[e],i=h.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=h,n===e&&h.details&&o&&g===i)return;this.log(`Switching to level ${e}${i?" with Pathway "+i:""} from level ${n}${g?" with Pathway "+g:""}`);const r=ar({},h,{level:e,maxBitrate:h.maxBitrate,attrs:h.attrs,uri:h.uri,urlId:h.urlId});delete r._attrs,delete r._urlId,this.hls.trigger(Ee.LEVEL_SWITCHING,r);const u=h.details;if(!u||u.live){const l=this.switchParams(h.uri,o==null?void 0:o.details);this.loadPlaylist(l)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this._firstLevel}else return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===Xt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(t!==void 0&&t.type===Bt.MAIN){const n=this._levels[t.level];n!==void 0&&(n.loadError=0)}}onLevelLoaded(e,t){var n;const{level:o,details:g}=t,h=this._levels[o];if(!h){var i;this.warn(`Invalid level index ${o}`),(i=t.deliveryDirectives)!=null&&i.skip&&(g.deltaUpdateFailed=!0);return}o===this.currentLevelIndex?(h.fragmentError===0&&(h.loadError=0),this.playlistLoaded(o,t,h.details)):(n=t.deliveryDirectives)!=null&&n.skip&&(g.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){const n=this.currentLevel;if(!n)return;const o=this.hls.audioTracks[t.id].groupId;if(n.audioGroupIds&&n.audioGroupId!==o){let g=-1;for(let h=0;h<n.audioGroupIds.length;h++)if(n.audioGroupIds[h]===o){g=h;break}g!==-1&&g!==n.urlId&&(n.urlId=g,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){const o=n.urlId;let g=n.uri;if(e)try{g=e.addDirectives(g)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}const h=n.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${h?" Pathway "+h:""} URI ${o+1}/${n.url.length} ${g}`),this.clearTimer(),this.hls.trigger(Ee.LEVEL_LOADING,{url:g,level:t,id:o,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){const n=(g,h)=>h!==t,o=this._levels.filter((g,h)=>h!==e?!0:g.url.length>1&&t!==void 0?(g.url=g.url.filter(n),g.audioGroupIds&&(g.audioGroupIds=g.audioGroupIds.filter(n)),g.textGroupIds&&(g.textGroupIds=g.textGroupIds.filter(n)),g.urlId=0,!0):(this.steering&&this.steering.removeLevel(g),!1));this.hls.trigger(Ee.LEVELS_UPDATED,{levels:o})}onLevelsUpdated(e,{levels:t}){t.forEach((n,o)=>{const{details:g}=n;g!=null&&g.fragments&&g.fragments.forEach(h=>{h.level=o})}),this._levels=t}}function ri(v,e,t){t&&(e==="audio"?(v.audioGroupIds||(v.audioGroupIds=[]),v.audioGroupIds[v.url.length-1]=t):e==="text"&&(v.textGroupIds||(v.textGroupIds=[]),v.textGroupIds[v.url.length-1]=t))}function _s(v){const e={};v.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}var lr={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Nc{constructor(e){this.mainFragEntity=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Ee.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Ee.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Ee.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Ee.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Ee.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.mainFragEntity=this.activeParts=null}getAppendedFrag(e,t){if(t===Bt.MAIN){const{mainFragEntity:n,activeParts:o}=this;if(n){if(n&&o)for(let g=o.length;g--;){const h=o[g],i=h?h.end:n.appendedPTS;if(h.start<=e&&i!==null&&e<=i)return g>9&&(this.activeParts=o.slice(g-9)),h}else if(n.body.start<=e&&n.appendedPTS!==null&&e<=n.appendedPTS)return n.body}}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:n}=this,o=Object.keys(n);for(let g=o.length;g--;){const h=n[o[g]];if((h==null?void 0:h.body.type)===t&&h.buffered){const i=h.body;if(i.start<=e&&e<=i.end)return i}}return null}detectEvictedFragments(e,t,n){this.timeRanges&&(this.timeRanges[e]=t),Object.keys(this.fragments).forEach(o=>{const g=this.fragments[o];if(!g)return;if(!g.buffered&&!g.loaded){g.body.type===n&&this.removeFragment(g.body);return}const h=g.range[e];h&&h.time.some(i=>{const r=!this.isTimeBuffered(i.startPTS,i.endPTS,t);return r&&this.removeFragment(g.body),r})})}detectPartialFragments(e){const t=this.timeRanges,{frag:n,part:o}=e;if(!t||n.sn==="initSegment")return;const g=Hr(n),h=this.fragments[g];h&&(Object.keys(t).forEach(i=>{const r=n.elementaryStreams[i];if(!r)return;const u=t[i],l=o!==null||r.partial===!0;h.range[i]=this.getBufferedTimes(n,o,l,u)}),h.loaded=null,Object.keys(h.range).length?(h.buffered=!0,h.body.endList&&(this.endListFragments[h.body.type]=h)):this.removeFragment(h.body))}fragBuffered(e,t){const n=Hr(e);let o=this.fragments[n];!o&&t&&(o=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),o&&(o.loaded=null,o.buffered=!0)}getBufferedTimes(e,t,n,o){const g={time:[],partial:n},h=t?t.start:e.start,i=t?t.end:e.end,r=e.minEndPTS||i,u=e.maxStartPTS||h;for(let l=0;l<o.length;l++){const f=o.start(l)-this.bufferPadding,d=o.end(l)+this.bufferPadding;if(u>=f&&r<=d){g.time.push({startPTS:Math.max(h,o.start(l)),endPTS:Math.min(i,o.end(l))});break}else if(h<d&&i>f)g.partial=!0,g.time.push({startPTS:Math.max(h,o.start(l)),endPTS:Math.min(i,o.end(l))});else if(i<=f)break}return g}getPartialFragment(e){let t=null,n,o,g,h=0;const{bufferPadding:i,fragments:r}=this;return Object.keys(r).forEach(u=>{const l=r[u];l&&wi(l)&&(o=l.body.start-i,g=l.body.end+i,e>=o&&e<=g&&(n=Math.min(e-o,g-e),h<=n&&(t=l.body,h=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||wi(t))}getState(e){const t=Hr(e),n=this.fragments[t];return n?n.buffered?wi(n)?lr.PARTIAL:lr.OK:lr.APPENDING:lr.NOT_LOADED}isTimeBuffered(e,t,n){let o,g;for(let h=0;h<n.length;h++){if(o=n.start(h)-this.bufferPadding,g=n.end(h)+this.bufferPadding,e>=o&&t<=g)return!0;if(t<=o)return!1}return!1}onFragLoaded(e,t){const{frag:n,part:o}=t;if(n.sn==="initSegment"||n.bitrateTest||o)return;const g=Hr(n);this.fragments[g]={body:n,appendedPTS:null,loaded:t,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:o,timeRanges:g}=t;let h=this.mainFragEntity;if(n.type===Bt.MAIN){const i=h?h.body:null;if(i!==n){h&&i&&i.sn!==n.sn&&(h.buffered=!0,this.fragments[Hr(i)]=h);const r=Hr(n);h=this.mainFragEntity=this.fragments[r]||{body:n,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)}}if(o){let r=this.activeParts;r||(this.activeParts=r=[]),r.push(o)}else this.activeParts=null}this.timeRanges=g,Object.keys(g).forEach(i=>{const r=g[i];if(this.detectEvictedFragments(i,r),!o&&h){const u=n.elementaryStreams[i];if(!u)return;for(let l=0;l<r.length;l++){const f=r.end(l);f<=u.endPTS&&f>u.startPTS?h.appendedPTS=Math.max(f,h.appendedPTS||0):h.appendedPTS=u.endPTS}}})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Hr(e);return!!this.fragments[t]}removeFragmentsInRange(e,t,n,o,g){o&&!this.hasGaps||Object.keys(this.fragments).forEach(h=>{const i=this.fragments[h];if(!i)return;const r=i.body;r.type!==n||o&&!r.gap||r.start<t&&r.end>e&&(i.buffered||g)&&this.removeFragment(r)})}removeFragment(e){const t=Hr(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),this.mainFragEntity===this.fragments[t]&&(this.mainFragEntity=null),delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.mainFragEntity=null,this.activeParts=null,this.hasGaps=!1}}function wi(v){var e,t;return v.buffered&&(v.body.gap||((e=v.range.video)==null?void 0:e.partial)||((t=v.range.audio)==null?void 0:t.partial))}function Hr(v){return`${v.type}_${v.level}_${v.urlId}_${v.sn}`}const vs=Math.pow(2,17);class Fc{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new kr({type:Ft.NETWORK_ERROR,details:st.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const o=this.config,g=o.fLoader,h=o.loader;return new Promise((i,r)=>{if(this.loader&&this.loader.destroy(),e.gap){r(Ts(e));return}const u=this.loader=e.loader=g?new g(o):new h(o),l=ps(e),f=Es(o.fragLoadPolicy.default),d={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:vs};e.stats=u.stats,u.load(l,d,{onSuccess:(_,E,c,y)=>{this.resetLoader(e,u);let O=_.data;c.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(O.slice(0,16)),O=O.slice(16)),i({frag:e,part:null,payload:O,networkDetails:y})},onError:(_,E,c,y)=>{this.resetLoader(e,u),r(new kr({type:Ft.NETWORK_ERROR,details:st.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:mr({url:n,data:void 0},_),error:new Error(`HTTP Error ${_.code} ${_.text}`),networkDetails:c,stats:y}))},onAbort:(_,E,c)=>{this.resetLoader(e,u),r(new kr({type:Ft.NETWORK_ERROR,details:st.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:c,stats:_}))},onTimeout:(_,E,c)=>{this.resetLoader(e,u),r(new kr({type:Ft.NETWORK_ERROR,details:st.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:c,stats:_}))},onProgress:(_,E,c,y)=>{t&&t({frag:e,part:null,payload:c,networkDetails:y})}})})}loadPart(e,t,n){this.abort();const o=this.config,g=o.fLoader,h=o.loader;return new Promise((i,r)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){r(Ts(e,t));return}const u=this.loader=e.loader=g?new g(o):new h(o),l=ps(e,t),f=Es(o.fragLoadPolicy.default),d={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:vs};t.stats=u.stats,u.load(l,d,{onSuccess:(_,E,c,y)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const O={frag:e,part:t,payload:_.data,networkDetails:y};n(O),i(O)},onError:(_,E,c,y)=>{this.resetLoader(e,u),r(new kr({type:Ft.NETWORK_ERROR,details:st.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:mr({url:l.url,data:void 0},_),error:new Error(`HTTP Error ${_.code} ${_.text}`),networkDetails:c,stats:y}))},onAbort:(_,E,c)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),r(new kr({type:Ft.NETWORK_ERROR,details:st.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:c,stats:_}))},onTimeout:(_,E,c)=>{this.resetLoader(e,u),r(new kr({type:Ft.NETWORK_ERROR,details:st.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:c,stats:_}))}})})}updateStatsFromPart(e,t){const n=e.stats,o=t.stats,g=o.total;if(n.loaded+=o.loaded,g){const r=Math.round(e.duration/t.duration),u=Math.min(Math.round(n.loaded/g),r),f=(r-u)*Math.round(n.loaded/u);n.total=n.loaded+f}else n.total=Math.max(n.loaded,n.total);const h=n.loading,i=o.loading;h.start?h.first+=i.first-i.start:(h.start=i.start,h.first=i.first),h.end=i.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function ps(v,e=null){const t=e||v,n={frag:v,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},o=t.byteRangeStartOffset,g=t.byteRangeEndOffset;if(xt(o)&&xt(g)){var h;let i=o,r=g;if(v.sn==="initSegment"&&((h=v.decryptdata)==null?void 0:h.method)==="AES-128"){const u=g-o;u%16&&(r=g+(16-u%16)),o!==0&&(n.resetIV=!0,i=o-16)}n.rangeStart=i,n.rangeEnd=r}return n}function Ts(v,e){const t=new Error(`GAP ${v.gap?"tag":"attribute"} found`),n={type:Ft.MEDIA_ERROR,details:st.FRAG_GAP,fatal:!1,frag:v,error:t,networkDetails:null};return e&&(n.part=e),(e||v).stats.aborted=!0,new kr(n)}class kr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class wc{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.abort()}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=st.KEY_LOAD_ERROR,n,o,g){return new kr({type:Ft.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:g,error:n,networkDetails:o})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:n,cc:o}=e;for(let g=0;g<t.length;g++){const h=t[g];if(o<=h.cc&&(n==="initSegment"||h.sn==="initSegment"||n<h.sn)){this.emeController.selectKeySystemFormat(h).then(i=>{h.setKeyFormat(i)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,o;t&&e.setKeyFormat(t);const g=e.decryptdata;if(!g){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,st.KEY_LOAD_ERROR,u))}const h=g.uri;if(!h)return Promise.reject(this.createKeyLoadError(e,st.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${h}"`)));let i=this.keyUriToKeyInfo[h];if((n=i)!=null&&n.decryptdata.key)return g.key=i.decryptdata.key,Promise.resolve({frag:e,keyInfo:i});if((o=i)!=null&&o.keyLoadPromise){var r;switch((r=i.mediaKeySessionContext)==null?void 0:r.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return i.keyLoadPromise.then(u=>(g.key=u.keyInfo.decryptdata.key,{frag:e,keyInfo:i}))}}switch(i=this.keyUriToKeyInfo[h]={decryptdata:g,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},g.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return g.keyFormat==="identity"?this.loadKeyHTTP(i,e):this.loadKeyEME(i,e);case"AES-128":return this.loadKeyHTTP(i,e);default:return Promise.reject(this.createKeyLoadError(e,st.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${g.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const o=this.emeController.loadKey(n);if(o)return(e.keyLoadPromise=o.then(g=>(e.mediaKeySessionContext=g,n))).catch(g=>{throw e.keyLoadPromise=null,g})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,o=n.loader,g=new o(n);return t.keyLoader=e.loader=g,e.keyLoadPromise=new Promise((h,i)=>{const r={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=n.keyLoadPolicy.default,l={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(d,_,E,c)=>{const{frag:y,keyInfo:O,url:P}=E;if(!y.decryptdata||O!==this.keyUriToKeyInfo[P])return i(this.createKeyLoadError(y,st.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),c));O.decryptdata.key=y.decryptdata.key=new Uint8Array(d.data),y.keyLoader=null,O.loader=null,h({frag:y,keyInfo:O})},onError:(d,_,E,c)=>{this.resetLoader(_),i(this.createKeyLoadError(t,st.KEY_LOAD_ERROR,new Error(`HTTP Error ${d.code} loading key ${d.text}`),E,mr({url:r.url,data:void 0},d)))},onTimeout:(d,_,E)=>{this.resetLoader(_),i(this.createKeyLoadError(t,st.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:(d,_,E)=>{this.resetLoader(_),i(this.createKeyLoadError(t,st.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};g.load(r,l,f)})}resetLoader(e){const{frag:t,keyInfo:n,url:o}=e,g=n.loader;t.keyLoader===g&&(t.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[o],g&&g.destroy()}}class Bc{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const Uc={length:0,start:()=>0,end:()=>0};class qt{static isBuffered(e,t){try{if(e){const n=qt.getBuffered(e);for(let o=0;o<n.length;o++)if(t>=n.start(o)&&t<=n.end(o))return!0}}catch{}return!1}static bufferInfo(e,t,n){try{if(e){const o=qt.getBuffered(e),g=[];let h;for(h=0;h<o.length;h++)g.push({start:o.start(h),end:o.end(h)});return this.bufferedInfo(g,t,n)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.sort(function(u,l){const f=u.start-l.start;return f||l.end-u.end});let o=[];if(n)for(let u=0;u<e.length;u++){const l=o.length;if(l){const f=o[l-1].end;e[u].start-f<n?e[u].end>f&&(o[l-1].end=e[u].end):o.push(e[u])}else o.push(e[u])}else o=e;let g=0,h,i=t,r=t;for(let u=0;u<o.length;u++){const l=o[u].start,f=o[u].end;if(t+n>=l&&t<f)i=l,r=f,g=r-t;else if(t+n<l){h=l;break}}return{len:g,start:i||0,end:r||0,nextStart:h}}static getBuffered(e){try{return e.buffered}catch(t){return We.log("failed to get media.buffered",t),Uc}}}class Aa{constructor(e,t,n,o=0,g=-1,h=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=kn(),this.buffering={audio:kn(),video:kn(),audiovideo:kn()},this.level=e,this.sn=t,this.id=n,this.size=o,this.part=g,this.partial=h}}function kn(){return{start:0,executeStart:0,executeEnd:0,end:0}}function Lo(v,e){let t=null;for(let n=0,o=v.length;n<o;n++){const g=v[n];if(g&&g.cc===e){t=g;break}}return t}function kc(v,e,t){return!!(e.details&&(t.endCC>t.startCC||v&&v.cc<t.startCC))}function Kc(v,e,t=0){const n=v.fragments,o=e.fragments;if(!o.length||!n.length){We.log("No fragments to align");return}const g=Lo(n,o[0].cc);if(!g||g&&!g.startPTS){We.log("No frag in previous level to align on");return}return g}function ys(v,e){if(v){const t=v.start+e;v.start=v.startPTS=t,v.endPTS=t+v.duration}}function Sa(v,e){const t=e.fragments;for(let n=0,o=t.length;n<o;n++)ys(t[n],v);e.fragmentHint&&ys(e.fragmentHint,v),e.alignedSliding=!0}function jc(v,e,t){e&&(Wc(v,t,e),!t.alignedSliding&&e.details&&Gc(t,e.details),!t.alignedSliding&&e.details&&!t.skippedSegments&&Po(e.details,t))}function Wc(v,e,t){if(kc(v,t,e)){const n=Kc(t.details,e);n&&xt(n.start)&&(We.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),Sa(n.start,e))}}function Gc(v,e){if(!e.fragments.length||!v.hasProgramDateTime||!e.hasProgramDateTime)return;const t=e.fragments[0].programDateTime,n=v.fragments[0].programDateTime,o=(n-t)/1e3+e.fragments[0].start;o&&xt(o)&&(We.log(`Adjusting PTS using programDateTime delta ${n-t}ms, sliding:${o.toFixed(3)} ${v.url} `),Sa(o,v))}function bo(v,e){if(!v.hasProgramDateTime||!e.hasProgramDateTime)return;const t=v.fragments,n=e.fragments;if(!t.length||!n.length)return;const o=Math.round(n.length/2)-1,g=n[o],h=Lo(t,g.cc)||t[Math.round(t.length/2)-1],i=g.programDateTime,r=h.programDateTime;if(i===null||r===null)return;const u=(r-i)/1e3-(h.start-g.start);Sa(u,v)}class Hc{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class Vc{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function Yc(v){const e=v.byteLength,t=e&&new DataView(v.buffer).getUint8(e-1);return t?rn(v,0,e-t):v}class zc{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let o=0;o<4;o++)n[o]=t.getUint32(o*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,o=n[0],g=n[1],h=n[2],i=n[3],r=this.invSubMix,u=r[0],l=r[1],f=r[2],d=r[3],_=new Uint32Array(256);let E=0,c=0,y=0;for(y=0;y<256;y++)y<128?_[y]=y<<1:_[y]=y<<1^283;for(y=0;y<256;y++){let O=c^c<<1^c<<2^c<<3^c<<4;O=O>>>8^O&255^99,e[E]=O,t[O]=E;const P=_[E],b=_[P],L=_[b];let R=_[O]*257^O*16843008;o[E]=R<<24|R>>>8,g[E]=R<<16|R>>>16,h[E]=R<<8|R>>>24,i[E]=R,R=L*16843009^b*65537^P*257^E*16843008,u[O]=R<<24|R>>>8,l[O]=R<<16|R>>>16,f[O]=R<<8|R>>>24,d[O]=R,E?(E=P^_[_[_[L^P]]],c^=_[_[c]]):E=c=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,o=0;for(;o<t.length&&n;)n=t[o]===this.key[o],o++;if(n)return;this.key=t;const g=this.keySize=t.length;if(g!==4&&g!==6&&g!==8)throw new Error("Invalid aes key size="+g);const h=this.ksRows=(g+6+1)*4;let i,r;const u=this.keySchedule=new Uint32Array(h),l=this.invKeySchedule=new Uint32Array(h),f=this.sBox,d=this.rcon,_=this.invSubMix,E=_[0],c=_[1],y=_[2],O=_[3];let P,b;for(i=0;i<h;i++){if(i<g){P=u[i]=t[i];continue}b=P,i%g===0?(b=b<<8|b>>>24,b=f[b>>>24]<<24|f[b>>>16&255]<<16|f[b>>>8&255]<<8|f[b&255],b^=d[i/g|0]<<24):g>6&&i%g===4&&(b=f[b>>>24]<<24|f[b>>>16&255]<<16|f[b>>>8&255]<<8|f[b&255]),u[i]=P=(u[i-g]^b)>>>0}for(r=0;r<h;r++)i=h-r,r&3?b=u[i]:b=u[i-4],r<4||i<=4?l[r]=b:l[r]=E[f[b>>>24]]^c[f[b>>>16&255]]^y[f[b>>>8&255]]^O[f[b&255]],l[r]=l[r]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const o=this.keySize+6,g=this.invKeySchedule,h=this.invSBox,i=this.invSubMix,r=i[0],u=i[1],l=i[2],f=i[3],d=this.uint8ArrayToUint32Array_(n);let _=d[0],E=d[1],c=d[2],y=d[3];const O=new Int32Array(e),P=new Int32Array(O.length);let b,L,R,T,m,M,p,C,I,A,S,x,F,k;const j=this.networkToHostOrderSwap;for(;t<O.length;){for(I=j(O[t]),A=j(O[t+1]),S=j(O[t+2]),x=j(O[t+3]),m=I^g[0],M=x^g[1],p=S^g[2],C=A^g[3],F=4,k=1;k<o;k++)b=r[m>>>24]^u[M>>16&255]^l[p>>8&255]^f[C&255]^g[F],L=r[M>>>24]^u[p>>16&255]^l[C>>8&255]^f[m&255]^g[F+1],R=r[p>>>24]^u[C>>16&255]^l[m>>8&255]^f[M&255]^g[F+2],T=r[C>>>24]^u[m>>16&255]^l[M>>8&255]^f[p&255]^g[F+3],m=b,M=L,p=R,C=T,F=F+4;b=h[m>>>24]<<24^h[M>>16&255]<<16^h[p>>8&255]<<8^h[C&255]^g[F],L=h[M>>>24]<<24^h[p>>16&255]<<16^h[C>>8&255]<<8^h[m&255]^g[F+1],R=h[p>>>24]<<24^h[C>>16&255]<<16^h[m>>8&255]<<8^h[M&255]^g[F+2],T=h[C>>>24]<<24^h[m>>16&255]<<16^h[M>>8&255]<<8^h[p&255]^g[F+3],P[t]=j(b^_),P[t+1]=j(T^E),P[t+2]=j(R^c),P[t+3]=j(L^y),_=I,E=A,c=S,y=x,t=t+4}return P.buffer}}const $c=16;class Ra{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Yc(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n){return this.useSoftware?new Promise((o,g)=>{this.softwareDecrypt(new Uint8Array(e),t,n);const h=this.flush();h?o(h.buffer):g(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n)}softwareDecrypt(e,t,n){const{currentIV:o,currentResult:g,remainderData:h}=this;this.logOnce("JS AES decrypt"),h&&(e=nn(h,e),this.remainderData=null);const i=this.getValidChunk(e);if(!i.length)return null;o&&(n=o);let r=this.softwareDecrypter;r||(r=this.softwareDecrypter=new zc),r.expandKey(t);const u=g;return this.currentResult=r.decrypt(i.buffer,0,n),this.currentIV=rn(i,-16).buffer,u||null}webCryptoDecrypt(e,t,n){const o=this.subtle;return(this.key!==t||!this.fastAesKey)&&(this.key=t,this.fastAesKey=new Vc(o,t)),this.fastAesKey.expandKey().then(g=>o?(this.logOnce("WebCrypto AES decrypt"),new Hc(o,new Uint8Array(n)).decrypt(e.buffer,g)):Promise.reject(new Error("web crypto not initialized"))).catch(g=>(We.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${g.name}: ${g.message}`),this.onWebCryptoError(e,t,n)))}onWebCryptoError(e,t,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n);const o=this.flush();if(o)return o.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%$c;return n!==e.length&&(t=rn(e,0,n),this.remainderData=rn(e,n)),t}logOnce(e){this.logEnabled&&(We.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Xc={toString:function(v){let e="";const t=v.length;for(let n=0;n<t;n++)e+=`[${v.start(n).toFixed(3)}-${v.end(n).toFixed(3)}]`;return e}},mt={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Da extends Bc{constructor(e,t,n,o,g){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=mt.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=g,this.logPrefix=o,this.log=We.log.bind(We,`${o}:`),this.warn=We.warn.bind(We,`${o}:`),this.hls=e,this.fragmentLoader=new Fc(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ra(e.config),e.on(Ee.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort();const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=mt.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const n=t.partList;if(n!=null&&n.length){const g=n[n.length-1];return qt.isBuffered(this.media,g.start+g.duration/2)}const o=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levels[this.levelLastLoaded])==null?void 0:e.details}}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);const o=this.config;this.levels&&o.autoStartLoad&&this.state===mt.STOPPED&&this.startLoad(o.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:n,mediaBuffer:o,state:g}=this,h=n?n.currentTime:0,i=qt.bufferInfo(o||n,h,e.maxBufferHole);if(this.log(`media seeking to ${xt(h)?h.toFixed(3):h}, state: ${g}`),this.state===mt.ENDED)this.resetLoadingState();else if(t){const r=e.maxFragLookUpTolerance,u=t.start-r,l=t.start+t.duration+r;if(!i.len||l<i.start||u>i.end){const f=h>l;(h<u||f)&&(f&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests()),this.resetLoadingState())}}n&&(this.fragmentTracker.removeFragmentsInRange(h,1/0,this.playlistType,!0),this.lastCurrentTime=h),!this.loadedmetadata&&!i.len&&(this.nextLoadPosition=this.startPosition=h),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=mt.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const o=g=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${g.part?" p: "+g.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(g)};this._doFragLoad(e,t,n,o).then(g=>{if(!g)return;const h=this.state;if(this.fragContextChanged(e)){(h===mt.FRAG_LOADING||!this.fragCurrent&&h===mt.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=mt.IDLE);return}"payload"in g&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(Ee.FRAG_LOADED,g)),this._handleFragmentLoadComplete(g)}).catch(g=>{this.state===mt.STOPPED||this.state===mt.ERROR||(this.warn(g),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;if(this.fragmentTracker.getState(e)===lr.APPENDING){const o=e.type,g=this.getFwdBufferInfo(this.mediaBuffer,o),h=Math.max(e.duration,g?g.len:this.config.maxBufferLength);this.reduceMaxBufferLength(h)&&this.fragmentTracker.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0&&this.fragmentTracker.removeAllFragments()}flushMainBuffer(e,t,n=null){if(!(e-t))return;const o={startOffset:e,endOffset:t,type:n};this.hls.trigger(Ee.BUFFER_FLUSHING,o)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{if(!n||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:o}=this,{payload:g}=n,h=e.decryptdata;if(g&&g.byteLength>0&&h&&h.key&&h.iv&&h.method==="AES-128"){const i=self.performance.now();return this.decrypter.decrypt(new Uint8Array(g),h.key.buffer,h.iv.buffer).catch(r=>{throw o.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.FRAG_DECRYPT_ERROR,fatal:!1,error:r,reason:r.message,frag:e}),r}).then(r=>{const u=self.performance.now();return o.trigger(Ee.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:i,tdecrypt:u}}),n.payload=r,n})}return n}).then(n=>{const{fragCurrent:o,hls:g,levels:h}=this;if(!h)throw new Error("init load aborted, missing levels");const i=e.stats;this.state=mt.IDLE,t.fragmentError=0,e.data=new Uint8Array(n.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),n.frag===o&&g.trigger(Ee.FRAG_BUFFERED,{stats:i,frag:o,part:null,id:e.type}),this.tick()}).catch(n=>{this.state===mt.STOPPED||this.state===mt.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var n,o,g,h;const i=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level} (frag:[${((n=e.startPTS)!=null?n:NaN).toFixed(3)}-${((o=e.endPTS)!=null?o:NaN).toFixed(3)}] > buffer:${i?Xc.toString(qt.getBuffered(i)):"(detached)"})`),this.state=mt.IDLE,i&&(!this.loadedmetadata&&e.type==Bt.MAIN&&i.buffered.length&&((g=this.fragCurrent)==null?void 0:g.sn)===((h=this.fragPrevious)==null?void 0:h.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:o,partsLoaded:g}=e,h=!g||g.length===0||g.some(r=>!r),i=new Aa(n.level,n.sn,n.stats.chunkCount+1,0,o?o.index:-1,!h);t.flush(i)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,o){var g;const h=t==null?void 0:t.details;if(!this.levels||!h)throw new Error(`frag load aborted, missing level${h?"":" detail"}s`);let i=null;if(e.encrypted&&!((g=e.decryptdata)!=null&&g.key)?(this.log(`Loading key for ${e.sn} of [${h.startSN}-${h.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=mt.KEY_LOADING,this.fragCurrent=e,i=this.keyLoader.load(e).then(l=>{if(!this.fragContextChanged(l.frag))return this.hls.trigger(Ee.KEY_LOADED,l),this.state===mt.KEY_LOADING&&(this.state=mt.IDLE),l}),this.hls.trigger(Ee.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(i=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&h.encryptedFragments.length&&this.keyLoader.loadClear(e,h.encryptedFragments),n=Math.max(e.start,n||0),this.config.lowLatencyMode){const l=h.partList;if(l&&o){n>e.end&&h.fragmentHint&&(e=h.fragmentHint);const f=this.getNextPart(l,e,n);if(f>-1){const d=l[f];this.log(`Loading part sn: ${e.sn} p: ${d.index} cc: ${e.cc} of playlist [${h.startSN}-${h.endSN}] parts [0-${f}-${l.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=d.start+d.duration,this.state=mt.FRAG_LOADING;let _;return i?_=i.then(E=>!E||this.fragContextChanged(E.frag)?null:this.doFragPartsLoad(e,d,t,o)).catch(E=>this.handleFragLoadError(E)):_=this.doFragPartsLoad(e,d,t,o).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(Ee.FRAG_LOADING,{frag:e,part:d,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):_}else if(!e.url||this.loadedEndOfParts(l,n))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${h?"of ["+h.startSN+"-"+h.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),xt(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=mt.FRAG_LOADING;const r=this.config.progressive;let u;return r&&i?u=i.then(l=>!l||this.fragContextChanged(l==null?void 0:l.frag)?null:this.fragmentLoader.load(e,o)).catch(l=>this.handleFragLoadError(l)):u=Promise.all([this.fragmentLoader.load(e,r?o:void 0),i]).then(([l])=>(!r&&l&&o&&o(l),l)).catch(l=>this.handleFragLoadError(l)),this.hls.trigger(Ee.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(e,t,n,o){return new Promise((g,h)=>{var i;const r=[],u=(i=n.details)==null?void 0:i.partList,l=f=>{this.fragmentLoader.loadPart(e,f,o).then(d=>{r[f.index]=d;const _=d.part;this.hls.trigger(Ee.FRAG_LOADED,d);const E=gs(n,e.sn,f.index+1)||Mo(u,e.sn,f.index+1);if(E)l(E);else return g({frag:e,part:_,partsLoaded:r})}).catch(h)};l(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===st.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(Ee.ERROR,t)}else this.hls.trigger(Ee.ERROR,{type:Ft.OTHER_ERROR,details:st.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==mt.PARSING){!this.fragCurrent&&this.state!==mt.STOPPED&&this.state!==mt.ERROR&&(this.state=mt.IDLE);return}const{frag:n,part:o,level:g}=t,h=self.performance.now();n.stats.parsing.end=h,o&&(o.stats.parsing.end=h),this.updateLevelTiming(n,o,g,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:o,sn:g,part:h}=e;if(!(t!=null&&t[o]))return this.warn(`Levels object was unset while buffering fragment ${g} of level ${o}. The current chunk will not be buffered.`),null;const i=t[o],r=h>-1?gs(i,g,h):null,u=r?r.fragment:Dc(i,g,n);return u?(n&&n!==u&&(u.stats=n.stats),{frag:u,part:r,level:i}):null}bufferFragmentData(e,t,n,o){var g;if(!e||this.state!==mt.PARSING)return;const{data1:h,data2:i}=e;let r=h;if(h&&i&&(r=nn(h,i)),!((g=r)!=null&&g.length))return;const u={type:e.type,frag:t,part:n,chunkMeta:o,parent:t.type,data:r};this.hls.trigger(Ee.BUFFER_APPENDING,u),e.dropped&&e.independent&&!n&&this.flushBufferGap(t)}flushBufferGap(e){const t=this.media;if(!t)return;if(!qt.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,o=qt.bufferInfo(t,n,0),g=e.duration,h=Math.min(this.config.maxFragLookUpTolerance*2,g*.25),i=Math.max(Math.min(e.start-h,o.end-h),n+h);e.start-i>h&&this.flushMainBuffer(i,e.start)}getFwdBufferInfo(e,t){const n=this.getLoadPosition();return xt(n)?this.getFwdBufferInfoAtPos(e,n,t):null}getFwdBufferInfoAtPos(e,t,n){const{config:{maxBufferHole:o}}=this,g=qt.bufferInfo(e,t,o);if(g.len===0&&g.nextStart!==void 0){const h=this.fragmentTracker.getBufferedFrag(t,n);if(h&&g.nextStart<h.end)return qt.bufferInfo(e,t,Math.max(g.nextStart,o))}return g}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,n=e||t.maxBufferLength;return t.maxMaxBufferLength>=n?(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0):!1}getNextFragment(e,t){const n=t.fragments,o=n.length;if(!o)return null;const{config:g}=this,h=n[0].start;let i;if(t.live){const r=g.initialLiveManifestSize;if(o<r)return this.warn(`Not enough fragments to start playback (have: ${o}, need: ${r})`),null;!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(i=this.getInitialLiveFragment(t,n),this.startPosition=i?this.hls.liveSyncPosition||i.start:e)}else e<=h&&(i=n[0]);if(!i){const r=g.lowLatencyMode?t.partEnd:t.fragmentEnd;i=this.getFragmentAtPosition(e,r,t)}return this.mapToInitFragWhenRequired(i)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===lr.OK||n===lr.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,o,g){const h=e.gap,i=this.getNextFragment(this.nextLoadPosition,t);if(i===null)return i;if(e=i,h&&e&&!e.gap&&n.nextStart){const r=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,o);if(r!==null&&n.len+r.len>=g)return this.log(`buffer full after gaps in "${o}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let o=-1,g=!1,h=!0;for(let i=0,r=e.length;i<r;i++){const u=e[i];if(h=h&&!u.independent,o>-1&&n<u.start)break;const l=u.loaded;l?o=-1:(g||u.independent||h)&&u.fragment===t&&(o=i),g=l}return o}loadedEndOfParts(e,t){const n=e[e.length-1];return n&&t>n.start&&n.loaded}getInitialLiveFragment(e,t){const n=this.fragPrevious;let o=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),o=Cc(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!o){const g=n.sn+1;if(g>=e.startSN&&g<=e.endSN){const h=t[g-e.startSN];n.cc===h.cc&&(o=h,this.log(`Live playlist, switching playlist, load frag with next SN: ${o.sn}`))}o||(o=Mc(t,n.cc),o&&this.log(`Live playlist, switching playlist, load frag with same CC: ${o.sn}`))}}else{const g=this.hls.liveSyncPosition;g!==null&&(o=this.getFragmentAtPosition(g,this.bitrateTest?e.fragmentEnd:e.edge,e))}return o}getFragmentAtPosition(e,t,n){const{config:o}=this;let{fragPrevious:g}=this,{fragments:h,endSN:i}=n;const{fragmentHint:r}=n,u=o.maxFragLookUpTolerance,l=!!(o.lowLatencyMode&&n.partList&&r);l&&r&&!this.bitrateTest&&(h=h.concat(r),i=r.sn);let f;if(e<t){const d=e>t-u?0:u;f=Pn(g,h,e,d)}else f=h[h.length-1];if(f){const d=f.sn-n.startSN,_=this.fragmentTracker.getState(f);if((_===lr.OK||_===lr.PARTIAL&&f.gap)&&(g=f),g&&f.sn===g.sn&&!l&&g&&f.level===g.level){const c=h[d+1];f.sn<i&&this.fragmentTracker.getState(c)!==lr.OK?f=c:f=null}}return f}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const o=this.hls.liveSyncPosition,g=n.currentTime,h=e.fragments[0].start,i=e.edge,r=g>=h-t.maxFragLookUpTolerance&&g<=i;if(o!==null&&n.duration>o&&(g<o||!r)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!r&&n.readyState<4||g<i-u)&&(this.loadedmetadata||(this.nextLoadPosition=o),n.readyState&&(this.warn(`Playback: ${g.toFixed(3)} is located too far from the end of live sliding playlist: ${i}, reset currentTime to : ${o.toFixed(3)}`),n.currentTime=o))}}alignPlaylists(e,t){const{levels:n,levelLastLoaded:o,fragPrevious:g}=this,h=o!==null?n[o]:null,i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragments[0].start,u=!t,l=e.alignedSliding&&xt(r);if(u||!l&&!r){jc(g,h,e);const f=e.fragments[0].start;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${g?g.sn:"na"} fragments: ${i}`),f}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;if(n<t&&(n=-1),n===-1||this.lastCurrentTime===-1){const o=this.startTimeOffset!==null,g=o?this.startTimeOffset:e.startTimeOffset;g!==null&&xt(g)?(n=t+g,g<0&&(n+=e.totalduration),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Start time offset ${g} found in ${o?"multivariant":"media"} playlist, adjust startPosition to ${n}`),this.startPosition=n):e.live?n=this.hls.liveSyncPosition||t:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part"+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==mt.FRAG_LOADING_WAITING_RETRY)&&(this.state=mt.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const l=this.getCurrentContext(t.chunkMeta);l&&(t.frag=l.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var o;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(o=this.fragCurrent)==null?void 0:o.url}`);return}const g=t.details===st.FRAG_GAP;g&&this.fragmentTracker.fragBuffered(n,!0);const h=t.errorAction,{action:i,retryCount:r=0,retryConfig:u}=h||{};if(h&&i===hr.RetryRequest&&u){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);const l=Ta(u,r);this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${r+1}/${u.maxNumRetry} in ${l}ms`),h.resolved=!0,this.retryDate=self.performance.now()+l,this.state=mt.FRAG_LOADING_WAITING_RETRY}else u&&h?(this.resetFragmentErrors(e),r<u.maxNumRetry?g||(h.resolved=!0):We.warn(`${t.details} reached or exceeded max retry (${r})`)):this.state=mt.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===mt.PARSING||this.state===mt.PARSED){const t=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,t),o=n&&n.len>.5;o&&this.reduceMaxBufferLength(n.len);const g=!o;return g&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),g}return!1}resetFragmentErrors(e){e===Bt.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==mt.STOPPED&&(this.state=mt.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const o=qt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,o,n),this.state===mt.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=mt.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=this.levels?this.levels[e].details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,o){var g;const h=n.details;if(!h){this.warn("level.details undefined");return}if(Object.keys(e.elementaryStreams).reduce((r,u)=>{const l=e.elementaryStreams[u];if(l){const f=l.endPTS-l.startPTS;if(f<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${f})`),r||!1;const d=o?0:Co(h,e,l.startPTS,l.endPTS,l.startDTS,l.endDTS);return this.hls.trigger(Ee.LEVEL_PTS_UPDATED,{details:h,level:n,drift:d,type:u,frag:e,start:l.startPTS,end:l.endPTS}),!0}return r},!1))n.fragmentError=0;else if(((g=this.transmuxer)==null?void 0:g.error)===null){const r=new Error(`Found no media in fragment ${e.sn} of level ${n.id} resetting transmuxer to fallback to playlist timing`);if(this.warn(r.message),this.hls.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,fatal:!1,error:r,frag:e,reason:`Found no media in msn ${e.sn} of level "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=mt.PARSED,this.hls.trigger(Ee.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.resetTransmuxer(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Ia(){if(!(typeof self>"u"))return self.MediaSource||self.WebKitMediaSource}function xo(){return self.SourceBuffer||self.WebKitSourceBuffer}function Qc(){const v=Ia();if(!v)return!1;const e=xo(),t=v&&typeof v.isTypeSupported=="function"&&v.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function";return!!t&&!!n}function Jc(){var v;const e=xo();return typeof(e==null||(v=e.prototype)==null?void 0:v.changeType)=="function"}function Zc(){return typeof __HLS_WORKER_BUNDLE__=="function"}function qc(){const v=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(v);return{worker:new self.Worker(e),objectURL:e}}function ed(v){const e=new self.URL(v,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function Or(v="",e=9e4){return{type:v,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class No{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,o){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=nn(this.cachedData,e),this.cachedData=null);let n=Zn(e,0),o=n?n.length:0,g;const h=this._audioTrack,i=this._id3Track,r=n?wf(n):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&xt(r))&&(this.basePTS=td(r,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&i.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Sr.audioId3,duration:Number.POSITIVE_INFINITY});o<u;){if(this.canParse(e,o)){const l=this.appendFrame(h,e,o);l?(this.frameIndex++,this.lastPTS=l.sample.pts,o+=l.length,g=o):o=u}else Ff(e,o)?(n=Zn(e,o),i.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Sr.audioId3,duration:Number.POSITIVE_INFINITY}),o+=n.length,g=o):o++;if(o===u&&g!==u){const l=rn(e,g);this.cachedData?this.cachedData=nn(this.cachedData,l):this.cachedData=l}}return{audioTrack:h,videoTrack:Or(),id3Track:i,textTrack:Or()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Or(),id3Track:this._id3Track,textTrack:Or()}}destroy(){}}const td=(v,e,t)=>{if(xt(v))return v*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};function rd(v,e,t,n){let o,g,h,i;const r=navigator.userAgent.toLowerCase(),u=n,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=((e[t+2]&192)>>>6)+1;const f=(e[t+2]&60)>>>2;if(f>l.length-1){v.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${f}`});return}return h=(e[t+2]&1)<<2,h|=(e[t+3]&192)>>>6,We.log(`manifest codec:${n}, ADTS type:${o}, samplingIndex:${f}`),/firefox/i.test(r)?f>=6?(o=5,i=new Array(4),g=f-3):(o=2,i=new Array(2),g=f):r.indexOf("android")!==-1?(o=2,i=new Array(2),g=f):(o=5,i=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&f>=6?g=f-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(f>=6&&h===1||/vivaldi/i.test(r))||!n&&h===1)&&(o=2,i=new Array(2)),g=f)),i[0]=o<<3,i[0]|=(f&14)>>1,i[1]|=(f&1)<<7,i[1]|=h<<3,o===5&&(i[1]|=(g&14)>>1,i[2]=(g&1)<<7,i[2]|=2<<2,i[3]=0),{config:i,samplerate:l[f],channelCount:h,codec:"mp4a.40."+o,manifestCodec:u}}function Fo(v,e){return v[e]===255&&(v[e+1]&246)===240}function wo(v,e){return v[e+1]&1?7:9}function Ca(v,e){return(v[e+3]&3)<<11|v[e+4]<<3|(v[e+5]&224)>>>5}function nd(v,e){return e+5<v.length}function ni(v,e){return e+1<v.length&&Fo(v,e)}function id(v,e){return nd(v,e)&&Fo(v,e)&&Ca(v,e)<=v.length-e}function ad(v,e){if(ni(v,e)){const t=wo(v,e);if(e+t>=v.length)return!1;const n=Ca(v,e);if(n<=t)return!1;const o=e+n;return o===v.length||ni(v,o)}return!1}function Bo(v,e,t,n,o){if(!v.samplerate){const g=rd(e,t,n,o);if(!g)return;v.config=g.config,v.samplerate=g.samplerate,v.channelCount=g.channelCount,v.codec=g.codec,v.manifestCodec=g.manifestCodec,We.log(`parsed codec:${v.codec}, rate:${g.samplerate}, channels:${g.channelCount}`)}}function Uo(v){return 1024*9e4/v}function sd(v,e){const t=wo(v,e);if(e+t<=v.length){const n=Ca(v,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function ko(v,e,t,n,o){const g=Uo(v.samplerate),h=n+o*g,i=sd(e,t);let r;if(i){const{frameLength:f,headerLength:d}=i,_=d+f,E=Math.max(0,t+_-e.length);E?(r=new Uint8Array(_-d),r.set(e.subarray(t+d,e.length),0)):r=e.subarray(t+d,t+_);const c={unit:r,pts:h};return E||v.samples.push(c),{sample:c,length:_,missing:E}}const u=e.length-t;return r=new Uint8Array(u),r.set(e.subarray(t,e.length),0),{sample:{unit:r,pts:h},length:u,missing:-1}}class od extends No{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,o){super.resetInitSegment(e,t,n,o),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:o,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let n=(Zn(e,0)||[]).length;for(let o=e.length;n<o;n++)if(ad(e,n))return We.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return id(e,t)}appendFrame(e,t,n){Bo(e,this.observer,t,n,e.manifestCodec);const o=ko(e,t,n,this.basePTS,this.frameIndex);if(o&&o.missing===0)return o}}const ld=/\/emsg[-/]ID3/i;class ud{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,o){const g=this.videoTrack=Or("video",1),h=this.audioTrack=Or("audio",1),i=this.txtTrack=Or("text",1);if(this.id3Track=Or("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const r=To(e);if(r.video){const{id:u,timescale:l,codec:f}=r.video;g.id=u,g.timescale=i.timescale=l,g.codec=f}if(r.audio){const{id:u,timescale:l,codec:f}=r.audio;h.id=u,h.timescale=l,h.codec=f}i.id=_o.text,g.sampleDuration=0,g.duration=h.duration=o}resetContiguity(){}static probe(e){return e=e.length>16384?e.subarray(0,16384):e,$t(e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let n=e;const o=this.videoTrack,g=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=nn(this.remainderData,e));const i=Jf(n);this.remainderData=i.remainder,o.samples=i.valid||new Uint8Array}else o.samples=n;const h=this.extractID3Track(o,t);return g.samples=es(t,o),{videoTrack:o,audioTrack:this.audioTrack,id3Track:h,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const o=this.extractID3Track(t,this.timeOffset);return n.samples=es(e,t),{videoTrack:t,audioTrack:Or(),id3Track:o,textTrack:Or()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const o=$t(e.samples,["emsg"]);o&&o.forEach(g=>{const h=ec(g);if(ld.test(h.schemeIdUri)){const i=xt(h.presentationTime)?h.presentationTime/h.timeScale:t+h.presentationTimeDelta/h.timeScale;let r=h.eventDuration===4294967295?Number.POSITIVE_INFINITY:h.eventDuration/h.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const u=h.payload;n.samples.push({data:u,len:u.byteLength,dts:i,pts:i,type:Sr.emsg,duration:r})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}let Kn=null;const fd=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],cd=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],dd=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],hd=[0,1,1,4];function Ko(v,e,t,n,o){if(t+24>e.length)return;const g=jo(e,t);if(g&&t+g.frameLength<=e.length){const h=g.samplesPerFrame*9e4/g.sampleRate,i=n+o*h,r={unit:e.subarray(t,t+g.frameLength),pts:i,dts:i};return v.config=[],v.channelCount=g.channelCount,v.samplerate=g.sampleRate,v.samples.push(r),{sample:r,length:g.frameLength,missing:0}}}function jo(v,e){const t=v[e+1]>>3&3,n=v[e+1]>>1&3,o=v[e+2]>>4&15,g=v[e+2]>>2&3;if(t!==1&&o!==0&&o!==15&&g!==3){const h=v[e+2]>>1&1,i=v[e+3]>>6,r=t===3?3-n:n===3?3:4,u=fd[r*14+o-1]*1e3,f=cd[(t===3?0:t===2?1:2)*3+g],d=i===3?1:2,_=dd[t][n],E=hd[n],c=_*8*E,y=Math.floor(_*u/f+h)*E;if(Kn===null){const b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Kn=b?parseInt(b[1]):0}return!!Kn&&Kn<=87&&n===2&&u>=224e3&&i===0&&(v[e+3]=v[e+3]|128),{sampleRate:f,channelCount:d,frameLength:y,samplesPerFrame:c}}}function Pa(v,e){return v[e]===255&&(v[e+1]&224)===224&&(v[e+1]&6)!==0}function Wo(v,e){return e+1<v.length&&Pa(v,e)}function gd(v,e){return Pa(v,e)&&4<=v.length-e}function md(v,e){if(e+1<v.length&&Pa(v,e)){const n=jo(v,e);let o=4;n!=null&&n.frameLength&&(o=n.frameLength);const g=e+o;return g===v.length||Wo(v,g)}return!1}class As{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,o=new Uint8Array(4),g=Math.min(4,t);if(g===0)throw new Error("no bytes available");o.set(e.subarray(n,n+g)),this.word=new DataView(o.buffer).getUint32(0),this.bitsAvailable=g*8,this.bytesAvailable-=g}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&We.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,n=8,o;for(let g=0;g<e;g++)n!==0&&(o=this.readEG(),n=(t+o+256)%256),t=n===0?t:n}readSPS(){let e=0,t=0,n=0,o=0,g,h,i;const r=this.readUByte.bind(this),u=this.readBits.bind(this),l=this.readUEG.bind(this),f=this.readBoolean.bind(this),d=this.skipBits.bind(this),_=this.skipEG.bind(this),E=this.skipUEG.bind(this),c=this.skipScalingList.bind(this);r();const y=r();if(u(5),d(3),r(),E(),y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128){const T=l();if(T===3&&d(1),E(),E(),d(1),f())for(h=T!==3?8:12,i=0;i<h;i++)f()&&(i<6?c(16):c(64))}E();const O=l();if(O===0)l();else if(O===1)for(d(1),_(),_(),g=l(),i=0;i<g;i++)_();E(),d(1);const P=l(),b=l(),L=u(1);L===0&&d(1),d(1),f()&&(e=l(),t=l(),n=l(),o=l());let R=[1,1];if(f()&&f())switch(r()){case 1:R=[1,1];break;case 2:R=[12,11];break;case 3:R=[10,11];break;case 4:R=[16,11];break;case 5:R=[40,33];break;case 6:R=[24,11];break;case 7:R=[20,11];break;case 8:R=[32,11];break;case 9:R=[80,33];break;case 10:R=[18,11];break;case 11:R=[15,11];break;case 12:R=[64,33];break;case 13:R=[160,99];break;case 14:R=[4,3];break;case 15:R=[3,2];break;case 16:R=[2,1];break;case 255:{R=[r()<<8|r(),r()<<8|r()];break}}return{width:Math.ceil((P+1)*16-e*2-t*2),height:(2-L)*(b+1)*16-(L?2:4)*(n+o),pixelRatio:R}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Ed{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Ra(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,n){const o=e[t].unit;if(o.length<=16)return;const g=o.subarray(16,o.length-o.length%16),h=g.buffer.slice(g.byteOffset,g.byteOffset+g.length);this.decryptBuffer(h).then(i=>{const r=new Uint8Array(i);o.set(r,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)})}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let o=0;for(let g=32;g<e.length-16;g+=160,o+=16)n.set(e.subarray(g,g+16),o);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let o=0;for(let g=32;g<e.length-16;g+=160,o+=16)e.set(n.subarray(o,o+16),g);return e}decryptAvcSample(e,t,n,o,g){const h=So(g.data),i=this.getAvcEncryptedData(h);this.decryptBuffer(i.buffer).then(r=>{g.data=this.getAvcDecryptedUnit(h,r),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,o)})}decryptAvcSamples(e,t,n,o){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){o();return}const g=e[t].units;for(;!(n>=g.length);n++){const h=g[n];if(!(h.data.length<=48||h.type!==1&&h.type!==5)&&(this.decryptAvcSample(e,t,n,o,h),!this.decrypter.isSync()))return}}}}const fr=188;class Yr{constructor(e,t,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=n}static probe(e){const t=Yr.syncOffset(e);return t>0&&We.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){const t=e.length,n=Math.min(fr*5,e.length-fr)+1;let o=0;for(;o<n;){let g=!1;for(let h=o;h<t&&e[h]===71;h+=fr)if(!g&&ua(e,h)===0&&(g=!0),g&&h+fr>n)return o;o++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:_o[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,o){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=Yr.createTrack("video"),this._audioTrack=Yr.createTrack("audio",o),this._id3Track=Yr.createTrack("id3"),this._txtTrack=Yr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n,this._duration=o}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_avcTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,n=!1,o=!1){n||(this.sampleAes=null);let g;const h=this._avcTrack,i=this._audioTrack,r=this._id3Track,u=this._txtTrack;let l=h.pid,f=h.pesData,d=i.pid,_=r.pid,E=i.pesData,c=r.pesData,y=null,O=this.pmtParsed,P=this._pmtId,b=e.length;if(this.remainderData&&(e=nn(this.remainderData,e),b=e.length,this.remainderData=null),b<fr&&!o)return this.remainderData=e,{audioTrack:i,videoTrack:h,id3Track:r,textTrack:u};const L=Math.max(0,Yr.syncOffset(e));b-=(b-L)%fr,b<e.byteLength&&!o&&(this.remainderData=new Uint8Array(e.buffer,b,e.buffer.byteLength-b));let R=0;for(let m=L;m<b;m+=fr)if(e[m]===71){const M=!!(e[m+1]&64),p=ua(e,m),C=(e[m+3]&48)>>4;let I;if(C>1){if(I=m+5+e[m+4],I===m+fr)continue}else I=m+4;switch(p){case l:M&&(f&&(g=ln(f))&&this.parseAVCPES(h,u,g,!1),f={data:[],size:0}),f&&(f.data.push(e.subarray(I,m+fr)),f.size+=m+fr-I);break;case d:if(M){if(E&&(g=ln(E)))switch(i.segmentCodec){case"aac":this.parseAACPES(i,g);break;case"mp3":this.parseMPEGPES(i,g);break}E={data:[],size:0}}E&&(E.data.push(e.subarray(I,m+fr)),E.size+=m+fr-I);break;case _:M&&(c&&(g=ln(c))&&this.parseID3PES(r,g),c={data:[],size:0}),c&&(c.data.push(e.subarray(I,m+fr)),c.size+=m+fr-I);break;case 0:M&&(I+=e[I]+1),P=this._pmtId=_d(e,I);break;case P:{M&&(I+=e[I]+1);const A=vd(e,I,this.typeSupported,n);l=A.avc,l>0&&(h.pid=l),d=A.audio,d>0&&(i.pid=d,i.segmentCodec=A.segmentCodec),_=A.id3,_>0&&(r.pid=_),y!==null&&!O&&(We.warn(`MPEG-TS PMT found at ${m} after unknown PID '${y}'. Backtracking to sync byte @${L} to parse all TS packets.`),y=null,m=L-188),O=this.pmtParsed=!0;break}case 17:case 8191:break;default:y=p;break}}else R++;if(R>0){const m=new Error(`Found ${R} TS packet/s that do not start with 0x47`);this.observer.emit(Ee.ERROR,Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,fatal:!1,error:m,reason:m.message})}h.pesData=f,i.pesData=E,r.pesData=c;const T={audioTrack:i,videoTrack:h,id3Track:r,textTrack:u};return o&&this.extractRemainingSamples(T),T}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:o,textTrack:g}=e,h=n.pesData,i=t.pesData,r=o.pesData;let u;if(h&&(u=ln(h))?(this.parseAVCPES(n,g,u,!0),n.pesData=null):n.pesData=h,i&&(u=ln(i))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break}t.pesData=null}else i!=null&&i.size&&We.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=i;r&&(u=ln(r))?(this.parseID3PES(o,u),o.pesData=null):o.pesData=r}demuxSampleAes(e,t,n){const o=this.demux(e,n,!0,!this.config.progressive),g=this.sampleAes=new Ed(this.observer,this.config,t);return this.decrypt(o,g)}decrypt(e,t){return new Promise(n=>{const{audioTrack:o,videoTrack:g}=e;o.samples&&o.segmentCodec==="aac"?t.decryptAacSamples(o.samples,0,()=>{g.samples?t.decryptAvcSamples(g.samples,0,0,()=>{n(e)}):n(e)}):g.samples&&t.decryptAvcSamples(g.samples,0,0,()=>{n(e)})})}destroy(){this._duration=0}parseAVCPES(e,t,n,o){const g=this.parseAVCNALu(e,n.data);let h=this.avcSample,i,r=!1;n.data=null,h&&g.length&&!e.audFound&&(Bi(h,e),h=this.avcSample=jn(!1,n.pts,n.dts,"")),g.forEach(u=>{switch(u.type){case 1:{i=!0,h||(h=this.avcSample=jn(!0,n.pts,n.dts,"")),h.frame=!0;const l=u.data;if(r&&l.length>4){const f=new As(l).readSliceType();(f===2||f===4||f===7||f===9)&&(h.key=!0)}break}case 5:i=!0,h||(h=this.avcSample=jn(!0,n.pts,n.dts,"")),h.key=!0,h.frame=!0;break;case 6:{i=!0,Ao(u.data,1,n.pts,t.samples);break}case 7:if(i=!0,r=!0,!e.sps){const l=u.data,d=new As(l).readSPS();e.width=d.width,e.height=d.height,e.pixelRatio=d.pixelRatio,e.sps=[l],e.duration=this._duration;const _=l.subarray(1,4);let E="avc1.";for(let c=0;c<3;c++){let y=_[c].toString(16);y.length<2&&(y="0"+y),E+=y}e.codec=E}break;case 8:i=!0,e.pps||(e.pps=[u.data]);break;case 9:i=!1,e.audFound=!0,h&&Bi(h,e),h=this.avcSample=jn(!1,n.pts,n.dts,"");break;case 12:i=!0;break;default:i=!1,h&&(h.debug+="unknown NAL "+u.type+" ");break}h&&i&&h.units.push(u)}),o&&h&&(Bi(h,e),this.avcSample=null)}getLastNalUnit(e){var t;let n=this.avcSample,o;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const g=n.units;o=g[g.length-1]}return o}parseAVCNALu(e,t){const n=t.byteLength;let o=e.naluState||0;const g=o,h=[];let i=0,r,u,l,f=-1,d=0;for(o===-1&&(f=0,d=t[0]&31,o=0,i=1);i<n;){if(r=t[i++],!o){o=r?0:1;continue}if(o===1){o=r?0:2;continue}if(!r)o=3;else if(r===1){if(f>=0){const _={data:t.subarray(f,i-o-1),type:d};h.push(_)}else{const _=this.getLastNalUnit(e.samples);if(_&&(g&&i<=4-g&&_.state&&(_.data=_.data.subarray(0,_.data.byteLength-g)),u=i-o-1,u>0)){const E=new Uint8Array(_.data.byteLength+u);E.set(_.data,0),E.set(t.subarray(0,u),_.data.byteLength),_.data=E,_.state=0}}i<n?(l=t[i]&31,f=i,d=l,o=0):o=-1}else o=0}if(f>=0&&o>=0){const _={data:t.subarray(f,n),type:d,state:o};h.push(_)}if(h.length===0){const _=this.getLastNalUnit(e.samples);if(_){const E=new Uint8Array(_.data.byteLength+t.byteLength);E.set(_.data,0),E.set(t,_.data.byteLength),_.data=E}}return e.naluState=o,h}parseAACPES(e,t){let n=0;const o=this.aacOverFlow;let g=t.data;if(o){this.aacOverFlow=null;const f=o.missing,d=o.sample.unit.byteLength;if(f===-1){const _=new Uint8Array(d+g.byteLength);_.set(o.sample.unit,0),_.set(g,d),g=_}else{const _=d-f;o.sample.unit.set(g.subarray(0,f),_),e.samples.push(o.sample),n=o.missing}}let h,i;for(h=n,i=g.length;h<i-1&&!ni(g,h);h++);if(h!==n){let f;const d=h<i-1;d?f=`AAC PES did not start with ADTS header,offset:${h}`:f="No ADTS header found in AAC PES";const _=new Error(f);if(We.warn(`parsing error: ${f}`),this.observer.emit(Ee.ERROR,Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,fatal:!1,levelRetry:d,error:_,reason:f}),!d)return}Bo(e,this.observer,g,h,this.audioCodec);let r;if(t.pts!==void 0)r=t.pts;else if(o){const f=Uo(e.samplerate);r=o.sample.pts+f}else{We.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,l;for(;h<i;)if(l=ko(e,g,h,r,u),h+=l.length,l.missing){this.aacOverFlow=l;break}else for(u++;h<i-1&&!ni(g,h);h++);}parseMPEGPES(e,t){const n=t.data,o=n.length;let g=0,h=0;const i=t.pts;if(i===void 0){We.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;h<o;)if(Wo(n,h)){const r=Ko(e,n,h,i,g);if(r)h+=r.length,g++;else break}else h++}parseID3PES(e,t){if(t.pts===void 0){We.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=ar({},t,{type:this._avcTrack?Sr.emsg:Sr.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function jn(v,e,t,n){return{key:v,frame:!1,pts:e,dts:t,units:[],debug:n,length:0}}function ua(v,e){return((v[e+1]&31)<<8)+v[e+2]}function _d(v,e){return(v[e+10]&31)<<8|v[e+11]}function vd(v,e,t,n){const o={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},g=(v[e+1]&15)<<8|v[e+2],h=e+3+g-4,i=(v[e+10]&15)<<8|v[e+11];for(e+=12+i;e<h;){const r=ua(v,e);switch(v[e]){case 207:if(!n){We.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:o.audio===-1&&(o.audio=r);break;case 21:o.id3===-1&&(o.id3=r);break;case 219:if(!n){We.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:o.avc===-1&&(o.avc=r);break;case 3:case 4:t.mpeg!==!0&&t.mp3!==!0?We.log("MPEG audio found, not supported in this browser"):o.audio===-1&&(o.audio=r,o.segmentCodec="mp3");break;case 36:We.warn("Unsupported HEVC stream type found");break}e+=((v[e+3]&15)<<8|v[e+4])+5}return o}function ln(v){let e=0,t,n,o,g,h;const i=v.data;if(!v||v.size===0)return null;for(;i[0].length<19&&i.length>1;){const u=new Uint8Array(i[0].length+i[1].length);u.set(i[0]),u.set(i[1],i[0].length),i[0]=u,i.splice(1,1)}if(t=i[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(n=(t[4]<<8)+t[5],n&&n>v.size-6)return null;const u=t[7];u&192&&(g=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,u&64?(h=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,g-h>60*9e4&&(We.warn(`${Math.round((g-h)/9e4)}s delta between PTS and DTS, align them`),g=h)):h=g),o=t[8];let l=o+9;if(v.size<=l)return null;v.size-=l;const f=new Uint8Array(v.size);for(let d=0,_=i.length;d<_;d++){t=i[d];let E=t.byteLength;if(l)if(l>E){l-=E;continue}else t=t.subarray(l),E-=l,l=0;f.set(t,e),e+=E}return n&&(n-=o+3),{data:f,pts:g,dts:h,len:n}}return null}function Bi(v,e){if(v.units.length&&v.frame){if(v.pts===void 0){const t=e.samples,n=t.length;if(n){const o=t[n-1];v.pts=o.pts,v.dts=o.dts}else{e.dropped++;return}}e.samples.push(v)}v.debug.length&&We.log(v.pts+"/"+v.dts+":"+v.debug)}class pd extends No{resetInitSegment(e,t,n,o){super.resetInitSegment(e,t,n,o),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:o,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let n=(Zn(e,0)||[]).length;for(let o=e.length;n<o;n++)if(md(e,n))return We.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return gd(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return Ko(e,t,n,this.basePTS,this.frameIndex)}}class Ss{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Vr=Math.pow(2,32)-1;class Qe{static init(){Qe.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in Qe.types)Qe.types.hasOwnProperty(e)&&(Qe.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Qe.HDLR_TYPES={video:t,audio:n};const o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),g=new Uint8Array([0,0,0,0,0,0,0,0]);Qe.STTS=Qe.STSC=Qe.STCO=g,Qe.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Qe.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Qe.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Qe.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const h=new Uint8Array([105,115,111,109]),i=new Uint8Array([97,118,99,49]),r=new Uint8Array([0,0,0,1]);Qe.FTYP=Qe.box(Qe.types.ftyp,h,r,h,i),Qe.DINF=Qe.box(Qe.types.dinf,Qe.box(Qe.types.dref,o))}static box(e,...t){let n=8,o=t.length;const g=o;for(;o--;)n+=t[o].byteLength;const h=new Uint8Array(n);for(h[0]=n>>24&255,h[1]=n>>16&255,h[2]=n>>8&255,h[3]=n&255,h.set(e,4),o=0,n=8;o<g;o++)h.set(t[o],n),n+=t[o].byteLength;return h}static hdlr(e){return Qe.box(Qe.types.hdlr,Qe.HDLR_TYPES[e])}static mdat(e){return Qe.box(Qe.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Vr+1)),o=Math.floor(t%(Vr+1));return Qe.box(Qe.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,o>>24,o>>16&255,o>>8&255,o&255,85,196,0,0]))}static mdia(e){return Qe.box(Qe.types.mdia,Qe.mdhd(e.timescale,e.duration),Qe.hdlr(e.type),Qe.minf(e))}static mfhd(e){return Qe.box(Qe.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?Qe.box(Qe.types.minf,Qe.box(Qe.types.smhd,Qe.SMHD),Qe.DINF,Qe.stbl(e)):Qe.box(Qe.types.minf,Qe.box(Qe.types.vmhd,Qe.VMHD),Qe.DINF,Qe.stbl(e))}static moof(e,t,n){return Qe.box(Qe.types.moof,Qe.mfhd(e),Qe.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=Qe.trak(e[t]);return Qe.box.apply(null,[Qe.types.moov,Qe.mvhd(e[0].timescale,e[0].duration)].concat(n).concat(Qe.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=Qe.trex(e[t]);return Qe.box.apply(null,[Qe.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Vr+1)),o=Math.floor(t%(Vr+1)),g=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,o>>24,o>>16&255,o>>8&255,o&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Qe.box(Qe.types.mvhd,g)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let o,g;for(o=0;o<t.length;o++)g=t[o].flags,n[o+4]=g.dependsOn<<4|g.isDependedOn<<2|g.hasRedundancy;return Qe.box(Qe.types.sdtp,n)}static stbl(e){return Qe.box(Qe.types.stbl,Qe.stsd(e),Qe.box(Qe.types.stts,Qe.STTS),Qe.box(Qe.types.stsc,Qe.STSC),Qe.box(Qe.types.stsz,Qe.STSZ),Qe.box(Qe.types.stco,Qe.STCO))}static avc1(e){let t=[],n=[],o,g,h;for(o=0;o<e.sps.length;o++)g=e.sps[o],h=g.byteLength,t.push(h>>>8&255),t.push(h&255),t=t.concat(Array.prototype.slice.call(g));for(o=0;o<e.pps.length;o++)g=e.pps[o],h=g.byteLength,n.push(h>>>8&255),n.push(h&255),n=n.concat(Array.prototype.slice.call(g));const i=Qe.box(Qe.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),r=e.width,u=e.height,l=e.pixelRatio[0],f=e.pixelRatio[1];return Qe.box(Qe.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>8&255,r&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i,Qe.box(Qe.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Qe.box(Qe.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,f>>24,f>>16&255,f>>8&255,f&255])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static mp4a(e){const t=e.samplerate;return Qe.box(Qe.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0]),Qe.box(Qe.types.esds,Qe.esds(e)))}static mp3(e){const t=e.samplerate;return Qe.box(Qe.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0]))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?Qe.box(Qe.types.stsd,Qe.STSD,Qe.mp3(e)):Qe.box(Qe.types.stsd,Qe.STSD,Qe.mp4a(e)):Qe.box(Qe.types.stsd,Qe.STSD,Qe.avc1(e))}static tkhd(e){const t=e.id,n=e.duration*e.timescale,o=e.width,g=e.height,h=Math.floor(n/(Vr+1)),i=Math.floor(n%(Vr+1));return Qe.box(Qe.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,h>>24,h>>16&255,h>>8&255,h&255,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,o&255,0,0,g>>8&255,g&255,0,0]))}static traf(e,t){const n=Qe.sdtp(e),o=e.id,g=Math.floor(t/(Vr+1)),h=Math.floor(t%(Vr+1));return Qe.box(Qe.types.traf,Qe.box(Qe.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255])),Qe.box(Qe.types.tfdt,new Uint8Array([1,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,h>>24,h>>16&255,h>>8&255,h&255])),Qe.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,Qe.box(Qe.types.trak,Qe.tkhd(e),Qe.mdia(e))}static trex(e){const t=e.id;return Qe.box(Qe.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],o=n.length,g=12+16*o,h=new Uint8Array(g);let i,r,u,l,f,d;for(t+=8+g,h.set([e.type==="video"?1:0,0,15,1,o>>>24&255,o>>>16&255,o>>>8&255,o&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),i=0;i<o;i++)r=n[i],u=r.duration,l=r.size,f=r.flags,d=r.cts,h.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,f.degradPrio&240<<8,f.degradPrio&15,d>>>24&255,d>>>16&255,d>>>8&255,d&255],12+16*i);return Qe.box(Qe.types.trun,h)}static initSegment(e){Qe.types||Qe.init();const t=Qe.moov(e),n=new Uint8Array(Qe.FTYP.byteLength+t.byteLength);return n.set(Qe.FTYP),n.set(t,Qe.FTYP.byteLength),n}}Qe.types=void 0;Qe.HDLR_TYPES=void 0;Qe.STTS=void 0;Qe.STSC=void 0;Qe.STCO=void 0;Qe.STSZ=void 0;Qe.VMHD=void 0;Qe.SMHD=void 0;Qe.STSD=void 0;Qe.FTYP=void 0;Qe.DINF=void 0;const Go=9e4;function Ma(v,e,t=1,n=!1){const o=v*e*t;return n?Math.round(o):o}function Td(v,e,t=1,n=!1){return Ma(v,e,1/t,n)}function yn(v,e=!1){return Ma(v,1e3,1/Go,e)}function yd(v,e=1){return Ma(v,Go,1/e)}const Ad=10*1e3,Rs=1024,Sd=1152;let Wn=null,Ui=null;class ki{constructor(e,t,n,o=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Wn===null){const h=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Wn=h?parseInt(h[1]):0}if(Ui===null){const g=navigator.userAgent.match(/Safari\/(\d+)/i);Ui=g?parseInt(g[1]):0}}destroy(){}resetTimeStamp(e){We.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){We.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){We.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1;const n=e.reduce((o,g)=>{const h=g.pts-o;return h<-4294967296?(t=!0,Tr(o,g.pts)):h>0?o:g.pts},e[0].pts);return t&&We.debug("PTS rollover detected"),n}remux(e,t,n,o,g,h,i,r){let u,l,f,d,_,E,c=g,y=g;const O=e.pid>-1,P=t.pid>-1,b=t.samples.length,L=e.samples.length>0,R=i&&b>0||b>1;if((!O||L)&&(!P||R)||this.ISGenerated||i){this.ISGenerated||(f=this.generateIS(e,t,g,h));const m=this.isVideoContiguous;let M=-1,p;if(R&&(M=Rd(t.samples),!m&&this.config.forceKeyFrameOnDiscontinuity))if(E=!0,M>0){We.warn(`[mp4-remuxer]: Dropped ${M} out of ${b} video samples due to a missing keyframe`);const C=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(M),t.dropped+=M,y+=(t.samples[0].pts-C)/t.inputTimeScale,p=y}else M===-1&&(We.warn(`[mp4-remuxer]: No keyframe found out of ${b} video samples`),E=!1);if(this.ISGenerated){if(L&&R){const C=this.getVideoStartPts(t.samples),A=(Tr(e.samples[0].pts,C)-C)/t.inputTimeScale;c+=Math.max(0,A),y+=Math.max(0,-A)}if(L){if(e.samplerate||(We.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),f=this.generateIS(e,t,g,h)),l=this.remuxAudio(e,c,this.isAudioContiguous,h,P||R||r===Bt.AUDIO?y:void 0),R){const C=l?l.endPTS-l.startPTS:0;t.inputTimeScale||(We.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),f=this.generateIS(e,t,g,h)),u=this.remuxVideo(t,y,m,C)}}else R&&(u=this.remuxVideo(t,y,m,0));u&&(u.firstKeyFrame=M,u.independent=M!==-1,u.firstKeyFramePTS=p)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(_=Ho(n,g,this._initPTS,this._initDTS)),o.samples.length&&(d=Vo(o,g,this._initPTS))),{audio:l,video:u,initSegment:f,independent:E,text:d,id3:_}}generateIS(e,t,n,o){const g=e.samples,h=t.samples,i=this.typeSupported,r={},u=this._initPTS;let l=!u||o,f="audio/mp4",d,_,E;if(l&&(d=_=1/0),e.config&&g.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":i.mpeg?(f="audio/mpeg",e.codec=""):i.mp3&&(e.codec="mp3");break}r.audio={id:"audio",container:f,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&i.mpeg?new Uint8Array(0):Qe.initSegment([e]),metadata:{channelCount:e.channelCount}},l&&(E=e.inputTimeScale,!u||E!==u.timescale?d=_=g[0].pts-Math.round(E*n):l=!1)}if(t.sps&&t.pps&&h.length&&(t.timescale=t.inputTimeScale,r.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Qe.initSegment([t]),metadata:{width:t.width,height:t.height}},l))if(E=t.inputTimeScale,!u||E!==u.timescale){const c=this.getVideoStartPts(h),y=Math.round(E*n);_=Math.min(_,Tr(h[0].dts,c)-y),d=Math.min(d,c-y)}else l=!1;if(Object.keys(r).length)return this.ISGenerated=!0,l?(this._initPTS={baseTime:d,timescale:E},this._initDTS={baseTime:_,timescale:E}):d=E=void 0,{tracks:r,initPTS:d,timescale:E}}remuxVideo(e,t,n,o){const g=e.inputTimeScale,h=e.samples,i=[],r=h.length,u=this._initPTS;let l=this.nextAvcDts,f=8,d=this.videoSampleDuration,_,E,c=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,O=!1;if(!n||l===null){const V=t*g,Q=h[0].pts-Tr(h[0].dts,h[0].pts);l=V-Q}const P=u.baseTime*g/u.timescale;for(let V=0;V<r;V++){const Q=h[V];Q.pts=Tr(Q.pts-P,l),Q.dts=Tr(Q.dts-P,l),Q.dts<h[V>0?V-1:V].dts&&(O=!0)}O&&h.sort(function(V,Q){const $=V.dts-Q.dts,K=V.pts-Q.pts;return $||K}),_=h[0].dts,E=h[h.length-1].dts;const b=E-_,L=b?Math.round(b/(r-1)):d||e.inputTimeScale/30;if(n){const V=_-l,Q=V>L,$=V<-1;if((Q||$)&&(Q?We.warn(`AVC: ${yn(V,!0)} ms (${V}dts) hole between fragments detected, filling it`):We.warn(`AVC: ${yn(-V,!0)} ms (${V}dts) overlapping between fragments detected`),!$||l>h[0].pts)){_=l;const K=h[0].pts-V;h[0].dts=_,h[0].pts=K,We.log(`Video: First PTS/DTS adjusted: ${yn(K,!0)}/${yn(_,!0)}, delta: ${yn(V,!0)} ms`)}}_=Math.max(0,_);let R=0,T=0;for(let V=0;V<r;V++){const Q=h[V],$=Q.units,K=$.length;let Y=0;for(let re=0;re<K;re++)Y+=$[re].data.length;T+=Y,R+=K,Q.length=Y,Q.dts=Math.max(Q.dts,_),c=Math.min(Q.pts,c),y=Math.max(Q.pts,y)}E=h[r-1].dts;const m=T+4*R+8;let M;try{M=new Uint8Array(m)}catch(V){this.observer.emit(Ee.ERROR,Ee.ERROR,{type:Ft.MUX_ERROR,details:st.REMUX_ALLOC_ERROR,fatal:!1,error:V,bytes:m,reason:`fail allocating video mdat ${m}`});return}const p=new DataView(M.buffer);p.setUint32(0,m),M.set(Qe.types.mdat,4);let C=!1,I=Number.POSITIVE_INFINITY,A=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY,x=Number.NEGATIVE_INFINITY;for(let V=0;V<r;V++){const Q=h[V],$=Q.units;let K=0;for(let ie=0,ee=$.length;ie<ee;ie++){const ne=$[ie],ae=ne.data,ce=ne.data.byteLength;p.setUint32(f,ce),f+=4,M.set(ae,f),f+=ce,K+=4+ce}let Y;if(V<r-1)d=h[V+1].dts-Q.dts,Y=h[V+1].pts-Q.pts;else{const ie=this.config,ee=V>0?Q.dts-h[V-1].dts:L;if(Y=V>0?Q.pts-h[V-1].pts:L,ie.stretchShortVideoTrack&&this.nextAudioPts!==null){const ne=Math.floor(ie.maxBufferHole*g),ae=(o?c+o*g:this.nextAudioPts)-Q.pts;ae>ne?(d=ae-ee,d<0?d=ee:C=!0,We.log(`[mp4-remuxer]: It is approximately ${ae/90} ms to the next segment; using duration ${d/90} ms for the last video frame.`)):d=ee}else d=ee}const re=Math.round(Q.pts-Q.dts);I=Math.min(I,d),S=Math.max(S,d),A=Math.min(A,Y),x=Math.max(x,Y),i.push(new Ds(Q.key,d,K,re))}if(i.length){if(Wn){if(Wn<70){const V=i[0].flags;V.dependsOn=2,V.isNonSync=0}}else if(Ui&&x-A<S-I&&L/S<.025&&i[0].cts===0){We.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let V=_;for(let Q=0,$=i.length;Q<$;Q++){const K=V+i[Q].duration,Y=V+i[Q].cts;if(Q<$-1){const re=K+i[Q+1].cts;i[Q].duration=re-Y}else i[Q].duration=Q?i[Q-1].duration:L;i[Q].cts=0,V=K}}}d=C||!d?L:d,this.nextAvcDts=l=E+d,this.videoSampleDuration=d,this.isVideoContiguous=!0;const F=Qe.moof(e.sequenceNumber++,_,ar({},e,{samples:i})),k="video",j={data1:F,data2:M,startPTS:c/g,endPTS:(y+d)/g,startDTS:_/g,endDTS:l/g,type:k,hasAudio:!1,hasVideo:!0,nb:i.length,dropped:e.dropped};return e.samples=[],e.dropped=0,j}remuxAudio(e,t,n,o,g){const h=e.inputTimeScale,i=e.samplerate?e.samplerate:h,r=h/i,u=e.segmentCodec==="aac"?Rs:Sd,l=u*r,f=this._initPTS,d=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,_=[],E=g!==void 0;let c=e.samples,y=d?0:8,O=this.nextAudioPts||-1;const P=t*h,b=f.baseTime*h/f.timescale;if(this.isAudioContiguous=n=n||c.length&&O>0&&(o&&Math.abs(P-O)<9e3||Math.abs(Tr(c[0].pts-b,P)-O)<20*l),c.forEach(function(k){k.pts=Tr(k.pts-b,P)}),!n||O<0){if(c=c.filter(k=>k.pts>=0),!c.length)return;g===0?O=0:o&&!E?O=Math.max(0,P):O=c[0].pts}if(e.segmentCodec==="aac"){const k=this.config.maxAudioFramesDrift;for(let j=0,V=O;j<c.length;j++){const Q=c[j],$=Q.pts,K=$-V,Y=Math.abs(1e3*K/h);if(K<=-k*l&&E)j===0&&(We.warn(`Audio frame @ ${($/h).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*K/h)} ms.`),this.nextAudioPts=O=V=$);else if(K>=k*l&&Y<Ad&&E){let re=Math.round(K/l);V=$-re*l,V<0&&(re--,V+=l),j===0&&(this.nextAudioPts=O=V),We.warn(`[mp4-remuxer]: Injecting ${re} audio frame @ ${(V/h).toFixed(3)}s due to ${Math.round(1e3*K/h)} ms gap.`);for(let ie=0;ie<re;ie++){const ee=Math.max(V,0);let ne=Ss.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);ne||(We.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ne=Q.unit.subarray()),c.splice(j,0,{unit:ne,pts:ee}),V+=l,j++}}Q.pts=V,V+=l}}let L=null,R=null,T,m=0,M=c.length;for(;M--;)m+=c[M].unit.byteLength;for(let k=0,j=c.length;k<j;k++){const V=c[k],Q=V.unit;let $=V.pts;if(R!==null){const Y=_[k-1];Y.duration=Math.round(($-R)/r)}else if(n&&e.segmentCodec==="aac"&&($=O),L=$,m>0){m+=y;try{T=new Uint8Array(m)}catch(Y){this.observer.emit(Ee.ERROR,Ee.ERROR,{type:Ft.MUX_ERROR,details:st.REMUX_ALLOC_ERROR,fatal:!1,error:Y,bytes:m,reason:`fail allocating audio mdat ${m}`});return}d||(new DataView(T.buffer).setUint32(0,m),T.set(Qe.types.mdat,4))}else return;T.set(Q,y);const K=Q.byteLength;y+=K,_.push(new Ds(!0,u,K,0)),R=$}const p=_.length;if(!p)return;const C=_[_.length-1];this.nextAudioPts=O=R+r*C.duration;const I=d?new Uint8Array(0):Qe.moof(e.sequenceNumber++,L/r,ar({},e,{samples:_}));e.samples=[];const A=L/h,S=O/h,F={data1:I,data2:T,startPTS:A,endPTS:S,startDTS:A,endDTS:S,type:"audio",hasAudio:!0,hasVideo:!1,nb:p};return this.isAudioContiguous=!0,F}remuxEmptyAudio(e,t,n,o){const g=e.inputTimeScale,h=e.samplerate?e.samplerate:g,i=g/h,r=this.nextAudioPts,u=this._initDTS,l=u.baseTime*9e4/u.timescale,f=(r!==null?r:o.startDTS*g)+l,d=o.endDTS*g+l,_=i*Rs,E=Math.ceil((d-f)/_),c=Ss.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(We.warn("[mp4-remuxer]: remux empty Audio"),!c){We.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const y=[];for(let O=0;O<E;O++){const P=f+O*_;y.push({unit:c,pts:P,dts:P})}return e.samples=y,this.remuxAudio(e,t,n,!1)}}function Tr(v,e){let t;if(e===null)return v;for(e<v?t=-8589934592:t=8589934592;Math.abs(v-e)>4294967296;)v+=t;return v}function Rd(v){for(let e=0;e<v.length;e++)if(v[e].key)return e;return-1}function Ho(v,e,t,n){const o=v.samples.length;if(!o)return;const g=v.inputTimeScale;for(let i=0;i<o;i++){const r=v.samples[i];r.pts=Tr(r.pts-t.baseTime*9e4/t.timescale,e*g)/g,r.dts=Tr(r.dts-n.baseTime*9e4/n.timescale,e*g)/g}const h=v.samples;return v.samples=[],{samples:h}}function Vo(v,e,t){const n=v.samples.length;if(!n)return;const o=v.inputTimeScale;for(let h=0;h<n;h++){const i=v.samples[h];i.pts=Tr(i.pts-t.baseTime*9e4/t.timescale,e*o)/o}v.samples.sort((h,i)=>h.pts-i.pts);const g=v.samples;return v.samples=[],{samples:g}}class Ds{constructor(e,t,n,o){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=n,this.cts=o,this.flags=new Dd(e)}}class Dd{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}class Id{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,n,o){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(Yf(e,o)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const o=this.initData=To(e);t||(t=Is(o.audio,Jt.AUDIO)),n||(n=Is(o.video,Jt.VIDEO));const g={};o.audio&&o.video?g.audiovideo={container:"video/mp4",codec:t+","+n,initSegment:e,id:"main"}:o.audio?g.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:o.video?g.video={container:"video/mp4",codec:n,initSegment:e,id:"main"}:We.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=g}remux(e,t,n,o,g,h){var i,r;let{initPTS:u,lastEndTime:l}=this;const f={audio:void 0,video:void 0,text:o,id3:n,initSegment:void 0};xt(l)||(l=this.lastEndTime=g||0);const d=t.samples;if(!(d!=null&&d.length))return f;const _={initPTS:void 0,timescale:1};let E=this.initData;if((i=E)!=null&&i.length||(this.generateInitSegment(d),E=this.initData),!((r=E)!=null&&r.length))return We.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(_.tracks=this.initTracks,this.emitInitSegment=!1);const c=zf(E,d),y=c===null?g:c;(Cd(u,y,g)||_.timescale!==u.timescale&&h)&&(_.initPTS=y-g,this.initPTS=u={baseTime:_.initPTS,timescale:1});const O=$f(d,E),P=e?y-u.baseTime/u.timescale:l,b=P+O;Qf(E,d,u.baseTime/u.timescale),O>0?this.lastEndTime=b:(We.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const L=!!E.audio,R=!!E.video;let T="";L&&(T+="audio"),R&&(T+="video");const m={data1:d,startPTS:P,startDTS:P,endPTS:b,endDTS:b,type:T,hasAudio:L,hasVideo:R,nb:1,dropped:0};return f.audio=m.type==="audio"?m:void 0,f.video=m.type!=="audio"?m:void 0,f.initSegment=_,f.id3=Ho(n,g,u,u),o.samples.length&&(f.text=Vo(o,g,u)),f}}function Cd(v,e,t){if(v===null)return!0;const n=e-v.baseTime/v.timescale;return n<0&&Math.abs(n-t)>1}function Is(v,e){const t=v==null?void 0:v.codec;return t&&t.length>4?t:t==="hvc1"||t==="hev1"?"hvc1.1.c.L120.90":t==="av01"?"av01.0.04M.08":t==="avc1"||e===Jt.VIDEO?"avc1.42e01e":"mp4a.40.5"}let Kr;try{Kr=self.performance.now.bind(self.performance)}catch{We.debug("Unable to use Performance API on this environment"),Kr=typeof self<"u"&&self.Date.now}const Ki=[{demux:ud,remux:Id},{demux:Yr,remux:ki},{demux:od,remux:ki},{demux:pd,remux:ki}];class Cs{constructor(e,t,n,o,g){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.vendor=o,this.id=g}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,o){const g=n.transmuxing;g.executeStart=Kr();let h=new Uint8Array(e);const{currentTransmuxState:i,transmuxConfig:r}=this;o&&(this.currentTransmuxState=o);const{contiguous:u,discontinuity:l,trackSwitch:f,accurateTimeOffset:d,timeOffset:_,initSegmentChange:E}=o||i,{audioCodec:c,videoCodec:y,defaultInitPts:O,duration:P,initSegmentData:b}=r,L=Pd(h,t);if(L&&L.method==="AES-128"){const M=this.getDecrypter();if(M.isSync()){let p=M.softwareDecrypt(h,L.key.buffer,L.iv.buffer);if(n.part>-1&&(p=M.flush()),!p)return g.executeEnd=Kr(),ji(n);h=new Uint8Array(p)}else return this.decryptionPromise=M.webCryptoDecrypt(h,L.key.buffer,L.iv.buffer).then(p=>{const C=this.push(p,null,n);return this.decryptionPromise=null,C}),this.decryptionPromise}const R=this.needsProbing(l,f);if(R){const M=this.configureTransmuxer(h);if(M)return We.warn(`[transmuxer] ${M.message}`),this.observer.emit(Ee.ERROR,Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,fatal:!1,error:M,reason:M.message}),g.executeEnd=Kr(),ji(n)}(l||f||E||R)&&this.resetInitSegment(b,c,y,P,t),(l||E||R)&&this.resetInitialTimestamp(O),u||this.resetContiguity();const T=this.transmux(h,L,_,d,n),m=this.currentTransmuxState;return m.contiguous=!0,m.discontinuity=!1,m.trackSwitch=!1,g.executeEnd=Kr(),T}flush(e){const t=e.transmuxing;t.executeStart=Kr();const{decrypter:n,currentTransmuxState:o,decryptionPromise:g}=this;if(g)return g.then(()=>this.flush(e));const h=[],{timeOffset:i}=o;if(n){const f=n.flush();f&&h.push(this.push(f,null,e))}const{demuxer:r,remuxer:u}=this;if(!r||!u)return t.executeEnd=Kr(),[ji(e)];const l=r.flush(i);return Qn(l)?l.then(f=>(this.flushRemux(h,f,e),h)):(this.flushRemux(h,l,e),h)}flushRemux(e,t,n){const{audioTrack:o,videoTrack:g,id3Track:h,textTrack:i}=t,{accurateTimeOffset:r,timeOffset:u}=this.currentTransmuxState;We.log(`[transmuxer.ts]: Flushed fragment ${n.sn}${n.part>-1?" p: "+n.part:""} of level ${n.level}`);const l=this.remuxer.remux(o,g,h,i,u,r,!0,this.id);e.push({remuxResult:l,chunkMeta:n}),n.transmuxing.executeEnd=Kr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,o,g){const{demuxer:h,remuxer:i}=this;!h||!i||(h.resetInitSegment(e,t,n,o),i.resetInitSegment(e,t,n,g))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,o,g){let h;return t&&t.method==="SAMPLE-AES"?h=this.transmuxSampleAes(e,t,n,o,g):h=this.transmuxUnencrypted(e,n,o,g),h}transmuxUnencrypted(e,t,n,o){const{audioTrack:g,videoTrack:h,id3Track:i,textTrack:r}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(g,h,i,r,t,n,!1,this.id),chunkMeta:o}}transmuxSampleAes(e,t,n,o,g){return this.demuxer.demuxSampleAes(e,t,n).then(h=>({remuxResult:this.remuxer.remux(h.audioTrack,h.videoTrack,h.id3Track,h.textTrack,n,o,!1,this.id),chunkMeta:g}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:o,vendor:g}=this;let h;for(let f=0,d=Ki.length;f<d;f++)if(Ki[f].demux.probe(e)){h=Ki[f];break}if(!h)return new Error("Failed to find demuxer by probing fragment data");const i=this.demuxer,r=this.remuxer,u=h.remux,l=h.demux;(!r||!(r instanceof u))&&(this.remuxer=new u(n,t,o,g)),(!i||!(i instanceof l))&&(this.demuxer=new l(n,t,o),this.probe=l.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ra(this.config)),e}}function Pd(v,e){let t=null;return v.byteLength>0&&e!=null&&e.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const ji=v=>({remuxResult:{},chunkMeta:v});function Qn(v){return"then"in v&&v.then instanceof Function}class Md{constructor(e,t,n,o,g){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=o,this.defaultInitPts=g||null}}class Od{constructor(e,t,n,o,g,h){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=o,this.timeOffset=g,this.initSegmentChange=h}}var Mn={},Ld={get exports(){return Mn},set exports(v){Mn=v}};(function(v){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function o(r,u,l){this.fn=r,this.context=u,this.once=l||!1}function g(r,u,l,f,d){if(typeof l!="function")throw new TypeError("The listener must be a function");var _=new o(l,f||r,d),E=t?t+u:u;return r._events[E]?r._events[E].fn?r._events[E]=[r._events[E],_]:r._events[E].push(_):(r._events[E]=_,r._eventsCount++),r}function h(r,u){--r._eventsCount===0?r._events=new n:delete r._events[u]}function i(){this._events=new n,this._eventsCount=0}i.prototype.eventNames=function(){var u=[],l,f;if(this._eventsCount===0)return u;for(f in l=this._events)e.call(l,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},i.prototype.listeners=function(u){var l=t?t+u:u,f=this._events[l];if(!f)return[];if(f.fn)return[f.fn];for(var d=0,_=f.length,E=new Array(_);d<_;d++)E[d]=f[d].fn;return E},i.prototype.listenerCount=function(u){var l=t?t+u:u,f=this._events[l];return f?f.fn?1:f.length:0},i.prototype.emit=function(u,l,f,d,_,E){var c=t?t+u:u;if(!this._events[c])return!1;var y=this._events[c],O=arguments.length,P,b;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),O){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,l),!0;case 3:return y.fn.call(y.context,l,f),!0;case 4:return y.fn.call(y.context,l,f,d),!0;case 5:return y.fn.call(y.context,l,f,d,_),!0;case 6:return y.fn.call(y.context,l,f,d,_,E),!0}for(b=1,P=new Array(O-1);b<O;b++)P[b-1]=arguments[b];y.fn.apply(y.context,P)}else{var L=y.length,R;for(b=0;b<L;b++)switch(y[b].once&&this.removeListener(u,y[b].fn,void 0,!0),O){case 1:y[b].fn.call(y[b].context);break;case 2:y[b].fn.call(y[b].context,l);break;case 3:y[b].fn.call(y[b].context,l,f);break;case 4:y[b].fn.call(y[b].context,l,f,d);break;default:if(!P)for(R=1,P=new Array(O-1);R<O;R++)P[R-1]=arguments[R];y[b].fn.apply(y[b].context,P)}}return!0},i.prototype.on=function(u,l,f){return g(this,u,l,f,!1)},i.prototype.once=function(u,l,f){return g(this,u,l,f,!0)},i.prototype.removeListener=function(u,l,f,d){var _=t?t+u:u;if(!this._events[_])return this;if(!l)return h(this,_),this;var E=this._events[_];if(E.fn)E.fn===l&&(!d||E.once)&&(!f||E.context===f)&&h(this,_);else{for(var c=0,y=[],O=E.length;c<O;c++)(E[c].fn!==l||d&&!E[c].once||f&&E[c].context!==f)&&y.push(E[c]);y.length?this._events[_]=y.length===1?y[0]:y:h(this,_)}return this},i.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&h(this,l)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=t,i.EventEmitter=i,v.exports=i})(Ld);const Wi=Ia()||{isTypeSupported:()=>!1};class Yo{constructor(e,t,n,o){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const g=e.config;this.hls=e,this.id=t,this.useWorker=!!g.enableWorker,this.onTransmuxComplete=n,this.onFlush=o;const h=(u,l)=>{l=l||{},l.frag=this.frag,l.id=this.id,u===Ee.ERROR&&(this.error=l.error),this.hls.trigger(u,l)};this.observer=new Mn,this.observer.on(Ee.FRAG_DECRYPTED,h),this.observer.on(Ee.ERROR,h);const i={mp4:Wi.isTypeSupported("video/mp4"),mpeg:Wi.isTypeSupported("audio/mpeg"),mp3:Wi.isTypeSupported('audio/mp4; codecs="mp3"')},r=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(g.workerPath||Zc())){try{g.workerPath?(We.log(`loading Web Worker ${g.workerPath} for "${t}"`),this.workerContext=ed(g.workerPath)):(We.log(`injecting Web Worker for "${t}"`),this.workerContext=qc()),this.onwmsg=f=>this.onWorkerMessage(f);const{worker:l}=this.workerContext;l.addEventListener("message",this.onwmsg),l.onerror=f=>{const d=new Error(`${f.message}  (${f.filename}:${f.lineno})`);g.enableWorker=!1,We.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(Ee.ERROR,{type:Ft.OTHER_ERROR,details:st.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})},l.postMessage({cmd:"init",typeSupported:i,vendor:r,id:t,config:JSON.stringify(g)})}catch(l){We.warn(`Error setting up "${t}" Web Worker, fallback to inline`,l),this.resetWorker(),this.error=null,this.transmuxer=new Cs(this.observer,i,g,r,t)}return}this.transmuxer=new Cs(this.observer,i,g,r,t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,n,o,g,h,i,r,u,l){var f,d;u.transmuxing.start=self.performance.now();const{transmuxer:_}=this,E=h?h.start:g.start,c=g.decryptdata,y=this.frag,O=!(y&&g.cc===y.cc),P=!(y&&u.level===y.level),b=y?u.sn-y.sn:-1,L=this.part?u.part-this.part.index:-1,R=b===0&&u.id>1&&u.id===(y==null?void 0:y.stats.chunkCount),T=!P&&(b===1||b===0&&(L===1||R&&L<=0)),m=self.performance.now();(P||b||g.stats.parsing.start===0)&&(g.stats.parsing.start=m),h&&(L||!T)&&(h.stats.parsing.start=m);const M=!(y&&((f=g.initSegment)==null?void 0:f.url)===((d=y.initSegment)==null?void 0:d.url)),p=new Od(O,T,r,P,E,M);if(!T||O||M){We.log(`[transmuxer-interface, ${g.type}]: Starting new transmux session for sn: ${u.sn} p: ${u.part} level: ${u.level} id: ${u.id}
        discontinuity: ${O}
        trackSwitch: ${P}
        contiguous: ${T}
        accurateTimeOffset: ${r}
        timeOffset: ${E}
        initSegmentChange: ${M}`);const C=new Md(n,o,t,i,l);this.configureTransmuxer(C)}if(this.frag=g,this.part=h,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:c,chunkMeta:u,state:p},e instanceof ArrayBuffer?[e]:[]);else if(_){const C=_.push(e,c,u,p);Qn(C)?(_.async=!0,C.then(I=>{this.handleTransmuxComplete(I)}).catch(I=>{this.transmuxerError(I,u,"transmuxer-interface push error")})):(_.async=!1,this.handleTransmuxComplete(C))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let n=t.flush(e);Qn(n)||t.async?(Qn(n)||(n=Promise.resolve(n)),n.then(g=>{this.handleFlushResult(g,e)}).catch(g=>{this.transmuxerError(g,e,"transmuxer-interface flush error")})):this.handleFlushResult(n,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data,n=this.hls;switch(t.event){case"init":{var o;const g=(o=this.workerContext)==null?void 0:o.objectURL;g&&self.URL.revokeObjectURL(g);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":We[t.data.logType]&&We[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data);break}}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const bd=250,Gi=2,xd=.1,Nd=.05;class Fd{constructor(e,t,n,o){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=n,this.hls=o}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:n,media:o,stalled:g}=this;if(o===null)return;const{currentTime:h,seeking:i}=o,r=this.seeking&&!i,u=!this.seeking&&i;if(this.seeking=i,h!==e){if(this.moved=!0,g!==null){if(this.stallReported){const O=self.performance.now()-g;We.warn(`playback not stuck anymore @${h}, after ${Math.round(O)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(u||r){this.stalled=null;return}if(o.paused&&!i||o.ended||o.playbackRate===0||!qt.getBuffered(o).length)return;const l=qt.bufferInfo(o,h,0),f=l.len>0,d=l.nextStart||0;if(!f&&!d)return;if(i){const O=l.len>Gi,P=!d||t&&t.start<=h||d-h>Gi&&!this.fragmentTracker.getPartialFragment(h);if(O||P)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var _;const O=Math.max(d,l.start||0)-h,P=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,L=(P==null||(_=P.details)==null?void 0:_.live)?P.details.targetduration*2:Gi,R=this.fragmentTracker.getPartialFragment(h);if(O>0&&(O<=L||R)){this._trySkipBufferHole(R);return}}const E=self.performance.now();if(g===null){this.stalled=E;return}const c=E-g;if(!i&&c>=bd&&(this._reportStall(l),!this.media))return;const y=qt.bufferInfo(o,h,n.maxBufferHole);this._tryFixBufferStall(y,c)}_tryFixBufferStall(e,t){const{config:n,fragmentTracker:o,media:g}=this;if(g===null)return;const h=g.currentTime,i=o.getPartialFragment(h);i&&(this._trySkipBufferHole(i)||!this.media)||(e.len>n.maxBufferHole||e.nextStart&&e.nextStart-h<n.maxBufferHole)&&t>n.highBufferWatchdogPeriod*1e3&&(We.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:n,stallReported:o}=this;if(!o&&n){this.stallReported=!0;const g=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${JSON.stringify(e)})`);We.warn(g.message),t.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.BUFFER_STALLED_ERROR,fatal:!1,error:g,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:n,media:o}=this;if(o===null)return 0;const g=o.currentTime,h=qt.bufferInfo(o,g,0),i=g<h.start?h.start:h.nextStart;if(i){const r=h.len<=t.maxBufferHole,u=h.len>0&&h.len<1&&o.readyState<3,l=i-g;if(l>0&&(r||u)){if(l>t.maxBufferHole){const{fragmentTracker:d}=this;let _=!1;if(g===0){const E=d.getAppendedFrag(0,Bt.MAIN);E&&i<E.end&&(_=!0)}if(!_){const E=e||d.getAppendedFrag(g,Bt.MAIN);if(E){let c=!1,y=E.end;for(;y<i;){const O=d.getPartialFragment(y);if(O)y+=O.duration;else{c=!0;break}}if(c)return 0}}}const f=Math.max(i+Nd,g+xd);if(We.warn(`skipping hole, adjusting currentTime from ${g} to ${f}`),this.moved=!0,this.stalled=null,o.currentTime=f,e&&!e.gap){const d=new Error(`fragment loaded with buffer holes, seeking from ${g} to ${f}`);n.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:e})}return f}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:n,nudgeRetry:o}=this;if(n===null)return;const g=n.currentTime;if(this.nudgeRetry++,o<e.nudgeMaxRetry){const h=g+(o+1)*e.nudgeOffset,i=new Error(`Nudging 'currentTime' from ${g} to ${h}`);We.warn(i.message),n.currentTime=h,t.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.BUFFER_NUDGE_ON_STALL,error:i,fatal:!1})}else{const h=new Error(`Playhead still not moving while enough data buffered @${g} after ${e.nudgeMaxRetry} nudges`);We.error(h.message),t.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.BUFFER_STALLED_ERROR,error:h,fatal:!0})}}}const wd=100;class Bd extends Da{constructor(e,t,n){super(e,t,n,"[stream-controller]",Bt.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Ee.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(Ee.ERROR,this.onError,this),e.on(Ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Ee.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(Ee.BUFFER_CREATED,this.onBufferCreated,this),e.on(Ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Ee.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(Ee.ERROR,this.onError,this),e.off(Ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Ee.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(Ee.BUFFER_CREATED,this.onBufferCreated,this),e.off(Ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:n}=this;if(this.stopLoad(),this.setInterval(wd),this.level=-1,!this.startFragRequested){let o=n.startLevel;o===-1&&(n.config.testBandwidth&&this.levels.length>1?(o=0,this.bitrateTest=!0):o=n.nextAutoLevel),this.level=n.nextLoadLevel=o,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=mt.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=mt.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case mt.WAITING_LEVEL:{var e;const{levels:n,level:o}=this,g=n==null||(e=n[o])==null?void 0:e.details;if(g&&(!g.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(g))break;this.state=mt.IDLE;break}break}case mt.FRAG_LOADING_WAITING_RETRY:{var t;const n=self.performance.now(),o=this.retryDate;(!o||n>=o||(t=this.media)!=null&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=mt.IDLE)}break}this.state===mt.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:o}=this,{config:g,nextLoadLevel:h}=e;if(t===null||!o&&(this.startFragRequested||!g.startFragPrefetch)||this.altAudio&&this.audioOnly||!(n!=null&&n[h]))return;const i=n[h],r=this.getMainFwdBufferInfo();if(r===null)return;const u=this.getLevelDetails();if(u&&this._streamEnded(r,u)){const y={};this.altAudio&&(y.type="video"),this.hls.trigger(Ee.BUFFER_EOS,y),this.state=mt.ENDED;return}e.loadLevel!==h&&e.manualLevel===-1&&this.log(`Adapting to level ${h} from level ${this.level}`),this.level=e.nextLoadLevel=h;const l=i.details;if(!l||this.state===mt.WAITING_LEVEL||l.live&&this.levelLastLoaded!==h){this.level=h,this.state=mt.WAITING_LEVEL;return}const f=r.len,d=this.getMaxBufferLength(i.maxBitrate);if(f>=d)return;this.backtrackFragment&&this.backtrackFragment.start>r.end&&(this.backtrackFragment=null);const _=this.backtrackFragment?this.backtrackFragment.start:r.end;let E=this.getNextFragment(_,l);if(this.couldBacktrack&&!this.fragPrevious&&E&&E.sn!=="initSegment"&&this.fragmentTracker.getState(E)!==lr.OK){var c;const O=((c=this.backtrackFragment)!=null?c:E).sn-l.startSN,P=l.fragments[O-1];P&&E.cc===P.cc&&(E=P,this.fragmentTracker.removeFragment(P))}else this.backtrackFragment&&r.len&&(this.backtrackFragment=null);if(E&&this.isLoopLoading(E,_)){if(!E.gap){const O=this.audioOnly&&!this.altAudio?Jt.AUDIO:Jt.VIDEO,P=(O===Jt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;P&&this.afterBufferFlushed(P,O,Bt.MAIN)}E=this.getNextFragmentLoopLoading(E,l,r,Bt.MAIN,d)}E&&(E.initSegment&&!E.initSegment.data&&!this.bitrateTest&&(E=E.initSegment),this.loadFragment(E,i,_))}loadFragment(e,t,n){const o=this.fragmentTracker.getState(e);this.fragCurrent=e,o===lr.NOT_LOADED?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,n)):this.clearTrackerIfNeeded(e)}getAppendedFrag(e){const t=this.fragmentTracker.getAppendedFrag(e,Bt.MAIN);return t&&"fragment"in t?t.fragment:t}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Bt.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const o=this.getAppendedFrag(t.currentTime);if(o&&o.start>1&&this.flushMainBuffer(0,o.start-1),!t.paused&&e){const h=this.hls.nextLoadLevel,i=e[h],r=this.fragLastKbps;r&&this.fragCurrent?n=this.fragCurrent.duration*i.maxBitrate/(1e3*r)+1:n=0}else n=0;const g=this.getBufferedFrag(t.currentTime+n);if(g){const h=this.followingBufferedFrag(g);if(h){this.abortCurrentFrag();const i=h.maxStartPTS?h.maxStartPTS:h.start,r=h.duration,u=Math.max(g.end,i+Math.min(Math.max(r-this.config.maxFragLookUpTolerance,r*.5),r*.75));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case mt.KEY_LOADING:case mt.FRAG_LOADING:case mt.FRAG_LOADING_WAITING_RETRY:case mt.PARSING:case mt.PARSED:this.state=mt.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new Fd(this.config,n,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;xt(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const n=this.getMainFwdBufferInfo();if(n===null||n.len===0){this.warn(`Main forward buffer length on "seeked" event ${n?n.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Ee.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null}onManifestParsed(e,t){let n=!1,o=!1,g;t.levels.forEach(h=>{g=h.audioCodec,g&&(g.indexOf("mp4a.40.2")!==-1&&(n=!0),g.indexOf("mp4a.40.5")!==-1&&(o=!0))}),this.audioCodecSwitch=n&&o&&!Jc(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==mt.IDLE)return;const o=n[t.level];(!o.details||o.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(o.details))&&(this.state=mt.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:o}=this,g=t.level,h=t.details,i=h.totalduration;if(!o){this.warn(`Levels were reset while loading level ${g}`);return}this.log(`Level ${g} loaded [${h.startSN},${h.endSN}], cc [${h.startCC}, ${h.endCC}] duration:${i}`);const r=o[g],u=this.fragCurrent;u&&(this.state===mt.FRAG_LOADING||this.state===mt.FRAG_LOADING_WAITING_RETRY)&&(u.level!==t.level||u.urlId!==r.urlId)&&u.loader&&this.abortCurrentFrag();let l=0;if(h.live||(n=r.details)!=null&&n.live){if(h.fragments[0]||(h.deltaUpdateFailed=!0),h.deltaUpdateFailed)return;l=this.alignPlaylists(h,r.details)}if(r.details=h,this.levelLastLoaded=g,this.hls.trigger(Ee.LEVEL_UPDATED,{details:h,level:g}),this.state===mt.WAITING_LEVEL){if(this.waitForCdnTuneIn(h))return;this.state=mt.IDLE}this.startFragRequested?h.live&&this.synchronizeToLiveEdge(h):this.setStartPosition(h,l),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:n,part:o,payload:g}=e,{levels:h}=this;if(!h){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const i=h[n.level],r=i.details;if(!r){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const u=i.videoCodec,l=r.PTSKnown||!r.live,f=(t=n.initSegment)==null?void 0:t.data,d=this._getAudioCodec(i),_=this.transmuxer=this.transmuxer||new Yo(this.hls,Bt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),E=o?o.index:-1,c=E!==-1,y=new Aa(n.level,n.sn,n.stats.chunkCount,g.byteLength,E,c),O=this.initPTS[n.cc];_.push(g,f,d,u,n,o,r.totalduration,l,y,O)}onAudioTrackSwitching(e,t){const n=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const h=this.fragCurrent;h&&(this.log("Switching to main audio track, cancel main fragment load"),h.abortRequests(),this.fragmentTracker.removeFragment(h)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const g=this.hls;n&&(g.trigger(Ee.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),g.trigger(Ee.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=t.id,o=!!this.hls.audioTracks[n].url;if(o){const g=this.videoBuffer;g&&this.mediaBuffer!==g&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=g)}this.altAudio=o,this.tick()}onBufferCreated(e,t){const n=t.tracks;let o,g,h=!1;for(const i in n){const r=n[i];if(r.id==="main"){if(g=i,o=r,i==="video"){const u=n[i];u&&(this.videoBuffer=u.buffer)}}else h=!0}h&&o?(this.log(`Alternate track found, use ${g}.buffered to schedule main fragment loading`),this.mediaBuffer=o.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:o}=t;if(n&&n.type!==Bt.MAIN)return;if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${o?" p: "+o.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===mt.PARSED&&(this.state=mt.IDLE);return}const g=o?o.stats:n.stats;this.fragLastKbps=Math.round(8*g.total/(g.buffering.end-g.loading.first)),n.sn!=="initSegment"&&(this.fragPrevious=n),this.fragBufferedComplete(n,o)}onError(e,t){var n;if(t.fatal){this.state=mt.ERROR;return}switch(t.details){case st.FRAG_GAP:case st.FRAG_PARSING_ERROR:case st.FRAG_DECRYPT_ERROR:case st.FRAG_LOAD_ERROR:case st.FRAG_LOAD_TIMEOUT:case st.KEY_LOAD_ERROR:case st.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Bt.MAIN,t);break;case st.LEVEL_LOAD_ERROR:case st.LEVEL_LOAD_TIMEOUT:case st.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===mt.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===Xt.LEVEL&&(this.state=mt.IDLE);break;case st.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case st.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!qt.getBuffered(e).length){const n=this.state!==mt.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,n)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=mt.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Jt.AUDIO||this.audioOnly&&!this.altAudio){const n=(t===Jt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,t,Bt.MAIN)}}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const o=qt.getBuffered(e),h=(o.length?o.start(0):0)-n;h>0&&(h<this.config.maxBufferHole||h<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${h} to match buffer start`),n+=h,this.startPosition=n),this.log(`seek to target start position ${n} from current time ${t}`),e.currentTime=n}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:o}=this;if(!n||this.fragContextChanged(e))return;t.fragmentError=0,this.state=mt.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const g=e.stats;g.parsing.start=g.parsing.end=g.buffering.start=g.buffering.end=self.performance.now(),o.trigger(Ee.FRAG_LOADED,n),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const n="main",{hls:o}=this,{remuxResult:g,chunkMeta:h}=e,i=this.getCurrentContext(h);if(!i){this.resetWhenMissingContext(h);return}const{frag:r,part:u,level:l}=i,{video:f,text:d,id3:_,initSegment:E}=g,{details:c}=l,y=this.altAudio?void 0:g.audio;if(this.fragContextChanged(r)){this.fragmentTracker.removeFragment(r);return}if(this.state=mt.PARSING,E){E.tracks&&(this._bufferInitSegment(l,E.tracks,r,h),o.trigger(Ee.FRAG_PARSING_INIT_SEGMENT,{frag:r,id:n,tracks:E.tracks}));const O=E.initPTS,P=E.timescale;xt(O)&&(this.initPTS[r.cc]={baseTime:O,timescale:P},o.trigger(Ee.INIT_PTS_FOUND,{frag:r,id:n,initPTS:O,timescale:P}))}if(f&&g.independent!==!1){if(c){const{startPTS:O,endPTS:P,startDTS:b,endDTS:L}=f;if(u)u.elementaryStreams[f.type]={startPTS:O,endPTS:P,startDTS:b,endDTS:L};else if(f.firstKeyFrame&&f.independent&&h.id===1&&(this.couldBacktrack=!0),f.dropped&&f.independent){const R=this.getMainFwdBufferInfo(),T=(R?R.end:this.getLoadPosition())+this.config.maxBufferHole,m=f.firstKeyFramePTS?f.firstKeyFramePTS:O;if(T<m-this.config.maxBufferHole){this.backtrack(r);return}r.setElementaryStreamInfo(f.type,r.start,P,r.start,L,!0)}r.setElementaryStreamInfo(f.type,O,P,b,L),this.backtrackFragment&&(this.backtrackFragment=r),this.bufferFragmentData(f,r,u,h)}}else if(g.independent===!1){this.backtrack(r);return}if(y){const{startPTS:O,endPTS:P,startDTS:b,endDTS:L}=y;u&&(u.elementaryStreams[Jt.AUDIO]={startPTS:O,endPTS:P,startDTS:b,endDTS:L}),r.setElementaryStreamInfo(Jt.AUDIO,O,P,b,L),this.bufferFragmentData(y,r,u,h)}if(c&&_!=null&&(t=_.samples)!=null&&t.length){const O={id:n,frag:r,details:c,samples:_.samples};o.trigger(Ee.FRAG_PARSING_METADATA,O)}if(c&&d){const O={id:n,frag:r,details:c,samples:d.samples};o.trigger(Ee.FRAG_PARSING_USERDATA,O)}}_bufferInitSegment(e,t,n,o){if(this.state!==mt.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:g,video:h,audiovideo:i}=t;if(g){let r=e.audioCodec;const u=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(r&&(r.indexOf("mp4a.40.5")!==-1?r="mp4a.40.2":r="mp4a.40.5"),g.metadata.channelCount!==1&&u.indexOf("firefox")===-1&&(r="mp4a.40.5")),u.indexOf("android")!==-1&&g.container!=="audio/mpeg"&&(r="mp4a.40.2",this.log(`Android: force audio codec to ${r}`)),e.audioCodec&&e.audioCodec!==r&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${r}"`),g.levelCodec=r,g.id="main",this.log(`Init audio buffer, container:${g.container}, codecs[selected/level/parsed]=[${r||""}/${e.audioCodec||""}/${g.codec}]`)}h&&(h.levelCodec=e.videoCodec,h.id="main",this.log(`Init video buffer, container:${h.container}, codecs[level/parsed]=[${e.videoCodec||""}/${h.codec}]`)),i&&this.log(`Init audiovideo buffer, container:${i.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${i.codec}]`),this.hls.trigger(Ee.BUFFER_CODECS,t),Object.keys(t).forEach(r=>{const l=t[r].initSegment;l!=null&&l.byteLength&&this.hls.trigger(Ee.BUFFER_APPENDING,{type:r,data:l,frag:n,part:null,chunkMeta:o,parent:n.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Bt.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=mt.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(qt.isBuffered(e,n)?t=this.getAppendedFrag(n):qt.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const o=this.fragPlaying,g=t.level;(!o||t.sn!==o.sn||o.level!==g||t.urlId!==o.urlId)&&(this.fragPlaying=t,this.hls.trigger(Ee.FRAG_CHANGED,{frag:t}),(!o||o.level!==g)&&this.hls.trigger(Ee.LEVEL_SWITCHED,{level:g}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,n=this.currentFrag;if(n&&xt(t)&&xt(n.programDateTime)){const o=n.programDateTime+(t-n.start)*1e3;return new Date(o)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class un{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Ud{constructor(e,t,n,o=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new un(e),this.fast_=new un(t),this.defaultTTFB_=o,this.ttfb_=new un(e)}update(e,t){const{slow_:n,fast_:o,ttfb_:g}=this;n.halfLife!==e&&(this.slow_=new un(e,n.getEstimate(),n.getTotalWeight())),o.halfLife!==t&&(this.fast_=new un(t,o.getEstimate(),o.getTotalWeight())),g.halfLife!==e&&(this.ttfb_=new un(e,g.getEstimate(),g.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,o=e/1e3,g=n/o;this.fast_.sample(o,g),this.slow_.sample(o,g)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class kd{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;const t=e.config;this.bwEstimator=new Ud(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(Ee.FRAG_LOADING,this.onFragLoading,this),e.on(Ee.FRAG_LOADED,this.onFragLoaded,this),e.on(Ee.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Ee.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:e}=this;e.off(Ee.FRAG_LOADING,this.onFragLoading,this),e.off(Ee.FRAG_LOADED,this.onFragLoaded,this),e.off(Ee.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Ee.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var n;const o=t.frag;this.ignoreFragment(o)||(this.fragCurrent=o,this.partCurrent=(n=t.part)!=null?n:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,n,o){const g=e+n/t,h=o?this.lastLevelLoadSec:0;return g+h}onLevelLoaded(e,t){const n=this.hls.config,{total:o,bwEstimate:g}=t.stats;xt(o)&&xt(g)&&(this.lastLevelLoadSec=8*o/g),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:e,partCurrent:t,hls:n}=this,{autoLevelEnabled:o,media:g}=n;if(!e||!g)return;const h=performance.now(),i=t?t.stats:e.stats,r=t?t.duration:e.duration,u=h-i.loading.start;if(i.aborted||i.loaded&&i.loaded===i.total||e.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o||g.paused||!g.playbackRate||!g.readyState)return;const l=n.mainForwardBufferInfo;if(l===null)return;const f=this.bwEstimator.getEstimateTTFB(),d=Math.abs(g.playbackRate);if(u<=Math.max(f,1e3*(r/(d*2))))return;const _=l.len/d;if(_>=2*r/d)return;const E=i.loading.first?i.loading.first-i.loading.start:-1,c=i.loaded&&E>-1,y=this.bwEstimator.getEstimate(),{levels:O,minAutoLevel:P}=n,b=O[e.level],L=i.total||Math.max(i.loaded,Math.round(r*b.maxBitrate/8));let R=u-E;R<1&&c&&(R=Math.min(u,i.loaded*8/y));const T=c?i.loaded*1e3/R:0,m=T?(L-i.loaded)/T:L*8/y+f/1e3;if(m<=_)return;const M=T?T*8:y;let p=Number.POSITIVE_INFINITY,C;for(C=e.level-1;C>P;C--){const I=O[C].maxBitrate;if(p=this.getTimeToLoadFrag(f/1e3,M,r*I,!O[C].details),p<_)break}p>=m||p>r*10||(n.nextLoadLevel=C,c?this.bwEstimator.sample(u-Math.min(f,E),i.loaded):this.bwEstimator.sampleTTFB(u),this.clearTimer(),We.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;
      Time to underbuffer: ${_.toFixed(3)} s
      Estimated load time for current fragment: ${m.toFixed(3)} s
      Estimated load time for down switch fragment: ${p.toFixed(3)} s
      TTFB estimate: ${E}
      Current BW estimate: ${xt(y)?(y/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${C}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),n.trigger(Ee.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:i}))}onFragLoaded(e,{frag:t,part:n}){const o=n?n.stats:t.stats;if(t.type===Bt.MAIN&&this.bwEstimator.sampleTTFB(o.loading.first-o.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const g=n?n.duration:t.duration,h=this.hls.levels[t.level],i=(h.loaded?h.loaded.bytes:0)+o.loaded,r=(h.loaded?h.loaded.duration:0)+g;h.loaded={bytes:i,duration:r},h.realBitrate=Math.round(8*i/r)}if(t.bitrateTest){const g={stats:o,frag:t,part:n,id:t.type};this.onFragBuffered(Ee.FRAG_BUFFERED,g),t.bitrateTest=!1}}}onFragBuffered(e,t){const{frag:n,part:o}=t,g=o!=null&&o.stats.loaded?o.stats:n.stats;if(g.aborted||this.ignoreFragment(n))return;const h=g.parsing.end-g.loading.start-Math.min(g.loading.first-g.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(h,g.loaded),g.bwEstimate=this.bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=h/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Bt.MAIN||e.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const e=this._nextAutoLevel,t=this.bwEstimator;if(e!==-1&&!t.canEstimate())return e;let n=this.getNextABRAutoLevel();if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,n)&&o[e].loadError<=o[n].loadError)return e}return e!==-1&&(n=Math.min(e,n)),n}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this,{maxAutoLevel:o,config:g,minAutoLevel:h,media:i}=n,r=t?t.duration:e?e.duration:0,u=i&&i.playbackRate!==0?Math.abs(i.playbackRate):1,l=this.bwEstimator?this.bwEstimator.getEstimate():g.abrEwmaDefaultEstimate,f=n.mainForwardBufferInfo,d=(f?f.len:0)/u;let _=this.findBestLevel(l,h,o,d,g.abrBandWidthFactor,g.abrBandWidthUpFactor);if(_>=0)return _;We.trace(`[abr] ${d?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let E=r?Math.min(r,g.maxStarvationDelay):g.maxStarvationDelay,c=g.abrBandWidthFactor,y=g.abrBandWidthUpFactor;if(!d){const O=this.bitrateTestDelay;O&&(E=(r?Math.min(r,g.maxLoadingDelay):g.maxLoadingDelay)-O,We.trace(`[abr] bitrate test took ${Math.round(1e3*O)}ms, set first fragment max fetchDuration to ${Math.round(1e3*E)} ms`),c=y=1)}return _=this.findBestLevel(l,h,o,d+E,c,y),Math.max(_,0)}findBestLevel(e,t,n,o,g,h){var i;const{fragCurrent:r,partCurrent:u,lastLoadedFragLevel:l}=this,{levels:f}=this.hls,d=f[l],_=!!(d!=null&&(i=d.details)!=null&&i.live),E=d==null?void 0:d.codecSet,c=u?u.duration:r?r.duration:0,y=this.bwEstimator.getEstimateTTFB()/1e3;let O=t,P=-1;for(let b=n;b>=t;b--){const L=f[b];if(!L||E&&L.codecSet!==E){L&&(O=Math.min(b,O),P=Math.max(b,P));continue}P!==-1&&We.trace(`[abr] Skipped level(s) ${O}-${P} with CODECS:"${f[P].attrs.CODECS}"; not compatible with "${d.attrs.CODECS}"`);const R=L.details,T=(u?R==null?void 0:R.partTarget:R==null?void 0:R.averagetargetduration)||c;let m;b<=l?m=g*e:m=h*e;const M=f[b].maxBitrate,p=this.getTimeToLoadFrag(y,m,M*T,R===void 0);if(We.trace(`[abr] level:${b} adjustedbw-bitrate:${Math.round(m-M)} avgDuration:${T.toFixed(1)} maxFetchDuration:${o.toFixed(1)} fetchDuration:${p.toFixed(1)}`),m>M&&(p===0||!xt(p)||_&&!this.bitrateTestDelay||p<o))return b}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}}class zo{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=Kd(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function Kd(v,e){const t=new Uint8Array(e);let n=0;for(let o=0;o<v.length;o++){const g=v[o];t.set(g,n),n+=g.length}return t}const Ps=100;class jd extends Da{constructor(e,t,n){super(e,t,n,"[audio-stream-controller]",Bt.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Ee.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(Ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Ee.ERROR,this.onError,this),e.on(Ee.BUFFER_RESET,this.onBufferReset,this),e.on(Ee.BUFFER_CREATED,this.onBufferCreated,this),e.on(Ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Ee.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(Ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Ee.ERROR,this.onError,this),e.off(Ee.BUFFER_RESET,this.onBufferReset,this),e.off(Ee.BUFFER_CREATED,this.onBufferCreated,this),e.off(Ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:n,initPTS:o,timescale:g}){if(n==="main"){const h=t.cc;this.initPTS[t.cc]={baseTime:o,timescale:g},this.log(`InitPTS for cc: ${h} found from main: ${o}`),this.videoTrackCC=h,this.state===mt.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=mt.STOPPED;return}const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(Ps),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=mt.IDLE):(this.loadedmetadata=!1,this.state=mt.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case mt.IDLE:this.doTickIdle();break;case mt.WAITING_TRACK:{var e;const{levels:n,trackId:o}=this,g=n==null||(e=n[o])==null?void 0:e.details;if(g){if(this.waitForCdnTuneIn(g))break;this.state=mt.WAITING_INIT_PTS}break}case mt.FRAG_LOADING_WAITING_RETRY:{var t;const n=performance.now(),o=this.retryDate;(!o||n>=o||(t=this.media)!=null&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=mt.IDLE);break}case mt.WAITING_INIT_PTS:{const n=this.waitingData;if(n){const{frag:o,part:g,cache:h,complete:i}=n;if(this.initPTS[o.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=mt.FRAG_LOADING;const r=h.flush(),u={frag:o,part:g,payload:r,networkDetails:null};this._handleFragmentLoadProgress(u),i&&super._handleFragmentLoadComplete(u)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${o.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const r=this.getLoadPosition(),u=qt.bufferInfo(this.mediaBuffer,r,this.config.maxBufferHole);la(u.end,this.config.maxFragLookUpTolerance,o)<0&&(this.log(`Waiting fragment cc (${o.cc}) @ ${o.start} cancelled because another fragment at ${u.end} is needed`),this.clearWaitingFragment())}}else this.state=mt.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=mt.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:n,trackId:o}=this,g=e.config;if(!(t!=null&&t[o])||!n&&(this.startFragRequested||!g.startFragPrefetch))return;const h=t[o],i=h.details;if(!i||i.live&&this.levelLastLoaded!==o||this.waitForCdnTuneIn(i)){this.state=mt.WAITING_TRACK;return}const r=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&r&&(this.bufferFlushed=!1,this.afterBufferFlushed(r,Jt.AUDIO,Bt.AUDIO));const u=this.getFwdBufferInfo(r,Bt.AUDIO);if(u===null)return;const{bufferedTrack:l,switchingTrack:f}=this;if(!f&&this._streamEnded(u,i)){e.trigger(Ee.BUFFER_EOS,{type:"audio"}),this.state=mt.ENDED;return}const d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Bt.MAIN),_=u.len,E=this.getMaxBufferLength(d==null?void 0:d.len);if(_>=E&&!f)return;const y=i.fragments[0].start;let O=u.end;if(f&&n){const R=this.getLoadPosition();l&&f.attrs!==l.attrs&&(O=R),i.PTSKnown&&R<y&&(u.end>y||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=y+.05)}let P=this.getNextFragment(O,i),b=!1;if(P&&this.isLoopLoading(P,O)&&(b=!!P.gap,P=this.getNextFragmentLoopLoading(P,i,u,Bt.MAIN,E)),!P){this.bufferFlushed=!0;return}const L=d&&P.start>d.end+i.targetduration;if(L||!(d!=null&&d.len)&&u.len){const R=this.fragmentTracker.getBufferedFrag(P.start,Bt.MAIN);if(R===null||(b||(b=!!R.gap||!!L&&d.len===0),L&&!b||b&&u.nextStart&&u.nextStart<R.end))return}this.loadFragment(P,h,O)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new Cn(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:o}=this;o&&(o.abortRequests(),this.removeUnbufferedFrags(o.start)),this.resetLoadingState(),n?this.setInterval(Ps):this.resetTransmuxer(),n?(this.switchingTrack=t,this.state=mt.IDLE):(this.switchingTrack=null,this.bufferedTrack=t,this.state=mt.STOPPED),this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.bufferedTrack=null,this.switchingTrack=null}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Ee.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var n;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}const{levels:o}=this,{details:g,id:h}=t;if(!o){this.warn(`Audio tracks were reset while loading level ${h}`);return}this.log(`Track ${h} loaded [${g.startSN},${g.endSN}],duration:${g.totalduration}`);const i=o[h];let r=0;if(g.live||(n=i.details)!=null&&n.live){const u=this.mainDetails;if(g.fragments[0]||(g.deltaUpdateFailed=!0),g.deltaUpdateFailed||!u)return;!i.details&&g.hasProgramDateTime&&u.hasProgramDateTime?(bo(g,u),r=g.fragments[0].start):r=this.alignPlaylists(g,i.details)}i.details=g,this.levelLastLoaded=h,!this.startFragRequested&&(this.mainDetails||!g.live)&&this.setStartPosition(i.details,r),this.state===mt.WAITING_TRACK&&!this.waitForCdnTuneIn(g)&&(this.state=mt.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:n,part:o,payload:g}=e,{config:h,trackId:i,levels:r}=this;if(!r){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=r[i];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const l=u.details;if(!l){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const f=h.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new Yo(this.hls,Bt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const _=this.initPTS[n.cc],E=(t=n.initSegment)==null?void 0:t.data;if(_!==void 0){const y=o?o.index:-1,O=y!==-1,P=new Aa(n.level,n.sn,n.stats.chunkCount,g.byteLength,y,O);d.push(g,E,f,"",n,o,l.totalduration,!1,P,_)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${l.startSN} ,${l.endSN}],track ${i}`);const{cache:c}=this.waitingData=this.waitingData||{frag:n,part:o,cache:new zo,complete:!1};c.push(new Uint8Array(g)),this.waitingVideoCC=this.videoTrackCC,this.state=mt.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:n,part:o}=t;if(n.type!==Bt.AUDIO){if(!this.loadedmetadata&&n.type===Bt.MAIN){var g;(g=this.videoBuffer||this.media)!=null&&g.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${o?" p: "+o.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(n.sn!=="initSegment"){this.fragPrevious=n;const h=this.switchingTrack;h&&(this.bufferedTrack=h,this.switchingTrack=null,this.hls.trigger(Ee.AUDIO_TRACK_SWITCHED,mr({},h)))}this.fragBufferedComplete(n,o)}onError(e,t){var n;if(t.fatal){this.state=mt.ERROR;return}switch(t.details){case st.FRAG_GAP:case st.FRAG_PARSING_ERROR:case st.FRAG_DECRYPT_ERROR:case st.FRAG_LOAD_ERROR:case st.FRAG_LOAD_TIMEOUT:case st.KEY_LOAD_ERROR:case st.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Bt.AUDIO,t);break;case st.AUDIO_TRACK_LOAD_ERROR:case st.AUDIO_TRACK_LOAD_TIMEOUT:case st.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===mt.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===Xt.AUDIO_TRACK&&(this.state=mt.IDLE);break;case st.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case st.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushed(e,{type:t}){t===Jt.AUDIO&&(this.bufferFlushed=!0,this.state===mt.ENDED&&(this.state=mt.IDLE))}_handleTransmuxComplete(e){var t;const n="audio",{hls:o}=this,{remuxResult:g,chunkMeta:h}=e,i=this.getCurrentContext(h);if(!i){this.resetWhenMissingContext(h);return}const{frag:r,part:u,level:l}=i,{details:f}=l,{audio:d,text:_,id3:E,initSegment:c}=g;if(this.fragContextChanged(r)||!f){this.fragmentTracker.removeFragment(r);return}if(this.state=mt.PARSING,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),c!=null&&c.tracks&&(this._bufferInitSegment(c.tracks,r,h),o.trigger(Ee.FRAG_PARSING_INIT_SEGMENT,{frag:r,id:n,tracks:c.tracks})),d){const{startPTS:y,endPTS:O,startDTS:P,endDTS:b}=d;u&&(u.elementaryStreams[Jt.AUDIO]={startPTS:y,endPTS:O,startDTS:P,endDTS:b}),r.setElementaryStreamInfo(Jt.AUDIO,y,O,P,b),this.bufferFragmentData(d,r,u,h)}if(E!=null&&(t=E.samples)!=null&&t.length){const y=ar({id:n,frag:r,details:f},E);o.trigger(Ee.FRAG_PARSING_METADATA,y)}if(_){const y=ar({id:n,frag:r,details:f},_);o.trigger(Ee.FRAG_PARSING_USERDATA,y)}}_bufferInitSegment(e,t,n){if(this.state!==mt.PARSING)return;e.video&&delete e.video;const o=e.audio;if(!o)return;o.levelCodec=o.codec,o.id="audio",this.log(`Init audio buffer, container:${o.container}, codecs[parsed]=[${o.codec}]`),this.hls.trigger(Ee.BUFFER_CODECS,e);const g=o.initSegment;if(g!=null&&g.byteLength){const h={type:"audio",frag:t,part:null,chunkMeta:n,parent:t.type,data:g};this.hls.trigger(Ee.BUFFER_APPENDING,h)}this.tick()}loadFragment(e,t,n){const o=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||o===lr.NOT_LOADED||o===lr.PARTIAL){var g;e.sn==="initSegment"?this._loadInitSegment(e,t):(g=t.details)!=null&&g.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=mt.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(e,t,n))}else this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){const{hls:t,media:n,bufferedTrack:o}=this,g=o==null?void 0:o.attrs,h=e.attrs;n&&g&&(g.CHANNELS!==h.CHANNELS||g.NAME!==h.NAME||g.LANGUAGE!==h.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(Ee.AUDIO_TRACK_SWITCHED,mr({},e))}}class Wd extends ya{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Ee.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.off(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Ee.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:o,details:g}=t,h=this.tracksInGroup[n];if(!h||h.groupId!==o){this.warn(`Track with id:${n} and group:${o} not found in active group ${h.groupId}`);return}const i=h.details;h.details=t.details,this.log(`audio-track ${n} "${h.name}" lang:${h.lang} group:${o} loaded [${g.startSN}-${g.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,i)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!(t!=null&&t.audioGroupIds))return;const n=t.audioGroupIds[t.urlId];if(this.groupId!==n){this.groupId=n||null;const o=this.tracks.filter(h=>!n||h.groupId===n);this.selectDefaultTrack&&!o.some(h=>h.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=o;const g={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group:${n}`),this.hls.trigger(Ee.AUDIO_TRACKS_UPDATED,g),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===Xt.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();const n=this.currentTrack;t[this.trackId];const o=t[e],{groupId:g,name:h}=o;if(this.log(`Switching to audio-track ${e} "${h}" lang:${o.lang} group:${g}`),this.trackId=e,this.currentTrack=o,this.selectDefaultTrack=!1,this.hls.trigger(Ee.AUDIO_TRACK_SWITCHING,mr({},o)),o.details&&!o.details.live)return;const i=this.switchParams(o.url,n==null?void 0:n.details);this.loadPlaylist(i)}selectInitialTrack(){const e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(t!==-1)this.setAudioTrack(t);else{const n=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(n.message),this.hls.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:n})}}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const o=t[n];if((!this.selectDefaultTrack||o.default)&&(!e||e.attrs["STABLE-RENDITION-ID"]===o.attrs["STABLE-RENDITION-ID"]||e.name===o.name&&e.lang===o.lang))return o.id}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const n=t.id,o=t.groupId;let g=t.url;if(e)try{g=e.addDirectives(g)}catch(h){this.warn(`Could not construct new URL with HLS Delivery Directives: ${h}`)}this.log(`loading audio-track playlist ${n} "${t.name}" lang:${t.lang} group:${o}`),this.clearTimer(),this.hls.trigger(Ee.AUDIO_TRACK_LOADING,{url:g,id:n,groupId:o,deliveryDirectives:e||null})}}}function $o(v,e){if(v.length!==e.length)return!1;for(let t=0;t<v.length;t++)if(!Gd(v[t].attrs,e[t].attrs))return!1;return!0}function Gd(v,e){const t=v["STABLE-RENDITION-ID"];return t?t===e["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(n=>v[n]!==e[n])}const Ms=500;class Hd extends Da{constructor(e,t,n){super(e,t,n,"[subtitle-stream-controller]",Bt.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Ee.ERROR,this.onError,this),e.on(Ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Ee.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Ee.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Ee.ERROR,this.onError,this),e.off(Ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Ee.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Ee.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=mt.IDLE,this.setInterval(Ms),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:o}=t;if(this.fragPrevious=n,this.state=mt.IDLE,!o)return;const g=this.tracksBuffered[this.currentTrackId];if(!g)return;let h;const i=n.start;for(let u=0;u<g.length;u++)if(i>=g[u].start&&i<=g[u].end){h=g[u];break}const r=n.start+n.duration;h?h.end=r:(h={start:i,end:r},g.push(h)),this.fragmentTracker.fragBuffered(n)}onBufferFlushing(e,t){const{startOffset:n,endOffset:o}=t;if(n===0&&o!==Number.POSITIVE_INFINITY){const{currentTrackId:g,levels:h}=this;if(!h.length||!h[g]||!h[g].details)return;const r=h[g].details.targetduration,u=o-r;if(u<=0)return;t.endOffsetSubtitles=Math.max(0,u),this.tracksBuffered.forEach(l=>{for(let f=0;f<l.length;){if(l[f].end<=u){l.shift();continue}else if(l[f].start<u)l[f].start=u;else break;f++}}),this.fragmentTracker.removeFragmentsInRange(n,u,Bt.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===Bt.MAIN){var n;(n=this.media)!=null&&n.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===Bt.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==mt.STOPPED&&(this.state=mt.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if($o(this.levels,t)){this.levels=t.map(n=>new Cn(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const o=new Cn(n);return this.tracksBuffered[o.id]=[],o}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Bt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(Ms)}onSubtitleTrackLoaded(e,t){var n;const{details:o,id:g}=t,{currentTrackId:h,levels:i}=this;if(!i.length)return;const r=i[h];if(g>=i.length||g!==h||!r)return;this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(n=r.details)!=null&&n.live){const l=this.mainDetails;if(o.deltaUpdateFailed||!l)return;const f=l.fragments[0];r.details?(u=this.alignPlaylists(o,r.details),u===0&&f&&(u=f.start,oa(o,u))):o.hasProgramDateTime&&l.hasProgramDateTime?(bo(o,l),u=o.fragments[0].start):f&&(u=f.start,oa(o,u))}r.details=o,this.levelLastLoaded=g,!this.startFragRequested&&(this.mainDetails||!o.live)&&this.setStartPosition(r.details,u),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===mt.IDLE&&(Pn(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),r.details=void 0))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,o=t.decryptdata,g=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&o&&o.key&&o.iv&&o.method==="AES-128"){const h=performance.now();this.decrypter.decrypt(new Uint8Array(n),o.key.buffer,o.iv.buffer).catch(i=>{throw g.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.FRAG_DECRYPT_ERROR,fatal:!1,error:i,reason:i.message,frag:t}),i}).then(i=>{const r=performance.now();g.trigger(Ee.FRAG_DECRYPTED,{frag:t,payload:i,stats:{tstart:h,tdecrypt:r}})}).catch(i=>{this.warn(`${i.name}: ${i.message}`),this.state=mt.IDLE})}}doTick(){if(!this.media){this.state=mt.IDLE;return}if(this.state===mt.IDLE){const{currentTrackId:e,levels:t}=this,n=t[e];if(!t.length||!n||!n.details)return;const o=n.details,g=o.targetduration,{config:h}=this,i=this.getLoadPosition(),r=qt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i-g,h.maxBufferHole),{end:u,len:l}=r,f=this.getFwdBufferInfo(this.media,Bt.MAIN),d=this.getMaxBufferLength(f==null?void 0:f.len)+g;if(l>d)return;const _=o.fragments,E=_.length,c=o.edge;let y=null;const O=this.fragPrevious;if(u<c){const{maxFragLookUpTolerance:P}=h;y=Pn(O,_,Math.max(_[0].start,u),P),!y&&O&&O.start<_[0].start&&(y=_[0])}else y=_[E-1];if(!y)return;y=this.mapToInitFragWhenRequired(y),this.fragmentTracker.getState(y)===lr.NOT_LOADED&&this.loadFragment(y,n,u)}}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,n){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,n))}get mediaBufferTimeRanges(){return new Vd(this.tracksBuffered[this.currentTrackId]||[])}}class Vd{constructor(e){this.buffered=void 0;const t=(n,o,g)=>{if(o=o>>>0,o>g-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${o}) is greater than the maximum bound (${g})`);return e[o][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}class Yd extends ya{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Ee.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.off(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Ee.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Hi(this.media.textTracks).forEach(t=>{cn(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,details:o}=t,{trackId:g}=this,h=this.tracksInGroup[g];if(!h){this.warn(`Invalid subtitle track id ${n}`);return}const i=h.details;h.details=t.details,this.log(`subtitle track ${n} loaded [${o.startSN}-${o.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,i)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!(t!=null&&t.textGroupIds))return;const n=t.textGroupIds[t.urlId],o=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==n){const g=this.tracks.filter(r=>!n||r.groupId===n);this.tracksInGroup=g;const h=this.findTrackId(o==null?void 0:o.name)||this.findTrackId();this.groupId=n||null;const i={subtitleTracks:g};this.log(`Updating subtitle tracks, ${g.length} track(s) found in "${n}" group-id`),this.hls.trigger(Ee.SUBTITLE_TRACKS_UPDATED,i),h!==-1&&this.setSubtitleTrack(h,o)}else this.shouldReloadPlaylist(o)&&this.setSubtitleTrack(this.trackId,o)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const o=t[n];if((!this.selectDefaultTrack||o.default)&&(!e||e===o.name))return o.id}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Xt.SUBTITLE_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1;const t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const n=t.id,o=t.groupId;let g=t.url;if(e)try{g=e.addDirectives(g)}catch(h){this.warn(`Could not construct new URL with HLS Delivery Directives: ${h}`)}this.log(`Loading subtitle playlist for id ${n}`),this.hls.trigger(Ee.SUBTITLE_TRACK_LOADING,{url:g,id:n,groupId:o,deliveryDirectives:e||null})}}toggleTrackModes(e){const{media:t,trackId:n}=this;if(!t)return;const o=Hi(t.textTracks),g=o.filter(i=>i.groupId===this.groupId);if(e===-1)[].slice.call(o).forEach(i=>{i.mode="disabled"});else{const i=g[n];i&&(i.mode="disabled")}const h=g[e];h&&(h.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var n;const o=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(e===-1||(n=o[e])!=null&&n.details)||e<-1||e>=o.length)return;this.clearTimer();const g=o[e];if(this.log(`Switching to subtitle-track ${e}`+(g?` "${g.name}" lang:${g.lang} group:${g.groupId}`:"")),this.trackId=e,g){const{id:h,groupId:i="",name:r,type:u,url:l}=g;this.hls.trigger(Ee.SUBTITLE_TRACK_SWITCH,{id:h,groupId:i,name:r,type:u,url:l});const f=this.switchParams(g.url,t==null?void 0:t.details);this.loadPlaylist(f)}else this.hls.trigger(Ee.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1;const t=Hi(this.media.textTracks);for(let n=0;n<t.length;n++)if(t[n].mode==="hidden")e=n;else if(t[n].mode==="showing"){e=n;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}}function Hi(v){const e=[];for(let t=0;t<v.length;t++){const n=v[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(v[t])}return e}class zd{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){const n=this.queues[t];n.push(e),n.length===1&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const n=new Promise(g=>{t=g}),o={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(o,e),n}executeNext(e){const{buffers:t,queues:n}=this,o=t[e],g=n[e];if(g.length){const h=g[0];try{h.execute()}catch(i){We.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),h.onError(i),o!=null&&o.updating||(g.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const Os=Ia(),Ls=/([ha]vc.)(?:\.[^.,]+)+/;class $d{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:t,mediaSource:n}=this;We.log("[buffer-controller]: Media source opened"),t&&(t.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Ee.MEDIA_ATTACHED,{media:t})),n&&n.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{We.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{We.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:t,_objectUrl:n}=this;t&&t.src!==n&&We.error(`Media element src was set while attaching MediaSource (${n} > ${t.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.BUFFER_RESET,this.onBufferReset,this),e.on(Ee.BUFFER_APPENDING,this.onBufferAppending,this),e.on(Ee.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Ee.BUFFER_EOS,this.onBufferEos,this),e.on(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Ee.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Ee.FRAG_PARSED,this.onFragParsed,this),e.on(Ee.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.BUFFER_RESET,this.onBufferReset,this),e.off(Ee.BUFFER_APPENDING,this.onBufferAppending,this),e.off(Ee.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Ee.BUFFER_EOS,this.onBufferEos,this),e.off(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Ee.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Ee.FRAG_PARSED,this.onFragParsed,this),e.off(Ee.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new zd(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestParsed(e,t){let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.details=null,We.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const n=this.media=t.media;if(n&&Os){const o=this.mediaSource=new Os;o.addEventListener("sourceopen",this._onMediaSourceOpen),o.addEventListener("sourceended",this._onMediaSourceEnded),o.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(o),this._objectUrl=n.src,n.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:n}=this;if(t){if(We.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(o){We.warn(`[buffer-controller]: onMediaDetaching: ${o.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),e.src===n?(e.removeAttribute("src"),e.load()):We.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Ee.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{const t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(n){We.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,n)}}),this._initSourceBuffer()}onBufferCodecs(e,t){const n=this.getSourceBufferTypes().length;Object.keys(t).forEach(o=>{if(n){const g=this.tracks[o];if(g&&typeof g.buffer.changeType=="function"){const{id:h,codec:i,levelCodec:r,container:u,metadata:l}=t[o],f=(g.levelCodec||g.codec).replace(Ls,"$1"),d=(r||i).replace(Ls,"$1");if(f!==d){const _=`${u};codecs=${r||i}`;this.appendChangeType(o,_),We.log(`[buffer-controller]: switching codec ${f} to ${d}`),this.tracks[o]={buffer:g.buffer,codec:i,container:u,levelCodec:r,metadata:l,id:h}}}}else this.pendingTracks[o]=t[o]}),!n&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(e,t){const{operationQueue:n}=this,o={execute:()=>{const g=this.sourceBuffer[e];g&&(We.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),g.changeType(t)),n.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:g=>{We.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,g)}};n.append(o,e)}onBufferAppending(e,t){const{hls:n,operationQueue:o,tracks:g}=this,{data:h,type:i,frag:r,part:u,chunkMeta:l}=t,f=l.buffering[i],d=self.performance.now();f.start=d;const _=r.stats.buffering,E=u?u.stats.buffering:null;_.start===0&&(_.start=d),E&&E.start===0&&(E.start=d);const c=g.audio;let y=!1;i==="audio"&&(c==null?void 0:c.container)==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||l.id===1||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const O=r.start,P={execute:()=>{if(f.executeStart=self.performance.now(),y){const b=this.sourceBuffer[i];if(b){const L=O-b.timestampOffset;Math.abs(L)>=.1&&(We.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${O} (delta: ${L}) sn: ${r.sn})`),b.timestampOffset=O)}}this.appendExecutor(h,i)},onStart:()=>{},onComplete:()=>{const b=self.performance.now();f.executeEnd=f.end=b,_.first===0&&(_.first=b),E&&E.first===0&&(E.first=b);const{sourceBuffer:L}=this,R={};for(const T in L)R[T]=qt.getBuffered(L[T]);this.appendError=0,this.hls.trigger(Ee.BUFFER_APPENDED,{type:i,frag:r,part:u,chunkMeta:l,parent:r.type,timeRanges:R})},onError:b=>{We.error(`[buffer-controller]: Error encountered while trying to append to the ${i} SourceBuffer`,b);const L={type:Ft.MEDIA_ERROR,parent:r.type,details:st.BUFFER_APPEND_ERROR,frag:r,part:u,chunkMeta:l,error:b,err:b,fatal:!1};b.code===DOMException.QUOTA_EXCEEDED_ERR?L.details=st.BUFFER_FULL_ERROR:(this.appendError++,L.details=st.BUFFER_APPEND_ERROR,this.appendError>n.config.appendErrorMaxRetry&&(We.error(`[buffer-controller]: Failed ${n.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),L.fatal=!0)),n.trigger(Ee.ERROR,L)}};o.append(P,i)}onBufferFlushing(e,t){const{operationQueue:n}=this,o=g=>({execute:this.removeExecutor.bind(this,g,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Ee.BUFFER_FLUSHED,{type:g})},onError:h=>{We.warn(`[buffer-controller]: Failed to remove from ${g} SourceBuffer`,h)}});t.type?n.append(o(t.type),t.type):this.getSourceBufferTypes().forEach(g=>{n.append(o(g),g)})}onFragParsed(e,t){const{frag:n,part:o}=t,g=[],h=o?o.elementaryStreams:n.elementaryStreams;h[Jt.AUDIOVIDEO]?g.push("audiovideo"):(h[Jt.AUDIO]&&g.push("audio"),h[Jt.VIDEO]&&g.push("video"));const i=()=>{const r=self.performance.now();n.stats.buffering.end=r,o&&(o.stats.buffering.end=r);const u=o?o.stats:n.stats;this.hls.trigger(Ee.FRAG_BUFFERED,{frag:n,part:o,stats:u,id:n.type})};g.length===0&&We.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(i,g)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((o,g)=>{const h=this.sourceBuffer[g];return h&&(!t.type||t.type===g)&&(h.ending=!0,h.ended||(h.ended=!0,We.log(`[buffer-controller]: ${g} sourceBuffer now EOS`))),o&&!!(!h||h.ended)},!0)&&(We.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(g=>{const h=this.sourceBuffer[g];h&&(h.ending=!1)});const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&We.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}We.log("[buffer-controller]: Calling mediaSource.endOfStream()"),o.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:e,details:t,media:n,sourceBuffer:o}=this;if(!n||t===null)return;const g=this.getSourceBufferTypes();if(!g.length)return;const h=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!xt(h)||h<0)return;const i=n.currentTime,r=t.levelTargetDuration,u=Math.max(h,r),l=Math.floor(i/r)*r-u;g.forEach(f=>{const d=o[f];if(d){const _=qt.getBuffered(d);if(_.length>0&&l>_.start(0)){if(e.trigger(Ee.BACK_BUFFER_REACHED,{bufferEnd:l}),t.live)e.trigger(Ee.LIVE_BACK_BUFFER_REACHED,{bufferEnd:l});else if(d.ended&&_.end(_.length-1)-i<r*2){We.info(`[buffer-controller]: Cannot flush ${f} back buffer while SourceBuffer is in ended state`);return}e.trigger(Ee.BUFFER_FLUSHING,{startOffset:0,endOffset:l,type:f})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:t,media:n,mediaSource:o}=this,g=e.fragments[0].start+e.totalduration,h=n.duration,i=xt(o.duration)?o.duration:0;e.live&&t.config.liveDurationInfinity?(We.log("[buffer-controller]: Media Source duration is set to Infinity"),o.duration=1/0,this.updateSeekableRange(e)):(g>i&&g>h||!xt(h))&&(We.log(`[buffer-controller]: Updating Media Source duration to ${g.toFixed(3)}`),o.duration=g)}updateSeekableRange(e){const t=this.mediaSource,n=e.fragments;if(n.length&&e.live&&t!=null&&t.setLiveSeekableRange){const g=Math.max(0,n[0].start),h=Math.max(g,g+e.totalduration);t.setLiveSeekableRange(g,h)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:n}=this,o=Object.keys(n).length;if(o&&!e||o===2){this.createSourceBuffers(n),this.pendingTracks={};const g=this.getSourceBufferTypes();if(g.length)this.hls.trigger(Ee.BUFFER_CREATED,{tracks:this.tracks}),g.forEach(h=>{t.executeNext(h)});else{const h=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:h,reason:h.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:n}=this;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(const o in e)if(!t[o]){const g=e[o];if(!g)throw Error(`source buffer exists for track ${o}, however track does not`);const h=g.levelCodec||g.codec,i=`${g.container};codecs=${h}`;We.log(`[buffer-controller]: creating sourceBuffer(${i})`);try{const r=t[o]=n.addSourceBuffer(i),u=o;this.addBufferListener(u,"updatestart",this._onSBUpdateStart),this.addBufferListener(u,"updateend",this._onSBUpdateEnd),this.addBufferListener(u,"error",this._onSBUpdateError),this.tracks[o]={buffer:r,codec:h,container:g.container,levelCodec:g.levelCodec,metadata:g.metadata,id:g.id}}catch(r){We.error(`[buffer-controller]: error while trying to add sourceBuffer: ${r.message}`),this.hls.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:i})}}}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){const{operationQueue:t}=this;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){const n=new Error(`${e} SourceBuffer error`);We.error(`[buffer-controller]: ${n}`,t),this.hls.trigger(Ee.ERROR,{type:Ft.MEDIA_ERROR,details:st.BUFFER_APPENDING_ERROR,error:n,fatal:!1});const o=this.operationQueue.current(e);o&&o.onError(t)}removeExecutor(e,t,n){const{media:o,mediaSource:g,operationQueue:h,sourceBuffer:i}=this,r=i[e];if(!o||!g||!r){We.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),h.shiftAndExecuteNext(e);return}const u=xt(o.duration)?o.duration:1/0,l=xt(g.duration)?g.duration:1/0,f=Math.max(0,t),d=Math.min(n,u,l);d>f&&!r.ending?(r.ended=!1,We.log(`[buffer-controller]: Removing [${f},${d}] from the ${e} SourceBuffer`),r.remove(f,d)):h.shiftAndExecuteNext(e)}appendExecutor(e,t){const{operationQueue:n,sourceBuffer:o}=this,g=o[t];if(!g){We.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),n.shiftAndExecuteNext(t);return}g.ended=!1,g.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){We.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:n}=this,o=t.map(g=>n.appendBlocker(g));Promise.all(o).then(()=>{e(),t.forEach(g=>{const h=this.sourceBuffer[g];h!=null&&h.updating||n.shiftAndExecuteNext(g)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,n){const o=this.sourceBuffer[e];if(!o)return;const g=n.bind(this,e);this.listeners[e].push({event:t,listener:g}),o.addEventListener(t,g)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(n=>{t.removeEventListener(n.event,n.listener)})}}const bs={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Xo=function(e){let t=e;return bs.hasOwnProperty(e)&&(t=bs[e]),String.fromCharCode(t)},Ar=15,Ur=100,Xd={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Qd={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Jd={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Zd={25:2,26:4,29:6,30:8,31:10,27:13,28:15},qd=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class eh{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;We.log(`${this.time} [${e}] ${n}`)}}}const en=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class Qo{constructor(e,t,n,o,g){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=o||"black",this.flash=g||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const o=t[n];e.hasOwnProperty(o)&&(this[o]=e[o])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class th{constructor(e,t,n,o,g,h){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Qo(t,n,o,g,h)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class rh{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let t=0;t<Ur;t++)this.chars.push(new th);this.logger=e,this.pos=0,this.currPenState=new Qo}equals(e){let t=!0;for(let n=0;n<Ur;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t}copy(e){for(let t=0;t<Ur;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Ur;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ur&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ur)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Xo(e);if(this.pos>=Ur){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Ur;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Ur;n++){const o=this.chars[n].uchar;o!==" "&&(t=!1),e.push(o)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Vi{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<Ar;t++)this.rows.push(new rh(e));this.logger=e,this.currRow=Ar-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<Ar;e++)this.rows[e].clear();this.currRow=Ar-1}equals(e){let t=!0;for(let n=0;n<Ar;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<Ar;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Ar;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let i=0;i<Ar;i++)this.rows[i].clear();const g=this.currRow+1-this.nrRollUpRows,h=this.lastOutputScreen;if(h){const i=h.rows[g].cueStartTime,r=this.logger.time;if(i&&r!==null&&i<r)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(h.rows[g+u])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const g=e.indent,h=Math.max(g-1,0);n.setCursor(e.indent),e.color=n.chars[h].penState.foreground}const o={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(o)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",o=-1;for(let g=0;g<Ar;g++){const h=this.rows[g].getTextString();h&&(o=g+1,e?t.push("Row "+o+": '"+h+"'"):t.push(h.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class xs{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Vi(n),this.nonDisplayedMemory=new Vi(n),this.lastOutputScreen=new Vi(n),this.currRollUpRow=this.displayedMemory.rows[Ar-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Ar-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,o=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=o[n]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Ns{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const o=new eh;this.channels=[null,new xs(e,t,o),new xs(e+1,n,o)],this.cmdHistory=ws(),this.logger=o}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let n,o,g,h=!1;this.logger.time=e;for(let i=0;i<t.length;i+=2)if(o=t[i]&127,g=t[i+1]&127,!(o===0&&g===0)){if(this.logger.log(3,"["+en([t[i],t[i+1]])+"] -> ("+en([o,g])+")"),n=this.parseCmd(o,g),n||(n=this.parseMidrow(o,g)),n||(n=this.parsePAC(o,g)),n||(n=this.parseBackgroundAttributes(o,g)),!n&&(h=this.parseChars(o,g),h)){const r=this.currentChannel;r&&r>0?this.channels[r].insertChars(h):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!n&&!h&&this.logger.log(2,"Couldn't parse cleaned data "+en([o,g])+" orig: "+en([t[i],t[i+1]]))}}parseCmd(e,t){const{cmdHistory:n}=this,o=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,g=(e===23||e===31)&&t>=33&&t<=35;if(!(o||g))return!1;if(Fs(e,t,n))return fn(null,null,n),this.logger.log(3,"Repeated command ("+en([e,t])+") is dropped"),!0;const h=e===20||e===21||e===23?1:2,i=this.channels[h];return e===20||e===21||e===28||e===29?t===32?i.ccRCL():t===33?i.ccBS():t===34?i.ccAOF():t===35?i.ccAON():t===36?i.ccDER():t===37?i.ccRU(2):t===38?i.ccRU(3):t===39?i.ccRU(4):t===40?i.ccFON():t===41?i.ccRDC():t===42?i.ccTR():t===43?i.ccRTD():t===44?i.ccEDM():t===45?i.ccCR():t===46?i.ccENM():t===47&&i.ccEOC():i.ccTO(t-32),fn(e,t,n),this.currentChannel=h,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const o=this.channels[n];return o?(o.ccMIDROW(t),this.logger.log(3,"MIDROW ("+en([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const o=this.cmdHistory,g=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,h=(e===16||e===24)&&t>=64&&t<=95;if(!(g||h))return!1;if(Fs(e,t,o))return fn(null,null,o),!0;const i=e<=23?1:2;t>=64&&t<=95?n=i===1?Xd[e]:Jd[e]:n=i===1?Qd[e]:Zd[e];const r=this.channels[i];return r?(r.setPAC(this.interpretPAC(n,t)),fn(e,t,o),this.currentChannel=i,!0):!1}interpretPAC(e,t){let n;const o={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,o.underline=(n&1)===1,n<=13?o.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(o.italics=!0,o.color="white"):o.indent=Math.floor((n-16)/2)*4,o}parseChars(e,t){let n,o=null,g=null;if(e>=25?(n=2,g=e-8):(n=1,g=e),g>=17&&g<=19){let h;g===17?h=t+80:g===18?h=t+112:h=t+144,this.logger.log(2,"Special char '"+Xo(h)+"' in channel "+n),o=[h]}else e>=32&&e<=127&&(o=t===0?[e]:[e,t]);if(o){const h=en(o);this.logger.log(3,"Char codes =  "+h.join(",")),fn(e,t,this.cmdHistory)}return o}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,o=(e===23||e===31)&&t>=45&&t<=47;if(!(n||o))return!1;let g;const h={};e===16||e===24?(g=Math.floor((t-32)/2),h.background=qd[g],t%2===1&&(h.background=h.background+"_semi")):t===45?h.background="transparent":(h.foreground="black",t===47&&(h.underline=!0));const i=e<=23?1:2;return this.channels[i].setBkgData(h),fn(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory=ws()}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function fn(v,e,t){t.a=v,t.b=e}function Fs(v,e,t){return t.a===v&&t.b===e}function ws(){return{a:null,b:null}}class Gn{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Oa=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;const v=["","lr","rl"],e=["start","middle","end","left","right"];function t(i,r){if(typeof r!="string"||!Array.isArray(i))return!1;const u=r.toLowerCase();return~i.indexOf(u)?u:!1}function n(i){return t(v,i)}function o(i){return t(e,i)}function g(i,...r){let u=1;for(;u<arguments.length;u++){const l=arguments[u];for(const f in l)i[f]=l[f]}return i}function h(i,r,u){const l=this,f={enumerable:!0};l.hasBeenReset=!1;let d="",_=!1,E=i,c=r,y=u,O=null,P="",b=!0,L="auto",R="start",T=50,m="middle",M=50,p="middle";Object.defineProperty(l,"id",g({},f,{get:function(){return d},set:function(C){d=""+C}})),Object.defineProperty(l,"pauseOnExit",g({},f,{get:function(){return _},set:function(C){_=!!C}})),Object.defineProperty(l,"startTime",g({},f,{get:function(){return E},set:function(C){if(typeof C!="number")throw new TypeError("Start time must be set to a number.");E=C,this.hasBeenReset=!0}})),Object.defineProperty(l,"endTime",g({},f,{get:function(){return c},set:function(C){if(typeof C!="number")throw new TypeError("End time must be set to a number.");c=C,this.hasBeenReset=!0}})),Object.defineProperty(l,"text",g({},f,{get:function(){return y},set:function(C){y=""+C,this.hasBeenReset=!0}})),Object.defineProperty(l,"region",g({},f,{get:function(){return O},set:function(C){O=C,this.hasBeenReset=!0}})),Object.defineProperty(l,"vertical",g({},f,{get:function(){return P},set:function(C){const I=n(C);if(I===!1)throw new SyntaxError("An invalid or illegal string was specified.");P=I,this.hasBeenReset=!0}})),Object.defineProperty(l,"snapToLines",g({},f,{get:function(){return b},set:function(C){b=!!C,this.hasBeenReset=!0}})),Object.defineProperty(l,"line",g({},f,{get:function(){return L},set:function(C){if(typeof C!="number"&&C!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");L=C,this.hasBeenReset=!0}})),Object.defineProperty(l,"lineAlign",g({},f,{get:function(){return R},set:function(C){const I=o(C);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");R=I,this.hasBeenReset=!0}})),Object.defineProperty(l,"position",g({},f,{get:function(){return T},set:function(C){if(C<0||C>100)throw new Error("Position must be between 0 and 100.");T=C,this.hasBeenReset=!0}})),Object.defineProperty(l,"positionAlign",g({},f,{get:function(){return m},set:function(C){const I=o(C);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");m=I,this.hasBeenReset=!0}})),Object.defineProperty(l,"size",g({},f,{get:function(){return M},set:function(C){if(C<0||C>100)throw new Error("Size must be between 0 and 100.");M=C,this.hasBeenReset=!0}})),Object.defineProperty(l,"align",g({},f,{get:function(){return p},set:function(C){const I=o(C);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");p=I,this.hasBeenReset=!0}})),l.displayState=void 0}return h.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},h}();class nh{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Jo(v){function e(n,o,g,h){return(n|0)*3600+(o|0)*60+(g|0)+parseFloat(h||0)}const t=v.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class ih{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let o=0;o<n.length;++o)if(t===n[o]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function Zo(v,e,t,n){const o=n?v.split(n):[v];for(const g in o){if(typeof o[g]!="string")continue;const h=o[g].split(t);if(h.length!==2)continue;const i=h[0],r=h[1];e(i,r)}}const fa=new Oa(0,0,""),Hn=fa.align==="middle"?"middle":"center";function ah(v,e,t){const n=v;function o(){const i=Jo(v);if(i===null)throw new Error("Malformed timestamp: "+n);return v=v.replace(/^[^\sa-zA-Z-]+/,""),i}function g(i,r){const u=new ih;Zo(i,function(d,_){let E;switch(d){case"region":for(let c=t.length-1;c>=0;c--)if(t[c].id===_){u.set(d,t[c].region);break}break;case"vertical":u.alt(d,_,["rl","lr"]);break;case"line":E=_.split(","),u.integer(d,E[0]),u.percent(d,E[0])&&u.set("snapToLines",!1),u.alt(d,E[0],["auto"]),E.length===2&&u.alt("lineAlign",E[1],["start",Hn,"end"]);break;case"position":E=_.split(","),u.percent(d,E[0]),E.length===2&&u.alt("positionAlign",E[1],["start",Hn,"end","line-left","line-right","auto"]);break;case"size":u.percent(d,_);break;case"align":u.alt(d,_,["start",Hn,"end","left","right"]);break}},/:/,/\s/),r.region=u.get("region",null),r.vertical=u.get("vertical","");let l=u.get("line","auto");l==="auto"&&fa.line===-1&&(l=-1),r.line=l,r.lineAlign=u.get("lineAlign","start"),r.snapToLines=u.get("snapToLines",!0),r.size=u.get("size",100),r.align=u.get("align",Hn);let f=u.get("position","auto");f==="auto"&&fa.position===50&&(f=r.align==="start"||r.align==="left"?0:r.align==="end"||r.align==="right"?100:50),r.position=f}function h(){v=v.replace(/^\s+/,"")}if(h(),e.startTime=o(),h(),v.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);v=v.slice(3),h(),e.endTime=o(),h(),g(v,e)}function qo(v){return v.replace(/<br(?: \/)?>/gi,`
`)}class sh{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new nh,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let g=t.buffer,h=0;for(g=qo(g);h<g.length&&g[h]!=="\r"&&g[h]!==`
`;)++h;const i=g.slice(0,h);return g[h]==="\r"&&++h,g[h]===`
`&&++h,t.buffer=g.slice(h),i}function o(g){Zo(g,function(h,i){},/:/)}try{let g="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;g=n();const i=g.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(i!=null&&i[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let h=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(h?h=!1:g=n(),t.state){case"HEADER":/:/.test(g)?o(g):g||(t.state="ID");continue;case"NOTE":g||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(g)){t.state="NOTE";break}if(!g)continue;if(t.cue=new Oa(0,0,""),t.state="CUE",g.indexOf("-->")===-1){t.cue.id=g;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{ah(g,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const i=g.indexOf("-->")!==-1;if(!g||i&&(h=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=g}continue;case"BADCUE":g||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const oh=/\r\n|\n\r|\n|\r/g,Yi=function(e,t,n=0){return e.slice(n,n+t.length)===t},lh=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),o=parseInt(e.slice(-9,-7)),g=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!xt(t)||!xt(n)||!xt(o)||!xt(g))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*o,t+=60*60*1e3*g,t},zi=function(e){let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return(t>>>0).toString()};function La(v,e,t){return zi(v.toString())+zi(e.toString())+zi(t)}const uh=function(e,t,n){let o=e[t],g=e[o.prevCC];if(!g||!g.new&&o.new){e.ccOffset=e.presentationOffset=o.start,o.new=!1;return}for(;(h=g)!=null&&h.new;){var h;e.ccOffset+=o.start-g.start,o.new=!1,o=g,g=e[o.prevCC]}e.presentationOffset=n};function fh(v,e,t,n,o,g,h){const i=new sh,r=br(new Uint8Array(v)).trim().replace(oh,`
`).split(`
`),u=[],l=yd(e.baseTime,e.timescale);let f="00:00.000",d=0,_=0,E,c=!0;i.oncue=function(y){const O=t[n];let P=t.ccOffset;const b=(d-l)/9e4;O!=null&&O.new&&(_!==void 0?P=t.ccOffset=O.start:uh(t,n,b)),b&&(P=b-t.presentationOffset);const L=y.endTime-y.startTime,R=Tr((y.startTime+P-_)*9e4,o*9e4)/9e4;y.startTime=Math.max(R,0),y.endTime=Math.max(R+L,0);const T=y.text.trim();y.text=decodeURIComponent(encodeURIComponent(T)),y.id||(y.id=La(y.startTime,y.endTime,T)),y.endTime>0&&u.push(y)},i.onparsingerror=function(y){E=y},i.onflush=function(){if(E){h(E);return}g(u)},r.forEach(y=>{if(c)if(Yi(y,"X-TIMESTAMP-MAP=")){c=!1,y.slice(16).split(",").forEach(O=>{Yi(O,"LOCAL:")?f=O.slice(6):Yi(O,"MPEGTS:")&&(d=parseInt(O.slice(7)))});try{_=lh(f)/1e3}catch(O){E=O}return}else y===""&&(c=!1);i.parse(y+`
`)}),i.flush()}const $i="stpp.ttml.im1t",el=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,tl=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,ch={left:"start",center:"center",right:"end",start:"start",end:"end"};function Bs(v,e,t,n){const o=$t(new Uint8Array(v),["mdat"]);if(o.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const g=o.map(i=>br(i)),h=Td(e.baseTime,1,e.timescale);try{g.forEach(i=>t(dh(i,h)))}catch(i){n(i)}}function dh(v,e){const o=new DOMParser().parseFromString(v,"text/xml").getElementsByTagName("tt")[0];if(!o)throw new Error("Invalid ttml");const g={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},h=Object.keys(g).reduce((f,d)=>(f[d]=o.getAttribute(`ttp:${d}`)||g[d],f),{}),i=o.getAttribute("xml:space")!=="preserve",r=Us(Xi(o,"styling","style")),u=Us(Xi(o,"layout","region")),l=Xi(o,"body","[begin]");return[].map.call(l,f=>{const d=rl(f,i);if(!d||!f.hasAttribute("begin"))return null;const _=Ji(f.getAttribute("begin"),h),E=Ji(f.getAttribute("dur"),h);let c=Ji(f.getAttribute("end"),h);if(_===null)throw ks(f);if(c===null){if(E===null)throw ks(f);c=_+E}const y=new Oa(_-e,c-e,d);y.id=La(y.startTime,y.endTime,y.text);const O=u[f.getAttribute("region")],P=r[f.getAttribute("style")],b=hh(O,P,r),{textAlign:L}=b;if(L){const R=ch[L];R&&(y.lineAlign=R),y.align=L}return ar(y,b),y}).filter(f=>f!==null)}function Xi(v,e,t){const n=v.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function Us(v){return v.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function rl(v,e){return[].slice.call(v.childNodes).reduce((t,n,o)=>{var g;return n.nodeName==="br"&&o?t+`
`:(g=n.childNodes)!=null&&g.length?rl(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function hh(v,e,t){const n="http://www.w3.org/ns/ttml#styling";let o=null;const g=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],h=v!=null&&v.hasAttribute("style")?v.getAttribute("style"):null;return h&&t.hasOwnProperty(h)&&(o=t[h]),g.reduce((i,r)=>{const u=Qi(e,n,r)||Qi(v,n,r)||Qi(o,n,r);return u&&(i[r]=u),i},{})}function Qi(v,e,t){return v&&v.hasAttributeNS(e,t)?v.getAttributeNS(e,t):null}function ks(v){return new Error(`Could not parse ttml timestamp ${v}`)}function Ji(v,e){if(!v)return null;let t=Jo(v);return t===null&&(el.test(v)?t=gh(v,e):tl.test(v)&&(t=mh(v,e))),t}function gh(v,e){const t=el.exec(v),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function mh(v,e){const t=tl.exec(v),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class Eh{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ks(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const t=new Gn(this,"textTrack1"),n=new Gn(this,"textTrack2"),o=new Gn(this,"textTrack3"),g=new Gn(this,"textTrack4");this.cea608Parser1=new Ns(1,t,n),this.cea608Parser2=new Ns(3,o,g)}e.on(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Ee.FRAG_LOADING,this.onFragLoading,this),e.on(Ee.FRAG_LOADED,this.onFragLoaded,this),e.on(Ee.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(Ee.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(Ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Ee.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Ee.FRAG_LOADING,this.onFragLoading,this),e.off(Ee.FRAG_LOADED,this.onFragLoaded,this),e.off(Ee.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(Ee.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(Ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Ee.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,n,o,g){let h=!1;for(let i=g.length;i--;){const r=g[i],u=vh(r[0],r[1],t,n);if(u>=0&&(r[0]=Math.min(r[0],t),r[1]=Math.max(r[1],n),h=!0,u/(n-t)>.5))return}if(h||g.push([t,n]),this.config.renderTextTracksNatively){const i=this.captionsTracks[e];this.Cues.newCue(i,t,n,o)}else{const i=this.Cues.newCue(null,t,n,o);this.hls.trigger(Ee.CUES_PARSED,{type:"captions",cues:i,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:o,timescale:g}){const{unparsedVttFrags:h}=this;n==="main"&&(this.initPTS[t.cc]={baseTime:o,timescale:g}),h.length&&(this.unparsedVttFrags=[],h.forEach(i=>{this.onFragLoaded(Ee.FRAG_LOADED,i)}))}getExistingTrack(e){const{media:t}=this;if(t)for(let n=0;n<t.textTracks.length;n++){const o=t.textTracks[n];if(o[e])return o}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:o}=this,{label:g,languageCode:h}=t[e],i=this.getExistingTrack(e);if(i)n[e]=i,cn(n[e]),Do(n[e],o);else{const r=this.createTextTrack("captions",g,h);r&&(r[e]=!0,n[e]=r)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,o={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=o,this.hls.trigger(Ee.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[o]})}createTextTrack(e,t,n){const o=this.media;if(o)return o.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{cn(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ks(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)cn(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],o=n.some(g=>g.textCodec===$i);if(this.config.enableWebVTT||o&&this.config.enableIMSC1){if($o(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const h=this.media?this.media.textTracks:null;this.tracks.forEach((i,r)=>{let u;if(h&&r<h.length){let l=null;for(let f=0;f<h.length;f++)if(_h(h[f],i)){l=h[f];break}l&&(u=l)}if(u)cn(u);else{const l=this._captionsOrSubtitlesFromCharacteristics(i);u=this.createTextTrack(l,i.name,i.lang),u&&(u.mode="disabled")}u&&(u.groupId=i.groupId,this.textTracks.push(u))})}else if(this.tracks.length){const h=this.tracks.map(i=>({label:i.name,kind:i.type.toLowerCase(),default:i.default,subtitleTrack:i}));this.hls.trigger(Ee.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:h})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){const t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),n=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&n)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const o=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!o)return;const g=`textTrack${o[1]}`,h=this.captionsProperties[g];h&&(h.label=n.name,n.lang&&(h.languageCode=n.lang),h.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){const{cea608Parser1:n,cea608Parser2:o,lastSn:g,lastPartIndex:h}=this;if(!(!this.enabled||!(n&&o))&&t.frag.type===Bt.MAIN){var i,r;const u=t.frag.sn,l=(i=t==null||(r=t.part)==null?void 0:r.index)!=null?i:-1;u===g+1||u===g&&l===h+1||(n.reset(),o.reset()),this.lastSn=u,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:n,payload:o}=t,{initPTS:g,unparsedVttFrags:h}=this;if(n.type===Bt.SUBTITLE)if(o.byteLength){if(!g[n.cc]){h.push(t),g.length&&this.hls.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")});return}const i=n.decryptdata,r="stats"in t;if(i==null||!i.encrypted||r){const u=this.tracks[n.level],l=this.vttCCs;l[n.cc]||(l[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),u&&u.textCodec===$i?this._parseIMSC1(n,o):this._parseVTTs(n,o,l)}}else this.hls.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Bs(t,this.initPTS[e.cc],o=>{this._appendCues(o,e.level),n.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},o=>{We.log(`Failed to parse IMSC1: ${o}`),n.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:o})})}_parseVTTs(e,t,n){var o;const g=this.hls,h=(o=e.initSegment)!=null&&o.data?nn(e.initSegment.data,new Uint8Array(t)):t;fh(h,this.initPTS[e.cc],n,e.cc,e.start,i=>{this._appendCues(i,e.level),g.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{this._fallbackToIMSC1(e,t),We.log(`Failed to parse VTT cue: ${i}`),g.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Bs(t,this.initPTS[e.cc],()=>{n.textCodec=$i,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const o=this.textTracks[t];if(!o||o.mode==="disabled")return;e.forEach(g=>Io(o,g))}else{const o=this.tracks[t];if(!o)return;const g=o.default?"default":"subtitles"+t;n.trigger(Ee.CUES_PARSED,{type:"subtitles",cues:e,track:g})}}onFragDecrypted(e,t){const{frag:n}=t;if(n.type===Bt.SUBTITLE){if(!this.initPTS[n.cc]){this.unparsedVttFrags.push(t);return}this.onFragLoaded(Ee.FRAG_LOADED,t)}}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){const{cea608Parser1:n,cea608Parser2:o}=this;if(!this.enabled||!(n&&o))return;const{frag:g,samples:h}=t;if(!(g.type===Bt.MAIN&&this.closedCaptionsForLevel(g)==="NONE"))for(let i=0;i<h.length;i++){const r=h[i].bytes;if(r){const u=this.extractCea608Data(r);n.addData(h[i].pts,u[0]),o.addData(h[i].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:o,type:g}){const{media:h}=this;if(!(!h||h.currentTime<n)){if(!g||g==="video"){const{captionsTracks:i}=this;Object.keys(i).forEach(r=>ia(i[r],t,n))}if(this.config.renderTextTracksNatively&&t===0&&o!==void 0){const{textTracks:i}=this;Object.keys(i).forEach(r=>ia(i[r],t,o))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let o=2;for(let g=0;g<n;g++){const h=e[o++],i=127&e[o++],r=127&e[o++];if(i===0&&r===0)continue;if((4&h)!==0){const l=3&h;(l===0||l===1)&&(t[l].push(i),t[l].push(r))}}return t}}function _h(v,e){return!!v&&v.label===e.name&&!(v.textTrack1||v.textTrack2)}function vh(v,e,t,n){return Math.min(e,n)-Math.max(v,t)}function Ks(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class ba{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(Ee.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(Ee.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const e=this.hls.levels;if(e.length){const t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((o,g)=>this.isLevelAllowed(o)&&g<=e);return this.clientRect=null,ba.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const o=(h,i)=>i?h.width!==i.width||h.height!==i.height:!0;let g=e.length-1;for(let h=0;h<e.length;h+=1){const i=e[h];if((i.width>=t||i.height>=n)&&o(i,e[h+1])){g=h;break}}return g}}class ph{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const o=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=o,o&&typeof o.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,n){const o=performance.now();if(t){if(this.lastTime){const g=o-this.lastTime,h=n-this.lastDroppedFrames,i=t-this.lastDecodedFrames,r=1e3*h/g,u=this.hls;if(u.trigger(Ee.FPS_DROP,{currentDropped:h,currentDecoded:i,totalDroppedFrames:n}),r>0&&h>u.config.fpsDroppedMonitoringThreshold*i){let l=u.currentLevel;We.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=l)&&(l=l-1,u.trigger(Ee.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:u.currentLevel}),u.autoLevelCapping=l,this.streamController.nextLevelSwitch())}}this.lastTime=o,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const Vn="[eme]";class dn{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=dn.CDMCleanupPromise?[dn.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=We.debug.bind(We,Vn),this.log=We.log.bind(We,Vn),this.warn=We.warn.bind(We,Vn),this.error=We.error.bind(We,Vn),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Ee.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Ee.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Ee.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Ee.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,o=t[e];if(o)return o.licenseUrl;if(e===tr.WIDEVINE&&n)return n;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(h,i,r)=>!!h&&r.indexOf(h)===i,o=t.map(h=>h.audioCodec).filter(n),g=t.map(h=>h.videoCodec).filter(n);return o.length+g.length===0&&g.push("avc1.42e01e"),new Promise((h,i)=>{const r=u=>{const l=u.shift();this.getMediaKeysPromise(l,o,g).then(f=>h({keySystem:l,mediaKeys:f})).catch(f=>{u.length?r(u):f instanceof vr?i(f):i(new vr({type:Ft.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_NO_ACCESS,error:f,fatal:!0},f.message))})};r(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let o=`Configured requestMediaKeySystemAccess is not a function ${n}`;return ho===null&&self.location.protocol==="http:"&&(o=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(o))}return n(e,t)}getMediaKeysPromise(e,t,n){const o=xf(e,t,n,this.config.drmSystemOptions),g=this.keySystemAccessPromises[e];let h=g==null?void 0:g.keySystemAccess;if(!h){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(o)}`),h=this.requestMediaKeySystemAccess(e,o);const i=this.keySystemAccessPromises[e]={keySystemAccess:h};return h.catch(r=>{this.log(`Failed to obtain access to key-system "${e}": ${r}`)}),h.then(r=>{this.log(`Access for key-system "${r.keySystem}" obtained`);const u=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),i.mediaKeys=r.createMediaKeys().then(l=>(this.log(`Media-keys created for "${e}"`),u.then(f=>f?this.setMediaKeysServerCertificate(l,e,f):l))),i.mediaKeys.catch(l=>{this.error(`Failed to create media-keys for "${e}"}: ${l}`)}),i.mediaKeys})}return h.then(()=>g.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${Mr.hexDump(e.keyId||[])}`);const o=n.createSession(),g={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:o,keyStatus:"status-pending"};return this.mediaKeySessions.push(g),g}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),o=this.getKeyIdString(t),g="cenc";this.keyIdToKeySessionPromise[o]=this.generateRequestWithPreferredKeySession(n,g,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Mr.hexDump(e.keyId)}updateKeySession(e,t){var n;const o=e.mediaKeysSession;return this.log(`Updating key-session "${o.sessionId}" for keyID ${Mr.hexDump(((n=e.decryptdata)==null?void 0:n.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),o.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,n)=>{const o=Pi(this.config),g=e.map(Za).filter(h=>!!h&&o.indexOf(h)!==-1);return this.getKeySystemSelectionPromise(g).then(({keySystem:h})=>{const i=qa(h);i?t(i):n(new Error(`Unable to find format for key-system "${h}"`))}).catch(n)})}loadKey(e){const t=e.keyInfo.decryptdata,n=this.getKeyIdString(t),o=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${o}`);let g=this.keyIdToKeySessionPromise[n];return g||(g=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(t).then(({keySystem:h,mediaKeys:i})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${o}`),this.attemptSetMediaKeys(h,i).then(()=>{this.throwIfDestroyed();const r=this.createMediaKeySessionContext({keySystem:h,mediaKeys:i,decryptdata:t}),u="cenc";return this.generateRequestWithPreferredKeySession(r,u,t.pssh,"playlist-key")}))),g.catch(h=>this.handleError(h))),g}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof vr?this.hls.trigger(Ee.ERROR,e.data):this.hls.trigger(Ee.ERROR,{type:Ft.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){const o=Za(e.keyFormat),g=o?[o]:Pi(this.config);return this.attemptKeySystemAccess(g)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=Pi(this.config)),e.length===0)throw new vr({type:Ft.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:n}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),n===null)return;let o,g;if(t==="sinf"&&this.config.drmSystems[tr.FAIRPLAY]){const l=or(new Uint8Array(n));try{const f=va(JSON.parse(l).sinf),d=yo(new Uint8Array(f));if(!d)return;o=d.subarray(8,24),g=tr.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const l=nc(n);if(l===null)return;l.version===0&&l.systemId===co.WIDEVINE&&l.data&&(o=l.data.subarray(8,24)),g=bf(l.systemId)}if(!g||!o)return;const h=Mr.hexDump(o),{keyIdToKeySessionPromise:i,mediaKeySessions:r}=this;let u=i[h];for(let l=0;l<r.length;l++){const f=r[l],d=f.decryptdata;if(d.pssh||!d.keyId)continue;const _=Mr.hexDump(d.keyId);if(h===_||d.uri.replace(/-/g,"").indexOf(h)!==-1){u=i[_],delete i[_],d.pssh=new Uint8Array(n),d.keyId=o,u=i[h]=u.then(()=>this.generateRequestWithPreferredKeySession(f,t,n,"encrypted-event-key-match"));break}}u||(u=i[h]=this.getKeySystemSelectionPromise([g]).then(({keySystem:l,mediaKeys:f})=>{var d;this.throwIfDestroyed();const _=new In("ISO-23001-7",h,(d=qa(l))!=null?d:"");return _.pssh=new Uint8Array(n),_.keyId=o,this.attemptSetMediaKeys(l,f).then(()=>{this.throwIfDestroyed();const E=this.createMediaKeySessionContext({decryptdata:_,keySystem:l,mediaKeys:f});return this.generateRequestWithPreferredKeySession(E,t,n,"encrypted-event-no-match")})})),u.catch(l=>this.handleError(l))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const o=Promise.all(n).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(o),o.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(o),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(g=>n.indexOf(g)===-1)})}generateRequestWithPreferredKeySession(e,t,n,o){var g,h;const i=(g=this.config.drmSystems)==null||(h=g[e.keySystem])==null?void 0:h.generateRequest;if(i)try{const d=i.call(this.hls,t,n,e);if(!d)throw new Error("Invalid response from configured generateRequest filter");t=d.initDataType,n=e.decryptdata.pssh=d.initData?new Uint8Array(d.initData):null}catch(d){var r;if(this.warn(d.message),(r=this.hls)!=null&&r.config.debug)throw d}if(n===null)return this.log(`Skipping key-session request for "${o}" (no initData)`),Promise.resolve(e);const u=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${o}": ${u} (init data type: ${t} length: ${n?n.byteLength:null})`);const l=new Mn;e.mediaKeysSession.onmessage=d=>{const _=e.mediaKeysSession;if(!_){l.emit("error",new Error("invalid state"));return}const{messageType:E,message:c}=d;this.log(`"${E}" message event for session "${_.sessionId}" message size: ${c.byteLength}`),E==="license-request"||E==="license-renewal"?this.renewLicense(e,c).catch(y=>{this.handleError(y),l.emit("error",y)}):E==="license-release"?e.keySystem===tr.FAIRPLAY&&(this.updateKeySession(e,fo("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${E}"`)},e.mediaKeysSession.onkeystatuseschange=d=>{if(!e.mediaKeysSession){l.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const E=e.keyStatus;l.emit("keyStatus",E),E==="expired"&&(this.warn(`${e.keySystem} expired for key ${u}`),this.renewKeySession(e))};const f=new Promise((d,_)=>{l.on("error",_),l.on("keyStatus",E=>{E.startsWith("usable")?d():E==="output-restricted"?_(new vr({type:Ft.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):E==="internal-error"?_(new vr({type:Ft.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${E}"`)):E==="expired"?_(new Error("key expired while generating request")):this.warn(`unhandled key status change "${E}"`)})});return e.mediaKeysSession.generateRequest(t,n).then(()=>{var d;this.log(`Request generated for key-session "${(d=e.mediaKeysSession)==null?void 0:d.sessionId}" keyId: ${u}`)}).catch(d=>{throw new vr({type:Ft.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_NO_SESSION,error:d,fatal:!1},`Error generating key-session request: ${d}`)}).then(()=>f).catch(d=>{throw l.removeAllListeners(),this.removeSession(e),d}).then(()=>(l.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,n)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Mr.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${Mr.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,n=t.loader,o=new n(t),g=this.getServerCertificateUrl(e);return g?(this.log(`Fetching serverCertificate for "${e}"`),new Promise((h,i)=>{const r={responseType:"arraybuffer",url:g},u=t.certLoadPolicy.default,l={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(d,_,E,c)=>{h(d.data)},onError:(d,_,E,c)=>{i(new vr({type:Ft.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:mr({url:r.url,data:void 0},d)},`"${e}" certificate request failed (${g}). Status: ${d.code} (${d.text})`))},onTimeout:(d,_,E)=>{i(new vr({type:Ft.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:r.url,data:void 0}},`"${e}" certificate request timed out (${g})`))},onAbort:(d,_,E)=>{i(new Error("aborted"))}};o.load(r,l,f)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((o,g)=>{e.setServerCertificate(n).then(h=>{this.log(`setServerCertificate ${h?"success":"not supported by CDM"} (${n==null?void 0:n.byteLength}) on "${t}"`),o(e)}).catch(h=>{g(new vr({type:Ft.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:h,fatal:!0},h.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(o=>{throw new vr({type:Ft.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:o,fatal:!0},o.message)}))}setupLicenseXHR(e,t,n,o){const g=this.config.licenseXhrSetup;return g?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return g.call(this.hls,e,t,n,o)}).catch(h=>{if(!n.decryptdata)throw h;return e.open("POST",t,!0),g.call(this.hls,e,t,n,o)}).then(h=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:h||o})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:o}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((o,g)=>{const h=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${h}`);const i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return g(new Error("invalid state"));if(i.readyState===4)if(i.status===200){this._requestLicenseFailureCount=0;let r=i.response;this.log(`License received ${r instanceof ArrayBuffer?r.byteLength:r}`);const u=this.config.licenseResponseCallback;if(u)try{r=u.call(this.hls,i,h,e)}catch(l){this.error(l)}o(r)}else{const r=n.errorRetry,u=r?r.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||i.status>=400&&i.status<500)g(new vr({type:Ft.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:h,data:void 0,code:i.status,text:i.statusText}},`License Request XHR failed (${h}). Status: ${i.status} (${i.statusText})`));else{const l=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${l} attempts left`),this.requestLicense(e,t).then(o,g)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=i,this.setupLicenseXHR(i,h,e,t).then(({xhr:r,licenseChallenge:u})=>{r.send(u)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},In.clearKeyUriToKeyIdMap();const n=t.length;dn.CDMCleanupPromise=Promise.all(t.map(o=>this.removeSession(o)).concat(e==null?void 0:e.setMediaKeys(null).catch(o=>{this.log(`Could not clear media keys: ${o}. media.src: ${e==null?void 0:e.src}`)}))).then(()=>{n&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}. media.src: ${e==null?void 0:e.src}`)})}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((o,g)=>(o.indexOf(g.keyFormat)===-1&&o.push(g.keyFormat),o),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),t.onmessage=null,t.onkeystatuseschange=null,n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const o=this.mediaKeySessions.indexOf(e);return o>-1&&this.mediaKeySessions.splice(o,1),t.remove().catch(g=>{this.log(`Could not remove session: ${g}`)}).then(()=>t.close()).catch(g=>{this.log(`Could not close session: ${g}`)})}}}dn.CDMCleanupPromise=void 0;class vr extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}const Th=1;var cr={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"};const yh="h";class zr{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=o=>{try{this.apply(o,{ot:cr.MANIFEST,su:!this.initialized})}catch(g){We.warn("Could not generate manifest CMCD data.",g)}},this.applyFragmentData=o=>{try{const g=o.frag,h=this.hls.levels[g.level],i=this.getObjectType(g),r={d:g.duration*1e3,ot:i};(i===cr.VIDEO||i===cr.AUDIO||i==cr.MUXED)&&(r.br=h.bitrate/1e3,r.tb=this.getTopBandwidth(i)/1e3,r.bl=this.getBufferLength(i)),this.apply(o,r)}catch(g){We.warn("Could not generate segment CMCD data.",g)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||zr.uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.registerListeners())}registerListeners(){const e=this.hls;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHED,this.onMediaDetached,this),e.on(Ee.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHED,this.onMediaDetached,this),e.off(Ee.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,o;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(o=t.tracks.video)==null?void 0:o.buffer}createData(){var e;return{v:Th,sf:yh,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ar(t,this.createData());const n=t.ot===cr.INIT||t.ot===cr.VIDEO||t.ot===cr.MUXED;if(this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){const o=zr.toHeaders(t);if(!Object.keys(o).length)return;e.headers||(e.headers={}),ar(e.headers,o)}else{const o=zr.toQuery(t);if(!o)return;e.url=zr.appendQueryToUri(e.url,o)}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return cr.TIMED_TEXT;if(e.sn==="initSegment")return cr.INIT;if(t==="audio")return cr.AUDIO;if(t==="main")return this.hls.audioTracks.length?cr.VIDEO:cr.MUXED}getTopBandwidth(e){let t=0,n;const o=this.hls;if(e===cr.AUDIO)n=o.audioTracks;else{const g=o.maxAutoLevel,h=g>-1?g+1:o.levels.length;n=o.levels.slice(0,h)}for(const g of n)g.bitrate>t&&(t=g.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,n=e===cr.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:qt.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(g){this.loader=void 0,this.loader=new n(g)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(g,h,i){t(g),this.loader.load(g,h,i)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(g){this.loader=void 0,this.loader=new n(g)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(g,h,i){t(g),this.loader.load(g,h,i)}}}static uuid(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){const t=[],n=u=>!Number.isNaN(u)&&u!=null&&u!==""&&u!==!1,o=u=>Math.round(u),g=u=>o(u/100)*100,i={br:o,d:o,bl:g,dl:g,mtp:g,nor:u=>encodeURIComponent(u),rtp:g,tb:o},r=Object.keys(e||{}).sort();for(const u of r){let l=e[u];if(!n(l)||u==="v"&&l===1||u=="pr"&&l===1)continue;const f=i[u];f&&(l=f(l));const d=typeof l;let _;u==="ot"||u==="sf"||u==="st"?_=`${u}=${l}`:d==="boolean"?_=u:d==="number"?_=`${u}=${l}`:_=`${u}=${JSON.stringify(l)}`,t.push(_)}return t.join(",")}static toHeaders(e){const t=Object.keys(e),n={},o=["Object","Request","Session","Status"],g=[{},{},{},{}],h={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const i of t){const r=h[i]!=null?h[i]:1;g[r][i]=e[i]}for(let i=0;i<g.length;i++){const r=zr.serialize(g[i]);r&&(n[`CMCD-${o[i]}`]=r)}return n}static toQuery(e){return`CMCD=${encodeURIComponent(zr.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;const n=e.includes("?")?"&":"?";return`${e}${n}${t}`}}const Ah=3e5;class Sh{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=We.log.bind(We,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const e=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===hr.SendAlternateToPenaltyBox&&n.flags===pr.MoveAllAlternatesMatchingHost){let o=this.pathwayPriority;const g=this.pathwayId;this.penalizedPathways[g]||(this.penalizedPathways[g]=performance.now()),!o&&this.levels&&(o=this.levels.reduce((h,i)=>(h.indexOf(i.pathwayId)===-1&&h.push(i.pathwayId),h),[])),o&&o.length>1&&(this.updatePathwayPriority(o),n.resolved=this.pathwayId!==g)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t;const n=this.penalizedPathways,o=performance.now();Object.keys(n).forEach(g=>{o-n[g]>Ah&&delete n[g]});for(let g=0;g<e.length;g++){const h=e[g];if(n[h])continue;if(h===this.pathwayId)return;const i=this.hls.nextLoadLevel,r=this.hls.levels[i];if(t=this.getLevelsForPathway(h),t.length>0){this.log(`Setting Pathway to "${h}"`),this.pathwayId=h,this.hls.trigger(Ee.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[i];r&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==r.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==r.bitrate&&this.log(`Unstable Pathways change from bitrate ${r.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=i);break}}}clonePathways(e){const t=this.levels;if(!t)return;const n={},o={};e.forEach(g=>{const{ID:h,"BASE-ID":i,"URI-REPLACEMENT":r}=g;if(t.some(l=>l.pathwayId===h))return;const u=this.getLevelsForPathway(i).map(l=>{const f=ar({},l);f.details=void 0,f.url=nl(l.uri,l.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",r);const d=new er(l.attrs);d["PATHWAY-ID"]=h;const _=d.AUDIO&&`${d.AUDIO}_clone_${h}`,E=d.SUBTITLES&&`${d.SUBTITLES}_clone_${h}`;_&&(n[d.AUDIO]=_,d.AUDIO=_),E&&(o[d.SUBTITLES]=E,d.SUBTITLES=E),f.attrs=d;const c=new Cn(f);return ri(c,"audio",_),ri(c,"text",E),c});t.push(...u),js(this.audioTracks,n,r,h),js(this.subtitleTracks,o,r,h)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let o;try{o=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(o.protocol!=="data:"){const l=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;o.searchParams.set("_HLS_pathway",this.pathwayId),o.searchParams.set("_HLS_throughput",""+l)}const g={responseType:"json",url:o.href},h=t.steeringManifestLoadPolicy.default,i=h.errorRetry||h.timeoutRetry||{},r={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:i.maxNumRetry||0,retryDelay:i.retryDelayMs||0,maxRetryDelay:i.maxRetryDelayMs||0},u={onSuccess:(l,f,d,_)=>{this.log(`Loaded steering manifest: "${o}"`);const E=l.data;if(E.VERSION!==1){this.log(`Steering VERSION ${E.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=E.TTL;const{"RELOAD-URI":c,"PATHWAY-CLONES":y,"PATHWAY-PRIORITY":O}=E;if(c)try{this.uri=new self.URL(c,o).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${c}`);return}this.scheduleRefresh(this.uri||d.url),y&&this.clonePathways(y),O&&this.updatePathwayPriority(O)},onError:(l,f,d,_)=>{if(this.log(`Error loading steering manifest: ${l.code} ${l.text} (${f.url})`),this.stopLoad(),l.code===410){this.enabled=!1,this.log(`Steering manifest ${f.url} no longer available`);return}let E=this.timeToLoad*1e3;if(l.code===429){const c=this.loader;if(typeof(c==null?void 0:c.getResponseHeader)=="function"){const y=c.getResponseHeader("Retry-After");y&&(E=parseFloat(y)*1e3)}this.log(`Steering manifest ${f.url} rate limited`);return}this.scheduleRefresh(this.uri||f.url,E)},onTimeout:(l,f,d)=>{this.log(`Timeout loading steering manifest (${f.url})`),this.scheduleRefresh(this.uri||f.url)}};this.log(`Requesting steering manifest: ${o}`),this.loader.load(g,r,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(e)},t)}}function js(v,e,t,n){v&&Object.keys(e).forEach(o=>{const g=v.filter(h=>h.groupId===o).map(h=>{const i=ar({},h);return i.details=void 0,i.attrs=new er(i.attrs),i.url=i.attrs.URI=nl(h.url,h.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),i.groupId=i.attrs["GROUP-ID"]=e[o],i.attrs["PATHWAY-ID"]=n,i});v.push(...g)})}function nl(v,e,t,n){const{HOST:o,PARAMS:g,[t]:h}=n;let i;e&&(i=h==null?void 0:h[e],i&&(v=i));const r=new self.URL(v);return o&&!i&&(r.host=o),g&&Object.keys(g).sort().forEach(u=>{u&&r.searchParams.set(u,g[u])}),r.href}const Rh=/^age:\s*[\d.]+\s*$/im;class il{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new fi,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e)return;const n=this.loader=new self.XMLHttpRequest,o=this.stats;o.loading.first=0,o.loaded=0;const g=this.xhrSetup;g?Promise.resolve().then(()=>{if(!this.stats.aborted)return g(n,t.url)}).catch(h=>(n.open("GET",t.url,!0),g(n,t.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(h=>{this.callbacks.onError({code:n.status,text:h.message},t,n,o)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const o=this.context.headers,{maxTimeToFirstByteMs:g,maxLoadTimeMs:h}=n.loadPolicy;if(o)for(const i in o)e.setRequestHeader(i,o[i]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=g&&xt(g)?g:h,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const o=t.readyState,g=this.config;if(!n.aborted&&o>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),g.timeout!==g.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),g.timeout=g.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),g.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),o===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const h=t.status,i=t.responseType!=="text";if(h>=200&&h<300&&(i&&t.response||t.responseText!==null)){n.loading.end=Math.max(self.performance.now(),n.loading.first);const r=i?t.response:t.responseText,u=t.responseType==="arraybuffer"?r.byteLength:r.length;if(n.loaded=n.total=u,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first),!this.callbacks)return;const l=this.callbacks.onProgress;if(l&&l(n,e,r,t),!this.callbacks)return;const f={url:t.responseURL,data:r,code:h};this.callbacks.onSuccess(f,n,e,t)}else{const r=g.loadPolicy.errorRetry,u=n.retry;ti(r,u,!1,h)?this.retry(r):(We.error(`${h} while loading ${e.url}`),this.callbacks.onError({code:h,text:t.statusText},e,t,n))}}}loadtimeout(){var e;const t=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry,n=this.stats.retry;if(ti(t,n,!0))this.retry(t);else{We.warn(`timeout while loading ${this.context.url}`);const o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=Ta(e,n.retry),n.retry++,We.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Rh.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function Dh(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Ih=/(\d+)-(\d+)\/(\d+)/;class Ws{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Oh,this.controller=new self.AbortController,this.stats=new fi}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const e=this.response;e!=null&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();const g=Ch(e,this.controller.signal),h=n.onProgress,i=e.responseType==="arraybuffer",r=i?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,g),self.clearTimeout(this.requestTimeout),t.timeout=u&&xt(u)?u:l,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(o,e,this.response)},t.timeout),self.fetch(this.request).then(f=>{this.response=this.loader=f;const d=Math.max(self.performance.now(),o.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(o,e,this.response)},l-(d-o.loading.start)),!f.ok){const{status:_,statusText:E}=f;throw new Lh(E||"fetch, bad network response",_,f)}return o.loading.first=d,o.total=Mh(f.headers)||o.total,h&&xt(t.highWaterMark)?this.loadProgressively(f,o,e,t.highWaterMark,h):i?f.arrayBuffer():e.responseType==="json"?f.json():f.text()}).then(f=>{const{response:d}=this;self.clearTimeout(this.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first);const _=f[r];_&&(o.loaded=o.total=_);const E={url:d.url,data:f,code:d.status};h&&!xt(t.highWaterMark)&&h(o,e,f,d),n.onSuccess(E,o,e,d)}).catch(f=>{if(self.clearTimeout(this.requestTimeout),o.aborted)return;const d=f&&f.code||0,_=f?f.message:null;n.onError({code:d,text:_},e,f?f.details:null,o)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,o=0,g){const h=new zo,i=e.body.getReader(),r=()=>i.read().then(u=>{if(u.done)return h.dataLength&&g(t,n,h.flush(),e),Promise.resolve(new ArrayBuffer(0));const l=u.value,f=l.length;return t.loaded+=f,f<o||h.dataLength?(h.push(l),h.dataLength>=o&&g(t,n,h.flush(),e)):g(t,n,l,e),r()}).catch(()=>Promise.reject());return r()}}function Ch(v,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ar({},v.headers))};return v.rangeEnd&&t.headers.set("Range","bytes="+v.rangeStart+"-"+String(v.rangeEnd-1)),t}function Ph(v){const e=Ih.exec(v);if(e)return parseInt(e[2])-parseInt(e[1])+1}function Mh(v){const e=v.get("Content-Range");if(e){const n=Ph(e);if(xt(n))return n}const t=v.get("Content-Length");if(t)return parseInt(t)}function Oh(v,e){return new self.Request(v.url,e)}class Lh extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const bh=/\s/,xh={newCue(v,e,t,n){const o=[];let g,h,i,r,u;const l=self.VTTCue||self.TextTrackCue;for(let d=0;d<n.rows.length;d++)if(g=n.rows[d],i=!0,r=0,u="",!g.isEmpty()){var f;for(let c=0;c<g.chars.length;c++)bh.test(g.chars[c].uchar)&&i?r++:(u+=g.chars[c].uchar,i=!1);g.cueStartTime=e,e===t&&(t+=1e-4),r>=16?r--:r++;const _=qo(u.trim()),E=La(e,t,_);v!=null&&(f=v.cues)!=null&&f.getCueById(E)||(h=new l(e,t,_),h.id=E,h.line=d+1,h.align="left",h.position=10+Math.min(80,Math.floor(r*8/32)*10),o.push(h))}return v&&o.length&&(o.sort((d,_)=>d.line==="auto"||_.line==="auto"?0:d.line>8&&_.line>8?_.line-d.line:d.line-_.line),o.forEach(d=>Io(v,d))),o}},Nh={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Fh=mr(mr({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:il,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:kd,bufferController:$d,capLevelController:ba,errorController:Lc,fpsController:ph,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ho,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:Nh},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},wh()),{},{subtitleStreamController:Hd,subtitleTrackController:Yd,timelineController:Eh,audioStreamController:jd,audioTrackController:Wd,emeController:dn,cmcdController:zr,contentSteeringController:Sh});function wh(){return{cueHandler:xh,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Bh(v,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=ca(v),n=["manifest","level","frag"],o=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(g=>{const h=`${g==="level"?"playlist":g}LoadPolicy`,i=e[h]===void 0,r=[];o.forEach(u=>{const l=`${g}Loading${u}`,f=e[l];if(f!==void 0&&i){r.push(l);const d=t[h].default;switch(e[h]={default:d},u){case"TimeOut":d.maxLoadTimeMs=f,d.maxTimeToFirstByteMs=f;break;case"MaxRetry":d.errorRetry.maxNumRetry=f,d.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":d.errorRetry.retryDelayMs=f,d.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":d.errorRetry.maxRetryDelayMs=f,d.timeoutRetry.maxRetryDelayMs=f;break}}}),r.length&&We.warn(`hls.js config: "${r.join('", "')}" setting(s) are deprecated, use "${h}": ${JSON.stringify(e[h])}`)}),mr(mr({},t),e)}function ca(v){return v&&typeof v=="object"?Array.isArray(v)?v.map(ca):Object.keys(v).reduce((e,t)=>(e[t]=ca(v[t]),e),{}):v}function Uh(v){const e=v.loader;e!==Ws&&e!==il?(We.log("[config]: Custom loader detected, cannot enable progressive streaming"),v.progressive=!1):Dh()&&(v.loader=Ws,v.progressive=!0,v.enableSoftwareAES=!0,We.log("[config]: Progressive streaming enabled, using FetchLoader"))}class jr{static get version(){return"1.4.0"}static isSupported(){return Qc()}static get Events(){return Ee}static get ErrorTypes(){return Ft}static get ErrorDetails(){return st}static get DefaultConfig(){return jr.defaultConfig?jr.defaultConfig:Fh}static set DefaultConfig(e){jr.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Mn,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,Af(e.debug||!1,"Hls instance");const t=this.config=Bh(jr.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&Uh(t);const{abrController:n,bufferController:o,capLevelController:g,errorController:h,fpsController:i}=t,r=new h(this),u=this.abrController=new n(this),l=this.bufferController=new o(this),f=this.capLevelController=new g(this),d=new i(this),_=new dc(this),E=new _c(this),c=t.contentSteeringController,y=c?new c(this):null,O=this.levelController=new xc(this,y),P=new Nc(this),b=new wc(this.config),L=this.streamController=new Bd(this,P,b);f.setStreamController(L),d.setStreamController(L);const R=[_,O,L];y&&R.splice(1,0,y),this.networkControllers=R;const T=[u,l,f,d,E,P];this.audioTrackController=this.createController(t.audioTrackController,R);const m=t.audioStreamController;m&&R.push(new m(this,P,b)),this.subtitleTrackController=this.createController(t.subtitleTrackController,R);const M=t.subtitleStreamController;M&&R.push(new M(this,P,b)),this.createController(t.timelineController,T),b.emeController=this.emeController=this.createController(t.emeController,T),this.cmcdController=this.createController(t.cmcdController,T),this.latencyController=this.createController(vc,T),this.coreComponents=T,R.push(r);const p=r.onErrorOut;typeof p=="function"&&this.on(Ee.ERROR,p,r)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,o){this._emitter.off(e,t,n,o)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){We.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),this.trigger(Ee.ERROR,{type:Ft.OTHER_ERROR,details:st.INTERNAL_EXCEPTION,fatal:!1,event:e,error:n})}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){We.log("destroy"),this.trigger(Ee.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){We.log("attachMedia"),this._media=e,this.trigger(Ee.MEDIA_ATTACHING,{media:e})}detachMedia(){We.log("detachMedia"),this.trigger(Ee.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,n=this.url,o=this.url=Dn.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});We.log(`loadSource:${o}`),t&&n&&n!==o&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(Ee.MANIFEST_LOADING,{url:e})}startLoad(e=-1){We.log(`startLoad(${e})`),this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){We.log("stopLoad"),this.networkControllers.forEach(e=>{e.stopLoad()})}swapAudioCodec(){We.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){We.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e,t=0){this.levelController.removeLevel(e,t)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){We.log(`set currentLevel:${e}`),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){We.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){We.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){We.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){return this.levelController.startLevel}set startLevel(e){We.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(We.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){sa.indexOf(e)>-1&&(this._maxHdcpLevel=e)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let o=0;o<n;o++)if(e[o].maxBitrate>=t)return o;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let o;if(t===-1&&e&&e.length?o=e.length-1:o=t,n)for(let g=o;g--;){const h=e[g].attrs["HDCP-LEVEL"];if(h&&h<=n)return g}return o}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}jr.defaultConfig=void 0;var da={},kh={get exports(){return da},set exports(v){da=v}};(function(v,e){(function(n,o){v.exports=o()})(self,()=>(()=>{var t={"./externals/base64.js":(h,i)=>{var r={};r.encode=function(l){for(var f=[],d=0;d<l.length;++d){var _=l.charCodeAt(d);_<128?f.push(_):_<2048?(f.push(192|_>>6),f.push(128|63&_)):_<65536?(f.push(224|_>>12),f.push(128|63&_>>6),f.push(128|63&_)):(f.push(240|_>>18),f.push(128|63&_>>12),f.push(128|63&_>>6),f.push(128|63&_))}return f},r.decode=function(l){for(var f=[],d=0;d<l.length;){var _=l[d++];_<128||(_<224?(_=(31&_)<<6,_|=63&l[d++]):_<240?(_=(15&_)<<12,_|=(63&l[d++])<<6,_|=63&l[d++]):(_=(7&_)<<18,_|=(63&l[d++])<<12,_|=(63&l[d++])<<6,_|=63&l[d++])),f.push(String.fromCharCode(_))}return f.join("")};var u={};(function(l){var f=function(y){for(var O=0,P=[],b=0|y.length/3;0<b--;){var L=(y[O]<<16)+(y[O+1]<<8)+y[O+2];O+=3,P.push(l.charAt(63&L>>18)),P.push(l.charAt(63&L>>12)),P.push(l.charAt(63&L>>6)),P.push(l.charAt(63&L))}if(y.length-O==2){var L=(y[O]<<16)+(y[O+1]<<8);P.push(l.charAt(63&L>>18)),P.push(l.charAt(63&L>>12)),P.push(l.charAt(63&L>>6)),P.push("=")}else if(y.length-O==1){var L=y[O]<<16;P.push(l.charAt(63&L>>18)),P.push(l.charAt(63&L>>12)),P.push("==")}return P.join("")},d=function(){for(var c=[],y=0;y<l.length;++y)c[l.charCodeAt(y)]=y;return c["=".charCodeAt(0)]=0,c}(),_=function(y){for(var O=0,P=[],b=0|y.length/4;0<b--;){var L=(d[y.charCodeAt(O)]<<18)+(d[y.charCodeAt(O+1)]<<12)+(d[y.charCodeAt(O+2)]<<6)+d[y.charCodeAt(O+3)];P.push(255&L>>16),P.push(255&L>>8),P.push(255&L),O+=4}return P&&(y.charAt(O-2)=="="?(P.pop(),P.pop()):y.charAt(O-1)=="="&&P.pop()),P},E={};E.encode=function(c){for(var y=[],O=0;O<c.length;++O)y.push(c.charCodeAt(O));return y},E.decode=function(c){for(var y=0;y<s.length;++y)a[y]=String.fromCharCode(a[y]);return a.join("")},u.decodeArray=function(c){var y=_(c);return new Uint8Array(y)},u.encodeASCII=function(c){var y=E.encode(c);return f(y)},u.decodeASCII=function(c){var y=_(c);return E.decode(y)},u.encode=function(c){var y=r.encode(c);return f(y)},u.decode=function(c){var y=_(c);return r.decode(y)}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),i.decode=u.decode,i.decodeArray=u.decodeArray,i.encode=u.encode,i.encodeASCII=u.encodeASCII},"./externals/cea608-parser.js":(h,i)=>{(function(r){var u={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},l=function(S){var x=S;return u.hasOwnProperty(S)&&(x=u[S]),String.fromCharCode(x)},f=15,d=32,_={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},E={17:2,18:4,21:6,22:8,23:10,19:13,20:15},c={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},y={25:2,26:4,29:6,30:8,31:10,27:13,28:15},O=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],P={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(S){this.time=S},log:function(S,x){var F=this.verboseFilter[S];this.verboseLevel>=F&&console.log(this.time+" ["+S+"] "+x)}},b=function(S){for(var x=[],F=0;F<S.length;F++)x.push(S[F].toString(16));return x},L=function(S,x,F,k,j){this.foreground=S||"white",this.underline=x||!1,this.italics=F||!1,this.background=k||"black",this.flash=j||!1};L.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(S){for(var x=["foreground","underline","italics","background","flash"],F=0;F<x.length;F++){var k=x[F];S.hasOwnProperty(k)&&(this[k]=S[k])}},isDefault:function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},equals:function(S){return this.foreground===S.foreground&&this.underline===S.underline&&this.italics===S.italics&&this.background===S.background&&this.flash===S.flash},copy:function(S){this.foreground=S.foreground,this.underline=S.underline,this.italics=S.italics,this.background=S.background,this.flash=S.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var R=function(S,x,F,k,j,V){this.uchar=S||" ",this.penState=new L(x,F,k,j,V)};R.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(S,x){this.uchar=S,this.penState.copy(x)},setPenState:function(S){this.penState.copy(S)},equals:function(S){return this.uchar===S.uchar&&this.penState.equals(S.penState)},copy:function(S){this.uchar=S.uchar,this.penState.copy(S.penState)},isEmpty:function(){return this.uchar===" "&&this.penState.isDefault()}};var T=function(){this.chars=[];for(var S=0;S<d;S++)this.chars.push(new R);this.pos=0,this.currPenState=new L};T.prototype={equals:function(S){for(var x=!0,F=0;F<d;F++)if(!this.chars[F].equals(S.chars[F])){x=!1;break}return x},copy:function(S){for(var x=0;x<d;x++)this.chars[x].copy(S.chars[x])},isEmpty:function(){for(var S=!0,x=0;x<d;x++)if(!this.chars[x].isEmpty()){S=!1;break}return S},setCursor:function(S){this.pos!==S&&(this.pos=S),this.pos<0?(P.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>d&&(P.log("ERROR","Too large cursor position "+this.pos),this.pos=d)},moveCursor:function(S){var x=this.pos+S;if(S>1)for(var F=this.pos+1;F<x+1;F++)this.chars[F].setPenState(this.currPenState);this.setCursor(x)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(S){S>=144&&this.backSpace();var x=l(S);if(this.pos>=d){P.log("ERROR","Cannot insert "+S.toString(16)+" ("+x+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(x,this.currPenState),this.moveCursor(1)},clearFromPos:function(S){var x;for(x=S;x<d;x++)this.chars[x].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var S=[],x=!0,F=0;F<d;F++){var k=this.chars[F].uchar;k!==" "&&(x=!1),S.push(k)}return x?"":S.join("")},setPenStyles:function(S){this.currPenState.setStyles(S);var x=this.chars[this.pos];x.setPenState(this.currPenState)}};var m=function(){this.rows=[];for(var S=0;S<f;S++)this.rows.push(new T);this.currRow=f-1,this.nrRollUpRows=null,this.reset()};m.prototype={reset:function(){for(var S=0;S<f;S++)this.rows[S].clear();this.currRow=f-1},equals:function(S){for(var x=!0,F=0;F<f;F++)if(!this.rows[F].equals(S.rows[F])){x=!1;break}return x},copy:function(S){for(var x=0;x<f;x++)this.rows[x].copy(S.rows[x])},isEmpty:function(){for(var S=!0,x=0;x<f;x++)if(!this.rows[x].isEmpty()){S=!1;break}return S},backSpace:function(){var S=this.rows[this.currRow];S.backSpace()},clearToEndOfRow:function(){var S=this.rows[this.currRow];S.clearToEndOfRow()},insertChar:function(S){var x=this.rows[this.currRow];x.insertChar(S)},setPen:function(S){var x=this.rows[this.currRow];x.setPenStyles(S)},moveCursor:function(S){var x=this.rows[this.currRow];x.moveCursor(S)},setCursor:function(S){P.log("INFO","setCursor: "+S);var x=this.rows[this.currRow];x.setCursor(S)},setPAC:function(S){P.log("INFO","pacData = "+JSON.stringify(S));var x=S.row-1;this.nrRollUpRows&&x<this.nrRollUpRows-1&&(x=this.nrRollUpRows-1),this.currRow=x;var F=this.rows[this.currRow];if(S.indent!==null){var k=S.indent,j=Math.max(k-1,0);F.setCursor(S.indent),S.color=F.chars[j].penState.foreground}var V={foreground:S.color,underline:S.underline,italics:S.italics,background:"black",flash:!1};this.setPen(V)},setBkgData:function(S){P.log("INFO","bkgData = "+JSON.stringify(S)),this.backSpace(),this.setPen(S),this.insertChar(32)},setRollUpRows:function(S){this.nrRollUpRows=S},rollUp:function(){if(this.nrRollUpRows===null){P.log("DEBUG","roll_up but nrRollUpRows not set yet");return}P.log("TEXT",this.getDisplayText());var S=this.currRow+1-this.nrRollUpRows,x=this.rows.splice(S,1)[0];x.clear(),this.rows.splice(this.currRow,0,x),P.log("INFO","Rolling up")},getDisplayText:function(S){S=S||!1;for(var x=[],F="",k=-1,j=0;j<f;j++){var V=this.rows[j].getTextString();V&&(k=j+1,S?x.push("Row "+k+': "'+V+'"'):x.push(V.trim()))}return x.length>0&&(S?F="["+x.join(" | ")+"]":F=x.join(`
`)),F},getTextAndFormat:function(){return this.rows}};var M=function(S,x){this.chNr=S,this.outputFilter=x,this.mode=null,this.verbose=0,this.displayedMemory=new m,this.nonDisplayedMemory=new m,this.lastOutputScreen=new m,this.currRollUpRow=this.displayedMemory.rows[f-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};M.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[f-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(S){this.outputFilter=S},setPAC:function(S){this.writeScreen.setPAC(S)},setBkgData:function(S){this.writeScreen.setBkgData(S)},setMode:function(S){S!==this.mode&&(this.mode=S,P.log("INFO","MODE="+S),this.mode=="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=S)},insertChars:function(S){for(var x=0;x<S.length;x++)this.writeScreen.insertChar(S[x]);var F=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";P.log("INFO",F+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(P.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){P.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){P.log("INFO","BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){P.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(S){P.log("INFO","RU("+S+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(S)},cc_FON:function(){P.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){P.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){P.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){P.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){P.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){P.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){P.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(P.log("INFO","EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var S=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=S,this.writeScreen=this.nonDisplayedMemory,P.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(S){P.log("INFO","TO("+S+") - Tab Offset"),this.writeScreen.moveCursor(S)},cc_MIDROW:function(S){var x={flash:!1};if(x.underline=S%2===1,x.italics=S>=46,x.italics)x.foreground="white";else{var F=Math.floor(S/2)-16,k=["white","green","blue","cyan","red","yellow","magenta"];x.foreground=k[F]}P.log("INFO","MIDROW: "+JSON.stringify(x)),this.writeScreen.setPen(x)},outputDataUpdate:function(){var S=P.time;S!==null&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(S,this.displayedMemory),this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=S:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,S,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:S),this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(S){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,S,this.displayedMemory),this.cueStartTime=S))}};var p=function(S,x,F){this.field=S||1,this.outputs=[x,F],this.channels=[new M(1,x),new M(2,F)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};p.prototype={getHandler:function(S){return this.channels[S].getHandler()},setHandler:function(S,x){this.channels[S].setHandler(x)},addData:function(S,x){var F,k,j,V=!1;this.lastTime=S,P.setTime(S);for(var Q=0;Q<x.length;Q+=2){if(k=x[Q]&127,j=x[Q+1]&127,k>=16&&k<=31&&k===this.lastCmdA&&j===this.lastCmdB){this.lastCmdA=null,this.lastCmdB=null,P.log("DEBUG","Repeated command ("+b([k,j])+") is dropped");continue}if(k===0&&j===0){this.dataCounters.padding+=2;continue}else P.log("DATA","["+b([x[Q],x[Q+1]])+"] -> ("+b([k,j])+")");if(F=this.parseCmd(k,j),F||(F=this.parseMidrow(k,j)),F||(F=this.parsePAC(k,j)),F||(F=this.parseBackgroundAttributes(k,j)),!F&&(V=this.parseChars(k,j),V))if(this.currChNr&&this.currChNr>=0){var $=this.channels[this.currChNr-1];$.insertChars(V)}else P.log("WARNING","No channel found yet. TEXT-MODE?");F?this.dataCounters.cmd+=2:V?this.dataCounters.char+=2:(this.dataCounters.other+=2,P.log("WARNING","Couldn't parse cleaned data "+b([k,j])+" orig: "+b([x[Q],x[Q+1]])))}},parseCmd:function(S,x){var F=null,k=(S===20||S===21||S===28||S===29)&&32<=x&&x<=47,j=(S===23||S===31)&&33<=x&&x<=35;if(!(k||j))return!1;S===20||S===21||S===23?F=1:F=2;var V=this.channels[F-1];return S===20||S===21||S===28||S===29?x===32?V.cc_RCL():x===33?V.cc_BS():x===34?V.cc_AOF():x===35?V.cc_AON():x===36?V.cc_DER():x===37?V.cc_RU(2):x===38?V.cc_RU(3):x===39?V.cc_RU(4):x===40?V.cc_FON():x===41?V.cc_RDC():x===42?V.cc_TR():x===43?V.cc_RTD():x===44?V.cc_EDM():x===45?V.cc_CR():x===46?V.cc_ENM():x===47&&V.cc_EOC():V.cc_TO(x-32),this.lastCmdA=S,this.lastCmdB=x,this.currChNr=F,!0},parseMidrow:function(S,x){var F=null;if((S===17||S===25)&&32<=x&&x<=47){if(S===17?F=1:F=2,F!==this.currChNr)return P.log("ERROR","Mismatch channel in midrow parsing"),!1;var k=this.channels[F-1];return k.insertChars([32]),k.cc_MIDROW(x),P.log("DEBUG","MIDROW ("+b([S,x])+")"),this.lastCmdA=S,this.lastCmdB=x,!0}return!1},parsePAC:function(S,x){var F=null,k=null,j=(17<=S&&S<=23||25<=S&&S<=31)&&64<=x&&x<=127,V=(S===16||S===24)&&64<=x&&x<=95;if(!(j||V))return!1;F=S<=23?1:2,64<=x&&x<=95?k=F===1?_[S]:c[S]:k=F===1?E[S]:y[S];var Q=this.interpretPAC(k,x),$=this.channels[F-1];return $.setPAC(Q),this.lastCmdA=S,this.lastCmdB=x,this.currChNr=F,!0},interpretPAC:function(S,x){var F=x,k={color:null,italics:!1,indent:null,underline:!1,row:S};return x>95?F=x-96:F=x-64,k.underline=(F&1)===1,F<=13?k.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(F/2)]:F<=15?(k.italics=!0,k.color="white"):k.indent=Math.floor((F-16)/2)*4,k},parseChars:function(S,x){var F=null,k=null,j=null;if(S>=25?(F=2,j=S-8):(F=1,j=S),17<=j&&j<=19){var V=x;j===17?V=x+80:j===18?V=x+112:V=x+144,P.log("INFO","Special char '"+l(V)+"' in channel "+F),k=[V],this.lastCmdA=S,this.lastCmdB=x}else 32<=S&&S<=127&&(k=x===0?[S]:[S,x],this.lastCmdA=null,this.lastCmdB=null);if(k){var Q=b(k);P.log("DEBUG","Char codes =  "+Q.join(","))}return k},parseBackgroundAttributes:function(S,x){var F,k,j,V,Q=(S===16||S===24)&&32<=x&&x<=47,$=(S===23||S===31)&&45<=x&&x<=47;return Q||$?(F={},S===16||S===24?(k=Math.floor((x-32)/2),F.background=O[k],x%2===1&&(F.background=F.background+"_semi")):x===45?F.background="transparent":(F.foreground="black",x===47&&(F.underline=!0)),j=S<24?1:2,V=this.channels[j-1],V.setBkgData(F),this.lastCmdA=S,this.lastCmdB=x,!0):!1},reset:function(){for(var S=0;S<this.channels.length;S++)this.channels[S]&&this.channels[S].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(S){for(var x=0;x<this.channels.length;x++)this.channels[x]&&this.channels[x].cueSplitAtTime(S)}};var C=function(S,x,F){for(var k=0,j=x,V=0,Q=[],$=function(ne,ae,ce,X){if(ne!==4||ae<8)return null;var oe=ce.getUint8(X),ge=ce.getUint16(X+1),_e=ce.getUint32(X+3),he=ce.getUint8(X+7);return oe==181&&ge==49&&_e==1195456820&&he==3};j<x+F;){if(k=S.getUint32(j),V=S.getUint8(j+4)&31,V===6)for(var K=j+5,Y=-1;K<j+4+k-1;){Y=0;for(var re=255;re===255;)re=S.getUint8(K),Y+=re,K++;var ie=0;for(re=255;re===255;)re=S.getUint8(K),ie+=re,K++;$(Y,ie,S,K)&&Q.push([K,ie]),K+=ie}j+=k+4}return Q},I=function(S,x){var F=x[0],k=[[],[]];F+=8;var j=S.getUint8(F)&31;F+=2;for(var V=0;V<j;V++){var Q=S.getUint8(F),$=Q&4,K=Q&3;F++;var Y=S.getUint8(F);F++;var re=S.getUint8(F);F++,$&&(Y&127)+(re&127)!==0&&(K===0?(k[0].push(Y),k[0].push(re)):K===1&&(k[1].push(Y),k[1].push(re)))}return k};r.logger=P,r.PenState=L,r.CaptionScreen=m,r.Cea608Parser=p,r.findCea608Nalus=C,r.extractCea608DataFromRange=I})(i)},"./externals/xml2json.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>l});function u(f){var d="1.2.0";f=f||{},_();function _(){f.escapeMode===void 0&&(f.escapeMode=!0),f.attributePrefix===void 0&&(f.attributePrefix="_"),f.arrayAccessForm=f.arrayAccessForm||"none",f.emptyNodeForm=f.emptyNodeForm||"text",f.enableToStringFunc===void 0&&(f.enableToStringFunc=!0),f.arrayAccessFormPaths=f.arrayAccessFormPaths||[],f.skipEmptyTextNodesForObj===void 0&&(f.skipEmptyTextNodesForObj=!0),f.stripWhitespaces===void 0&&(f.stripWhitespaces=!0),f.datetimeAccessFormPaths=f.datetimeAccessFormPaths||[],f.useDoubleQuotes===void 0&&(f.useDoubleQuotes=!1),f.xmlElementsFilter=f.xmlElementsFilter||[],f.jsonPropertiesFilter=f.jsonPropertiesFilter||[],f.keepCData===void 0&&(f.keepCData=!1),f.ignoreRoot===void 0&&(f.ignoreRoot=!1)}var E={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};function c($){var K=$.localName;return K==null&&(K=$.baseName),(K==null||K=="")&&(K=$.nodeName),K}function y($){return $.prefix}function O($){return typeof $=="string"?$.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):$}function P($,K,Y,re){for(var ie=0;ie<$.length;ie++){var ee=$[ie];if(typeof ee=="string"){if(ee==re)break}else if(ee instanceof RegExp){if(ee.test(re))break}else if(typeof ee=="function"&&ee(K,Y,re))break}return ie!=$.length}function b($,K,Y){switch(f.arrayAccessForm){case"property":$[K]instanceof Array?$[K+"_asArray"]=$[K]:$[K+"_asArray"]=[$[K]];break}!($[K]instanceof Array)&&f.arrayAccessFormPaths.length>0&&P(f.arrayAccessFormPaths,$,K,Y)&&($[K]=[$[K]])}function L($){var K=$.split(/[-T:+Z]/g),Y=new Date(K[0],K[1]-1,K[2]),re=K[5].split(".");if(Y.setHours(K[3],K[4],re[0]),re.length>1&&Y.setMilliseconds(re[1]),K[6]&&K[7]){var ie=K[6]*60+Number(K[7]),ee=/\d\d-\d\d:\d\d$/.test($)?"-":"+";ie=0+(ee=="-"?-1*ie:ie),Y.setMinutes(Y.getMinutes()-ie-Y.getTimezoneOffset())}else $.indexOf("Z",$.length-1)!==-1&&(Y=new Date(Date.UTC(Y.getFullYear(),Y.getMonth(),Y.getDate(),Y.getHours(),Y.getMinutes(),Y.getSeconds(),Y.getMilliseconds())));return Y}function R($,K,Y){if(f.datetimeAccessFormPaths.length>0){var re=Y.split(".#")[0];return P(f.datetimeAccessFormPaths,$,K,re)?L($):$}else return $}function T($,K,Y,re){return K==E.ELEMENT_NODE&&f.xmlElementsFilter.length>0?P(f.xmlElementsFilter,$,Y,re):!0}function m($,K){if($.nodeType==E.DOCUMENT_NODE){for(var Y=new Object,re=$.childNodes,ie=0;ie<re.length;ie++){var ee=re[ie];if(ee.nodeType==E.ELEMENT_NODE)if(f.ignoreRoot)Y=m(ee);else{Y={};var ne=c(ee);Y[ne]=m(ee)}}return Y}else if($.nodeType==E.ELEMENT_NODE){var Y=new Object;Y.__cnt=0;for(var ae=[],re=$.childNodes,ie=0;ie<re.length;ie++){var ee=re[ie],ne=c(ee);if(ee.nodeType!=E.COMMENT_NODE){var ce=K+"."+ne;if(T(Y,ee.nodeType,ne,ce))if(Y.__cnt++,Y[ne]==null){var X=m(ee,ce);if(ne!="#text"||/[^\s]/.test(X)){var oe={};oe[ne]=X,ae.push(oe)}Y[ne]=X,b(Y,ne,ce)}else{Y[ne]!=null&&(Y[ne]instanceof Array||(Y[ne]=[Y[ne]],b(Y,ne,ce)));var X=m(ee,ce);if(ne!="#text"||/[^\s]/.test(X)){var oe={};oe[ne]=X,ae.push(oe)}Y[ne][Y[ne].length]=X}}}Y.__children=ae;for(var ge=c($),_e=0;_e<$.attributes.length;_e++){var he=$.attributes[_e];Y.__cnt++;for(var se=he.value,Z=0,q=f.matchers.length;Z<q;Z++){var le=f.matchers[Z];le.test(he,ge)&&(se=le.converter(he.value))}Y[f.attributePrefix+he.name]=se}var te=y($);return te!=null&&te!=""&&(Y.__cnt++,Y.__prefix=te),Y["#text"]!=null&&(Y.__text=Y["#text"],Y.__text instanceof Array&&(Y.__text=Y.__text.join(`
`)),f.stripWhitespaces&&(Y.__text=Y.__text.trim()),delete Y["#text"],f.arrayAccessForm=="property"&&delete Y["#text_asArray"],Y.__text=R(Y.__text,ne,K+"."+ne)),Y["#cdata-section"]!=null&&(Y.__cdata=Y["#cdata-section"],delete Y["#cdata-section"],f.arrayAccessForm=="property"&&delete Y["#cdata-section_asArray"]),Y.__cnt==0&&f.emptyNodeForm=="text"?Y="":Y.__cnt==1&&Y.__text!=null?Y=Y.__text:Y.__cnt==1&&Y.__cdata!=null&&!f.keepCData?Y=Y.__cdata:Y.__cnt>1&&Y.__text!=null&&f.skipEmptyTextNodesForObj&&(f.stripWhitespaces&&Y.__text==""||Y.__text.trim()=="")&&delete Y.__text,delete Y.__cnt,f.enableToStringFunc&&(Y.__text!=null||Y.__cdata!=null)&&(Y.toString=function(){return(this.__text!=null?this.__text:"")+(this.__cdata!=null?this.__cdata:"")}),Y}else if($.nodeType==E.TEXT_NODE||$.nodeType==E.CDATA_SECTION_NODE)return $.nodeValue}function M($,K,Y,re){var ie="<"+($!=null&&$.__prefix!=null?$.__prefix+":":"")+K;if(Y!=null)for(var ee=0;ee<Y.length;ee++){var ne=Y[ee],ae=$[ne];f.escapeMode&&(ae=O(ae)),ie+=" "+ne.substr(f.attributePrefix.length)+"=",f.useDoubleQuotes?ie+='"'+ae+'"':ie+="'"+ae+"'"}return re?ie+="/>":ie+=">",ie}function p($,K){return"</"+($.__prefix!=null?$.__prefix+":":"")+K+">"}function C($,K){return $.indexOf(K,$.length-K.length)!==-1}function I($,K){return!!(f.arrayAccessForm=="property"&&C(K.toString(),"_asArray")||K.toString().indexOf(f.attributePrefix)==0||K.toString().indexOf("__")==0||$[K]instanceof Function)}function A($){var K=0;if($ instanceof Object)for(var Y in $)I($,Y)||K++;return K}function S($,K,Y){return f.jsonPropertiesFilter.length==0||Y==""||P(f.jsonPropertiesFilter,$,K,Y)}function x($){var K=[];if($ instanceof Object)for(var Y in $)Y.toString().indexOf("__")==-1&&Y.toString().indexOf(f.attributePrefix)==0&&K.push(Y);return K}function F($){var K="";return $.__cdata!=null&&(K+="<![CDATA["+$.__cdata+"]]>"),$.__text!=null&&(f.escapeMode?K+=O($.__text):K+=$.__text),K}function k($){var K="";return $ instanceof Object?K+=F($):$!=null&&(f.escapeMode?K+=O($):K+=$),K}function j($,K){return $===""?K:$+"."+K}function V($,K,Y,re){var ie="";if($.length==0)ie+=M($,K,Y,!0);else for(var ee=0;ee<$.length;ee++)ie+=M($[ee],K,x($[ee]),!1),ie+=Q($[ee],j(re,K)),ie+=p($[ee],K);return ie}function Q($,K){var Y="",re=A($);if(re>0){for(var ie in $)if(!(I($,ie)||K!=""&&!S($,ie,j(K,ie)))){var ee=$[ie],ne=x(ee);if(ee==null||ee==null)Y+=M(ee,ie,ne,!0);else if(ee instanceof Object)if(ee instanceof Array)Y+=V(ee,ie,ne,K);else if(ee instanceof Date)Y+=M(ee,ie,ne,!1),Y+=ee.toISOString(),Y+=p(ee,ie);else{var ae=A(ee);ae>0||ee.__text!=null||ee.__cdata!=null?(Y+=M(ee,ie,ne,!1),Y+=Q(ee,j(K,ie)),Y+=p(ee,ie)):Y+=M(ee,ie,ne,!0)}else Y+=M(ee,ie,ne,!1),Y+=k(ee),Y+=p(ee,ie)}}return Y+=k($),Y}this.parseXmlString=function($){if($===void 0)return null;var K;if(window.DOMParser){var Y=new window.DOMParser;try{K=Y.parseFromString($,"text/xml"),K.getElementsByTagNameNS("*","parsererror").length>0&&(K=null)}catch{K=null}}else $.indexOf("<?")==0&&($=$.substr($.indexOf("?>")+2)),K=new ActiveXObject("Microsoft.XMLDOM"),K.async="false",K.loadXML($);return K},this.asArray=function($){return $===void 0||$==null?[]:$ instanceof Array?$:[$]},this.toXmlDateTime=function($){return $ instanceof Date?$.toISOString():typeof $=="number"?new Date($).toISOString():null},this.asDateTime=function($){return typeof $=="string"?L($):$},this.xml2json=function($){return m($)},this.xml_str2json=function($){var K=this.parseXmlString($);return K!=null?this.xml2json(K):null},this.json2xml_str=function($){return Q($,"")},this.json2xml=function($){var K=this.json2xml_str($);return this.parseXmlString(K)},this.getVersion=function(){return d}}const l=u},"./index_mediaplayerOnly.js":(h,i,r)=>{r.r(i),r.d(i,{Debug:()=>f.default,FactoryMaker:()=>l.default,MediaPlayer:()=>u.default,default:()=>c});var u=r("./src/streaming/MediaPlayer.js"),l=r("./src/core/FactoryMaker.js"),f=r("./src/core/Debug.js"),d=r("./src/core/Version.js");r("./node_modules/es6-promise/auto.js");var _=typeof window<"u"&&window||r.g,E=_.dashjs;E||(E=_.dashjs={}),E.MediaPlayer=u.default,E.FactoryMaker=l.default,E.Debug=f.default,E.Version=(0,d.getVersionString)();const c=E},"./src/core/Debug.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>L});var u=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),f=r("./src/core/FactoryMaker.js"),d=0,_=1,E=2,c=3,y=4,O=5;function P(R){R=R||{};var T=this.context,m=(0,u.default)(T).getInstance(),M=R.settings,p=[],C,I,A,S;function x(){I=!0,A=!0,S=new Date().getTime(),typeof window<"u"&&window.console&&(p[_]=F(window.console.error),p[E]=F(window.console.error),p[c]=F(window.console.warn),p[y]=F(window.console.info),p[O]=F(window.console.debug))}function F(ee){return ee&&ee.bind?ee.bind(window.console):window.console.log.bind(window.console)}function k(ee){return{fatal:Q.bind(ee),error:$.bind(ee),warn:K.bind(ee),info:Y.bind(ee),debug:re.bind(ee)}}function j(ee){I=ee}function V(ee){A=ee}function Q(){for(var ee=arguments.length,ne=new Array(ee),ae=0;ae<ee;ae++)ne[ae]=arguments[ae];ie.apply(void 0,[_,this].concat(ne))}function $(){for(var ee=arguments.length,ne=new Array(ee),ae=0;ae<ee;ae++)ne[ae]=arguments[ae];ie.apply(void 0,[E,this].concat(ne))}function K(){for(var ee=arguments.length,ne=new Array(ee),ae=0;ae<ee;ae++)ne[ae]=arguments[ae];ie.apply(void 0,[c,this].concat(ne))}function Y(){for(var ee=arguments.length,ne=new Array(ee),ae=0;ae<ee;ae++)ne[ae]=arguments[ae];ie.apply(void 0,[y,this].concat(ne))}function re(){for(var ee=arguments.length,ne=new Array(ee),ae=0;ae<ee;ae++)ne[ae]=arguments[ae];ie.apply(void 0,[O,this].concat(ne))}function ie(ee,ne){var ae="",ce=null;I&&(ce=new Date().getTime(),ae+="["+(ce-S)+"]"),A&&ne&&ne.getClassName&&(ae+="["+ne.getClassName()+"]",ne.getType&&(ae+="["+ne.getType()+"]")),ae.length>0&&(ae+=" ");for(var X=arguments.length,oe=new Array(X>2?X-2:0),ge=2;ge<X;ge++)oe[ge-2]=arguments[ge];Array.apply(null,oe).forEach(function(_e){ae+=_e+" "}),p[ee]&&M&&M.get().debug.logLevel>=ee&&p[ee](ae),M&&M.get().debug.dispatchEvent&&m.trigger(l.default.LOG,{message:ae,level:ee})}return C={getLogger:k,setLogTimestampVisible:j,setCalleeNameVisible:V},x(),C}P.__dashjs_factory_name="Debug";var b=f.default.getSingletonFactory(P);b.LOG_LEVEL_NONE=d,b.LOG_LEVEL_FATAL=_,b.LOG_LEVEL_ERROR=E,b.LOG_LEVEL_WARNING=c,b.LOG_LEVEL_INFO=y,b.LOG_LEVEL_DEBUG=O,f.default.updateSingletonFactory(P.__dashjs_factory_name,b);const L=b},"./src/core/EventBus.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>c});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/MediaPlayerEvents.js"),f=0,d=5e3;function _(){var y={};function O(m,M,p){var C=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(!m)throw new Error("event type cannot be null or undefined");if(!M||typeof M!="function")throw new Error("listener must be a function: "+M);var I=C.priority||f;if(!(L(m,M,p)>=0)){y[m]=y[m]||[];var A={callback:M,scope:p,priority:I};p&&p.getStreamId&&(A.streamId=p.getStreamId()),p&&p.getType&&(A.mediaType=p.getType()),C&&C.mode&&(A.mode=C.mode);var S=y[m].some(function(x,F){if(x&&I>x.priority)return y[m].splice(F,0,A),!0});S||y[m].push(A)}}function P(m,M,p){if(!(!m||!M||!y[m])){var C=L(m,M,p);C<0||(y[m][C]=null)}}function b(m){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!(!m||!y[m])){if(M=M||{},M.hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");M.type=m,p.streamId&&(M.streamId=p.streamId),p.mediaType&&(M.mediaType=p.mediaType),y[m].filter(function(C){return!(!C||p.streamId&&C.streamId&&C.streamId!==p.streamId||p.mediaType&&C.mediaType&&C.mediaType!==p.mediaType||p.mode&&C.mode&&C.mode!==p.mode||!C.mode&&p.mode&&p.mode===l.default.EVENT_MODE_ON_RECEIVE)}).forEach(function(C){return C&&C.callback.call(C.scope,M)})}}function L(m,M,p){var C=-1;return y[m]&&y[m].some(function(I,A){if(I&&I.callback===M&&(!p||p===I.scope))return C=A,!0}),C}function R(){y={}}var T={on:O,off:P,trigger:b,reset:R};return T}_.__dashjs_factory_name="EventBus";var E=u.default.getSingletonFactory(_);E.EVENT_PRIORITY_LOW=f,E.EVENT_PRIORITY_HIGH=d,u.default.updateSingletonFactory(_.__dashjs_factory_name,E);const c=E},"./src/core/FactoryMaker.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>l});var u=function(){var f,d=[],_={},E={};function c(A,S,x,F){!F[A]&&S&&(F[A]={instance:S,override:x})}function y(A,S){for(var x in d){var F=d[x];if(F.context===A&&F.name===S)return F.instance}return null}function O(A,S,x){for(var F in d){var k=d[F];if(k.context===A&&k.name===S){d[F].instance=x;return}}d.push({name:S,context:A,instance:x})}function P(A){d=d.filter(function(S){return S.context!==A})}function b(A,S){return S[A]}function L(A,S,x){A in x&&(x[A]=S)}function R(A,S){L(A,S,E)}function T(A){return b(A,E)}function m(A){var S=b(A.__dashjs_factory_name,E);return S||(S=function(F){return F===void 0&&(F={}),{create:function(){return I(A,F,arguments)}}},E[A.__dashjs_factory_name]=S),S}function M(A,S){L(A,S,_)}function p(A){return b(A,_)}function C(A){var S=b(A.__dashjs_factory_name,_);return S||(S=function(F){var k;return F===void 0&&(F={}),{getInstance:function(){return k||(k=y(F,A.__dashjs_factory_name)),k||(k=I(A,F,arguments),d.push({name:A.__dashjs_factory_name,context:F,instance:k})),k}}},_[A.__dashjs_factory_name]=S),S}function I(A,S,x){var F,k=A.__dashjs_factory_name,j=S[k];if(j){var V=j.instance;if(j.override){F=A.apply({context:S},x),V=V.apply({context:S,factory:f,parent:F},x);for(var Q in V)F.hasOwnProperty(Q)&&(F[Q]=V[Q])}else return V.apply({context:S,factory:f},x)}else F=A.apply({context:S},x);return F.getClassName=function(){return k},F}return f={extend:c,getSingletonInstance:y,setSingletonInstance:O,deleteSingletonInstances:P,getSingletonFactory:C,getSingletonFactoryByName:p,updateSingletonFactory:M,getClassFactory:m,getClassFactoryByName:T,updateClassFactory:R},f}();const l=u},"./src/core/Settings.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>L});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Utils.js"),f=r("./src/core/Debug.js"),d=r("./src/streaming/constants/Constants.js"),_=r("./src/streaming/vo/metrics/HTTPRequest.js"),E=r("./src/core/EventBus.js"),c=r("./src/core/events/Events.js");function y(R){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?y=function(m){return typeof m}:y=function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},y(R)}function O(R,T,m){return T in R?Object.defineProperty(R,T,{value:m,enumerable:!0,configurable:!0,writable:!0}):R[T]=m,R}function P(){var R,T,m,M=this.context,p=(0,E.default)(M).getInstance(),C={"streaming.delay.liveDelay":c.default.SETTING_UPDATED_LIVE_DELAY,"streaming.delay.liveDelayFragmentCount":c.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,"streaming.liveCatchup.enabled":c.default.SETTING_UPDATED_CATCHUP_ENABLED,"streaming.liveCatchup.playbackRate.min":c.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,"streaming.liveCatchup.playbackRate.max":c.default.SETTING_UPDATED_PLAYBACK_RATE_MAX},I={debug:{logLevel:f.default.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{abandonLoadTimeout:1e4,wallclockTimeUpdateInterval:100,manifestUpdateRetryInterval:100,cacheInitSegments:!1,applyServiceDescription:!0,applyProducerReferenceTime:!0,applyContentSteering:!0,eventControllerRefreshDelay:100,enableManifestDurationMismatchFix:!0,enableManifestTimescaleMismatchFix:!1,capabilities:{filterUnsupportedEssentialProperties:!0,useMediaCapabilitiesApi:!1},timeShiftBuffer:{calcFromSegmentTimeline:!1,fallbackToSegmentTimeline:!0},metrics:{maxListDepth:100},delay:{liveDelayFragmentCount:NaN,liveDelay:NaN,useSuggestedPresentationDelay:!0},protection:{keepProtectionMediaKeys:!1,ignoreEmeEncryptedEvent:!1,detectPlayreadyMessageFormat:!0},buffer:{enableSeekDecorrelationFix:!1,fastSwitchEnabled:!0,flushBufferAtTrackSwitch:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,initialBufferLevel:NaN,stableBufferTime:12,longFormContentDurationThreshold:600,stallThreshold:.3,useAppendWindow:!0,setStallState:!0,avoidCurrentTimeRangePruning:!1,useChangeTypeForTrackSwitch:!0},gaps:{jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,threshold:.3,enableSeekFix:!0,enableStallFix:!1,stallSeek:.1},utcSynchronization:{enabled:!0,useManifestDateHeaderTimeSource:!0,backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"https://time.akamai.com/?iso&ms"}},scheduling:{defaultTimeout:500,lowLatencyTimeout:0,scheduleWhilePaused:!0},text:{defaultEnabled:!0,extendSegmentedCues:!0,webvtt:{customRenderingEnabled:!1}},liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN},playbackBufferMin:.5,enabled:null,mode:d.default.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},cacheLoadThresholds:{video:50,audio:5},trackSwitchMode:{audio:d.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:d.default.TRACK_SWITCH_MODE_NEVER_REPLACE},selectionModeForInitialTrack:d.default.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY,fragmentRequestTimeout:2e4,manifestRequestTimeout:1e4,retryIntervals:(R={},O(R,_.HTTPRequest.MPD_TYPE,500),O(R,_.HTTPRequest.XLINK_EXPANSION_TYPE,500),O(R,_.HTTPRequest.MEDIA_SEGMENT_TYPE,1e3),O(R,_.HTTPRequest.INIT_SEGMENT_TYPE,1e3),O(R,_.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),O(R,_.HTTPRequest.INDEX_SEGMENT_TYPE,1e3),O(R,_.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE,1e3),O(R,_.HTTPRequest.LICENSE,1e3),O(R,_.HTTPRequest.OTHER_TYPE,1e3),O(R,"lowLatencyReductionFactor",10),R),retryAttempts:(T={},O(T,_.HTTPRequest.MPD_TYPE,3),O(T,_.HTTPRequest.XLINK_EXPANSION_TYPE,1),O(T,_.HTTPRequest.MEDIA_SEGMENT_TYPE,3),O(T,_.HTTPRequest.INIT_SEGMENT_TYPE,3),O(T,_.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),O(T,_.HTTPRequest.INDEX_SEGMENT_TYPE,3),O(T,_.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE,3),O(T,_.HTTPRequest.LICENSE,3),O(T,_.HTTPRequest.OTHER_TYPE,3),O(T,"lowLatencyMultiplyFactor",5),T),abr:{movingAverageMethod:d.default.MOVING_AVERAGE_SLIDING_WINDOW,ABRStrategy:d.default.ABR_STRATEGY_DYNAMIC,additionalAbrRules:{insufficientBufferRule:!0,switchHistoryRule:!0,droppedFramesRule:!0,abandonRequestsRule:!0},bandwidthSafetyFactor:.9,useDefaultABRRules:!0,useDeadTimeLatency:!0,limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},maxRepresentationRatio:{audio:1,video:1},initialBitrate:{audio:-1,video:-1},initialRepresentationRatio:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0},fetchThroughputCalculationMode:d.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING},cmcd:{enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:d.default.CMCD_MODE_QUERY,enabledKeys:["br","d","ot","tb","bl","dl","mtp","nor","nrr","su","bs","rtp","cid","pr","sf","sid","st","v"]},cmsd:{enabled:!1,abr:{applyMb:!1,etpWeightRatio:0}}},errors:{recoverAttempts:{mediaErrorDecode:5}}},A=l.default.clone(I);function S(j,V,Q){for(var $ in j)j.hasOwnProperty($)&&(V.hasOwnProperty($)?y(j[$])==="object"&&!(j[$]instanceof Array)&&j[$]!==null?S(j[$],V[$],Q.slice()+$+"."):(V[$]=l.default.clone(j[$]),C[Q+$]&&p.trigger(C[Q+$])):console.error("Settings parameter "+Q+$+" is not supported"))}function x(){return A}function F(j){y(j)==="object"&&S(j,A,"")}function k(){A=l.default.clone(I)}return m={get:x,update:F,reset:k},m}P.__dashjs_factory_name="Settings";var b=u.default.getSingletonFactory(P);const L=b},"./src/core/Utils.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>O});var u=r("./node_modules/path-browserify/index.js"),l=r.n(u),f=r("./node_modules/ua-parser-js/src/ua-parser.js");function d(P){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?d=function(L){return typeof L}:d=function(L){return L&&typeof Symbol=="function"&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L},d(P)}function _(P,b){if(!(P instanceof b))throw new TypeError("Cannot call a class as a function")}function E(P,b){for(var L=0;L<b.length;L++){var R=b[L];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(P,R.key,R)}}function c(P,b,L){return b&&E(P.prototype,b),L&&E(P,L),P}var y=function(){function P(){_(this,P)}return c(P,null,[{key:"mixin",value:function(L,R,T){var m,M={};if(L)for(var p in R)R.hasOwnProperty(p)&&(m=R[p],(!(p in L)||L[p]!==m&&(!(p in M)||M[p]!==m))&&(d(L[p])==="object"&&L[p]!==null?L[p]=P.mixin(L[p],m,T):L[p]=T(m)));return L}},{key:"clone",value:function(L){if(!L||d(L)!=="object")return L;var R;if(L instanceof Array){R=[];for(var T=0,m=L.length;T<m;++T)T in L&&R.push(P.clone(L[T]))}else R={};return P.mixin(R,L,P.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(L,R){try{if(!R||R.length===0)return L;var T=new URL(L);return R.forEach(function(m){m.key&&m.value&&T.searchParams.set(m.key,m.value)}),T.href}catch{return L}}},{key:"parseHttpHeaders",value:function(L){var R={};if(!L)return R;for(var T=L.trim().split(`\r
`),m=0,M=T.length;m<M;m++){var p=T[m],C=p.indexOf(": ");C>0&&(R[p.substring(0,C)]=p.substring(C+2))}return R}},{key:"generateUuid",value:function(){var L=new Date().getTime(),R="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(T){var m=(L+Math.random()*16)%16|0;return L=Math.floor(L/16),(T=="x"?m:m&3|8).toString(16)});return R}},{key:"generateHashCode",value:function(L){var R=0;if(L.length===0)return R;for(var T=0;T<L.length;T++){var m=L.charCodeAt(T);R=(R<<5)-R+m,R|=0}return R}},{key:"getRelativeUrl",value:function(L,R){try{var T=new URL(L),m=new URL(R);if(T.protocol=m.protocol,T.origin!==m.origin)return R;var M=l().relative(T.pathname.substr(0,T.pathname.lastIndexOf("/")),m.pathname.substr(0,m.pathname.lastIndexOf("/"))),p=M.length===0?1:0;return M+=m.pathname.substr(m.pathname.lastIndexOf("/")+p,m.pathname.length-1),m.pathname.length<M.length?m.pathname:M}catch{return R}}},{key:"parseUserAgent",value:function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;try{var R=L===null&&typeof navigator<"u"?navigator.userAgent.toLowerCase():"";return(0,f.UAParser)(R)}catch{return{}}}}]),P}();const O=y},"./src/core/Version.js":(h,i,r)=>{r.r(i),r.d(i,{getVersionString:()=>l});var u="4.6.0";function l(){return u}},"./src/core/errors/Errors.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/core/errors/ErrorsBase.js");function l(T){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(M){return typeof M}:l=function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},l(T)}function f(T,m){if(!(T instanceof m))throw new TypeError("Cannot call a class as a function")}function d(T,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(m&&m.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),m&&_(T,m)}function _(T,m){return _=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},_(T,m)}function E(T){var m=O();return function(){var p=P(T),C;if(m){var I=P(this).constructor;C=Reflect.construct(p,arguments,I)}else C=p.apply(this,arguments);return c(this,C)}}function c(T,m){return m&&(l(m)==="object"||typeof m=="function")?m:y(T)}function y(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(T){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},P(T)}var b=function(T){d(M,T);var m=E(M);function M(){var p;return f(this,M),p=m.call(this),p.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,p.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,p.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,p.SEGMENT_BASE_LOADER_ERROR_CODE=15,p.TIME_SYNC_FAILED_ERROR_CODE=16,p.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,p.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,p.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,p.APPEND_ERROR_CODE=20,p.REMOVE_ERROR_CODE=21,p.DATA_UPDATE_FAILED_ERROR_CODE=22,p.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,p.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,p.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,p.DOWNLOAD_ERROR_ID_SIDX_CODE=26,p.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,p.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,p.DOWNLOAD_ERROR_ID_XLINK_CODE=29,p.MANIFEST_ERROR_ID_PARSE_CODE=31,p.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,p.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,p.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,p.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,p.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",p.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",p.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",p.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",p.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",p.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segment ranges from sidx",p.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize client and server time",p.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",p.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",p.APPEND_ERROR_MESSAGE="chunk is not defined",p.REMOVE_ERROR_MESSAGE="Removing data from the SourceBuffer",p.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",p.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",p.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",p.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",p.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : ",p}return M}(u.default),L=new b;const R=L},"./src/core/errors/ErrorsBase.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});function u(E,c){if(!(E instanceof c))throw new TypeError("Cannot call a class as a function")}function l(E,c){for(var y=0;y<c.length;y++){var O=c[y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(E,O.key,O)}}function f(E,c,y){return c&&l(E.prototype,c),y&&l(E,y),E}var d=function(){function E(){u(this,E)}return f(E,[{key:"extend",value:function(y,O){if(y){var P=O?O.override:!1,b=O?O.publicOnly:!1;for(var L in y)!y.hasOwnProperty(L)||this[L]&&!P||b&&y[L].indexOf("public_")===-1||(this[L]=y[L])}}}]),E}();const _=d},"./src/core/events/CoreEvents.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>L});var u=r("./src/core/events/EventsBase.js");function l(R){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(m){return typeof m}:l=function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(R)}function f(R,T){if(!(R instanceof T))throw new TypeError("Cannot call a class as a function")}function d(R,T){if(typeof T!="function"&&T!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(T&&T.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),T&&_(R,T)}function _(R,T){return _=Object.setPrototypeOf||function(M,p){return M.__proto__=p,M},_(R,T)}function E(R){var T=O();return function(){var M=P(R),p;if(T){var C=P(this).constructor;p=Reflect.construct(M,arguments,C)}else p=M.apply(this,arguments);return c(this,p)}}function c(R,T){return T&&(l(T)==="object"||typeof T=="function")?T:y(R)}function y(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(R){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(m){return m.__proto__||Object.getPrototypeOf(m)},P(R)}var b=function(R){d(m,R);var T=E(m);function m(){var M;return f(this,m),M=T.call(this),M.ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",M.BUFFERING_COMPLETED="bufferingCompleted",M.BUFFER_CLEARED="bufferCleared",M.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",M.BUFFER_REPLACEMENT_STARTED="bufferReplacementStarted",M.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",M.CMSD_STATIC_HEADER="cmsdStaticHeader",M.CURRENT_TRACK_CHANGED="currentTrackChanged",M.DATA_UPDATE_COMPLETED="dataUpdateCompleted",M.INBAND_EVENTS="inbandEvents",M.INITIAL_STREAM_SWITCH="initialStreamSwitch",M.INIT_FRAGMENT_LOADED="initFragmentLoaded",M.INIT_FRAGMENT_NEEDED="initFragmentNeeded",M.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",M.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",M.LOADING_COMPLETED="loadingCompleted",M.LOADING_PROGRESS="loadingProgress",M.LOADING_DATA_PROGRESS="loadingDataProgress",M.LOADING_ABANDONED="loadingAborted",M.MANIFEST_UPDATED="manifestUpdated",M.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",M.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",M.QUOTA_EXCEEDED="quotaExceeded",M.SEGMENT_LOCATION_BLACKLIST_ADD="segmentLocationBlacklistAdd",M.SEGMENT_LOCATION_BLACKLIST_CHANGED="segmentLocationBlacklistChanged",M.SERVICE_LOCATION_BLACKLIST_ADD="serviceLocationBlacklistAdd",M.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",M.SET_FRAGMENTED_TEXT_AFTER_DISABLED="setFragmentedTextAfterDisabled",M.SET_NON_FRAGMENTED_TEXT="setNonFragmentedText",M.SOURCE_BUFFER_ERROR="sourceBufferError",M.STREAMS_COMPOSED="streamsComposed",M.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",M.STREAM_REQUESTING_COMPLETED="streamRequestingCompleted",M.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",M.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",M.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",M.URL_RESOLUTION_FAILED="urlResolutionFailed",M.VIDEO_CHUNK_RECEIVED="videoChunkReceived",M.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",M.XLINK_ELEMENT_LOADED="xlinkElementLoaded",M.XLINK_READY="xlinkReady",M.SEEK_TARGET="seekTarget",M.SETTING_UPDATED_LIVE_DELAY="settingUpdatedLiveDelay",M.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT="settingUpdatedLiveDelayFragmentCount",M.SETTING_UPDATED_CATCHUP_ENABLED="settingUpdatedCatchupEnabled",M.SETTING_UPDATED_PLAYBACK_RATE_MIN="settingUpdatedPlaybackRateMin",M.SETTING_UPDATED_PLAYBACK_RATE_MAX="settingUpdatedPlaybackRateMax",M}return m}(u.default);const L=b},"./src/core/events/Events.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/core/events/CoreEvents.js");function l(T){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(M){return typeof M}:l=function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},l(T)}function f(T,m){if(!(T instanceof m))throw new TypeError("Cannot call a class as a function")}function d(T,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(m&&m.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),m&&_(T,m)}function _(T,m){return _=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},_(T,m)}function E(T){var m=O();return function(){var p=P(T),C;if(m){var I=P(this).constructor;C=Reflect.construct(p,arguments,I)}else C=p.apply(this,arguments);return c(this,C)}}function c(T,m){return m&&(l(m)==="object"||typeof m=="function")?m:y(T)}function y(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(T){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},P(T)}var b=function(T){d(M,T);var m=E(M);function M(){return f(this,M),m.apply(this,arguments)}return M}(u.default),L=new b;const R=L},"./src/core/events/EventsBase.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});function u(E,c){if(!(E instanceof c))throw new TypeError("Cannot call a class as a function")}function l(E,c){for(var y=0;y<c.length;y++){var O=c[y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(E,O.key,O)}}function f(E,c,y){return c&&l(E.prototype,c),y&&l(E,y),E}var d=function(){function E(){u(this,E)}return f(E,[{key:"extend",value:function(y,O){if(y){var P=O?O.override:!1,b=O?O.publicOnly:!1;for(var L in y)!y.hasOwnProperty(L)||this[L]&&!P||b&&y[L].indexOf("public_")===-1||(this[L]=y[L])}}}]),E}();const _=d},"./src/dash/DashAdapter.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/dash/constants/DashConstants.js"),l=r("./src/dash/vo/RepresentationInfo.js"),f=r("./src/dash/vo/MediaInfo.js"),d=r("./src/dash/vo/StreamInfo.js"),_=r("./src/dash/vo/ManifestInfo.js"),E=r("./src/dash/vo/Event.js"),c=r("./src/core/FactoryMaker.js"),y=r("./src/dash/models/DashManifestModel.js"),O=r("./src/dash/models/PatchManifestModel.js"),P=r("./node_modules/bcp-47-normalize/index.js"),b=r.n(P);function L(){var T,m,M,p,C,I,A,S=this.context,x="urn:dvb:dash:profile:dvb-dash:2014";function F(){m=(0,y.default)(S).getInstance(),M=(0,O.default)(S).getInstance(),Ye()}function k(Te){Te&&(Te.constants&&(I=Te.constants),Te.cea608parser&&(A=Te.cea608parser),Te.errHandler&&m.setConfig({errHandler:Te.errHandler}),Te.BASE64&&m.setConfig({BASE64:Te.BASE64}))}function j(Te){if(Te){var de=new l.default,Re=Te.adaptation.period.mpd.manifest.Period_asArray[Te.adaptation.period.index].AdaptationSet_asArray[Te.adaptation.index],xe=m.getRepresentationFor(Te.index,Re);return de.id=Te.id,de.quality=Te.index,de.bandwidth=m.getBandwidth(xe),de.fragmentDuration=Te.segmentDuration||(Te.segments&&Te.segments.length>0?Te.segments[0].duration:NaN),de.MSETimeOffset=Te.MSETimeOffset,de.mediaInfo=at(Te.adaptation),de}else return null}function V(Te,de){if(p.length===0||!Te)return null;var Re=it(Te,p);if(!Re)return null;var xe=m.getAdaptationsForPeriod(Re),Ne=$(Te.index,de,Te);if(!Ne)return null;var Xe=m.getIndexForAdaptation(Ne,p[0].mpd.manifest,Te.index);return at(xe[Xe])}function Q(Te){return m.getRolesForAdaptation(Te).filter(function(de){return de.value===u.default.MAIN})[0]}function $(Te,de,Re){var xe=m.getAdaptationsForType(p[0].mpd.manifest,Te,de);if(!xe||xe.length===0)return null;if(xe.length>1&&Re){var Ne=re(Re,de);if(C[Re.id]&&C[Re.id][de]){for(var Xe=0,nt=xe.length;Xe<nt;Xe++)if(K(C[Re.id][de],Ne[Xe]))return xe[Xe]}for(var et=0,ht=xe.length;et<ht;et++)if(Q(xe[et]))return xe[et]}return xe[0]}function K(Te,de){if(!Te||!de)return!1;var Re=Te.id===de.id,xe=Te.codec===de.codec,Ne=Te.viewpoint===de.viewpoint,Xe=Te.lang===de.lang,nt=Te.roles.toString()===de.roles.toString(),et=Te.accessibility.toString()===de.accessibility.toString(),ht=Te.audioChannelConfiguration.toString()===de.audioChannelConfiguration.toString();return Re&&xe&&Ne&&Xe&&nt&&et&&ht}function Y(Te,de,Re,xe,Ne,Xe){var nt=[],et,ht,yt,Pt,De,Ue;if(!xe||xe.length===0)return[];var Ze=m.getAdaptationsForPeriod(de);for(Pt=0,Ue=xe.length;Pt<Ue;Pt++)if(et=xe[Pt],yt=m.getIndexForAdaptation(et,Te,Re.index),ht=at(Ze[yt]),Xe){var Et=ht.accessibility.length;for(De=0;De<Et;De++)if(ht){var ct=ht.accessibility[De];if(ct.indexOf("cea-608:")===0){var Tt=ct.substring(8),Ot=Tt.split(";");if(Ot[0].substring(0,2)==="CC")for(De=0;De<Ot.length;De++)ht||(ht=at.call(this,Ze[yt])),Ce(ht,Ot[De].substring(0,3),Ot[De].substring(4)),nt.push(ht),ht=null;else for(De=0;De<Ot.length;De++)ht||(ht=at.call(this,Ze[yt])),Ce(ht,"CC"+(De+1),Ot[De]),nt.push(ht),ht=null}else ct.indexOf("cea-608")===0&&(Ce(ht,I.CC1,"eng"),nt.push(ht),ht=null)}}else Ne===I.IMAGE?(je(ht),nt.push(ht),ht=null):ht&&nt.push(ht);return nt}function re(Te,de,Re){var xe=p,Ne=Re,Xe=[];if(Ne)ot(),xe=D(Ne);else if(p.length>0)Ne=p[0].mpd.manifest;else return Xe;var nt=it(Te,xe),et=m.getAdaptationsForType(Ne,Te?Te.index:null,de);return Xe=Y(Ne,nt,Te,et,de),de===I.TEXT&&(et=m.getAdaptationsForType(Ne,Te?Te.index:null,I.VIDEO),Xe=Xe.concat(Y(Ne,nt,Te,et,de,!0))),Xe}function ie(Te){if(!Te)return null;ot(),p=D(Te)}function ee(Te,de){var Re=[],xe=p;if(Te&&(ot(),xe=D(Te)),xe.length>0){(!de||de>xe.length)&&(de=xe.length);for(var Ne=0;Ne<de;Ne++)Re.push(Ge(xe[Ne]))}return Re}function ne(Te,de){var Re,xe,Ne=it(Te,p);return Re=de?de.id:null,p.length>0&&Ne&&(xe=Re?m.getAdaptationForId(Re,p[0].mpd.manifest,Ne.index):m.getAdaptationForIndex(de?de.index:null,p[0].mpd.manifest,Ne.index)),xe}function ae(Te,de){var Re,xe,Ne=it(Te,p);return Re=de?de.id:null,p.length>0&&Ne&&(xe=Re?m.getAdaptationForId(Re,p[0].mpd.manifest,Ne.index):m.getAdaptationForIndex(de?de.index:null,p[0].mpd.manifest,Ne.index)),xe?m.getProducerReferenceTimesForAdaptation(xe):[]}function ce(Te){try{return m.getEssentialPropertiesForRepresentation(Te)}catch{return[]}}function X(Te){return m.getRealPeriodForIndex(Te,p[0].mpd.manifest)}function oe(Te){var de,Re=qe(Te);return de=m.getRepresentationsForAdaptation(Re),de}function ge(Te,de,Re,xe){try{if(!Te||!de||isNaN(Re)||!xe)return null;var Ne=Te.scheme_id_uri,Xe=Te.value;if(!de[Ne+"/"+Xe])return null;var nt=new E.default,et=Te.timescale||1,ht=xe.adaptation.period.start,yt=de[Ne+"/"+Xe],Pt=isNaN(xe.presentationTimeOffset)?isNaN(yt.presentationTimeOffset)?0:yt.presentationTimeOffset:xe.presentationTimeOffset,De=Te.presentation_time_delta/et,Ue;Te.version===0?Ue=ht+Re-Pt+De:Ue=ht-Pt+De;var Ze=Te.event_duration/et,Et=Te.id,ct=Te.message_data;return nt.eventStream=yt,nt.eventStream.value=Xe,nt.eventStream.timescale=et,nt.duration=Ze,nt.id=Et,nt.calculatedPresentationTime=Ue,nt.messageData=ct,nt.presentationTimeDelta=De,nt}catch{return null}}function _e(Te,de,Re){var xe=[];if(p.length>0){var Ne=p[0].mpd.manifest;if(Te instanceof d.default){var Xe=it(Te,p);xe=m.getEventsForPeriod(Xe)}else if(Te instanceof f.default){var nt=it(Re,p);xe=m.getEventStreamForAdaptationSet(Ne,qe(Te),nt)}else if(Te instanceof l.default){var et=it(Re,p);xe=m.getEventStreamForRepresentation(Ne,de,et)}}return xe}function he(Te,de,Re){C[Te]=C[Te]||{},C[Te][de]=C[Te][de]||{},C[Te][de]=Re}function se(Te){return m.getIsText(Te)}function Z(){var Te=Me();return m.getUTCTimingSources(Te)}function q(){var Te=p.length>0?p[0].mpd:null;return m.getSuggestedPresentationDelay(Te)}function le(Te){var de=w(Te);return m.getAvailabilityStartTime(de)}function te(Te){var de=Me(Te);return m.getIsDynamic(de)}function N(Te){var de=Me(Te);return m.getDuration(de)}function D(Te){var de=w(Te);return m.getRegularPeriods(de)}function w(Te){var de=Me(Te);return m.getMpd(de)}function W(Te){return m.getContentSteering(Te)}function H(Te){return m.getLocation(Te)}function U(Te){var de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return m.getManifestUpdatePeriod(Te,de)}function B(Te){return m.getPublishTime(Te)}function G(Te){var de=m.getPatchLocation(Te),Re=m.getPublishTime(Te);if(!de||!Re)return null;if(de.hasOwnProperty("ttl")&&Re){var xe=parseFloat(de.ttl)*1e3;if(Re.getTime()+xe<=new Date().getTime())return null}return de.__text}function z(Te){return m.hasProfile(Te,x)}function fe(Te){return M.getIsPatch(Te)}function ue(Te){return m.getBaseURLsFromElement(Te)}function J(){return m.getRepresentationSortFunction()}function ve(Te,de,Re){return m.getCodec(Te,de,Re)}function me(Te,de){var Re,xe=dt(de);return Re=Mt(xe,Te),Re?Re.bandwidth:null}function Ae(Te,de){var Re=dt(de);return gt(Re,Te)}function be(Te,de){var Re=dt(de);return $e(Re,Te)}function Be(Te){if(!Te||p.length===0)return null;var de=p.filter(function(Re){return Re.id===Te});return de&&de.length>0?de[0]:null}function ke(Te,de){return m.getIsTypeOf(Te,de)}function Ye(){p=[],C={}}function Le(Te,de){var Re=m.getId(Te),xe=M.getMpdId(de),Ne=m.getPublishTime(Te),Xe=M.getPublishTime(de),nt=M.getOriginalPublishTime(de);return!!(Re&&xe&&Re==xe&&Ne&&nt&&Ne.getTime()==nt.getTime()&&Xe&&Ne.getTime()<Xe.getTime())}function Se(Te,de){M.getPatchOperations(de).forEach(function(Re){var xe=Re.getMpdTarget(Te);if(xe!==null){var Ne=xe.name,Xe=xe.target,nt=xe.leaf;if(Re.xpath.findsAttribute()){switch(Re.action){case"add":case"replace":Xe[Ne]=Re.value;break;case"remove":delete Xe[Ne];break}return}var et=(Xe[Ne+"_asArray"]||[]).indexOf(nt),ht=Re.position==="prepend"||Re.position==="before";if((Re.action==="remove"||Re.action==="replace")&&(delete Xe[Ne],et!=-1)){var yt=Xe[Ne+"_asArray"];yt.splice(et,1),yt.length>1?Xe[Ne]=yt:yt.length==1?Xe[Ne]=yt[0]:delete Xe[Ne+"_asArray"]}(Re.action==="add"||Re.action==="replace")&&Object.keys(Re.value).forEach(function(Pt){var De=Re.value[Pt],Ue=Xe[Pt+"_asArray"]||[];if(Ue.length===0&&Xe[Pt]&&Ue.push(Xe[Pt]),Ue.length===0)Ue=De;else{var Ze=Ue.length;Pt==Ne&&et!=-1?Ze=et+(ht?0:1)+(Re.action=="replace"?-1:0):Ze=ht?0:Ue.length,Ue.splice.apply(Ue,[Ze,0].concat(De))}Xe[Pt+"_asArray"]=Ue,Xe[Pt]=Ue.length==1?Ue[0]:Ue})}})}function Me(Te){return Te||(p.length>0?p[0].mpd.manifest:null)}function qe(Te){try{var de=it(Te.streamInfo,p),Re=m.getAdaptationsForPeriod(de);return!Te||!Te.streamInfo||Te.streamInfo.id===void 0||!Re?null:Re[Te.index]}catch{return null}}function it(Te,de){for(var Re=de.length,xe=0;xe<Re;xe++){var Ne=de[xe];if(Te&&Te.id===Ne.id)return Ne}return null}function at(Te){if(!Te)return null;var de=new f.default,Re=Te.period.mpd.manifest.Period_asArray[Te.period.index].AdaptationSet_asArray[Te.index],xe;if(de.id=Te.id,de.index=Te.index,de.type=Te.type,de.streamInfo=Ge(Te.period),de.representationCount=m.getRepresentationCount(Re),de.labels=m.getLabelsForAdaptation(Re),de.lang=m.getLanguageForAdaptation(Re),xe=m.getViewpointForAdaptation(Re),de.viewpoint=xe?xe.value:void 0,de.accessibility=m.getAccessibilityForAdaptation(Re).map(function(nt){var et=nt.value,ht=et;return nt.schemeIdUri&&nt.schemeIdUri.search("cea-608")>=0&&typeof A<"u"&&(et?ht="cea-608:"+et:ht="cea-608",de.embeddedCaptions=!0),ht}),de.audioChannelConfiguration=m.getAudioChannelConfigurationForAdaptation(Re).map(function(nt){return nt.value}),de.audioChannelConfiguration.length===0&&Array.isArray(Re.Representation_asArray)&&Re.Representation_asArray.length>0&&(de.audioChannelConfiguration=m.getAudioChannelConfigurationForRepresentation(Re.Representation_asArray[0]).map(function(nt){return nt.value})),de.roles=m.getRolesForAdaptation(Re).map(function(nt){return nt.value}),de.codec=m.getCodec(Re),de.mimeType=m.getMimeType(Re),de.contentProtection=m.getContentProtectionData(Re),de.bitrateList=m.getBitrateListForAdaptation(Re),de.selectionPriority=m.getSelectionPriority(Re),de.contentProtection){var Ne=de.contentProtection.map(function(nt){return m.getKID(nt)}).filter(function(nt){return nt!==null});if(Ne.length){var Xe=Ne[0];de.contentProtection.forEach(function(nt){nt.keyId=Xe})}}return de.isText=m.getIsText(Re),de.supplementalProperties=m.getSupplementalProperties(Re),de.isFragmented=m.getIsFragmented(Re),de.isEmbedded=!1,de}function Ce(Te,de,Re){Te.id=de,Te.index=100+parseInt(de.substring(2,3)),Te.type=I.TEXT,Te.codec="cea-608-in-SEI",Te.isEmbedded=!0,Te.isFragmented=!1,Te.lang=b()(Re),Te.roles=["caption"]}function je(Te){Te.type=I.IMAGE}function Ge(Te){var de=new d.default,Re=1;return de.id=Te.id,de.index=Te.index,de.start=Te.start,de.duration=Te.duration,de.manifestInfo=tt(Te.mpd),de.isLast=Te.mpd.manifest.Period_asArray.length===1||Math.abs(de.start+de.duration-de.manifestInfo.duration)<Re,de}function tt(Te){var de=new _.default;return de.dvrWindowSize=Te.timeShiftBufferDepth,de.loadedTime=Te.manifest.loadedTime,de.availableFrom=Te.availabilityStartTime,de.minBufferTime=Te.manifest.minBufferTime,de.maxFragmentDuration=Te.maxSegmentDuration,de.duration=m.getDuration(Te.manifest),de.isDynamic=m.getIsDynamic(Te.manifest),de.serviceDescriptions=m.getServiceDescriptions(Te.manifest),de.protocol=Te.manifest.protocol,de}function ot(){if(!I)throw new Error("setConfig function has to be called previously")}function dt(Te){return p.length>0?p[0].mpd.manifest.Period_asArray[Te]:null}function gt(Te,de){var Re=Mt(Te,de,!0);return Re!==null?Re:-1}function Mt(Te,de,Re){var xe,Ne,Xe,nt,et,ht;if(Te){for(Ne=Te.AdaptationSet_asArray,et=0;et<Ne.length;et=et+1)for(xe=Ne[et],nt=xe.Representation_asArray,ht=0;ht<nt.length;ht=ht+1)if(Xe=nt[ht],de===Xe.id)return Re?ht:Xe}return null}function $e(Te,de){var Re,xe,Ne,Xe;if(!Te||!de)return-1;for(xe=Te.AdaptationSet_asArray,Xe=0;Xe<xe.length;Xe=Xe+1)if(Re=xe[Xe],Ne=Re.Representation_asArray,m.getIsTypeOf(Re,de))return Ne.length;return-1}return T={getBandwidthForRepresentation:me,getIndexForRepresentation:Ae,getMaxIndexForBufferType:be,convertRepresentationToRepresentationInfo:j,getStreamsInfo:ee,getMediaInfoForType:V,getAllMediaInfoForType:re,getAdaptationForType:$,getRealAdaptation:ne,getProducerReferenceTimes:ae,getRealPeriodByIndex:X,getEssentialPropertiesForRepresentation:ce,getVoRepresentations:oe,getEventsFor:_e,getEvent:ge,getMpd:w,setConfig:k,updatePeriods:ie,getIsTextTrack:se,getUTCTimingSources:Z,getSuggestedPresentationDelay:q,getAvailabilityStartTime:le,getIsTypeOf:ke,getIsDynamic:te,getDuration:N,getRegularPeriods:D,getContentSteering:W,getLocation:H,getPatchLocation:G,getManifestUpdatePeriod:U,getPublishTime:B,getIsDVB:z,getIsPatch:fe,getBaseURLsFromElement:ue,getRepresentationSortFunction:J,getCodec:ve,getPeriodById:Be,setCurrentMediaInfo:he,isPatchValid:Le,applyPatchToManifest:Se,areMediaInfosEqual:K,reset:Ye},F(),T}L.__dashjs_factory_name="DashAdapter";const R=c.default.getSingletonFactory(L)},"./src/dash/DashHandler.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>P});var u=r("./src/streaming/vo/FragmentRequest.js"),l=r("./src/streaming/vo/metrics/HTTPRequest.js"),f=r("./src/core/FactoryMaker.js"),d=r("./src/streaming/MediaPlayerEvents.js"),_=r("./src/dash/utils/SegmentsUtils.js"),E=r("./src/dash/constants/DashConstants.js"),c=.5,y=.001;function O(b){b=b||{};var L=b.eventBus,R=b.debug,T=b.urlUtils,m=b.type,M=b.streamInfo,p=b.segmentsController,C=b.timelineConverter,I=b.baseURLController,A,S,x,F,k;function j(){S=R.getLogger(A),Y(),L.on(d.default.DYNAMIC_TO_STATIC,se,A)}function V(Z){F=Z,k=!1,p.initialize(Z)}function Q(){return M.id}function $(){return m}function K(){return M}function Y(){x=null}function re(){Y(),L.off(d.default.DYNAMIC_TO_STATIC,se,A)}function ie(Z,q,le){var te=I.resolve(le.path),N,D;return!te||q===te.url||!T.isRelative(q)?N=q:(N=te.url,D=te.serviceLocation,q&&(N=T.resolve(q,N))),T.isRelative(N)?!1:(Z.url=N,Z.serviceLocation=D,!0)}function ee(Z,q){return q?ne(Z,q,$()):null}function ne(Z,q,le){var te=new u.default,N=q.adaptation.period,D=N.start;if(te.mediaType=le,te.type=l.HTTPRequest.INIT_SEGMENT_TYPE,te.range=q.range,te.availabilityStartTime=C.calcAvailabilityStartTimeFromPresentationTime(D,q,F),te.availabilityEndTime=C.calcAvailabilityEndTimeFromPresentationTime(D+N.duration,q,F),te.quality=q.index,te.mediaInfo=Z,te.representationId=q.id,ie(te,q.initialization,q))return te.url=(0,_.replaceTokenForTemplate)(te.url,"Bandwidth",q.bandwidth),te}function ae(Z,q){if(q==null)return null;var le=new u.default,te=q.representation,N=te.adaptation.period.mpd.manifest.Period_asArray[te.adaptation.period.index].AdaptationSet_asArray[te.adaptation.index].Representation_asArray[te.index].bandwidth,D=q.media;if(D=(0,_.replaceTokenForTemplate)(D,"Number",q.replacementNumber),D=(0,_.replaceTokenForTemplate)(D,"Time",q.replacementTime),D=(0,_.replaceTokenForTemplate)(D,"Bandwidth",N),D=(0,_.replaceIDForTemplate)(D,te.id),D=(0,_.unescapeDollarsInTemplate)(D),le.mediaType=$(),le.type=l.HTTPRequest.MEDIA_SEGMENT_TYPE,le.range=q.mediaRange,le.startTime=q.presentationStartTime,le.mediaStartTime=q.mediaStartTime,le.duration=q.duration,le.timescale=te.timescale,le.availabilityStartTime=q.availabilityStartTime,le.availabilityEndTime=q.availabilityEndTime,le.availabilityTimeComplete=te.availabilityTimeComplete,le.wallStartTime=q.wallStartTime,le.quality=te.index,le.index=q.index,le.mediaInfo=Z,le.adaptationIndex=te.adaptation.index,le.representationId=te.id,ie(le,D,te))return le}function ce(Z,q){if(!Z||!x)return!1;if(k)return!0;if(!isFinite(Z.adaptation.period.duration)||x.presentationStartTime+x.duration>q)return!1;if(Z.mediaFinishedInformation&&!isNaN(Z.mediaFinishedInformation.numberOfSegments)&&!isNaN(x.index)&&x.index>=Z.mediaFinishedInformation.numberOfSegments-1){if(!F||Z.segmentInfoType===E.default.SEGMENT_TEMPLATE)return!0;if(F&&Z.segmentInfoType===E.default.SEGMENT_LIST&&Z.adaptation.period.nextPeriodId)return!0}return!!(F&&Z.adaptation.period.nextPeriodId&&Z.segmentInfoType===E.default.SEGMENT_TIMELINE&&Z.mediaFinishedInformation&&!isNaN(Z.mediaFinishedInformation.mediaTimeOfLastSignaledSegment)&&x&&!isNaN(x.mediaStartTime)&&!isNaN(x.duration)&&x.mediaStartTime+x.duration>=Z.mediaFinishedInformation.mediaTimeOfLastSignaledSegment-.05)}function X(Z,q,le){var te=null;if(!q||!q.segmentInfoType)return te;var N=p.getSegmentByTime(q,le);return N&&(x=N,S.debug("Index for time "+le+" is "+N.index),te=ae(Z,N)),te}function oe(Z,q){var le=null,te=x?x.index+1:0,N=p.getSegmentByIndex(q,te,x?x.mediaStartTime:-1);return N?(le=ae(Z,N),le):null}function ge(Z,q){var le=null;if(!q||!q.segmentInfoType)return null;var te=x?x.index+1:0,N=p.getSegmentByIndex(q,te,x?x.mediaStartTime:-1);if(N)le=ae(Z,N),x=N;else{if(F&&!k)return S.debug($()+" No segment found at index: "+te+". Wait for next loop"),null;k=!0}return le}function _e(Z,q,le,te){try{if(isNaN(Z)||!q||!le)return NaN;if(Z<0&&(Z=0),isNaN(te)&&(te=c),X(q,le,Z))return Z;if(le.adaptation.period.start+le.adaptation.period.duration<Z)return NaN;for(var N=isFinite(le.adaptation.period.duration)?le.adaptation.period.start+le.adaptation.period.duration:Z+30,D=Math.min(Z+te,N),w=NaN,W=null;D<=N;){var H=null;if(D<=N&&(H=X(q,le,D)),H){w=D,W=H;break}D+=te}if(W){var U=W.startTime+W.duration;return Z>W.startTime&&U-Z>te?Z:!isNaN(W.startTime)&&Z<W.startTime&&w>W.startTime?W.startTime+y:Math.min(U-te,w)}return w}catch{return NaN}}function he(){return x?x.index:-1}function se(){S.debug("Dynamic stream complete"),k=!0}return A={initialize:V,getStreamId:Q,getType:$,getStreamInfo:K,getInitRequest:ee,getSegmentRequestForTime:X,getCurrentIndex:he,getNextSegmentRequest:ge,isLastSegmentRequested:ce,reset:re,getNextSegmentRequestIdempotent:oe,getValidTimeAheadOfTargetTime:_e},j(),A}O.__dashjs_factory_name="DashHandler";const P=f.default.getClassFactory(O)},"./src/dash/DashMetrics.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>P});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/streaming/vo/metrics/HTTPRequest.js"),f=r("./src/core/FactoryMaker.js"),d=r("./src/streaming/constants/MetricsConstants.js"),_=r("./src/dash/utils/Round10.js"),E=r("./src/streaming/models/MetricsModel.js"),c=r("./src/core/Utils.js"),y=r("./src/streaming/vo/metrics/PlayList.js");function O(b){b=b||{};var L=this.context,R,T,m,M,p=b.metricsModel;function C(){p=p||(0,E.default)(L).getInstance({settings:b.settings}),I()}function I(){T=!0,m=null,M=null}function A(H){var U=p.getMetricsFor(H,!0);return Y(U,d.default.TRACK_SWITCH)}function S(H,U,B,G,z){p.addRepresentationSwitch(H,U,B,G,z)}function x(H){var U=p.getMetricsFor(H,!0);return Y(U,d.default.BUFFER_STATE)}function F(H){var U=p.getMetricsFor(H,!0),B=Y(U,d.default.BUFFER_LEVEL);return B?_.default.round10(B.level/1e3,-3):0}function k(H,U,B){p.addBufferLevel(H,U,B)}function j(H,U,B){p.addBufferState(H,U,B)}function V(){p.clearAllCurrentMetrics()}function Q(H){var U=p.getMetricsFor(H,!0);if(!U)return null;var B=U.HttpList,G=null,z;if(!B||B.length<=0)return null;for(z=B.length-1;z>=0;){if(B[z].responsecode){G=B[z];break}z--}return G}function $(H){var U=p.getMetricsFor(H,!0);return U?U.HttpList?U.HttpList:[]:[]}function K(H,U,B){p.addRequestsQueue(H,U,B)}function Y(H,U){if(!H)return null;var B=H[U];return!B||B.length===0?null:B[B.length-1]}function re(){var H=p.getMetricsFor(u.default.VIDEO,!0);return Y(H,d.default.DROPPED_FRAMES)}function ie(H){p.addDroppedFrames(u.default.VIDEO,H)}function ee(H){var U=p.getMetricsFor(H,!0);return Y(U,d.default.SCHEDULING_INFO)}function ne(H,U){p.addSchedulingInfo(H.mediaType,new Date,H.type,H.startTime,H.availabilityStartTime,H.duration,H.quality,H.range,U)}function ae(){var H=p.getMetricsFor(u.default.STREAM);return Y(H,d.default.MANIFEST_UPDATE)}function ce(H){var U=this.getCurrentManifestUpdate();p.updateManifestUpdateInfo(U,H)}function X(H){if(H){var U=this.getCurrentManifestUpdate();p.addManifestUpdateStreamInfo(U,H.id,H.index,H.start,H.duration)}}function oe(H){p.addManifestUpdate(u.default.STREAM,H.type,H.requestStartDate,H.requestEndDate)}function ge(H,U,B,G,z,fe){p.addHttpRequest(H.mediaType,null,H.type,H.url,H.quality,U,H.serviceLocation||null,H.range||null,H.requestStartDate,H.firstByteDate,H.requestEndDate,B,H.duration,G,z,H.fileLoaderType,fe)}function _e(H,U){if(H){var B=this.getCurrentManifestUpdate();p.addManifestUpdateRepresentationInfo(B,H.id,H.index,H.streamIndex,U,H.presentationTimeOffset,H.startNumber,H.fragmentInfoType)}}function he(H){var U=H?p.getMetricsFor(H,!0):p.getMetricsFor(u.default.VIDEO,!0)||p.getMetricsFor(u.default.AUDIO,!0);return Y(U,d.default.DVR_INFO)}function se(H,U,B,G){p.addDVRInfo(H,U,B,G)}function Z(H){if(!H)return null;var U={},B,G,z;for(B=$(u.default.STREAM),z=B.length-1;z>=0;z--)if(G=B[z],G.type===l.HTTPRequest.MPD_TYPE){U=c.default.parseHttpHeaders(G._responseHeaders);break}var fe=U[H.toLowerCase()];return fe===void 0?null:fe}function q(H,U){if(!U)return null;var B={},G=Q(H);G&&(B=c.default.parseHttpHeaders(G._responseHeaders));var z=B[U.toLowerCase()];return z===void 0?null:z}function le(){M&&(p.addPlayList(M),M=null)}function te(H,U){M=new y.PlayList,M.start=new Date,M.mstart=H,M.starttype=U}function N(H,U,B){T===!0&&(T=!1,m=new y.PlayListTrace,m.representationid=H,m.start=new Date,m.mstart=U,m.playbackspeed=B!==null?B.toString():null)}function D(H){if(m)for(var U in m)m[U]=H[U]}function w(H,U){if(T===!1&&M&&m&&m.start){var B=m.start,G=H.getTime()-B.getTime();m.duration=G,m.stopreason=U,M.trace.push(m),T=!0}}function W(H){p.addDVBErrors(H)}return R={getCurrentRepresentationSwitch:A,getCurrentBufferState:x,getCurrentBufferLevel:F,getCurrentHttpRequest:Q,getHttpRequests:$,getCurrentDroppedFrames:re,getCurrentSchedulingInfo:ee,getCurrentDVRInfo:he,getCurrentManifestUpdate:ae,getLatestFragmentRequestHeaderValueByID:q,getLatestMPDRequestHeaderValueByID:Z,addRepresentationSwitch:S,addDVRInfo:se,updateManifestUpdateInfo:ce,addManifestUpdateStreamInfo:X,addManifestUpdateRepresentationInfo:_e,addManifestUpdate:oe,addHttpRequest:ge,addSchedulingInfo:ne,addRequestsQueue:K,addBufferLevel:k,addBufferState:j,addDroppedFrames:ie,addPlayList:le,addDVBErrors:W,createPlaylistMetrics:te,createPlaylistTraceMetrics:N,updatePlayListTraceMetrics:D,pushPlayListTraceMetrics:w,clearAllCurrentMetrics:V},C(),R}O.__dashjs_factory_name="DashMetrics";const P=f.default.getSingletonFactory(O)},"./src/dash/SegmentBaseLoader.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>c});var u=r("./src/dash/vo/Segment.js"),l=r("./src/streaming/vo/DashJSError.js"),f=r("./src/core/FactoryMaker.js"),d=r("./src/streaming/vo/FragmentRequest.js"),_=r("./src/streaming/net/URLLoader.js");function E(){var y=this.context,O,P,b,L,R,T,m,M,p,C,I,A,S;function x(){M=(0,_.default)(y).create({errHandler:b,dashMetrics:T,mediaPlayerModel:m,requestModifier:R,boxParser:L,errors:p,urlUtils:A,constants:C,dashConstants:I})}function F(ie){ie.baseURLController&&(S=ie.baseURLController),ie.dashMetrics&&(T=ie.dashMetrics),ie.mediaPlayerModel&&(m=ie.mediaPlayerModel),ie.errHandler&&(b=ie.errHandler),ie.boxParser&&(L=ie.boxParser),ie.debug&&(P=ie.debug.getLogger(O)),ie.requestModifier&&(R=ie.requestModifier),ie.errors&&(p=ie.errors),ie.urlUtils&&(A=ie.urlUtils),ie.constants&&(C=ie.constants),ie.dashConstants&&(I=ie.dashConstants)}function k(ie,ee){return new Promise(function(ne){j(ie,ee,ne)})}function j(ie,ee,ne,ae){var ce=null,X=ie?S.resolve(ie.path):null,oe=ae||{init:!0,url:X?X.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:ee};P.debug("Start searching for initialization.");var ge=re(oe),_e=function(Z){if(oe.bytesLoaded=oe.range.end,ce=L.findInitRange(Z),ce)ie.range=ce,ne(ie);else return oe.range.end=oe.bytesLoaded+oe.bytesToLoad,j(ie,ee,ne,oe)},he=function(){ne(ie)};M.load({request:ge,success:_e,error:he}),P.debug("Perform init search: "+oe.url)}function V(ie,ee,ne){return new Promise(function(ae){Q(ie,ee,ne,ae)})}function Q(ie,ee,ne,ae,ce,X){if(ne&&(ne.start===void 0||ne.end===void 0)){var oe=ne?ne.toString().split("-"):null;ne=oe?{start:parseFloat(oe[0]),end:parseFloat(oe[1])}:null}ce=ce||$;var ge=null,_e=null,he=!!ne,se=ie?S.resolve(ie.path):null,Z={init:!1,url:se?se.url:void 0,range:he?ne:{start:0,end:1500},searching:!he,bytesLoaded:X?X.bytesLoaded:0,bytesToLoad:1500,mediaType:ee},q=re(Z),le=function(D){var w=Z.bytesToLoad,W=D.byteLength;if(Z.bytesLoaded=Z.range.end-Z.range.start,ge=L.parse(D),_e=ge.getBox("sidx"),!_e||!_e.isComplete){if(_e)Z.range.start=_e.offset||Z.range.start,Z.range.end=Z.range.start+(_e.size||w);else if(W<Z.bytesLoaded){ce(null,ie,ae);return}else{var H=ge.getLastBox();H&&H.size?(Z.range.start=H.offset+H.size,Z.range.end=Z.range.start+w):Z.range.end+=w}Q(ie,ee,Z.range,ae,null,Z)}else{var U=_e.references,B,G;if(U!=null&&U.length>0&&(B=U[0].reference_type===1),B){P.debug("Initiate multiple SIDX load."),Z.range.end=Z.range.start+_e.size;var z,fe,ue,J,ve,me=[],Ae=0,be=(_e.offset||Z.range.start)+_e.size,Be=function(Ye){Ye?(me=me.concat(Ye),Ae++,Ae>=fe&&(me.sort(function(Le,Se){return Le.startTime-Se.startTime<0?-1:0}),ce(me,ie,ae))):ce(null,ie,ae)};for(z=0,fe=U.length;z<fe;z++)ue=be,J=be+U[z].referenced_size-1,be=be+U[z].referenced_size,ve={start:ue,end:J},Q(ie,ee,ve,ae,Be,Z)}else P.debug("Parsing segments from SIDX. representation "+ee+" - id: "+ie.id+" for range : "+Z.range.start+" - "+Z.range.end),G=Y(_e,Z),ce(G,ie,ae)}},te=function(){ce(null,ie,ae)};M.load({request:q,success:le,error:te}),P.debug("Perform SIDX load for type ".concat(ee," : ").concat(Z.url," with range ").concat(Z.range.start," - ").concat(Z.range.end))}function $(ie,ee,ne){ne({segments:ie,representation:ee,error:ie?void 0:new l.default(p.SEGMENT_BASE_LOADER_ERROR_CODE,p.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function K(){M&&(M.abort(),M=null)}function Y(ie,ee){for(var ne=ie.references,ae=ne.length,ce=ie.timescale,X=ie.earliest_presentation_time,oe=ee.range.start+ie.offset+ie.first_offset+ie.size,ge=[],_e,he,se,Z,q=0;q<ae;q++)se=ne[q].subsegment_duration,Z=ne[q].referenced_size,_e=new u.default,_e.duration=se,_e.startTime=X,_e.timescale=ce,he=oe+Z-1,_e.mediaRange=oe+"-"+he,ge.push(_e),X+=se,oe+=Z;return ge}function re(ie){if(ie.url){var ee=new d.default;return ee.setInfo(ie),ee}}return O={setConfig:F,initialize:x,loadInitialization:k,loadSegments:V,reset:K},O}E.__dashjs_factory_name="SegmentBaseLoader";const c=f.default.getSingletonFactory(E)},"./src/dash/WebmSegmentBaseLoader.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>O});var u=r("./src/streaming/utils/EBMLParser.js"),l=r("./src/streaming/constants/Constants.js"),f=r("./src/core/FactoryMaker.js"),d=r("./src/dash/vo/Segment.js"),_=r("./src/streaming/vo/FragmentRequest.js"),E=r("./src/streaming/net/URLLoader.js"),c=r("./src/streaming/vo/DashJSError.js");function y(){var P=this.context,b,L,R,T,m,M,p,C,I,A;function S(){R={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}}}function x(){C=(0,E.default)(P).create({errHandler:T,dashMetrics:M,mediaPlayerModel:p,requestModifier:m,errors:I})}function F(re){if(!re.baseURLController||!re.dashMetrics||!re.mediaPlayerModel||!re.errHandler)throw new Error(l.default.MISSING_CONFIG_ERROR);A=re.baseURLController,M=re.dashMetrics,p=re.mediaPlayerModel,T=re.errHandler,I=re.errors,L=re.debug.getLogger(b),m=re.requestModifier}function k(re){var ie=[],ee=(0,u.default)(P).create({data:re}),ne,ae;for(ee.consumeTagAndSize(R.Segment.Cues);ee.moreData()&&ee.consumeTagAndSize(R.Segment.Cues.CuePoint,!0);){for(ne={},ne.CueTime=ee.parseTag(R.Segment.Cues.CuePoint.CueTime),ne.CueTracks=[];ee.moreData()&&ee.consumeTag(R.Segment.Cues.CuePoint.CueTrackPositions,!0);){var ce=ee.getMatroskaCodedNum(),X=ee.getPos();if(ae={},ae.Track=ee.parseTag(R.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),ae.Track===0)throw new Error("Cue track cannot be 0");ae.ClusterPosition=ee.parseTag(R.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),ne.CueTracks.push(ae),ee.setPos(X+ce)}if(ne.CueTracks.length===0)throw new Error("Mandatory cuetrack not found");ie.push(ne)}if(ie.length===0)throw new Error("mandatory cuepoint not found");return ie}function j(re,ie,ee,ne){var ae,ce,X,oe,ge,_e,he,se;for(ce=k(re),X=[],ge=0,_e=ce.length;ge<_e;ge+=1)oe=new d.default,ae=0,ge<ce.length-1?ae=ce[ge+1].CueTime-ce[ge].CueTime:ae=ne-ce[ge].CueTime,oe.duration=ae,oe.startTime=ce[ge].CueTime,oe.timescale=1e3,he=ce[ge].CueTracks[0].ClusterPosition+ie,ge<ce.length-1?se=ce[ge+1].CueTracks[0].ClusterPosition+ie-1:se=ee-1,oe.mediaRange=he+"-"+se,X.push(oe);return L.debug("Parsed cues: "+X.length+" cues."),X}function V(re,ie,ee,ne){if(!re||re.byteLength===0){ne(null);return}var ae=(0,u.default)(P).create({data:re}),ce,X,oe,ge,_e=ee?ee.split("-"):null,he=null,se={url:ie,range:{start:_e?parseFloat(_e[0]):null,end:_e?parseFloat(_e[1]):null},request:he};for(L.debug("Parse EBML header: "+se.url),ae.skipOverElement(R.EBML),ae.consumeTag(R.Segment),oe=ae.getMatroskaCodedNum(),oe+=ae.getPos(),ge=ae.getPos();ae.moreData()&&!ae.consumeTagAndSize(R.Segment.Info,!0);)if(!(ae.skipOverElement(R.Segment.SeekHead,!0)||ae.skipOverElement(R.Segment.Tracks,!0)||ae.skipOverElement(R.Segment.Cues,!0)||ae.skipOverElement(R.Void,!0)))throw new Error("no valid top level element found");for(;ce===void 0;){var Z=ae.getMatroskaCodedNum(!0),q=ae.getMatroskaCodedNum();switch(Z){case R.Segment.Info.Duration.tag:ce=ae[R.Segment.Info.Duration.parse](q);break;default:ae.setPos(ae.getPos()+q);break}}he=K(se);var le=function(D){X=j(D,ge,oe,ce),ne(X)},te=function(){L.error("Download Error: Cues "+se.url),ne(null)};C.load({request:he,success:le,error:te}),L.debug("Perform cues load: "+se.url+" bytes="+se.range.start+"-"+se.range.end)}function Q(re,ie){return new Promise(function(ee){var ne=null,ae=re?A.resolve(re.path):null,ce=re?re.range.split("-"):null,X={range:{start:ce?parseFloat(ce[0]):null,end:ce?parseFloat(ce[1]):null},request:ne,url:ae?ae.url:void 0,init:!0,mediaType:ie};L.info("Start loading initialization."),ne=K(X);var oe=function(){ee(re)},ge=function(){ee(re)};C.load({request:ne,success:oe,error:ge}),L.debug("Perform init load: "+X.url)})}function $(re,ie,ee){return new Promise(function(ne){var ae=null,ce=re?A.resolve(re.path):null,X=ce?ce.url:void 0,oe=8192,ge={bytesLoaded:0,bytesToLoad:oe,range:{start:0,end:oe},request:ae,url:X,init:!1,mediaType:ie};ae=K(ge),L.debug("Parsing ebml header");var _e=function(Z){V(Z,X,ee,function(q){ne({segments:q,representation:re,error:q?void 0:new c.default(I.SEGMENT_BASE_LOADER_ERROR_CODE,I.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})})},he=function(){ne({representation:re,error:new c.default(I.SEGMENT_BASE_LOADER_ERROR_CODE,I.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})};C.load({request:ae,success:_e,error:he})})}function K(re){var ie=new _.default;return ie.setInfo(re),ie}function Y(){C&&(C.abort(),C=null)}return b={setConfig:F,initialize:x,loadInitialization:Q,loadSegments:$,reset:Y},S(),b}y.__dashjs_factory_name="WebmSegmentBaseLoader";const O=f.default.getSingletonFactory(y)},"./src/dash/constants/DashConstants.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});function u(c,y){if(!(c instanceof y))throw new TypeError("Cannot call a class as a function")}function l(c,y){for(var O=0;O<y.length;O++){var P=y[O];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(c,P.key,P)}}function f(c,y,O){return y&&l(c.prototype,y),O&&l(c,O),c}var d=function(){function c(){u(this,c),this.init()}return f(c,[{key:"init",value:function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.INBAND_EVENT_STREAM="InbandEventStream",this.PRODUCER_REFERENCE_TIME="ProducerReferenceTime",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.ROLE_ASARRAY="Role_asArray",this.REPRESENTATION_ASARRAY="Representation_asArray",this.PRODUCERREFERENCETIME_ASARRAY="ProducerReferenceTime_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.STATIC="static",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SERVICE_DESCRIPTION="ServiceDescription",this.SERVICE_DESCRIPTION_SCOPE="Scope",this.SERVICE_DESCRIPTION_LATENCY="Latency",this.SERVICE_DESCRIPTION_PLAYBACK_RATE="PlaybackRate",this.SERVICE_DESCRIPTION_OPERATING_QUALITY="OperatingQuality",this.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH="OperatingBandwidth",this.PATCH_LOCATION="PatchLocation",this.PUBLISH_TIME="publishTime",this.ORIGINAL_PUBLISH_TIME="originalPublishTime",this.ORIGINAL_MPD_ID="mpdId",this.WALL_CLOCK_TIME="wallClockTime",this.PRESENTATION_TIME="presentationTime",this.LABEL="Label",this.GROUP_LABEL="GroupLabel",this.CONTENT_STEERING="ContentSteering",this.CONTENT_STEERING_AS_ARRAY="ContentSteering_asArray",this.DEFAULT_SERVICE_LOCATION="defaultServiceLocation",this.QUERY_BEFORE_START="queryBeforeStart",this.PROXY_SERVER_URL="proxyServerURL",this.CONTENT_STEERING_RESPONSE={VERSION:"VERSION",TTL:"TTL",RELOAD_URI:"RELOAD-URI",SERVICE_LOCATION_PRIORITY:"SERVICE-LOCATION-PRIORITY"}}}]),c}(),_=new d;const E=_},"./src/dash/controllers/ContentSteeringController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>m});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),f=r("./src/streaming/net/URLLoader.js"),d=r("./src/core/errors/Errors.js"),_=r("./src/dash/vo/ContentSteeringRequest.js"),E=r("./src/dash/vo/ContentSteeringResponse.js"),c=r("./src/dash/constants/DashConstants.js"),y=r("./src/streaming/MediaPlayerEvents.js"),O=r("./src/core/events/Events.js"),P=r("./src/streaming/constants/Constants.js"),b=r("./src/core/Utils.js"),L=r("./src/streaming/utils/URLUtils.js"),R={THROUGHPUT:"_DASH_throughput",PATHWAY:"_DASH_pathway",URL:"url"};function T(){var M=this.context,p=(0,L.default)(M).getInstance(),C,I,A,S,x,F,k,j,V,Q,$,K,Y,re,ie;function ee(){I=(0,l.default)(M).getInstance().getLogger(C),D()}function ne(w){w&&(w.adapter&&(ie=w.adapter),w.errHandler&&(j=w.errHandler),w.dashMetrics&&(V=w.dashMetrics),w.mediaPlayerModel&&(Q=w.mediaPlayerModel),w.requestModifier&&(K=w.requestModifier),w.manifestModel&&($=w.manifestModel),w.abrController&&(Y=w.abrController),w.eventBus&&(re=w.eventBus))}function ae(){k=(0,f.default)(M).create({errHandler:j,dashMetrics:V,mediaPlayerModel:Q,requestModifier:K,errors:d.default}),re.on(y.default.PERIOD_SWITCH_COMPLETED,ce,C),re.on(O.default.FRAGMENT_LOADING_STARTED,X,C)}function ce(w){w&&w.toStreamInfo&&(S=w.toStreamInfo)}function X(w){w&&w.request&&w.request.serviceLocation&&(x=w.request.serviceLocation)}function oe(){var w=$.getValue();return ie.getContentSteering(w)}function ge(){var w=oe();return w&&w.queryBeforeStart}function _e(){return new Promise(function(w){try{var W=oe();if(!W||!W.serverUrl){w();return}var H=he(W),U=new _.default(H);k.load({request:U,success:function(G){se(G),re.trigger(y.default.CONTENT_STEERING_REQUEST_COMPLETED,{currentSteeringResponseData:A,url:H}),w()},error:function(G){le(G),w(G)}})}catch(B){w(B)}})}function he(w){var W=w.proxyServerUrl?w.proxyServerUrl:w.serverUrl;A&&A.reloadUri&&(p.isRelative(A.reloadUri)?W=p.resolve(A.reloadUri,w.serverUrl):W=A.reloadUri);var H=[];if(S){var U=ie.getIsDynamic(),B=ie.getAllMediaInfoForType(S,P.default.VIDEO).length>0?P.default.VIDEO:P.default.AUDIO,G=Y.getThroughputHistory(),z=G?G.getAverageThroughput(B,U):NaN;isNaN(z)||H.push({key:R.THROUGHPUT,value:z*1e3})}return x&&H.push({key:R.PATHWAY,value:x}),w.proxyServerUrl&&w.proxyServerUrl===W&&w.serverUrl&&H.push({key:R.URL,value:encodeURI(w.serverUrl)}),W=b.default.addAditionalQueryParameterToUrl(W,H),W}function se(w){!w||!w[c.default.CONTENT_STEERING_RESPONSE.VERSION]||parseInt(w[c.default.CONTENT_STEERING_RESPONSE.VERSION])!==1||(A=new E.default,A.version=w[c.default.CONTENT_STEERING_RESPONSE.VERSION],w[c.default.CONTENT_STEERING_RESPONSE.TTL]&&!isNaN(w[c.default.CONTENT_STEERING_RESPONSE.TTL])&&(A.ttl=w[c.default.CONTENT_STEERING_RESPONSE.TTL]),w[c.default.CONTENT_STEERING_RESPONSE.RELOAD_URI]&&(A.reloadUri=w[c.default.CONTENT_STEERING_RESPONSE.RELOAD_URI]),w[c.default.CONTENT_STEERING_RESPONSE.SERVICE_LOCATION_PRIORITY]&&(A.serviceLocationPriority=w[c.default.CONTENT_STEERING_RESPONSE.SERVICE_LOCATION_PRIORITY]),Z())}function Z(){A&&A.ttl&&!isNaN(A.ttl)&&(F&&clearTimeout(F),F=setTimeout(function(){_e()},A.ttl*1e3))}function q(){F&&clearTimeout(F),F=null}function le(w){I.warn("Error fetching data from content steering server",w),Z()}function te(){return A}function N(){D(),re.off(y.default.PERIOD_SWITCH_COMPLETED,ce,C),re.off(O.default.FRAGMENT_LOADING_STARTED,X,C)}function D(){A=null,S=null,x=null,q()}return C={reset:N,setConfig:ne,loadSteeringData:_e,getCurrentSteeringResponseData:te,shouldQueryBeforeStart:ge,getSteeringDataFromManifest:oe,stopSteeringRequestTimer:q,initialize:ae},ee(),C}T.__dashjs_factory_name="ContentSteeringController";const m=u.default.getSingletonFactory(T)},"./src/dash/controllers/RepresentationController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/core/FactoryMaker.js"),f=r("./src/streaming/MediaPlayerEvents.js"),d=r("./src/dash/utils/SegmentsUtils.js");function _(c){c=c||{};var y=c.eventBus,O=c.events,P=c.abrController,b=c.dashMetrics,L=c.playbackController,R=c.timelineConverter,T=c.type,m=c.streamInfo,M=c.dashConstants,p=c.segmentsController,C=c.isDynamic,I,A,S,x,F;function k(){re(),y.on(f.default.MANIFEST_VALIDITY_CHANGED,te,I)}function j(){return m.id}function V(){return T}function Q(){if(!P||!b||!L||!R)throw new Error(u.default.MISSING_CONFIG_ERROR)}function $(){return A}function K(){return S}function Y(){return F}function re(){A=null,S=!0,x=[]}function ie(){y.off(f.default.MANIFEST_VALIDITY_CHANGED,te,I),re()}function ee(N,D,w,W,H){Q(),S=!0,x=D;var U=ge(H);if(le(U),A=N,w!==u.default.VIDEO&&w!==u.default.AUDIO&&(w!==u.default.TEXT||!W))return se(),Promise.resolve();for(var B=[],G=0,z=x.length;G<z;G++){var fe=x[G];B.push(ne(fe))}return Promise.all(B)}function ne(N){return new Promise(function(D,w){var W=N.hasInitialization(),H=N.hasSegments(),U=[];U.push(p.updateInitData(N,W)),U.push(p.updateSegmentData(N,H)),Promise.all(U).then(function(B){B[0]&&!B[0].error&&(N=ce(N,B[0])),B[1]&&!B[1].error&&(N=X(N,B[1])),ae(N),Z(N),D()}).catch(function(B){w(B)})})}function ae(N){N.mediaFinishedInformation=p.getMediaFinishedInformation(N)}function ce(N,D){return!D||D.error||!D.representation?N:D.representation}function X(N,D){if(!(!D||D.error)){var w=D.segments,W=[],H=0,U,B,G,z;for(U=0,B=w?w.length:0;U<B;U++)G=w[U],z=(0,d.getTimeBasedSegment)(R,C,N,G.startTime,G.duration,G.timescale,G.media,G.mediaRange,H),z&&(W.push(z),z=null,H++);return W.length>0&&(N.segments=W),N}}function oe(){Q();var N=new Date,D=Y(),w=L.getTime()*1e3;D&&b.addRepresentationSwitch(D.adaptation.type,N,w,D.id),y.trigger(f.default.REPRESENTATION_SWITCH,{mediaType:T,streamId:m.id,currentRepresentation:D,numberOfRepresentations:x.length},{streamId:m.id,mediaType:T})}function ge(N){return N==null||N>=x.length?null:x[N]}function _e(N){return x.indexOf(N)}function he(){for(var N=0,D=x.length;N<D;N++){var w=x[N].segmentInfoType;if(!x[N].hasInitialization()||(w===M.SEGMENT_BASE||w===M.BASE_URL)&&!x[N].segments)return!1}return!0}function se(N){S=!1,y.trigger(O.DATA_UPDATE_COMPLETED,{data:A,currentRepresentation:F,error:N},{streamId:m.id,mediaType:T})}function Z(N){if(K()){var D=b.getCurrentManifestUpdate(),w=!1,W,H;if(D){for(var U=0;U<D.representationInfo.length;U++)if(W=D.representationInfo[U],W.index===N.index&&W.mediaType===V()){w=!0;break}w||b.addManifestUpdateRepresentationInfo(N,V())}if(he()){P.setPlaybackQuality(T,m,_e(F));var B=b.getCurrentDVRInfo(T);B&&b.updateManifestUpdateInfo({latency:B.range.end-L.getTime()}),H=b.getCurrentRepresentationSwitch(Y().adaptation.type),H||oe(),se()}}}function q(N){var D=ge(N);le(D),oe()}function le(N){F=N}function te(N){if(N.newDuration){var D=Y();if(D&&D.adaptation.period){var w=D.adaptation.period;w.duration=N.newDuration}}}return I={getStreamId:j,getType:V,getData:$,isUpdating:K,updateData:ee,getCurrentRepresentation:Y,getRepresentationForQuality:ge,prepareQualityChange:q,reset:ie},k(),I}_.__dashjs_factory_name="RepresentationController";const E=l.default.getClassFactory(_)},"./src/dash/controllers/SegmentBaseController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/core/FactoryMaker.js"),l=r("./src/dash/SegmentBaseLoader.js"),f=r("./src/dash/WebmSegmentBaseLoader.js");function d(c){c=c||{};var y=this.context,O=c.eventBus,P=c.events,b=c.dashMetrics,L=c.mediaPlayerModel,R=c.errHandler,T=c.baseURLController,m=c.debug,M=c.boxParser,p=c.requestModifier,C=c.errors,I,A,S;function x(){A=(0,l.default)(y).getInstance(),S=(0,f.default)(y).getInstance(),A.setConfig({baseURLController:T,dashMetrics:b,mediaPlayerModel:L,errHandler:R,eventBus:O,events:P,errors:C,debug:m,boxParser:M,requestModifier:p}),S.setConfig({baseURLController:T,dashMetrics:b,mediaPlayerModel:L,errHandler:R,eventBus:O,events:P,errors:C,debug:m,requestModifier:p})}function F($){var K=$?$.split("/")[1]:"";return K.toLowerCase()==="webm"}function k(){A.initialize(),S.initialize()}function j($){return F($.representation.mimeType)?S.loadInitialization($.representation,$.mediaType):A.loadInitialization($.representation,$.mediaType)}function V($){return F($.mimeType)?S.loadSegments($.representation,$.mediaType,$.representation?$.representation.indexRange:null):A.loadSegments($.representation,$.mediaType,$.representation?$.representation.indexRange:null)}function Q(){A.reset(),S.reset()}return I={initialize:k,getSegmentBaseInitSegment:j,getSegmentList:V,reset:Q},x(),I}d.__dashjs_factory_name="SegmentBaseController";var _=u.default.getSingletonFactory(d);const E=_},"./src/dash/controllers/SegmentsController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>y});var u=r("./src/core/FactoryMaker.js"),l=r("./src/dash/utils/TimelineSegmentsGetter.js"),f=r("./src/dash/utils/TemplateSegmentsGetter.js"),d=r("./src/dash/utils/ListSegmentsGetter.js"),_=r("./src/dash/utils/SegmentBaseGetter.js");function E(O){O=O||{};var P=this.context,b=O.dashConstants,L=O.type,R=O.segmentBaseController,T,m;function M(){m={}}function p(k){m[b.SEGMENT_TIMELINE]=(0,l.default)(P).create(O,k),m[b.SEGMENT_TEMPLATE]=(0,f.default)(P).create(O,k),m[b.SEGMENT_LIST]=(0,d.default)(P).create(O,k),m[b.SEGMENT_BASE]=(0,_.default)(P).create(O,k)}function C(k,j){return j?Promise.resolve():R.getSegmentBaseInitSegment({representation:k,mediaType:L})}function I(k,j){return j?Promise.resolve():R.getSegmentList({mimeType:k.mimeType,representation:k,mediaType:L})}function A(k){return k?k.segments?m[b.SEGMENT_BASE]:m[k.segmentInfoType]:null}function S(k,j,V){var Q=A(k);return Q?Q.getSegmentByIndex(k,j,V):null}function x(k,j){var V=A(k);return V?V.getSegmentByTime(k,j):null}function F(k){var j=A(k);return j?j.getMediaFinishedInformation(k):{numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN}}return T={initialize:p,updateInitData:C,updateSegmentData:I,getSegmentByIndex:S,getSegmentByTime:x,getMediaFinishedInformation:F},M(),T}E.__dashjs_factory_name="SegmentsController";var c=u.default.getClassFactory(E);const y=c},"./src/dash/controllers/ServiceDescriptionController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>y});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),f=r("./src/streaming/constants/Constants.js"),d=r("./src/dash/constants/DashConstants.js"),_=[f.default.SERVICE_DESCRIPTION_DVB_LL_SCHEME],E={VIDEO:"video",AUDIO:"audio",ANY:"any",ALL:"all"};function c(){var O=this.context,P,b,L,R,T;function m(){R=(0,l.default)(O).getInstance().getLogger(P),C()}function M(Y){Y&&Y.adapter&&(T=Y.adapter)}function p(){C()}function C(){b={liveDelay:NaN,liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN}},minBitrate:{},maxBitrate:{},initialBitrate:{}},L=[]}function I(){return b}function A(Y){if(!(!Y||!Y.serviceDescriptions)){var re=Y.serviceDescriptions.filter(function(ne){return _.includes(ne.schemeIdUri)}),ie=Y.serviceDescriptions.filter(function(ne){return ne.schemeIdUri==null}),ee=re.length>0?re[re.length-1]:ie[ie.length-1];ee&&(ee.latency&&ee.latency.target>0&&S(ee),ee.playbackRate&&k(ee),ee.operatingQuality,ee.operatingBandwidth&&j(ee))}}function S(Y){var re;if(Y.schemeIdUri===f.default.SERVICE_DESCRIPTION_DVB_LL_SCHEME?re=F(Y):re=x(Y),L.length>0){var ie=K(re),ee=ie.to,ne=ie.id;b.liveDelay=re.liveDelay-ee,b.liveCatchup.maxDrift=re.maxDrift,R.debug(`
                Found latency properties coming from service description. Applied time offset of `.concat(ee," from ProducerReferenceTime element with id ").concat(ne,`.
                Live Delay: `).concat(re.liveDelay-ee,", Live catchup max drift: ").concat(re.maxDrift,`
            `))}else b.liveDelay=re.liveDelay,b.liveCatchup.maxDrift=re.maxDrift,R.debug("Found latency properties coming from service description: Live Delay: ".concat(re.liveDelay,", Live catchup max drift: ").concat(re.maxDrift))}function x(Y){var re=Y.latency.target/1e3,ie=!isNaN(Y.latency.max)&&Y.latency.max>Y.latency.target?(Y.latency.max-Y.latency.target+500)/1e3:NaN,ee=Y.latency.referenceId||NaN;return{liveDelay:re,maxDrift:ie,referenceId:ee}}function F(Y){var re=Y.latency.target/1e3,ie=!isNaN(Y.latency.max)&&Y.latency.max>Y.latency.target?(Y.latency.max-Y.latency.target+500)/1e3:NaN,ee=Y.latency.referenceId||NaN;return{liveDelay:re,maxDrift:ie,referenceId:ee}}function k(Y){var re=Y.playbackRate.min?Math.round((Y.playbackRate.min-1)*1e3)/1e3:NaN,ie=Y.playbackRate.max?Math.round((Y.playbackRate.max-1)*1e3)/1e3:NaN;b.liveCatchup.playbackRate.min=re,b.liveCatchup.playbackRate.max=ie,R.debug("Found latency properties coming from service description: Live catchup min playback rate: ".concat(re)),R.debug("Found latency properties coming from service description: Live catchup max playback rate: ".concat(ie))}function j(Y){if(!(!Y||!Y.operatingBandwidth||!Y.operatingBandwidth.mediaType||Y.operatingBandwidth.mediaType===E.ALL)){var re={};re.minBandwidth=Y.operatingBandwidth.min,re.maxBandwidth=Y.operatingBandwidth.max,re.targetBandwidth=Y.operatingBandwidth.target;var ie=[];Y.operatingBandwidth.mediaType===E.VIDEO||Y.operatingBandwidth.mediaType===E.AUDIO?ie.push(Y.operatingBandwidth.mediaType):Y.operatingBandwidth.mediaType===E.ANY&&(ie.push(E.AUDIO),ie.push(E.VIDEO)),ie.forEach(function(ee){isNaN(re.minBandwidth)||V("minBitrate",ee,re.minBandwidth),isNaN(re.maxBandwidth)||V("maxBitrate",ee,re.maxBandwidth),isNaN(re.targetBandwidth)||V("initialBitrate",ee,re.targetBandwidth)})}}function V(Y,re,ie){try{b[Y][re]=ie/1e3}catch(ee){R.error(ee)}}function Q(){return L}function $(Y){try{var re=[];if(Y&&Y.length>0){var ie=[f.default.VIDEO,f.default.AUDIO,f.default.TEXT],ee=T.getAvailabilityStartTime()/1e3;Y.forEach(function(ne){var ae=ie.reduce(function(ce,X){return ce=ce.concat(T.getAllMediaInfoForType(ne,X)),ce},[]).reduce(function(ce,X){var oe=T.getProducerReferenceTimes(ne,X);return oe.forEach(function(ge){var _e=T.getVoRepresentations(X);if(_e&&_e.length>0&&_e[0].adaptation&&_e[0].segmentInfoType===d.default.SEGMENT_TEMPLATE){var he=_e[0],se=new Date(ge[d.default.WALL_CLOCK_TIME]),Z=se.getTime()/1e3,q=Z-(ge[d.default.PRESENTATION_TIME]/he[d.default.TIMESCALE]-he[d.default.PRESENTATION_TIME_OFFSET]+ne.start),le=ee-q;ce.push({id:ge[d.default.ID],to:le})}}),ce},[]);re=re.concat(ae)})}L=re}catch(ne){R.error(ne),L=[]}}function K(Y){var re=0,ie,ee=L.filter(function(ne){return ne.id===Y.referenceId});return ee.length===0?(re=L.length>0?L[0].to:0,ie=L[0].id||NaN):(re=ee[0].to||0,ie=ee[0].id||NaN),{to:re,id:ie}}return P={getServiceDescriptionSettings:I,getProducerReferenceTimeOffsets:Q,calculateProducerReferenceTimeOffsets:$,applyServiceDescription:A,reset:p,setConfig:M},m(),P}c.__dashjs_factory_name="ServiceDescriptionController";const y=u.default.getSingletonFactory(c)},"./src/dash/models/DashManifestModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>$});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/dash/constants/DashConstants.js"),f=r("./src/dash/vo/Representation.js"),d=r("./src/dash/vo/AdaptationSet.js"),_=r("./src/dash/vo/Period.js"),E=r("./src/dash/vo/Mpd.js"),c=r("./src/dash/vo/UTCTiming.js"),y=r("./src/dash/vo/Event.js"),O=r("./src/dash/vo/BaseURL.js"),P=r("./src/dash/vo/EventStream.js"),b=r("./src/dash/vo/ProducerReferenceTime.js"),L=r("./src/dash/vo/ContentSteering.js"),R=r("./src/streaming/utils/ObjectUtils.js"),T=r("./src/streaming/utils/URLUtils.js"),m=r("./src/core/FactoryMaker.js"),M=r("./src/core/Debug.js"),p=r("./src/streaming/vo/DashJSError.js"),C=r("./src/core/errors/Errors.js"),I=r("./src/streaming/thumbnail/ThumbnailTracks.js");function A(K,Y){var re;if(typeof Symbol>"u"||K[Symbol.iterator]==null){if(Array.isArray(K)||(re=F(K))||Y&&K&&typeof K.length=="number"){re&&(K=re);var ie=0,ee=function(){};return{s:ee,n:function(){return ie>=K.length?{done:!0}:{done:!1,value:K[ie++]}},e:function(oe){throw oe},f:ee}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ne=!0,ae=!1,ce;return{s:function(){re=K[Symbol.iterator]()},n:function(){var oe=re.next();return ne=oe.done,oe},e:function(oe){ae=!0,ce=oe},f:function(){try{!ne&&re.return!=null&&re.return()}finally{if(ae)throw ce}}}}function S(K){return j(K)||k(K)||F(K)||x()}function x(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F(K,Y){if(K){if(typeof K=="string")return V(K,Y);var re=Object.prototype.toString.call(K).slice(8,-1);if(re==="Object"&&K.constructor&&(re=K.constructor.name),re==="Map"||re==="Set")return Array.from(K);if(re==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(re))return V(K,Y)}}function k(K){if(typeof Symbol<"u"&&Symbol.iterator in Object(K))return Array.from(K)}function j(K){if(Array.isArray(K))return V(K)}function V(K,Y){(Y==null||Y>K.length)&&(Y=K.length);for(var re=0,ie=new Array(Y);re<Y;re++)ie[re]=K[re];return ie}function Q(){var K,Y,re,ie,ee=this.context,ne=(0,T.default)(ee).getInstance(),ae=Number.isInteger||function(pe){return typeof pe=="number"&&isFinite(pe)&&Math.floor(pe)===pe};function ce(){Y=(0,M.default)(ee).getInstance().getLogger(K)}function X(pe,Ve){if(!pe)throw new Error("adaptation is not defined");if(!Ve)throw new Error("type is not defined");if(pe.Representation_asArray&&pe.Representation_asArray.length){var ft=tt(pe.Representation_asArray[0]);if(ft&&ft.length>0&&I.THUMBNAILS_SCHEME_ID_URIS.indexOf(ft[0].schemeIdUri)>=0)return Ve===u.default.IMAGE}if(pe.ContentComponent_asArray&&pe.ContentComponent_asArray.length>0){if(pe.ContentComponent_asArray.length>1)return Ve===u.default.MUXED;if(pe.ContentComponent_asArray[0].contentType===Ve)return!0}var Ie=Ve===u.default.TEXT?new RegExp("(ttml|vtt|wvtt|stpp)"):new RegExp(Ve);if(pe.Representation_asArray&&pe.Representation_asArray.length){var we=pe.Representation_asArray[0].codecs;if(Ie.test(we))return!0}if(pe.hasOwnProperty(l.default.MIME_TYPE))return Ie.test(pe.mimeType);if(pe.Representation_asArray){for(var ze,_t=0;_t<pe.Representation_asArray.length;_t++)if(ze=pe.Representation_asArray[_t],ze.hasOwnProperty(l.default.MIME_TYPE))return Ie.test(ze.mimeType)}return!1}function oe(pe){if(!pe)throw new Error("adaptation is not defined");if(pe.hasOwnProperty(l.default.SEGMENT_TEMPLATE)||pe.hasOwnProperty(l.default.SEGMENT_TIMELINE)||pe.hasOwnProperty(l.default.SEGMENT_LIST)||pe.hasOwnProperty(l.default.SEGMENT_BASE))return!0;if(pe.Representation_asArray&&pe.Representation_asArray.length>0){var Ve=pe.Representation_asArray[0];if(Ve.hasOwnProperty(l.default.SEGMENT_TEMPLATE)||Ve.hasOwnProperty(l.default.SEGMENT_TIMELINE)||Ve.hasOwnProperty(l.default.SEGMENT_LIST)||Ve.hasOwnProperty(l.default.SEGMENT_BASE))return!0}return!1}function ge(pe){return X(pe,u.default.AUDIO)}function _e(pe){return X(pe,u.default.VIDEO)}function he(pe){return X(pe,u.default.TEXT)}function se(pe){return X(pe,u.default.MUXED)}function Z(pe){return X(pe,u.default.IMAGE)}function q(pe){var Ve=pe&&pe.hasOwnProperty(l.default.PRODUCERREFERENCETIME_ASARRAY)?pe[l.default.PRODUCERREFERENCETIME_ASARRAY]:[],ft=pe&&pe.hasOwnProperty(l.default.REPRESENTATION_ASARRAY)?pe[l.default.REPRESENTATION_ASARRAY]:[];ft.forEach(function(we){we.hasOwnProperty(l.default.PRODUCERREFERENCETIME_ASARRAY)&&Ve.push.apply(Ve,S(we[l.default.PRODUCERREFERENCETIME_ASARRAY]))});var Ie=[];return Ve.forEach(function(we){var ze=new b.default;if(we.hasOwnProperty(l.default.ID))ze[l.default.ID]=we[l.default.ID];else return;if(we.hasOwnProperty(l.default.WALL_CLOCK_TIME))ze[l.default.WALL_CLOCK_TIME]=we[l.default.WALL_CLOCK_TIME];else return;if(we.hasOwnProperty(l.default.PRESENTATION_TIME))ze[l.default.PRESENTATION_TIME]=we[l.default.PRESENTATION_TIME];else return;Ie.push(ze)}),Ie}function le(pe){var Ve="";return pe&&pe.hasOwnProperty(l.default.LANG)&&(Ve=pe.lang),Ve}function te(pe){return pe&&pe.hasOwnProperty(l.default.VIEWPOINT)?pe.Viewpoint:null}function N(pe){return pe&&pe.hasOwnProperty(l.default.ROLE_ASARRAY)?pe.Role_asArray:[]}function D(pe){return pe&&pe.hasOwnProperty(l.default.ACCESSIBILITY_ASARRAY)?pe.Accessibility_asArray:[]}function w(pe){return pe&&pe.hasOwnProperty(l.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?pe.AudioChannelConfiguration_asArray:[]}function W(pe){return pe&&pe.hasOwnProperty(l.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?pe.AudioChannelConfiguration_asArray:[]}function H(){return function(pe,Ve){return pe.bandwidth-Ve.bandwidth}}function U(pe){return pe&&Array.isArray(pe.Representation_asArray)&&pe.Representation_asArray.sort(H()),pe}function B(pe,Ve){return pe&&pe.Period_asArray&&ae(Ve)?pe.Period_asArray[Ve]?pe.Period_asArray[Ve].AdaptationSet_asArray:[]:[]}function G(pe){return pe&&pe.Period_asArray?pe.Period_asArray:[]}function z(pe,Ve){var ft=G(Ve);return ft.length>0&&ae(pe)?ft[pe]:null}function fe(pe,Ve,ft){var Ie=B(Ve,ft),we,ze;for(we=0,ze=Ie.length;we<ze;we++)if(Ie[we].hasOwnProperty(l.default.ID)&&Ie[we].id===pe)return Ie[we];return null}function ue(pe,Ve,ft){var Ie=B(Ve,ft);return Ie.length>0&&ae(pe)?Ie[pe]:null}function J(pe,Ve,ft){if(!pe)return-1;for(var Ie=B(Ve,ft),we=0;we<Ie.length;we++){var ze=(0,R.default)(ee).getInstance();if(ze.areEqual(Ie[we],pe))return we}return-1}function ve(pe,Ve,ft){var Ie=B(pe,Ve),we,ze,_t=[];for(we=0,ze=Ie.length;we<ze;we++)X(Ie[we],ft)&&_t.push(U(Ie[we]));return _t}function me(pe,Ve,ft){var Ie=null;if(pe&&pe.Representation_asArray&&pe.Representation_asArray.length>0){var we=ae(Ve)&&Ve>=0&&Ve<pe.Representation_asArray.length?pe.Representation_asArray[Ve]:pe.Representation_asArray[0];we&&(Ie=we.mimeType+';codecs="'+we.codecs+'"',ft&&we.width!==void 0&&(Ie+=';width="'+we.width+'";height="'+we.height+'"'))}return Ie&&(Ie=Ie.replace(/\sprofiles=[^;]*/g,"")),Ie}function Ae(pe){return pe&&pe.Representation_asArray&&pe.Representation_asArray.length>0?pe.Representation_asArray[0].mimeType:null}function be(pe){return!pe||!pe.hasOwnProperty(l.default.CENC_DEFAULT_KID)?null:pe[l.default.CENC_DEFAULT_KID]}function Be(pe){if(!pe||!Array.isArray(pe.Label_asArray))return[];for(var Ve=[],ft=0;ft<pe.Label_asArray.length;ft++)Ve.push({lang:pe.Label_asArray[ft].lang,text:pe.Label_asArray[ft].__text||pe.Label_asArray[ft]});return Ve}function ke(pe){return!pe||!pe.hasOwnProperty(l.default.CONTENTPROTECTION_ASARRAY)||pe.ContentProtection_asArray.length===0?null:pe.ContentProtection_asArray}function Ye(pe){var Ve=!1;return pe&&pe.hasOwnProperty("type")&&(Ve=pe.type===l.default.DYNAMIC),Ve}function Le(pe){return pe&&pe[l.default.ID]||null}function Se(pe,Ve){var ft=!1;return pe&&pe.profiles&&pe.profiles.length>0&&(ft=pe.profiles.indexOf(Ve)!==-1),ft}function Me(pe){var Ve;return pe&&pe.hasOwnProperty(l.default.MEDIA_PRESENTATION_DURATION)?Ve=pe.mediaPresentationDuration:pe&&pe.type=="dynamic"?Ve=Number.POSITIVE_INFINITY:Ve=Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,Ve}function qe(pe){return pe&&pe.bandwidth?pe.bandwidth:NaN}function it(pe){var Ve=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,ft=NaN;return pe&&pe.hasOwnProperty(l.default.MINIMUM_UPDATE_PERIOD)&&(ft=pe.minimumUpdatePeriod),isNaN(ft)?ft:Math.max(ft-Ve,1)}function at(pe){return pe&&pe.hasOwnProperty(l.default.PUBLISH_TIME)?new Date(pe[l.default.PUBLISH_TIME]):null}function Ce(pe){return pe&&Array.isArray(pe.Representation_asArray)?pe.Representation_asArray.length:0}function je(pe){var Ve=U(pe),ft=Ve&&Array.isArray(Ve.Representation_asArray)?Ve.Representation_asArray:[];return ft.map(function(Ie){return{bandwidth:Ie.bandwidth,width:Ie.width||0,height:Ie.height||0,scanType:Ie.scanType||null,id:Ie.id||null}})}function Ge(pe){try{var Ve=pe&&typeof pe.selectionPriority<"u"?parseInt(pe.selectionPriority):1;return isNaN(Ve)?1:Ve}catch{return 1}}function tt(pe){return!pe||!pe.EssentialProperty_asArray||!pe.EssentialProperty_asArray.length?null:pe.EssentialProperty_asArray.map(function(Ve){return{schemeIdUri:Ve.schemeIdUri,value:Ve.value}})}function ot(pe,Ve){return Ve&&Ve.Representation_asArray&&Ve.Representation_asArray.length>0&&ae(pe)?Ve.Representation_asArray[pe]:null}function dt(pe){if(pe&&pe.period&&ae(pe.period.index)){var Ve=pe.period.mpd.manifest.Period_asArray[pe.period.index];if(Ve&&Ve.AdaptationSet_asArray&&ae(pe.index))return U(Ve.AdaptationSet_asArray[pe.index])}}function gt(pe){var Ve=[],ft=dt(pe),Ie,we;if(ft&&ft.Representation_asArray){if(pe&&pe.period&&ae(pe.period.index)){var ze=De(pe.period.mpd.manifest);ze&&(we=ze[0])}for(var _t=0,Nt=ft.Representation_asArray.length;_t<Nt;++_t){var It=ft.Representation_asArray[_t],Dt=new f.default;if(Dt.index=_t,Dt.adaptation=pe,It.hasOwnProperty(l.default.ID)&&(Dt.id=It.id),It.hasOwnProperty(l.default.CODECS)&&(Dt.codecs=It.codecs),It.hasOwnProperty(l.default.MIME_TYPE)&&(Dt.mimeType=It[l.default.MIME_TYPE]),It.hasOwnProperty(l.default.CODEC_PRIVATE_DATA)&&(Dt.codecPrivateData=It.codecPrivateData),It.hasOwnProperty(l.default.BANDWITH)&&(Dt.bandwidth=It.bandwidth),It.hasOwnProperty(l.default.WIDTH)&&(Dt.width=It.width),It.hasOwnProperty(l.default.HEIGHT)&&(Dt.height=It.height),It.hasOwnProperty(l.default.SCAN_TYPE)&&(Dt.scanType=It.scanType),It.hasOwnProperty(l.default.MAX_PLAYOUT_RATE)&&(Dt.maxPlayoutRate=It.maxPlayoutRate),It.hasOwnProperty(l.default.SEGMENT_BASE)?(Ie=It.SegmentBase,Dt.segmentInfoType=l.default.SEGMENT_BASE):It.hasOwnProperty(l.default.SEGMENT_LIST)?(Ie=It.SegmentList,Ie.hasOwnProperty(l.default.SEGMENT_TIMELINE)?Dt.segmentInfoType=l.default.SEGMENT_TIMELINE:Dt.segmentInfoType=l.default.SEGMENT_LIST):It.hasOwnProperty(l.default.SEGMENT_TEMPLATE)?(Ie=It.SegmentTemplate,Ie.hasOwnProperty(l.default.SEGMENT_TIMELINE)?Dt.segmentInfoType=l.default.SEGMENT_TIMELINE:Dt.segmentInfoType=l.default.SEGMENT_TEMPLATE,Ie.hasOwnProperty(l.default.INITIALIZATION_MINUS)&&(Dt.initialization=Ie.initialization.split("$Bandwidth$").join(It.bandwidth).split("$RepresentationID$").join(It.id))):Dt.segmentInfoType=l.default.BASE_URL,Dt.essentialProperties=tt(It),Ie){if(Ie.hasOwnProperty(l.default.INITIALIZATION)){var Zt=Ie.Initialization;Zt.hasOwnProperty(l.default.SOURCE_URL)&&(Dt.initialization=Zt.sourceURL),Zt.hasOwnProperty(l.default.RANGE)&&(Dt.range=Zt.range)}else he(ft)&&oe(ft)&&ft.mimeType&&ft.mimeType.indexOf("application/mp4")===-1&&(Dt.range=0);Ie.hasOwnProperty(l.default.TIMESCALE)&&(Dt.timescale=Ie.timescale),Ie.hasOwnProperty(l.default.DURATION)?Dt.segmentDuration=Ie.duration/Dt.timescale:It.hasOwnProperty(l.default.SEGMENT_TEMPLATE)&&(Ie=It.SegmentTemplate,Ie.hasOwnProperty(l.default.SEGMENT_TIMELINE)&&(Dt.segmentDuration=Mt(Ie.SegmentTimeline)/Dt.timescale)),Ie.hasOwnProperty(l.default.MEDIA)&&(Dt.media=Ie.media),Ie.hasOwnProperty(l.default.START_NUMBER)&&(Dt.startNumber=Ie.startNumber),Ie.hasOwnProperty(l.default.INDEX_RANGE)&&(Dt.indexRange=Ie.indexRange),Ie.hasOwnProperty(l.default.PRESENTATION_TIME_OFFSET)&&(Dt.presentationTimeOffset=Ie.presentationTimeOffset/Dt.timescale),Ie.hasOwnProperty(l.default.AVAILABILITY_TIME_OFFSET)?Dt.availabilityTimeOffset=Ie.availabilityTimeOffset:we&&we.availabilityTimeOffset!==void 0&&(Dt.availabilityTimeOffset=we.availabilityTimeOffset),Ie.hasOwnProperty(l.default.AVAILABILITY_TIME_COMPLETE)?Dt.availabilityTimeComplete=Ie.availabilityTimeComplete!=="false":we&&we.availabilityTimeComplete!==void 0&&(Dt.availabilityTimeComplete=we.availabilityTimeComplete)}Dt.MSETimeOffset=$e(Dt),Dt.path=[pe.period.index,pe.index,_t],Ve.push(Dt)}}return Ve}function Mt(pe){if(!pe||!pe.S_asArray)return NaN;var Ve=pe.S_asArray[0],ft=pe.S_asArray[1];return Ve.hasOwnProperty("d")?Ve.d:ft.t-Ve.t}function $e(pe){var Ve=pe.presentationTimeOffset,ft=pe.adaptation.period.start;return ft-Ve}function Te(pe){var Ve=pe&&ae(pe.index)?pe.mpd.manifest.Period_asArray[pe.index]:null,ft=[],Ie,we,ze;if(Ve&&Ve.AdaptationSet_asArray)for(ze=0;ze<Ve.AdaptationSet_asArray.length;ze++)we=Ve.AdaptationSet_asArray[ze],Ie=new d.default,we.hasOwnProperty(l.default.ID)&&(Ie.id=we.id),Ie.index=ze,Ie.period=pe,se(we)?Ie.type=u.default.MUXED:ge(we)?Ie.type=u.default.AUDIO:_e(we)?Ie.type=u.default.VIDEO:he(we)?Ie.type=u.default.TEXT:Z(we)?Ie.type=u.default.IMAGE:Y.warn("Unknown Adaptation stream type"),ft.push(Ie);return ft}function de(pe){var Ve=pe?Ye(pe.manifest):!1,ft=[],Ie=null,we=null,ze=null,_t=null,Nt,It;for(It=0,Nt=pe&&pe.manifest&&pe.manifest.Period_asArray?pe.manifest.Period_asArray.length:0;It<Nt;It++)we=pe.manifest.Period_asArray[It],we.hasOwnProperty(l.default.START)?(_t=new _.default,_t.start=we.start):Ie!==null&&Ie.hasOwnProperty(l.default.DURATION)&&ze!==null?(_t=new _.default,_t.start=parseFloat((ze.start+ze.duration).toFixed(5))):It===0&&!Ve&&(_t=new _.default,_t.start=0),ze!==null&&isNaN(ze.duration)&&(_t!==null?ze.duration=parseFloat((_t.start-ze.start).toFixed(5)):Y.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),_t!==null&&(_t.id=Re(we,It),_t.index=It,_t.mpd=pe,we.hasOwnProperty(l.default.DURATION)&&(_t.duration=we.duration),ze&&(ze.nextPeriodId=_t.id),ft.push(_t),Ie=we,ze=_t),we=null,_t=null;return ft.length===0||ze!==null&&isNaN(ze.duration)&&(ze.duration=parseFloat((Xe(ze)-ze.start).toFixed(5))),ft}function Re(pe,Ve){if(!pe)throw new Error("Period cannot be null or undefined");var ft=_.default.DEFAULT_ID+"_"+Ve;return pe.hasOwnProperty(l.default.ID)&&pe.id.length>0&&pe.id!=="__proto__"&&(ft=pe.id),ft}function xe(pe){var Ve=new E.default;return pe&&(Ve.manifest=pe,pe.hasOwnProperty(l.default.AVAILABILITY_START_TIME)?Ve.availabilityStartTime=new Date(pe.availabilityStartTime.getTime()):pe.loadedTime&&(Ve.availabilityStartTime=new Date(pe.loadedTime.getTime())),pe.hasOwnProperty(l.default.AVAILABILITY_END_TIME)&&(Ve.availabilityEndTime=new Date(pe.availabilityEndTime.getTime())),pe.hasOwnProperty(l.default.MINIMUM_UPDATE_PERIOD)&&(Ve.minimumUpdatePeriod=pe.minimumUpdatePeriod),pe.hasOwnProperty(l.default.MEDIA_PRESENTATION_DURATION)&&(Ve.mediaPresentationDuration=pe.mediaPresentationDuration),pe.hasOwnProperty(l.default.SUGGESTED_PRESENTATION_DELAY)&&(Ve.suggestedPresentationDelay=pe.suggestedPresentationDelay),pe.hasOwnProperty(l.default.TIMESHIFT_BUFFER_DEPTH)&&(Ve.timeShiftBufferDepth=pe.timeShiftBufferDepth),pe.hasOwnProperty(l.default.MAX_SEGMENT_DURATION)&&(Ve.maxSegmentDuration=pe.maxSegmentDuration),pe.hasOwnProperty(l.default.PUBLISH_TIME)&&(Ve.publishTime=new Date(pe.publishTime))),Ve}function Ne(){if(!re||!re.hasOwnProperty("error"))throw new Error(u.default.MISSING_CONFIG_ERROR)}function Xe(pe){Ne();var Ve=Ye(pe.mpd.manifest),ft;return pe.mpd.manifest.mediaPresentationDuration?ft=pe.mpd.manifest.mediaPresentationDuration:pe.duration?ft=pe.duration:Ve?ft=Number.POSITIVE_INFINITY:re.error(new p.default(C.default.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",pe)),ft}function nt(pe){var Ve=pe&&pe.mpd&&pe.mpd.manifest?pe.mpd.manifest:null,ft=Ve?Ve.Period_asArray:null,Ie=ft&&pe&&ae(pe.index)?ft[pe.index].EventStream_asArray:null,we=[],ze,_t;if(Ie)for(ze=0;ze<Ie.length;ze++){var Nt=new P.default;if(Nt.period=pe,Nt.timescale=1,Ie[ze].hasOwnProperty(u.default.SCHEME_ID_URI))Nt.schemeIdUri=Ie[ze][u.default.SCHEME_ID_URI];else throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(Ie[ze].hasOwnProperty(l.default.TIMESCALE)&&(Nt.timescale=Ie[ze][l.default.TIMESCALE]),Ie[ze].hasOwnProperty(l.default.VALUE)&&(Nt.value=Ie[ze][l.default.VALUE]),Ie[ze].hasOwnProperty(l.default.PRESENTATION_TIME_OFFSET)&&(Nt.presentationTimeOffset=Ie[ze][l.default.PRESENTATION_TIME_OFFSET]),_t=0;Ie[ze].Event_asArray&&_t<Ie[ze].Event_asArray.length;_t++){var It=Ie[ze].Event_asArray[_t],Dt=new y.default;Dt.presentationTime=0,Dt.eventStream=Nt,It.hasOwnProperty(l.default.PRESENTATION_TIME)&&(Dt.presentationTime=It.presentationTime);var Zt=Nt.presentationTimeOffset?Nt.presentationTimeOffset/Nt.timescale:0;Dt.calculatedPresentationTime=Dt.presentationTime/Nt.timescale+pe.start-Zt,It.hasOwnProperty(l.default.DURATION)&&(Dt.duration=It.duration/Nt.timescale),It.hasOwnProperty(l.default.ID)?Dt.id=It.id:Dt.id=null,It.Signal&&It.Signal.Binary?Dt.messageData=ie.decodeArray(It.Signal.Binary.toString()):Dt.messageData=It.messageData||It.__cdata||It.__text,we.push(Dt)}}return we}function et(pe,Ve,ft){var Ie=[],we;if(!pe)return Ie;for(we=0;we<pe.length;we++){var ze=new P.default;if(ze.timescale=1,ze.representation=Ve,pe[we].hasOwnProperty(u.default.SCHEME_ID_URI))ze.schemeIdUri=pe[we].schemeIdUri;else throw new Error("Invalid EventStream. SchemeIdUri has to be set");pe[we].hasOwnProperty(l.default.TIMESCALE)&&(ze.timescale=pe[we].timescale),pe[we].hasOwnProperty(l.default.VALUE)&&(ze.value=pe[we].value),Ie.push(ze),ze.period=ft}return Ie}function ht(pe,Ve,ft){var Ie,we,ze;return pe&&pe.Period_asArray&&Ve&&Ve.period&&ae(Ve.period.index)&&(we=pe.Period_asArray[Ve.period.index],we&&we.AdaptationSet_asArray&&ae(Ve.index)&&(ze=we.AdaptationSet_asArray[Ve.index],ze&&(Ie=ze.InbandEventStream_asArray))),et(Ie,null,ft)}function yt(pe,Ve,ft){var Ie,we,ze,_t;return pe&&pe.Period_asArray&&Ve&&Ve.adaptation&&Ve.adaptation.period&&ae(Ve.adaptation.period.index)&&(we=pe.Period_asArray[Ve.adaptation.period.index],we&&we.AdaptationSet_asArray&&ae(Ve.adaptation.index)&&(ze=we.AdaptationSet_asArray[Ve.adaptation.index],ze&&ze.Representation_asArray&&ae(Ve.index)&&(_t=ze.Representation_asArray[Ve.index],_t&&(Ie=_t.InbandEventStream_asArray)))),et(Ie,Ve,ft)}function Pt(pe){var Ve=Ye(pe),ft=pe?pe.hasOwnProperty(l.default.AVAILABILITY_START_TIME):!1,Ie=pe?pe.UTCTiming_asArray:null,we=[];return(Ve||ft)&&Ie&&Ie.forEach(function(ze){var _t=new c.default;if(ze.hasOwnProperty(u.default.SCHEME_ID_URI))_t.schemeIdUri=ze.schemeIdUri;else return;if(ze.hasOwnProperty(l.default.VALUE))_t.value=ze.value.toString();else return;we.push(_t)}),we}function De(pe){var Ve=[],ft=pe.BaseURL_asArray||[pe.baseUri],Ie=!1;return ft.some(function(we){if(we){var ze=new O.default,_t=we.__text||we;return ne.isRelative(_t)&&(Ie=!0,pe.baseUri&&(_t=ne.resolve(_t,pe.baseUri))),ze.url=_t,we.hasOwnProperty(l.default.SERVICE_LOCATION)&&we.serviceLocation.length?ze.serviceLocation=we.serviceLocation:ze.serviceLocation=_t,we.hasOwnProperty(l.default.DVB_PRIORITY)&&(ze.dvb_priority=we[l.default.DVB_PRIORITY]),we.hasOwnProperty(l.default.DVB_WEIGHT)&&(ze.dvb_weight=we[l.default.DVB_WEIGHT]),we.hasOwnProperty(l.default.AVAILABILITY_TIME_OFFSET)&&(ze.availabilityTimeOffset=we[l.default.AVAILABILITY_TIME_OFFSET]),we.hasOwnProperty(l.default.AVAILABILITY_TIME_COMPLETE)&&(ze.availabilityTimeComplete=we[l.default.AVAILABILITY_TIME_COMPLETE]!=="false"),Ve.push(ze),Ie}}),Ve}function Ue(pe){if(pe&&pe.hasOwnProperty(l.default.CONTENT_STEERING_AS_ARRAY)){var Ve=pe[l.default.CONTENT_STEERING_AS_ARRAY][0],ft=new L.default;return ft.serverUrl=Ve.__text,Ve.hasOwnProperty(l.default.DEFAULT_SERVICE_LOCATION)&&(ft.defaultServiceLocation=Ve[l.default.DEFAULT_SERVICE_LOCATION]),Ve.hasOwnProperty(l.default.QUERY_BEFORE_START)&&(ft.queryBeforeStart=Ve[l.default.QUERY_BEFORE_START].toLowerCase()==="true"),Ve.hasOwnProperty(l.default.PROXY_SERVER_URL)&&(ft.proxyServerUrl=Ve[l.default.PROXY_SERVER_URL]),ft}}function Ze(pe){if(pe&&pe.hasOwnProperty(u.default.LOCATION))return pe.Location=pe.Location_asArray[0],pe.Location}function Et(pe){if(pe&&pe.hasOwnProperty(l.default.PATCH_LOCATION))return pe.PatchLocation=pe.PatchLocation_asArray[0],pe.PatchLocation}function ct(pe){return pe&&pe.hasOwnProperty(l.default.SUGGESTED_PRESENTATION_DELAY)?pe.suggestedPresentationDelay:null}function Tt(pe){return pe&&pe.hasOwnProperty(l.default.AVAILABILITY_START_TIME)&&pe.availabilityStartTime!==null?pe.availabilityStartTime.getTime():null}function Ot(pe){var Ve=[];if(pe&&pe.hasOwnProperty(l.default.SERVICE_DESCRIPTION)){var ft=A(pe.ServiceDescription_asArray),Ie;try{for(ft.s();!(Ie=ft.n()).done;){var we=Ie.value,ze=null,_t=null,Nt=null,It=null,Dt=null,Zt=null;for(var Wt in we)we.hasOwnProperty(Wt)&&(Wt===l.default.ID?ze=we[Wt]:Wt===l.default.SERVICE_DESCRIPTION_SCOPE?_t=we[Wt].schemeIdUri:Wt===l.default.SERVICE_DESCRIPTION_LATENCY?Nt={target:parseInt(we[Wt].target),max:parseInt(we[Wt].max),min:parseInt(we[Wt].min),referenceId:parseInt(we[Wt].referenceId)}:Wt===l.default.SERVICE_DESCRIPTION_PLAYBACK_RATE?It={max:parseFloat(we[Wt].max),min:parseFloat(we[Wt].min)}:Wt===l.default.SERVICE_DESCRIPTION_OPERATING_QUALITY?Dt={mediaType:we[Wt].mediaType,max:parseInt(we[Wt].max),min:parseInt(we[Wt].min),target:parseInt(we[Wt].target),type:we[Wt].type,maxQualityDifference:parseInt(we[Wt].maxQualityDifference)}:Wt===l.default.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH&&(Zt={mediaType:we[Wt].mediaType,max:parseInt(we[Wt].max),min:parseInt(we[Wt].min),target:parseInt(we[Wt].target)}));Ve.push({id:ze,schemeIdUri:_t,latency:Nt,playbackRate:It,operatingQuality:Dt,operatingBandwidth:Zt})}}catch(Je){ft.e(Je)}finally{ft.f()}}return Ve}function jt(pe){var Ve={};if(pe&&pe.hasOwnProperty(l.default.SUPPLEMENTAL_PROPERTY)){var ft=A(pe.SupplementalProperty_asArray),Ie;try{for(ft.s();!(Ie=ft.n()).done;){var we=Ie.value;we.hasOwnProperty(u.default.SCHEME_ID_URI)&&we.hasOwnProperty(l.default.VALUE)&&(Ve[we[u.default.SCHEME_ID_URI]]=we[l.default.VALUE])}}catch(ze){ft.e(ze)}finally{ft.f()}}return Ve}function Gt(pe){pe&&(pe.errHandler&&(re=pe.errHandler),pe.BASE64&&(ie=pe.BASE64))}return K={getIsTypeOf:X,getIsText:he,getIsFragmented:oe,getProducerReferenceTimesForAdaptation:q,getLanguageForAdaptation:le,getViewpointForAdaptation:te,getRolesForAdaptation:N,getAccessibilityForAdaptation:D,getAudioChannelConfigurationForAdaptation:w,getAudioChannelConfigurationForRepresentation:W,getAdaptationForIndex:ue,getIndexForAdaptation:J,getAdaptationForId:fe,getAdaptationsForType:ve,getRealPeriods:G,getRealPeriodForIndex:z,getCodec:me,getSelectionPriority:Ge,getMimeType:Ae,getKID:be,getLabelsForAdaptation:Be,getContentProtectionData:ke,getIsDynamic:Ye,getId:Le,hasProfile:Se,getDuration:Me,getBandwidth:qe,getManifestUpdatePeriod:it,getPublishTime:at,getRepresentationCount:Ce,getBitrateListForAdaptation:je,getRepresentationFor:ot,getRepresentationsForAdaptation:gt,getAdaptationsForPeriod:Te,getRegularPeriods:de,getMpd:xe,getEventsForPeriod:nt,getEssentialPropertiesForRepresentation:tt,getEventStreamForAdaptationSet:ht,getEventStreamForRepresentation:yt,getUTCTimingSources:Pt,getBaseURLsFromElement:De,getRepresentationSortFunction:H,getContentSteering:Ue,getLocation:Ze,getPatchLocation:Et,getSuggestedPresentationDelay:ct,getAvailabilityStartTime:Tt,getServiceDescriptions:Ot,getSupplementalProperties:jt,setConfig:Gt},ce(),K}Q.__dashjs_factory_name="DashManifestModel";const $=m.default.getSingletonFactory(Q)},"./src/dash/models/PatchManifestModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>c});var u=r("./src/dash/constants/DashConstants.js"),l=r("./src/core/FactoryMaker.js"),f=r("./src/core/Debug.js"),d=r("./src/dash/vo/SimpleXPath.js"),_=r("./src/dash/vo/PatchOperation.js");function E(){var y,O,P=this.context;function b(){O=(0,f.default)(P).getInstance().getLogger(y)}function L(p){return p&&p.hasOwnProperty(u.default.ORIGINAL_MPD_ID)||!1}function R(p){return p&&p.hasOwnProperty(u.default.PUBLISH_TIME)?new Date(p[u.default.PUBLISH_TIME]):null}function T(p){return p&&p.hasOwnProperty(u.default.ORIGINAL_PUBLISH_TIME)?new Date(p[u.default.ORIGINAL_PUBLISH_TIME]):null}function m(p){return p&&p[u.default.ORIGINAL_MPD_ID]||null}function M(p){return p?(p.__children||[]).map(function(C){var I=Object.keys(C)[0];if(I!=="add"&&I!=="remove"&&I!=="replace")return O.warn("Ignoring node of invalid action: ".concat(I)),null;var A=C[I],S=A.sel;if(I==="add"&&A.type){if(!A.type.startsWith("@"))return O.warn("Ignoring add action for prefixed namespace declaration: ".concat(A.type,"=").concat(A.__text)),null;S="".concat(S,"/").concat(A.type)}var x=new d.default(S);if(!x.isValid())return O.warn("Ignoring action with invalid selector: ".concat(I," - ").concat(S)),null;var F=null;x.findsAttribute()?F=A.__text||"":I!=="remove"&&(F=A.__children.reduce(function(j,V){var Q=Object.keys(V)[0];return Q!=="#text"&&(j[Q]=j[Q]||[],j[Q].push(V[Q])),j},{}));var k=new _.default(I,x,F);return I==="add"&&(k.position=A.pos),k}).filter(function(C){return!!C}):[]}return y={getIsPatch:L,getPublishTime:R,getOriginalPublishTime:T,getMpdId:m,getPatchOperations:M},b(),y}E.__dashjs_factory_name="PatchManifestModel";const c=l.default.getSingletonFactory(E)},"./src/dash/parser/DashParser.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>L});var u=r("./src/core/FactoryMaker.js"),l=r("./src/dash/parser/objectiron.js"),f=r("./externals/xml2json.js"),d=r("./src/dash/parser/matchers/StringMatcher.js"),_=r("./src/dash/parser/matchers/DurationMatcher.js"),E=r("./src/dash/parser/matchers/DateTimeMatcher.js"),c=r("./src/dash/parser/matchers/NumericMatcher.js"),y=r("./src/dash/parser/matchers/LangMatcher.js"),O=r("./src/dash/parser/maps/RepresentationBaseValuesMap.js"),P=r("./src/dash/parser/maps/SegmentValuesMap.js");function b(R){R=R||{};var T=this.context,m=R.debug,M,p,C,I,A;function S(){p=m.getLogger(M),C=[new _.default,new E.default,new c.default,new y.default,new d.default],I=new f.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!0,ignoreRoot:!1,matchers:C}),A=(0,l.default)(T).create({adaptationset:new O.default,period:new P.default})}function x(){return C}function F(){return A}function k(j){var V,Q=window.performance.now();if(V=I.xml_str2json(j),!V)throw new Error("parsing the manifest failed");var $=window.performance.now();V.Patch?(V=V.Patch,V.add_asArray&&V.add_asArray.forEach(function(Y){return A.run(Y)}),V.replace_asArray&&V.replace_asArray.forEach(function(Y){return A.run(Y)})):(V=V.MPD,A.run(V));var K=window.performance.now();return p.info("Parsing complete: ( xml2json: "+($-Q).toPrecision(3)+"ms, objectiron: "+(K-$).toPrecision(3)+"ms, total: "+((K-Q)/1e3).toPrecision(3)+"s)"),V.protocol="DASH",V}return M={parse:k,getMatchers:x,getIron:F},S(),M}b.__dashjs_factory_name="DashParser";const L=u.default.getClassFactory(b)},"./src/dash/parser/maps/CommonProperty.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});function u(E,c){if(!(E instanceof c))throw new TypeError("Cannot call a class as a function")}function l(E,c){for(var y=0;y<c.length;y++){var O=c[y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(E,O.key,O)}}function f(E,c,y){return c&&l(E.prototype,c),y&&l(E,y),E}var d=function(){function E(c){u(this,E);var y=function(P){return P&&P.length&&P.charAt(0)===P.charAt(0).toUpperCase()};this._name=c,this._merge=y(c)}return f(E,[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}]),E}();const _=d},"./src/dash/parser/maps/MapNode.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/dash/parser/maps/CommonProperty.js");function l(c,y){if(!(c instanceof y))throw new TypeError("Cannot call a class as a function")}function f(c,y){for(var O=0;O<y.length;O++){var P=y[O];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(c,P.key,P)}}function d(c,y,O){return y&&f(c.prototype,y),O&&f(c,O),c}var _=function(){function c(y,O,P){var b=this;l(this,c),this._name=y||"",this._properties=[],this._children=P||[],Array.isArray(O)&&O.forEach(function(L){b._properties.push(new u.default(L))})}return d(c,[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}]),c}();const E=_},"./src/dash/parser/maps/RepresentationBaseValuesMap.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/dash/parser/maps/MapNode.js"),l=r("./src/dash/constants/DashConstants.js");function f(T){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?f=function(M){return typeof M}:f=function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},f(T)}function d(T,m){if(!(T instanceof m))throw new TypeError("Cannot call a class as a function")}function _(T,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(m&&m.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),m&&E(T,m)}function E(T,m){return E=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},E(T,m)}function c(T){var m=P();return function(){var p=b(T),C;if(m){var I=b(this).constructor;C=Reflect.construct(p,arguments,I)}else C=p.apply(this,arguments);return y(this,C)}}function y(T,m){return m&&(f(m)==="object"||typeof m=="function")?m:O(T)}function O(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function b(T){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},b(T)}var L=function(T){_(M,T);var m=c(M);function M(){d(this,M);var p=[l.default.PROFILES,l.default.WIDTH,l.default.HEIGHT,l.default.SAR,l.default.FRAMERATE,l.default.AUDIO_SAMPLING_RATE,l.default.MIME_TYPE,l.default.SEGMENT_PROFILES,l.default.CODECS,l.default.MAXIMUM_SAP_PERIOD,l.default.START_WITH_SAP,l.default.MAX_PLAYOUT_RATE,l.default.CODING_DEPENDENCY,l.default.SCAN_TYPE,l.default.FRAME_PACKING,l.default.AUDIO_CHANNEL_CONFIGURATION,l.default.CONTENT_PROTECTION,l.default.ESSENTIAL_PROPERTY,l.default.SUPPLEMENTAL_PROPERTY,l.default.INBAND_EVENT_STREAM];return m.call(this,l.default.ADAPTATION_SET,p,[new u.default(l.default.REPRESENTATION,p,[new u.default(l.default.SUB_REPRESENTATION,p)])])}return M}(u.default);const R=L},"./src/dash/parser/maps/SegmentValuesMap.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/dash/parser/maps/MapNode.js"),l=r("./src/dash/constants/DashConstants.js");function f(T){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?f=function(M){return typeof M}:f=function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},f(T)}function d(T,m){if(!(T instanceof m))throw new TypeError("Cannot call a class as a function")}function _(T,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(m&&m.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),m&&E(T,m)}function E(T,m){return E=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},E(T,m)}function c(T){var m=P();return function(){var p=b(T),C;if(m){var I=b(this).constructor;C=Reflect.construct(p,arguments,I)}else C=p.apply(this,arguments);return y(this,C)}}function y(T,m){return m&&(f(m)==="object"||typeof m=="function")?m:O(T)}function O(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function b(T){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},b(T)}var L=function(T){_(M,T);var m=c(M);function M(){d(this,M);var p=[l.default.SEGMENT_BASE,l.default.SEGMENT_TEMPLATE,l.default.SEGMENT_LIST];return m.call(this,l.default.PERIOD,p,[new u.default(l.default.ADAPTATION_SET,p,[new u.default(l.default.REPRESENTATION,p)])])}return M}(u.default);const R=L},"./src/dash/parser/matchers/BaseMatcher.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});function u(E,c){if(!(E instanceof c))throw new TypeError("Cannot call a class as a function")}function l(E,c){for(var y=0;y<c.length;y++){var O=c[y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(E,O.key,O)}}function f(E,c,y){return c&&l(E.prototype,c),y&&l(E,y),E}var d=function(){function E(c,y){u(this,E),this._test=c,this._converter=y}return f(E,[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}]),E}();const _=d},"./src/dash/parser/matchers/DateTimeMatcher.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>M});var u=r("./src/dash/parser/matchers/BaseMatcher.js");function l(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(I){return typeof I}:l=function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},l(p)}function f(p,C){if(!(p instanceof C))throw new TypeError("Cannot call a class as a function")}function d(p,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(C&&C.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),C&&_(p,C)}function _(p,C){return _=Object.setPrototypeOf||function(A,S){return A.__proto__=S,A},_(p,C)}function E(p){var C=O();return function(){var A=P(p),S;if(C){var x=P(this).constructor;S=Reflect.construct(A,arguments,x)}else S=A.apply(this,arguments);return c(this,S)}}function c(p,C){return C&&(l(C)==="object"||typeof C=="function")?C:y(p)}function y(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(p){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(I){return I.__proto__||Object.getPrototypeOf(I)},P(p)}var b=60,L=60,R=1e3,T=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,m=function(p){d(I,p);var C=E(I);function I(){return f(this,I),C.call(this,function(A){return T.test(A.value)},function(A){var S=T.exec(A),x;if(x=Date.UTC(parseInt(S[1],10),parseInt(S[2],10)-1,parseInt(S[3],10),parseInt(S[4],10),parseInt(S[5],10),S[6]&&parseInt(S[6],10)||0,S[7]&&parseFloat(S[7])*R||0),S[9]&&S[10]){var F=parseInt(S[9],10)*L+parseInt(S[10],10);x+=(S[8]==="+"?-1:1)*F*b*R}return new Date(x)})}return I}(u.default);const M=m},"./src/dash/parser/matchers/DurationMatcher.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>A});var u=r("./src/dash/parser/matchers/BaseMatcher.js"),l=r("./src/streaming/constants/Constants.js"),f=r("./src/dash/constants/DashConstants.js");function d(S){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?d=function(F){return typeof F}:d=function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},d(S)}function _(S,x){if(!(S instanceof x))throw new TypeError("Cannot call a class as a function")}function E(S,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(x&&x.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),x&&c(S,x)}function c(S,x){return c=Object.setPrototypeOf||function(k,j){return k.__proto__=j,k},c(S,x)}function y(S){var x=b();return function(){var k=L(S),j;if(x){var V=L(this).constructor;j=Reflect.construct(k,arguments,V)}else j=k.apply(this,arguments);return O(this,j)}}function O(S,x){return x&&(d(x)==="object"||typeof x=="function")?x:P(S)}function P(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}function b(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function L(S){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},L(S)}var R=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,T=365*24*60*60,m=30*24*60*60,M=24*60*60,p=60*60,C=60,I=function(S){E(F,S);var x=y(F);function F(){return _(this,F),x.call(this,function(k){for(var j=[f.default.MIN_BUFFER_TIME,f.default.MEDIA_PRESENTATION_DURATION,f.default.MINIMUM_UPDATE_PERIOD,f.default.TIMESHIFT_BUFFER_DEPTH,f.default.MAX_SEGMENT_DURATION,f.default.MAX_SUBSEGMENT_DURATION,f.default.SUGGESTED_PRESENTATION_DELAY,f.default.START,l.default.START_TIME,f.default.DURATION],V=j.length,Q=0;Q<V;Q++)if(k.nodeName===j[Q])return R.test(k.value);return!1},function(k){var j=R.exec(k),V=parseFloat(j[3]||0)*T+parseFloat(j[5]||0)*m+parseFloat(j[7]||0)*M+parseFloat(j[9]||0)*p+parseFloat(j[11]||0)*C+parseFloat(j[13]||0);return j[1]!==void 0&&(V=-V),V})}return F}(u.default);const A=I},"./src/dash/parser/matchers/LangMatcher.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>M});var u=r("./src/dash/parser/matchers/BaseMatcher.js"),l=r("./src/dash/constants/DashConstants.js"),f=r("./node_modules/bcp-47-normalize/index.js"),d=r.n(f);function _(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_=function(I){return typeof I}:_=function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},_(p)}function E(p,C,I){return C in p?Object.defineProperty(p,C,{value:I,enumerable:!0,configurable:!0,writable:!0}):p[C]=I,p}function c(p,C){if(!(p instanceof C))throw new TypeError("Cannot call a class as a function")}function y(p,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(C&&C.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),C&&O(p,C)}function O(p,C){return O=Object.setPrototypeOf||function(A,S){return A.__proto__=S,A},O(p,C)}function P(p){var C=R();return function(){var A=T(p),S;if(C){var x=T(this).constructor;S=Reflect.construct(A,arguments,x)}else S=A.apply(this,arguments);return b(this,S)}}function b(p,C){return C&&(_(C)==="object"||typeof C=="function")?C:L(p)}function L(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function T(p){return T=Object.setPrototypeOf?Object.getPrototypeOf:function(I){return I.__proto__||Object.getPrototypeOf(I)},T(p)}var m=function(p){y(I,p);var C=P(I);function I(){return c(this,I),C.call(this,function(A,S){var x,F=(x={},E(x,l.default.ADAPTATION_SET,[l.default.LANG]),E(x,l.default.REPRESENTATION,[l.default.LANG]),E(x,l.default.CONTENT_COMPONENT,[l.default.LANG]),E(x,l.default.LABEL,[l.default.LANG]),E(x,l.default.GROUP_LABEL,[l.default.LANG]),x);if(F.hasOwnProperty(S)){var k=F[S];return k!==void 0?k.indexOf(A.name)>=0:!1}return!1},function(A){var S=d()(A);return S!==void 0?S:String(A)})}return I}(u.default);const M=m},"./src/dash/parser/matchers/NumericMatcher.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/dash/parser/matchers/BaseMatcher.js");function l(T){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(M){return typeof M}:l=function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},l(T)}function f(T,m){if(!(T instanceof m))throw new TypeError("Cannot call a class as a function")}function d(T,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(m&&m.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),m&&_(T,m)}function _(T,m){return _=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},_(T,m)}function E(T){var m=O();return function(){var p=P(T),C;if(m){var I=P(this).constructor;C=Reflect.construct(p,arguments,I)}else C=p.apply(this,arguments);return c(this,C)}}function c(T,m){return m&&(l(m)==="object"||typeof m=="function")?m:y(T)}function y(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(T){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},P(T)}var b=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,L=function(T){d(M,T);var m=E(M);function M(){return f(this,M),m.call(this,function(p){return b.test(p.value)},function(p){return parseFloat(p)})}return M}(u.default);const R=L},"./src/dash/parser/matchers/StringMatcher.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>T});var u=r("./src/dash/parser/matchers/BaseMatcher.js"),l=r("./src/dash/constants/DashConstants.js");function f(m){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?f=function(p){return typeof p}:f=function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},f(m)}function d(m,M,p){return M in m?Object.defineProperty(m,M,{value:p,enumerable:!0,configurable:!0,writable:!0}):m[M]=p,m}function _(m,M){if(!(m instanceof M))throw new TypeError("Cannot call a class as a function")}function E(m,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(M&&M.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),M&&c(m,M)}function c(m,M){return c=Object.setPrototypeOf||function(C,I){return C.__proto__=I,C},c(m,M)}function y(m){var M=b();return function(){var C=L(m),I;if(M){var A=L(this).constructor;I=Reflect.construct(C,arguments,A)}else I=C.apply(this,arguments);return O(this,I)}}function O(m,M){return M&&(f(M)==="object"||typeof M=="function")?M:P(m)}function P(m){if(m===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m}function b(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function L(m){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(p){return p.__proto__||Object.getPrototypeOf(p)},L(m)}var R=function(m){E(p,m);var M=y(p);function p(){return _(this,p),M.call(this,function(C,I){var A,S=(A={},d(A,l.default.MPD,[l.default.ID,l.default.PROFILES]),d(A,l.default.PERIOD,[l.default.ID]),d(A,l.default.BASE_URL,[l.default.SERVICE_LOCATION,l.default.BYTE_RANGE]),d(A,l.default.SEGMENT_BASE,[l.default.INDEX_RANGE]),d(A,l.default.INITIALIZATION,[l.default.RANGE]),d(A,l.default.REPRESENTATION_INDEX,[l.default.RANGE]),d(A,l.default.SEGMENT_LIST,[l.default.INDEX_RANGE]),d(A,l.default.BITSTREAM_SWITCHING,[l.default.RANGE]),d(A,l.default.SEGMENT_URL,[l.default.MEDIA_RANGE,l.default.INDEX_RANGE]),d(A,l.default.SEGMENT_TEMPLATE,[l.default.INDEX_RANGE,l.default.MEDIA,l.default.INDEX,l.default.INITIALIZATION_MINUS,l.default.BITSTREAM_SWITCHING_MINUS]),d(A,l.default.ASSET_IDENTIFIER,[l.default.VALUE,l.default.ID]),d(A,l.default.EVENT_STREAM,[l.default.VALUE]),d(A,l.default.ADAPTATION_SET,[l.default.PROFILES,l.default.MIME_TYPE,l.default.SEGMENT_PROFILES,l.default.CODECS,l.default.CONTENT_TYPE]),d(A,l.default.FRAME_PACKING,[l.default.VALUE,l.default.ID]),d(A,l.default.AUDIO_CHANNEL_CONFIGURATION,[l.default.VALUE,l.default.ID]),d(A,l.default.CONTENT_PROTECTION,[l.default.VALUE,l.default.ID]),d(A,l.default.ESSENTIAL_PROPERTY,[l.default.VALUE,l.default.ID]),d(A,l.default.SUPPLEMENTAL_PROPERTY,[l.default.VALUE,l.default.ID]),d(A,l.default.INBAND_EVENT_STREAM,[l.default.VALUE,l.default.ID]),d(A,l.default.ACCESSIBILITY,[l.default.VALUE,l.default.ID]),d(A,l.default.ROLE,[l.default.VALUE,l.default.ID]),d(A,l.default.RATING,[l.default.VALUE,l.default.ID]),d(A,l.default.VIEWPOINT,[l.default.VALUE,l.default.ID]),d(A,l.default.CONTENT_COMPONENT,[l.default.CONTENT_TYPE]),d(A,l.default.REPRESENTATION,[l.default.ID,l.default.DEPENDENCY_ID,l.default.MEDIA_STREAM_STRUCTURE_ID]),d(A,l.default.SUBSET,[l.default.ID]),d(A,l.default.METRICS,[l.default.METRICS_MINUS]),d(A,l.default.REPORTING,[l.default.VALUE,l.default.ID]),A);if(S.hasOwnProperty(I)){var x=S[I];return x!==void 0?x.indexOf(C.name)>=0:!1}return!1},function(C){return String(C)})}return p}(u.default);const T=R},"./src/dash/parser/objectiron.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/FactoryMaker.js");function l(E){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(y){return typeof y}:l=function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},l(E)}function f(E){function c(b,L){for(var R in b)L.hasOwnProperty(R)||(L[R]=b[R])}function y(b,L,R){for(var T=0,m=b.length;T<m;++T){var M=b[T];if(L[M.name])if(R[M.name]){if(M.merge){var p=L[M.name],C=R[M.name];l(p)==="object"&&l(C)==="object"?c(p,C):R[M.name]=p+C}}else R[M.name]=L[M.name]}}function O(b,L){for(var R=0,T=b.children.length;R<T;++R){var m=b.children[R],M=L[m.name+"_asArray"];if(M)for(var p=0,C=M.length;p<C;++p){var I=M[p];y(b.properties,L,I),O(m,I)}}}function P(b){if(b===null||l(b)!=="object")return b;if(b.Period_asArray&&"period"in E)for(var L=E.period,R=b.Period_asArray,T=0,m=R.length;T<m;++T){var M=R[T];if(O(L,M),"adaptationset"in E){var p=M.AdaptationSet_asArray;if(p)for(var C=E.adaptationset,I=0,A=p.length;I<A;++I)O(C,p[I])}}return b}return{run:P}}f.__dashjs_factory_name="ObjectIron";var d=u.default.getClassFactory(f);const _=d},"./src/dash/utils/ListSegmentsGetter.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/constants/Constants.js"),f=r("./src/dash/utils/SegmentsUtils.js");function d(c,y){c=c||{};var O=c.timelineConverter,P;function b(){if(!O||!O.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(l.default.MISSING_CONFIG_ERROR)}function L(m){var M={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!m)return M;var p=m.adaptation.period.mpd.manifest.Period_asArray[m.adaptation.period.index].AdaptationSet_asArray[m.adaptation.index].Representation_asArray[m.index].SegmentList,C=m&&!isNaN(m.startNumber)?m.startNumber:1,I=Math.max(C-1,0);return M.numberOfSegments=I+p.SegmentURL_asArray.length,M}function R(m,M){if(b(),!m)return null;var p=m.adaptation.period.mpd.manifest.Period_asArray[m.adaptation.period.index].AdaptationSet_asArray[m.adaptation.index].Representation_asArray[m.index].SegmentList,C=p.SegmentURL_asArray.length,I=m&&!isNaN(m.startNumber)?m.startNumber:1,A=Math.max(I-1,0),S=Math.max(M-A,0),x=null;if(S<C){var F=p.SegmentURL_asArray[S];x=(0,f.getIndexBasedSegment)(O,y,m,M),x&&(x.replacementTime=(I+M-1)*m.segmentDuration,x.media=F.media?F.media:"",x.mediaRange=F.mediaRange,x.indexRange=F.indexRange)}return x}function T(m,M){if(b(),!m)return null;var p=m.segmentDuration;if(isNaN(p))return null;var C=O.calcPeriodRelativeTimeFromMpdRelativeTime(m,M),I=Math.floor(C/p);return R(m,I)}return P={getSegmentByIndex:R,getSegmentByTime:T,getMediaFinishedInformation:L},P}d.__dashjs_factory_name="ListSegmentsGetter";var _=u.default.getClassFactory(d);const E=_},"./src/dash/utils/Round10.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});function u(E,c){if(!(E instanceof c))throw new TypeError("Cannot call a class as a function")}function l(E,c){for(var y=0;y<c.length;y++){var O=c[y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(E,O.key,O)}}function f(E,c,y){return c&&l(E.prototype,c),y&&l(E,y),E}var d=function(){function E(){u(this,E)}return f(E,null,[{key:"round10",value:function(y,O){return _("round",y,O)}}]),E}();function _(E,c,y){return typeof y>"u"||+y==0?Math[E](c):(c=+c,y=+y,c===null||isNaN(c)||!(typeof y=="number"&&y%1===0)?NaN:(c=c.toString().split("e"),c=Math[E](+(c[0]+"e"+(c[1]?+c[1]-y:-y))),c=c.toString().split("e"),+(c[0]+"e"+(c[1]?+c[1]+y:y))))}},"./src/dash/utils/SegmentBaseGetter.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/constants/Constants.js");function f(E){E=E||{};var c=E.timelineConverter,y;function O(){if(!c||!c.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(l.default.MISSING_CONFIG_ERROR)}function P(T){var m={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};return!T||!T.segments||(m.numberOfSegments=T.segments.length),m}function b(T,m){if(O(),!T)return null;var M=T.segments?T.segments.length:-1,p;if(m<M&&(p=T.segments[m],p&&p.index===m))return p;for(var C=0;C<M;C++)if(p=T.segments[C],p&&p.index===m)return p;return null}function L(T,m){O();var M=R(T,m);return b(T,M)}function R(T,m){if(!T)return-1;var M=T.segments,p=M?M.length:null,C=-1,I,A,S,x,F;if(M&&p>0){for(F=0;F<p;F++)if(A=M[F],S=A.presentationStartTime,x=A.duration,I=x/2,m+I>=S&&m-I<S+x){C=A.index;break}}return C}return y={getSegmentByIndex:b,getSegmentByTime:L,getMediaFinishedInformation:P},y}f.__dashjs_factory_name="SegmentBaseGetter";var d=u.default.getClassFactory(f);const _=d},"./src/dash/utils/SegmentsUtils.js":(h,i,r)=>{r.r(i),r.d(i,{getIndexBasedSegment:()=>O,getTimeBasedSegment:()=>P,replaceIDForTemplate:()=>_,replaceTokenForTemplate:()=>E,unescapeDollarsInTemplate:()=>d});var u=r("./src/dash/vo/Segment.js");function l(b,L){for(;b.length<L;)b="0"+b;return b}function f(b,L){return b.representation.startNumber+L}function d(b){return b&&b.split("$$").join("$")}function _(b,L){if(!L||!b||b.indexOf("$RepresentationID$")===-1)return b;var R=L.toString();return b.split("$RepresentationID$").join(R)}function E(b,L,R){var T="%0",m,M,p,C,I,A,S=L.length,x=T.length;if(!b)return b;for(;;){if(m=b.indexOf("$"+L),m<0||(M=b.indexOf("$",m+S),M<0))return b;if(p=b.indexOf(T,m+S),p>m&&p<M)switch(C=b.charAt(M-1),I=parseInt(b.substring(p+x,M-1),10),C){case"d":case"i":case"u":A=l(R.toString(),I);break;case"x":A=l(R.toString(16),I);break;case"X":A=l(R.toString(16),I).toUpperCase();break;case"o":A=l(R.toString(8),I);break;default:return b}else A=R;b=b.substring(0,m)+A+b.substring(M+1)}}function c(b,L,R,T,m,M,p,C){var I=new u.default;return I.representation=b,I.duration=L,I.presentationStartTime=R,I.mediaStartTime=T,I.availabilityStartTime=m.calcAvailabilityStartTimeFromPresentationTime(M,b,p),I.availabilityEndTime=m.calcAvailabilityEndTimeFromPresentationTime(M+L,b,p),I.wallStartTime=m.calcWallTimeForSegment(I,p),I.replacementNumber=f(I,C),I.index=C,I}function y(b,L,R,T){var m=L.adaptation.period;if(isFinite(m.duration)&&m.start+m.duration<=R.presentationStartTime)return!1;if(T){if(L.availabilityTimeOffset==="INF")return!0;var M=b.getClientReferenceTime();return R.availabilityStartTime.getTime()<=M&&(!isFinite(R.availabilityEndTime)||R.availabilityEndTime.getTime()>=M)}return!0}function O(b,L,R,T){var m,M,p;m=R.segmentDuration,isNaN(m)&&(m=R.adaptation.period.duration),M=parseFloat((R.adaptation.period.start+T*m).toFixed(5)),p=parseFloat((M+m).toFixed(5));var C=b.calcMediaTimeFromPresentationTime(M,R),I=c(R,m,M,C,b,p,L,T);return y(b,R,I,L)?I:null}function P(b,L,R,T,m,M,p,C,I,A){var S=T/M,x=m/M,F,k,j;return F=b.calcPresentationTimeFromMediaTime(S,R),k=F+x,j=c(R,x,F,S,b,k,L,I),y(b,R,j,L)?(j.replacementTime=A||T,p=E(p,"Number",j.replacementNumber),p=E(p,"Time",j.replacementTime),j.media=p,j.mediaRange=C,j):null}},"./src/dash/utils/TemplateSegmentsGetter.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/constants/Constants.js"),f=r("./src/dash/utils/SegmentsUtils.js");function d(c,y){c=c||{};var O=c.timelineConverter,P;function b(){if(!O||!O.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(l.default.MISSING_CONFIG_ERROR)}function L(m){var M={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!m)return M;var p=m.segmentDuration;return isNaN(p)?M.numberOfSegments=1:M.numberOfSegments=Math.ceil(m.adaptation.period.duration/p),M}function R(m,M){if(b(),!m)return null;var p=m.adaptation.period.mpd.manifest.Period_asArray[m.adaptation.period.index].AdaptationSet_asArray[m.adaptation.index].Representation_asArray[m.index].SegmentTemplate;M=Math.max(M,0);var C=(0,f.getIndexBasedSegment)(O,y,m,M);if(C){C.replacementTime=Math.round((M-1)*m.segmentDuration*m.timescale,10);var I=p.media;I=(0,f.replaceTokenForTemplate)(I,"Number",C.replacementNumber),I=(0,f.replaceTokenForTemplate)(I,"Time",C.replacementTime),C.media=I}return C}function T(m,M){if(b(),!m)return null;var p=m.segmentDuration;if(isNaN(p))return null;var C=O.calcPeriodRelativeTimeFromMpdRelativeTime(m,M),I=Math.floor(C/p);return R(m,I)}return P={getSegmentByIndex:R,getSegmentByTime:T,getMediaFinishedInformation:L},P}d.__dashjs_factory_name="TemplateSegmentsGetter";var _=u.default.getClassFactory(d);const E=_},"./src/dash/utils/TimelineConverter.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>b});var u=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),f=r("./src/core/FactoryMaker.js"),d=r("./src/dash/constants/DashConstants.js"),_=r("./src/dash/models/DashManifestModel.js"),E=r("./src/core/Settings.js"),c=r("./src/streaming/constants/Constants.js"),y=r("./src/streaming/MediaPlayerEvents.js"),O=r("./src/streaming/constants/ConformanceViolationConstants.js");function P(){var L=this.context,R=(0,u.default)(L).getInstance(),T=(0,E.default)(L).getInstance(),m,M,p,C;function I(){M=(0,_.default)(L).getInstance(),he()}function A(){_e(),R.on(l.default.UPDATE_TIME_SYNC_OFFSET,ge,this)}function S(){return C}function x(se){C=se}function F(){return Date.now()-p*1e3+C*1e3}function k(se,Z,q,le){var te,N=Z.adaptation.period.mpd,D=N.availabilityStartTime;if(le)q&&N.timeShiftBufferDepth!==Number.POSITIVE_INFINITY?te=new Date(D.getTime()+(se+N.timeShiftBufferDepth)*1e3):te=N.availabilityEndTime;else if(q){var w=Z.availabilityTimeOffset;te=new Date(D.getTime()+(se-w)*1e3)}else te=D;return te}function j(se,Z,q){return k(se,Z,q)}function V(se,Z,q){return k(se,Z,q,!0)}function Q(se,Z){return(se.getTime()-Z.mpd.availabilityStartTime.getTime()+C*1e3)/1e3}function $(se,Z){var q=Z.adaptation.period.start,le=Z.presentationTimeOffset;return se+(q-le)}function K(se,Z){var q=Z.adaptation.period.start,le=Z.presentationTimeOffset;return se-q+le}function Y(se,Z){var q,le,te;return Z&&(q=se.representation.adaptation.period.mpd.suggestedPresentationDelay,le=se.presentationStartTime+q,te=new Date(se.availabilityStartTime.getTime()+le*1e3)),te}function re(se,Z){if(!Z)return ie(se);if(T.get().streaming.timeShiftBuffer.calcFromSegmentTimeline){var q=ne(se);return ae(q.now,q.range),q.range}return ee(se)}function ie(se){var Z={start:NaN,end:NaN},q=0,le=NaN;return se.forEach(function(te){var N=te.getStreamInfo();q+=N.duration,(isNaN(le)||N.start<le)&&(le=N.start)}),Z.start=le,Z.end=le+q,Z}function ee(se){var Z={start:NaN,end:NaN};if(!se||se.length===0)return Z;var q=se[0].getAdapter().getRegularPeriods()[0],le=Q(new Date,q),te=q.mpd.timeShiftBufferDepth,N=isNaN(te)?0:le-te;if(Z.start=ce(se,N),Z.end=!isNaN(Z.start)&&le<Z.start?le:ce(se,le,!0),!isNaN(te)&&Z.end<le-te&&(Z.end=NaN),T.get().streaming.timeShiftBuffer.fallbackToSegmentTimeline){var D=ne(se);if(D.range.end<Z.start)return R.trigger(y.default.CONFORMANCE_VIOLATION,{level:O.default.LEVELS.WARNING,event:O.default.EVENTS.INVALID_DVR_WINDOW}),ae(D.now,D.range),D.range}return Z}function ne(se){var Z={start:NaN,end:NaN},q=se[0].getAdapter().getRegularPeriods()[0],le=Q(new Date,q);if(!se||se.length===0)return{range:Z,now:le};se.forEach(function(N){var D=N.getAdapter(),w=D.getMediaInfoForType(N.getStreamInfo(),c.default.VIDEO)||D.getMediaInfoForType(N.getStreamInfo(),c.default.AUDIO),W=D.getVoRepresentations(w),H=W[0],U={start:NaN,end:NaN};if(H)if(H.segmentInfoType===d.default.SEGMENT_TIMELINE)U=X(H);else{var B=H.adaptation.period;U.start=B.start,U.end=Math.max(le,B.start+B.duration)}!isNaN(U.start)&&(isNaN(Z.start)||Z.start>U.start)&&(Z.start=U.start),!isNaN(U.end)&&(isNaN(Z.end)||Z.end<U.end)&&(Z.end=U.end)}),Z.end=Math.min(le,Z.end);var te=ce(se,Z.end,!0);return Z.end=isNaN(te)?Z.end:te,Z.start=q&&q.mpd&&q.mpd.timeShiftBufferDepth&&!isNaN(q.mpd.timeShiftBufferDepth)&&!isNaN(Z.end)?Math.max(Z.end-q.mpd.timeShiftBufferDepth,Z.start):Z.start,Z.start=ce(se,Z.start),{range:Z,now:le}}function ae(se,Z){p=se-Z.end}function ce(se,Z){var q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;try{for(var le=0,te=!1,N=NaN;!te&&le<se.length;){var D=se[le].getStreamInfo();D.start<=Z&&(!isFinite(D.duration)||D.start+D.duration>=Z)?(N=Z,te=!0):!q&&D.start>Z&&(isNaN(N)||D.start<N)?N=D.start:q&&D.start+D.duration<Z&&(isNaN(N)||D.start+D.duration>N)&&(N=D.start+D.duration),le+=1}return N}catch{return Z}}function X(se){var Z=se.adaptation.period.mpd.manifest.Period_asArray[se.adaptation.period.index].AdaptationSet_asArray[se.adaptation.index],q=M.getRepresentationFor(se.index,Z),le=q.SegmentTemplate.SegmentTimeline,te=q.SegmentTemplate.timescale,N=le.S_asArray,D={start:0,end:0},w=0,W,H,U,B;for(D.start=$(N[0].t/te,se),U=0,B=N.length;U<B;U++)W=N[U],H=0,W.hasOwnProperty("r")&&(H=W.r),w+=W.d*(1+H);return D.end=$((N[0].t+w)/te,se),D}function oe(se,Z){var q=se.adaptation.period.start;return Z-q}function ge(se){se.offset!==void 0&&!isNaN(se.offset)&&x(se.offset/1e3)}function _e(){C=0,p=0}function he(){R.off(l.default.UPDATE_TIME_SYNC_OFFSET,ge,this),_e()}return m={initialize:A,getClientTimeOffset:S,setClientTimeOffset:x,getClientReferenceTime:F,calcAvailabilityStartTimeFromPresentationTime:j,calcAvailabilityEndTimeFromPresentationTime:V,calcPresentationTimeFromWallTime:Q,calcPresentationTimeFromMediaTime:$,calcPeriodRelativeTimeFromMpdRelativeTime:oe,calcMediaTimeFromPresentationTime:K,calcWallTimeForSegment:Y,calcTimeShiftBufferWindow:re,reset:he},I(),m}P.__dashjs_factory_name="TimelineConverter";const b=f.default.getSingletonFactory(P)},"./src/dash/utils/TimelineSegmentsGetter.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/constants/Constants.js"),f=r("./src/dash/utils/SegmentsUtils.js");function d(c,y){c=c||{};var O=c.timelineConverter,P=c.dashMetrics,b;function L(){if(!O)throw new Error(l.default.MISSING_CONFIG_ERROR)}function R(I){if(!I)return 0;var A=I.adaptation.period.mpd.manifest.Period_asArray[I.adaptation.period.index].AdaptationSet_asArray[I.adaptation.index].Representation_asArray[I.index].SegmentTemplate||I.adaptation.period.mpd.manifest.Period_asArray[I.adaptation.period.index].AdaptationSet_asArray[I.adaptation.index].Representation_asArray[I.index].SegmentList,S=A.SegmentTimeline,x=0,F=0,k=0,j,V,Q,$,K,Y,re;for(re=I.timescale,j=S.S_asArray,$=j.length,Q=0;Q<$;Q++){if(V=j[Q],Y=0,V.hasOwnProperty("r")&&(Y=V.r),V.hasOwnProperty("t")&&(x=V.t,F=x/re),Y<0){var ie=j[Q+1];Y=m(I,ie,V,re,F)}for(K=0;K<=Y;K++)k++,x+=V.d,F=x/re}return{numberOfSegments:k,mediaTimeOfLastSignaledSegment:F}}function T(I,A){var S=I.adaptation.period.mpd.manifest.Period_asArray[I.adaptation.period.index].AdaptationSet_asArray[I.adaptation.index].Representation_asArray[I.index].SegmentTemplate||I.adaptation.period.mpd.manifest.Period_asArray[I.adaptation.period.index].AdaptationSet_asArray[I.adaptation.index].Representation_asArray[I.index].SegmentList,x=S.SegmentTimeline,F=S.SegmentURL_asArray,k=0,j=-1,V,Q,$,K,Y,re,ie;ie=I.timescale,V=x.S_asArray;var ee=!1;for($=0,K=V.length;$<K&&!ee;$++){if(Q=V[$],re=0,Q.hasOwnProperty("r")&&(re=Q.r),Q.hasOwnProperty("t")&&(k=Q.t),re<0){var ne=V[$+1];re=m(I,ne,Q,ie,k/ie)}for(Y=0;Y<=re&&!ee;Y++)j++,ee=A(k,S,F,Q,ie,j,$),ee&&(I.segmentDuration=Q.d/ie),k+=Q.d}}function m(I,A,S,x,F){var k;if(A&&A.hasOwnProperty("t"))k=A.t/x;else try{var j=0;if(!isNaN(I.adaptation.period.start)&&!isNaN(I.adaptation.period.duration)&&isFinite(I.adaptation.period.duration))j=I.adaptation.period.start+I.adaptation.period.duration;else{var V=P.getCurrentDVRInfo();j=isNaN(V.end)?0:V.end}k=O.calcMediaTimeFromPresentationTime(j,I),I.segmentDuration=S.d/x}catch{k=0}return Math.max(Math.ceil((k-F)/(S.d/x))-1,0)}function M(I,A,S){if(L(),!I)return null;var x=null,F=!1;return T(I,function(k,j,V,Q,$,K,Y){if(F||S<0){var re=j.media,ie=Q.mediaRange;return V&&(re=V[Y].media||"",ie=V[Y].mediaRange),x=(0,f.getTimeBasedSegment)(O,y,I,k,Q.d,$,re,ie,K,Q.tManifest),!0}else k>=S*$-Q.d*.5&&(F=!0);return!1}),x}function p(I,A){if(L(),!I)return null;A===void 0&&(A=null);var S=null,x=O.calcMediaTimeFromPresentationTime(A,I);return T(I,function(F,k,j,V,Q,$,K){var Y=C(x*Q);if(Y<F+V.d&&Y>=F){var re=k.media,ie=V.mediaRange;return j&&(re=j[K].media||"",ie=j[K].mediaRange),S=(0,f.getTimeBasedSegment)(O,y,I,F,V.d,Q,re,ie,$,V.tManifest),!0}return!1}),S}function C(I){return parseFloat(I.toPrecision(15))}return b={getSegmentByIndex:M,getSegmentByTime:p,getMediaFinishedInformation:R},b}d.__dashjs_factory_name="TimelineSegmentsGetter";var _=u.default.getClassFactory(d);const E=_},"./src/dash/vo/AdaptationSet.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.period=null,this.index=-1,this.type=null};const f=l},"./src/dash/vo/BaseURL.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});function u(E,c){if(!(E instanceof c))throw new TypeError("Cannot call a class as a function")}var l=1,f=1,d=function E(c,y,O,P){u(this,E),this.url=c||"",this.serviceLocation=y||c||"",this.dvb_priority=O||l,this.dvb_weight=P||f,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0};d.DEFAULT_DVB_PRIORITY=l,d.DEFAULT_DVB_WEIGHT=f;const _=d},"./src/dash/vo/ContentSteering.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.defaultServiceLocation=null,this.queryBeforeStart=!1,this.proxyServerUrl=null,this.serverUrl=null};const f=l},"./src/dash/vo/ContentSteeringRequest.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/streaming/vo/metrics/HTTPRequest.js");function l(_,E){if(!(_ instanceof E))throw new TypeError("Cannot call a class as a function")}var f=function _(E){l(this,_),this.url=E||null,this.type=u.HTTPRequest.CONTENT_STEERING_TYPE,this.responseType="json"};const d=f},"./src/dash/vo/ContentSteeringResponse.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.version=null,this.ttl=300,this.reloadUri=null,this.serviceLocationPriority=[]};const f=l},"./src/dash/vo/Event.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN};const f=l},"./src/dash/vo/EventStream.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0};const f=l},"./src/dash/vo/ManifestInfo.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.dvrWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null};const f=l},"./src/dash/vo/MediaInfo.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.labels=null,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.KID=null,this.bitrateList=null,this.isFragmented=null,this.isEmbedded=null,this.selectionPriority=1,this.supplementalProperties={}};const f=l},"./src/dash/vo/Mpd.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.publishTime=null,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN};const f=l},"./src/dash/vo/PatchOperation.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});function u(E,c){if(!(E instanceof c))throw new TypeError("Cannot call a class as a function")}function l(E,c){for(var y=0;y<c.length;y++){var O=c[y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(E,O.key,O)}}function f(E,c,y){return c&&l(E.prototype,c),y&&l(E,y),E}var d=function(){function E(c,y,O){u(this,E),this.action=c,this.xpath=y,this.value=O,this.position=null}return f(E,[{key:"getMpdTarget",value:function(y){var O=this.action==="remove"||this.action==="replace"||this.position==="before"||this.position==="after";return this.xpath.getMpdTarget(y,O)}}]),E}();const _=d},"./src/dash/vo/Period.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null,this.nextPeriodId=null};l.DEFAULT_ID="defaultId";const f=l},"./src/dash/vo/ProducerReferenceTime.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.id=null,this.inband=!1,this.type="encoder",this.applicationScheme=null,this.wallClockTime=null,this.presentationTime=NaN,this.UTCTiming=null};const f=l},"./src/dash/vo/Representation.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/dash/constants/DashConstants.js");function l(c,y){if(!(c instanceof y))throw new TypeError("Cannot call a class as a function")}function f(c,y){for(var O=0;O<y.length;O++){var P=y[O];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(c,P.key,P)}}function d(c,y,O){return y&&f(c.prototype,y),O&&f(c,O),c}var _=function(){function c(){l(this,c),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.mimeType=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.mediaFinishedInformation={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN},this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}return d(c,[{key:"hasInitialization",value:function(){return this.initialization!==null||this.range!==null}},{key:"hasSegments",value:function(){return this.segmentInfoType!==u.default.BASE_URL&&this.segmentInfoType!==u.default.SEGMENT_BASE&&!this.indexRange}}]),c}();const E=_},"./src/dash/vo/RepresentationInfo.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.id=null,this.quality=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null};const f=l},"./src/dash/vo/Segment.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.wallStartTime=NaN,this.representation=null};const f=l},"./src/dash/vo/SimpleXPath.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});function u(E,c){if(!(E instanceof c))throw new TypeError("Cannot call a class as a function")}function l(E,c){for(var y=0;y<c.length;y++){var O=c[y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(E,O.key,O)}}function f(E,c,y){return c&&l(E.prototype,c),y&&l(E,y),E}var d=function(){function E(c){var y=this;u(this,E),this.valid=c[0]=="/",this.path=c.split("/").filter(function(O){return O.length!==0}).map(function(O){var P={name:O},b=O.indexOf("[");if(b!=-1){P.name=O.substring(0,b);var L=O.substring(b+1,O.length-1);y.valid=y.valid&&L.indexOf("[")==-1;var R=L.indexOf("=");R!=-1?(P.attribute={name:L.substring(1,R),value:L.substring(R+1)},["'",'"'].indexOf(P.attribute.value[0])!=-1&&(P.attribute.value=P.attribute.value.substring(1,P.attribute.value.length-1))):P.position=parseInt(L,10)-1}return P})}return f(E,[{key:"isValid",value:function(){return this.valid}},{key:"findsElement",value:function(){return!this.findsAttribute()}},{key:"findsAttribute",value:function(){return this.path[this.path.length-1].name.startsWith("@")}},{key:"getMpdTarget",value:function(y,O){for(var P=null,b=y,L=1,R="MPD";L<this.path.length&&b!==null;){P=b;var T=this.path[L];if(R=T.name,L!==this.path.length-1||!R.startsWith("@")){var m=P[R+"_asArray"]||[];m.length===0&&P[R]&&m.push(P[R]),T.position?b=m[T.position]||null:T.attribute?function(){var M=T.attribute;b=m.filter(function(p){return p[M.name]==M.value})[0]||null}():b=m[0]||null}L++}return b===null?null:R.startsWith("@")?{name:R.substring(1),leaf:b,target:b}:{name:R,leaf:b,target:O?P:b}}}]),E}();const _=d},"./src/dash/vo/StreamInfo.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0};const f=l},"./src/dash/vo/UTCTiming.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.schemeIdUri="",this.value=""};const f=l},"./src/streaming/FragmentLoader.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>c});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/streaming/net/URLLoader.js"),f=r("./src/streaming/vo/HeadRequest.js"),d=r("./src/streaming/vo/DashJSError.js"),_=r("./src/core/FactoryMaker.js");function E(y){y=y||{};var O=this.context,P=y.eventBus,b=y.events,L=y.urlUtils,R=y.errors,T=y.streamId,m,M;function p(){M=(0,l.default)(O).create({errHandler:y.errHandler,errors:R,dashMetrics:y.dashMetrics,mediaPlayerModel:y.mediaPlayerModel,requestModifier:y.requestModifier,urlUtils:L,constants:u.default,boxParser:y.boxParser,dashConstants:y.dashConstants,requestTimeout:y.settings.get().streaming.fragmentRequestTimeout})}function C(x){var F=function(V){P.trigger(b.CHECK_FOR_EXISTENCE_COMPLETED,{request:x,exists:V})};if(x){var k=new f.default(x.url);M.load({request:k,success:function(){F(!0)},error:function(){F(!1)}})}else F(!1)}function I(x){var F=function(j,V){P.trigger(b.LOADING_COMPLETED,{request:x,response:j||null,error:V||null,sender:m})};x?M.load({request:x,progress:function(j){P.trigger(b.LOADING_PROGRESS,{request:x,stream:j.stream,streamId:T}),j.data&&P.trigger(b.LOADING_DATA_PROGRESS,{request:x,response:j.data||null,error:null,sender:m})},success:function(j){F(j)},error:function(j,V,Q){F(void 0,new d.default(R.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,Q,V))},abort:function(j){j&&P.trigger(b.LOADING_ABANDONED,{mediaType:j.mediaType,request:j,sender:m})}}):F(void 0,new d.default(R.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,R.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))}function A(){M&&M.abort()}function S(){M&&(M.abort(),M=null)}return m={checkForExistence:C,load:I,abort:A,reset:S},p(),m}E.__dashjs_factory_name="FragmentLoader";const c=_.default.getClassFactory(E)},"./src/streaming/ManifestLoader.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>M});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/dash/constants/DashConstants.js"),f=r("./src/streaming/controllers/XlinkController.js"),d=r("./src/streaming/net/URLLoader.js"),_=r("./src/streaming/utils/URLUtils.js"),E=r("./src/streaming/vo/TextRequest.js"),c=r("./src/streaming/vo/DashJSError.js"),y=r("./src/streaming/vo/metrics/HTTPRequest.js"),O=r("./src/core/EventBus.js"),P=r("./src/core/events/Events.js"),b=r("./src/core/errors/Errors.js"),L=r("./src/core/FactoryMaker.js"),R=r("./src/dash/parser/DashParser.js");function T(p){p=p||{};var C=this.context,I=p.debug,A=p.settings,S=(0,O.default)(C).getInstance(),x=(0,_.default)(C).getInstance(),F,k,j,V,Q,$=p.mssHandler,K=p.errHandler;function Y(){k=I.getLogger(F),S.on(P.default.XLINK_READY,re,F),j=(0,d.default)(C).create({errHandler:p.errHandler,dashMetrics:p.dashMetrics,mediaPlayerModel:p.mediaPlayerModel,requestModifier:p.requestModifier,urlUtils:x,constants:u.default,dashConstants:l.default,errors:b.default,requestTimeout:p.settings.get().streaming.manifestRequestTimeout}),V=(0,f.default)(C).create({errHandler:K,dashMetrics:p.dashMetrics,mediaPlayerModel:p.mediaPlayerModel,requestModifier:p.requestModifier,settings:p.settings}),Q=null}function re(ae){S.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:ae.manifest})}function ie(ae){var ce=null;return ae.indexOf("SmoothStreamingMedia")>-1?($&&(ce=$.createMssParser(),$.registerEvents()),ce):ae.indexOf("MPD")>-1||ae.indexOf("Patch")>-1?(0,R.default)(C).create({debug:I}):ce}function ee(ae){var ce=new E.default(ae,y.HTTPRequest.MPD_TYPE);j.load({request:ce,success:function(oe,ge,_e){if(V){var he,se,Z;if(_e&&_e!==ae?(se=x.parseBaseUrl(_e),he=_e):(x.isRelative(ae)&&(ae=x.resolve(ae,window.location.href)),se=x.parseBaseUrl(ae)),ge=="No Content"){S.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:null});return}if(Q===null&&(Q=ie(oe)),Q===null){S.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(b.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,b.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(ae))});return}V.setMatchers(Q.getMatchers()),V.setIron(Q.getIron());try{Z=Q.parse(oe)}catch{S.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(b.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,b.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(ae))});return}if(Z){if(Z.url=he||ae,Z.originalUrl||(Z.originalUrl=Z.url),Z.hasOwnProperty(u.default.LOCATION)&&(se=x.parseBaseUrl(Z.Location_asArray[0]),k.debug("BaseURI set by Location to: "+se)),A&&A.get().streaming.enableManifestDurationMismatchFix&&Z.mediaPresentationDuration&&Z.Period_asArray.length>1){var q=Z.Period_asArray.reduce(function(le,te){return le+te.duration},0);!isNaN(q)&&Z.mediaPresentationDuration>q&&(k.warn("Media presentation duration greater than duration of all periods. Setting duration to total period duration"),Z.mediaPresentationDuration=q)}Z.baseUri=se,Z.loadedTime=new Date,V.resolveManifestOnLoad(Z),S.trigger(P.default.ORIGINAL_MANIFEST_LOADED,{originalManifest:oe})}else S.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(b.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,b.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(ae))})}},error:function(oe,ge,_e){S.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(b.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,b.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+"".concat(ae,", ").concat(_e))})}})}function ne(){S.off(P.default.XLINK_READY,re,F),$&&$.reset(),V&&(V.reset(),V=null),j&&(j.abort(),j=null)}return F={load:ee,reset:ne},Y(),F}T.__dashjs_factory_name="ManifestLoader";var m=L.default.getClassFactory(T);const M=m},"./src/streaming/ManifestUpdater.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>P});var u=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),f=r("./src/streaming/MediaPlayerEvents.js"),d=r("./src/core/FactoryMaker.js"),_=r("./src/core/Debug.js"),E=r("./src/core/errors/Errors.js"),c=r("./src/dash/constants/DashConstants.js"),y=r("./src/streaming/utils/URLUtils.js");function O(){var b=this.context,L=(0,u.default)(b).getInstance(),R=(0,y.default)(b).getInstance(),T,m,M,p,C,I,A,S,x,F,k,j;function V(){m=(0,_.default)(b).getInstance().getLogger(T)}function Q(se){se&&(se.manifestModel&&(x=se.manifestModel),se.adapter&&(F=se.adapter),se.manifestLoader&&(S=se.manifestLoader),se.errHandler&&(k=se.errHandler),se.settings&&(j=se.settings))}function $(){Y(),L.on(l.default.STREAMS_COMPOSED,_e,this),L.on(f.default.PLAYBACK_STARTED,oe,this),L.on(f.default.PLAYBACK_PAUSED,ge,this),L.on(l.default.INTERNAL_MANIFEST_LOADED,X,this)}function K(se){ae(se)}function Y(){M=NaN,A=!1,C=!0,I=!1,ie()}function re(){L.off(f.default.PLAYBACK_STARTED,oe,this),L.off(f.default.PLAYBACK_PAUSED,ge,this),L.off(l.default.STREAMS_COMPOSED,_e,this),L.off(l.default.INTERNAL_MANIFEST_LOADED,X,this),Y()}function ie(){p!==null&&(clearTimeout(p),p=null)}function ee(se){ie(),!I&&(isNaN(se)&&!isNaN(M)&&(se=M*1e3),isNaN(se)||(m.debug("Refresh manifest in "+se+" milliseconds."),p=setTimeout(ce,se)))}function ne(){var se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;A=!0;var Z=x.getValue(),q=Z.url,le=F.getPatchLocation(Z),te=F.getLocation(Z);le&&!se?q=le:te&&(q=te),R.isRelative(q)&&(q=R.resolve(q,Z.url)),S.load(q)}function ae(se){if(!se)se=x.getValue(),se.loadedTime=new Date;else if(F.getIsPatch(se)){var Z=se;se=x.getValue();var q=F.isPatchValid(se,Z),le=q;if(q){var te=F.getPublishTime(se);le=F.applyPatchToManifest(se,Z);var N=F.getPublishTime(se);le=te.getTime()!=N.getTime()}if(!le){m.debug("Patch provided is invalid, performing full manifest refresh"),ne(!0);return}se.loadedTime=new Date}if(x.getValue()&&x.getValue().type===c.default.DYNAMIC&&se.type===c.default.STATIC){L.trigger(l.default.DYNAMIC_TO_STATIC),A=!1,I=!0;return}x.setValue(se);var D=new Date,w=(D.getTime()-se.loadedTime.getTime())/1e3;M=F.getManifestUpdatePeriod(se,w),M*1e3>2147483647&&(M=2147483647e-3),L.trigger(l.default.MANIFEST_UPDATED,{manifest:se}),m.info("Manifest has been refreshed at "+D+"["+D.getTime()/1e3+"] "),C||ee()}function ce(){if(!C){if(A){ee(j.get().streaming.manifestUpdateRetryInterval);return}ne()}}function X(se){se.error?se.error.code===E.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&k.error(se.error):ae(se.manifest)}function oe(){C=!1,ee()}function ge(){C=!j.get().streaming.scheduling.scheduleWhilePaused,C&&ie()}function _e(){A=!1}function he(){return A}return T={initialize:$,setManifest:K,refreshManifest:ne,getIsUpdating:he,setConfig:Q,reset:re},V(),T}O.__dashjs_factory_name="ManifestUpdater";const P=d.default.getClassFactory(O)},"./src/streaming/MediaPlayer.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>U});var u=r("./externals/cea608-parser.js"),l=r.n(u),f=r("./src/streaming/constants/Constants.js"),d=r("./src/dash/constants/DashConstants.js"),_=r("./src/streaming/constants/MetricsConstants.js"),E=r("./src/streaming/controllers/PlaybackController.js"),c=r("./src/streaming/controllers/StreamController.js"),y=r("./src/streaming/controllers/GapController.js"),O=r("./src/streaming/controllers/CatchupController.js"),P=r("./src/dash/controllers/ServiceDescriptionController.js"),b=r("./src/dash/controllers/ContentSteeringController.js"),L=r("./src/streaming/controllers/MediaController.js"),R=r("./src/streaming/controllers/BaseURLController.js"),T=r("./src/streaming/ManifestLoader.js"),m=r("./src/streaming/utils/ErrorHandler.js"),M=r("./src/streaming/utils/Capabilities.js"),p=r("./src/streaming/utils/CapabilitiesFilter.js"),C=r("./src/streaming/utils/RequestModifier.js"),I=r("./src/streaming/models/URIFragmentModel.js"),A=r("./src/streaming/models/ManifestModel.js"),S=r("./src/streaming/models/MediaPlayerModel.js"),x=r("./src/streaming/controllers/AbrController.js"),F=r("./src/streaming/net/SchemeLoaderFactory.js"),k=r("./src/streaming/models/VideoModel.js"),j=r("./src/streaming/models/CmcdModel.js"),V=r("./src/streaming/models/CmsdModel.js"),Q=r("./src/streaming/utils/DOMStorage.js"),$=r("./src/core/Debug.js"),K=r("./src/core/errors/Errors.js"),Y=r("./src/core/EventBus.js"),re=r("./src/core/events/Events.js"),ie=r("./src/streaming/MediaPlayerEvents.js"),ee=r("./src/core/FactoryMaker.js"),ne=r("./src/core/Settings.js"),ae=r("./src/core/Version.js"),ce=r("./src/dash/controllers/SegmentBaseController.js"),X=r("./src/dash/DashAdapter.js"),oe=r("./src/dash/DashMetrics.js"),ge=r("./src/dash/utils/TimelineConverter.js"),_e=r("./src/streaming/vo/metrics/HTTPRequest.js"),he=r("./externals/base64.js"),se=r("./node_modules/codem-isoboxer/dist/iso_boxer.js"),Z=r("./src/streaming/vo/DashJSError.js"),q=r("./src/streaming/utils/SupervisorTools.js"),le=r("./src/streaming/ManifestUpdater.js"),te=r("./src/streaming/utils/URLUtils.js"),N=r("./src/streaming/utils/BoxParser.js"),D=r("./src/streaming/text/TextController.js"),w=r("./src/streaming/models/CustomParametersModel.js");function W(){var B="You must first call initialize() and set a source before calling this method",G="You must first call initialize() and set a valid source and view before calling this method",z="You must first call attachView() to set the video element before calling this method",fe="You must first call attachSource() with a valid source before calling this method",ue="MediaPlayer not initialized!",J=this.context,ve=(0,Y.default)(J).getInstance(),me=(0,ne.default)(J).getInstance(),Ae=(0,$.default)(J).getInstance({settings:me}),be,Be,ke,Ye,Le,Se,Me,qe,it,at,Ce,je,Ge,tt,ot,dt,gt,Mt,$e,Te,de,Re,xe,Ne,Xe,nt,et,ht,yt,Pt,De,Ue,Ze,Et,ct,Tt,Ot,jt;function Gt(){Be=Ae.getLogger(be),Le=!1,Me=!1,Se=!1,qe=!0,Ge=null,dt=null,Ye=null,gt=null,jt=null,re.default.extend(ie.default),Mt=(0,S.default)(J).getInstance(),$e=(0,w.default)(J).getInstance(),ct=(0,k.default)(J).getInstance(),Tt=(0,I.default)(J).getInstance()}function pe(Fe){Fe&&(Fe.capabilities&&(Re=Fe.capabilities),Fe.capabilitiesFilter&&(xe=Fe.capabilitiesFilter),Fe.streamController&&(Ne=Fe.streamController),Fe.textController&&(Xe=Fe.textController),Fe.gapController&&(nt=Fe.gapController),Fe.playbackController&&(et=Fe.playbackController),Fe.serviceDescriptionController&&(ht=Fe.serviceDescriptionController),Fe.contentSteeringController&&(yt=Fe.contentSteeringController),Fe.catchupController&&(Pt=Fe.catchupController),Fe.mediaPlayerModel&&(Mt=Fe.mediaPlayerModel),Fe.customParametersModel&&($e=Fe.customParametersModel),Fe.abrController&&(it=Fe.abrController),Fe.schemeLoaderFactory&&(at=Fe.schemeLoaderFactory),Fe.mediaController&&(je=Fe.mediaController),Fe.settings&&(me=Fe.settings))}function Ve(Fe,vt,Lt){var Qt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:NaN;if(Re||(Re=(0,M.default)(J).getInstance(),Re.setConfig({settings:me})),Te||(Te=(0,m.default)(J).getInstance()),!Re.supportsMediaSource()){Te.error(new Z.default(K.default.CAPABILITY_MEDIASOURCE_ERROR_CODE,K.default.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE));return}Le||(Le=!0,Ce=(0,ge.default)(J).getInstance(),it||(it=(0,x.default)(J).getInstance(),it.setConfig({settings:me})),at||(at=(0,F.default)(J).getInstance()),et||(et=(0,E.default)(J).getInstance()),je||(je=(0,L.default)(J).getInstance()),Ne||(Ne=(0,c.default)(J).getInstance()),nt||(nt=(0,y.default)(J).getInstance()),Pt||(Pt=(0,O.default)(J).getInstance()),ht||(ht=(0,P.default)(J).getInstance()),yt||(yt=(0,b.default)(J).getInstance()),xe||(xe=(0,p.default)(J).getInstance()),gt=(0,X.default)(J).getInstance(),Ue=(0,A.default)(J).getInstance(),Ze=(0,j.default)(J).getInstance(),Et=(0,V.default)(J).getInstance(),De=(0,oe.default)(J).getInstance({settings:me}),Ot=(0,Q.default)(J).getInstance({settings:me}),gt.setConfig({constants:f.default,cea608parser:l(),errHandler:Te,BASE64:he}),de||(de=(0,R.default)(J).create()),de.setConfig({adapter:gt}),ht.setConfig({adapter:gt}),jt||(jt=(0,ce.default)(J).getInstance({dashMetrics:De,mediaPlayerModel:Mt,errHandler:Te,baseURLController:de,events:re.default,eventBus:ve,debug:Ae,boxParser:(0,N.default)(J).getInstance(),requestModifier:(0,C.default)(J).getInstance(),errors:K.default})),je.setConfig({domStorage:Ot,settings:me,customParametersModel:$e}),Mt.setConfig({playbackController:et,serviceDescriptionController:ht}),yt.setConfig({adapter:gt,errHandler:Te,dashMetrics:De,mediaPlayerModel:Mt,manifestModel:Ue,abrController:it,eventBus:ve,requestModifier:(0,C.default)(J).getInstance()}),Jr(),Fr(Lt!==void 0?Lt:!0),Fa()),Fe&&Zr(Fe),vt&&Ei(vt,Qt),Be.info("[dash.js "+Nt()+"] MediaPlayer has been initialized")}function ft(){Ei(null),Zr(null),Ye=null,Ge&&(Ge.reset(),Ge=null),tt&&(tt.reset(),tt=null),$e&&$e.reset(),me.reset(),dt&&(dt.reset(),dt=null)}function Ie(){ft(),ee.default.deleteSingletonInstances(J)}function we(){return!!ke&&!!ct.getElement()}function ze(Fe,vt,Lt,Qt){ve.on(Fe,vt,Lt,Qt)}function _t(Fe,vt,Lt){ve.off(Fe,vt,Lt)}function Nt(){return(0,ae.getVersionString)()}function It(){return Ae}function Dt(){if(ct.getElement()||Se)return!1;if(ke)pi();else throw fe}function Zt(){if(!Me)throw G;(!qe||Je()&&Me)&&et.play(!0)}function Wt(){if(!Me)throw G;et.pause()}function Je(){if(!Me)throw G;return et.isPaused()}function St(Fe){if(!Me)throw G;if((0,q.checkParameterType)(Fe,"number"),isNaN(Fe))throw f.default.BAD_ARGUMENT_ERROR;Fe<0&&(Fe=0);var vt=et.getIsDynamic()?Dr(Fe):Fe,Lt=ur();!et.getIsDynamic()&&Lt.duration&&(vt=Math.min(Lt.duration,vt)),et.seek(vt,!1,!1,!0)}function At(){!Me||!Ke()||et.seekToOriginalLive()}function Pe(){if(!Me)throw G;return et.isSeeking()}function Ke(){if(!Me)throw G;return et.getIsDynamic()}function ye(){if(!Me)throw G;return et.getLowLatencyModeEnabled()}function He(Fe){ur().playbackRate=Fe}function lt(){return ur().playbackRate}function Rt(Fe){(0,q.checkParameterType)(Fe,"boolean"),ur().muted=Fe}function Ct(){return ur().muted}function Kt(Fe){if(typeof Fe!="number"||isNaN(Fe)||Fe<0||Fe>1)throw f.default.BAD_ARGUMENT_ERROR;ur().volume=Fe}function Ht(){return ur().volume}function Ut(Fe){var vt=[f.default.VIDEO,f.default.AUDIO,f.default.TEXT];if(Fe)if(vt.indexOf(Fe)!==-1){var Qt=wt().getCurrentBufferLevel(Fe);return Qt||NaN}else return Be.warn("getBufferLength requested for invalid type"),NaN;else{var Lt=vt.map(function(rr){return xa(rr).length>0?wt().getCurrentBufferLevel(rr):Number.MAX_VALUE}).reduce(function(rr,_n){return Math.min(rr,_n)});return Lt===Number.MAX_VALUE?NaN:Lt}}function sr(){var Fe=Ne&&Ne.hasVideoTrack()?f.default.VIDEO:f.default.AUDIO,vt=De.getCurrentDVRInfo(Fe);return vt?vt.manifestInfo.dvrWindowSize:0}function Dr(Fe){var vt=Ne&&Ne.hasVideoTrack()?f.default.VIDEO:f.default.AUDIO,Lt=De.getCurrentDVRInfo(vt);if(!Lt)return 0;var Qt=et.getOriginalLiveDelay(),rr=Lt.range.start+Fe;return rr>Lt.range.end-Qt&&(rr=Lt.range.end-Qt),rr}function Nr(){if(!Me)throw G;return et.getOriginalLiveDelay()}function _r(Fe){if(!Me)throw G;var vt=ur().currentTime;if(Fe!==void 0)vt=Ne.getTimeRelativeToStreamId(vt,Fe);else if(et.getIsDynamic()){var Lt=Ne&&Ne.hasVideoTrack()?f.default.VIDEO:f.default.AUDIO,Qt=De.getCurrentDVRInfo(Lt);vt=Qt===null||vt===0?0:Math.max(0,vt-Qt.range.start)}return vt}function $r(){if(!Me)throw G;var Fe=ur().duration;if(et.getIsDynamic()){var vt=Ne&&Ne.hasVideoTrack()?f.default.VIDEO:f.default.AUDIO,Lt=De.getCurrentDVRInfo(vt);Fe=Lt?Lt.range.end-Lt.range.start:0}return Fe}function an(){if(!Me)throw G;return _r()<0?NaN:wa(_r())}function mn(){if(!Me)throw G;return wa($r())}function Ir(Fe){if(!Se)throw B;return it.getTopBitrateInfoFor(Fe)}function Xr(Fe){if(!Se)throw B;if(Fe===f.default.IMAGE){var vt=wn();if(!vt)return-1;var Lt=vt.getThumbnailController();return Lt?Lt.getCurrentTrackIndex():-1}return it.getQualityFor(Fe)}function Qr(Fe,vt){var Lt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!Se)throw B;if(Fe===f.default.IMAGE){var Qt=wn();if(!Qt)return;var rr=Qt.getThumbnailController();rr&&rr.setTrackByIndex(vt)}it.setPlaybackQuality(Fe,Ne.getActiveStreamInfo(),vt,{forceReplace:Lt})}function bn(){it.setElementSize(),it.setWindowResizeEventCalled(!0)}function Fr(Fe){(0,q.checkParameterType)(Fe,"boolean"),qe=Fe}function di(){return qe}function hi(){if(!Le)throw ue;return Me?et.getCurrentLiveLatency():NaN}function En(Fe,vt,Lt){$e.addAbrCustomRule(Fe,vt,Lt)}function xn(Fe){$e.removeAbrCustomRule(Fe)}function gi(){$e.removeAllAbrCustomRule()}function mi(){return $e.getAbrCustomRules()}function Nn(Fe,vt){$e.addUTCTimingSource(Fe,vt)}function sn(Fe,vt){$e.removeUTCTimingSource(Fe,vt)}function Fn(){$e.clearDefaultUTCTimingSources()}function Jr(){$e.restoreDefaultUTCTimingSources()}function Oe(Fe){var vt=it.getThroughputHistory(),Lt=et.getIsDynamic();return vt?vt.getAverageThroughput(Fe,Lt):0}function rt(Fe,vt){$e.setXHRWithCredentialsForType(Fe,vt)}function pt(Fe){return $e.getXHRWithCredentialsForType(Fe)}function bt(){return Fa()}function wt(){return De}function Vt(Fe){var vt=Ne.getActiveStreamInfo();return!vt||!Xe?!1:Xe.enableText(vt.id,Fe)}function Yt(Fe){var vt=Ne.getActiveStreamInfo();return!vt||!Xe?!1:Xe.enableForcedTextStreaming(Fe)}function Er(){var Fe=Ne.getActiveStreamInfo();return!Fe||!Xe?!1:Xe.isTextEnabled(Fe)}function nr(Fe){if(!Me)throw G;var vt=Ne.getActiveStreamInfo();!vt||!Xe||Xe.setTextTrack(vt.id,Fe)}function Cr(){var Fe=NaN,vt=Ne.getActiveStreamInfo();if(!(!vt||!Xe))return Fe=Xe.getCurrentTrackIdx(vt.id),Fe}function ur(){if(!ct.getElement())throw z;return ct.getElement()}function Zr(Fe){if(!Le)throw ue;ct.setElement(Fe),Fe&&(vi(),jl(),Wl(),Ne&&Ne.switchToVideoElement()),Me&&Na(),pi()}function sl(){return ct?ct.getTTMLRenderingDiv():null}function ol(Fe){if(!ct.getElement())throw z;ct.setTTMLRenderingDiv(Fe)}function ll(Fe){if(!ct.getElement())throw z;ct.setVttRenderingDiv(Fe)}function ul(Fe){if(!Se)throw B;var vt=wn();return vt?vt.getBitrateListFor(Fe):[]}function fl(Fe){if(!Se)throw B;return gt.getStreamsInfo(Fe)}function xa(Fe){if(!Se)throw B;var vt=Ne.getActiveStreamInfo();return vt?je.getTracksFor(Fe,vt.id):[]}function cl(Fe,vt,Lt){if(!Se)throw B;return Lt=Lt||gt.getStreamsInfo(vt,1)[0],Lt?gt.getAllMediaInfoForType(Lt,Fe,vt):[]}function dl(Fe){if(!Se)throw B;var vt=Ne.getActiveStreamInfo();return je.getCurrentTrackFor(Fe,vt.id)}function hl(Fe,vt){if(!Le)throw ue;je.setInitialSettings(Fe,vt)}function gl(Fe){if(!Le)throw ue;return je.getInitialSettings(Fe)}function ml(Fe){if(!Se)throw B;je.setTrack(Fe)}function El(Fe){$e.registerCustomCapabilitiesFilter(Fe)}function _l(Fe){$e.unregisterCustomCapabilitiesFilter(Fe)}function vl(Fe){$e.setCustomInitialTrackSelectionFunction(Fe)}function pl(){$e.resetCustomInitialTrackSelectionFunction(null)}function Tl(Fe){$e.registerLicenseRequestFilter(Fe)}function yl(Fe){$e.registerLicenseResponseFilter(Fe)}function Al(Fe){$e.unregisterLicenseRequestFilter(Fe)}function Sl(Fe){$e.unregisterLicenseResponseFilter(Fe)}function Rl(){return vi()}function Dl(Fe){Ge=Fe}function Il(Fe){Ye=Fe,Ne&&Ne.setProtectionData(Ye)}function Cl(Fe,vt){if(typeof vt=="function"){if(Fe<0){vt(null);return}var Lt=et.getIsDynamic()?Dr(Fe):Fe,Qt=Ne.getStreamForTime(Lt);if(Qt===null){vt(null);return}var rr=Qt.getThumbnailController();if(!rr){vt(null);return}return rr.provide(Lt,vt)}}function Pl(Fe,vt){var Lt=_i(),Qt=this,rr=function _n(on){on.error?vt(null,on.error):vt(on.manifest),ve.off(re.default.INTERNAL_MANIFEST_LOADED,_n,Qt),Lt.reset()};ve.on(re.default.INTERNAL_MANIFEST_LOADED,rr,Qt),Tt.initialize(Fe),Lt.load(Fe)}function Ml(){if(!ke)throw fe;return ke}function Ol(Fe){ke=Fe,Ne.load(ke)}function Ei(Fe){var vt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:NaN;if(!Le)throw ue;typeof Fe=="string"&&Tt.initialize(Fe),vt==null&&(vt=NaN),isNaN(vt)||(vt=Math.max(0,vt)),ke=Fe,(Se||Me)&&Na(),we()&&pi(vt)}function Ll(){return me.get()}function bl(Fe){me.update(Fe)}function xl(){me.reset()}function Nl(Fe,vt,Lt){var Qt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,rr=new Date(Fe*1e3),_n=rr.toLocaleDateString(vt),on=rr.toLocaleTimeString(vt,{hour12:Lt});return Qt?on+" "+_n:on}function Fl(Fe){Fe=Math.max(Fe,0);var vt=Math.floor(Fe/3600),Lt=Math.floor(Fe%3600/60),Qt=Math.floor(Fe%3600%60);return(vt===0?"":vt<10?"0"+vt.toString()+":":vt.toString()+":")+(Lt<10?"0"+Lt.toString():Lt.toString())+":"+(Qt<10?"0"+Qt.toString():Qt.toString())}function wl(Fe,vt,Lt){ee.default.extend(Fe,vt,Lt,J)}function wn(){if(!Se)throw B;var Fe=Ne.getActiveStreamInfo();return Fe?Ne.getStreamById(Fe.id):null}function Bl(){return gt}function Ul(){if(yt)return yt.loadSteeringData()}function kl(){if(yt)return yt.getCurrentSteeringResponseData()}function Na(){Me=!1,Se=!1,gt.reset(),Ne.reset(),nt.reset(),Pt.reset(),et.reset(),ht.reset(),yt.reset(),it.reset(),je.reset(),jt.reset(),Ge&&(me.get().streaming.protection.keepProtectionMediaKeys?Ge.stop():(Ge.reset(),Ge=null,vi())),Xe.reset(),Ze.reset(),Et.reset()}function Kl(){var Fe=_i();Ne||(Ne=(0,c.default)(J).getInstance()),Xe||(Xe=(0,D.default)(J).create({errHandler:Te,manifestModel:Ue,adapter:gt,mediaController:je,videoModel:ct,settings:me})),xe.setConfig({capabilities:Re,customParametersModel:$e,adapter:gt,settings:me,manifestModel:Ue,errHandler:Te}),Ne.setConfig({capabilities:Re,capabilitiesFilter:xe,manifestLoader:Fe,manifestModel:Ue,mediaPlayerModel:Mt,customParametersModel:$e,protectionController:Ge,textController:Xe,adapter:gt,dashMetrics:De,errHandler:Te,timelineConverter:Ce,videoModel:ct,playbackController:et,serviceDescriptionController:ht,contentSteeringController:yt,abrController:it,mediaController:je,settings:me,baseURLController:de,uriFragmentModel:Tt,segmentBaseController:jt}),nt.setConfig({settings:me,playbackController:et,streamController:Ne,videoModel:ct,timelineConverter:Ce,adapter:gt}),et.setConfig({streamController:Ne,serviceDescriptionController:ht,dashMetrics:De,adapter:gt,videoModel:ct,timelineConverter:Ce,settings:me}),Pt.setConfig({streamController:Ne,playbackController:et,mediaPlayerModel:Mt,videoModel:ct,settings:me}),it.setConfig({streamController:Ne,domStorage:Ot,mediaPlayerModel:Mt,customParametersModel:$e,cmsdModel:Et,dashMetrics:De,adapter:gt,videoModel:ct,settings:me}),Ze.setConfig({abrController:it,dashMetrics:De,playbackController:et}),Et.setConfig({}),it.initialize(),Ne.initialize(qe,Ye),Xe.initialize(),nt.initialize(),Pt.initialize(),Ze.initialize(),Et.initialize(),yt.initialize(),jt.initialize()}function _i(){return(0,T.default)(J).create({debug:Ae,errHandler:Te,dashMetrics:De,mediaPlayerModel:Mt,requestModifier:(0,C.default)(J).getInstance(),mssHandler:ot,settings:me})}function vi(){if(Ge)return Ge;var Fe=dashjs.Protection;if(typeof Fe=="function"){var vt=Fe(J).create();return re.default.extend(Fe.events),ie.default.extend(Fe.events,{publicOnly:!0}),K.default.extend(Fe.errors),Re||(Re=(0,M.default)(J).getInstance()),Ge=vt.createProtectionSystem({debug:Ae,errHandler:Te,videoModel:ct,customParametersModel:$e,capabilities:Re,eventBus:ve,events:re.default,BASE64:he,constants:f.default,cmcdModel:Ze,settings:me}),Ge}return null}function jl(){if(!tt){var Fe=dashjs.MetricsReporting;if(typeof Fe=="function"){var vt=Fe(J).create();tt=vt.createMetricsReporting({debug:Ae,eventBus:ve,mediaElement:ur(),adapter:gt,dashMetrics:De,mediaPlayerModel:Mt,events:re.default,constants:f.default,metricsConstants:_.default})}}}function Wl(){if(!ot){var Fe=dashjs.MssHandler;typeof Fe=="function"&&(K.default.extend(Fe.errors),ot=Fe(J).create({eventBus:ve,mediaPlayerModel:Mt,dashMetrics:De,manifestModel:Ue,playbackController:et,streamController:Ne,protectionController:Ge,baseURLController:de,errHandler:Te,events:re.default,constants:f.default,debug:Ae,initSegmentType:_e.HTTPRequest.INIT_SEGMENT_TYPE,BASE64:he,ISOBoxer:se,settings:me}))}}function Fa(){if(!Le)throw ue;if(dt)return dt;var Fe=dashjs.OfflineController;if(typeof Fe=="function"){re.default.extend(Fe.events),ie.default.extend(Fe.events,{publicOnly:!0}),K.default.extend(Fe.errors);var vt=_i(),Lt=(0,le.default)(J).create();return Lt.setConfig({manifestModel:Ue,adapter:gt,manifestLoader:vt,errHandler:Te}),dt=Fe(J).create({debug:Ae,manifestUpdater:Lt,baseURLController:de,manifestLoader:vt,manifestModel:Ue,mediaPlayerModel:Mt,abrController:it,playbackController:et,adapter:gt,errHandler:Te,dashMetrics:De,timelineConverter:Ce,segmentBaseController:jt,schemeLoaderFactory:at,eventBus:ve,events:re.default,errors:K.default,constants:f.default,settings:me,dashConstants:d.default,urlUtils:(0,te.default)(J).getInstance()}),dt}return null}function wa(Fe){var vt=Ne&&Ne.hasVideoTrack()?f.default.VIDEO:f.default.AUDIO,Lt=De.getCurrentDVRInfo(vt),Qt,rr;return Lt?(Qt=Lt.manifestInfo.availableFrom.getTime()/1e3,rr=Fe+(Qt+Lt.range.start),rr):0}function pi(){var Fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:NaN;dt&&dt.resetRecords(),!Se&&ke&&(Se=!0,Be.info("Streaming Initialized"),Kl(),typeof ke=="string"?Ne.load(ke,Fe):Ne.loadWithManifest(ke,Fe)),!Me&&we()&&(Me=!0,Be.info("Playback Initialized"))}return be={initialize:Ve,setConfig:pe,on:ze,off:_t,extend:wl,attachView:Zr,attachSource:Ei,isReady:we,preload:Dt,play:Zt,isPaused:Je,pause:Wt,isSeeking:Pe,isDynamic:Ke,getLowLatencyModeEnabled:ye,seek:St,seekToOriginalLive:At,setPlaybackRate:He,getPlaybackRate:lt,setMute:Rt,isMuted:Ct,setVolume:Kt,getVolume:Ht,time:_r,duration:$r,timeAsUTC:an,durationAsUTC:mn,getActiveStream:wn,getDVRWindowSize:sr,getDVRSeekOffset:Dr,getTargetLiveDelay:Nr,convertToTimeCode:Fl,formatUTC:Nl,getVersion:Nt,getDebug:It,getBufferLength:Ut,getTTMLRenderingDiv:sl,getVideoElement:ur,getSource:Ml,updateSource:Ol,getCurrentLiveLatency:hi,getTopBitrateInfoFor:Ir,setAutoPlay:Fr,getAutoPlay:di,getDashMetrics:wt,getQualityFor:Xr,setQualityFor:Qr,updatePortalSize:bn,enableText:Vt,enableForcedTextStreaming:Yt,isTextEnabled:Er,setTextTrack:nr,getBitrateInfoListFor:ul,getStreamsFromManifest:fl,getTracksFor:xa,getTracksForTypeFromManifest:cl,getCurrentTrackFor:dl,setInitialMediaSettingsFor:hl,getInitialMediaSettingsFor:gl,setCurrentTrack:ml,addABRCustomRule:En,removeABRCustomRule:xn,removeAllABRCustomRule:gi,getABRCustomRules:mi,getAverageThroughput:Oe,retrieveManifest:Pl,addUTCTimingSource:Nn,removeUTCTimingSource:sn,clearDefaultUTCTimingSources:Fn,restoreDefaultUTCTimingSources:Jr,setXHRWithCredentialsForType:rt,getXHRWithCredentialsForType:pt,getProtectionController:Rl,attachProtectionController:Dl,setProtectionData:Il,registerLicenseRequestFilter:Tl,registerLicenseResponseFilter:yl,unregisterLicenseRequestFilter:Al,unregisterLicenseResponseFilter:Sl,registerCustomCapabilitiesFilter:El,unregisterCustomCapabilitiesFilter:_l,setCustomInitialTrackSelectionFunction:vl,resetCustomInitialTrackSelectionFunction:pl,attachTTMLRenderingDiv:ol,attachVttRenderingDiv:ll,getCurrentTextTrackIndex:Cr,provideThumbnail:Cl,getDashAdapter:Bl,getOfflineController:bt,triggerSteeringRequest:Ul,getCurrentSteeringResponseData:kl,getSettings:Ll,updateSettings:bl,resetSettings:xl,reset:ft,destroy:Ie},Gt(),be}W.__dashjs_factory_name="MediaPlayer";var H=ee.default.getClassFactory(W);H.events=ie.default,H.errors=K.default,ee.default.updateClassFactory(W.__dashjs_factory_name,H);const U=H},"./src/streaming/MediaPlayerEvents.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/core/events/EventsBase.js");function l(T){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(M){return typeof M}:l=function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},l(T)}function f(T,m){if(!(T instanceof m))throw new TypeError("Cannot call a class as a function")}function d(T,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(m&&m.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),m&&_(T,m)}function _(T,m){return _=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},_(T,m)}function E(T){var m=O();return function(){var p=P(T),C;if(m){var I=P(this).constructor;C=Reflect.construct(p,arguments,I)}else C=p.apply(this,arguments);return c(this,C)}}function c(T,m){return m&&(l(m)==="object"||typeof m=="function")?m:y(T)}function y(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(T){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},P(T)}var b=function(T){d(M,T);var m=E(M);function M(){var p;return f(this,M),p=m.call(this),p.AST_IN_FUTURE="astInFuture",p.BUFFER_EMPTY="bufferStalled",p.BUFFER_LOADED="bufferLoaded",p.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",p.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",p.DYNAMIC_TO_STATIC="dynamicToStatic",p.ERROR="error",p.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",p.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",p.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",p.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",p.LOG="log",p.MANIFEST_LOADED="manifestLoaded",p.METRICS_CHANGED="metricsChanged",p.METRIC_CHANGED="metricChanged",p.METRIC_ADDED="metricAdded",p.METRIC_UPDATED="metricUpdated",p.PERIOD_SWITCH_STARTED="periodSwitchStarted",p.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",p.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",p.QUALITY_CHANGE_RENDERED="qualityChangeRendered",p.TRACK_CHANGE_RENDERED="trackChangeRendered",p.STREAM_INITIALIZING="streamInitializing",p.STREAM_UPDATED="streamUpdated",p.STREAM_ACTIVATED="streamActivated",p.STREAM_DEACTIVATED="streamDeactivated",p.STREAM_INITIALIZED="streamInitialized",p.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",p.TEXT_TRACKS_ADDED="allTextTracksAdded",p.TEXT_TRACK_ADDED="textTrackAdded",p.TTML_PARSED="ttmlParsed",p.TTML_TO_PARSE="ttmlToParse",p.CAPTION_RENDERED="captionRendered",p.CAPTION_CONTAINER_RESIZE="captionContainerResize",p.CAN_PLAY="canPlay",p.CAN_PLAY_THROUGH="canPlayThrough",p.PLAYBACK_ENDED="playbackEnded",p.PLAYBACK_ERROR="playbackError",p.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",p.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",p.PLAYBACK_LOADED_DATA="playbackLoadedData",p.PLAYBACK_PAUSED="playbackPaused",p.PLAYBACK_PLAYING="playbackPlaying",p.PLAYBACK_PROGRESS="playbackProgress",p.PLAYBACK_RATE_CHANGED="playbackRateChanged",p.PLAYBACK_SEEKED="playbackSeeked",p.PLAYBACK_SEEKING="playbackSeeking",p.PLAYBACK_STALLED="playbackStalled",p.PLAYBACK_STARTED="playbackStarted",p.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",p.PLAYBACK_VOLUME_CHANGED="playbackVolumeChanged",p.PLAYBACK_WAITING="playbackWaiting",p.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",p.EVENT_MODE_ON_START="eventModeOnStart",p.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",p.CONFORMANCE_VIOLATION="conformanceViolation",p.REPRESENTATION_SWITCH="representationSwitch",p.ADAPTATION_SET_REMOVED_NO_CAPABILITIES="adaptationSetRemovedNoCapabilities",p.CONTENT_STEERING_REQUEST_COMPLETED="contentSteeringRequestCompleted",p}return M}(u.default),L=new b;const R=L},"./src/streaming/MediaPlayerFactory.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>y});var u=r("./src/streaming/MediaPlayer.js");function l(){var O="application/dash+xml",P;function b(T,m,M){if(!T||!/^VIDEO$/i.test(T.nodeName))return null;if(T._dashjs_player)return T._dashjs_player;var p,C=T.id||T.name||"video element";if(m=m||[].slice.call(T.querySelectorAll("source")).filter(function(I){return I.type==O})[0],!m&&T.src)m=document.createElement("source"),m.src=T.src;else if(!m&&!T.src)return null;return M=M||{},p=(0,u.default)(M).create(),p.initialize(T,m.src,T.autoplay),P||(P=p.getDebug().getLogger()),P.debug("Converted "+C+" to dash.js player and added content: "+m.src),T._dashjs_player=p,p}function L(T,m){var M=[];T=T||"[data-dashjs-player]",m=m||document;for(var p=m.querySelectorAll(T),C=0;C<p.length;C++){var I=b(p[C],null);M.push(I)}for(var A=m.querySelectorAll('source[type="'+O+'"]'),S=0;S<A.length;S++){var x=R(A[S]),F=b(x,null);M.push(F)}return M}function R(T){return/^VIDEO$/i.test(T.nodeName)?T:R(T.parentNode)}return{create:b,createAll:L}}var f=l(),d;function _(){window.removeEventListener("load",_),f.createAll()}function E(){window.dashjs&&(window.clearInterval(d),f.createAll())}var c=typeof window<"u"&&window&&window.dashjs&&window.dashjs.skipAutoCreate;!c&&typeof window<"u"&&window&&window.addEventListener&&(window.document.readyState==="complete"?window.dashjs?f.createAll():d=window.setInterval(E,500):window.addEventListener("load",_));const y=f},"./src/streaming/PreBufferSink.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/Debug.js"),l=r("./src/core/FactoryMaker.js");function f(E){var c=this.context,y,O,P,b=[],L=E;function R(){O=(0,u.default)(c).getInstance().getLogger(y)}function T(){b=[],P=null,L=null}function m(k){return k.segmentType!=="InitializationSegment"?(b.push(k),b.sort(function(j,V){return j.start-V.start}),P=null):P=k,O.debug("PreBufferSink appended chunk s: "+k.start+"; e: "+k.end),L&&L({chunk:k}),Promise.resolve()}function M(k,j){return b=b.filter(function(V){return!((isNaN(j)||V.start<j)&&(isNaN(k)||V.end>k))}),Promise.resolve()}function p(){return Promise.resolve()}function C(){for(var k=[],j=0;j<b.length;j++){var V=b[j];k.length===0||V.start>k[k.length-1].end?k.push({start:V.start,end:V.end}):k[k.length-1].end=V.end}var Q={start:function(K){return k[K].start},end:function(K){return k[K].end}};return Object.defineProperty(Q,"length",{get:function(){return k.length}}),Q}function I(){return Promise.resolve()}function A(){return this}function S(k,j){var V=x(k,j);return P&&(V.push(P),P=null),M(k,j),V}function x(k,j){return b.filter(function(V){return(isNaN(j)||V.start<j)&&(isNaN(k)||V.end>k)})}function F(k){k()}return y={getAllBufferRanges:C,append:m,remove:M,abort:p,discharge:S,reset:T,updateTimestampOffset:I,waitForUpdateEnd:F,getBuffer:A},R(),y}f.__dashjs_factory_name="PreBufferSink";var d=l.default.getClassFactory(f);const _=d},"./src/streaming/SourceBufferSink.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>T});var u=r("./src/core/Debug.js"),l=r("./src/streaming/vo/DashJSError.js"),f=r("./src/core/FactoryMaker.js"),d=r("./src/core/errors/Errors.js"),_=r("./src/core/Settings.js"),E=r("./src/streaming/constants/Constants.js"),c=r("./src/streaming/vo/metrics/HTTPRequest.js"),y=r("./src/core/events/Events.js"),O=.1,P=.01,b=50;function L(m){var M=this.context,p=(0,_.default)(M).getInstance(),C=m.textController,I=m.eventBus,A,S,x,F,k,j,V=[],Q=[],$=!1,K=m.mediaSource,Y=null;function re(){x=(0,u.default)(M).getInstance().getLogger(A)}function ie(z,fe,ue){k=z,S=k.type;var J=k.codec;ne(ue),X();var ve=[];return ve.push(te()),ve.push(_e(k.streamInfo)),ve.push(ee(J)),fe&&fe.MSETimeOffset!==void 0&&ve.push(he(fe.MSETimeOffset)),Promise.all(ve)}function ee(z){return new Promise(function(fe){G(function(){F.changeType&&F.changeType(z),fe()})})}function ne(z){F=z.getBuffer()}function ae(z,fe,ue){k=fe,S=k.type;var J=k.codec;try{if(J.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))return ce(z);F=K.addSourceBuffer(J),X();var ve=[];return ve.push(_e(k.streamInfo)),ue&&ue.MSETimeOffset!==void 0&&ve.push(he(ue.MSETimeOffset)),Promise.all(ve)}catch(me){return k.type==E.default.TEXT&&!k.isFragmented||J.indexOf('codecs="stpp')!==-1||J.indexOf('codecs="vtt')!==-1?ce(z):Promise.reject(me)}}function ce(z){return F=C.getTextSourceBuffer(z),Promise.resolve()}function X(){if(typeof F.addEventListener=="function")try{F.addEventListener("updateend",H,!1),F.addEventListener("error",U,!1),F.addEventListener("abort",U,!1)}catch{j=setInterval(H,b)}else j=setInterval(H,b)}function oe(){return S}function ge(){try{typeof F.removeEventListener=="function"&&(F.removeEventListener("updateend",H,!1),F.removeEventListener("error",U,!1),F.removeEventListener("abort",U,!1)),clearInterval(j)}catch(z){x.error(z)}}function _e(z){return new Promise(function(fe){if(!F||!p.get().streaming.buffer.useAppendWindow){fe();return}G(function(){try{if(!F){fe();return}var ue=K.duration,J=0;z&&!isNaN(z.start)&&!isNaN(z.duration)&&isFinite(z.duration)&&(ue=z.start+z.duration),z&&!isNaN(z.start)&&(J=z.start),(F.appendWindowEnd!==ue||F.appendWindowStart!==J)&&(F.appendWindowStart=0,F.appendWindowEnd=ue+P,F.appendWindowStart=Math.max(J-O,0),x.debug("Updated append window for ".concat(k.type,". Set start to ").concat(F.appendWindowStart," and end to ").concat(F.appendWindowEnd))),fe()}catch{x.warn("Failed to set append window"),fe()}})})}function he(z){return new Promise(function(fe){if(!F){fe();return}G(function(){try{F.timestampOffset!==z&&!isNaN(z)&&(F.timestampOffset=z,x.debug("Set MSE timestamp offset to ".concat(z))),fe()}catch{fe()}})})}function se(){if(F){try{V=[],ge(),$=!1,Q=[],(!F.getClassName||F.getClassName()!=="TextSourceBuffer")&&(x.debug("Removing sourcebuffer from media source"),K.removeSourceBuffer(F))}catch{}F=null}Y=null}function Z(){return F}function q(){try{return F.buffered}catch(z){return x.error("getAllBufferRanges exception: "+z.message),null}}function le(z){var fe=this,ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return new Promise(function(J,ve){if(!z){ve({chunk:z,error:new l.default(d.default.APPEND_ERROR_CODE,d.default.APPEND_ERROR_MESSAGE)});return}Q.push({data:z,promise:{resolve:J,reject:ve},request:ue}),G(D.bind(fe))})}function te(){return new Promise(function(z){G(function(){var fe=F.appendWindowStart,ue=F.appendWindowEnd;F&&(F.abort(),F.appendWindowStart=fe,F.appendWindowEnd=ue),z()})})}function N(z){return new Promise(function(fe,ue){var J=z.start,ve=z.end;if(!(J>=0&&ve>J)){fe();return}G(function(){try{F.remove(J,ve),G(function(){fe({from:J,to:ve,unintended:!1}),z.resolve&&z.resolve()})}catch(me){ue({from:J,to:ve,unintended:!1,error:new l.default(d.default.REMOVE_ERROR_CODE,d.default.REMOVE_ERROR_MESSAGE)}),z.reject&&z.reject(me)}})})}function D(){if(!$&&Q.length>0){$=!0;var z=Q[0];Q.splice(0,1);var fe=function(){$=!1,Q.length>0&&D.call(this),z&&z.data&&z.data.segmentType&&z.data.segmentType!==c.HTTPRequest.INIT_SEGMENT_TYPE&&delete z.data.bytes,z.promise.resolve({chunk:z.data})};try{Y=z.request,z.data.bytes.byteLength===0?fe.call(this):(F.appendBuffer?F.appendBuffer(z.data.bytes):F.append(z.data.bytes,z.data),G(fe.bind(this)))}catch(ue){x.fatal('SourceBuffer append failed "'+ue+'"'),Q.length>0?D():$=!1,delete z.data.bytes,z.promise.reject({chunk:z.data,error:new l.default(ue.code,ue.message)})}}}function w(){return new Promise(function(z){try{Q=[],K.readyState==="open"?G(function(){try{F&&F.abort(),z()}catch{z()}}):(F&&F.setTextTrack&&K.readyState==="ended"&&F.abort(),z())}catch{z()}})}function W(){if(V.length>0&&!F.updating){var z=V.shift();z(),W()}}function H(){F.updating||W()}function U(z){var fe=z.target||{};B(y.default.SOURCE_BUFFER_ERROR,{error:fe,lastRequestAppended:Y})}function B(z,fe){var ue=fe||{};I.trigger(z,ue,{streamId:k.streamInfo.id,mediaType:S})}function G(z){V.push(z),F.updating||W()}return A={getType:oe,getAllBufferRanges:q,getBuffer:Z,append:le,remove:N,abort:w,reset:se,updateTimestampOffset:he,initializeForStreamSwitch:ie,initializeForFirstUse:ae,updateAppendWindow:_e,changeType:ee},re(),A}L.__dashjs_factory_name="SourceBufferSink";var R=f.default.getClassFactory(L);const T=R},"./src/streaming/Stream.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>p});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/dash/constants/DashConstants.js"),f=r("./src/streaming/StreamProcessor.js"),d=r("./src/streaming/controllers/FragmentController.js"),_=r("./src/streaming/thumbnail/ThumbnailController.js"),E=r("./src/core/EventBus.js"),c=r("./src/core/events/Events.js"),y=r("./src/core/Debug.js"),O=r("./src/core/errors/Errors.js"),P=r("./src/core/FactoryMaker.js"),b=r("./src/streaming/vo/DashJSError.js"),L=r("./src/streaming/utils/BoxParser.js"),R=r("./src/streaming/utils/URLUtils.js"),T=r("./src/streaming/controllers/BlacklistController.js"),m=[u.default.VIDEO,u.default.AUDIO,u.default.TEXT,u.default.MUXED,u.default.IMAGE];function M(C){C=C||{};var I=this.context,A=(0,E.default)(I).getInstance(),S=(0,R.default)(I).getInstance(),x=C.manifestModel,F=C.mediaPlayerModel,k=C.dashMetrics,j=C.manifestUpdater,V=C.adapter,Q=C.timelineConverter,$=C.capabilities,K=C.errHandler,Y=C.abrController,re=C.playbackController,ie=C.eventController,ee=C.mediaController,ne=C.protectionController,ae=C.textController,ce=C.videoModel,X=C.streamInfo,oe=C.settings,ge,_e,he,se,Z,q,le,te,N,D,w,W,H,U,B,G,z,fe;function ue(){try{G=(0,y.default)(I).getInstance(),_e=G.getLogger(ge),dt(),B=(0,L.default)(I).getInstance(),H=(0,T.default)(I).create({updateEventName:c.default.SEGMENT_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:c.default.SEGMENT_LOCATION_BLACKLIST_ADD}),w=(0,d.default)(I).create({streamInfo:X,mediaPlayerModel:F,dashMetrics:k,errHandler:K,settings:oe,boxParser:B,dashConstants:l.default,urlUtils:S})}catch(Je){throw Je}}function J(){ve(),Ae(),ae.initializeForStream(X),A.trigger(c.default.STREAM_UPDATED,{streamInfo:X})}function ve(){A.on(c.default.BUFFERING_COMPLETED,ct,ge),A.on(c.default.DATA_UPDATE_COMPLETED,Tt,ge),A.on(c.default.INBAND_EVENTS,Ot,ge)}function me(){A.off(c.default.DATA_UPDATE_COMPLETED,Tt,ge),A.off(c.default.BUFFERING_COMPLETED,ct,ge),A.off(c.default.INBAND_EVENTS,Ot,ge)}function Ae(){ne&&(A.on(c.default.KEY_ERROR,yt,ge),A.on(c.default.SERVER_CERTIFICATE_UPDATED,yt,ge),A.on(c.default.LICENSE_REQUEST_COMPLETE,yt,ge),A.on(c.default.KEY_SYSTEM_SELECTED,yt,ge),A.on(c.default.KEY_SESSION_CREATED,yt,ge),A.on(c.default.KEY_STATUSES_CHANGED,yt,ge))}function be(){ne&&(A.off(c.default.KEY_ERROR,yt,ge),A.off(c.default.SERVER_CERTIFICATE_UPDATED,yt,ge),A.off(c.default.LICENSE_REQUEST_COMPLETE,yt,ge),A.off(c.default.KEY_SYSTEM_SELECTED,yt,ge),A.off(c.default.KEY_SESSION_CREATED,yt,ge),A.off(c.default.KEY_STATUSES_CHANGED,yt,ge))}function Be(){return X?X.id:null}function ke(Je,St){return new Promise(function(At,Pe){if(Z){At(St);return}if(Dt()){Z=!0,A.trigger(c.default.STREAM_ACTIVATED,{streamInfo:X}),At(St);return}Le(Je,St).then(function(Ke){Z=!0,A.trigger(c.default.STREAM_ACTIVATED,{streamInfo:X}),At(Ke)}).catch(function(Ke){Pe(Ke)})})}function Ye(Je,St){return new Promise(function(At,Pe){if(Dt()){Pe();return}_e.info("[startPreloading] Preloading next stream with id ".concat(Re())),It(!0),Se(Je,St).then(function(){for(var Ke=0;Ke<he.length&&he[Ke];Ke++)he[Ke].setExplicitBufferingTime(de()),he[Ke].getScheduleController().startScheduleTimer();At()}).catch(function(){It(!1),Pe()})})}function Le(Je,St){return Se(Je,St)}function Se(Je,St){return new Promise(function(At,Pe){et(),D=!0,Ue();var Ke=ce.getElement();m.forEach(function(ye){!(ye===u.default.TEXT&&!Je)&&(ye!==u.default.VIDEO||!Ke||Ke&&/^VIDEO$/i.test(Ke.nodeName))&&qe(ye,Je)}),Ce(St).then(function(ye){if(D=!1,he.length===0){var He="No streams to play.";K.error(new b.default(O.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,He,x.getValue())),_e.fatal(He)}else Ze();Je&&ae.createTracks(X),At(ye)}).catch(function(ye){Pe(ye)})})}function Me(Je){return new Promise(function(St,At){qe(u.default.TEXT,Je),je().then(function(){ae.createTracks(X),St()}).catch(function(Pe){At(Pe)})})}function qe(Je,St){var At=V.getAllMediaInfoForType(X,Je),Pe=[],Ke=null,ye;if(!At||At.length===0){_e.info("No "+Je+" data.");return}Je===u.default.VIDEO&&(le=!0),Je===u.default.AUDIO&&(te=!0);for(var He=0,lt=At.length;He<lt;He++)Ke=At[He],Je===u.default.TEXT&&Ke.isEmbedded&&(ae.addEmbeddedTrack(X,Ke),Pe.push(Ke)),it(Ke)&&ee.addTrack(Ke);if(Pe.length>0&&(ee.setInitialMediaSettingsForType(Je,X),ae.addMediaInfosToBuffer(X,Je,Pe)),At=At.filter(function(Ct){return!Ct.isEmbedded}),At.length!==0){if(Je===u.default.IMAGE){W=(0,_.default)(I).create({streamInfo:X,adapter:V,baseURLController:C.baseURLController,timelineConverter:C.timelineConverter,debug:G,eventBus:A,events:c.default,dashConstants:l.default,dashMetrics:C.dashMetrics,segmentBaseController:C.segmentBaseController}),W.initialize();return}A.trigger(c.default.STREAM_INITIALIZING,{streamInfo:X,mediaInfo:Ke}),ee.setInitialMediaSettingsForType(Je,X);var Rt=at(At,St);ye=ee.getCurrentTrackFor(Je,X.id),ye&&(Y.updateTopQualityIndex(ye),Rt.selectMediaInfo(Je!==u.default.TEXT||!ye.isEmbedded?ye:At[0]))}}function it(Je){var St=Je?Je.type:null,At;return St===u.default.MUXED?(At="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",_e.fatal(At),K.error(new b.default(O.default.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,At,x.getValue())),!1):St===u.default.TEXT||St===u.default.IMAGE?!0:Je.contentProtection&&!$.supportsEncryptedMedia()?(K.error(new b.default(O.default.CAPABILITY_MEDIAKEYS_ERROR_CODE,O.default.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE)),!1):!0}function at(Je,St){var At=Je&&Je.length>0?Je[0]:null,Pe=w.getModel(At?At.type:null),Ke=At?At.type:null,ye=At?At.mimeType:null,He=At?At.isFragmented:null,lt=(0,f.default)(I).create({streamInfo:X,type:Ke,mimeType:ye,timelineConverter:Q,adapter:V,manifestModel:x,mediaPlayerModel:F,fragmentModel:Pe,dashMetrics:C.dashMetrics,baseURLController:C.baseURLController,segmentBaseController:C.segmentBaseController,abrController:Y,playbackController:re,mediaController:ee,textController:ae,errHandler:K,settings:oe,boxParser:B,segmentBlacklistController:H});lt.initialize(St,le,He),he.push(lt);for(var Rt=0;Rt<Je.length;Rt++)lt.addMediaInfo(Je[Rt]);return Ke===u.default.TEXT&&ae.addMediaInfosToBuffer(X,Ke,Je,Pe),lt}function Ce(Je){return new Promise(function(St){var At={},Pe=he.map(function(Ke){return Ke.createBufferSinks(Je)});Promise.all(Pe).then(function(Ke){Ke.forEach(function(ye){ye&&(At[ye.getType()]=ye)}),St(At)}).catch(function(){St(At)})})}function je(){var Je=Gt(u.default.TEXT);return Je?Je.createBufferSinks():Promise.resolve()}function Ge(Je){for(var St=he?he.length:0,At=!1,Pe=0;Pe<St;Pe++){var Ke=he[Pe].getFragmentModel();Ke.abortRequests(),Ke.resetInitialSettings(),he[Pe].reset(At,Je)}ae&&ae.deactivateStream(X),he=[],Z=!1,q=!1,It(!1),Te(!1),A.trigger(c.default.STREAM_DEACTIVATED,{streamInfo:X})}function tt(){return Z}function ot(Je){return new Promise(function(St,At){for(var Pe=[],Ke=0;Ke<he.length;)it(he[Ke].getMediaInfo())?(Pe.push(he[Ke].setMediaSource(Je)),Ke++):(he[Ke].reset(),he.splice(Ke,1));Promise.all(Pe).then(function(){for(var ye=0;ye<he.length;ye++)he[ye].dischargePreBuffer();if(he.length===0){var He="No streams to play.";K.error(new b.default(O.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,He+"nostreams",x.getValue())),_e.fatal(He)}St()}).catch(function(ye){_e.error(ye),At(ye)})})}function dt(Je){Ge(Je),se=!1,le=!1,te=!1,N={},D=!1,z=!1,fe=[]}function gt(Je){w&&(w.reset(),w=null),Y&&X&&Y.clearDataForStream(X.id),H&&(H.reset(),H=null),dt(Je),X=null,me(),be()}function Mt(){return X?X.duration:NaN}function $e(){return z}function Te(Je){z=Je}function de(){return X?X.start:NaN}function Re(){return X?X.id:null}function xe(){return X}function Ne(){return te}function Xe(){return le}function nt(){return W}function et(){if(!ce||!Y)throw new Error(u.default.MISSING_CONFIG_ERROR)}function ht(Je){if(et(),Je===u.default.IMAGE)return W?W.getBitrateList():[];var St=Et(Je);return Y.getBitrateList(St)}function yt(Je){Je.error&&(K.error(Je.error),_e.fatal(Je.error.message))}function Pt(Je){if(!(!Z||!X)){q=!1;var St=Je.newMediaInfo,At=x.getValue();V.setCurrentMediaInfo(X.id,St.type,St);var Pe=jt(St);if(Pe){var Ke=re.getTime();_e.info("Stream -  Process track changed at current time "+Ke),At.refreshManifestOnSwitchTrack?(fe.push(Je),j.getIsUpdating()||(_e.debug("Stream -  Refreshing manifest for switch track"),j.refreshManifest())):Pe.selectMediaInfo(St).then(function(){(St.type===u.default.VIDEO||St.type===u.default.AUDIO)&&Y.updateTopQualityIndex(St),Pe.prepareTrackSwitch()})}}}function De(Je){var St=Gt(Je.mediaType);St&&St.prepareQualityChange(Je)}function Ue(){if(ie){var Je=V.getEventsFor(X);Je&&Je.length>0&&ie.addInlineEvents(Je,X.id)}}function Ze(){for(var Je=he.length,St=!!N.audio||!!N.video,At=St?new b.default(O.default.DATA_UPDATE_FAILED_ERROR_CODE,O.default.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,Pe=0;Pe<Je;Pe++)if(he[Pe].isUpdating()||D)return;if(ne){ne.clearMediaInfoArray();for(var Ke=0;Ke<Je&&he[Ke];Ke++){var ye=he[Ke].getType(),He=he[Ke].getMediaInfo();if(ye===u.default.AUDIO||ye===u.default.VIDEO||ye===u.default.TEXT&&He.isFragmented){var lt=he[Ke].getMediaInfo();lt&&ne.initializeForMedia(lt)}}ne.handleKeySystemFromManifest()}At?K.error(At):se||(se=!0,ce.waitForReadyState(u.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,function(){A.trigger(c.default.STREAM_INITIALIZED,{streamInfo:X})}))}function Et(Je){for(var St=null,At=0;At<he.length;At++)if(St=he[At],St.getType()===Je)return St.getMediaInfo();return null}function ct(){var Je=pe(),St=Je.length;if(St===0){_e.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined");return}for(var At=0;At<St;At++)if(!Je[At].isBufferingCompleted()&&(Je[At].getType()===u.default.AUDIO||Je[At].getType()===u.default.VIDEO)){_e.debug("onBufferingCompleted - One streamProcessor has finished but",Je[At].getType(),"one is not buffering completed");return}_e.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),q=!0,A.trigger(c.default.STREAM_BUFFERING_COMPLETED,{streamInfo:X},{streamInfo:X})}function Tt(Je){N[Je.mediaType]=Je.error,Ze()}function Ot(Je){ie&&ie.addInbandEvents(Je.events,X.id)}function jt(Je){return!Je||!Je.type?null:Gt(Je.type)}function Gt(Je){if(!Je)return null;var St=pe();return St.filter(function(At){return At.getType()===Je})[0]}function pe(){for(var Je=[],St,At,Pe=0;Pe<he.length;Pe++)At=he[Pe],St=At.getType(),(St===u.default.AUDIO||St===u.default.VIDEO||St===u.default.TEXT)&&Je.push(At);return Je}function Ve(){for(var Je=he.length,St=0;St<Je&&he[St];St++)he[St].getScheduleController().startScheduleTimer()}function ft(Je){return new Promise(function(St){D=!0,X=Je,ie&&Ue();for(var At=[],Pe=0,Ke=he.length;Pe<Ke;Pe++){var ye=he[Pe],He=ye.getMediaInfo();At.push(ye.updateStreamInfo(X));var lt=V.getAllMediaInfoForType(X,ye.getType());if(lt=lt.filter(function(Kt){return!Kt.isEmbedded}),lt){ye.clearMediaInfoArray();for(var Rt=0;Rt<lt.length;Rt++){var Ct=lt[Rt];ye.addMediaInfo(lt[Rt]),V.areMediaInfosEqual(He,Ct)&&(Y.updateTopQualityIndex(Ct),At.push(ye.selectMediaInfo(Ct)))}}}Promise.all(At).then(function(){for(At=[];fe.length>0;){var Kt=fe.pop(),Ht=Kt.newMediaInfo,Ut=jt(Kt.oldMediaInfo);if(!Ut)return;At.push(Ut.prepareTrackSwitch()),Ut.selectMediaInfo(Ht)}return Promise.all(At)}).then(function(){D=!1,Ze(),A.trigger(c.default.STREAM_UPDATED,{streamInfo:X}),St()})})}function Ie(Je){var St=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return Nt(Je,u.default.VIDEO,St)&&Nt(Je,u.default.AUDIO,St)}function we(Je){return Je?ze(u.default.VIDEO,Je)&&ze(u.default.AUDIO,Je):!0}function ze(Je,St){var At=xe(),Pe=St.getStreamInfo();if(!Pe||!At)return!0;var Ke=V.getAdaptationForType(Pe.index,Je,Pe),ye=V.getAdaptationForType(At.index,Je,At);return!Ke||!ye?!Ke&&!ye:!(!_t(ye)&&_t(Ke))}function _t(Je){return Je?!!(Je.ContentProtection||Je.Representation&&Je.Representation.length>0&&Je.Representation[0].ContentProtection):!1}function Nt(Je,St){var At=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!Je||!Je.hasOwnProperty("getStreamInfo"))return!1;var Pe=Je.getStreamInfo(),Ke=At?At.getStreamInfo():xe();if(!Pe||!Ke)return!1;var ye=V.getAdaptationForType(Pe.index,St,Pe),He=V.getAdaptationForType(Ke.index,St,Ke);if(!ye||!He)return!ye&&!He;var lt=ye&&He&&ye.mimeType===He.mimeType,Rt=He.Representation_asArray.map(function(Ut){return Ut.codecs}),Ct=ye.Representation_asArray.map(function(Ut){return Ut.codecs}),Kt=Ct.some(function(Ut){return Rt.indexOf(Ut)>-1}),Ht=Ct.some(function(Ut){return Rt.some(function(sr){return $.codecRootCompatibleWithCodec(sr,Ut)})});return Kt||Ht&&lt}function It(Je){U=Je}function Dt(){return U}function Zt(){return q}function Wt(){return V}return ge={initialize:J,getStreamId:Be,activate:ke,deactivate:Ge,getIsActive:tt,getDuration:Mt,getStartTime:de,getId:Re,getStreamInfo:xe,getHasAudioTrack:Ne,getHasVideoTrack:Xe,startPreloading:Ye,initializeForTextWithMediaSource:Me,getThumbnailController:nt,getBitrateListFor:ht,updateData:ft,reset:gt,getProcessors:pe,setMediaSource:ot,isMediaCodecCompatible:Ie,isProtectionCompatible:we,getPreloaded:Dt,getIsEndedEventSignaled:$e,setIsEndedEventSignaled:Te,getAdapter:Wt,getHasFinishedBuffering:Zt,setPreloaded:It,startScheduleControllers:Ve,prepareTrackChange:Pt,prepareQualityChange:De},ue(),ge}M.__dashjs_factory_name="Stream";const p=P.default.getClassFactory(M)},"./src/streaming/StreamProcessor.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>k});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/dash/constants/DashConstants.js"),f=r("./src/streaming/constants/MetricsConstants.js"),d=r("./src/streaming/models/FragmentModel.js"),_=r("./src/streaming/controllers/BufferController.js"),E=r("./src/streaming/text/NotFragmentedTextBufferController.js"),c=r("./src/streaming/controllers/ScheduleController.js"),y=r("./src/dash/controllers/RepresentationController.js"),O=r("./src/core/FactoryMaker.js"),P=r("./src/streaming/utils/SupervisorTools.js"),b=r("./src/core/EventBus.js"),L=r("./src/core/events/Events.js"),R=r("./src/dash/DashHandler.js"),T=r("./src/core/errors/Errors.js"),m=r("./src/streaming/vo/DashJSError.js"),M=r("./src/core/Debug.js"),p=r("./src/streaming/utils/RequestModifier.js"),C=r("./src/streaming/utils/URLUtils.js"),I=r("./src/streaming/utils/BoxParser.js"),A=r("./src/streaming/vo/metrics/PlayList.js"),S=r("./src/dash/controllers/SegmentsController.js"),x=r("./src/streaming/vo/metrics/HTTPRequest.js");function F(j){j=j||{};var V=this.context,Q=(0,b.default)(V).getInstance(),$=j.streamInfo,K=j.type,Y=j.errHandler,re=j.mimeType,ie=j.timelineConverter,ee=j.adapter,ne=j.manifestModel,ae=j.mediaPlayerModel,ce=j.fragmentModel,X=j.abrController,oe=j.playbackController,ge=j.mediaController,_e=j.textController,he=j.dashMetrics,se=j.settings,Z=j.boxParser,q=j.segmentBlacklistController,le,te,N,D,w,W,H,U,B,G,z,fe,ue;function J(){te=(0,M.default)(V).getInstance().getLogger(le),Be(),Q.on(L.default.DATA_UPDATE_COMPLETED,tt,le,{priority:b.default.EVENT_PRIORITY_HIGH}),Q.on(L.default.INIT_FRAGMENT_NEEDED,Me,le),Q.on(L.default.MEDIA_FRAGMENT_NEEDED,qe,le),Q.on(L.default.INIT_FRAGMENT_LOADED,_t,le),Q.on(L.default.MEDIA_FRAGMENT_LOADED,Nt,le),Q.on(L.default.BUFFER_LEVEL_STATE_CHANGED,ot,le),Q.on(L.default.BUFFER_CLEARED,dt,le),Q.on(L.default.SEEK_TARGET,At,le),Q.on(L.default.FRAGMENT_LOADING_ABANDONED,Re,le),Q.on(L.default.FRAGMENT_LOADING_COMPLETED,xe,le),Q.on(L.default.QUOTA_EXCEEDED,et,le),Q.on(L.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Xe,le),Q.on(L.default.SET_NON_FRAGMENTED_TEXT,nt,le),Q.on(L.default.SOURCE_BUFFER_ERROR,gt,le)}function ve(ye,He,lt){fe=(0,S.default)(V).create({events:L.default,eventBus:Q,streamInfo:$,timelineConverter:ie,dashConstants:l.default,segmentBaseController:j.segmentBaseController,type:K}),z=(0,R.default)(V).create({streamInfo:$,type:K,timelineConverter:ie,dashMetrics:he,mediaPlayerModel:ae,baseURLController:j.baseURLController,errHandler:Y,segmentsController:fe,settings:se,boxParser:Z,events:L.default,eventBus:Q,errors:T.default,debug:(0,M.default)(V).getInstance(),requestModifier:(0,p.default)(V).getInstance(),dashConstants:l.default,constants:u.default,urlUtils:(0,C.default)(V).getInstance()}),N=$.manifestInfo.isDynamic,z.initialize(N),X.registerStreamType(K,le),U=(0,y.default)(V).create({streamInfo:$,type:K,abrController:X,dashMetrics:he,playbackController:oe,timelineConverter:ie,dashConstants:l.default,events:L.default,eventBus:Q,errors:T.default,isDynamic:N,segmentsController:fe}),W=St(K,lt),W&&W.initialize(ye),H=(0,c.default)(V).create({streamInfo:$,type:K,mimeType:re,adapter:ee,dashMetrics:he,mediaPlayerModel:ae,fragmentModel:ce,abrController:X,playbackController:oe,textController:_e,mediaController:ge,bufferController:W,settings:se}),H.initialize(He),ue=0,B=!1}function me(){return $.id}function Ae(){return K}function be(){return ee.getIsTextTrack(U.getData())}function Be(){w=[],D=null,ue=0,B=!1,G=!1}function ke(ye,He){z&&z.reset(),W&&(W.reset(ye,He),W=null),H&&(H.reset(),H=null),U&&(U.reset(),U=null),fe&&(fe=null),X&&X.unRegisterStreamType(me(),K),Q.off(L.default.DATA_UPDATE_COMPLETED,tt,le),Q.off(L.default.INIT_FRAGMENT_NEEDED,Me,le),Q.off(L.default.MEDIA_FRAGMENT_NEEDED,qe,le),Q.off(L.default.INIT_FRAGMENT_LOADED,_t,le),Q.off(L.default.MEDIA_FRAGMENT_LOADED,Nt,le),Q.off(L.default.BUFFER_LEVEL_STATE_CHANGED,ot,le),Q.off(L.default.BUFFER_CLEARED,dt,le),Q.off(L.default.SEEK_TARGET,At,le),Q.off(L.default.FRAGMENT_LOADING_ABANDONED,Re,le),Q.off(L.default.FRAGMENT_LOADING_COMPLETED,xe,le),Q.off(L.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Xe,le),Q.off(L.default.SET_NON_FRAGMENTED_TEXT,nt,le),Q.off(L.default.QUOTA_EXCEEDED,et,le),Q.off(L.default.SOURCE_BUFFER_ERROR,gt,le),Be(),K=null,$=null}function Ye(){return U?U.isUpdating():!1}function Le(ye){return new Promise(function(He){var lt=W.hasBufferAtTime(ye.seekTime);if(lt){W.pruneBuffer(),He();return}H.clearScheduleTimer(),ce.abortRequests(),W.prepareForPlaybackSeek().then(function(){var Rt=W.getAllRangesWithSafetyFactor(ye.seekTime);return W.clearBuffers(Rt)}).then(function(){var Rt=W.getContinuousBufferTimeForTargetTime(ye.seekTime);if(!isNaN(Rt)&&!isNaN($.duration)&&isFinite($.duration)&&Rt>=$.start+$.duration)W.setIsBufferingCompleted(!0),He();else{var Ct=isNaN(Rt)?ye.seekTime:Rt;Pe(Ct),W.setSeekTarget(Ct);var Kt=[];Kt.push(W.updateAppendWindow());var Ht=ft();Kt.push(W.updateBufferTimestampOffset(Ht)),Promise.all(Kt).then(function(){H.setInitSegmentRequired(!0),H.setCheckPlaybackQuality(!1),H.startScheduleTimer(),He()})}}).catch(function(Rt){te.error(Rt)})})}function Se(){return new Promise(function(ye,He){try{H.clearScheduleTimer(),ce.abortRequests(),W.prepareForPlaybackSeek().then(function(){return W.pruneAllSafely()}).then(function(){ye()})}catch(lt){He(lt)}})}function Me(ye){var He=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(ye.sender){if(oe.getIsManifestUpdateInProgress()){Ge();return}if(!(be()&&!_e.isTextEnabled())&&W&&ye.representationId&&!W.appendInitSegmentFromCache(ye.representationId)){var lt=U.getCurrentRepresentation();if(lt.range===0){qe();return}var Rt=z?z.getInitRequest(D,lt):null;Rt?ce.executeRequest(Rt):He&&(H.setInitSegmentRequired(!0),Ge())}}}function qe(ye){var He=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(oe.getIsManifestUpdateInProgress()||W.getIsPruningInProgress()){Ge();return}var lt=je();lt?(B=!1,it(lt)):at(He)}function it(ye){isNaN(ye.startTime+ye.duration)||(ue=ye.startTime+ye.duration),ye.delayLoadingTime=new Date().getTime()+H.getTimeToLoadDelay(),H.setTimeToLoadDelay(0),Ce(ye)?(te.warn("Fragment request url ".concat(ye.url," for stream id ").concat($.id," and media type ").concat(K," is on the ignore list and will be skipped")),Ge()):(te.debug("Next fragment request url for stream id ".concat($.id," and media type ").concat(K," is ").concat(ye.url)),ce.executeRequest(ye))}function at(ye){var He=U.getCurrentRepresentation();if(se.get().streaming.gaps.enableSeekFix&&(B||oe.getTime()===0)){var lt;if(N?N&&He.segmentInfoType===l.default.SEGMENT_TIMELINE&&(lt=z.getValidTimeAheadOfTargetTime(ue,D,He,se.get().streaming.gaps.threshold)):lt=z.getValidTimeAheadOfTargetTime(ue,D,He,se.get().streaming.gaps.threshold),!isNaN(lt)&&lt!==ue){oe.isSeeking()||oe.getTime()===0?(te.warn("Adjusting playback time ".concat(lt," because of gap in the manifest. Seeking by ").concat(lt-ue)),oe.seek(lt,!1,!1)):(te.warn("Adjusting buffering time ".concat(lt," because of gap in the manifest. Adjusting time by ").concat(lt-ue)),Pe(lt),ye&&Ge());return}}var Rt=z.isLastSegmentRequested(He,ue);if(Rt){var Ct=z.getCurrentIndex();te.debug("Segment requesting for stream ".concat($.id," has finished")),Q.trigger(L.default.STREAM_REQUESTING_COMPLETED,{segmentIndex:Ct},{streamId:$.id,mediaType:K}),W.segmentRequestingCompleted(Ct),H.clearScheduleTimer();return}ye&&Ge()}function Ce(ye){var He=ye.url;return ye.range&&(He=He.concat("_",ye.range)),q.contains(He)}function je(){var ye=ft(),He;if(isNaN(ue)||Ae()===u.default.TEXT&&!_e.isTextEnabled())return null;if(z){var lt=U&&ye?U.getRepresentationForQuality(ye.quality):null;B?He=z.getSegmentRequestForTime(D,lt,ue):He=z.getNextSegmentRequest(D,lt)}return He}function Ge(){H.startScheduleTimer(oe.getLowLatencyModeEnabled()?se.get().streaming.scheduling.lowLatencyTimeout:se.get().streaming.scheduling.defaultTimeout)}function tt(ye){ye.error||(H.setCurrentRepresentation(ee.convertRepresentationToRepresentationInfo(ye.currentRepresentation)),W.getIsBufferingCompleted()||W.updateBufferTimestampOffset(ye.currentRepresentation))}function ot(ye){he.addBufferState(K,ye.state,H.getBufferTarget()),ye.state===f.default.BUFFER_EMPTY&&!oe.isSeeking()&&(te.info("Buffer is empty! Stalling!"),he.pushPlayListTraceMetrics(new Date,A.PlayListTrace.REBUFFERING_REASON))}function dt(ye){ce.syncExecutedRequestsWithBufferedRange(W.getBuffer().getAllBufferRanges(),$.duration),ye.quotaExceeded&&ye.from>oe.getTime()&&Pe(ye.from),ye.hasEnoughSpaceToAppend&&ye.quotaExceeded&&H.startScheduleTimer()}function gt(ye){if(!(!ye||!ye.lastRequestAppended||!ye.lastRequestAppended.url)){var He=ye.lastRequestAppended.url;ye.lastRequestAppended.range&&(He=He.concat("_",ye.lastRequestAppended.range)),te.warn("Blacklisting segment with url ".concat(He)),q.add(He)}}function Mt(ye){te.debug("Preparing quality switch for type ".concat(K));var He=ye.newQuality;G=!0,H.clearScheduleTimer();var lt=ft(He);H.setCurrentRepresentation(lt),U.prepareQualityChange(He),ce.abortRequests(),W.updateBufferTimestampOffset(lt).then(function(){ye.reason&&ye.reason.forceReplace?$e():se.get().streaming.buffer.fastSwitchEnabled?Te(lt):de(),he.pushPlayListTraceMetrics(new Date,A.PlayListTrace.REPRESENTATION_SWITCH_STOP_REASON),he.createPlaylistTraceMetrics(lt.id,oe.getTime()*1e3,oe.getPlaybackRate())})}function $e(){Q.trigger(L.default.BUFFER_REPLACEMENT_STARTED,{mediaType:K,streamId:$.id},{mediaType:K,streamId:$.id}),W.prepareForReplacementQualitySwitch().then(function(){Wt(),G=!1}).catch(function(){Wt(),G=!1})}function Te(ye){var He=oe.getTime(),lt=1.5*(isNaN(ye.fragmentDuration)?1:ye.fragmentDuration),Rt=ce.getRequests({state:d.default.FRAGMENT_MODEL_EXECUTED,time:He+lt,threshold:0})[0];if(Rt&&!be()){var Ct=W.getBufferLevel(),Kt=X.getAbandonmentStateFor($.id,K);if(Rt.quality<ye.quality&&Ct>=lt&&Kt!==f.default.ABANDON_LOAD){var Ht=He+lt;Pe(Ht),H.setCheckPlaybackQuality(!1),H.startScheduleTimer()}else de()}else H.startScheduleTimer();G=!1}function de(){Je(),G=!1}function Re(ye){te.info("onFragmentLoadingAbandoned request: "+ye.request.url+" has been aborted"),!oe.isSeeking()&&!H.getSwitchStrack()&&!G&&(te.info("onFragmentLoadingAbandoned request: "+ye.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),ye.request&&ye.request.isInitializationRequest()?H.setInitSegmentRequired(!0):Pe(ye.request.startTime+ye.request.duration/2),H.startScheduleTimer(0))}function xe(ye){te.info("OnFragmentLoadingCompleted for stream id "+$.id+" and media type "+K+" - Url:",ye.request?ye.request.url:"undefined",ye.request.range?", Range:"+ye.request.range:""),be()&&H.startScheduleTimer(0),ye.error&&ye.request.serviceLocation&&Ne(ye)}function Ne(ye){te.info("Fragment loading completed with an error"),!(!ye||!ye.request||!ye.request.type)&&(ye.request.type===x.HTTPRequest.INIT_SEGMENT_TYPE?Me({representationId:ye.request.representationId,sender:{}},!1):ye.request.type===x.HTTPRequest.MEDIA_SEGMENT_TYPE&&(Pe(ye.request.startTime+ye.request.duration/2),qe({},!1)))}function Xe(){Pe(oe.getTime()),Ve().startScheduleTimer()}function nt(ye){var He=ye.currentTrackInfo;if(He){var lt=w.find(function(Rt){return Rt.index===He.index&&Rt.lang===He.lang});lt&&ct(lt).then(function(){W.setIsBufferingCompleted(!1),Pe(oe.getTime()),H.setInitSegmentRequired(!0),H.startScheduleTimer()})}}function et(ye){Pe(ye.quotaExceededTime),H.clearScheduleTimer()}function ht(){return U}function yt(){return W?W.getBuffer():null}function Pt(){return W}function De(){W.dischargePreBuffer()}function Ue(){return ce}function Ze(ye){return $=ye,Ie()?Promise.resolve():W.updateAppendWindow()}function Et(){return $}function ct(ye){ye!==D&&(!ye||!D||ye.type===D.type)&&(D=ye);var He=ee.getRealAdaptation($,D),lt=ee.getVoRepresentations(D);if(U){var Rt=U.getData(),Ct=X.getMaxAllowedIndexFor(K,$.id),Kt=X.getMinAllowedIndexFor(K,$.id),Ht,Ut,sr=null;return(Rt===null||Rt.id!==He.id)&&K!==u.default.TEXT?(Ut=X.getThroughputHistory().getAverageThroughput(K,N),sr=Ut||X.getInitialBitrateFor(K,$.id),Ht=X.getQualityForBitrate(D,sr,$.id)):Ht=X.getQualityFor(K,$.id),Kt!==void 0&&Ht<Kt&&(Ht=Kt),Ht>Ct&&(Ht=Ct),U.updateData(He,lt,K,D.isFragmented,Ht)}else return Promise.resolve()}function Tt(ye){w.indexOf(ye)===-1&&w.push(ye)}function Ot(){w=[]}function jt(){return D}function Gt(){return W.getMediaSource()}function pe(ye){return W.setMediaSource(ye,D)}function Ve(){return H}function ft(ye){var He;return ye!==void 0?((0,P.checkInteger)(ye),He=U?U.getRepresentationForQuality(ye):null):He=U?U.getCurrentRepresentation():null,ee.convertRepresentationToRepresentationInfo(He)}function Ie(){return W?W.getIsBufferingCompleted():!1}function we(){return W?W.getBufferLevel():0}function ze(){var ye=ft(),He=U&&ye?U.getRepresentationForQuality(ye.quality):null;return z.getNextSegmentRequestIdempotent(D,He)}function _t(ye){if(se.get().streaming.enableManifestTimescaleMismatchFix){var He=ye.chunk,lt=He.bytes,Rt=He.quality,Ct=ft(Rt),Kt=U&&Ct?U.getRepresentationForQuality(Ct.quality):null;if(Ct&&Kt){var Ht=Z.getMediaTimescaleFromMoov(lt);Kt.timescale=Ht}}}function Nt(ye){var He=ye.chunk,lt=He.bytes,Rt=He.quality,Ct=ft(Rt),Kt=U&&Ct?U.getRepresentationForQuality(Ct.quality):null;if(Ct&&Kt){var Ht=ee.getEventsFor(Ct.mediaInfo,null,$),Ut=ee.getEventsFor(Ct,Kt,$);if(Ht&&Ht.length>0||Ut&&Ut.length>0){var sr=ce.getRequests({state:d.default.FRAGMENT_MODEL_EXECUTED,quality:Rt,index:He.index})[0],Dr=It(lt,sr,Ht,Ut);Q.trigger(L.default.INBAND_EVENTS,{events:Dr},{streamId:$.id})}}}function It(ye,He,lt,Rt){try{for(var Ct={},Kt=[],Ht=lt.concat(Rt),Ut=0,sr=Ht.length;Ut<sr;Ut++)Ct[Ht[Ut].schemeIdUri+"/"+Ht[Ut].value]=Ht[Ut];var Dr=(0,I.default)(V).getInstance().parse(ye),Nr=Dr.getBoxes("emsg");if(!Nr||Nr.length===0)return Kt;for(var _r=Dr.getBox("sidx"),$r=_r&&!isNaN(_r.earliest_presentation_time)&&!isNaN(_r.timescale)?_r.earliest_presentation_time/_r.timescale:He&&!isNaN(He.mediaStartTime)?He.mediaStartTime:0,an=Math.max($r,0),mn=U.getCurrentRepresentation(),Ir=0,Xr=Nr.length;Ir<Xr;Ir++){var Qr=ee.getEvent(Nr[Ir],Ct,an,mn);Qr&&Kt.push(Qr)}return Kt}catch{return[]}}function Dt(ye){var He=yt();return He?Promise.resolve(He):W?W.createBufferSink(D,ye):Promise.resolve(null)}function Zt(){return new Promise(function(ye){te.debug("Preparing track switch for type ".concat(K));var He=K===u.default.TEXT||se.get().streaming.trackSwitchMode[K]===u.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&oe.getTimeToStreamEnd($)>se.get().streaming.buffer.stallThreshold;if(W.getIsBufferingCompleted()&&!He){W.prepareForNonReplacementTrackSwitch(D.codec).then(function(){Q.trigger(L.default.BUFFERING_COMPLETED,{},{streamId:$.id,mediaType:K})}).catch(function(){Q.trigger(L.default.BUFFERING_COMPLETED,{},{streamId:$.id,mediaType:K})}),ye();return}H.clearScheduleTimer(),H.setSwitchTrack(!0),He?(Q.trigger(L.default.BUFFER_REPLACEMENT_STARTED,{mediaType:K,streamId:$.id},{mediaType:K,streamId:$.id}),ce.abortRequests(),W.prepareForReplacementTrackSwitch(D.codec).then(function(){var lt=ft();return W.updateBufferTimestampOffset(lt)}).then(function(){Wt(),ye()}).catch(function(){Wt(),ye()})):W.prepareForNonReplacementTrackSwitch(D.codec).then(function(){Je(),ye()}).catch(function(){Je(),ye()})})}function Wt(){var ye=oe.getTime();se.get().streaming.buffer.flushBufferAtTrackSwitch&&oe.seek(ye+.001,!1,!0),Pe(ye),W.setSeekTarget(ye),H.startScheduleTimer()}function Je(){var ye=oe.getTime(),He=W.getContinuousBufferTimeForTargetTime(ye),lt=isNaN(He)?ye:He;Pe(lt),H.startScheduleTimer()}function St(ye,He){var lt=null;return ye?(ye===u.default.TEXT&&!He?lt=(0,E.default)(V).create({streamInfo:$,type:ye,mimeType:re,fragmentModel:ce,textController:_e,errHandler:Y,settings:se}):lt=(0,_.default)(V).create({streamInfo:$,type:ye,mediaPlayerModel:ae,manifestModel:ne,fragmentModel:ce,errHandler:Y,mediaController:ge,representationController:U,adapter:ee,textController:_e,abrController:X,playbackController:oe,settings:se}),lt):(Y.error(new m.default(T.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,T.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null)}function At(ye){ye&&!isNaN(ye.time)&&(Pe(ye.time),W.setSeekTarget(ye.time))}function Pe(ye){ue=ye,B=!0}function Ke(ye,He){he.pushPlayListTraceMetrics(ye,He)}return le={initialize:ve,getStreamId:me,getType:Ae,isUpdating:Ye,getBufferController:Pt,dischargePreBuffer:De,getFragmentModel:Ue,getScheduleController:Ve,getRepresentationController:ht,getRepresentationInfo:ft,getBufferLevel:we,isBufferingCompleted:Ie,createBufferSinks:Dt,updateStreamInfo:Ze,getStreamInfo:Et,selectMediaInfo:ct,clearMediaInfoArray:Ot,addMediaInfo:Tt,prepareTrackSwitch:Zt,prepareQualityChange:Mt,getMediaInfo:jt,getMediaSource:Gt,setMediaSource:pe,getBuffer:yt,setExplicitBufferingTime:Pe,finalisePlayList:Ke,probeNextRequest:ze,prepareInnerPeriodPlaybackSeeking:Le,prepareOuterPeriodPlaybackSeeking:Se,reset:ke},J(),le}F.__dashjs_factory_name="StreamProcessor";const k=O.default.getClassFactory(F)},"./src/streaming/XlinkLoader.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>P});var u=r("./src/streaming/vo/DashJSError.js"),l=r("./src/streaming/net/URLLoader.js"),f=r("./src/streaming/vo/metrics/HTTPRequest.js"),d=r("./src/streaming/vo/TextRequest.js"),_=r("./src/core/EventBus.js"),E=r("./src/core/events/Events.js"),c=r("./src/core/FactoryMaker.js"),y=r("./src/core/errors/Errors.js");function O(b){b=b||{};var L="urn:mpeg:dash:resolve-to-zero:2013",R=this.context,T=(0,_.default)(R).getInstance(),m=(0,l.default)(R).create({errHandler:b.errHandler,dashMetrics:b.dashMetrics,mediaPlayerModel:b.mediaPlayerModel,requestModifier:b.requestModifier,errors:y.default}),M;function p(I,A,S){var x=function(j,V){A.resolved=!0,A.resolvedContent=j||null,T.trigger(E.default.XLINK_ELEMENT_LOADED,{element:A,resolveObject:S,error:j||V?null:new u.default(y.default.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,y.default.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+I)})};if(I===L)x(null,!0);else{var F=new d.default(I,f.HTTPRequest.XLINK_EXPANSION_TYPE);m.load({request:F,success:function(j){x(j)},error:function(){x(null)}})}}function C(){m&&(m.abort(),m=null)}return M={load:p,reset:C},M}O.__dashjs_factory_name="XlinkLoader";const P=c.default.getClassFactory(O)},"./src/streaming/constants/ConformanceViolationConstants.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>u});const u={LEVELS:{SUGGESTION:"Suggestion",WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'},INVALID_DVR_WINDOW:{key:"INVALID_DVR_WINDOW",message:"No valid segment found when applying a specification compliant DVR window calculation. Using SegmentTimeline entries as a fallback."}}}},"./src/streaming/constants/Constants.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});function u(c,y){if(!(c instanceof y))throw new TypeError("Cannot call a class as a function")}function l(c,y){for(var O=0;O<y.length;O++){var P=y[O];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(c,P.key,P)}}function f(c,y,O){return y&&l(c.prototype,y),O&&l(c,O),c}var d=function(){function c(){u(this,c),this.init()}return f(c,[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.CONTENT_STEERING="contentSteering",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY="highestSelectionPriority",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},this.FILE_LOADER_TYPES={FETCH:"fetch_loader",XHR:"xhr_loader"}}}]),c}(),_=new d;const E=_},"./src/streaming/constants/MetricsConstants.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});function u(c,y){if(!(c instanceof y))throw new TypeError("Cannot call a class as a function")}function l(c,y){for(var O=0;O<y.length;O++){var P=y[O];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(c,P.key,P)}}function f(c,y,O){return y&&l(c.prototype,y),O&&l(c,O),c}var d=function(){function c(){u(this,c),this.init()}return f(c,[{key:"init",value:function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_LOADED="bufferLoaded",this.ABANDON_LOAD="abandonload",this.ALLOW_LOAD="allowload",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors",this.HTTP_REQUEST_DVB_REPORTING_TYPE="DVBReporting"}}]),c}(),_=new d;const E=_},"./src/streaming/constants/ProtectionConstants.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});function u(c,y){if(!(c instanceof y))throw new TypeError("Cannot call a class as a function")}function l(c,y){for(var O=0;O<y.length;O++){var P=y[O];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(c,P.key,P)}}function f(c,y,O){return y&&l(c.prototype,y),O&&l(c,O),c}var d=function(){function c(){u(this,c),this.init()}return f(c,[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready",this.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING="com.microsoft.playready.recommendation",this.INITIALIZATION_DATA_TYPE_CENC="cenc",this.INITIALIZATION_DATA_TYPE_KEYIDS="keyids",this.INITIALIZATION_DATA_TYPE_WEBM="webm"}}]),c}(),_=new d;const E=_},"./src/streaming/controllers/AbrController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>F});var u=r("./src/streaming/rules/abr/ABRRulesCollection.js"),l=r("./src/streaming/constants/Constants.js"),f=r("./src/streaming/constants/MetricsConstants.js"),d=r("./src/streaming/vo/BitrateInfo.js"),_=r("./src/streaming/models/FragmentModel.js"),E=r("./src/core/EventBus.js"),c=r("./src/core/events/Events.js"),y=r("./src/core/FactoryMaker.js"),O=r("./src/streaming/rules/RulesContext.js"),P=r("./src/streaming/rules/SwitchRequest.js"),b=r("./src/streaming/rules/SwitchRequestHistory.js"),L=r("./src/streaming/rules/DroppedFramesHistory.js"),R=r("./src/streaming/rules/ThroughputHistory.js"),T=r("./src/core/Debug.js"),m=r("./src/streaming/vo/metrics/HTTPRequest.js"),M=r("./src/streaming/utils/SupervisorTools.js"),p=r("./src/streaming/MediaPlayerEvents.js"),C=1e3,I=100,A=0;function S(){var k=this.context,j=(0,T.default)(k).getInstance(),V=(0,E.default)(k).getInstance(),Q,$,K,Y,re,ie,ee,ne,ae,ce,X,oe,ge,_e,he,se,Z,q,le,te,N,D,w,W,H,U,B;function G(){$=j.getLogger(Q),ve()}function z(){N=(0,L.default)(k).create(),D=(0,R.default)(k).create({settings:B}),K=(0,u.default)(k).create({dashMetrics:U,customParametersModel:se,mediaPlayerModel:he,settings:B}),K.initialize(),V.on(p.default.QUALITY_CHANGE_RENDERED,ke,Q),V.on(p.default.METRIC_ADDED,Ye,Q),V.on(c.default.LOADING_PROGRESS,Be,Q)}function fe(De,Ue){var Ze=Ue.getStreamInfo().id;ee[Ze]||(ee[Ze]={}),te[Ze]||(te[Ze]={}),ne[Ze]||(ne[Ze]={}),te[Ze][De]=(0,b.default)(k).create(),ee[Ze][De]=Ue,ne[Ze][De]={},ne[Ze][De].state=f.default.ALLOW_LOAD,ue(De),De===l.default.VIDEO&&yt()}function ue(De){var Ue=B.get().streaming.abr.ABRStrategy;Ue===l.default.ABR_STRATEGY_L2A?(w[De]=!1,H[De]=!1,W[De]=!0):Ue===l.default.ABR_STRATEGY_LoLP?(w[De]=!1,H[De]=!0,W[De]=!1):Ue===l.default.ABR_STRATEGY_BOLA?(w[De]=!0,H[De]=!1,W[De]=!1):Ue===l.default.ABR_STRATEGY_THROUGHPUT?(w[De]=!1,H[De]=!1,W[De]=!1):Ue===l.default.ABR_STRATEGY_DYNAMIC&&(w[De]=w&&w[De]?w[De]:!1,H[De]=!1,W[De]=!1)}function J(De,Ue){try{ee[De]&&ee[De][Ue]&&delete ee[De][Ue],te[De]&&te[De][Ue]&&delete te[De][Ue],ne[De]&&ne[De][Ue]&&delete ne[De][Ue]}catch{}}function ve(){re={},ie={},ne={},ee={},te={},w={},W={},H={},ce===void 0&&(ce=!1),N&&N.reset(),le=void 0,N=void 0,D=void 0,clearTimeout(ae),ae=null}function me(){ve(),V.off(c.default.LOADING_PROGRESS,Be,Q),V.off(p.default.QUALITY_CHANGE_RENDERED,ke,Q),V.off(p.default.METRIC_ADDED,Ye,Q),K&&K.reset()}function Ae(De){De&&(De.streamController&&(Y=De.streamController),De.domStorage&&(q=De.domStorage),De.mediaPlayerModel&&(he=De.mediaPlayerModel),De.customParametersModel&&(se=De.customParametersModel),De.cmsdModel&&(Z=De.cmsdModel),De.dashMetrics&&(U=De.dashMetrics),De.adapter&&(ge=De.adapter),De.videoModel&&(_e=De.videoModel),De.settings&&(B=De.settings))}function be(){if(!q||!q.hasOwnProperty("getSavedBitrateSettings"))throw new Error(l.default.MISSING_CONFIG_ERROR)}function Be(De){var Ue=De.request.mediaType,Ze=De.streamId;if(!(!Ue||!Ze||!ee[Ze]||!B.get().streaming.abr.autoSwitchBitrate[Ue])){var Et=ee[Ze][Ue];if(Et){var ct=(0,O.default)(k).create({abrController:Q,streamProcessor:Et,currentRequest:De.request,useBufferOccupancyABR:w[Ue],useL2AABR:W[Ue],useLoLPABR:H[Ue],videoModel:_e}),Tt=K.shouldAbandonFragment(ct,Ze);if(Tt.quality>P.default.NO_CHANGE){var Ot=Et.getFragmentModel(),jt=Ot.getRequests({state:_.default.FRAGMENT_MODEL_LOADING,index:De.request.index})[0];jt&&(ne[Ze][Ue].state=f.default.ABANDON_LOAD,te[Ze][Ue].reset(),te[Ze][Ue].push({oldValue:dt(Ue,Ze),newValue:Tt.quality,confidence:1,reason:Tt.reason}),gt(Ue,Y.getActiveStreamInfo(),Tt.quality,Tt.reason),clearTimeout(ae),ae=setTimeout(function(){ne[Ze][Ue].state=f.default.ALLOW_LOAD,ae=null},B.get().streaming.abandonLoadTimeout))}}}}function ke(De){De.mediaType===l.default.VIDEO&&(le!==void 0&&N.push(De.streamId,le,_e.getPlaybackQuality()),le=De.newQuality)}function Ye(De){De.metric===f.default.HTTP_REQUEST&&De.value&&De.value.type===m.HTTPRequest.MEDIA_SEGMENT_TYPE&&(De.mediaType===l.default.AUDIO||De.mediaType===l.default.VIDEO)&&D.push(De.mediaType,De.value,B.get().streaming.abr.useDeadTimeLatency),De.metric===f.default.BUFFER_LEVEL&&(De.mediaType===l.default.AUDIO||De.mediaType===l.default.VIDEO)&&xe(De.mediaType,.001*De.value.level)}function Le(De,Ue){try{var Ze;return re[Ue]=re[Ue]||{},re[Ue].hasOwnProperty(De)||(re[Ue][De]=0),Ze=it(De,Ue),Ze=Ce(Ze,De,Ue),Ze=je(Ze,De,Ue),B.get().streaming.cmsd.enabled&&B.get().streaming.cmsd.abr.applyMb&&(Ze=at(Ze,De,Ue)),Ze}catch{return}}function Se(De,Ue){try{return qe(De,Ue)}catch{return}}function Me(De,Ue){try{var Ze=he.getAbrBitrateParameter("maxBitrate",De);return Ze>-1?de(ee[Ue][De].getMediaInfo(),Ze,Ue):void 0}catch{return}}function qe(De,Ue){try{var Ze=he.getAbrBitrateParameter("minBitrate",De);if(Ze>-1){var Et=ee[Ue][De].getMediaInfo(),ct=Re(Et),Tt=de(Et,Ze,Ue);return ct[Tt]&&Tt<ct.length-1&&ct[Tt].bitrate<Ze*1e3&&Tt++,Tt}else return}catch{return}}function it(De,Ue){var Ze=re[Ue][De],Et=Ze;if(!ee[Ue]||!ee[Ue][De])return Et;var ct=Se(De,Ue);ct!==void 0&&(Et=Math.max(Ze,ct));var Tt=Me(De,Ue);return Tt!==void 0&&(Et=Math.min(Et,Tt)),Et}function at(De,Ue,Ze){if(Ue!=="video")return De;var Et=Z.getMaxBitrate(Ue);if(Et<0)return De;var ct=Te(Ze,"audio",dt("audio",Ze));Et-=ct?ct.bitrate/1e3:0;var Tt=de(ee[Ze][Ue].getMediaInfo(),Et,Ze);return $.debug("Stream ID: "+Ze+" ["+Ue+"] Apply max bit rate from CMSD: "+Et),Math.min(De,Tt)}function Ce(De,Ue,Ze){var Et=re[Ze][Ue],ct=B.get().streaming.abr.maxRepresentationRatio[Ue];return isNaN(ct)||ct>=1||ct<0?De:Math.min(De,Math.round(Et*ct))}function je(De,Ue,Ze){if(Ue!==l.default.VIDEO||!B.get().streaming.abr.limitBitrateByPortal||!ee[Ze]||!ee[Ze][Ue])return De;ce||yt();var Et=ee[Ze][Ue].getStreamInfo(),ct=ge.getAdaptationForType(Et.index,Ue,Et).Representation_asArray,Tt=De;if(X>0&&oe>0){for(;Tt>0&&ct[Tt]&&X<ct[Tt].width&&X-ct[Tt-1].width<ct[Tt].width-X;)Tt=Tt-1;for(;Tt<ct.length-1&&ct[Tt].width===ct[Tt+1].width;)Tt=Tt+1}return Tt}function Ge(De){var Ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(Ue||(Ue=Y.getActiveStreamInfo().id),De&&ee&&ee[Ue]&&ee[Ue][De]){var Ze=Le(De,Ue),Et=Re(ee[Ue][De].getMediaInfo());return Et[Ze]?Et[Ze]:null}return null}function tt(De,Ue){if(be(),De===l.default.TEXT)return NaN;var Ze=q.getSavedBitrateSettings(De),Et=he.getAbrBitrateParameter("initialBitrate",De),ct=B.get().streaming.abr.initialRepresentationRatio[De];if(Et===-1)if(ct>-1){var Tt=ee[Ue][De].getStreamInfo(),Ot=ge.getAdaptationForType(Tt.index,De,Tt).Representation_asArray;if(Array.isArray(Ot)){var jt=Math.max(Math.round(Ot.length*ct)-1,0);Et=Ot[jt].bandwidth/1e3}else Et=0}else isNaN(Ze)?Et=De===l.default.VIDEO?C:I:Et=Ze;return Et}function ot(De,Ue){try{if(!De||!ee||!ee[Ue]||!ee[Ue][De])return!1;if(N){var Ze=_e.getPlaybackQuality();Ze&&N.push(Ue,le,Ze)}if(!B.get().streaming.abr.autoSwitchBitrate[De])return!1;var Et=dt(De,Ue),ct=(0,O.default)(k).create({abrController:Q,switchHistory:te[Ue][De],droppedFramesHistory:N,streamProcessor:ee[Ue][De],currentValue:Et,useBufferOccupancyABR:w[De],useL2AABR:W[De],useLoLPABR:H[De],videoModel:_e}),Tt=Se(De,Ue),Ot=Le(De,Ue),jt=K.getMaxQuality(ct),Gt=jt.quality;return Tt!==void 0&&(Gt>P.default.NO_CHANGE?Gt:Et)<Tt&&(Gt=Tt),Gt>Ot&&(Gt=Ot),te[Ue][De].push({oldValue:Et,newValue:Gt}),Gt>P.default.NO_CHANGE&&Gt!==Et&&(ne[Ue][De].state===f.default.ALLOW_LOAD||Gt<Et)?($e(De,Et,Gt,Ot,jt.reason,Ue),!0):!1}catch{return!1}}function dt(De){var Ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;try{if(Ue||(Ue=Y.getActiveStreamInfo().id),De&&ee[Ue]&&ee[Ue][De]){var Ze;if(Ue)return ie[Ue]=ie[Ue]||{},ie[Ue].hasOwnProperty(De)||(ie[Ue][De]=A),Ze=ie[Ue][De],Ze}return A}catch{return A}}function gt(De,Ue,Ze){var Et=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!(!Ue||!Ue.id||!De)){var ct=Ue.id,Tt=dt(De,ct);(0,M.checkInteger)(Ze);var Ot=Le(De,ct);Ze!==Tt&&Ze>=0&&Ze<=Ot&&$e(De,Tt,Ze,Ot,Et,ct)}}function Mt(De,Ue){return ne[De]&&ne[De][Ue]?ne[De][Ue].state:null}function $e(De,Ue,Ze,Et,ct,Tt){if(De&&ee[Tt]&&ee[Tt][De]){var Ot=ee[Tt][De].getStreamInfo(),jt=Ot&&Ot.manifestInfo&&Ot.manifestInfo.isDynamic,Gt=U.getCurrentBufferLevel(De);$.info("Stream ID: "+Tt+" ["+De+"] switch from "+Ue+" to "+Ze+"/"+Et+" (buffer: "+Gt+") "+(ct?JSON.stringify(ct):".")),ie[Tt]=ie[Tt]||{},ie[Tt][De]=Ze;var pe=Te(Tt,De,Ze);V.trigger(c.default.QUALITY_CHANGE_REQUESTED,{oldQuality:Ue,newQuality:Ze,reason:ct,streamInfo:Ot,bitrateInfo:pe,maxIdx:Et,mediaType:De},{streamId:Ot.id,mediaType:De});var Ve=D.getAverageThroughput(De,jt);isNaN(Ve)||q.setSavedBitrateSettings(De,Ve)}}function Te(De,Ue,Ze){if(Ue&&ee&&ee[De]&&ee[De][Ue]){var Et=Re(ee[De][Ue].getMediaInfo());return Et[Ze]?Et[Ze]:null}return null}function de(De,Ue,Ze){var Et=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,ct=De&&De.type?ee[Ze][De.type].getRepresentationInfo():null;if(B.get().streaming.abr.useDeadTimeLatency&&Et&&ct&&ct.fragmentDuration){Et=Et/1e3;var Tt=ct.fragmentDuration;if(Et>Tt)return 0;var Ot=Et/Tt;Ue=Ue*(1-Ot)}for(var jt=Re(De),Gt=jt.length-1;Gt>=0;Gt--){var pe=jt[Gt];if(Ue*1e3>=pe.bitrate)return Gt}return A}function Re(De){var Ue=[];if(!De||!De.bitrateList)return Ue;for(var Ze=De.bitrateList,Et=De.type,ct,Tt=0,Ot=Ze.length;Tt<Ot;Tt++)ct=new d.default,ct.mediaType=Et,ct.qualityIndex=Tt,ct.bitrate=Ze[Tt].bandwidth,ct.width=Ze[Tt].width,ct.height=Ze[Tt].height,ct.scanType=Ze[Tt].scanType,Ue.push(ct);return Ue}function xe(De,Ue){var Ze=B.get().streaming.abr.ABRStrategy;Ze===l.default.ABR_STRATEGY_DYNAMIC&&Ne(De,Ue)}function Ne(De,Ue){try{var Ze=he.getStableBufferTime(),Et=Ze,ct=.5*Ze,Tt=w[De],Ot=Ue>(Tt?ct:Et);w[De]=Ot,Ot!==Tt&&(Ot?$.info("["+De+"] switching from throughput to buffer occupancy ABR rule (buffer: "+Ue.toFixed(3)+")."):$.info("["+De+"] switching from buffer occupancy to throughput ABR rule (buffer: "+Ue.toFixed(3)+")."))}catch(jt){$.error(jt)}}function Xe(){return D}function nt(De){var Ue=De.type,Ze=De.streamInfo.id,Et=De.representationCount-1;return re[Ze]=re[Ze]||{},re[Ze][Ue]=Et,Et}function et(De){var Ue=De?De.id:null,Ze=dt(l.default.AUDIO,Ue),Et=dt(l.default.VIDEO,Ue),ct=Ze===Le(l.default.AUDIO,Ue)&&Et===Le(l.default.VIDEO,Ue);return ct}function ht(De){ce=De}function yt(){if(_e){var De=B.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio"),Ue=De?window.devicePixelRatio:1;X=_e.getClientWidth()*Ue,oe=_e.getClientHeight()*Ue}}function Pt(De){N&&N.clearForStream(De),ee[De]&&delete ee[De],te[De]&&delete te[De],ne[De]&&delete ne[De]}return Q={initialize:z,isPlayingAtTopQuality:et,updateTopQualityIndex:nt,clearDataForStream:Pt,getThroughputHistory:Xe,getBitrateList:Re,getQualityForBitrate:de,getTopBitrateInfoFor:Ge,getMinAllowedIndexFor:Se,getMaxAllowedIndexFor:Le,getInitialBitrateFor:tt,getQualityFor:dt,getAbandonmentStateFor:Mt,setPlaybackQuality:gt,checkPlaybackQuality:ot,setElementSize:yt,setWindowResizeEventCalled:ht,registerStreamType:fe,unRegisterStreamType:J,setConfig:Ae,reset:me},G(),Q}S.__dashjs_factory_name="AbrController";var x=y.default.getSingletonFactory(S);x.QUALITY_DEFAULT=A,y.default.updateSingletonFactory(S.__dashjs_factory_name,x);const F=x},"./src/streaming/controllers/BaseURLController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>O});var u=r("./src/streaming/models/BaseURLTreeModel.js"),l=r("./src/streaming/utils/BaseURLSelector.js"),f=r("./src/streaming/utils/URLUtils.js"),d=r("./src/dash/vo/BaseURL.js"),_=r("./src/core/FactoryMaker.js"),E=r("./src/core/EventBus.js"),c=r("./src/core/events/Events.js");function y(){var P,b,L=this.context,R=(0,E.default)(L).getInstance(),T=(0,f.default)(L).getInstance(),m,M;function p(k){m.invalidateSelectedIndexes(k.entry)}function C(){m=(0,u.default)(L).create(),M=(0,l.default)(L).create(),R.on(c.default.SERVICE_LOCATION_BLACKLIST_CHANGED,p,P)}function I(k){k.baseURLTreeModel&&(m=k.baseURLTreeModel),k.baseURLSelector&&(M=k.baseURLSelector),k.adapter&&(b=k.adapter)}function A(k){m.update(k),M.chooseSelector(b.getIsDVB(k))}function S(k){var j=m.getForPath(k),V=j.reduce(function(Q,$){var K=M.select($);if(K)T.isRelative(K.url)?Q.url=T.resolve(K.url,Q.url):(Q.url=K.url,Q.serviceLocation=K.serviceLocation),Q.availabilityTimeOffset=K.availabilityTimeOffset,Q.availabilityTimeComplete=K.availabilityTimeComplete;else return new d.default;return Q},new d.default);if(!T.isRelative(V.url))return V}function x(){m.reset(),M.reset()}function F(k){m.setConfig({adapter:b}),A(k)}return P={reset:x,initialize:F,resolve:S,setConfig:I},C(),P}y.__dashjs_factory_name="BaseURLController";const O=_.default.getClassFactory(y)},"./src/streaming/controllers/BlacklistController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/EventBus.js");function f(_){_=_||{};var E,c=[],y=(0,l.default)(this.context).getInstance(),O=_.updateEventName,P=_.addBlacklistEventName;function b(M){return!c.length||!M||!M.length?!1:c.indexOf(M)!==-1}function L(M){c.indexOf(M)===-1&&(c.push(M),y.trigger(O,{entry:M}))}function R(M){L(M.entry)}function T(){P&&y.on(P,R,E)}function m(){c=[]}return E={add:L,contains:b,reset:m},T(),E}f.__dashjs_factory_name="BlackListController";const d=u.default.getClassFactory(f)},"./src/streaming/controllers/BufferController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>A});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/streaming/constants/MetricsConstants.js"),f=r("./src/streaming/models/FragmentModel.js"),d=r("./src/streaming/SourceBufferSink.js"),_=r("./src/streaming/PreBufferSink.js"),E=r("./src/core/EventBus.js"),c=r("./src/core/events/Events.js"),y=r("./src/core/FactoryMaker.js"),O=r("./src/core/Debug.js"),P=r("./src/streaming/utils/InitCache.js"),b=r("./src/streaming/vo/DashJSError.js"),L=r("./src/core/errors/Errors.js"),R=r("./src/streaming/vo/metrics/HTTPRequest.js"),T=r("./src/streaming/MediaPlayerEvents.js"),m=.5,M=.01,p=22,C="BufferController";function I(S){S=S||{};var x=this.context,F=(0,E.default)(x).getInstance(),k=S.errHandler,j=S.fragmentModel,V=S.representationController,Q=S.adapter,$=S.textController,K=S.abrController,Y=S.playbackController,re=S.streamInfo,ie=S.type,ee=S.settings,ne,ae,ce,X,oe,ge,_e,he,se,Z,q,le,te,N,D,w,W,H,U,B;function G(){ae=(0,O.default)(x).getInstance().getLogger(ne),W=(0,P.default)(x).getInstance(),St()}function z(Pe){ve(Pe),F.on(c.default.INIT_FRAGMENT_LOADED,Le,ne),F.on(c.default.MEDIA_FRAGMENT_LOADED,Me,ne),F.on(c.default.WALLCLOCK_TIME_UPDATED,pe,ne),F.on(T.default.PLAYBACK_PLAYING,xe,ne),F.on(T.default.PLAYBACK_PROGRESS,de,ne),F.on(T.default.PLAYBACK_TIME_UPDATED,de,ne),F.on(T.default.PLAYBACK_RATE_CHANGED,Ve,ne),F.on(T.default.PLAYBACK_STALLED,Re,ne)}function fe(){return re.id}function ue(){return ie}function J(){return C}function ve(Pe){var Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return new Promise(function(ye,He){ge=Pe,se&&Ke&&typeof se.discharge=="function"?(Z=se,Ae(Ke).then(function(){ye()}).catch(function(lt){He(lt)})):ye()})}function me(Pe){return Q.convertRepresentationToRepresentationInfo(V.getRepresentationForQuality(Pe))}function Ae(Pe){var Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return new Promise(function(ye,He){if(!W||!Pe){ye(null);return}ge?Be(Pe,Ke).then(function(lt){ye(lt)}).catch(function(lt){He(lt)}):be().then(function(lt){ye(lt)}).catch(function(lt){He(lt)})})}function be(){var Pe=this;return new Promise(function(Ke,ye){var He=K.getQualityFor(ie,re.id);se=(0,_.default)(x).create(at.bind(Pe)),Ot(me(He)).then(function(){Ke(se)}).catch(function(){ye()})})}function Be(Pe,Ke){return new Promise(function(ye,He){var lt=K.getQualityFor(ie,re.id);se=(0,d.default)(x).create({mediaSource:ge,textController:$,eventBus:F}),ke(Pe,Ke,lt).then(function(){return Ot(me(lt))}).then(function(){ye(se)}).catch(function(Rt){ae.fatal("Caught error on create SourceBuffer: "+Rt),k.error(new b.default(L.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,L.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+ie)),He(Rt)})})}function ke(Pe,Ke,ye){var He=me(ye);return Ke&&Ke[ie]&&(ie===u.default.VIDEO||ie===u.default.AUDIO)?se.initializeForStreamSwitch(Pe,He,Ke[ie]):se.initializeForFirstUse(re,Pe,He)}function Ye(){if(se&&Z&&typeof Z.discharge=="function"){var Pe=Z.getAllBufferRanges();if(Pe.length>0){for(var Ke="Beginning "+ie+"PreBuffer discharge, adding buffer for:",ye=0;ye<Pe.length;ye++)Ke+=" start: "+Pe.start(ye)+", end: "+Pe.end(ye)+";";ae.debug(Ke)}else ae.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");q=[];for(var He=Z.discharge(),lt=null,Rt=0;Rt<He.length;Rt++){var Ct=He[Rt];if(Ct.segmentType!==R.HTTPRequest.INIT_SEGMENT_TYPE){var Kt=W.extract(Ct.streamId,Ct.representationId);Kt&&lt!==Kt&&(q.push(Kt),se.append(Kt),lt=Kt)}q.push(Ct),se.append(Ct)}Z.reset(),Z=null}}function Le(Pe){ee.get().streaming.cacheInitSegments&&(ae.info("Init fragment finished loading saving to",ie+"'s init cache"),W.save(Pe.chunk)),ae.debug("Append Init fragment",ie," with representationId:",Pe.chunk.representationId," and quality:",Pe.chunk.quality,", data size:",Pe.chunk.bytes.byteLength),qe(Pe.chunk)}function Se(Pe){var Ke=W.extract(re.id,Pe);return Ke?(ae.info("Append Init fragment",ie," with representationId:",Ke.representationId," and quality:",Ke.quality,", data size:",Ke.bytes.byteLength),qe(Ke),!0):!1}function Me(Pe){qe(Pe.chunk,Pe.request)}function qe(Pe){var Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;se.append(Pe,Ke).then(function(ye){at(ye)}).catch(function(ye){at(ye)}),Pe.mediaInfo.type===u.default.VIDEO&&Je(c.default.VIDEO_CHUNK_RECEIVED,{chunk:Pe})}function it(Pe){if(Pe&&Pe.length>0)for(var Ke=0,ye=Pe.length;Ke<ye;Ke++)ae.debug("Buffered range: "+Pe.start(Ke)+" - "+Pe.end(Ke)+", currentTime = ",Y.getTime())}function at(Pe){if(Pe.error){Pe.error.code===p&&je(),(Pe.error.code===p||!Zt())&&(ae.warn("Clearing playback buffer to overcome quota exceed situation"),Je(c.default.QUOTA_EXCEEDED,{criticalBufferLevel:oe,quotaExceededTime:Pe.chunk.start}),Ze(Ue()));return}if(se&&(et(),w=!1,te=Pe.chunk,!(!te||!te.endFragment))){te&&!isNaN(te.index)&&(_e=Math.max(te.index,_e),ht());var Ke=se.getAllBufferRanges();te.segmentType===R.HTTPRequest.MEDIA_SEGMENT_TYPE&&(it(Ke),de(),Ce());var ye=!1;q&&(q.indexOf(te)>0&&(ye=!0),q=null),te&&!ye&&Je(c.default.BYTES_APPENDED_END_FRAGMENT,{quality:te.quality,startTime:te.start,index:te.index,bufferedRanges:Ke,segmentType:te.segmentType,mediaType:ie})}}function Ce(){if(!isNaN(B)){if(ie!==u.default.AUDIO&&ie!==u.default.VIDEO){B=NaN;return}var Pe=Y.getTime(),Ke=Xe(Pe,0),ye=Xe(B,0);if(Ke&&ye&&Ke.start===ye.start){B=NaN;return}var He=V.getCurrentRepresentation().segmentDuration,lt=Xe(B,He);lt&&(ee.get().streaming.buffer.enableSeekDecorrelationFix&&Math.abs(Pe-B)>He?B<=lt.end&&Y.seek(Math.max(B,lt.start),!1,!0):Pe<lt.start&&Y.seek(lt.start,!1,!0))}}function je(){if(w=!0,oe=It()*.8,ae.warn("Quota exceeded, Critical Buffer: "+oe),oe>0){var Pe=Math.max(.2*oe,1),Ke=oe-Pe,ye=Math.min(ee.get().streaming.buffer.bufferTimeAtTopQuality,Ke*.9),He=Math.min(ee.get().streaming.buffer.bufferTimeAtTopQualityLongForm,Ke*.9),lt={streaming:{buffer:{bufferToKeep:parseFloat(Pe.toFixed(5)),bufferTimeAtTopQuality:parseFloat(ye.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(He.toFixed(5))}}};ee.update(lt)}}function Ge(){return ce&&_t(!1),se.abort()}function tt(Pe){return new Promise(function(Ke,ye){se.abort().then(function(){return jt()}).then(function(){return ee.get().streaming.buffer.useChangeTypeForTrackSwitch?se.changeType(Pe):Promise.resolve()}).then(function(){return gt()}).then(function(){_t(!1),Ke()}).catch(function(He){ye(He)})})}function ot(){return new Promise(function(Pe,Ke){se.abort().then(function(){return jt()}).then(function(){return gt()}).then(function(){_t(!1),Pe()}).catch(function(ye){Ke(ye)})})}function dt(Pe){return new Promise(function(Ke,ye){jt().then(function(){return ee.get().streaming.buffer.useChangeTypeForTrackSwitch?se.changeType(Pe):Promise.resolve()}).then(function(){Ke()}).catch(function(He){ye(He)})})}function gt(){return new Promise(function(Pe,Ke){var ye=Mt();if(!ye||ye.length===0){de(),Pe();return}Ze(ye).then(function(){Pe()}).catch(function(He){Ke(He)})})}function Mt(Pe){var Ke=[],ye=se.getAllBufferRanges();if(!ye||ye.length===0)return Ke;if(!Pe&&Pe!==0||isNaN(Pe))Ke.push({start:ye.start(0),end:ye.end(ye.length-1)+m});else{var He=$e(Pe,ye),lt=Te(Pe,ye);He&&Ke.push(He),lt&&Ke.push(lt)}return Ke}function $e(Pe,Ke){var ye=ee.get().streaming.buffer.bufferToKeep,He=Ke.start(0),lt=Pe-He;if(lt>ye){var Rt=Math.max(0,Pe-ye),Ct=j.getRequests({state:f.default.FRAGMENT_MODEL_EXECUTED,time:Pe,threshold:M})[0];if(Ct&&(Rt=Math.min(Ct.startTime,Rt)),Rt>0)return{start:He,end:Rt}}return null}function Te(Pe,Ke){var ye=Ke.end(Ke.length-1)+m,He=Dt(Pe),lt=re.manifestInfo.duration>=ee.get().streaming.buffer.longFormContentDurationThreshold,Rt=lt?ee.get().streaming.buffer.bufferTimeAtTopQualityLongForm:ee.get().streaming.buffer.bufferTimeAtTopQuality,Ct=isNaN(He)?Pe:Math.min(He,Pe+Rt);if(Ct>=Ke.end(Ke.length-1))return null;var Kt=j.getRequests({state:f.default.FRAGMENT_MODEL_EXECUTED,time:Pe,threshold:M})[0];Kt&&(Ct=Math.max(Kt.startTime+Kt.duration,Ct));var Ht=ee.get().streaming.buffer.avoidCurrentTimeRangePruning;if(Ht){for(var Ut=0;Ut<Ke.length;Ut++)if(Ke.start(Ut)<=Pe&&Pe<=Ke.end(Ut)&&Ke.start(Ut)<=Ct&&Ct<=Ke.end(Ut)){var sr=Ct;Ut+1<Ke.length?Ct=Ke.start(Ut+1):Ct=Ke.end(Ut)+1,ae.debug("Buffered range ["+Ke.start(Ut)+", "+Ke.end(Ut)+"] overlaps with targetTime "+Pe+" and range to be pruned ["+sr+", "+ye+"], using ["+Ct+", "+ye+"] instead"+(Ct<ye?"":" (no actual pruning)"));break}}return Ct<Ke.end(Ke.length-1)?{start:Ct,end:ye}:null}function de(){(!U||ie===u.default.TEXT&&$.isTextEnabled())&&et()}function Re(){yt()}function xe(){yt(),B=NaN}function Ne(Pe){try{var Ke=se.getAllBufferRanges();if(!Ke||Ke.length===0)return!1;for(var ye=0;ye<Ke.length;){var He=Ke.start(ye),lt=Ke.end(ye);if(Pe>=He&&Pe<=lt)return!0;ye+=1}return!1}catch(Rt){return ae.error(Rt),!1}}function Xe(Pe,Ke){var ye=se.getAllBufferRanges(),He=0,lt=0,Rt=null,Ct=null,Kt=0,Ht,Ut,sr=isNaN(Ke)?.15:Ke;if(ye!=null){for(Ut=0,Ht=ye.length;Ut<Ht;Ut++)if(He=ye.start(Ut),lt=ye.end(Ut),Rt===null)Kt=Math.abs(He-Pe),(Pe>=He&&Pe<lt||Kt<=sr)&&(Rt=He,Ct=lt);else if(Kt=He-Ct,Kt<=sr)Ct=lt;else break;if(Rt!==null)return{start:Rt,end:Ct}}return null}function nt(Pe,Ke){var ye,He;return ee.get().streaming.gaps.jumpGaps&&(Ke=ee.get().streaming.gaps.smallGapLimit),ye=Xe(Pe,Ke),ye===null?He=0:He=ye.end-Pe,He}function et(){if(Y){var Pe=ee.get().streaming.gaps.jumpGaps&&!isNaN(ee.get().streaming.gaps.smallGapLimit)?ee.get().streaming.gaps.smallGapLimit:NaN;X=Math.max(nt(Y.getTime()||0,Pe),0),Je(c.default.BUFFER_LEVEL_UPDATED,{mediaType:ie,bufferLevel:X}),yt()}}function ht(){var Pe=_e>=he-1,Ke=Y.getTimeToStreamEnd(re)-X<1e-5;(Pe||Ke)&&!ce&&(_t(!0),ae.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED for stream id ".concat(re.id," and type ").concat(ie)))}function yt(){ie!==u.default.AUDIO&&ie!==u.default.VIDEO||((!Y.getLowLatencyModeEnabled()&&X<ee.get().streaming.buffer.stallThreshold||X===0)&&!ce?Pt(l.default.BUFFER_EMPTY):(ce||X>=ee.get().streaming.buffer.stallThreshold||Y.getLowLatencyModeEnabled()&&X>0)&&Pt(l.default.BUFFER_LOADED))}function Pt(Pe){le===Pe||Pe===l.default.BUFFER_EMPTY&&Y.getTime()===0||ie===u.default.TEXT&&!$.isTextEnabled()||(le=Pe,Je(c.default.BUFFER_LEVEL_STATE_CHANGED,{state:Pe}),Je(Pe===l.default.BUFFER_LOADED?c.default.BUFFER_LOADED:c.default.BUFFER_EMPTY),ae.debug(Pe===l.default.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function De(){!se||ie===u.default.TEXT||ce||Ze(Ue())}function Ue(){var Pe=[],Ke=se.getAllBufferRanges();if(!Ke||Ke.length===0)return Pe;var ye=Y.getTime(),He=Math.max(0,ye-ee.get().streaming.buffer.bufferToKeep),lt=j.getRequests({state:f.default.FRAGMENT_MODEL_EXECUTED,time:ye,threshold:M})[0];if(lt)He=Math.min(lt.startTime,He);else if(ye===0&&Y.getIsDynamic())return[];if(Ke.start(0)<=He){for(var Rt={start:0,end:He},Ct=0;Ct<Ke.length&&Ke.end(Ct)<=He;Ct++)Rt.end=Ke.end(Ct);Rt.start<Rt.end&&Pe.push(Rt)}return Pe}function Ze(Pe){return new Promise(function(Ke,ye){if(!Pe||!se||Pe.length===0){Ke();return}var He=[];Pe.forEach(function(lt){He.push(Et(lt))}),D||ct(),Promise.all(He).then(function(){Ke()}).catch(function(lt){ye(lt)})})}function Et(Pe){return new Promise(function(Ke,ye){Pe.resolve=Ke,Pe.reject=ye,H.push(Pe)})}function ct(){try{if(H.length===0||!se){ae.debug("Nothing to prune, halt pruning"),H=[],D=!1;return}var Pe=se.getBuffer();if(!Pe||!Pe.buffered||Pe.buffered.length===0){ae.debug("SourceBuffer is empty (or does not exist), halt pruning"),H=[],D=!1;return}var Ke=H.shift();ae.debug("".concat(ie,": Removing buffer from: ").concat(Ke.start," to ").concat(Ke.end)),D=!0;var ye=Y.getTime();ye<Ke.end&&_t(!1),se.remove(Ke).then(function(He){Tt(He)}).catch(function(He){Tt(He)})}catch{D=!1}}function Tt(Pe){ae.debug("onRemoved buffer from:",Pe.from,"to",Pe.to);var Ke=se.getAllBufferRanges();it(Ke),H.length===0&&(D=!1,et()),Pe.unintended&&(ae.warn("Detected unintended removal from:",Pe.from,"to",Pe.to,"setting streamprocessor time to",Pe.from),Je(c.default.SEEK_TARGET,{time:Pe.from})),D?ct():(U?U=!1:et(),Je(c.default.BUFFER_CLEARED,{from:Pe.from,to:Pe.to,unintended:Pe.unintended,hasEnoughSpaceToAppend:Zt(),quotaExceeded:w}))}function Ot(Pe){return new Promise(function(Ke){if(!Pe||Pe.MSETimeOffset===void 0||!se||!se.updateTimestampOffset){Ke();return}se.updateTimestampOffset(Pe.MSETimeOffset).then(function(){Ke()}).catch(function(){Ke()})})}function jt(){return se&&!ce?se.updateAppendWindow(re):Promise.resolve()}function Gt(Pe){isNaN(Pe)||(he=Pe,ht())}function pe(){N++;var Pe=N*(ee.get().streaming.wallclockTimeUpdateInterval/1e3);Pe>=ee.get().streaming.buffer.bufferPruningInterval&&(N=0,De())}function Ve(){yt()}function ft(){return se}function Ie(){return X}function we(){return ge}function ze(){return ce}function _t(Pe){ce!==Pe&&(ce=Pe,ce?Je(c.default.BUFFERING_COMPLETED):he=Number.POSITIVE_INFINITY)}function Nt(){return D}function It(){try{var Pe=se.getAllBufferRanges(),Ke=0,ye,He;if(!Pe)return Ke;for(He=0,ye=Pe.length;He<ye;He++)Ke+=Pe.end(He)-Pe.start(He);return Ke}catch{return 0}}function Dt(Pe){try{var Ke=Pe,ye=se.getAllBufferRanges();if(!ye||ye.length===0)return NaN;for(var He=0;Ke===Pe&&He<ye.length;){var lt=ye.start(He),Rt=ye.end(He);Ke>=lt&&Ke<=Rt&&(Ke=Rt),He+=1}return Ke===Pe?NaN:Ke}catch{}}function Zt(){var Pe=It();return isNaN(Pe)||Pe<oe}function Wt(Pe){B=Pe}function Je(Pe,Ke){var ye=Ke||{};F.trigger(Pe,ye,{streamId:re.id,mediaType:ie})}function St(Pe,Ke){if(oe=Number.POSITIVE_INFINITY,le=void 0,he=Number.POSITIVE_INFINITY,_e=0,te=null,ce=!1,D=!1,w=!1,X=0,N=0,H=[],B=NaN,se){var ye=se;se=null,!Pe&&!Ke&&ye.abort().then(function(){ye.reset(Ke),ye=null})}U=!1}function At(Pe,Ke){F.off(c.default.INIT_FRAGMENT_LOADED,Le,this),F.off(c.default.MEDIA_FRAGMENT_LOADED,Me,this),F.off(c.default.WALLCLOCK_TIME_UPDATED,pe,this),F.off(T.default.PLAYBACK_PLAYING,xe,this),F.off(T.default.PLAYBACK_PROGRESS,de,this),F.off(T.default.PLAYBACK_TIME_UPDATED,de,this),F.off(T.default.PLAYBACK_RATE_CHANGED,Ve,this),F.off(T.default.PLAYBACK_STALLED,Re,this),St(Pe,Ke)}return ne={initialize:z,getStreamId:fe,getType:ue,getBufferControllerType:J,createBufferSink:Ae,dischargePreBuffer:Ye,getBuffer:ft,getBufferLevel:Ie,getRangeAt:Xe,hasBufferAtTime:Ne,pruneBuffer:De,setMediaSource:ve,getMediaSource:we,appendInitSegmentFromCache:Se,getIsBufferingCompleted:ze,setIsBufferingCompleted:_t,getIsPruningInProgress:Nt,reset:At,prepareForPlaybackSeek:Ge,prepareForReplacementTrackSwitch:tt,prepareForNonReplacementTrackSwitch:dt,prepareForReplacementQualitySwitch:ot,updateAppendWindow:jt,getAllRangesWithSafetyFactor:Mt,getContinuousBufferTimeForTargetTime:Dt,clearBuffers:Ze,pruneAllSafely:gt,updateBufferTimestampOffset:Ot,setSeekTarget:Wt,segmentRequestingCompleted:Gt},G(),ne}I.__dashjs_factory_name=C;const A=y.default.getClassFactory(I)},"./src/streaming/controllers/CatchupController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>P});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),f=r("./src/core/EventBus.js"),d=r("./src/streaming/constants/Constants.js"),_=r("./src/streaming/MediaPlayerEvents.js"),E=r("./src/core/events/Events.js"),c=r("./src/streaming/constants/MetricsConstants.js"),y=r("./src/core/Utils.js");function O(){var b=this.context,L=(0,f.default)(b).getInstance(),R,T,m,M,p,C,I,A,S,x;function F(){j(),Z()}function k(q){q&&(q.settings&&(p=q.settings),q.videoModel&&(M=q.videoModel),q.streamController&&(C=q.streamController),q.playbackController&&(I=q.playbackController),q.mediaPlayerModel&&(A=q.mediaPlayerModel))}function j(){L.on(_.default.BUFFER_LEVEL_UPDATED,re,R),L.on(_.default.BUFFER_LEVEL_STATE_CHANGED,ie,R),L.on(_.default.PLAYBACK_PROGRESS,ne,R),L.on(_.default.PLAYBACK_TIME_UPDATED,ne,R),L.on(_.default.PLAYBACK_SEEKED,Y,R),L.on(E.default.SETTING_UPDATED_CATCHUP_ENABLED,ee,R),L.on(E.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,Z,R),L.on(E.default.SETTING_UPDATED_PLAYBACK_RATE_MAX,Z,R),L.on(_.default.STREAM_INITIALIZED,Z,R)}function V(){L.off(_.default.BUFFER_LEVEL_UPDATED,re,R),L.off(_.default.BUFFER_LEVEL_STATE_CHANGED,ie,R),L.off(_.default.PLAYBACK_PROGRESS,ne,R),L.off(_.default.PLAYBACK_TIME_UPDATED,ne,R),L.off(_.default.PLAYBACK_SEEKED,ne,R),L.off(E.default.SETTING_UPDATED_CATCHUP_ENABLED,ee,R),L.off(E.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,Z,R),L.off(E.default.SETTING_UPDATED_PLAYBACK_RATE_MAX,Z,R),L.off(_.default.STREAM_INITIALIZED,Z,R)}function Q(){x=(0,l.default)(b).getInstance().getLogger(R),K()}function $(){V(),K(),M.setPlaybackRate(1,!0)}function K(){T=!1;var q=y.default.parseUserAgent();m=q&&q.browser&&q.browser.name&&q.browser.name.toLowerCase()==="safari"}function Y(){T=!1}function re(q){if(!(q.streamId!==C.getActiveStreamInfo().id||!S)){var le=I.getLiveDelay(),te=I.getBufferLevel();te>le/2&&(S=!1)}}function ie(q){q.streamId===C.getActiveStreamInfo().id&&(S=q.state===c.default.BUFFER_EMPTY)}function ee(){A.getCatchupModeEnabled()||M.setPlaybackRate(1)}function ne(){I.getIsDynamic()&&A.getCatchupModeEnabled()&&(A.getCatchupPlaybackRates().max>0||A.getCatchupPlaybackRates().min<0)&&!I.isPaused()&&!I.isSeeking()&&X()&&ae()}function ae(){if(!T&&M){var q,le=M.getPlaybackRate(),te=A.getCatchupPlaybackRates(),N=I.getBufferLevel(),D=ce(),w=A.getCatchupMaxDrift();if(!isNaN(w)&&w>0&&D>w)x.info("[CatchupController]: Low Latency catchup mechanism. Latency too high, doing a seek to live point"),T=!0,I.seekToCurrentLive(!0,!1);else{var W=I.getCurrentLiveLatency(),H=I.getLiveDelay();if(oe()===d.default.LIVE_CATCHUP_MODE_LOLP){var U=p.get().streaming.liveCatchup.playbackBufferMin;q=se(te,W,H,U,N)}else q=he(te,W,H,N);var B=m?.25:.02/(.5/te.max);q&&Math.abs(le-q)>=B&&(x.debug("[CatchupController]: Setting playback rate to ".concat(q)),M.setPlaybackRate(q))}}}function ce(){var q=I.getCurrentLiveLatency(),le=I.getLiveDelay();return q-le}function X(){try{if(!I.getTime()>0||T)return!1;var q=oe();if(q===d.default.LIVE_CATCHUP_MODE_LOLP){var le=I.getBufferLevel(),te=p.get().streaming.liveCatchup.playbackBufferMin;return _e(le,te)}else return ge()}catch{return!1}}function oe(){var q=p.get().streaming.liveCatchup.playbackBufferMin;return p.get().streaming.liveCatchup.mode===d.default.LIVE_CATCHUP_MODE_LOLP&&q!==null&&!isNaN(q)?d.default.LIVE_CATCHUP_MODE_LOLP:d.default.LIVE_CATCHUP_MODE_DEFAULT}function ge(){try{var q=Math.abs(ce());return q>0}catch{return!1}}function _e(q,le){try{var te=Math.abs(ce());return te>0||q<le}catch{return!1}}function he(q,le,te,N){if(S)return 1;var D=le-te,w=D<0?Math.abs(q.min):q.max,W=D*5,H=w*2/(1+Math.pow(Math.E,-W)),U=1-w+H;return I.getPlaybackStalled()&&N<=te/2&&D>0&&(U=1),U}function se(q,le,te,N,D){var w;if(D<N){var W=Math.abs(q.min),H=D-N,U=H*5,B=W*2/(1+Math.pow(Math.E,-U));w=1-W+B,x.debug("[LoL+ playback control_buffer-based] bufferLevel: "+D+", newRate: "+w)}else{var G=q.max,z=.02;if(Math.abs(le-te)<=z*te)w=1;else{var fe=le-te,ue=fe*5,J=G*2/(1+Math.pow(Math.E,-ue));w=1-G+J}x.debug("[LoL+ playback control_latency-based] latency: "+le+", newRate: "+w)}return w}function Z(){A.getCatchupPlaybackRates(!0)}return R={reset:$,setConfig:k,initialize:F},Q(),R}O.__dashjs_factory_name="CatchupController";const P=u.default.getSingletonFactory(O)},"./src/streaming/controllers/EventController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>c});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),f=r("./src/core/EventBus.js"),d=r("./src/streaming/MediaPlayerEvents.js"),_=r("./src/streaming/net/XHRLoader.js");function E(){var y="urn:mpeg:dash:event:2012",O=1,P="urn:mpeg:dash:event:callback:2015",b=1,L=300,R={DISCARDED:"discarded",UPDATED:"updated",ADDED:"added"},T=this.context,m=(0,f.default)(T).getInstance(),M,p,C,I,A,S,x,F,k,j,V;function Q(){p=(0,l.default)(T).getInstance().getLogger(M),K()}function $(){if(!x||!F)throw new Error("setConfig function has to be called previously")}function K(){V=!1,C={},I={},A=null,j=!1,S=Date.now()/1e3}function Y(){try{A!==null&&V&&(clearInterval(A),A=null,V=!1,ge())}catch(U){throw U}}function re(){try{$(),p.debug("Start Event Controller");var U=k.get().streaming.eventControllerRefreshDelay;!V&&!isNaN(U)&&(V=!0,A=setInterval(ie,U))}catch(B){throw B}}function ie(){try{if(!j){j=!0;var U=F.getTime(),B=U-S;B=S>0?Math.max(0,B):0,ee(I,B,U),ee(C,B,U),ne(I),ne(C),S=U,j=!1}}catch(G){j=!1,p.error(G)}}function ee(U,B,G){try{var z=function(ue){if(ue!==void 0){var J=isNaN(ue.duration)?0:ue.duration;ue.calculatedPresentationTime<=G&&ue.calculatedPresentationTime+B+J>=G?q(ue,d.default.EVENT_MODE_ON_START):(se(G,J+B,ue.calculatedPresentationTime)||Z(ue))&&(p.debug("Removing event ".concat(ue.id," from period ").concat(ue.eventStream.period.id," as it is expired or invalid")),le(U,ue))}};he(U,z)}catch(fe){p.error(fe)}}function ne(U){try{for(var B in U)U.hasOwnProperty(B)&&Object.keys(U[B]).length===0&&delete U[B]}catch(G){p.error(G)}}function ae(U,B){try{if($(),C[B]||(C[B]={}),U)for(var G=0;G<U.length;G++){var z=U[G],fe=F.getTime(),ue=isNaN(z.duration)?0:z.duration;if(!se(fe,ue,z.calculatedPresentationTime)){var J=X(z,C[B],!0);J===R.ADDED?(p.debug("Added inline event with id ".concat(z.id," from period ").concat(B)),q(z,d.default.EVENT_MODE_ON_RECEIVE)):J===R.UPDATED&&p.debug("Updated inline event with id ".concat(z.id," from period ").concat(B))}}}catch(ve){throw ve}}function ce(U,B){try{$(),I[B]||(I[B]={});for(var G=0;G<U.length;G++){var z=U[G],fe=F.getTime(),ue=isNaN(z.duration)?0:z.duration;if(!se(fe,ue,z.calculatedPresentationTime)){var J=X(z,I[B],!1);J===R.ADDED?(z.eventStream.schemeIdUri===y&&oe(z),p.debug("Added inband event with id ".concat(z.id," from period ").concat(B)),q(z,d.default.EVENT_MODE_ON_RECEIVE)):p.debug("Inband event with scheme_id_uri ".concat(z.eventStream.schemeIdUri,", value ").concat(z.eventStream.value,", period id ").concat(B," and event id ").concat(z.id," was ignored because it has been added before."))}}ie()}catch(ve){throw ve}}function X(U,B){var G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,z=U.eventStream.schemeIdUri,fe=U.eventStream.value,ue=U.id,J=R.DISCARDED;B[z]||(B[z]=[]);var ve=B[z].findIndex(function(Ae){return(!fe||Ae.eventStream.value&&Ae.eventStream.value===fe)&&Ae.id===ue});if(ve===-1)B[z].push(U),U.triggeredReceivedEvent=!1,U.triggeredStartEvent=!1,J=R.ADDED;else if(G){var me=B[z][ve];U.triggeredReceivedEvent=me.triggeredReceivedEvent,U.triggeredStartEvent=me.triggeredStartEvent,B[z][ve]=U,J=R.UPDATED}return J}function oe(U){try{if(U.eventStream.value==O){var B=U.calculatedPresentationTime,G;U.calculatedPresentationTime==4294967295?G=NaN:G=U.calculatedPresentationTime+U.duration,m.trigger(d.default.MANIFEST_VALIDITY_CHANGED,{id:U.id,validUntil:B,newDuration:G,newManifestValidAfter:NaN},{mode:d.default.EVENT_MODE_ON_START})}}catch(z){p.error(z)}}function ge(){try{_e(I),_e(C)}catch(U){p.error(U)}}function _e(U){try{var B=F.getTime(),G=function(fe){var ue=fe.eventStream&&fe.eventStream.period&&!isNaN(fe.eventStream.period.duration)?fe.eventStream.period.duration:NaN,J=fe.eventStream&&fe.eventStream.period&&!isNaN(fe.eventStream.period.start)?fe.eventStream.period.start:NaN;if(!(isNaN(ue)||isNaN(J))){var ve=fe.calculatedPresentationTime;Math.abs(ve-B)<L&&q(fe,d.default.EVENT_MODE_ON_START)}};he(U,G)}catch(z){p.error(z)}}function he(U,B){try{if(U)for(var G=Object.keys(U),z=0;z<G.length;z++)for(var fe=U[G[z]],ue=Object.keys(fe),J=0;J<ue.length;J++){var ve=fe[ue[J]];ve.forEach(function(me){me!==void 0&&B(me)})}}catch(me){p.error(me)}}function se(U,B,G){try{return U-B>G}catch(z){return p.error(z),!1}}function Z(U){try{var B=U.eventStream.period.start+U.eventStream.period.duration;return U.calculatedPresentationTime>B}catch(G){return p.error(G),!1}}function q(U,B){try{var G=F.getTime(),z=U.id;if(B===d.default.EVENT_MODE_ON_RECEIVE&&!U.triggeredReceivedEvent){p.debug("Received event ".concat(z)),U.triggeredReceivedEvent=!0,m.trigger(U.eventStream.schemeIdUri,{event:U},{mode:B});return}U.triggeredStartEvent||(U.eventStream.schemeIdUri===y&&U.eventStream.value==O?(U.duration!==0||U.presentationTimeDelta!==0)&&(p.debug("Starting manifest refresh event ".concat(z," at ").concat(G)),te()):U.eventStream.schemeIdUri===P&&U.eventStream.value==b?(p.debug("Starting callback event ".concat(z," at ").concat(G)),N(U.messageData)):(p.debug("Starting event ".concat(z," from period ").concat(U.eventStream.period.id," at ").concat(G)),m.trigger(U.eventStream.schemeIdUri,{event:U},{mode:B})),U.triggeredStartEvent=!0)}catch(fe){p.error(fe)}}function le(U,B){try{var G=B.eventStream.schemeIdUri,z=B.eventStream.period.id,fe=B.eventStream.value,ue=B.id;U[z][G]=U[z][G].filter(function(J){return fe&&J.eventStream.value&&J.eventStream.value!==fe||J.id!==ue}),U[z][G].length===0&&delete U[z][G]}catch(J){p.error(J)}}function te(){try{$(),x.refreshManifest()}catch(U){p.error(U)}}function N(U){try{var B=(0,_.default)(T).create({});B.load({method:"get",url:U,request:{responseType:"arraybuffer"}})}catch(G){p.error(G)}}function D(U){try{if(!U)return;U.manifestUpdater&&(x=U.manifestUpdater),U.playbackController&&(F=U.playbackController),U.settings&&(k=U.settings)}catch(B){throw B}}function w(){return C}function W(){return I}function H(){Y(),K()}return M={addInlineEvents:ae,addInbandEvents:ce,getInbandEvents:W,getInlineEvents:w,start:re,setConfig:D,reset:H},Q(),M}E.__dashjs_factory_name="EventController";const c=u.default.getSingletonFactory(E)},"./src/streaming/controllers/FragmentController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>T});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/streaming/vo/DataChunk.js"),f=r("./src/streaming/models/FragmentModel.js"),d=r("./src/streaming/FragmentLoader.js"),_=r("./src/streaming/utils/RequestModifier.js"),E=r("./src/core/EventBus.js"),c=r("./src/core/events/Events.js"),y=r("./src/streaming/MediaPlayerEvents.js"),O=r("./src/core/errors/Errors.js"),P=r("./src/core/FactoryMaker.js"),b=r("./src/core/Debug.js"),L=r("./src/streaming/utils/SegmentResponseModifier.js");function R(m){m=m||{};var M=this.context,p=(0,E.default)(M).getInstance(),C=m.errHandler,I=m.mediaPlayerModel,A=m.dashMetrics,S=(0,b.default)(M).getInstance(),x=(0,L.default)(M).getInstance(),F=m.streamInfo,k,j,V;function Q(){j=S.getLogger(k),Y(),p.on(y.default.FRAGMENT_LOADING_COMPLETED,ee,k),p.on(y.default.FRAGMENT_LOADING_PROGRESS,ee,k)}function $(){return F.id}function K(ne){var ae=V[ne];return ae||(ae=(0,f.default)(M).create({streamInfo:F,type:ne,dashMetrics:A,fragmentLoader:(0,d.default)(M).create({dashMetrics:A,mediaPlayerModel:I,errHandler:C,requestModifier:(0,_.default)(M).getInstance(),settings:m.settings,boxParser:m.boxParser,eventBus:p,events:c.default,errors:O.default,dashConstants:m.dashConstants,urlUtils:m.urlUtils,streamId:$()}),debug:S,eventBus:p,events:c.default}),V[ne]=ae),ae}function Y(){for(var ne in V)V[ne].reset();V={}}function re(){p.off(y.default.FRAGMENT_LOADING_COMPLETED,ee,this),p.off(y.default.FRAGMENT_LOADING_PROGRESS,ee,this),Y()}function ie(ne,ae,ce,X){var oe=new l.default;return oe.streamId=ce,oe.mediaInfo=ae.mediaInfo,oe.segmentType=ae.type,oe.start=ae.startTime,oe.duration=ae.duration,oe.end=oe.start+oe.duration,oe.bytes=ne,oe.index=ae.index,oe.quality=ae.quality,oe.representationId=ae.representationId,oe.endFragment=X,oe}function ee(ne){if(ne.sender){var ae=ne.request,ce=ne.response,X=ae.isInitializationRequest(),oe=ae.mediaInfo.streamInfo;if(ne.error&&(ae.mediaType===u.default.AUDIO||ae.mediaType===u.default.VIDEO||ae.mediaType===u.default.TEXT&&ae.mediaInfo.isFragmented)&&p.trigger(c.default.SERVICE_LOCATION_BLACKLIST_ADD,{entry:ne.request.serviceLocation}),!ce||!oe){j.warn("No "+ae.mediaType+" bytes to push or stream is inactive.");return}var ge=ie(ce,ae,F.id,ne.type!==c.default.FRAGMENT_LOADING_PROGRESS);x.modifyResponseAsync(ge).then(function(_e){p.trigger(X?c.default.INIT_FRAGMENT_LOADED:c.default.MEDIA_FRAGMENT_LOADED,{chunk:_e,request:ae},{streamId:oe.id,mediaType:ae.mediaType})}).catch(function(_e){j.error(_e),p.trigger(X?c.default.INIT_FRAGMENT_LOADED:c.default.MEDIA_FRAGMENT_LOADED,{chunk:ge,request:ae},{streamId:oe.id,mediaType:ae.mediaType})})}}return k={getStreamId:$,getModel:K,reset:re},Q(),k}R.__dashjs_factory_name="FragmentController";const T=P.default.getClassFactory(R)},"./src/streaming/controllers/GapController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>P});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),f=r("./src/core/events/Events.js"),d=r("./src/core/EventBus.js"),_=r("./src/streaming/constants/Constants.js"),E=100,c=10,y=.1;function O(){var b=this.context,L=(0,d.default)(b).getInstance(),R,T,m,M,p,C,I,A,S,x,F,k;function j(){Y()}function V(){k=(0,l.default)(b).getInstance().getLogger(R),Q()}function Q(){se(),re(),$()}function $(){p=null,C=NaN,M=0,x=null,F={}}function K(q){q&&(q.settings&&(m=q.settings),q.playbackController&&(I=q.playbackController),q.streamController&&(A=q.streamController),q.videoModel&&(S=q.videoModel))}function Y(){L.on(f.default.WALLCLOCK_TIME_UPDATED,ce,this),L.on(f.default.INITIAL_STREAM_SWITCH,ae,this),L.on(f.default.PLAYBACK_SEEKING,ie,this),L.on(f.default.BUFFER_REPLACEMENT_STARTED,ee,R),L.on(f.default.TRACK_CHANGE_RENDERED,ne,R)}function re(){L.off(f.default.WALLCLOCK_TIME_UPDATED,ce,this),L.off(f.default.INITIAL_STREAM_SWITCH,ae,this),L.off(f.default.PLAYBACK_SEEKING,ie,this),L.off(f.default.BUFFER_REPLACEMENT_STARTED,ee,R),L.off(f.default.TRACK_CHANGE_RENDERED,ne,R)}function ie(){x&&(clearTimeout(x),x=null)}function ee(q){try{if(q.streamId!==A.getActiveStreamInfo().id||q.mediaType!==_.default.VIDEO&&q.mediaType!==_.default.AUDIO)return;q.streamId===A.getActiveStreamInfo().id&&(F[q.mediaType]=!0)}catch(le){k.error(le)}}function ne(q){!q||!q.mediaType||(F[q.mediaType]=!1)}function ae(){p||he()}function ce(){if(X(m.get().streaming.gaps.enableSeekFix)&&(M++,M>=c)){var q=I.getTime();T===q?Z(q,!0):(T=q,C=NaN),M=0}}function X(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!A.getActiveStream())return!1;var le=Object.keys(F).some(function(N){return F[N]}),te=q?oe():!1;return!le&&m.get().streaming.gaps.jumpGaps&&A.getActiveStreamProcessors().length>0&&(!I.isSeeking()||te)&&!I.isPaused()&&!A.getIsStreamSwitchInProgress()&&!A.getHasMediaOrInitialisationError()}function oe(){var q=A.getActiveStream(),le=parseFloat((q.getStartTime()+q.getDuration()).toFixed(5));return I.getTime()+m.get().streaming.gaps.threshold>=le}function ge(q,le){try{if(!q||q.length<=1&&le>0)return NaN;for(var te=NaN,N=0;isNaN(te)&&N<q.length;){var D=N>0?q.end(N-1):0;le<q.start(N)&&D-le<m.get().streaming.gaps.threshold&&(te=N),N+=1}return te}catch{return null}}function _e(q,le){for(var te=0,N=q.length;te<N;te++)if(le>=q.start(te)&&le<=q.end(te))return!0;return!1}function he(){try{p||(k.debug("Starting the gap controller"),p=setInterval(function(){if(X()){var q=I.getTime();Z(q)}},E))}catch{}}function se(){k.debug("Stopping the gap controller"),p&&(clearInterval(p),p=null)}function Z(q){var le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,te=m.get().streaming.gaps.enableStallFix,N=m.get().streaming.gaps.stallSeek,D=m.get().streaming.gaps.smallGapLimit,w=m.get().streaming.gaps.jumpLargeGaps,W=S.getBufferRange(),H,U=NaN,B=!1;if(H=ge(W,q),!isNaN(H)){var G=W.start(H),z=G-q;z>0&&(z<=D||w)&&(U=G)}var fe=I.getTimeToStreamEnd();if(isNaN(U)&&le&&isFinite(fe)&&!isNaN(fe)&&fe<D&&(U=parseFloat(I.getStreamEndTime().toFixed(5)),B=!0),te&&isNaN(U)&&le&&isNaN(H)&&_e(W,q)&&(N===0?(k.warn("Toggle play pause to break stall"),S.pause(),S.play()):(k.warn("Jumping ".concat(N,"s to break stall")),U=q+N)),U>0&&C!==U&&U>q&&!x){var ue=U-q;if(B){var J=A.getStreamForTime(U),ve=J&&!!J.getPreloaded();k.warn("Jumping to end of stream because of gap from ".concat(q," to ").concat(U,". Gap duration: ").concat(ue)),I.seek(U,!0,ve)}else{var me=I.getIsDynamic(),Ae=H>0?W.end(H-1):q,be=me?Math.max(0,ue-y)*1e3:0;x=window.setTimeout(function(){I.seek(U,!0,!0),k.warn("Jumping gap occuring in period ".concat(A.getActiveStream().getStreamId()," starting at ").concat(Ae," and ending at ").concat(U,". Jumping by: ").concat(U-Ae)),x=null},be)}C=U}}return R={reset:Q,setConfig:K,initialize:j},V(),R}O.__dashjs_factory_name="GapController";const P=u.default.getSingletonFactory(O)},"./src/streaming/controllers/MediaController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>b});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/core/events/Events.js"),f=r("./src/core/EventBus.js"),d=r("./src/core/FactoryMaker.js"),_=r("./src/core/Debug.js"),E=r("./node_modules/bcp-47-normalize/index.js"),c=r.n(E),y=r("./node_modules/bcp-47-match/index.js");function O(){var L=this.context,R=(0,f.default)(L).getInstance(),T,m,M,p,C,I,A,S;function x(){m=(0,_.default)(L).getInstance().getLogger(T),ae()}function F(ue,J){var ve=I[ue]||Y(ue),me=j(ue,J.id),Ae=[];ve||(ve=S.getSavedMediaSettings(ue),K(ue,ve)),!(!me||me.length===0)&&(ve&&(Ae=Array.from(me),Ae=X(Ae,oe,ve),Ae=X(Ae,ge,ve),Ae=X(Ae,_e,ve),ue===u.default.AUDIO&&I[ue]||(Ae=X(Ae,he,ve)),Ae=X(Ae,se,ve),Ae=X(Ae,Z,ve)),Ae.length===0?$(W(ue,me),!0):Ae.length>1?$(W(ue,Ae,!!I[ue])):$(Ae[0]))}function k(ue){if(ue){var J=ue.type;if(ie(J)){var ve=ue.streamInfo.id;M[ve]||(M[ve]=fe());for(var me=M[ve][J].list,Ae=0,be=me.length;Ae<be;++Ae)if(ee(me[Ae],ue))return;me.push(ue)}}}function j(ue,J){return ue?!M[J]||!M[J][ue]?[]:M[J][ue].list:[]}function V(ue,J){return!ue||!M[J]||!M[J][ue]?null:M[J][ue].current}function Q(ue){if(!ue)return!1;var J=ue.type,ve=ue.streamInfo.id;return M[ve]&&M[ve][J]&&ee(M[ve][J].current,ue)}function $(ue){var J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!ue||!ue.streamInfo)){var ve=ue.type,me=ue.streamInfo,Ae=me.id,be=V(ve,Ae);if(!(!M[Ae]||!M[Ae][ve])&&(M[Ae][ve].current=ue,M[Ae][ve].current&&(ve!==u.default.TEXT&&!ee(ue,be)||ve===u.default.TEXT&&ue.isFragmented)&&R.trigger(l.default.CURRENT_TRACK_CHANGED,{oldMediaInfo:be,newMediaInfo:ue,switchMode:p.get().streaming.trackSwitchMode[ve]},{streamId:Ae}),!J)){var Be=ce(ue);if(!Be||!M[Ae][ve].storeLastSettings)return;Be.roles&&(Be.role=Be.roles[0],delete Be.roles),Be.accessibility&&(Be.accessibility=Be.accessibility[0]),Be.audioChannelConfiguration&&(Be.audioChannelConfiguration=Be.audioChannelConfiguration[0]),I[ve]=Be,S.setSavedMediaSettings(ve,Be)}}}function K(ue,J){!ue||!J||(C[ue]=J)}function Y(ue){return ue?C[ue]:null}function re(){S.setSavedMediaSettings(u.default.TEXT,null)}function ie(ue){return ue===u.default.AUDIO||ue===u.default.VIDEO||ue===u.default.TEXT||ue===u.default.IMAGE}function ee(ue,J){if(!ue&&!J)return!0;if(!ue||!J)return!1;var ve=ue.id===J.id,me=ue.viewpoint===J.viewpoint,Ae=ue.lang===J.lang,be=ue.codec===J.codec,Be=ue.roles.toString()===J.roles.toString(),ke=ue.accessibility.toString()===J.accessibility.toString(),Ye=ue.audioChannelConfiguration.toString()===J.audioChannelConfiguration.toString();return ve&&be&&me&&Ae&&Be&&ke&&Ye}function ne(ue){ue&&(ue.domStorage&&(S=ue.domStorage),ue.settings&&(p=ue.settings),ue.customParametersModel&&(A=ue.customParametersModel))}function ae(){M={},I={},le()}function ce(ue){var J={lang:ue.lang,viewpoint:ue.viewpoint,roles:ue.roles,accessibility:ue.accessibility,audioChannelConfiguration:ue.audioChannelConfiguration},ve=J.lang||J.viewpoint||J.role&&J.role.length>0||J.accessibility&&J.accessibility.length>0||J.audioChannelConfiguration&&J.audioChannelConfiguration.length>0;return ve?J:null}function X(ue,J,ve){var me=[];return ue.forEach(function(Ae){J(ve,Ae)&&me.push(Ae)}),me.length!==0?me:ue}function oe(ue,J){return!ue.lang||ue.lang instanceof RegExp?J.lang.match(ue.lang):J.lang!==""?(0,y.extendedFilter)(J.lang,c()(ue.lang)).length>0:!1}function ge(ue,J){return ue.index===void 0||ue.index===null||J.index===ue.index}function _e(ue,J){return!ue.viewpoint||ue.viewpoint===J.viewpoint}function he(ue,J){var ve=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,me=!ue.role||!!J.roles.filter(function(Ae){return Ae===ue.role})[0];return me||J.type===u.default.AUDIO&&ve}function se(ue,J){var ve;return ue.accessibility?ve=!!J.accessibility.filter(function(me){return me===ue.accessibility})[0]:ve=!J.accessibility.length,ve}function Z(ue,J){var ve=!ue.audioChannelConfiguration||!!J.audioChannelConfiguration.filter(function(me){return me===ue.audioChannelConfiguration})[0];return ve}function q(ue,J){var ve=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;try{var me=!1;if(!ue.lang)me=!0;else if(ue.lang instanceof RegExp)me=J.lang.match(ue.lang);else if(J.lang!==""){var Ae=c()(ue.lang);Ae&&(me=(0,y.extendedFilter)(J.lang,Ae).length>0)}var be=ue.index===void 0||ue.index===null||J.index===ue.index,Be=!ue.viewpoint||ue.viewpoint===J.viewpoint,ke=!ue.role||!!J.roles.filter(function(Se){return Se===ue.role})[0],Ye=!ue.accessibility||!!J.accessibility.filter(function(Se){return Se===ue.accessibility})[0],Le=!ue.audioChannelConfiguration||!!J.audioChannelConfiguration.filter(function(Se){return Se===ue.audioChannelConfiguration})[0];return me&&be&&Be&&(ke||J.type===u.default.AUDIO&&ve)&&Ye&&Le}catch{return!1}}function le(){C={audio:null,video:null,text:null}}function te(ue){var J=0,ve=[];return ue.forEach(function(me){isNaN(me.selectionPriority)||(me.selectionPriority>J?(J=me.selectionPriority,ve=[me]):me.selectionPriority===J&&ve.push(me))}),ve}function N(ue){var J=0,ve=[],me;return ue.forEach(function(Ae){me=Math.max.apply(Math,Ae.bitrateList.map(function(be){return be.bandwidth})),me>J?(J=me,ve=[Ae]):me===J&&ve.push(Ae)}),ve}function D(ue){var J=1/0,ve=[],me;return ue.forEach(function(Ae){var be=Ae.bitrateList.reduce(function(Be,ke){var Ye=Math.max(1,ke.width*ke.height),Le=ke.bandwidth/Ye;return Be+Le},0);me=be/Ae.bitrateList.length,me<J?(J=me,ve=[Ae]):me===J&&ve.push(Ae)}),ve}function w(ue){var J=0,ve=[],me;return ue.forEach(function(Ae){me=Ae.representationCount,me>J?(J=me,ve=[Ae]):me===J&&ve.push(Ae)}),ve}function W(ue,J){if(ue===u.default.TEXT)return J[0];var ve=p.get().streaming.selectionModeForInitialTrack,me,Ae=A.getCustomInitialTrackSelectionFunction();if(Ae&&typeof Ae=="function")me=Ae(J);else switch(ve){case u.default.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY:me=H(J);break;case u.default.TRACK_SELECTION_MODE_HIGHEST_BITRATE:me=U(J);break;case u.default.TRACK_SELECTION_MODE_FIRST_TRACK:me=B(J);break;case u.default.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:me=G(J);break;case u.default.TRACK_SELECTION_MODE_WIDEST_RANGE:me=z(J);break;default:m.warn("Track selection mode ".concat(ve," is not supported. Falling back to TRACK_SELECTION_MODE_FIRST_TRACK")),me=B(J);break}return me.length>0?me[0]:J[0]}function H(ue){var J=te(ue);return J.length>1&&(J=N(J)),J.length>1&&(J=w(J)),J}function U(ue){var J=N(ue);return J.length>1&&(J=w(J)),J}function B(ue){return ue[0]}function G(ue){var J=D(ue);return J.length>1&&(J=N(J)),J}function z(ue){var J=w(ue);return J.length>1&&(J=N(ue)),J}function fe(){return{audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},image:{list:[],storeLastSettings:!0,current:null}}}return T={setInitialMediaSettingsForType:F,addTrack:k,getTracksFor:j,getCurrentTrackFor:V,isCurrentTrack:Q,setTrack:$,selectInitialTrack:W,setInitialSettings:K,getInitialSettings:Y,getTracksWithHighestBitrate:N,getTracksWithHighestEfficiency:D,getTracksWithWidestRange:w,isTracksEqual:ee,matchSettings:q,matchSettingsLang:oe,matchSettingsIndex:ge,matchSettingsViewPoint:_e,matchSettingsRole:he,matchSettingsAccessibility:se,matchSettingsAudioChannelConfig:Z,saveTextSettingsDisabled:re,setConfig:ne,reset:ae},x(),T}O.__dashjs_factory_name="MediaController";var P=d.default.getSingletonFactory(O);d.default.updateSingletonFactory(O.__dashjs_factory_name,P);const b=P},"./src/streaming/controllers/MediaSourceController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js");function f(){var _,E,c,y=this.context;function O(){c=(0,l.default)(y).getInstance().getLogger(_)}function P(){var p="WebKitMediaSource"in window,C="MediaSource"in window;return C?E=new MediaSource:p&&(E=new WebKitMediaSource),E}function b(p){var C=window.URL.createObjectURL(E);return p.setSource(C),C}function L(p){p.setSource(null)}function R(p){!E||E.readyState!=="open"||p===null&&isNaN(p)||E.duration!==p&&(M(E)?setTimeout(R.bind(null,p),50):(c.info("Set MediaSource duration:"+p),E.duration=p))}function T(p,C){E&&typeof E.setLiveSeekableRange=="function"&&typeof E.clearLiveSeekableRange=="function"&&E.readyState==="open"&&p>=0&&p<C&&(E.clearLiveSeekableRange(),E.setLiveSeekableRange(p,C))}function m(p){if(!(!p||p.readyState!=="open")){for(var C=p.sourceBuffers,I=0;I<C.length;I++)if(C[I].updating||C[I].buffered.length===0)return;c.info("call to mediaSource endOfStream"),p.endOfStream()}}function M(p){for(var C=p.sourceBuffers,I=0;I<C.length;I++)if(C[I].updating)return!0;return!1}return _={createMediaSource:P,attachMediaSource:b,detachMediaSource:L,setDuration:R,setSeekable:T,signalEndOfStream:m},O(),_}f.__dashjs_factory_name="MediaSourceController";const d=u.default.getSingletonFactory(f)},"./src/streaming/controllers/PlaybackController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>P});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js"),d=r("./src/core/FactoryMaker.js"),_=r("./src/core/Debug.js"),E=r("./src/streaming/MediaPlayerEvents.js"),c=r("./src/streaming/constants/MetricsConstants.js"),y=500;function O(){var b=this.context,L=(0,l.default)(b).getInstance(),R,T,m,M,p,C,I,A,S,x,F,k,j,V,Q,$,K,Y,re,ie,ee,ne,ae,ce;function X(){T=(0,_.default)(b).getInstance().getLogger(R),oe()}function oe(){le(),V=!1,x=0,F=0,$=0,ne=!1,K=!0,Y=!1,ae=!1,re=NaN,I&&(L.off(f.default.DATA_UPDATE_COMPLETED,at,R),L.off(f.default.LOADING_PROGRESS,Ze,R),L.off(f.default.MANIFEST_UPDATED,jt,R),L.off(f.default.STREAMS_COMPOSED,Gt,R),L.off(E.default.PLAYBACK_ENDED,et,R),L.off(E.default.STREAM_INITIALIZING,ct,R),L.off(E.default.REPRESENTATION_SWITCH,Tt,R),L.off(E.default.BUFFER_LEVEL_STATE_CHANGED,Ge,R),it(),ft()),S=null,I=null,k=null,j=null}function ge(Ie,we){k=Ie,we!==!0&&_e()}function _e(){Ve(),j=k.manifestInfo.isDynamic,ee=!1,ie=!1,L.on(f.default.DATA_UPDATE_COMPLETED,at,R),L.on(f.default.LOADING_PROGRESS,Ze,R),L.on(f.default.MANIFEST_UPDATED,jt,R),L.on(f.default.STREAMS_COMPOSED,Gt,R),L.on(E.default.PLAYBACK_ENDED,et,R,{priority:l.default.EVENT_PRIORITY_HIGH}),L.on(E.default.STREAM_INITIALIZING,ct,R),L.on(E.default.REPRESENTATION_SWITCH,Tt,R),L.on(E.default.BUFFER_LEVEL_STATE_CHANGED,Ge,R),V&&(V=!1,q())}function he(){return ee}function se(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return parseFloat((Z(Ie)-H()).toFixed(5))}function Z(Ie){var we=Ie||k;return we.start+we.duration}function q(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;k&&I&&I.getElement()?(Ie&&j&&W(H()),I.play()):V=!0}function le(){k&&I&&I.pause()}function te(Ie){var we=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,_t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!(!k||!I)){var Nt=isNaN(re)?I.getTime():re;Ie!==Nt&&(ie=ze===!0,ie||(re=Ie),T.info("Requesting seek to time: "+Ie+(ie?" (internal)":"")),j&&_t&&W(Ie),I.setCurrentTime(Ie,we))}}function N(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,we=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,_t=w();if(_t!==0){x=F;var Nt=_t-x;te(Nt,Ie,we,ze)}}function D(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,we=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,_t=w();if(_t!==0){var Nt=_t-x;te(Nt,Ie,we,ze)}}function w(){if(!(!k||!I||!j)){var Ie=m&&m.hasVideoTrack()?u.default.VIDEO:u.default.AUDIO,we=p.getCurrentDVRInfo(Ie);return we&&we.range?we.range.end:0}}function W(Ie){var we=new Date(A.getClientReferenceTime()),ze=C.getRegularPeriods()[0],_t=A.calcPresentationTimeFromWallTime(we,ze);x=_t-Ie}function H(){return k&&I?I.getTime():null}function U(){return k&&I?I.isPaused():null}function B(){return k&&I?I.isSeeking():null}function G(){return k&&I?I.isStalled():null}function z(){return k&&I?I.getPlaybackRate():null}function fe(){return k&&I?I.getPlayedRanges():null}function ue(){return k&&I?I.getEnded():null}function J(){return j}function ve(){return m}function me(){return ne}function Ae(){return $}function be(){return x}function Be(){return F}function ke(){if(!j||isNaN($))return NaN;var Ie=H();if(isNaN(Ie)||Ie===0)return 0;var we=new Date().getTime()+A.getClientTimeOffset()*1e3;return Math.max(((we-$-Ie*1e3)/1e3).toFixed(3),0)}function Ye(Ie,we){var ze,_t,Nt,It=4,Dt=4,Zt=!isNaN(Ie)&&isFinite(Ie)?Ie:NaN,Wt=C.getSuggestedPresentationDelay(),Je=M.getServiceDescriptionSettings();return isNaN(ce.get().streaming.delay.liveDelay)?ce.get().streaming.delay.liveDelayFragmentCount!==null&&!isNaN(ce.get().streaming.delay.liveDelayFragmentCount)&&!isNaN(Zt)?ze=Zt*ce.get().streaming.delay.liveDelayFragmentCount:Je&&!isNaN(Je.liveDelay)&&Je.liveDelay>0?ze=Je.liveDelay:ce.get().streaming.delay.useSuggestedPresentationDelay===!0&&Wt!==null&&!isNaN(Wt)&&Wt>0?ze=Wt:isNaN(Zt)?ze=we&&!isNaN(we.minBufferTime)?we.minBufferTime*It:k.manifestInfo.minBufferTime*It:ze=Zt*Dt:ze=ce.get().streaming.delay.liveDelay,Nt=C.getAvailabilityStartTime(),Nt!==null&&($=Nt),we&&we.dvrWindowSize>0?_t=Math.min(ze,we.dvrWindowSize):_t=ze,x=_t,F=_t,_t}function Le(Ie){Ie&&(Ie.streamController&&(m=Ie.streamController),Ie.serviceDescriptionController&&(M=Ie.serviceDescriptionController),Ie.dashMetrics&&(p=Ie.dashMetrics),Ie.adapter&&(C=Ie.adapter),Ie.videoModel&&(I=Ie.videoModel),Ie.timelineConverter&&(A=Ie.timelineConverter),Ie.settings&&(ce=Ie.settings))}function Se(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(!(U()||!j||I.getReadyState()===0||B()||ne)){Ie||(Ie=m.hasVideoTrack()?u.default.VIDEO:u.default.AUDIO);var we=H(),ze=Me(we,Ie),_t=!isNaN(ze)&&ze!==we;_t&&!B()&&(G()||ee||I.getReadyState()===1)&&(T.debug("UpdateCurrentTime: Seek to actual time: ".concat(ze," from currentTime: ").concat(we)),te(ze,!1,!1))}}function Me(Ie,we){var ze=p.getCurrentDVRInfo(we),_t=ze?ze.range:null,Nt;return _t?(Ie>_t.end?Nt=Math.max(_t.end-x,_t.start):Ie>0&&Ie+.25<_t.start&&Math.abs(Ie-_t.start)<31536e4?Y?Nt=Math.max(_t.end-x,_t.start):Nt=_t.start:Nt=Ie,Nt):NaN}function qe(){S===null&&(S=setInterval(function(){yt()},ce.get().streaming.wallclockTimeUpdateInterval))}function it(){clearInterval(S),S=null}function at(Ie){var we=C.convertRepresentationToRepresentationInfo(Ie.currentRepresentation),ze=we?we.mediaInfo.streamInfo:null;ze===null||k.id!==ze.id||(k=ze)}function Ce(){L.trigger(f.default.CAN_PLAY)}function je(){L.trigger(f.default.CAN_PLAY_THROUGH)}function Ge(Ie){Ie.streamId===m.getActiveStreamInfo().id&&(ee=Ie.state===c.default.BUFFER_EMPTY,ce.get().streaming.buffer.setStallState&&I.setStallState(Ie.mediaType,Ie.state===c.default.BUFFER_EMPTY))}function tt(){T.info("Native video element event: play"),Se(),qe(),L.trigger(f.default.PLAYBACK_STARTED,{startTime:H()})}function ot(){T.info("Native video element event: waiting"),L.trigger(f.default.PLAYBACK_WAITING,{playingTime:H()})}function dt(){T.info("Native video element event: playing"),ie=!1,L.trigger(f.default.PLAYBACK_PLAYING,{playingTime:H()})}function gt(){T.info("Native video element event: pause"),L.trigger(f.default.PLAYBACK_PAUSED,{ended:ue()})}function Mt(){if(!ie){var Ie=H();!isNaN(re)&&re!==Ie&&(Ie=re),re=NaN,T.info("Seeking to: "+Ie),qe(),L.trigger(f.default.PLAYBACK_SEEKING,{seekTime:Ie,streamId:k.id})}}function $e(){T.info("Native video element event: seeked"),ie=!1,L.trigger(f.default.PLAYBACK_SEEKED)}function Te(){k&&L.trigger(f.default.PLAYBACK_TIME_UPDATED,{timeToEnd:se(),time:H(),streamId:k.id})}function de(){L.trigger(f.default.PLAYBACK_PROGRESS,{streamId:k.id})}function Re(){var Ie=z();T.info("Native video element event: ratechange: ",Ie),L.trigger(f.default.PLAYBACK_RATE_CHANGED,{playbackRate:Ie})}function xe(){T.info("Native video element event: loadedmetadata"),L.trigger(f.default.PLAYBACK_METADATA_LOADED),qe()}function Ne(){T.info("Native video element event: loadeddata"),L.trigger(f.default.PLAYBACK_LOADED_DATA)}function Xe(){T.info("Native video element event: ended"),le(),it();var Ie=m?m.getActiveStreamInfo():null;Ie&&L.trigger(f.default.PLAYBACK_ENDED,{isLast:Ie.isLast})}function nt(){L.trigger(f.default.PLAYBACK_VOLUME_CHANGED)}function et(Ie){if(S&&Ie.isLast){T.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");var we=Ie.seekTime?Ie.seekTime:Z();I.setCurrentTime(we),le(),it()}}function ht(Ie){var we=Ie.target||Ie.srcElement;L.trigger(f.default.PLAYBACK_ERROR,{error:we.error})}function yt(){L.trigger(f.default.WALLCLOCK_TIME_UPDATED,{isDynamic:j,time:new Date}),J()&&(m.addDVRMetric(),U()?Pt():Se())}function Pt(){var Ie=Date.now();(!Q||Ie>Q+y)&&(Q=Ie,Te())}function De(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,we=null;return m.getActiveStreamProcessors().forEach(function(ze){if(!Ie||Ie.length===0||Ie.indexOf(ze.getType())===-1){var _t=ze.getBufferLevel();we===null?we=_t:we=Math.min(we,_t)}}),we}function Ue(){return Y}function Ze(Ie){if(Ie.stream===!1&&Y&&!isNaN(Ie.request.duration)){var we=1.2*Ie.request.duration;we>x&&(T.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",we.toFixed(2)),x=we,F=we)}}function Et(Ie){L.trigger(f.default.PLAYBACK_STALLED,{e:Ie})}function ct(Ie){pe(Ie.mediaInfo)}function Tt(Ie){var we=m.getActiveStreamInfo();!Ie||!we||!Ie.currentRepresentation||!Ie.streamId||Ie.streamId!==we.id||!Ie.mediaType||Ie.mediaType!==u.default.VIDEO&&Ie.mediaType!==u.default.AUDIO||(K=Ie.currentRepresentation.availabilityTimeComplete,Y=!K,Y&&!ae&&(ae=!0))}function Ot(){return ae}function jt(){ne=!0}function Gt(){ne=!1}function pe(Ie){Ie&&Ie.supplementalProperties&&Ie.supplementalProperties[u.default.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME]==="true"&&(T.debug("Low Latency critical SupplementalProperty set: Enabling low Latency"),Y=!0)}function Ve(){I.addEventListener("canplay",Ce),I.addEventListener("canplaythrough",je),I.addEventListener("play",tt),I.addEventListener("waiting",ot),I.addEventListener("playing",dt),I.addEventListener("pause",gt),I.addEventListener("error",ht),I.addEventListener("seeking",Mt),I.addEventListener("seeked",$e),I.addEventListener("timeupdate",Te),I.addEventListener("progress",de),I.addEventListener("ratechange",Re),I.addEventListener("loadedmetadata",xe),I.addEventListener("loadeddata",Ne),I.addEventListener("stalled",Et),I.addEventListener("ended",Xe),I.addEventListener("volumechange",nt)}function ft(){I.removeEventListener("canplay",Ce),I.removeEventListener("canplaythrough",je),I.removeEventListener("play",tt),I.removeEventListener("waiting",ot),I.removeEventListener("playing",dt),I.removeEventListener("pause",gt),I.removeEventListener("error",ht),I.removeEventListener("seeking",Mt),I.removeEventListener("seeked",$e),I.removeEventListener("timeupdate",Te),I.removeEventListener("progress",de),I.removeEventListener("ratechange",Re),I.removeEventListener("loadedmetadata",xe),I.removeEventListener("loadeddata",Ne),I.removeEventListener("stalled",Et),I.removeEventListener("ended",Xe),I.removeEventListener("volumechange",nt)}return R={initialize:ge,setConfig:Le,getTimeToStreamEnd:se,getBufferLevel:De,getPlaybackStalled:he,getTime:H,getLowLatencyModeEnabled:Ue,getInitialCatchupModeActivated:Ot,getIsManifestUpdateInProgress:me,getPlaybackRate:z,getPlayedRanges:fe,getEnded:ue,getIsDynamic:J,getStreamController:ve,computeAndSetLiveDelay:Ye,getLiveDelay:be,getOriginalLiveDelay:Be,getCurrentLiveLatency:ke,play:q,isPaused:U,isStalled:G,pause:le,isSeeking:B,getStreamEndTime:Z,seek:te,seekToOriginalLive:N,seekToCurrentLive:D,reset:oe,updateCurrentTime:Se,getAvailabilityStartTime:Ae},X(),R}O.__dashjs_factory_name="PlaybackController";const P=d.default.getSingletonFactory(O)},"./src/streaming/controllers/ScheduleController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>P});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/streaming/models/FragmentModel.js"),f=r("./src/core/EventBus.js"),d=r("./src/core/events/Events.js"),_=r("./src/core/FactoryMaker.js"),E=r("./src/core/Debug.js"),c=r("./src/streaming/constants/MetricsConstants.js"),y=r("./src/streaming/MediaPlayerEvents.js");function O(b){b=b||{};var L=this.context,R=(0,f.default)(L).getInstance(),T=b.dashMetrics,m=b.mediaPlayerModel,M=b.fragmentModel,p=b.abrController,C=b.playbackController,I=b.textController,A=b.type,S=b.bufferController,x=b.settings,F,k,j,V,Q,$,K,Y,re,ie,ee,ne,ae;function ce(){j=(0,E.default)(L).getInstance().getLogger(F),Ye(),k=b.streamInfo}function X(Me){K=Me,R.on(d.default.BYTES_APPENDED_END_FRAGMENT,ue,F),R.on(d.default.URL_RESOLUTION_FAILED,J,F),R.on(y.default.PLAYBACK_STARTED,ve,F),R.on(y.default.PLAYBACK_RATE_CHANGED,me,F),R.on(y.default.PLAYBACK_TIME_UPDATED,z,F)}function oe(){return A}function ge(){return k.id}function _e(Me){V=Me}function he(Me){if(!S.getIsBufferingCompleted()){se();var qe=isNaN(Me)?0:Me;$=setTimeout(q,qe)}}function se(){$&&(clearTimeout($),$=null)}function Z(){var Me=k.id,qe=p.getMaxAllowedIndexFor(A,Me);return isNaN(re)||re!=qe?(j.info("Top quality "+A+" index has changed from "+re+" to "+qe),re=qe,!0):!1}function q(){try{if(te()){se();return}if(N()){var Me=!1;ae&&(Me=p.checkPlaybackQuality(A,k.id)),Me||le()}else he(C.getLowLatencyModeEnabled()?x.get().streaming.scheduling.lowLatencyTimeout:x.get().streaming.scheduling.defaultTimeout)}catch{he(C.getLowLatencyModeEnabled()?x.get().streaming.scheduling.lowLatencyTimeout:x.get().streaming.scheduling.defaultTimeout)}}function le(){ne||V.quality!==ie||ee?(ee?(j.debug("Switch track for "+A+", representation id = "+V.id),ee=!1):j.debug("Quality has changed, get init request for representationid = "+V.id),R.trigger(d.default.INIT_FRAGMENT_NEEDED,{representationId:V.id,sender:F},{streamId:k.id,mediaType:A}),ae=!1,ne=!1):(j.debug("Media segment needed for ".concat(A," and stream id ").concat(k.id)),R.trigger(d.default.MEDIA_FRAGMENT_NEEDED,{},{streamId:k.id,mediaType:A}),ae=!0)}function te(){try{return A===u.default.TEXT&&!I.isTextEnabled()||C.isPaused()&&(!C.getStreamController().getInitialPlayback()||!C.getStreamController().getAutoPlay())&&!x.get().streaming.scheduling.scheduleWhilePaused}catch{return!1}}function N(){try{return V&&(isNaN(ie)||ee||Z()||D())}catch{return!1}}function D(){if(!A||!V)return!0;var Me=T.getCurrentBufferLevel(A);return Me<w()}function w(){var Me=NaN;return!A||!V||(A===u.default.TEXT?Me=W():A===u.default.AUDIO&&K?Me=H():Me=U()),Me}function W(){try{if(I.isTextEnabled())if(isNaN(V.fragmentDuration)){var Me=T.getCurrentSchedulingInfo(c.default.SCHEDULING_INFO);return Me?Me.duration:0}else return V.fragmentDuration;else return 0}catch{return 0}}function H(){try{var Me=T.getCurrentBufferLevel(u.default.VIDEO);return isNaN(V.fragmentDuration)?Me+1:Math.max(Me+1,V.fragmentDuration)}catch{return 0}}function U(){try{var Me=V.mediaInfo.streamInfo;if(p.isPlayingAtTopQuality(Me)){var qe=Me.manifestInfo.duration>=x.get().streaming.buffer.longFormContentDurationThreshold;return qe?x.get().streaming.buffer.bufferTimeAtTopQualityLongForm:x.get().streaming.buffer.bufferTimeAtTopQuality}else return m.getStableBufferTime()}catch{return m.getStableBufferTime()}}function B(Me){ee=Me}function G(){return ee}function z(){fe(!0)}function fe(Me){if(C&&M){var qe=M.getRequests({state:l.default.FRAGMENT_MODEL_EXECUTED,time:C.getTime(),threshold:0})[0];qe&&C.getTime()>=qe.startTime&&((!Y.mediaInfo||qe.mediaInfo.type===Y.mediaInfo.type&&qe.mediaInfo.id!==Y.mediaInfo.id)&&Me&&R.trigger(d.default.TRACK_CHANGE_RENDERED,{mediaType:A,oldMediaInfo:Y.mediaInfo,newMediaInfo:qe.mediaInfo,streamId:k.id}),(qe.quality!==Y.quality||qe.adaptationIndex!==Y.adaptationIndex)&&Me&&(j.debug("Quality change rendered for streamId ".concat(k.id," and type ").concat(A)),R.trigger(d.default.QUALITY_CHANGE_RENDERED,{mediaType:A,oldQuality:Y.quality,newQuality:qe.quality,streamId:k.id})),Y={mediaInfo:qe.mediaInfo,quality:qe.quality,adaptationIndex:qe.adaptationIndex})}}function ue(Me){j.debug("Appended bytes for ".concat(Me.mediaType," and stream id ").concat(k.id)),(isNaN(Me.index)||isNaN(ie))&&(ie=Me.quality,j.info("["+A+"] lastInitializedRepresentationInfo changed to "+Me.quality)),he(0)}function J(){M.abortRequests(),se()}function ve(){x.get().streaming.scheduling.scheduleWhilePaused||he()}function me(Me){T.updatePlayListTraceMetrics({playbackspeed:Me.playbackRate.toString()})}function Ae(Me){Q=Me}function be(){return Q}function Be(Me){ae=Me}function ke(Me){ne=Me}function Ye(){ae=!0,Q=0,ie=NaN,Y={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},re=NaN,ee=!1,ne=!1}function Le(){R.off(d.default.BYTES_APPENDED_END_FRAGMENT,ue,F),R.off(d.default.URL_RESOLUTION_FAILED,J,F),R.off(y.default.PLAYBACK_STARTED,ve,F),R.off(y.default.PLAYBACK_RATE_CHANGED,me,F),R.off(y.default.PLAYBACK_TIME_UPDATED,z,F),se(),fe(!1),Ye(),k=null}function Se(){return C}return F={initialize:X,getType:oe,getStreamId:ge,setCurrentRepresentation:_e,setTimeToLoadDelay:Ae,getTimeToLoadDelay:be,setSwitchTrack:B,getSwitchStrack:G,startScheduleTimer:he,clearScheduleTimer:se,reset:Le,getBufferTarget:w,getPlaybackController:Se,setCheckPlaybackQuality:Be,setInitSegmentRequired:ke},ce(),F}O.__dashjs_factory_name="ScheduleController";const P=_.default.getClassFactory(O)},"./src/streaming/controllers/StreamController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>Q});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/streaming/constants/MetricsConstants.js"),f=r("./src/streaming/Stream.js"),d=r("./src/streaming/ManifestUpdater.js"),_=r("./src/core/EventBus.js"),E=r("./src/core/events/Events.js"),c=r("./src/core/FactoryMaker.js"),y=r("./src/streaming/vo/metrics/PlayList.js"),O=r("./src/core/Debug.js"),P=r("./src/streaming/utils/InitCache.js"),b=r("./src/streaming/MediaPlayerEvents.js"),L=r("./src/streaming/controllers/TimeSyncController.js"),R=r("./src/streaming/controllers/MediaSourceController.js"),T=r("./src/streaming/vo/DashJSError.js"),m=r("./src/core/errors/Errors.js"),M=r("./src/streaming/controllers/EventController.js"),p=r("./src/streaming/constants/ConformanceViolationConstants.js");function C($){return x($)||S($)||A($)||I()}function I(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A($,K){if($){if(typeof $=="string")return F($,K);var Y=Object.prototype.toString.call($).slice(8,-1);if(Y==="Object"&&$.constructor&&(Y=$.constructor.name),Y==="Map"||Y==="Set")return Array.from($);if(Y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Y))return F($,K)}}function S($){if(typeof Symbol<"u"&&Symbol.iterator in Object($))return Array.from($)}function x($){if(Array.isArray($))return F($)}function F($,K){(K==null||K>$.length)&&(K=$.length);for(var Y=0,re=new Array(K);Y<K;Y++)re[Y]=$[Y];return re}var k=200,j=2;function V(){var $=this.context,K=(0,_.default)($).getInstance(),Y,re,ie,ee,ne,ae,ce,X,oe,ge,_e,he,se,Z,q,le,te,N,D,w,W,H,U,B,G,z,fe,ue,J,ve,me,Ae,be,Be,ke,Ye,Le,Se,Me,qe,it,at,Ce,je,Ge,tt,ot,dt;function gt(){re=(0,O.default)($).getInstance().getLogger(Y),_e=(0,L.default)($).getInstance(),ge=(0,R.default)($).getInstance(),D=(0,P.default)($).getInstance(),Nn()}function Mt(Oe,rt){de(),fe=Oe,z=rt,W.initialize(),ne=(0,d.default)($).create(),ne.setConfig({manifestModel:ce,adapter:X,manifestLoader:ae,errHandler:w,settings:je}),ne.initialize(),N=(0,M.default)($).getInstance(),N.setConfig({manifestUpdater:ne,playbackController:be,settings:je}),N.start(),_e.setConfig({dashMetrics:oe,baseURLController:se,errHandler:w,settings:je}),_e.initialize(),B&&(K.trigger(E.default.PROTECTION_CREATED,{controller:B}),B.setMediaElement(Ae.getElement()),z&&B.setProtectionData(z)),$e()}function $e(){K.on(b.default.PLAYBACK_TIME_UPDATED,_t,Y),K.on(b.default.PLAYBACK_SEEKING,Ze,Y),K.on(b.default.PLAYBACK_ERROR,Qr,Y),K.on(b.default.PLAYBACK_STARTED,Nt,Y),K.on(b.default.PLAYBACK_PAUSED,It,Y),K.on(b.default.PLAYBACK_ENDED,Pe,Y),K.on(b.default.METRIC_ADDED,Fn,Y),K.on(b.default.MANIFEST_VALIDITY_CHANGED,xn,Y),K.on(b.default.BUFFER_LEVEL_UPDATED,Ie,Y),K.on(b.default.QUALITY_CHANGE_REQUESTED,we,Y),E.default.KEY_SESSION_UPDATED&&K.on(E.default.KEY_SESSION_UPDATED,nt,Y),K.on(E.default.MANIFEST_UPDATED,_r,Y),K.on(E.default.STREAM_BUFFERING_COMPLETED,Dt,Y),K.on(E.default.TIME_SYNCHRONIZATION_COMPLETED,Xe,Y),K.on(E.default.CURRENT_TRACK_CHANGED,jt,Y),K.on(E.default.SETTING_UPDATED_LIVE_DELAY,ze,Y),K.on(E.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,ze,Y)}function Te(){K.off(b.default.PLAYBACK_TIME_UPDATED,_t,Y),K.off(b.default.PLAYBACK_SEEKING,Ze,Y),K.off(b.default.PLAYBACK_ERROR,Qr,Y),K.off(b.default.PLAYBACK_STARTED,Nt,Y),K.off(b.default.PLAYBACK_PAUSED,It,Y),K.off(b.default.PLAYBACK_ENDED,Pe,Y),K.off(b.default.METRIC_ADDED,Fn,Y),K.off(b.default.MANIFEST_VALIDITY_CHANGED,xn,Y),K.off(b.default.BUFFER_LEVEL_UPDATED,Ie,Y),K.off(b.default.QUALITY_CHANGE_REQUESTED,we,Y),E.default.KEY_SESSION_UPDATED&&K.off(E.default.KEY_SESSION_UPDATED,nt,Y),K.off(E.default.MANIFEST_UPDATED,_r,Y),K.off(E.default.STREAM_BUFFERING_COMPLETED,Dt,Y),K.off(E.default.TIME_SYNCHRONIZATION_COMPLETED,Xe,Y),K.off(E.default.CURRENT_TRACK_CHANGED,jt,Y),K.off(E.default.SETTING_UPDATED_LIVE_DELAY,ze,Y),K.off(E.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,ze,Y)}function de(){if(!ae||!ae.hasOwnProperty("load")||!W||!W.hasOwnProperty("initialize")||!W.hasOwnProperty("reset")||!W.hasOwnProperty("getClientTimeOffset")||!ce||!w||!oe||!be)throw new Error(u.default.MISSING_CONFIG_ERROR)}function Re(){if(!ne||!ne.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}function xe(Oe){var rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:NaN;de(),ot=rt,ae.load(Oe)}function Ne(Oe){var rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:NaN;Re(),ot=rt,ne.setManifest(Oe)}function Xe(){et()}function nt(){Ge=!0}function et(){try{var Oe=X.getStreamsInfo();if(!U&&Oe.length===0)throw new Error("There are no periods in the MPD");U&&Oe.length>0&&oe.updateManifestUpdateInfo({currentTime:be.getTime(),buffered:Ae.getBufferRange(),presentationStartTime:Oe[0].start,clientTimeOffset:W.getClientTimeOffset()}),H.length>0&&Dr(Oe);for(var rt=[],pt=0,bt=Oe.length;pt<bt;pt++){var wt=Oe[pt];rt.push(ht(wt)),oe.addManifestUpdateStreamInfo(wt)}Promise.all(rt).then(function(){return je.get().streaming.applyContentSteering&&!U&&he.shouldQueryBeforeStart()?he.loadSteeringData():Promise.resolve()}).then(function(){U||yt(Oe),K.trigger(E.default.STREAMS_COMPOSED),Zt()}).catch(function(Vt){throw Vt})}catch(Vt){w.error(new T.default(m.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,Vt.message+" nostreamscomposed",ce.getValue())),ve=!0,sn()}}function ht(Oe){var rt=En(Oe.id);return rt?rt.updateData(Oe):(rt=(0,f.default)($).create({manifestModel:ce,mediaPlayerModel:ke,dashMetrics:oe,manifestUpdater:ne,adapter:X,timelineConverter:W,capabilities:ie,capabilitiesFilter:ee,errHandler:w,baseURLController:se,segmentBaseController:Z,textController:G,abrController:le,playbackController:be,eventController:N,mediaController:te,protectionController:B,videoModel:Ae,streamInfo:Oe,settings:je}),H.push(rt),rt.initialize(),Promise.resolve())}function yt(Oe){ft();var rt=oe.getCurrentDVRInfo().range;if(rt.end<rt.start){tt&&clearTimeout(tt);var pt=Math.min(((rt.end-rt.start)*-1+j)*1e3,2147483647);re.debug("Waiting for ".concat(pt," ms before playback can start")),K.trigger(E.default.AST_IN_FUTURE,{delay:pt}),tt=setTimeout(function(){yt(Oe)},pt);return}je.get().streaming.applyProducerReferenceTime&&Be.calculateProducerReferenceTimeOffsets(Oe);var bt=Oe[0].manifestInfo;if(je.get().streaming.applyServiceDescription&&Be.applyServiceDescription(bt),X.getIsDynamic()){var wt=Nr(Oe,bt);be.computeAndSetLiveDelay(wt,bt)}var Vt=Kt(),Yt=Ve(Vt),Er=Yt!==null?Yt:H[0];K.trigger(E.default.INITIAL_STREAM_SWITCH,{startTime:Vt}),Pt(Er,null,Vt),Wt()}function Pt(Oe,rt,pt){try{if(ue||!Oe||rt===Oe&&Oe.getIsActive())return;ue=!0,K.trigger(E.default.PERIOD_SWITCH_STARTED,{fromStreamInfo:rt?rt.getStreamInfo():null,toStreamInfo:Oe.getStreamInfo()});var bt=!1;U=Oe,rt&&(bt=Gt(Oe,rt),rt.deactivate(bt)),pt=isNaN(pt)?!bt&&rt?Oe.getStreamInfo().start:NaN:pt,re.info("Switch to stream ".concat(Oe.getId(),". Seektime is ").concat(pt,", current playback time is ").concat(be.getTime(),". Seamless period switch is set to ").concat(bt)),at=at.filter(function(wt){return wt.getId()!==U.getId()}),be.initialize(Fr(),!!rt),Ae.getElement()?De(pt,bt,!1):Ue(pt,bt)}catch{ue=!1}}function De(Oe,rt){var pt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,bt;function wt(){if(!(!me||me.readyState!=="open")){re.debug("MediaSource is open!"),window.URL.revokeObjectURL(bt),me.removeEventListener("sourceopen",wt),me.removeEventListener("webkitsourceopen",wt),He();var Yt=oe.getCurrentDVRInfo();ge.setSeekable(Yt.range.start,Yt.range.end),pt?U.setMediaSource(me).then(function(){U.initializeForTextWithMediaSource(me)}):Ue(Oe,rt)}}function Vt(){me.addEventListener("sourceopen",wt,!1),me.addEventListener("webkitsourceopen",wt,!1),bt=ge.attachMediaSource(Ae),re.debug("MediaSource attached to element.  Waiting on open...")}me?rt?Ue(Oe,rt):(ge.detachMediaSource(Ae),Vt()):(me=ge.createMediaSource(),Vt())}function Ue(Oe,rt){U.activate(me,rt?it:void 0,Oe).then(function(pt){if(pt){var bt=Object.keys(pt);bt.length>0&&pt[bt[0]].getBuffer().changeType&&(Ce=!0),it=pt}isNaN(Oe)||(K.trigger(E.default.SEEK_TARGET,{time:Oe},{streamId:U.getId()}),be.seek(Oe,!1,!0),U.startScheduleControllers()),ue=!1,K.trigger(E.default.PERIOD_SWITCH_COMPLETED,{toStreamInfo:Fr()})})}function Ze(Oe){var rt=Oe.seekTime,pt=Ve(rt);!pt||pt===U?(Et(),Tt(Oe)):pt&&pt!==U&&(Et(pt),Ot(Oe,pt)),Xr(y.PlayList.SEEK_START_REASON)}function Et(){var Oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;ct()}function ct(){at&&at.length>0&&(at.forEach(function(Oe){Oe.deactivate(!0)}),at=[])}function Tt(Oe){var rt=U.getProcessors();rt.forEach(function(pt){return pt.prepareInnerPeriodPlaybackSeeking(Oe)}),Ir(y.PlayListTrace.USER_REQUEST_STOP_REASON)}function Ot(Oe,rt){var pt=Oe&&!isNaN(Oe.seekTime)?Oe.seekTime:NaN,bt=U.getProcessors(),wt=bt.map(function(Vt){return Vt.prepareOuterPeriodPlaybackSeeking(Oe)});Promise.all(wt).then(function(){Pt(rt,U,pt)}).catch(function(Vt){w.error(Vt)})}function jt(Oe){Oe.newMediaInfo.streamInfo.id===U.getId()&&(ct(),U.prepareTrackChange(Oe))}function Gt(Oe,rt){try{return je.get().streaming.buffer.reuseExistingSourceBuffers&&(rt.isProtectionCompatible(Oe)||Ge)&&(Ce||rt.isMediaCodecCompatible(Oe,rt))}catch{return!1}}function pe(Oe){var rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(me&&!Oe.getPreloaded()){var pt=Gt(Oe,rt);pt&&Oe.startPreloading(me,it).then(function(){at.push(Oe)})}}function Ve(Oe){if(isNaN(Oe))return null;for(var rt=H.length,pt=0;pt<rt;pt++){var bt=H[pt],wt=parseFloat((bt.getStartTime()+bt.getDuration()).toFixed(5));if(Oe<wt)return bt}return null}function ft(){try{var Oe=X.getIsDynamic(),rt=X.getStreamsInfo(),pt=rt[0].manifestInfo,bt=be.getTime(),wt=W.calcTimeShiftBufferWindow(H,Oe),Vt=At();if(typeof wt.start>"u"||typeof wt.end>"u")return;!Vt||Vt.length===0?oe.addDVRInfo(u.default.VIDEO,bt,pt,wt):Vt.forEach(function(Yt){oe.addDVRInfo(Yt.getType(),bt,pt,wt)})}catch{}}function Ie(Oe){if(Se&&fe){var rt=ke.getInitialBufferLevel(),pt=[u.default.TEXT];(isNaN(rt)||rt<=be.getBufferLevel(pt)||X.getIsDynamic()&&rt>be.getLiveDelay())&&(Se=!1,Xr(y.PlayList.INITIAL_PLAYOUT_START_REASON),be.play())}Oe&&Oe.mediaType&&oe.addBufferLevel(Oe.mediaType,new Date,Oe.bufferLevel*1e3)}function we(Oe){Oe.streamInfo.id===U.getId()&&Oe.reason&&Oe.reason.forceReplace&&ct();var rt=En(Oe.streamInfo.id);rt.prepareQualityChange(Oe)}function ze(){if(X.getIsDynamic()&&be.getOriginalLiveDelay()!==0&&U){var Oe=X.getStreamsInfo();if(Oe.length>0){var rt=Oe[0].manifestInfo,pt=Nr(Oe,rt);be.computeAndSetLiveDelay(pt,rt)}}}function _t(){if($r()){var Oe=Ae.getPlaybackQuality();Oe&&oe.addDroppedFrames(Oe)}}function Nt(){re.debug("[onPlaybackStarted]"),!Se&&Le&&Xr(y.PlayList.RESUME_FROM_PAUSE_START_REASON),Se&&(Se=!1),Me&&(Me=!1,je.get().streaming.applyContentSteering&&!he.shouldQueryBeforeStart()&&he.loadSteeringData()),Le=!1}function It(Oe){re.debug("[onPlaybackPaused]"),Oe.ended||(Le=!0,Ir(y.PlayListTrace.USER_REQUEST_STOP_REASON))}function Dt(Oe){re.debug("Stream with id ".concat(Oe.streamInfo.id," finished buffering"));var rt=Oe.streamInfo.isLast;me&&rt?(re.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),ge.signalEndOfStream(me)):Zt()}function Zt(){if(!(!U||!U.getHasFinishedBuffering()))for(var Oe=ye(U),rt=0;rt<Oe.length;){var pt=Oe[rt],bt=rt===0?U:Oe[rt-1];!pt.getPreloaded()&&bt.getHasFinishedBuffering()&&me&&pe(pt,bt),rt+=1}}function Wt(){qe||(qe=setInterval(function(){!ue&&be.getTimeToStreamEnd()<=0&&!be.isSeeking()&&K.trigger(E.default.PLAYBACK_ENDED,{isLast:Fr().isLast})},k))}function Je(){qe&&(clearInterval(qe),qe=null)}function St(Oe,rt){for(var pt=null,bt=0,wt=0,Vt=null,Yt=0;Yt<H.length;Yt++){if(pt=H[Yt],wt=pt.getStartTime(),Vt=pt.getDuration(),Number.isFinite(wt)&&(bt=wt),pt.getId()===rt)return Oe-bt;Number.isFinite(Vt)&&(bt+=Vt)}return null}function At(){return U?U.getProcessors():[]}function Pe(Oe){if(U&&!U.getIsEndedEventSignaled()){U.setIsEndedEventSignaled(!0);var rt=Ke();rt?(re.debug("StreamController onEnded, found next stream with id ".concat(rt.getStreamInfo().id,". Switching from ").concat(U.getStreamInfo().id," to ").concat(rt.getStreamInfo().id)),Pt(rt,U,NaN)):(re.debug("StreamController no next stream found"),U.setIsEndedEventSignaled(!1)),Ir(rt?y.PlayListTrace.END_OF_PERIOD_STOP_REASON:y.PlayListTrace.END_OF_CONTENT_STOP_REASON)}Oe&&Oe.isLast&&(Je(),he.stopSteeringRequestTimer())}function Ke(){var Oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,rt=Oe||U||null;if(!rt)return null;for(var pt=rt.getStreamInfo(),bt=pt.start,wt=0,Vt=-1,Yt=NaN;wt<H.length;){var Er=H[wt],nr=Er.getStreamInfo(),Cr=nr.start-bt;Cr>0&&(isNaN(Yt)||Cr<Yt)&&pt.id!==nr.id&&(Yt=Cr,Vt=wt),wt+=1}return Vt>=0?H[Vt]:null}function ye(){var Oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;try{var rt=Oe||U||null;if(rt){var pt=rt.getStreamInfo();return H.filter(function(bt){var wt=bt.getStreamInfo();return wt.start>pt.start&&pt.id!==wt.id})}}catch{return[]}}function He(Oe){var rt=Oe||Fr().manifestInfo.duration;ge.setDuration(rt)}function lt(){return U}function Rt(){return Se}function Ct(){return fe}function Kt(){var Oe,rt=X.getIsDynamic();if(rt){var pt=oe.getCurrentDVRInfo(),bt=pt&&pt.range?pt.range.end:0;Oe=bt-be.getOriginalLiveDelay();var wt=pt?pt.range:null;if(wt){if(!isNaN(ot)||ot.toString().indexOf("posix:")!==-1){re.info("Start time provided by the app: ".concat(ot));var Vt=Ut(!0,ot);isNaN(Vt)||(Oe=Math.min(Oe,Vt))}else{var Yt=Ht(!0);isNaN(Yt)||(re.info("Start time from URI parameters: ".concat(Yt)),Oe=Math.min(Oe,Yt))}var Er=je.get().streaming.timeShiftBuffer.calcFromSegmentTimeline?.1:0;Oe=Math.max(Oe,wt.start+Er)}}else{var nr=Jr(),Cr=nr[0].getStreamInfo();if(Oe=Cr.start,isNaN(ot)){var Zr=Ht(!1);isNaN(Zr)||(re.info("Start time from URI parameters: ".concat(Zr)),Oe=Math.max(Oe,Zr))}else{re.info("Start time provided by the app: ".concat(ot));var ur=Ut(!1,ot);isNaN(ur)||(Oe=Math.max(Oe,ur))}}return Oe}function Ht(Oe){var rt=q.getURIFragmentData();if(!rt||!rt.t)return NaN;var pt=Jr()[0],bt=pt.getStreamInfo().start;return rt.t=rt.t.split(",")[0],sr(Oe,rt.t,bt)}function Ut(Oe,rt){var pt=0;if(!Oe){var bt=Jr()[0];pt=bt.getStreamInfo().start}return sr(Oe,rt,pt)}function sr(Oe,rt,pt){var bt=X.getRegularPeriods()[0],wt=rt.toString(),Vt=wt.indexOf("posix:")!==-1?wt.substring(6)==="now"?Date.now()/1e3:parseFloat(wt.substring(6)):NaN,Yt=Oe&&!isNaN(Vt)?W.calcPresentationTimeFromWallTime(new Date(Vt*1e3),bt):parseFloat(wt)+pt;return Yt}function Dr(Oe){if(Oe.length===0){re.warn("No periods included in the current manifest. Skipping the filtering of outdated stream objects.");return}H=H.filter(function(rt){var pt=Oe.filter(function(wt){return wt.id===rt.getId()}).length>0,bt=pt||rt.getId()===U.getId();return bt||(re.debug("Removing stream ".concat(rt.getId())),rt.reset(!0)),bt})}function Nr(Oe,rt){try{var pt=NaN;if(rt&&!isNaN(rt.maxFragmentDuration)&&isFinite(rt.maxFragmentDuration))return rt.maxFragmentDuration;if(Oe&&Oe.length===1){var bt=Oe[0],wt=[u.default.VIDEO,u.default.AUDIO,u.default.TEXT],Vt=wt.reduce(function(Yt,Er){var nr=X.getMediaInfoForType(bt,Er);return nr&&nr.isFragmented!==!1&&Yt.push(nr),Yt},[]).reduce(function(Yt,Er){var nr=X.getVoRepresentations(Er);return nr&&nr.length>0&&nr.forEach(function(Cr){Cr&&Yt.push(Cr)}),Yt},[]).reduce(function(Yt,Er){var nr=X.convertRepresentationToRepresentationInfo(Er);return nr&&nr.fragmentDuration&&!isNaN(nr.fragmentDuration)&&Yt.push(nr.fragmentDuration),Yt},[]);pt=Math.max.apply(Math,C(Vt))}return isFinite(pt)?pt:NaN}catch{return NaN}}function _r(Oe){if(Oe.error)ve=!0,sn();else{re.info("Manifest updated... updating data system wide.");var rt=Oe.manifest;X.updatePeriods(rt);var pt=X.getUTCTimingSources();X.getIsDynamic()&&(!pt||pt.length===0)&&K.trigger(b.default.CONFORMANCE_VIOLATION,{level:p.default.LEVELS.WARNING,event:p.default.EVENTS.NO_UTC_TIMING_ELEMENT});var bt=X.getIsDynamic()?pt.concat(Ye.getUTCTimingSources()):pt;ee.filterUnsupportedFeatures(rt).then(function(){se.initialize(rt),_e.attemptSync(bt,X.getIsDynamic())})}}function $r(){return U?U.getHasVideoTrack():!1}function an(){return U?U.getHasAudioTrack():!1}function mn(Oe){U&&(be.initialize(Fr()),De(Oe,!1,!0))}function Ir(Oe,rt){rt=rt||new Date,At().forEach(function(pt){pt.finalisePlayList(rt,Oe)}),oe.addPlayList()}function Xr(Oe){oe.createPlaylistMetrics(be.getTime()*1e3,Oe)}function Qr(Oe){if(Oe.error){var rt="";switch(Oe.error.code){case 1:rt="MEDIA_ERR_ABORTED";break;case 2:rt="MEDIA_ERR_NETWORK";break;case 3:rt="MEDIA_ERR_DECODE",dt.counts.mediaErrorDecode+=1;break;case 4:rt="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:rt="MEDIA_ERR_ENCRYPTED";break;default:rt="UNKNOWN";break}if(rt==="MEDIA_ERR_DECODE"&&je.get().errors.recoverAttempts.mediaErrorDecode>=dt.counts.mediaErrorDecode){bn();return}J=!0,Oe.error.message&&(rt+=" ("+Oe.error.message+")"),Oe.error.msExtendedCode&&(rt+=" (0x"+(Oe.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),re.fatal("Video Element Error: "+rt),Oe.error&&re.fatal(Oe.error),w.error(new T.default(Oe.error.code,rt)),sn()}}function bn(){re.warn("A MEDIA_ERR_DECODE occured: Resetting the MediaSource");var Oe=be.getTime();U.deactivate(!1),re.warn("MediaSource has been resetted. Resuming playback from time ".concat(Oe)),De(Oe,!1,!1)}function Fr(){return U?U.getStreamInfo():null}function di(){return ue}function hi(){return J||ve}function En(Oe){for(var rt=0,pt=H.length;rt<pt;rt++)if(H[rt].getId()===Oe)return H[rt];return null}function xn(Oe){isNaN(Oe.newDuration)||He(Oe.newDuration)}function gi(Oe){Oe&&(Oe.capabilities&&(ie=Oe.capabilities),Oe.capabilitiesFilter&&(ee=Oe.capabilitiesFilter),Oe.manifestLoader&&(ae=Oe.manifestLoader),Oe.manifestModel&&(ce=Oe.manifestModel),Oe.mediaPlayerModel&&(ke=Oe.mediaPlayerModel),Oe.customParametersModel&&(Ye=Oe.customParametersModel),Oe.protectionController&&(B=Oe.protectionController),Oe.adapter&&(X=Oe.adapter),Oe.dashMetrics&&(oe=Oe.dashMetrics),Oe.errHandler&&(w=Oe.errHandler),Oe.timelineConverter&&(W=Oe.timelineConverter),Oe.videoModel&&(Ae=Oe.videoModel),Oe.playbackController&&(be=Oe.playbackController),Oe.serviceDescriptionController&&(Be=Oe.serviceDescriptionController),Oe.contentSteeringController&&(he=Oe.contentSteeringController),Oe.textController&&(G=Oe.textController),Oe.abrController&&(le=Oe.abrController),Oe.mediaController&&(te=Oe.mediaController),Oe.settings&&(je=Oe.settings),Oe.baseURLController&&(se=Oe.baseURLController),Oe.uriFragmentModel&&(q=Oe.uriFragmentModel),Oe.segmentBaseController&&(Z=Oe.segmentBaseController))}function mi(Oe){z=Oe,B&&B.setProtectionData(z)}function Nn(){H=[],ot=NaN,B=null,ue=!1,U=null,J=!1,ve=!1,Se=!0,Me=!0,Le=!1,fe=!0,qe=null,Ge=!1,Ce=!1,at=[],tt=null,dt={counts:{mediaErrorDecode:0}}}function sn(){de(),_e.reset(),Ir(J||ve?y.PlayListTrace.FAILURE_STOP_REASON:y.PlayListTrace.USER_REQUEST_STOP_REASON);for(var Oe=0,rt=H?H.length:0;Oe<rt;Oe++){var pt=H[Oe];pt.reset(J)}Te(),se.reset(),ne.reset(),N.reset(),oe.clearAllCurrentMetrics(),ce.setValue(null),ae.reset(),W.reset(),D.reset(),me&&(ge.detachMediaSource(Ae),me=null),Ae=null,B&&(B=null,z=null,ce.getValue()&&K.trigger(E.default.PROTECTION_DESTROYED,{data:ce.getValue().url})),Je(),K.trigger(E.default.STREAM_TEARDOWN_COMPLETE),Nn()}function Fn(Oe){if(Oe.metric===l.default.DVR_INFO){var rt=an()?u.default.AUDIO:u.default.VIDEO;Oe.mediaType===rt&&ge.setSeekable(Oe.value.range.start,Oe.value.range.end)}}function Jr(){return H}return Y={initialize:Mt,getActiveStreamInfo:Fr,addDVRMetric:ft,hasVideoTrack:$r,hasAudioTrack:an,getStreamById:En,getStreamForTime:Ve,getTimeRelativeToStreamId:St,load:xe,loadWithManifest:Ne,getActiveStreamProcessors:At,setConfig:gi,setProtectionData:mi,getIsStreamSwitchInProgress:di,switchToVideoElement:mn,getHasMediaOrInitialisationError:hi,getStreams:Jr,getActiveStream:lt,getInitialPlayback:Rt,getAutoPlay:Ct,reset:sn},gt(),Y}V.__dashjs_factory_name="StreamController";const Q=c.default.getSingletonFactory(V)},"./src/streaming/controllers/TimeSyncController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>I});var u=r("./src/streaming/vo/DashJSError.js"),l=r("./src/streaming/vo/metrics/HTTPRequest.js"),f=r("./src/core/EventBus.js"),d=r("./src/core/events/Events.js"),_=r("./src/core/errors/Errors.js"),E=r("./src/core/FactoryMaker.js"),c=r("./src/core/Debug.js"),y=r("./src/streaming/utils/URLUtils.js"),O=5e3,P=100,b=2,L=2,R=30,T=30,m=600,M=2;function p(){var A=this.context,S=(0,f.default)(A).getInstance(),x=(0,y.default)(A).getInstance(),F,k,j,V,Q,$,K,Y,re,ie,ee,ne,ae,ce,X,oe;function ge(){k=(0,c.default)(A).getInstance().getLogger(F),S.on(d.default.ATTEMPT_BACKGROUND_SYNC,q,F)}function _e(ke){ke&&(ke.dashMetrics&&(K=ke.dashMetrics),ke.baseURLController&&(oe=ke.baseURLController),ke.errHandler&&(X=ke.errHandler),ke.settings&&(Q=ke.settings))}function he(){Y=[],re=[],ie=null,ee=null,ae=null,ne=NaN,j=!1,V=!1,ce=Q.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function se(){he(),$={"urn:mpeg:dash:utc:http-head:2014":ue,"urn:mpeg:dash:utc:http-xsdate:2014":fe.bind(null,H),"urn:mpeg:dash:utc:http-iso:2014":fe.bind(null,U),"urn:mpeg:dash:utc:direct:2014":z,"urn:mpeg:dash:utc:http-head:2012":ue,"urn:mpeg:dash:utc:http-xsdate:2012":fe.bind(null,H),"urn:mpeg:dash:utc:http-iso:2012":fe.bind(null,U),"urn:mpeg:dash:utc:direct:2012":z,"urn:mpeg:dash:utc:http-ntp:2014":G,"urn:mpeg:dash:utc:ntp:2014":G,"urn:mpeg:dash:utc:sntp:2014":G}}function Z(ke,Ye){if(re=ke,!j){if(!D(Ye)){S.trigger(d.default.TIME_SYNCHRONIZATION_COMPLETED);return}j=!0,te()}}function q(){if(!(!Q.get().streaming.utcSynchronization.enabled||j||V||!ae||!ae.value||!ae.schemeIdUri||isNaN(ne)||isNaN(Q.get().streaming.utcSynchronization.backgroundAttempts))&&!(ee&&(Date.now()-ee)/1e3<T)){Y=[],V=!0;var ke=isNaN(Q.get().streaming.utcSynchronization.backgroundAttempts)?L:Q.get().streaming.utcSynchronization.backgroundAttempts;le(ke)}}function le(ke){try{if(ke<=0){Ae();return}var Ye=Date.now();$[ae.schemeIdUri](ae.value,function(Le){var Se=Date.now(),Me=N(Ye,Se,Le);Y.push(Me),le(ke-1)},function(){Ae()})}catch{Ae()}}function te(){var ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,Ye=ke||0;if(!re||re.length===0||Ye>=re.length){w();return}var Le=re[Ye];if(Le)if($.hasOwnProperty(Le.schemeIdUri)){var Se=new Date().getTime();$[Le.schemeIdUri](Le.value,function(Me){var qe=new Date().getTime(),it=N(Se,qe,Me);ae=Le,w(it)},function(){te(Ye+1)})}else te(Ye+1);else w()}function N(ke,Ye,Le){var Se=Ye-(Ye-ke)/2;return Le-Se}function D(ke){try{if(!ke||!Q.get().streaming.utcSynchronization.enabled)return!1;var Ye=isNaN(ce)?R:ce;return!ie||!Ye||isNaN(Ye)?!0:(Date.now()-ie)/1e3>=Ye}catch{return!0}}function w(){var ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:NaN,Ye=isNaN(ke);Ye&&Q.get().streaming.utcSynchronization.useManifestDateHeaderTimeSource?J():ve(Ye,ke)}function W(ke){var Ye=60,Le=60,Se=1e3,Me=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/,qe,it,at=Me.exec(ke);return qe=Date.UTC(parseInt(at[1],10),parseInt(at[2],10)-1,parseInt(at[3],10),parseInt(at[4],10),parseInt(at[5],10),at[6]&&(parseInt(at[6],10)||0),at[7]&&parseFloat(at[7])*Se||0),at[9]&&at[10]&&(it=parseInt(at[9],10)*Le+parseInt(at[10],10),qe+=(at[8]==="+"?-1:1)*it*Ye*Se),new Date(qe).getTime()}function H(ke){var Ye=Date.parse(ke);return isNaN(Ye)&&(Ye=W(ke)),Ye}function U(ke){return Date.parse(ke)}function B(ke){return Date.parse(ke)}function G(ke,Ye,Le){Le()}function z(ke,Ye,Le){var Se=H(ke);if(!isNaN(Se)){Ye(Se);return}Le()}function fe(ke,Ye,Le,Se,Me){var qe,it,at=!1,Ce=new XMLHttpRequest,je=Me?l.HTTPRequest.HEAD:l.HTTPRequest.GET,Ge=Ye.match(/\S+/g);if(Ye=Ge.shift(),qe=function(){at||(at=!0,Ge.length?fe(ke,Ge.join(" "),Le,Se,Me):Se())},it=function(){var dt,gt;Ce.status===200&&(dt=Me?Ce.getResponseHeader("Date"):Ce.response,gt=ke(dt),isNaN(gt)||(Le(gt),at=!0))},x.isRelative(Ye)){var tt=oe.resolve();tt&&(Ye=x.resolve(Ye,tt.url))}Ce.open(je,Ye),Ce.timeout=O,Ce.onload=it,Ce.onloadend=qe,Ce.send()}function ue(ke,Ye,Le){fe(B,ke,Ye,Le,!0)}function J(){var ke=K.getLatestMPDRequestHeaderValueByID("Date"),Ye=ke!==null?new Date(ke).getTime():Number.NaN;if(isNaN(Ye))ve(!0);else{var Le=Ye-Date.now();ve(!1,Le)}}function ve(ke,Ye){if(!isNaN(ne)&&!isNaN(Ye)&&!ke&&me(Ye),!ke&&!isNaN(Ye)){ie=Date.now(),j=!1;var Le=isNaN(ne);ne=Ye,Le&&q(),k.debug("Completed UTC sync. Setting client - server offset to ".concat(Ye))}ke&&(ae=null,j=!1,X.error(new u.default(_.default.TIME_SYNC_FAILED_ERROR_CODE,_.default.TIME_SYNC_FAILED_ERROR_MESSAGE))),S.trigger(d.default.UPDATE_TIME_SYNC_OFFSET,{offset:Ye}),S.trigger(d.default.TIME_SYNCHRONIZATION_COMPLETED)}function me(ke){try{var Ye=be(ke),Le=isNaN(ce)?R:ce,Se=isNaN(Q.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?b:Q.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,Me=isNaN(Q.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?m:Q.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,qe=isNaN(Q.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?M:Q.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts,it;Ye?(it=Math.min(Le*Se,Me),k.debug("Increasing timeBetweenSyncAttempts to ".concat(it))):(it=Math.max(Le/Se,qe),k.debug("Decreasing timeBetweenSyncAttempts to ".concat(it))),ce=it}catch{}}function Ae(){if(!(!Y||Y.length===0)){var ke=Y.reduce(function(Ye,Le){return Ye+Le},0)/Y.length;be(ke)?k.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(k.debug("Completed background UTC sync. Setting client - server offset to ".concat(ke)),ne=ke,S.trigger(d.default.UPDATE_TIME_SYNC_OFFSET,{offset:ne})),V=!1,ee=Date.now()}}function be(ke){try{if(isNaN(ne))return!0;var Ye=Q.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(Q.get().streaming.utcSynchronization.maximumAllowedDrift)?Q.get().streaming.utcSynchronization.maximumAllowedDrift:P,Le=ne-Ye,Se=ne+Ye;return ke>=Le&&ke<=Se}catch{return!0}}function Be(){he(),S.off(d.default.ATTEMPT_BACKGROUND_SYNC,q,F)}return F={initialize:se,attemptSync:Z,setConfig:_e,reset:Be},ge(),F}p.__dashjs_factory_name="TimeSyncController";var C=E.default.getSingletonFactory(p);C.HTTP_TIMEOUT_MS=O,E.default.updateSingletonFactory(p.__dashjs_factory_name,C);const I=C},"./src/streaming/controllers/XlinkController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>L});var u=r("./src/streaming/XlinkLoader.js"),l=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js"),d=r("./src/core/FactoryMaker.js"),_=r("./externals/xml2json.js"),E=r("./src/streaming/utils/URLUtils.js"),c=r("./src/dash/constants/DashConstants.js"),y="onLoad",O="onActuate",P="urn:mpeg:dash:resolve-to-zero:2013";function b(R){R=R||{};var T=this.context,m=(0,l.default)(T).getInstance(),M=(0,E.default)(T).getInstance(),p,C,I,A,S,x;function F(){m.on(f.default.XLINK_ELEMENT_LOADED,K,p),x=(0,u.default)(T).create({errHandler:R.errHandler,dashMetrics:R.dashMetrics,mediaPlayerModel:R.mediaPlayerModel,requestModifier:R.requestModifier,settings:R.settings})}function k(ce){ce&&(C=ce)}function j(ce){ce&&(I=ce)}function V(ce){var X;S=new _.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:C}),A=ce,A.Period_asArray?(X=re(A.Period_asArray,A,c.default.PERIOD,y),$(X,c.default.PERIOD,y)):m.trigger(f.default.XLINK_READY,{manifest:A})}function Q(){m.off(f.default.XLINK_ELEMENT_LOADED,K,p),x&&(x.reset(),x=null)}function $(ce,X,oe){var ge={},_e,he;ge.elements=ce,ge.type=X,ge.resolveType=oe,ge.elements.length===0&&Y(ge);for(var se=0;se<ge.elements.length;se++)_e=ge.elements[se],M.isHTTPURL(_e.url)?he=_e.url:he=_e.originalContent.BaseURL+_e.url,x.load(he,_e,ge)}function K(ce){var X,oe,ge="<response>",_e="</response>",he="";if(X=ce.element,oe=ce.resolveObject,X.resolvedContent){var se=0;X.resolvedContent.indexOf("<?xml")===0&&(se=X.resolvedContent.indexOf("?>")+2),he=X.resolvedContent.substr(0,se)+ge+X.resolvedContent.substr(se)+_e,X.resolvedContent=S.xml_str2json(he)}ne(oe)&&Y(oe)}function Y(ce){var X=[],oe,ge;if(ie(ce),ce.resolveType===O&&m.trigger(f.default.XLINK_READY,{manifest:A}),ce.resolveType===y)switch(ce.type){case c.default.PERIOD:for(oe=0;oe<A[c.default.PERIOD+"_asArray"].length;oe++)ge=A[c.default.PERIOD+"_asArray"][oe],ge.hasOwnProperty(c.default.ADAPTATION_SET+"_asArray")&&(X=X.concat(re(ge[c.default.ADAPTATION_SET+"_asArray"],ge,c.default.ADAPTATION_SET,y))),ge.hasOwnProperty(c.default.EVENT_STREAM+"_asArray")&&(X=X.concat(re(ge[c.default.EVENT_STREAM+"_asArray"],ge,c.default.EVENT_STREAM,y)));$(X,c.default.ADAPTATION_SET,y);break;case c.default.ADAPTATION_SET:m.trigger(f.default.XLINK_READY,{manifest:A});break}}function re(ce,X,oe,ge){var _e=[],he,se,Z;for(se=ce.length-1;se>=0;se--)he=ce[se],he.hasOwnProperty("xlink:href")&&he["xlink:href"]===P&&ce.splice(se,1);for(se=0;se<ce.length;se++)he=ce[se],he.hasOwnProperty("xlink:href")&&he.hasOwnProperty("xlink:actuate")&&he["xlink:actuate"]===ge&&(Z=ee(he["xlink:href"],X,oe,se,ge,he),_e.push(Z));return _e}function ie(ce){var X=[],oe,ge,_e,he,se,Z;for(he=ce.elements.length-1;he>=0;he--){if(oe=ce.elements[he],ge=oe.type+"_asArray",!oe.resolvedContent||ae())delete oe.originalContent["xlink:actuate"],delete oe.originalContent["xlink:href"],X.push(oe.originalContent);else if(oe.resolvedContent)for(se=0;se<oe.resolvedContent[ge].length;se++)_e=oe.resolvedContent[ge][se],X.push(_e);for(oe.parentElement[ge].splice(oe.index,1),Z=0;Z<X.length;Z++)oe.parentElement[ge].splice(oe.index+Z,0,X[Z]);X=[]}ce.elements.length>0&&I.run(A)}function ee(ce,X,oe,ge,_e,he){return{url:ce,parentElement:X,type:oe,index:ge,resolveType:_e,originalContent:he,resolvedContent:null,resolved:!1}}function ne(ce){var X,oe;for(X=0;X<ce.elements.length;X++)if(oe=ce.elements[X],oe.resolved===!1)return!1;return!0}function ae(){return!1}return p={resolveManifestOnLoad:V,setMatchers:k,setIron:j,reset:Q},F(),p}b.__dashjs_factory_name="XlinkController";const L=d.default.getClassFactory(b)},"./src/streaming/metrics/MetricsReporting.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>y});var u=r("./src/streaming/metrics/utils/DVBErrorsTranslator.js"),l=r("./src/streaming/metrics/MetricsReportingEvents.js"),f=r("./src/streaming/metrics/controllers/MetricsCollectionController.js"),d=r("./src/streaming/metrics/metrics/MetricsHandlerFactory.js"),_=r("./src/streaming/metrics/reporting/ReportingFactory.js");function E(){var O=this.context,P,b;function L(m){return b=(0,u.default)(O).getInstance({eventBus:m.eventBus,dashMetrics:m.dashMetrics,metricsConstants:m.metricsConstants,events:m.events}),b.initialise(),(0,f.default)(O).create(m)}function R(){return(0,_.default)(O).getInstance()}function T(){return(0,d.default)(O).getInstance()}return P={createMetricsReporting:L,getReportingFactory:R,getMetricsHandlerFactory:T},P}E.__dashjs_factory_name="MetricsReporting";var c=dashjs.FactoryMaker.getClassFactory(E);c.events=l.default,dashjs.FactoryMaker.updateClassFactory(E.__dashjs_factory_name,c);const y=c},"./src/streaming/metrics/MetricsReportingEvents.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/core/events/EventsBase.js");function l(T){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(M){return typeof M}:l=function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},l(T)}function f(T,m){if(!(T instanceof m))throw new TypeError("Cannot call a class as a function")}function d(T,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(m&&m.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),m&&_(T,m)}function _(T,m){return _=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},_(T,m)}function E(T){var m=O();return function(){var p=P(T),C;if(m){var I=P(this).constructor;C=Reflect.construct(p,arguments,I)}else C=p.apply(this,arguments);return c(this,C)}}function c(T,m){return m&&(l(m)==="object"||typeof m=="function")?m:y(T)}function y(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(T){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},P(T)}var b=function(T){d(M,T);var m=E(M);function M(){var p;return f(this,M),p=m.call(this),p.METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",p.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",p.CMCD_DATA_GENERATED="cmcdDataGenerated",p}return M}(u.default),L=new b;const R=L},"./src/streaming/metrics/controllers/MetricsCollectionController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/streaming/metrics/controllers/MetricsController.js"),l=r("./src/streaming/metrics/utils/ManifestParsing.js"),f=r("./src/streaming/metrics/MetricsReportingEvents.js");function d(E){E=E||{};var c,y={},O=this.context,P=E.eventBus,b=E.events;function L(M){if(!M.error){var p=Object.keys(y),C=(0,l.default)(O).getInstance({adapter:E.adapter,constants:E.constants}).getMetrics(M.manifest);C.forEach(function(I){var A=JSON.stringify(I);if(y.hasOwnProperty(A))p.splice(A,1);else try{var S=(0,u.default)(O).create(E);S.initialize(I),y[A]=S}catch{}}),p.forEach(function(I){y[I].reset(),delete y[I]}),P.trigger(f.default.METRICS_INITIALISATION_COMPLETE)}}function R(){Object.keys(y).forEach(function(M){y[M].reset()}),y={}}function T(){P.on(b.MANIFEST_UPDATED,L,c),P.on(b.STREAM_TEARDOWN_COMPLETE,R,c)}function m(){P.off(b.MANIFEST_UPDATED,L,c),P.off(b.STREAM_TEARDOWN_COMPLETE,R,c)}return c={reset:m},T(),c}d.__dashjs_factory_name="MetricsCollectionController";const _=dashjs.FactoryMaker.getClassFactory(d)},"./src/streaming/metrics/controllers/MetricsController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/streaming/metrics/controllers/RangeController.js"),l=r("./src/streaming/metrics/controllers/ReportingController.js"),f=r("./src/streaming/metrics/controllers/MetricsHandlersController.js");function d(E){E=E||{};var c,y,O,P,b=this.context;function L(T){try{O=(0,u.default)(b).create({mediaElement:E.mediaElement}),O.initialize(T.Range),y=(0,l.default)(b).create({debug:E.debug,metricsConstants:E.metricsConstants,mediaPlayerModel:E.mediaPlayerModel}),y.initialize(T.Reporting,O),c=(0,f.default)(b).create({debug:E.debug,eventBus:E.eventBus,metricsConstants:E.metricsConstants,events:E.events}),c.initialize(T.metrics,y)}catch(m){throw R(),m}}function R(){c&&c.reset(),y&&y.reset(),O&&O.reset()}return P={initialize:L,reset:R},P}d.__dashjs_factory_name="MetricsController";const _=dashjs.FactoryMaker.getClassFactory(d)},"./src/streaming/metrics/controllers/MetricsHandlersController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/streaming/metrics/metrics/MetricsHandlerFactory.js");function l(d){d=d||{};var _=[],E,c=this.context,y=d.eventBus,O=d.events,P=(0,u.default)(c).getInstance({debug:d.debug,eventBus:d.eventBus,metricsConstants:d.metricsConstants});function b(T){_.forEach(function(m){m.handleNewMetric(T.metric,T.value,T.mediaType)})}function L(T,m){T.split(",").forEach(function(M,p,C){var I;if(M.indexOf("(")!==-1&&M.indexOf(")")===-1){var A=C[p+1];A&&A.indexOf("(")===-1&&A.indexOf(")")!==-1&&(M+=","+A,delete C[p+1])}I=P.create(M,m),I&&_.push(I)}),y.on(O.METRIC_ADDED,b,E),y.on(O.METRIC_UPDATED,b,E)}function R(){y.off(O.METRIC_ADDED,b,E),y.off(O.METRIC_UPDATED,b,E),_.forEach(function(T){return T.reset()}),_=[]}return E={initialize:L,reset:R},E}l.__dashjs_factory_name="MetricsHandlersController";const f=dashjs.FactoryMaker.getClassFactory(l)},"./src/streaming/metrics/controllers/RangeController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/streaming/utils/CustomTimeRanges.js");function l(d){d=d||{};var _=!1,E=this.context,c,y,O=d.mediaElement;function P(T){T&&T.length&&(T.forEach(function(m){var M=m.starttime,p=M+m.duration;y.add(M,p)}),_=!!T[0]._useWallClockTime)}function b(){y.clear()}function L(){y=(0,u.default)(E).create()}function R(){var T=y.length,m;if(!T)return!0;m=_?new Date().getTime()/1e3:O.currentTime;for(var M=0;M<T;M+=1){var p=y.start(M),C=y.end(M);if(p<=m&&m<C)return!0}return!1}return c={initialize:P,reset:b,isEnabled:R},L(),c}l.__dashjs_factory_name="RangeController";const f=dashjs.FactoryMaker.getClassFactory(l)},"./src/streaming/metrics/controllers/ReportingController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/streaming/metrics/reporting/ReportingFactory.js");function l(d){var _=[],E,c=(0,u.default)(this.context).getInstance(d);function y(b,L){b.some(function(R){var T=c.create(R,L);if(T)return _.push(T),!0})}function O(){_.forEach(function(b){return b.reset()}),_=[]}function P(b,L){_.forEach(function(R){return R.report(b,L)})}return E={initialize:y,reset:O,report:P},E}l.__dashjs_factory_name="ReportingController";const f=dashjs.FactoryMaker.getClassFactory(l)},"./src/streaming/metrics/metrics/MetricsHandlerFactory.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/streaming/metrics/metrics/handlers/BufferLevelHandler.js"),l=r("./src/streaming/metrics/metrics/handlers/DVBErrorsHandler.js"),f=r("./src/streaming/metrics/metrics/handlers/HttpListHandler.js"),d=r("./src/streaming/metrics/metrics/handlers/GenericMetricHandler.js");function _(c){c=c||{};var y,O=c.debug?c.debug.getLogger(y):{},P=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,b=this.context,L={BufferLevel:u.default,DVBErrors:l.default,HttpList:f.default,PlayList:d.default,RepSwitchList:d.default,TcpList:d.default};function R(M,p){var C=M.match(P),I;if(C){try{I=L[C[1]](b).create({eventBus:c.eventBus,metricsConstants:c.metricsConstants}),I.initialize(C[1],p,C[3],C[5])}catch(A){I=null,O.error("MetricsHandlerFactory: Could not create handler for type ".concat(C[1]," with args ").concat(C[3],", ").concat(C[5]," (").concat(A.message,")"))}return I}}function T(M,p){L[M]=p}function m(M){delete L[M]}return y={create:R,register:T,unregister:m},y}_.__dashjs_factory_name="MetricsHandlerFactory";const E=dashjs.FactoryMaker.getSingletonFactory(_)},"./src/streaming/metrics/metrics/handlers/BufferLevelHandler.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/streaming/metrics/utils/HandlerHelpers.js");function l(d){d=d||{};var _,E,c,y,O,P,b=this.context,L=(0,u.default)(b).getInstance(),R=[],T=d.metricsConstants;function m(){try{return Object.keys(R).map(function(A){return R[A]}).reduce(function(A,S){return A.level<S.level?A:S})}catch{return}}function M(){var A=m();A&&P!==A.t&&(P=A.t,E.report(y,A))}function p(A,S,x){S&&(c=L.validateN(x),E=S,y=L.reconstructFullMetricName(A,x),O=setInterval(M,c))}function C(){clearInterval(O),O=null,c=0,E=null,P=null}function I(A,S,x){A===T.BUFFER_LEVEL&&(R[x]=S)}return _={initialize:p,reset:C,handleNewMetric:I},_}l.__dashjs_factory_name="BufferLevelHandler";const f=dashjs.FactoryMaker.getClassFactory(l)},"./src/streaming/metrics/metrics/handlers/DVBErrorsHandler.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/streaming/metrics/MetricsReportingEvents.js");function l(d){d=d||{};var _,E,c=d.eventBus,y=d.metricsConstants;function O(){c.off(u.default.METRICS_INITIALISATION_COMPLETE,O,this),c.trigger(u.default.BECAME_REPORTING_PLAYER)}function P(R,T){T&&(E=T,c.on(u.default.METRICS_INITIALISATION_COMPLETE,O,this))}function b(){E=null}function L(R,T){R===y.DVB_ERRORS&&E&&E.report(R,T)}return _={initialize:P,reset:b,handleNewMetric:L},_}const f=dashjs.FactoryMaker.getClassFactory(l)},"./src/streaming/metrics/metrics/handlers/GenericMetricHandler.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>l});function u(){var f,d,_;function E(O,P){d=O,_=P}function c(){_=null,d=void 0}function y(O,P){O===d&&_&&_.report(d,P)}return f={initialize:E,reset:c,handleNewMetric:y},f}u.__dashjs_factory_name="GenericMetricHandler";const l=dashjs.FactoryMaker.getClassFactory(u)},"./src/streaming/metrics/metrics/handlers/HttpListHandler.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/streaming/metrics/utils/HandlerHelpers.js");function l(d){d=d||{};var _,E,c,y,O,P,b=[],L=(0,u.default)(this.context).getInstance(),R=d.metricsConstants;function T(){var C=b;C.length&&E&&E.report(O,C),b=[]}function m(C,I,A,S){I&&(c=L.validateN(A),E=I,S&&S.length&&(y=S),O=L.reconstructFullMetricName(C,A,S),P=setInterval(T,c))}function M(){clearInterval(P),P=null,c=null,y=null,b=[],E=null}function p(C,I){C===R.HTTP_REQUEST&&(!y||y===I.type)&&b.push(I)}return _={initialize:m,reset:M,handleNewMetric:p},_}l.__dashjs_factory_name="HttpListHandler";const f=dashjs.FactoryMaker.getClassFactory(l)},"./src/streaming/metrics/reporting/ReportingFactory.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/streaming/metrics/reporting/reporters/DVBReporting.js");function l(d){d=d||{};var _={"urn:dvb:dash:reporting:2014":u.default},E=this.context,c,y=d.debug?d.debug.getLogger(c):{},O=d.metricsConstants,P=d.mediaPlayerModel||{};function b(T,m){var M;try{M=_[T.schemeIdUri](E).create({metricsConstants:O,mediaPlayerModel:P}),M.initialize(T,m)}catch(p){M=null,y.error("ReportingFactory: could not create Reporting with schemeIdUri ".concat(T.schemeIdUri," (").concat(p.message,")"))}return M}function L(T,m){_[T]=m}function R(T){delete _[T]}return c={create:b,register:L,unregister:R},c}l.__dashjs_factory_name="ReportingFactory";const f=dashjs.FactoryMaker.getSingletonFactory(l)},"./src/streaming/metrics/reporting/reporters/DVBReporting.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/streaming/metrics/utils/MetricSerialiser.js"),l=r("./src/streaming/metrics/utils/RNG.js"),f=r("./src/streaming/models/CustomParametersModel.js");function d(E){E=E||{};var c,y=this.context,O,P,b,L,R,T,m,M=[],p=E.metricsConstants;function C(){O=(0,u.default)(y).getInstance(),b=(0,l.default)(y).getInstance(),P=(0,f.default)(y).getInstance(),x()}function I(k,j,V){var Q=new XMLHttpRequest;Q.withCredentials=P.getXHRWithCredentialsForType(p.HTTP_REQUEST_DVB_REPORTING_TYPE);var $=function(){var Y=M.indexOf(Q);Y!==-1&&(M.splice(Y,1),Q.status>=200&&Q.status<300?j&&j():V&&V())};M.push(Q);try{Q.open("GET",k),Q.onloadend=$,Q.onerror=$,Q.send()}catch{Q.onerror()}}function A(k,j){Array.isArray(j)||(j=[j]),R&&m.isEnabled()&&j.forEach(function(V){var Q=O.serialise(V);k!==p.DVB_ERRORS&&(Q="metricname=".concat(k,"&").concat(Q)),Q="".concat(T,"?").concat(Q),I(Q,null,function(){R=!1})})}function S(k,j){var V;if(m=j,T=k.dvb_reportingUrl,!T)throw new Error("required parameter missing (dvb:reportingUrl)");L||(V=k.dvb_probability,V&&(V===1e3||V/1e3>=b.random())&&(R=!0),L=!0)}function x(){L=!1,R=!1,T=null,m=null}function F(){x()}return c={report:A,initialize:S,reset:F},C(),c}d.__dashjs_factory_name="DVBReporting";const _=dashjs.FactoryMaker.getClassFactory(d)},"./src/streaming/metrics/utils/DVBErrorsTranslator.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/streaming/metrics/vo/DVBErrors.js"),l=r("./src/streaming/metrics/MetricsReportingEvents.js");function f(_){_=_||{};var E,c,y=_.eventBus,O=_.dashMetrics,P=_.metricsConstants,b=_.events;function L(S){var x=new u.default;if(c){for(var F in S)S.hasOwnProperty(F)&&(x[F]=S[F]);x.mpdurl||(x.mpdurl=c.originalUrl||c.url),x.terror||(x.terror=new Date),O.addDVBErrors(x)}}function R(S){S.error||(c=S.manifest)}function T(S){L({errorcode:u.default.BASE_URL_CHANGED,servicelocation:S.entry})}function m(){L({errorcode:u.default.BECAME_REPORTER})}function M(S){(S.responsecode===0||S.responsecode==null||S.responsecode>=400||S.responsecode<100||S.responsecode>=600)&&L({errorcode:S.responsecode||u.default.CONNECTION_ERROR,url:S.url,terror:S.tresponse,servicelocation:S._serviceLocation})}function p(S){switch(S.metric){case P.HTTP_REQUEST:M(S.value);break}}function C(S){var x=S.error?S.error.code:0,F;switch(x){case MediaError.MEDIA_ERR_NETWORK:F=u.default.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:F=u.default.CORRUPT_MEDIA_OTHER;break;default:return}L({errorcode:F})}function I(){y.on(b.MANIFEST_UPDATED,R,E),y.on(b.SERVICE_LOCATION_BLACKLIST_CHANGED,T,E),y.on(b.METRIC_ADDED,p,E),y.on(b.METRIC_UPDATED,p,E),y.on(b.PLAYBACK_ERROR,C,E),y.on(l.default.BECAME_REPORTING_PLAYER,m,E)}function A(){y.off(b.MANIFEST_UPDATED,R,E),y.off(b.SERVICE_LOCATION_BLACKLIST_CHANGED,T,E),y.off(b.METRIC_ADDED,p,E),y.off(b.METRIC_UPDATED,p,E),y.off(b.PLAYBACK_ERROR,C,E),y.off(l.default.BECAME_REPORTING_PLAYER,m,E)}return E={initialise:I,reset:A},E}f.__dashjs_factory_name="DVBErrorsTranslator";const d=dashjs.FactoryMaker.getSingletonFactory(f)},"./src/streaming/metrics/utils/HandlerHelpers.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>l});function u(){return{reconstructFullMetricName:function(d,_,E){var c=d;return _&&(c+="("+_,E&&E.length&&(c+=","+E),c+=")"),c},validateN:function(d){if(!d)throw new Error("missing n");if(isNaN(d))throw new Error("n is NaN");if(d<0)throw new Error("n must be positive");return d}}}u.__dashjs_factory_name="HandlerHelpers";const l=dashjs.FactoryMaker.getSingletonFactory(u)},"./src/streaming/metrics/utils/ManifestParsing.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/streaming/metrics/vo/Metrics.js"),l=r("./src/streaming/metrics/vo/Range.js"),f=r("./src/streaming/metrics/vo/Reporting.js");function d(E){E=E||{};var c,y=E.adapter,O=E.constants;function P(L,R,T){var m,M,p=0;return R?p=y.getAvailabilityStartTime(L)/1e3:(m=y.getRegularPeriods(L),m.length&&(p=m[0].start)),M=p,T&&T.hasOwnProperty(O.START_TIME)&&(M+=T.starttime),M}function b(L){var R=[];return L&&L.Metrics_asArray&&L.Metrics_asArray.forEach(function(T){var m=new u.default,M=y.getIsDynamic(L);if(T.hasOwnProperty("metrics"))m.metrics=T.metrics;else return;if(T.Range_asArray&&T.Range_asArray.forEach(function(p){var C=new l.default;C.starttime=P(L,M,p),p.hasOwnProperty("duration")?C.duration=p.duration:C.duration=y.getDuration(L),C._useWallClockTime=M,m.Range.push(C)}),T.Reporting_asArray)T.Reporting_asArray.forEach(function(p){var C=new f.default;if(p.hasOwnProperty(O.SCHEME_ID_URI))C.schemeIdUri=p.schemeIdUri;else return;p.hasOwnProperty("value")&&(C.value=p.value),p.hasOwnProperty(O.DVB_REPORTING_URL)&&(C.dvb_reportingUrl=p[O.DVB_REPORTING_URL]),p.hasOwnProperty(O.DVB_PROBABILITY)&&(C.dvb_probability=p[O.DVB_PROBABILITY]),m.Reporting.push(C)});else return;R.push(m)}),R}return c={getMetrics:b},c}d.__dashjs_factory_name="ManifestParsing";const _=dashjs.FactoryMaker.getSingletonFactory(d)},"./src/streaming/metrics/utils/MetricSerialiser.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>l});function u(){function f(d){var _=[],E=[],c,y;for(c in d)if(d.hasOwnProperty(c)&&c.indexOf("_")!==0){if(y=d[c],y==null&&(y=""),Array.isArray(y)){if(!y.length)continue;E=[],y.forEach(function(O){var P=Object.prototype.toString.call(O).slice(8,-1)!=="Object";E.push(P?O:f(O))}),y=E.map(encodeURIComponent).join(",")}else typeof y=="string"?y=encodeURIComponent(y):y instanceof Date?y=y.toISOString():typeof y=="number"&&(y=Math.round(y));_.push(c+"="+y)}return _.join("&")}return{serialise:f}}u.__dashjs_factory_name="MetricSerialiser";const l=dashjs.FactoryMaker.getSingletonFactory(u)},"./src/streaming/metrics/utils/RNG.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>l});function u(){var f=window.crypto||window.msCrypto,d=Uint32Array,_=Math.pow(2,d.BYTES_PER_ELEMENT*8)-1,E=10,c,y,O;function P(){f&&(c||(c=new d(E)),f.getRandomValues(c),y=0)}function b(L,R){var T;return L||(L=0),R||(R=1),f?(y===c.length&&P(),T=c[y]/_,y+=1):T=Math.random(),T*(R-L)+L}return O={random:b},P(),O}u.__dashjs_factory_name="RNG";const l=dashjs.FactoryMaker.getSingletonFactory(u)},"./src/streaming/metrics/vo/DVBErrors.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};l.SSL_CONNECTION_FAILED_PREFIX="SSL",l.DNS_RESOLUTION_FAILED="C00",l.HOST_UNREACHABLE="C01",l.CONNECTION_REFUSED="C02",l.CONNECTION_ERROR="C03",l.CORRUPT_MEDIA_ISOBMFF="M00",l.CORRUPT_MEDIA_OTHER="M01",l.BASE_URL_CHANGED="F00",l.BECAME_REPORTER="S00";const f=l},"./src/streaming/metrics/vo/Metrics.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.metrics="",this.Range=[],this.Reporting=[]};const f=l},"./src/streaming/metrics/vo/Range.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1};const f=l},"./src/streaming/metrics/vo/Reporting.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});function u(_,E){if(!(_ instanceof E))throw new TypeError("Cannot call a class as a function")}var l=1e3,f=function _(){u(this,_),this.schemeIdUri="",this.value="",this.dvb_reportingUrl="",this.dvb_probability=l};const d=f},"./src/streaming/models/BaseURLTreeModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>c});var u=r("./src/streaming/utils/ObjectUtils.js"),l=r("./src/core/FactoryMaker.js");function f(y,O){if(!(y instanceof O))throw new TypeError("Cannot call a class as a function")}var d=NaN,_=function y(O,P){f(this,y),this.data={baseUrls:O||null,selectedIdx:P||d},this.children=[]};function E(){var y,O,P,b=this.context,L=(0,u.default)(b).getInstance();function R(){S()}function T(F){F.adapter&&(P=F.adapter)}function m(){if(!P||!P.hasOwnProperty("getBaseURLsFromElement")||!P.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}function M(F,k,j){var V=P.getBaseURLsFromElement(j);F[k]?L.areEqual(V,F[k].data.baseUrls)||(F[k].data.baseUrls=V,F[k].data.selectedIdx=d):F[k]=new _(V)}function p(F){m();var k=P.getBaseURLsFromElement(F);L.areEqual(k,O.data.baseUrls)||(O.data.baseUrls=k,O.data.selectedIdx=d),F&&F.Period_asArray&&F.Period_asArray.forEach(function(j,V){M(O.children,V,j),j.AdaptationSet_asArray&&j.AdaptationSet_asArray.forEach(function(Q,$){M(O.children[V].children,$,Q),Q.Representation_asArray&&Q.Representation_asArray.sort(P.getRepresentationSortFunction()).forEach(function(K,Y){M(O.children[V].children[$].children,Y,K)})})})}function C(F,k){var j=k||O;F(j.data),j.children&&j.children.forEach(function(V){return C(F,V)})}function I(F){C(function(k){isNaN(k.selectedIdx)||F===k.baseUrls[k.selectedIdx].serviceLocation&&(k.selectedIdx=d)})}function A(F){p(F)}function S(){O=new _}function x(F){var k=O,j=[k.data];return F&&F.forEach(function(V){k=k.children[V],k&&j.push(k.data)}),j.filter(function(V){return V.baseUrls.length})}return y={reset:S,update:A,getForPath:x,invalidateSelectedIndexes:I,setConfig:T},R(),y}E.__dashjs_factory_name="BaseURLTreeModel";const c=l.default.getClassFactory(E)},"./src/streaming/models/CmcdModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>A});var u=r("./src/core/EventBus.js"),l=r("./src/streaming/MediaPlayerEvents.js"),f=r("./src/streaming/metrics/MetricsReportingEvents.js"),d=r("./src/core/FactoryMaker.js"),_=r("./src/core/Settings.js"),E=r("./src/streaming/constants/Constants.js"),c=r("./src/streaming/vo/metrics/HTTPRequest.js"),y=r("./src/dash/models/DashManifestModel.js"),O=r("./src/core/Utils.js");function P(S,x){var F;if(typeof Symbol>"u"||S[Symbol.iterator]==null){if(Array.isArray(S)||(F=b(S))||x&&S&&typeof S.length=="number"){F&&(S=F);var k=0,j=function(){};return{s:j,n:function(){return k>=S.length?{done:!0}:{done:!1,value:S[k++]}},e:function(Y){throw Y},f:j}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var V=!0,Q=!1,$;return{s:function(){F=S[Symbol.iterator]()},n:function(){var Y=F.next();return V=Y.done,Y},e:function(Y){Q=!0,$=Y},f:function(){try{!V&&F.return!=null&&F.return()}finally{if(Q)throw $}}}}function b(S,x){if(S){if(typeof S=="string")return L(S,x);var F=Object.prototype.toString.call(S).slice(8,-1);if(F==="Object"&&S.constructor&&(F=S.constructor.name),F==="Map"||F==="Set")return Array.from(S);if(F==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(F))return L(S,x)}}function L(S,x){(x==null||x>S.length)&&(x=S.length);for(var F=0,k=new Array(x);F<x;F++)k[F]=S[F];return k}var R="CMCD",T=1,m={MANIFEST:"m",AUDIO:"a",VIDEO:"v",INIT:"i",CAPTION:"c",ISOBMFF_TEXT_TRACK:"tt",ENCRYPTION_KEY:"k",OTHER:"o"},M={DASH:"d",MSS:"s"},p={VOD:"v",LIVE:"l"},C=5;function I(){var S,x,F,k,j,V,Q,$,K,Y,re=this.context,ie=(0,u.default)(re).getInstance(),ee=(0,_.default)(re).getInstance();function ne(){S=(0,y.default)(re).getInstance(),X()}function ae(){ie.on(l.default.PLAYBACK_RATE_CHANGED,ve,x),ie.on(l.default.MANIFEST_LOADED,me,x),ie.on(l.default.BUFFER_LEVEL_STATE_CHANGED,Ae,x),ie.on(l.default.PLAYBACK_SEEKED,be,x),ie.on(l.default.PERIOD_SWITCH_COMPLETED,oe,x)}function ce(Se){Se&&(Se.abrController&&(k=Se.abrController),Se.dashMetrics&&(j=Se.dashMetrics),Se.playbackController&&(V=Se.playbackController))}function X(){F={pr:1,nor:null,st:null,sf:null,sid:"".concat(O.default.generateUuid()),cid:null},K={},$={},Y={},ge()}function oe(){ge()}function ge(){if(V){var Se=V.getStreamController();if(Se&&typeof Se.getActiveStream=="function"){var Me=Se.getActiveStream();Me&&(Q=Me.getProcessors())}}}function _e(Se){try{if(ee.get().streaming.cmcd&&ee.get().streaming.cmcd.enabled){var Me=le(Se),qe=he(Me),it=Be(qe);return ie.trigger(f.default.CMCD_DATA_GENERATED,{url:Se.url,mediaType:Se.mediaType,cmcdData:Me,cmcdString:it}),{key:R,value:it}}return null}catch{return null}}function he(Se){try{var Me=ee.get().streaming.cmcd.enabledKeys;return Object.keys(Se).filter(function(qe){return Me.includes(qe)}).reduce(function(qe,it){return qe[it]=Se[it],qe},{})}catch{return Se}}function se(Se,Me){var qe={},it=P(Me),at;try{for(it.s();!(at=it.n()).done;){var Ce=at.value;Se[Ce]&&(qe[Ce]=Se[Ce])}}catch(je){it.e(je)}finally{it.f()}return qe}function Z(Se){try{if(ee.get().streaming.cmcd&&ee.get().streaming.cmcd.enabled){var Me=le(Se),qe=se(Me,q(["br","d","ot","tb"])),it=se(Me,q(["bl","dl","mtp","nor","nrr","su"])),at=se(Me,q(["bs","rtp"])),Ce=se(Me,q(["cid","pr","sf","sid","st","v"])),je={"CMCD-Object":Be(qe),"CMCD-Request":Be(it),"CMCD-Status":Be(at),"CMCD-Session":Be(Ce)};return ie.trigger(f.default.CMCD_DATA_GENERATED,{url:Se.url,mediaType:Se.mediaType,cmcdData:Me,headers:je}),je}return null}catch{return null}}function q(Se){var Me=ee.get().streaming.cmcd.enabledKeys;return Se.filter(function(qe){return Me.includes(qe)})}function le(Se){try{var Me=null;return Se.type===c.HTTPRequest.MPD_TYPE?N(Se):Se.type===c.HTTPRequest.MEDIA_SEGMENT_TYPE?(w(Se.mediaType),D(Se)):Se.type===c.HTTPRequest.INIT_SEGMENT_TYPE?W(Se):Se.type===c.HTTPRequest.OTHER_TYPE||Se.type===c.HTTPRequest.XLINK_EXPANSION_TYPE?H(Se):Se.type===c.HTTPRequest.LICENSE?te(Se):Me}catch{return null}}function te(Se){var Me=U();return Me.ot=m.ENCRYPTION_KEY,Me}function N(){var Se=U();return Se.ot=m.MANIFEST,Se}function D(Se){var Me=U(),qe=B(Se),it=z(Se),at=fe(Se.mediaType),Ce=ue(Se.mediaType),je=J(Se.mediaType),Ge=G(Se.mediaType),tt=F.pr,ot=ke(Se.mediaType),dt;Se.mediaType===E.default.VIDEO&&(dt=m.VIDEO),Se.mediaType===E.default.AUDIO&&(dt=m.AUDIO),Se.mediaType===E.default.TEXT&&(Se.mediaInfo.mimeType==="application/mp4"?dt=m.ISOBMFF_TEXT_TRACK:dt=m.CAPTION);var gt=ee.get().streaming.cmcd.rtp;return gt||(gt=Ye(Se)),Me.rtp=gt,ot&&(Se.url!==ot.url?Me.nor=encodeURIComponent(O.default.getRelativeUrl(Se.url,ot.url)):ot.range&&(Me.nrr=ot.range)),qe&&(Me.br=qe),dt&&(Me.ot=dt),isNaN(it)||(Me.d=it),isNaN(at)||(Me.mtp=at),isNaN(Ce)||(Me.dl=Ce),isNaN(je)||(Me.bl=je),isNaN(Ge)||(Me.tb=Ge),!isNaN(tt)&&tt!==1&&(Me.pr=tt),K[Se.mediaType]&&(Me.bs=!0,K[Se.mediaType]=!1),($[Se.mediaType]||!Y[Se.mediaType])&&(Me.su=!0,$[Se.mediaType]=!1,Y[Se.mediaType]=!0),Me}function w(Se){Y.hasOwnProperty(Se)||(Y[Se]=!1),$.hasOwnProperty(Se)||($[Se]=!1),K.hasOwnProperty(Se)||(K[Se]=!1)}function W(){var Se=U();return Se.ot=m.INIT,Se.su=!0,Se}function H(){var Se=U();return Se.ot=m.OTHER,Se}function U(){var Se={},Me=ee.get().streaming.cmcd.cid?ee.get().streaming.cmcd.cid:F.cid;return Se.v=T,Se.sid=ee.get().streaming.cmcd.sid?ee.get().streaming.cmcd.sid:F.sid,Se.sid="".concat(Se.sid),Me&&(Se.cid="".concat(Me)),!isNaN(F.pr)&&F.pr!==1&&F.pr!==null&&(Se.pr=F.pr),F.st&&(Se.st=F.st),F.sf&&(Se.sf=F.sf),Se}function B(Se){try{var Me=Se.quality,qe=Se.mediaInfo.bitrateList;return parseInt(qe[Me].bandwidth/1e3)}catch{return null}}function G(Se){try{var Me=k.getTopBitrateInfoFor(Se);return Math.round(Me.bitrate/1e3)}catch{return null}}function z(Se){try{return isNaN(Se.duration)?null:Math.round(Se.duration*1e3)}catch{return null}}function fe(Se){try{return parseInt(k.getThroughputHistory().getSafeAverageThroughput(Se)/100)*100}catch{return null}}function ue(Se){try{var Me=F.pr,qe=j.getCurrentBufferLevel(Se);return!isNaN(Me)&&!isNaN(qe)?parseInt(qe/Me*10)*100:null}catch{return null}}function J(Se){try{var Me=j.getCurrentBufferLevel(Se);return isNaN(Me)?null:parseInt(Me*10)*100}catch{return null}}function ve(Se){try{F.pr=Se.playbackRate}catch{}}function me(Se){try{var Me=S.getIsDynamic(Se.data),qe=Me?p.LIVE:p.VOD,it=Se.protocol&&Se.protocol==="MSS"?M.MSS:M.DASH;F.st="".concat(qe),F.sf="".concat(it)}catch{}}function Ae(Se){try{Se.state&&Se.mediaType&&Se.state===l.default.BUFFER_EMPTY&&(K[Se.mediaType]||(K[Se.mediaType]=!0),$[Se.mediaType]||($[Se.mediaType]=!0))}catch{}}function be(){for(var Se in K)K.hasOwnProperty(Se)&&(K[Se]=!0);for(var Me in $)$.hasOwnProperty(Me)&&($[Me]=!0)}function Be(Se){try{if(!Se)return null;var Me=Object.keys(Se).sort(function(at,Ce){return at.localeCompare(Ce)}),qe=Me.length,it=Me.reduce(function(at,Ce,je){return Ce==="v"&&Se[Ce]===1||(typeof Se[Ce]=="string"&&Ce!=="ot"&&Ce!=="sf"&&Ce!=="st"?at+="".concat(Ce,"=").concat(JSON.stringify(Se[Ce])):at+="".concat(Ce,"=").concat(Se[Ce]),je<qe-1&&(at+=",")),at},"");return it=it.replace(/=true/g,""),it=it.replace(/,\s*$/,""),it}catch{return null}}function ke(Se){if(!(!Q||Q.length===0)){var Me=P(Q),qe;try{for(Me.s();!(qe=Me.n()).done;){var it=qe.value;if(it.getType()===Se)return it.probeNextRequest()}}catch(at){Me.e(at)}finally{Me.f()}}}function Ye(Se){var Me=V.getPlaybackRate();Me||(Me=1);var qe=Se.quality,it=Se.mediaType,at=Se.mediaInfo,Ce=Se.duration,je=J(it);je===0&&(je=500);var Ge=at.bitrateList[qe].bandwidth,tt=Ge*Ce/1e3,ot=je/Me/1e3,dt=tt/ot,gt=ee.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(ee.get().streaming.cmcd.rtpSafetyFactor)?ee.get().streaming.cmcd.rtpSafetyFactor:C,Mt=dt*gt,$e=(parseInt(Mt/100)+1)*100;return $e}function Le(){ie.off(l.default.PLAYBACK_RATE_CHANGED,ve,this),ie.off(l.default.MANIFEST_LOADED,me,this),ie.off(l.default.BUFFER_LEVEL_STATE_CHANGED,Ae,x),ie.off(l.default.PLAYBACK_SEEKED,be,x),X()}return x={getQueryParameter:_e,getHeaderParameters:Z,setConfig:ce,reset:Le,initialize:ae},ne(),x}I.__dashjs_factory_name="CmcdModel";const A=d.default.getSingletonFactory(I)},"./src/streaming/models/CmsdModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>j});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js"),d=r("./src/core/Debug.js");function _(V){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_=function($){return typeof $}:_=function($){return $&&typeof Symbol=="function"&&$.constructor===Symbol&&$!==Symbol.prototype?"symbol":typeof $},_(V)}function E(V,Q){E=function(ne,ae){return new re(ne,void 0,ae)};var $=y(RegExp),K=RegExp.prototype,Y=new WeakMap;function re(ee,ne,ae){var ce=$.call(this,ee,ne);return Y.set(ce,ae||Y.get(ee)),ce}c(re,$),re.prototype.exec=function(ee){var ne=K.exec.call(this,ee);return ne&&(ne.groups=ie(ne,this)),ne},re.prototype[Symbol.replace]=function(ee,ne){if(typeof ne=="string"){var ae=Y.get(this);return K[Symbol.replace].call(this,ee,ne.replace(/\$<([^>]+)>/g,function(X,oe){return"$"+ae[oe]}))}else if(typeof ne=="function"){var ce=this;return K[Symbol.replace].call(this,ee,function(){var X=[];return X.push.apply(X,arguments),_(X[X.length-1])!=="object"&&X.push(ie(X,ce)),ne.apply(this,X)})}else return K[Symbol.replace].call(this,ee,ne)};function ie(ee,ne){var ae=Y.get(ne);return Object.keys(ae).reduce(function(ce,X){return ce[X]=ee[ae[X]],ce},Object.create(null))}return E.apply(this,arguments)}function c(V,Q){if(typeof Q!="function"&&Q!==null)throw new TypeError("Super expression must either be null or a function");V.prototype=Object.create(Q&&Q.prototype,{constructor:{value:V,writable:!0,configurable:!0}}),Q&&L(V,Q)}function y(V){var Q=typeof Map=="function"?new Map:void 0;return y=function(K){if(K===null||!b(K))return K;if(typeof K!="function")throw new TypeError("Super expression must either be null or a function");if(typeof Q<"u"){if(Q.has(K))return Q.get(K);Q.set(K,Y)}function Y(){return O(K,arguments,R(this).constructor)}return Y.prototype=Object.create(K.prototype,{constructor:{value:Y,enumerable:!1,writable:!0,configurable:!0}}),L(Y,K)},y(V)}function O(V,Q,$){return P()?O=Reflect.construct:O=function(Y,re,ie){var ee=[null];ee.push.apply(ee,re);var ne=Function.bind.apply(Y,ee),ae=new ne;return ie&&L(ae,ie.prototype),ae},O.apply(null,arguments)}function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function b(V){return Function.toString.call(V).indexOf("[native code]")!==-1}function L(V,Q){return L=Object.setPrototypeOf||function(K,Y){return K.__proto__=Y,K},L(V,Q)}function R(V){return R=Object.setPrototypeOf?Object.getPrototypeOf:function($){return $.__proto__||Object.getPrototypeOf($)},R(V)}var T="static",m="dynamic",M="cmsd-",p=M+T,C=M+m,I={AVAILABILITY_TIME:"at",DURESS:"du",ENCODED_BITRATE:"br",ESTIMATED_THROUGHPUT:"etp",HELD_TIME:"ht",INTERMEDIARY_IDENTIFIER:"n",MAX_SUGGESTED_BITRATE:"mb",NEXT_OBJECT_RESPONSE:"nor",NEXT_RANGE_RESPONSE:"nrr",OBJECT_DURATION:"d",OBJECT_TYPE:"ot",RESPONSE_DELAY:"rd",ROUND_TRIP_TIME:"rtt",STARTUP:"su",STREAM_TYPE:"st",STREAMING_FORMAT:"sf",VERSION:"v"},A={MANIFEST:"m",AUDIO:"a",VIDEO:"v",INIT:"i",CAPTION:"c",ISOBMFF_TEXT_TRACK:"tt",ENCRYPTION_KEY:"k",OTHER:"o",STREAM:"stream"},S=[I.MAX_SUGGESTED_BITRATE,I.STREAM_TYPE,I.STREAMING_FORMAT,I.VERSION],x={video:A.VIDEO,audio:A.AUDIO,text:A.ISOBMFF_TEXT_TRACK,stream:A.STREAM},F=/^[-0-9]/;function k(){var V=this.context,Q=(0,l.default)(V).getInstance(),$,K,Y,re;function ie(){K=(0,d.default)(V).getInstance().getLogger($),ae()}function ee(){}function ne(){}function ae(){Y={},re={}}function ce(D){D&&Object.keys(D).forEach(function(w){S.includes(w)||delete D[w]})}function X(D){return D?D.toLowerCase()==="false"?!1:F.test(D)?parseInt(D,10):D.replace(/["]+/g,""):!0}function oe(D){try{for(var w={},W=D.split(","),H=0;H<W.length;H++){var U=W[H].split("="),B=U[0],G=X(U[1]);w[B]=G}return w}catch(z){K.error("Failed to parse CMSD-Static response header value:",z)}}function ge(D){try{for(var w={},W=D.split(","),H=W[W.length-1],U=H.split(";"),B=1;B<U.length;B++){var G=U[B].split("="),z=G[0],fe=X(G[1]);w[z]=fe}return w}catch(ue){return K.error("Failed to parse CMSD-Dynamic response header value:",ue),[]}}function _e(D){return x[D]||A.OTHER}function he(D,w,W){var H=D===T?Y:re,U=H[w]||{},B=H[A.STREAM]||{},G=U[W]||B[W];return G}function se(D,w){for(var W=null,H=null,U=D.split(`\r
`),B=U.length-1;B>=0;B--){var G=U[B],z=G.match(E(/^((?:(?!:)[\s\S])*):[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(.*)$/,{key:1,value:2}));if(z&&z.groups){var fe=z.groups.key.toLowerCase(),ue=z.groups.value;switch(fe){case p:W=oe(ue),Q.trigger(f.default.CMSD_STATIC_HEADER,W);break;case C:H||(H=ge(ue));break}}}var J=A.STREAM;return W&&W[I.OBJECT_TYPE]?J=W[I.OBJECT_TYPE]:w&&(J=_e(w)),ce(Y[J]),ce(re[J]),W&&(Y[J]=Object.assign(Y[J]||{},W)),H&&(re[J]=Object.assign(re[J]||{},H)),{static:W,dynamic:H}}function Z(D){var w=_e(D),W=he(m,w,I.MAX_SUGGESTED_BITRATE);return W||-1}function q(D){var w=_e(D),W=he(m,w,I.ESTIMATED_THROUGHPUT);return W||null}function le(D){var w=_e(D),W=he(m,w,I.RESPONSE_DELAY);return W||null}function te(D){var w=_e(D),W=he(m,w,I.ROUND_TRIP_TIME);return W||null}function N(){ae()}return $={setConfig:ne,initialize:ee,reset:N,parseResponseHeaders:se,getMaxBitrate:Z,getEstimatedThroughput:q,getResponseDelay:le,getRoundTripTime:te},ie(),$}k.__dashjs_factory_name="CmsdModel";const j=u.default.getSingletonFactory(k)},"./src/streaming/models/CustomParametersModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>O});var u=r("./src/dash/vo/UTCTiming.js"),l=r("./src/core/FactoryMaker.js"),f=r("./src/core/Settings.js"),d=r("./src/streaming/utils/SupervisorTools.js"),_=r("./src/streaming/rules/abr/ABRRulesCollection.js"),E=r("./src/streaming/constants/Constants.js"),c=!1;function y(){var P,b,L,R,T,m,M,p,C=this.context,I=(0,f.default)(C).getInstance();function A(){L={default:c},S()}function S(){R=[],T=[],m=[],p=[],M=null,b=[]}function x(){S()}function F(){}function k(w){M=w}function j(){M=null}function V(){return M}function Q(){return R}function $(){return T}function K(w){R.push(w)}function Y(w){T.push(w)}function re(w){ce(R,w)}function ie(w){ce(T,w)}function ee(){return m}function ne(w){m.push(w)}function ae(w){ce(m,w)}function ce(w,W){var H=-1;w.some(function(U,B){if(U===W)return H=B,!0}),!(H<0)&&w.splice(H,1)}function X(w){var W;for(W=0;W<p.length;W++)if(p[W].rulename===w)return W;return-1}function oe(w,W,H){if(typeof w!="string"||w!==_.default.ABANDON_FRAGMENT_RULES&&w!==_.default.QUALITY_SWITCH_RULES||typeof W!="string")throw E.default.BAD_ARGUMENT_ERROR;var U=X(W);U===-1?p.push({type:w,rulename:W,rule:H}):(p[U].type=w,p[U].rule=H)}function ge(w){if(w){var W=X(w);W!==-1&&p.splice(W,1)}else p=[]}function _e(){p=[]}function he(){return p}function se(w,W){q(w,W);var H=new u.default;H.schemeIdUri=w,H.value=W,b.push(H)}function Z(){return b}function q(w,W){(0,d.checkParameterType)(w,"string"),(0,d.checkParameterType)(W,"string"),b.forEach(function(H,U){H.schemeIdUri===w&&H.value===W&&b.splice(U,1)})}function le(){b=[]}function te(){var w=I.get().streaming.utcSynchronization.defaultTimingSource;se(w.scheme,w.value)}function N(w,W){w?L[w]=!!W:Object.keys(L).forEach(function(H){N(H,W)})}function D(w){var W=L[w];return W===void 0?L.default:W}return P={getCustomInitialTrackSelectionFunction:V,setCustomInitialTrackSelectionFunction:k,resetCustomInitialTrackSelectionFunction:j,getLicenseResponseFilters:$,getLicenseRequestFilters:Q,getCustomCapabilitiesFilters:ee,registerCustomCapabilitiesFilter:ne,registerLicenseResponseFilter:Y,registerLicenseRequestFilter:K,unregisterCustomCapabilitiesFilter:ae,unregisterLicenseResponseFilter:ie,unregisterLicenseRequestFilter:re,addAbrCustomRule:oe,removeAllAbrCustomRule:_e,removeAbrCustomRule:ge,getAbrCustomRules:he,addUTCTimingSource:se,removeUTCTimingSource:q,getUTCTimingSources:Z,clearDefaultUTCTimingSources:le,restoreDefaultUTCTimingSources:te,setXHRWithCredentialsForType:N,getXHRWithCredentialsForType:D,setConfig:F,reset:x},A(),P}y.__dashjs_factory_name="CustomParametersModel";const O=l.default.getSingletonFactory(y)},"./src/streaming/models/FragmentModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>O});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/vo/FragmentRequest.js"),f="loading",d="executed",_="canceled",E="failed";function c(P){P=P||{};var b=P.eventBus,L=P.events,R=P.dashMetrics,T=P.fragmentLoader,m=P.debug,M=P.streamInfo,p=P.type,C,I,A,S;function x(){I=m.getLogger(C),Z(),b.on(L.LOADING_COMPLETED,_e,C),b.on(L.LOADING_DATA_PROGRESS,he,C),b.on(L.LOADING_ABANDONED,se,C)}function F(){return M.id}function k(){return p}function j(te){var N=function(U,B){return U.action===l.default.ACTION_COMPLETE&&U.action===B.action},D=function(U,B){return!isNaN(U.index)&&U.startTime===B.startTime&&U.adaptationIndex===B.adaptationIndex&&U.type===B.type},w=function(U,B){return isNaN(U.index)&&isNaN(B.index)&&U.quality===B.quality},W=function(U){var B=!1;return U.some(function(G){if(D(te,G)||w(te,G)||N(te,G))return B=!0,B}),B};return te?W(A):!1}function V(te){var N=!1,D=0,w;if(N=j(te),!N)for(D=0;D<S.length;D++)w=S[D],te.url===w.url&&te.startTime===w.startTime&&(N=!0);return N}function Q(te){var N=te?te.state instanceof Array?te.state:[te.state]:[],D=[];return N.forEach(function(w){var W=oe(w);D=D.concat(X(W,te))}),D}function $(te){return isNaN(te.duration)?.25:Math.min(te.duration/8,.5)}function K(te){A=A.filter(function(N){var D=$(N);return isNaN(N.startTime)||(te!==void 0?N.startTime>=te-D:!1)})}function Y(te){A=A.filter(function(N){return isNaN(N.startTime)||(te!==void 0?N.startTime<te:!1)})}function re(te,N){N<=te+.5||(A=A.filter(function(D){var w=$(D);return isNaN(D.startTime)||D.startTime>=N-w||isNaN(D.duration)||D.startTime+D.duration<=te+w}))}function ie(te,N){if(!te||te.length===0){K();return}for(var D=0,w=0,W=te.length;w<W;w++)re(D,te.start(w)),D=te.end(w);N>0&&re(D,N)}function ee(){I.debug("abort requests"),T.abort(),S=[]}function ne(te){switch(te.action){case l.default.ACTION_DOWNLOAD:ge(te,f),S.push(te),ae(te);break;default:I.warn("Unknown request action.")}}function ae(te){b.trigger(L.FRAGMENT_LOADING_STARTED,{request:te},{streamId:M.id,mediaType:p}),T.load(te)}function ce(te,N,D){for(var w=te.length-1,W=w;W>=0;W--){var H=te[W],U=H.startTime,B=U+H.duration;if(D=isNaN(D)?$(H):D,!isNaN(U)&&!isNaN(B)&&N+D>=U&&N-D<B||isNaN(U)&&isNaN(N))return H}return null}function X(te,N){return N.hasOwnProperty("time")?[ce(te,N.time,N.threshold)]:te.filter(function(D){for(var w in N)if(w!=="state"&&N.hasOwnProperty(w)&&D[w]!=N[w])return!1;return!0})}function oe(te){var N;switch(te){case f:N=S;break;case d:N=A;break;default:N=[]}return N}function ge(te,N){R.addSchedulingInfo(te,N),R.addRequestsQueue(te.mediaType,S,A)}function _e(te){te.sender===T&&(S.splice(S.indexOf(te.request),1),te.response&&!te.error&&A.push(te.request),ge(te.request,te.error?E:d),b.trigger(L.FRAGMENT_LOADING_COMPLETED,{request:te.request,response:te.response,error:te.error,sender:this},{streamId:M.id,mediaType:p}))}function he(te){te.sender===T&&b.trigger(L.FRAGMENT_LOADING_PROGRESS,{request:te.request,response:te.response,error:te.error,sender:this},{streamId:M.id,mediaType:p})}function se(te){te.sender===T&&b.trigger(L.FRAGMENT_LOADING_ABANDONED,{request:te.request},{streamId:M.id,mediaType:p})}function Z(){A=[],S=[]}function q(){b.off(L.LOADING_COMPLETED,_e,this),b.off(L.LOADING_DATA_PROGRESS,he,this),b.off(L.LOADING_ABANDONED,se,this),T&&T.reset(),Z()}function le(te){A.push(te)}return C={getStreamId:F,getType:k,getRequests:Q,isFragmentLoaded:j,isFragmentLoadedOrPending:V,removeExecutedRequestsBeforeTime:K,removeExecutedRequestsAfterTime:Y,syncExecutedRequestsWithBufferedRange:ie,abortRequests:ee,executeRequest:ne,reset:q,resetInitialSettings:Z,addExecutedRequest:le},x(),C}c.__dashjs_factory_name="FragmentModel";var y=u.default.getClassFactory(c);y.FRAGMENT_MODEL_LOADING=f,y.FRAGMENT_MODEL_EXECUTED=d,y.FRAGMENT_MODEL_CANCELED=_,y.FRAGMENT_MODEL_FAILED=E,u.default.updateClassFactory(c.__dashjs_factory_name,y);const O=y},"./src/streaming/models/LowLatencyThroughputModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/core/Debug.js"),l=r("./src/core/FactoryMaker.js");function f(){var _=10,E=.8,c=.6,y=1.05,O=250,P=this.context,b,L,R={};function T(){L=(0,u.default)(P).getInstance().getLogger(b)}function m(A){for(var S={},x=0,F=0,k=0,j=0,V=A.length,Q=0;Q<V;++Q)x+=A[Q].chunkDownloadTimeRelativeMS,F+=A[Q].bufferLevel,k+=A[Q].chunkDownloadTimeRelativeMS*A[Q].bufferLevel,j+=A[Q].chunkDownloadTimeRelativeMS*A[Q].chunkDownloadTimeRelativeMS;return S.m=(k-x*F/V)/(j-x*x/V),S.b=F/V-S.m*x/V,function($){return S.m*$+S.b}}function M(A){var S=!0,x,F=A.reduce(function(k,j){return k+j.bufferLevelAtSegmentEnd},0)/A.length;return A.forEach(function(k){Math.abs(k.bufferLevelAtSegmentEnd/k.bufferLevelAtSegmentStart)<.95&&(S=!1),k.bufferLevelAtSegmentEnd/F<.8&&(S=!1),x?x>k.bitrate&&(S=!1):x=k.bitrate}),S}function p(A){var S=R[A.mediaType].slice(-1).pop(),x=R[A.mediaType].slice(-3),F=S.chunkMeasurements.slice(-1).pop().chunkDownloadTimeRelativeMS;S.bufferLevelAtSegmentStart=S.getEstimatedBufferLevel(F/2),S.bufferLevelAtSegmentEnd=S.getEstimatedBufferLevel(F);var k=M(x),j=k?c:E;if(S.isBufferStable&&S.segDurationMS*y<S.fetchDownloadDurationMS)return S.fetchDownloadDurationMS;if(!k||S.segDurationMS<S.fetchDownloadDurationMS||S.adjustedAvailabilityStartTimeMS<=S.requestTimeMS+S.throughputCapacityDelayMS-S.segDurationMS)return S.fetchDownloadDurationMS*E;for(var V=S.requestTimeMS+S.throughputCapacityDelayMS-S.adjustedAvailabilityStartTimeMS,Q=0,$=0,K=0,Y=0;Y<S.chunkMeasurements.length;Y++){var re=S.chunkMeasurements[Y];if(V<$+re.chunkDownloadDurationMS)break;$+=re.chunkDownloadDurationMS,Q+=re.chunkBytes,K++}if(V<0&&L.warn("request time was before adjusted availibitly start time"),Q&&$&&K>S.chunkMeasurements.length*.2){var ie=Q/$,ee=S.segmentBytes/ie;return S.fetchDownloadDurationMS<ee?S.fetchDownloadDurationMS*j:ee*j}var ne=S.bitrate;return S.bitrateList.some(function(ae){if(ae.bandwidth>S.bitrate)return ne=ae.bandwidth,!0}),ne===S.bitrate?S.fetchDownloadDurationMS*j:j*S.segmentBytes*8*1e3/ne}function C(A,S){var x=R[A.mediaType]&&R[A.mediaType].slice(-3);return!x||x.length<3||!M(x)?0:S/4>O?O:S/4}function I(A,S,x,F,k){A&&A.mediaType&&!R[A.mediaType]&&(R[A.mediaType]=[]);var j=A.mediaInfo.bitrateList.find(function(V){return V.id===A.representationId});R[A.mediaType].push({index:A.index,repId:A.representationId,mediaType:A.mediaType,requestTimeMS:F,adjustedAvailabilityStartTimeMS:A.availabilityStartTime.getTime(),segDurationMS:A.duration*1e3,chunksDurationMS:x.reduce(function(V,Q){return V+Q.chunkDownloadDurationMS},0),segmentBytes:x.reduce(function(V,Q){return V+Q.chunkBytes},0),bitrate:j&&j.bandwidth,bitrateList:A.mediaInfo.bitrateList,chunkMeasurements:x,fetchDownloadDurationMS:S,throughputCapacityDelayMS:k,getEstimatedBufferLevel:m(x.slice(1))}),R[A.mediaType].length>_&&R[A.mediaType].shift()}return b={setup:T,addMeasurement:I,getThroughputCapacityDelayMS:C,getEstimatedDownloadDurationMS:p},T(),b}f.__dashjs_factory_name="LowLatencyThroughputModel";const d=l.default.getSingletonFactory(f)},"./src/streaming/models/ManifestModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),f=r("./src/core/FactoryMaker.js");function d(){var E=this.context,c=(0,u.default)(E).getInstance(),y,O;function P(){return O}function b(L){O=L,L&&c.trigger(l.default.MANIFEST_LOADED,{data:L})}return y={getValue:P,setValue:b},y}d.__dashjs_factory_name="ManifestModel";const _=f.default.getSingletonFactory(d)},"./src/streaming/models/MediaPlayerModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>T});var u=r("./src/core/Debug.js"),l=r("./src/core/FactoryMaker.js"),f=r("./src/core/Settings.js"),d=12,_=20,E=10,c=5,y=12,O=-.5,P=.5,b=-.5,L=1;function R(){var m,M,p,C,I=this.context,A=(0,f.default)(I).getInstance();function S(){M=(0,u.default)(I).getInstance().getLogger(m)}function x(ne){ne.playbackController&&(p=ne.playbackController),ne.serviceDescriptionController&&(C=ne.serviceDescriptionController)}function F(ne,ae){return isNaN(ne)?0:ne>0?(ae&&M.warn("Supplied minimum playback rate is a positive value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):ne<b?(ae&&M.warn("Supplied minimum playback rate is out of range and will be limited to ".concat(b,": ").concat(b*100,"% playback speed.")),b):ne}function k(ne,ae){return isNaN(ne)?0:ne<0?(ae&&M.warn("Supplied maximum playback rate is a negative value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):ne>L?(ae&&M.warn("Supplied maximum playback rate is out of range and will be limited to ".concat(L,": ").concat((1+L)*100,"% playback speed.")),L):ne}function j(){if(!isNaN(A.get().streaming.liveCatchup.maxDrift)&&A.get().streaming.liveCatchup.maxDrift>0)return A.get().streaming.liveCatchup.maxDrift;var ne=C.getServiceDescriptionSettings();return ne&&ne.liveCatchup&&!isNaN(ne.liveCatchup.maxDrift)&&ne.liveCatchup.maxDrift>0?ne.liveCatchup.maxDrift:y}function V(ne){var ae=A.get().streaming.liveCatchup.playbackRate;if(!isNaN(ae.min)||!isNaN(ae.max))return{min:F(ae.min,ne),max:k(ae.max,ne)};var ce=C.getServiceDescriptionSettings();if(ce&&ce.liveCatchup&&(!isNaN(ce.liveCatchup.playbackRate.min)||!isNaN(ce.liveCatchup.playbackRate.max))){var X=ce.liveCatchup.playbackRate;return{min:F(X.min,ne),max:k(X.max,ne)}}return{min:O,max:P}}function Q(){return A.get().streaming.liveCatchup.enabled!==null?A.get().streaming.liveCatchup.enabled:p.getInitialCatchupModeActivated()}function $(ne,ae){try{var ce=A.get().streaming.abr[ne][ae];if(!isNaN(ce)&&ce!==-1)return ce;var X=C.getServiceDescriptionSettings();return X&&X[ne]&&!isNaN(X[ne][ae])?X[ne][ae]:-1}catch{return-1}}function K(){var ne=A.get().streaming.buffer.initialBufferLevel;return isNaN(ne)||ne<0?0:Math.min(Y(),ne)}function Y(){var ne=A.get().streaming.buffer.stableBufferTime>0?A.get().streaming.buffer.stableBufferTime:A.get().streaming.buffer.fastSwitchEnabled?_:d,ae=p.getLiveDelay();return!isNaN(ae)&&ae>0?Math.min(ne,ae):ne}function re(ne){var ae=isNaN(A.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?c:A.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return p.getLowLatencyModeEnabled()?A.get().streaming.retryAttempts[ne]*ae:A.get().streaming.retryAttempts[ne]}function ie(ne){var ae=isNaN(A.get().streaming.retryIntervals.lowLatencyReductionFactor)?E:A.get().streaming.retryIntervals.lowLatencyReductionFactor;return p.getLowLatencyModeEnabled()?A.get().streaming.retryIntervals[ne]/ae:A.get().streaming.retryIntervals[ne]}function ee(){}return m={getCatchupMaxDrift:j,getCatchupModeEnabled:Q,getStableBufferTime:Y,getInitialBufferLevel:K,getRetryAttemptsForType:re,getRetryIntervalsForType:ie,getCatchupPlaybackRates:V,getAbrBitrateParameter:$,setConfig:x,reset:ee},S(),m}R.__dashjs_factory_name="MediaPlayerModel";const T=l.default.getSingletonFactory(R)},"./src/streaming/models/MetricsModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>p});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/streaming/constants/MetricsConstants.js"),f=r("./src/streaming/vo/MetricsList.js"),d=r("./src/streaming/vo/metrics/HTTPRequest.js"),_=r("./src/streaming/vo/metrics/RepresentationSwitch.js"),E=r("./src/streaming/vo/metrics/BufferLevel.js"),c=r("./src/streaming/vo/metrics/BufferState.js"),y=r("./src/streaming/vo/metrics/DVRInfo.js"),O=r("./src/streaming/vo/metrics/DroppedFrames.js"),P=r("./src/streaming/vo/metrics/ManifestUpdate.js"),b=r("./src/streaming/vo/metrics/SchedulingInfo.js"),L=r("./src/core/EventBus.js"),R=r("./src/streaming/vo/metrics/RequestsQueue.js"),T=r("./src/core/events/Events.js"),m=r("./src/core/FactoryMaker.js");function M(C){C=C||{};var I=C.settings,A=this.context,S=(0,L.default)(A).getInstance(),x,F;function k(){F={}}function j(){S.trigger(T.default.METRICS_CHANGED)}function V(w){S.trigger(T.default.METRIC_CHANGED,{mediaType:w}),j()}function Q(w,W,H){S.trigger(T.default.METRIC_UPDATED,{mediaType:w,metric:W,value:H}),V(w)}function $(w,W,H){S.trigger(T.default.METRIC_ADDED,{mediaType:w,metric:W,value:H}),V(w)}function K(w){delete F[w],V(w)}function Y(){F={},j()}function re(w,W){var H=null;return w&&(F.hasOwnProperty(w)?H=F[w]:W||(H=new f.default,F[w]=H)),H}function ie(w,W,H){var U=re(w);U!==null&&(U[W].push(H),U[W].length>I.get().streaming.metrics.maxListDepth&&U[W].shift())}function ee(w,W,H,U){var B=new d.HTTPRequestTrace;return B.s=W,B.d=H,B.b=U,w.trace.push(B),w.interval||(w.interval=0),w.interval+=H,B}function ne(w,W,H,U,B,G,z,fe,ue,J,ve,me,Ae,be,Be,ke,Ye){var Le=new d.HTTPRequest;G&&G!==U&&(ne(w,null,H,U,B,null,null,fe,ue,null,null,null,Ae,null,null,ke,Ye),Le.actualurl=G),Le.tcpid=W,Le.type=H,Le.url=U,Le.range=fe,Le.trequest=ue,Le.tresponse=J,Le.responsecode=me,Le.cmsd=Ye,Le._tfinish=ve,Le._stream=w,Le._mediaduration=Ae,Le._quality=B,Le._responseHeaders=be,Le._serviceLocation=z,Le._fileLoaderType=ke,Be?Be.forEach(function(Se){ee(Le,Se.s,Se.d,Se.b)}):(delete Le.interval,delete Le.trace),ce(w,l.default.HTTP_REQUEST,Le)}function ae(w,W,H,U,B){var G=new _.default;G.t=W,G.mt=H,G.to=U,B?G.lto=B:delete G.lto,ce(w,l.default.TRACK_SWITCH,G)}function ce(w,W,H){ie(w,W,H),$(w,W,H)}function X(w,W,H){var U=new E.default;U.t=W,U.level=H,ce(w,l.default.BUFFER_LEVEL,U)}function oe(w,W,H){var U=new c.default;U.target=H,U.state=W,ce(w,l.default.BUFFER_STATE,U)}function ge(w,W,H,U){var B=new y.default;B.time=W,B.range=U,B.manifestInfo=H,ce(w,l.default.DVR_INFO,B)}function _e(w,W){var H=new O.default,U=re(w).DroppedFrames;W&&(H.time=W.creationTime,H.droppedFrames=W.droppedVideoFrames,!(U.length>0&&U[U.length-1]==H)&&ce(w,l.default.DROPPED_FRAMES,H))}function he(w,W,H,U,B,G,z,fe,ue){var J=new b.default;J.mediaType=w,J.t=W,J.type=H,J.startTime=U,J.availabilityStartTime=B,J.duration=G,J.quality=z,J.range=fe,J.state=ue,ce(w,l.default.SCHEDULING_INFO,J)}function se(w,W,H){var U=new R.default;U.loadingRequests=W,U.executedRequests=H,re(w).RequestsQueue=U,$(w,l.default.REQUESTS_QUEUE,U)}function Z(w,W,H,U,B,G,z,fe,ue,J){var ve=new P.ManifestUpdate;ve.mediaType=w,ve.type=W,ve.requestTime=H,ve.fetchTime=U,ve.availabilityStartTime=B,ve.presentationStartTime=G,ve.clientTimeOffset=z,ve.currentTime=fe,ve.buffered=ue,ve.latency=J,ie(u.default.STREAM,l.default.MANIFEST_UPDATE,ve),$(w,l.default.MANIFEST_UPDATE,ve)}function q(w,W){if(w){for(var H in W)w[H]=W[H];Q(w.mediaType,l.default.MANIFEST_UPDATE,w)}}function le(w,W,H,U,B){if(w){var G=new P.ManifestUpdateStreamInfo;G.id=W,G.index=H,G.start=U,G.duration=B,w.streamInfo.push(G),Q(w.mediaType,l.default.MANIFEST_UPDATE_STREAM_INFO,w)}}function te(w,W,H,U,B,G,z,fe){if(w&&w.representationInfo){var ue=new P.ManifestUpdateRepresentationInfo;ue.id=W,ue.index=H,ue.streamIndex=U,ue.mediaType=B,ue.startNumber=z,ue.fragmentInfoType=fe,ue.presentationTimeOffset=G,w.representationInfo.push(ue),Q(w.mediaType,l.default.MANIFEST_UPDATE_TRACK_INFO,w)}}function N(w){w.trace&&Array.isArray(w.trace)?w.trace.forEach(function(W){W.hasOwnProperty("subreplevel")&&!W.subreplevel&&delete W.subreplevel}):delete w.trace,ce(u.default.STREAM,l.default.PLAY_LIST,w)}function D(w){ce(u.default.STREAM,l.default.DVB_ERRORS,w)}return x={clearCurrentMetricsForType:K,clearAllCurrentMetrics:Y,getMetricsFor:re,addHttpRequest:ne,addRepresentationSwitch:ae,addBufferLevel:X,addBufferState:oe,addDVRInfo:ge,addDroppedFrames:_e,addSchedulingInfo:he,addRequestsQueue:se,addManifestUpdate:Z,updateManifestUpdateInfo:q,addManifestUpdateStreamInfo:le,addManifestUpdateRepresentationInfo:te,addPlayList:N,addDVBErrors:D},k(),x}M.__dashjs_factory_name="MetricsModel";const p=m.default.getSingletonFactory(M)},"./src/streaming/models/URIFragmentModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/streaming/vo/URIFragmentData.js"),l=r("./src/core/FactoryMaker.js");function f(){var _,E;function c(O){if(E=new u.default,!O)return null;var P=O.indexOf("#");if(P!==-1)for(var b=O.substr(P+1).split("&"),L=0,R=b.length;L<R;++L){var T=b[L],m=T.indexOf("=");if(m!==-1){var M=T.substring(0,m);E.hasOwnProperty(M)&&(E[M]=T.substr(m+1))}}}function y(){return E}return _={initialize:c,getURIFragmentData:y},_}f.__dashjs_factory_name="URIFragmentModel";const d=l.default.getSingletonFactory(f)},"./src/streaming/models/VideoModel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>y});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js"),d=r("./src/core/Debug.js"),_=r("./src/streaming/constants/Constants.js"),E=new Map([[_.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,"loadedmetadata"],[_.default.VIDEO_ELEMENT_READY_STATES.HAVE_CURRENT_DATA,"loadeddata"],[_.default.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,"canplay"],[_.default.VIDEO_ELEMENT_READY_STATES.HAVE_ENOUGH_DATA,"canplaythrough"]]);function c(){var O,P,b,L,R,T,m="element is not video or audio DOM type!",M=this.context,p=(0,l.default)(M).getInstance(),C=[];function I(){P=(0,d.default)(M).getInstance().getLogger(O),L=NaN}function A(){p.on(f.default.PLAYBACK_PLAYING,ge,this)}function S(){p.off(f.default.PLAYBACK_PLAYING,ge,this)}function x(){b&&(b.playbackRate=1,b.removeEventListener("canplay",x))}function F(Le){var Se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;b&&(!Se&&b.readyState<=2&&Le>0?b.addEventListener("canplay",x):b.playbackRate=Le)}function k(Le,Se){b&&(L=Le,ke(_.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,function(){if(b.currentTime===L){L=NaN;return}try{L=Se?j(L):L,b.currentTime=L,L=NaN}catch(Me){b.readyState===0&&Me.code===Me.INVALID_STATE_ERR&&setTimeout(function(){b.currentTime=L,L=NaN},400)}}))}function j(Le){var Se=U(),Me=Le,qe=9999999999;if(Se)for(var it=0;it<Se.length;it++){var at=Se.start(it),Ce=Se.end(it),je=Math.abs(at-Le),Ge=Math.abs(Ce-Le);if(Le>=at&&Le<=Ce)return Le;je<qe&&(qe=je,Me=at),Ge<qe&&(qe=Ge,Me=Ce)}return Me}function V(){return b}function Q(Le){if(Le==null||Le&&/^(VIDEO|AUDIO)$/i.test(Le.nodeName))b=Le,b&&(b.preload="auto");else throw m}function $(Le){b&&(Le?b.src=Le:(b.removeAttribute("src"),b.load()))}function K(){return b?b.src:null}function Y(){return R}function re(){return T}function ie(Le){R=Le,R.style.position="absolute",R.style.display="flex",R.style.overflow="hidden",R.style.pointerEvents="none",R.style.top=0,R.style.left=0}function ee(Le){T=Le}function ne(Le,Se){oe(Le,Se)}function ae(){return C.length>0}function ce(Le){Le===null||!b||b.seeking||C.indexOf(Le)!==-1||C.push(Le)}function X(Le){var Se=C.indexOf(Le);Le!==null&&Se!==-1&&C.splice(Se,1)}function oe(Le,Se){Se?ce(Le):X(Le)}function ge(){if(b&&ae()&&b.playbackRate===0){var Le=document.createEvent("Event");Le.initEvent("waiting",!0,!1),b.dispatchEvent(Le)}}function _e(){if(!b)return null;var Le="webkitDroppedFrameCount"in b&&"webkitDecodedFrameCount"in b,Se="getVideoPlaybackQuality"in b,Me=null;return Se?Me=b.getVideoPlaybackQuality():Le&&(Me={droppedVideoFrames:b.webkitDroppedFrameCount,totalVideoFrames:b.webkitDroppedFrameCount+b.webkitDecodedFrameCount,creationTime:new Date}),Me}function he(){if(b){b.autoplay=!0;var Le=b.play();Le&&Le.catch&&typeof Promise<"u"&&Le.catch(function(Se){Se.name==="NotAllowedError"&&p.trigger(f.default.PLAYBACK_NOT_ALLOWED),P.warn("Caught pending play exception - continuing (".concat(Se,")"))})}}function se(){return b?b.paused:null}function Z(){b&&(b.pause(),b.autoplay=!1)}function q(){return b?b.seeking||!isNaN(L):null}function le(){return b?isNaN(L)?b.currentTime:L:null}function te(){return b?b.playbackRate:null}function N(){return b?b.played:null}function D(){return b?b.ended:null}function w(Le,Se){b&&b.addEventListener(Le,Se)}function W(Le,Se){b&&b.removeEventListener(Le,Se)}function H(){return b?b.readyState:NaN}function U(){return b?b.buffered:null}function B(){return b?b.clientWidth:NaN}function G(){return b?b.clientHeight:NaN}function z(){return b?b.videoWidth:NaN}function fe(){return b?b.videoHeight:NaN}function ue(){var Le=b.parentNode.host||b.parentNode;return Le?b.getBoundingClientRect().top-Le.getBoundingClientRect().top:NaN}function J(){var Le=b.parentNode.host||b.parentNode;return Le?b.getBoundingClientRect().left-Le.getBoundingClientRect().left:NaN}function ve(){return b?b.textTracks:[]}function me(Le,Se,Me,qe,it){if(b){for(var at=0;at<b.textTracks.length;at++)if(b.textTracks[at].kind===Le&&(!Se||b.textTracks[at].label==Se)&&b.textTracks[at].language===Me&&b.textTracks[at].isTTML===qe&&b.textTracks[at].isEmbedded===it)return b.textTracks[at]}return null}function Ae(Le,Se,Me,qe,it){if(!b)return null;var at=me(Le,Se,Me,qe,it);return at||(at=b.addTextTrack(Le,Se,Me),at.isEmbedded=it,at.isTTML=qe),at}function be(Le){b&&(b.appendChild(Le),Le.isTTML!==void 0&&(b.textTracks[b.textTracks.length-1].isTTML=Le.isTTML,b.textTracks[b.textTracks.length-1].isEmbedded=Le.isEmbedded))}function Be(Le){b&&b.removeChild(Le)}function ke(Le,Se){if(Le===_.default.VIDEO_ELEMENT_READY_STATES.HAVE_NOTHING||H()>=Le)Se();else{var Me=E.get(Le);Ye(Me,Se)}}function Ye(Le,Se){var Me=function qe(){W(Le,qe),Se(Le)};w(Le,Me)}return O={initialize:A,setCurrentTime:k,play:he,isPaused:se,pause:Z,isStalled:ae,isSeeking:q,getTime:le,getPlaybackRate:te,setPlaybackRate:F,getPlayedRanges:N,getEnded:D,setStallState:ne,getElement:V,setElement:Q,setSource:$,getSource:K,getTTMLRenderingDiv:Y,setTTMLRenderingDiv:ie,getVttRenderingDiv:re,setVttRenderingDiv:ee,getPlaybackQuality:_e,addEventListener:w,removeEventListener:W,getReadyState:H,getBufferRange:U,getClientWidth:B,getClientHeight:G,getTextTracks:ve,getTextTrack:me,addTextTrack:Ae,appendChild:be,removeChild:Be,getVideoWidth:z,getVideoHeight:fe,getVideoRelativeOffsetTop:ue,getVideoRelativeOffsetLeft:J,waitForReadyState:ke,reset:S},I(),O}c.__dashjs_factory_name="VideoModel";const y=u.default.getSingletonFactory(c)},"./src/streaming/net/FetchLoader.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>T});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Settings.js"),f=r("./src/streaming/constants/Constants.js"),d=r("./src/streaming/utils/RequestModifier.js");function _(m,M){return y(m)||c(m,M)||P(m,M)||E()}function E(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function c(m,M){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(m)))){var p=[],C=!0,I=!1,A=void 0;try{for(var S=m[Symbol.iterator](),x;!(C=(x=S.next()).done)&&(p.push(x.value),!(M&&p.length===M));C=!0);}catch(F){I=!0,A=F}finally{try{!C&&S.return!=null&&S.return()}finally{if(I)throw A}}return p}}function y(m){if(Array.isArray(m))return m}function O(m,M){var p;if(typeof Symbol>"u"||m[Symbol.iterator]==null){if(Array.isArray(m)||(p=P(m))||M&&m&&typeof m.length=="number"){p&&(m=p);var C=0,I=function(){};return{s:I,n:function(){return C>=m.length?{done:!0}:{done:!1,value:m[C++]}},e:function(k){throw k},f:I}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var A=!0,S=!1,x;return{s:function(){p=m[Symbol.iterator]()},n:function(){var k=p.next();return A=k.done,k},e:function(k){S=!0,x=k},f:function(){try{!A&&p.return!=null&&p.return()}finally{if(S)throw x}}}}function P(m,M){if(m){if(typeof m=="string")return b(m,M);var p=Object.prototype.toString.call(m).slice(8,-1);if(p==="Object"&&m.constructor&&(p=m.constructor.name),p==="Map"||p==="Set")return Array.from(m);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return b(m,M)}}function b(m,M){(M==null||M>m.length)&&(M=m.length);for(var p=0,C=new Array(M);p<M;p++)C[p]=m[p];return C}function L(m){m=m||{};var M=this.context,p=m.requestModifier,C=m.lowLatencyThroughputModel,I=m.boxParser,A=(0,l.default)(M).getInstance(),S,x;function F(re){x=re.dashMetrics}function k(re){p&&p.modifyRequest?(0,d.modifyRequest)(re,p).then(function(){return j(re)}):j(re)}function j(re){var ie=new Date,ee=re.request,ne=new Headers;if(ee.range&&ne.append("Range","bytes="+ee.range),re.headers)for(var ae in re.headers){var ce=re.headers[ae];ce&&ne.append(ae,ce)}ee.requestStartDate||(ee.requestStartDate=ie),p&&p.modifyRequestHeader&&p.modifyRequestHeader({setRequestHeader:function(Z,q){ne.append(Z,q)}},{url:re.url});var X;typeof window.AbortController=="function"&&(X=new AbortController,re.abortController=X,X.signal.onabort=re.onabort);var oe={method:re.method,headers:ne,credentials:re.withCredentials?"include":void 0,signal:X?X.signal:void 0},ge=A.get().streaming.abr.fetchThroughputCalculationMode,_e=Date.now(),he=0;new Promise(function(se){if(ge===f.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&C&&(he=C.getThroughputCapacityDelayMS(ee,x.getCurrentBufferLevel(ee.mediaType)*1e3),he))return setTimeout(se,he);se()}).then(function(){var se=Date.now();fetch(re.url,oe).then(function(Z){re.response||(re.response={}),re.response.status=Z.status,re.response.statusText=Z.statusText,re.response.responseURL=Z.url,Z.ok||re.onerror();var q="",le=O(Z.headers.keys()),te;try{for(le.s();!(te=le.n()).done;){var N=te.value;q+=N+": "+Z.headers.get(N)+`\r
`}}catch(Ye){le.e(Ye)}finally{le.f()}if(re.response.responseHeaders=q,!Z.body)return Z.arrayBuffer().then(function(Ye){re.response.response=Ye;var Le={loaded:Ye.byteLength,total:Ye.byteLength,stream:!1};re.progress(Le),re.onload(),re.onend()});var D=parseInt(Z.headers.get("Content-Length"),10),w=0,W=!1,H=new Uint8Array,U=0;if(ge===f.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&C){var B=function(Le){var Se=Le.getReader(),Me=[];Se.read().then(function qe(it){var at=it.value,Ce=it.done;if(z=Date.now(),at&&at.length){var je=z-G,Ge=at.length;Me.push({chunkDownloadTimeRelativeMS:z-se,chunkDownloadDurationMS:je,chunkBytes:Ge,kbps:Math.round(8*Ge/(je/1e3)),bufferLevel:x.getCurrentBufferLevel(ee.mediaType)})}if(Ce){var tt=z-se,ot=Me.reduce(function(dt,gt){return dt+gt.chunkBytes},0);C.addMeasurement(ee,tt,Me,_e,he,q),re.progress({loaded:ot,total:ot,lengthComputable:!0,time:C.getEstimatedDownloadDurationMS(ee),stream:!0});return}return G=Date.now(),Se.read().then(qe)})},G=se,z=0,fe=Z.body.tee(),ue=_(fe,2),J=ue[0],ve=ue[1];B(J),re.reader=ve.getReader()}else re.reader=Z.body.getReader();var me=[],Ae=[],be=[],Be=!0,ke=function Ye(Le){var Se=Le.value,Me=Le.done;if(Me){if(H){if(ge!==f.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST){var qe=null,it=null;ge===f.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING?(qe=Y(Ae,be),qe&&(it=w*8/qe)):ge===f.default.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA&&(it=K(me,w)),re.progress({loaded:w,total:isNaN(D)?w:D,lengthComputable:!0,time:it,stream:!0})}re.response.response=H.buffer}re.onload(),re.onend();return}if(Se&&Se.length>0){if(H=Q(H,Se),w+=Se.length,me.push({ts:Date.now(),bytes:Se.length}),ge===f.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&Be){var at=I.findLastTopIsoBoxCompleted(["moof"],H,U);at.found&&(Be=!1,Ae.push({ts:performance.now(),bytes:Se.length}))}var Ce=I.findLastTopIsoBoxCompleted(["moov","mdat"],H,U);if(Ce.found){var je=Ce.lastCompletedOffset+Ce.size;ge===f.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&!Be&&(Be=!0,be.push({ts:performance.now(),bytes:H.length}));var Ge;je===H.length?(Ge=H,H=new Uint8Array):(Ge=new Uint8Array(H.subarray(0,je)),H=H.subarray(je)),re.progress({data:Ge.buffer,lengthComputable:!1,noTrace:!0}),U=0}else U=Ce.lastCompletedOffset,W||(re.progress({lengthComputable:!1,noTrace:!0}),W=!0)}V(re,Ye)};V(re,ke)}).catch(function(Z){re.onerror&&re.onerror(Z)})})}function V(re,ie){re.reader.read().then(ie).catch(function(ee){re.onerror&&re.response.status===200&&re.onerror(ee)})}function Q(re,ie){if(re.length===0)return ie;var ee=new Uint8Array(re.length+ie.length);return ee.set(re),ee.set(ie,re.length),ee}function $(re){if(re.abortController)re.abortController.abort();else if(re.reader)try{re.reader.cancel(),re.onabort()}catch{}}function K(re,ie){try{if(re=re.filter(function(ae){return ae.bytes>ie/4/re.length}),re.length>1){var ee=0,ne=(re[re.length-1].ts-re[0].ts)/re.length;return re.forEach(function(ae,ce){var X=re[ce+1];if(X){var oe=X.ts-ae.ts;ee+=oe<ne?oe:0}}),ee}return null}catch{return null}}function Y(re,ie){try{var ee,ne;ee=re.filter(function(se,Z){return Z<re.length-1}),ne=ie.filter(function(se,Z){return Z<ie.length-1});var ae=[];if(ee.length>1){for(var ce=0,X=0,oe=0;oe<ee.length;oe++)if(ee[oe]&&ne[oe]){var ge=ne[oe].ts-ee[oe].ts;if(ge>1)ae.push(8*ne[oe].bytes/ge);else{X===0&&(X=ee[oe].ts);var _e=ne[oe].ts-X;_e>1?(ae.push(8*ce/_e),ce=0,X=0):ce+=ne[oe].bytes}}if(ae.length>0){var he=ae.reduce(function(se,Z){return se+Z},0);return he/ae.length}}return null}catch{return null}}return S={load:k,abort:$,calculateDownloadedTime:K,setup:F},S}L.__dashjs_factory_name="FetchLoader";var R=u.default.getClassFactory(L);const T=R},"./src/streaming/net/HTTPLoader.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>I});var u=r("./src/streaming/net/XHRLoader.js"),l=r("./src/streaming/net/FetchLoader.js"),f=r("./src/streaming/vo/metrics/HTTPRequest.js"),d=r("./src/core/FactoryMaker.js"),_=r("./src/streaming/vo/DashJSError.js"),E=r("./src/streaming/models/CmcdModel.js"),c=r("./src/streaming/models/CmsdModel.js"),y=r("./src/core/Utils.js"),O=r("./src/core/Debug.js"),P=r("./src/core/EventBus.js"),b=r("./src/core/events/Events.js"),L=r("./src/core/Settings.js"),R=r("./src/streaming/constants/Constants.js"),T=r("./src/streaming/models/LowLatencyThroughputModel.js"),m=r("./src/streaming/models/CustomParametersModel.js");function M(A,S,x){return S in A?Object.defineProperty(A,S,{value:x,enumerable:!0,configurable:!0,writable:!0}):A[S]=x,A}function p(A){A=A||{};var S=this.context,x=A.errHandler,F=A.dashMetrics,k=A.mediaPlayerModel,j=A.requestModifier,V=A.boxParser,Q=A.errors,$=A.requestTimeout||0,K=(0,P.default)(S).getInstance(),Y=(0,L.default)(S).getInstance(),re,ie,ee,ne,ae,ce,X,oe,ge,_e;function he(){var te;_e=(0,O.default)(S).getInstance().getLogger(re),ie=[],ee=[],ne=[],ce=(0,E.default)(S).getInstance(),X=(0,c.default)(S).getInstance(),ge=(0,T.default)(S).getInstance(),oe=(0,m.default)(S).getInstance(),ae=(te={},M(te,f.HTTPRequest.MPD_TYPE,Q.DOWNLOAD_ERROR_ID_MANIFEST_CODE),M(te,f.HTTPRequest.XLINK_EXPANSION_TYPE,Q.DOWNLOAD_ERROR_ID_XLINK_CODE),M(te,f.HTTPRequest.INIT_SEGMENT_TYPE,Q.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),M(te,f.HTTPRequest.MEDIA_SEGMENT_TYPE,Q.DOWNLOAD_ERROR_ID_CONTENT_CODE),M(te,f.HTTPRequest.INDEX_SEGMENT_TYPE,Q.DOWNLOAD_ERROR_ID_CONTENT_CODE),M(te,f.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,Q.DOWNLOAD_ERROR_ID_CONTENT_CODE),M(te,f.HTTPRequest.OTHER_TYPE,Q.DOWNLOAD_ERROR_ID_CONTENT_CODE),te)}function se(te,N){var D=te.request,w=[],W=!0,H=!0,U=new Date,B=U,G=0,z=null,fe;if(!j||!F||!x)throw new Error("config object is not correct or missing");var ue=function(je){if(H=!1,D.requestStartDate=U,D.requestEndDate=new Date,D.firstByteDate=D.firstByteDate||U,D.fileLoaderType=z,!D.checkExistenceOnly){var Ge=fe.response?fe.response.responseURL:null,tt=fe.response?fe.response.status:null,ot=fe.response&&fe.response.getAllResponseHeaders?fe.response.getAllResponseHeaders():fe.response?fe.response.responseHeaders:null,dt=Y.get().streaming.cmsd&&Y.get().streaming.cmsd.enabled?X.parseResponseHeaders(ot,D.mediaType):null;F.addHttpRequest(D,Ge,tt,ot,je?w:null,dt),D.type===f.HTTPRequest.MPD_TYPE&&F.addManifestUpdate(D)}},J=function(){if(ie.indexOf(fe)!==-1&&(ie.splice(ie.indexOf(fe),1),H))if(ue(!1),N>0){try{if(Y.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&D.type===f.HTTPRequest.MEDIA_SEGMENT_TYPE){var je=k.getRetryAttemptsForType(f.HTTPRequest.MEDIA_SEGMENT_TYPE);je===N&&K.trigger(b.default.ATTEMPT_BACKGROUND_SYNC)}}catch{}N--;var Ge={config:te};ne.push(Ge),Ge.timeout=setTimeout(function(){ne.indexOf(Ge)!==-1&&(ne.splice(ne.indexOf(Ge),1),se(te,N))},k.getRetryIntervalsForType(D.type))}else{if(D.type===f.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;x.error(new _.default(ae[D.type],D.url+" is not available",{request:D,response:fe.response})),te.error&&te.error(D,"error",fe.response.statusText),te.complete&&te.complete(D,fe.response.statusText)}},ve=function(je){var Ge=new Date;W&&(W=!1,(!je.lengthComputable||je.lengthComputable&&je.total!==je.loaded)&&(D.firstByteDate=Ge)),je.lengthComputable&&(D.bytesLoaded=je.loaded,D.bytesTotal=je.total),je.noTrace||(w.push({s:B,d:je.time?je.time:Ge.getTime()-B.getTime(),b:[je.loaded?je.loaded-G:0]}),B=Ge,G=je.loaded),te.progress&&je&&te.progress(je)},me=function(){fe.response.status>=200&&fe.response.status<=299&&(ue(!0),te.success&&te.success(fe.response.response,fe.response.statusText,fe.response.responseURL),te.complete&&te.complete(D,fe.response.statusText))},Ae=function(){te.abort&&te.abort(D)},be=function(je){var Ge;if(je.lengthComputable){var tt=je.loaded/je.total*100;Ge="Request timeout: loaded: "+je.loaded+", out of: "+je.total+" : "+tt.toFixed(3)+"% Completed"}else Ge="Request timeout: non-computable download size";_e.warn(Ge)},Be;D.hasOwnProperty("availabilityTimeComplete")&&D.availabilityTimeComplete===!1&&window.fetch&&D.responseType==="arraybuffer"&&D.type===f.HTTPRequest.MEDIA_SEGMENT_TYPE?(Be=(0,l.default)(S).create({requestModifier:j,lowLatencyThroughputModel:ge,boxParser:V}),Be.setup({dashMetrics:F}),z=R.default.FILE_LOADER_TYPES.FETCH):(Be=(0,u.default)(S).create({requestModifier:j}),z=R.default.FILE_LOADER_TYPES.XHR);var ke=null,Ye=j.modifyRequestURL?j.modifyRequestURL(D.url):D.url;if(Y.get().streaming.cmcd&&Y.get().streaming.cmcd.enabled){var Le=Y.get().streaming.cmcd.mode;if(Le===R.default.CMCD_MODE_QUERY){var Se=Z(D);Ye=y.default.addAditionalQueryParameterToUrl(Ye,Se)}else Le===R.default.CMCD_MODE_HEADER&&(ke=ce.getHeaderParameters(D))}D.url=Ye;var Me=D.checkExistenceOnly?f.HTTPRequest.HEAD:f.HTTPRequest.GET,qe=oe.getXHRWithCredentialsForType(D.type);fe={url:Ye,method:Me,withCredentials:qe,request:D,onload:me,onend:J,onerror:J,progress:ve,onabort:Ae,ontimeout:be,loader:Be,timeout:$,headers:ke};var it=new Date().getTime();if(isNaN(D.delayLoadingTime)||it>=D.delayLoadingTime)ie.push(fe),Be.load(fe);else{var at={httpRequest:fe};ee.push(at),at.delayTimeout=setTimeout(function(){if(ee.indexOf(at)!==-1){ee.splice(ee.indexOf(at),1);try{U=new Date,B=U,ie.push(at.httpRequest),Be.load(at.httpRequest)}catch{at.httpRequest.onerror()}}},D.delayLoadingTime-it)}}function Z(te){try{var N=[],D=ce.getQueryParameter(te);return D&&N.push(D),N}catch{return[]}}function q(te){te.request?se(te,k.getRetryAttemptsForType(te.request.type)):te.error&&te.error(te.request,"error")}function le(){ne.forEach(function(te){clearTimeout(te.timeout),te.config.request&&te.config.abort&&te.config.abort(te.config.request)}),ne=[],ee.forEach(function(te){return clearTimeout(te.delayTimeout)}),ee=[],ie.forEach(function(te){te.request.type!==f.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE&&(te.onloadend=te.onerror=te.onprogress=void 0,te.loader.abort(te))}),ie=[]}return re={load:q,abort:le},he(),re}p.__dashjs_factory_name="HTTPLoader";var C=d.default.getClassFactory(p);const I=C},"./src/streaming/net/SchemeLoaderFactory.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/net/HTTPLoader.js");function f(){var E,c;function y(T,m){c[T]=m}function O(T){c[T]&&delete c[T]}function P(){c={}}function b(T){for(var m in c)if(c.hasOwnProperty(m)&&T.startsWith(m))return c[m];return l.default}function L(){P()}function R(){L()}return R(),E={getLoader:b,registerLoader:y,unregisterLoader:O,unregisterAllLoader:P,reset:L},E}f.__dashjs_factory_name="SchemeLoaderFactory";var d=u.default.getSingletonFactory(f);const _=d},"./src/streaming/net/URLLoader.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/net/SchemeLoaderFactory.js");function f(E){E=E||{};var c=this.context,y,O,P;O=(0,l.default)(c).getInstance();function b(R){if(!P){var T=O.getLoader(R&&R.request?R.request.url:null);P=T(c).create({errHandler:E.errHandler,mediaPlayerModel:E.mediaPlayerModel,requestModifier:E.requestModifier,dashMetrics:E.dashMetrics,boxParser:E.boxParser?E.boxParser:null,constants:E.constants?E.constants:null,dashConstants:E.dashConstants?E.dashConstants:null,urlUtils:E.urlUtils?E.urlUtils:null,requestTimeout:isNaN(E.requestTimeout)?0:E.requestTimeout,errors:E.errors})}P.load(R)}function L(){P&&P.abort()}return y={load:b,abort:L},y}f.__dashjs_factory_name="URLLoader";var d=u.default.getClassFactory(f);const _=d},"./src/streaming/net/XHRLoader.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/utils/RequestModifier.js");function f(E){E=E||{};var c=E.requestModifier,y;function O(L){c&&c.modifyRequest?(0,l.modifyRequest)(L,c).then(function(){return P(L)}):P(L)}function P(L){var R=new Date,T=L.request,m=new XMLHttpRequest;if(m.open(L.method,L.url,!0),T.responseType&&(m.responseType=T.responseType),T.range&&m.setRequestHeader("Range","bytes="+T.range),T.requestStartDate||(T.requestStartDate=R),c&&c.modifyRequestHeader&&(m=c.modifyRequestHeader(m,{url:L.url})),L.headers)for(var M in L.headers){var p=L.headers[M];p&&m.setRequestHeader(M,p)}m.withCredentials=L.withCredentials,m.onload=L.onload,m.onloadend=L.onend,m.onerror=L.onerror,m.onprogress=L.progress,m.onabort=L.onabort,m.ontimeout=L.ontimeout,m.timeout=L.timeout,m.send(),L.response=m}function b(L){var R=L.response;R.onloadend=R.onerror=R.onprogress=void 0,R.abort()}return y={load:O,abort:b},y}f.__dashjs_factory_name="XHRLoader";var d=u.default.getClassFactory(f);const _=d},"./src/streaming/protection/CommonEncryption.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});function u(c,y){if(!(c instanceof y))throw new TypeError("Cannot call a class as a function")}function l(c,y){for(var O=0;O<y.length;O++){var P=y[O];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(c,P.key,P)}}function f(c,y,O){return y&&l(c.prototype,y),O&&l(c,O),c}var d={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]},_=function(){function c(){u(this,c)}return f(c,null,[{key:"findCencContentProtection",value:function(O){for(var P=null,b=0;b<O.length;++b){var L=O[b];L.schemeIdUri.toLowerCase()==="urn:mpeg:dash:mp4protection:2011"&&(L.value.toLowerCase()==="cenc"||L.value.toLowerCase()==="cbcs")&&(P=L)}return P}},{key:"getPSSHData",value:function(O){var P=8,b=new DataView(O),L=b.getUint8(P);return P+=20,L>0&&(P+=4+16*b.getUint32(P)),P+=4,O.slice(P)}},{key:"getPSSHForKeySystem",value:function(O,P){var b=c.parsePSSHList(P);return O&&b.hasOwnProperty(O.uuid.toLowerCase())?b[O.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(O,P){return"pssh"in O?(O.pssh.__text=O.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),P.decodeArray(O.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(O){if(O==null)return[];for(var P=new DataView(O.buffer||O),b=!1,L={},R=0;!b;){var T=void 0,m=void 0,M=void 0,p=void 0,C=R;if(R>=P.buffer.byteLength)break;if(T=P.getUint32(R),m=R+T,R+=4,P.getUint32(R)!==1886614376){R=m;continue}if(R+=4,M=P.getUint8(R),M!==0&&M!==1){R=m;continue}R++,R+=3,p="";var I=void 0,A=void 0;for(I=0;I<4;I++)A=P.getUint8(R+I).toString(16),p+=A.length===1?"0"+A:A;for(R+=4,p+="-",I=0;I<2;I++)A=P.getUint8(R+I).toString(16),p+=A.length===1?"0"+A:A;for(R+=2,p+="-",I=0;I<2;I++)A=P.getUint8(R+I).toString(16),p+=A.length===1?"0"+A:A;for(R+=2,p+="-",I=0;I<2;I++)A=P.getUint8(R+I).toString(16),p+=A.length===1?"0"+A:A;for(R+=2,p+="-",I=0;I<6;I++)A=P.getUint8(R+I).toString(16),p+=A.length===1?"0"+A:A;R+=6,p=p.toLowerCase(),R+=4,L[p]=P.buffer.slice(C,m),R=m}return L}},{key:"getLicenseServerUrlFromMediaInfo",value:function(O,P){try{if(!O||O.length===0)return null;for(var b=0,L=null;b<O.length&&!L;){var R=O[b];if(R&&R.contentProtection&&R.contentProtection.length>0){var T=R.contentProtection.filter(function(S){return S.schemeIdUri&&S.schemeIdUri===P});if(T&&T.length>0)for(var m=0;m<T.length&&!L;){for(var M=T[m],p=0;p<d.attributes.length&&!L;){for(var C=0,I=d.attributes[p];C<d.prefixes.length&&!L;){var A=d.prefixes[C];M[I]&&M[I].__prefix&&M[I].__prefix===A&&M[I].__text&&(L=M[I].__text),C+=1}p+=1}m+=1}}b+=1}return L}catch{return null}}}]),c}();const E=_},"./src/streaming/protection/Protection.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>L});var u=r("./src/streaming/protection/controllers/ProtectionController.js"),l=r("./src/streaming/protection/controllers/ProtectionKeyController.js"),f=r("./src/streaming/protection/ProtectionEvents.js"),d=r("./src/streaming/protection/errors/ProtectionErrors.js"),_=r("./src/streaming/protection/models/ProtectionModel_21Jan2015.js"),E=r("./src/streaming/protection/models/ProtectionModel_3Feb2014.js"),c=r("./src/streaming/protection/models/ProtectionModel_01b.js"),y=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],O=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function P(){var R,T=this.context;function m(C){var I=null,A=(0,l.default)(T).getInstance();A.setConfig({debug:C.debug,BASE64:C.BASE64,settings:C.settings}),A.initialize();var S=M(C);return!I&&S&&(I=(0,u.default)(T).create({protectionModel:S,protectionKeyController:A,eventBus:C.eventBus,debug:C.debug,events:C.events,BASE64:C.BASE64,constants:C.constants,cmcdModel:C.cmcdModel,customParametersModel:C.customParametersModel,settings:C.settings}),C.capabilities.setEncryptedMediaSupported(!0)),I}function M(C){var I=C.debug,A=I.getLogger(R),S=C.eventBus,x=C.errHandler,F=C.videoModel?C.videoModel.getElement():null;return(!F||F.onencrypted!==void 0)&&(!F||F.mediaKeys!==void 0)?(A.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),(0,_.default)(T).create({debug:I,eventBus:S,events:C.events})):p(F,O)?(A.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),(0,E.default)(T).create({debug:I,eventBus:S,events:C.events,api:p(F,O)})):p(F,y)?(A.info("EME detected on this user agent! (ProtectionModel_01b)"),(0,c.default)(T).create({debug:I,eventBus:S,errHandler:x,events:C.events,api:p(F,y)})):(A.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null)}function p(C,I){for(var A=0;A<I.length;A++){var S=I[A];if(typeof C[S[Object.keys(S)[0]]]=="function")return S}return null}return R={createProtectionSystem:m},R}P.__dashjs_factory_name="Protection";var b=dashjs.FactoryMaker.getClassFactory(P);b.events=f.default,b.errors=d.default,dashjs.FactoryMaker.updateClassFactory(P.__dashjs_factory_name,b);const L=b},"./src/streaming/protection/ProtectionEvents.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/core/events/EventsBase.js");function l(T){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(M){return typeof M}:l=function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},l(T)}function f(T,m){if(!(T instanceof m))throw new TypeError("Cannot call a class as a function")}function d(T,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(m&&m.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),m&&_(T,m)}function _(T,m){return _=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},_(T,m)}function E(T){var m=O();return function(){var p=P(T),C;if(m){var I=P(this).constructor;C=Reflect.construct(p,arguments,I)}else C=p.apply(this,arguments);return c(this,C)}}function c(T,m){return m&&(l(m)==="object"||typeof m=="function")?m:y(T)}function y(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(T){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},P(T)}var b=function(T){d(M,T);var m=E(M);function M(){var p;return f(this,M),p=m.call(this),p.INTERNAL_KEY_MESSAGE="internalKeyMessage",p.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",p.KEY_ADDED="public_keyAdded",p.KEY_ERROR="public_keyError",p.KEY_MESSAGE="public_keyMessage",p.KEY_SESSION_CLOSED="public_keySessionClosed",p.KEY_SESSION_CREATED="public_keySessionCreated",p.KEY_SESSION_REMOVED="public_keySessionRemoved",p.KEY_STATUSES_CHANGED="public_keyStatusesChanged",p.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",p.KEY_SYSTEM_SELECTED="public_keySystemSelected",p.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",p.LICENSE_REQUEST_SENDING="public_licenseRequestSending",p.NEED_KEY="needkey",p.PROTECTION_CREATED="public_protectioncreated",p.PROTECTION_DESTROYED="public_protectiondestroyed",p.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",p.TEARDOWN_COMPLETE="protectionTeardownComplete",p.VIDEO_ELEMENT_SELECTED="videoElementSelected",p.KEY_SESSION_UPDATED="public_keySessionUpdated",p}return M}(u.default),L=new b;const R=L},"./src/streaming/protection/controllers/ProtectionController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>I});var u=r("./src/streaming/protection/CommonEncryption.js"),l=r("./src/streaming/protection/vo/MediaCapability.js"),f=r("./src/streaming/protection/vo/KeySystemConfiguration.js"),d=r("./src/streaming/protection/errors/ProtectionErrors.js"),_=r("./src/streaming/vo/DashJSError.js"),E=r("./src/streaming/protection/vo/LicenseRequest.js"),c=r("./src/streaming/protection/vo/LicenseResponse.js"),y=r("./src/streaming/vo/metrics/HTTPRequest.js"),O=r("./src/core/Utils.js"),P=r("./src/streaming/constants/Constants.js"),b=r("./src/core/FactoryMaker.js");function L(A){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?L=function(x){return typeof x}:L=function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},L(A)}var R=5,T=500,m=3,M=1e3,p=8e3;function C(A){A=A||{};var S=A.protectionKeyController,x=A.protectionModel,F=A.eventBus,k=A.events,j=A.debug,V=A.BASE64,Q=A.constants,$=[],K=A.cmcdModel,Y=A.settings,re=A.customParametersModel,ie,ee,ne,ae,ce,X,oe,ge,_e,he,se;function Z(){ee=j.getLogger(ie),ne=[],ae=[],X="temporary",oe="",he=null,se=null,F.on(k.INTERNAL_KEY_MESSAGE,it,ie),F.on(k.INTERNAL_KEY_STATUS_CHANGED,qe,ie)}function q(){if(!F||!F.hasOwnProperty("on")||!S||!S.hasOwnProperty("getSupportedKeySystemsFromContentProtection"))throw new Error("Missing config parameter(s)")}function le(de){if(!de)throw new Error("mediaInfo can not be null or undefined");q(),ae.push(de)}function te(){if(!(!ae||ae.length===0)){var de=[];ae.forEach(function(Re){var xe=S.getSupportedKeySystemsFromContentProtection(Re.contentProtection,ce,X);xe.length>0&&(de.length===0&&(de=xe),ne.push(xe))}),de&&de.length>0&&D(de,!0)}}function N(de){ne.push(de),D(de,!1)}function D(de,Re){!ge&&!_e?w(de,Re):ge&&W()}function w(de,Re){if(!_e){_e=!0;var xe=[];de=de.sort(function(et,ht){var yt=ce&&ce[et.ks.systemString]&&ce[et.ks.systemString].priority>=0?ce[et.ks.systemString].priority:de.length,Pt=ce&&ce[ht.ks.systemString]&&ce[ht.ks.systemString].priority>=0?ce[ht.ks.systemString].priority:de.length;return yt-Pt});for(var Ne=0;Ne<de.length;Ne++){var Xe=Me(de[Ne]);xe.push({ks:de[Ne].ks,configs:[Xe],protData:de[Ne].protData})}var nt;x.requestKeySystemAccess(xe).then(function(et){nt=et.data;var ht=nt.mksa&&nt.mksa.selectedSystemString?nt.mksa.selectedSystemString:nt.keySystem.systemString;return ee.info("DRM: KeySystem Access Granted for system string ("+ht+")!  Selecting key system..."),x.selectKeySystem(nt)}).then(function(et){if(ge=et,_e=!1,!!x){F.trigger(k.KEY_SYSTEM_SELECTED,{data:nt});var ht=G(ge);ht&&ht.serverCertificate&&ht.serverCertificate.length>0&&x.setServerCertificate(V.decodeArray(ht.serverCertificate).buffer),W()}}).catch(function(et){ge=null,_e=!1,Re||F.trigger(k.KEY_SYSTEM_SELECTED,{data:null,error:new _.default(d.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,d.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+et.error)})})}}function W(){for(var de,Re=0;Re<ne.length;Re++)for(de=0;de<ne[Re].length;de++)if(ge===ne[Re][de].ks){var xe=ne[Re][de];H(xe);break}ne=[]}function H(de){if(S.isClearKey(ge)&&de.protData&&de.protData.hasOwnProperty("clearkeys")&&Object.keys(de.protData.clearkeys).length!==0){var Re={kids:Object.keys(de.protData.clearkeys)};de.initData=new TextEncoder().encode(JSON.stringify(Re))}de.sessionId?U(de):de.initData!==null&&B(de)}function U(de){q(),x.loadKeySession(de)}function B(de){var Re=u.default.getPSSHForKeySystem(ge,de?de.initData:null);if(Re){if(ue(de.keyId)||J(Re))return;try{de.initData=Re,x.createKeySession(de)}catch(xe){F.trigger(k.KEY_SESSION_CREATED,{data:null,error:new _.default(d.default.KEY_SESSION_CREATED_ERROR_CODE,d.default.KEY_SESSION_CREATED_ERROR_MESSAGE+xe.message)})}}else de&&de.initData?x.createKeySession(de):F.trigger(k.KEY_SESSION_CREATED,{data:null,error:new _.default(d.default.KEY_SESSION_CREATED_ERROR_CODE,d.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(ge?ge.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function G(de){if(de){var Re=de.systemString;if(ce)return Re in ce?ce[Re]:null}return null}function z(){ae=[]}function fe(de){return q(),S.getSupportedKeySystemsFromContentProtection(de,ce,X)}function ue(de){if(!de)return!1;try{for(var Re=x.getSessions(),xe=0;xe<Re.length;xe++)if(Re[xe].getKeyId()===de)return!0;return!1}catch{return!1}}function J(de){if(!de)return!1;try{for(var Re=x.getAllInitData(),xe=0;xe<Re.length;xe++)if(S.initDataEquals(de,Re[xe]))return ee.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch{return!1}}function ve(de){q(),x.removeKeySession(de)}function me(de){q(),x.closeKeySession(de)}function Ae(de){q(),x.setServerCertificate(de)}function be(de){q(),de?(x.setMediaElement(de),F.on(k.NEED_KEY,Mt,ie)):de===null&&(x.setMediaElement(de),F.off(k.NEED_KEY,Mt,ie))}function Be(de){X=de}function ke(de){oe=de}function Ye(de){ce=de,S.setProtectionData(de)}function Le(){Ge(),x&&x.stop()}function Se(){F.off(k.INTERNAL_KEY_MESSAGE,it,ie),F.off(k.INTERNAL_KEY_STATUS_CHANGED,qe,ie),q(),Ge(),be(null),ge=null,_e=!1,x&&(x.reset(),x=null),$.forEach(function(de){return clearTimeout(de)}),$=[],ae=[],ne=[]}function Me(de){var Re=de.protData,xe=[],Ne=[],Xe=Re&&Re.audioRobustness&&Re.audioRobustness.length>0?Re.audioRobustness:oe,nt=Re&&Re.videoRobustness&&Re.videoRobustness.length>0?Re.videoRobustness:oe,et=de.sessionType,ht=Re&&Re.distinctiveIdentifier?Re.distinctiveIdentifier:"optional",yt=Re&&Re.persistentState?Re.persistentState:et==="temporary"?"optional":"required";return ae.forEach(function(Pt){Pt.type===Q.AUDIO?xe.push(new l.default(Pt.codec,Xe)):Pt.type===Q.VIDEO&&Ne.push(new l.default(Pt.codec,nt))}),new f.default(xe,Ne,ht,yt,[et])}function qe(de){de.error?F.trigger(k.KEY_STATUSES_CHANGED,{data:null,error:de.error}):ee.debug("DRM: key status = "+de.status)}function it(de){ee.debug("DRM: onKeyMessage");var Re=de.data;F.trigger(k.KEY_MESSAGE,{data:Re});var xe=Re.messageType?Re.messageType:"license-request",Ne=Re.message,Xe=Re.sessionToken,nt=G(ge),et=S.getLicenseServerModelInstance(ge,nt,xe),ht={sessionToken:Xe,messageType:xe};if(!Ne||Ne.byteLength===0){at(ht,new _.default(d.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,d.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE));return}if(!et){ee.debug("DRM: License server request not required for this message (type = "+de.data.messageType+").  Session ID = "+Xe.getSessionId()),at(ht);return}if(S.isClearKey(ge)){var yt=S.processClearKeyLicenseRequest(ge,nt,Ne);if(yt&&yt.keyPairs&&yt.keyPairs.length>0){ee.debug("DRM: ClearKey license request handled by application!"),at(ht),x.updateKeySession(Xe,yt);return}}Ce(Re,et,nt)}function at(de,Re){F.trigger(k.LICENSE_REQUEST_COMPLETE,{data:de,error:Re})}function Ce(de,Re,xe){var Ne=de.sessionToken,Xe=de.messageType?de.messageType:"license-request",nt={sessionToken:Ne,messageType:Xe},et=ge?ge.systemString:null,ht=tt(xe,Xe,Ne,de,Re);if(!ht){at(nt,new _.default(d.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,d.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE));return}var yt={},Pt=!1;xe&&ot(yt,xe.httpRequestHeaders);var De=de.message,Ue=ge.getRequestHeadersFromMessage(De);ot(yt,Ue),Object.keys(yt).forEach(function(we){we.toLowerCase()==="authorization"&&(Pt=!0)}),xe&&typeof xe.withCredentials=="boolean"&&(Pt=xe.withCredentials);var Ze=function(ze){if(x)if(ze.status>=200&&ze.status<=299){var _t=O.default.parseHttpHeaders(ze.getAllResponseHeaders?ze.getAllResponseHeaders():null),Nt=new c.default(ze.responseURL,_t,ze.response),It=re.getLicenseResponseFilters();gt(It,Nt).then(function(){var Dt=Re.getLicenseMessage(Nt.data,et,Xe);Dt!==null?(at(nt),x.updateKeySession(Ne,Dt)):dt(ze,nt,et,Xe,Re)})}else dt(ze,nt,et,Xe,Re)},Et=function(ze){at(nt,new _.default(d.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,d.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+et+' update, XHR aborted. status is "'+ze.statusText+'" ('+ze.status+"), readyState is "+ze.readyState))},ct=function(ze){at(nt,new _.default(d.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,d.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+et+' update, XHR error. status is "'+ze.statusText+'" ('+ze.status+"), readyState is "+ze.readyState))},Tt=ge.getLicenseRequestFromMessage(De),Ot=Re.getHTTPMethod(Xe),jt=Re.getResponseType(et,Xe),Gt=xe&&!isNaN(xe.httpTimeout)?xe.httpTimeout:p,pe=Ne.getSessionId()||null,Ve=new E.default(ht,Ot,jt,yt,Pt,Xe,pe,Tt),ft=isNaN(Y.get().streaming.retryAttempts[y.HTTPRequest.LICENSE])?m:Y.get().streaming.retryAttempts[y.HTTPRequest.LICENSE],Ie=re.getLicenseRequestFilters();gt(Ie,Ve).then(function(){je(Ve,ft,Gt,Ze,Et,ct)})}function je(de,Re,xe,Ne,Xe,nt){var et=new XMLHttpRequest;if(Y.get().streaming.cmcd&&Y.get().streaming.cmcd.enabled){var ht=Y.get().streaming.cmcd.mode;if(ht===P.default.CMCD_MODE_QUERY){var yt=K.getQueryParameter({url:de.url,type:y.HTTPRequest.LICENSE});yt&&(de.url=O.default.addAditionalQueryParameterToUrl(de.url,[yt]))}}et.open(de.method,de.url,!0),et.responseType=de.responseType,et.withCredentials=de.withCredentials,xe>0&&(et.timeout=xe);for(var Pt in de.headers)et.setRequestHeader(Pt,de.headers[Pt]);if(Y.get().streaming.cmcd&&Y.get().streaming.cmcd.enabled){var De=Y.get().streaming.cmcd.mode;if(De===P.default.CMCD_MODE_HEADER){var Ue=K.getHeaderParameters({url:de.url,type:y.HTTPRequest.LICENSE});if(Ue)for(var Ze in Ue){var Et=Ue[Ze];Et&&et.setRequestHeader(Ze,Et)}}}var ct=function(){Re--;var Ot=isNaN(Y.get().streaming.retryIntervals[y.HTTPRequest.LICENSE])?M:Y.get().streaming.retryIntervals[y.HTTPRequest.LICENSE];se=setTimeout(function(){je(de,Re,xe,Ne,Xe,nt)},Ot)};et.onload=function(){he=null,this.status>=200&&this.status<=299||Re<=0?Ne(this):(ee.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+Re),ct())},et.ontimeout=et.onerror=function(){he=null,Re<=0?nt(this):(ee.warn("License request network request failed . Retrying it... Pending retries: "+Re),ct())},et.onabort=function(){Xe(this)},F.trigger(k.LICENSE_REQUEST_SENDING,{url:de.url,headers:de.headers,payload:de.data,sessionId:de.sessionId}),he=et,et.send(de.data)}function Ge(){he&&(he.onloadend=he.onerror=he.onprogress=void 0,he.abort(),he=null),se&&(clearTimeout(se),se=null)}function tt(de,Re,xe,Ne,Xe){var nt=null,et=Ne.message;if(de&&de.serverURL){var ht=de.serverURL;typeof ht=="string"&&ht!==""?nt=ht:L(ht)==="object"&&ht.hasOwnProperty(Re)&&(nt=ht[Re])}else if(de&&de.laURL&&de.laURL!=="")nt=de.laURL;else if(nt=u.default.getLicenseServerUrlFromMediaInfo(ae,ge.schemeIdURI),!nt&&!S.isClearKey(ge)){var yt=u.default.getPSSHData(xe.initData);nt=ge.getLicenseServerURLFromInitData(yt),nt||(nt=Ne.laURL)}return nt=Xe.getServerURLFromMessage(nt,et,Re),nt}function ot(de,Re){if(Re)for(var xe in Re)de[xe]=Re[xe]}function dt(de,Re,xe,Ne,Xe){var nt="NONE",et=null;de.response&&(nt=Xe.getErrorResponse(de.response,xe,Ne),et={serverResponse:de.response||null,responseCode:de.status||null,responseText:de.statusText||null}),at(Re,new _.default(d.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,d.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+xe+' update, XHR complete. status is "'+de.statusText+'" ('+de.status+"), readyState is "+de.readyState+".  Response is "+nt,et))}function gt(de,Re){return de?de.reduce(function(xe,Ne){return xe.then(function(){return Ne(Re)})},Promise.resolve()):Promise.resolve()}function Mt(de,Re){if(!Y.get().streaming.protection.ignoreEmeEncryptedEvent){if(ee.debug("DRM: onNeedKey"),de.key.initDataType!=="cenc"){ee.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+de.key.initDataType);return}if(ae.length===0&&(ee.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),Re=typeof Re>"u"?1:Re+1,Re<R)){$.push(setTimeout(function(){Mt(de,Re)},T));return}var xe=de.key.initData;if(ArrayBuffer.isView(xe)&&(xe=xe.buffer),ge){var Ne=u.default.getPSSHForKeySystem(ge,xe);if(Ne&&J(Ne))return}ee.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(xe)));var Xe=S.getSupportedKeySystemsFromSegmentPssh(xe,ce,X);if(Xe.length===0){ee.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!");return}N(Xe)}}function $e(){return S?S.getKeySystems():[]}function Te(de){S&&S.setKeySystems(de)}return ie={initializeForMedia:le,clearMediaInfoArray:z,handleKeySystemFromManifest:te,createKeySession:B,loadKeySession:U,removeKeySession:ve,closeKeySession:me,setServerCertificate:Ae,setMediaElement:be,setSessionType:Be,setRobustnessLevel:ke,setProtectionData:Ye,getSupportedKeySystemsFromContentProtection:fe,getKeySystems:$e,setKeySystems:Te,stop:Le,reset:Se},Z(),ie}C.__dashjs_factory_name="ProtectionController";const I=b.default.getClassFactory(C)},"./src/streaming/protection/controllers/ProtectionKeyController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>L});var u=r("./src/streaming/protection/CommonEncryption.js"),l=r("./src/streaming/protection/drm/KeySystemClearKey.js"),f=r("./src/streaming/protection/drm/KeySystemW3CClearKey.js"),d=r("./src/streaming/protection/drm/KeySystemWidevine.js"),_=r("./src/streaming/protection/drm/KeySystemPlayReady.js"),E=r("./src/streaming/protection/servers/DRMToday.js"),c=r("./src/streaming/protection/servers/PlayReady.js"),y=r("./src/streaming/protection/servers/Widevine.js"),O=r("./src/streaming/protection/servers/ClearKey.js"),P=r("./src/streaming/constants/ProtectionConstants.js");function b(){var R=this.context,T,m,M,p,C,I,A,S;function x(X){X&&(X.debug&&(m=X.debug,M=m.getLogger(T)),X.BASE64&&(C=X.BASE64),X.settings&&(I=X.settings))}function F(){p=[];var X;X=(0,_.default)(R).getInstance({BASE64:C,settings:I}),p.push(X),X=(0,d.default)(R).getInstance({BASE64:C}),p.push(X),X=(0,l.default)(R).getInstance({BASE64:C}),p.push(X),A=X,X=(0,f.default)(R).getInstance({BASE64:C,debug:m}),p.push(X),S=X}function k(){return p}function j(X){p=X}function V(X){for(var oe=0;oe<p.length;oe++)if(p[oe].systemString===X)return p[oe];return null}function Q(X){return X===A||X===S}function $(X,oe){if(X.byteLength===oe.byteLength){for(var ge=new Uint8Array(X),_e=new Uint8Array(oe),he=0;he<ge.length;he++)if(ge[he]!==_e[he])return!1;return!0}return!1}function K(X,oe,ge){var _e,he,se,Z,q=[];if(X){var le=u.default.findCencContentProtection(X);for(se=0;se<p.length;++se){he=p[se];var te=ne(he.systemString,oe);for(Z=0;Z<X.length;++Z)if(_e=X[Z],_e.schemeIdUri.toLowerCase()===he.schemeIdURI){var N=he.getInitData(_e,le);q.push({ks:p[se],keyId:_e.keyId,initData:N,protData:te,cdmData:he.getCDMData(te?te.cdmData:null),sessionId:ae(te,_e),sessionType:ce(te,ge)})}}}return q}function Y(X,oe,ge){for(var _e=[],he=u.default.parsePSSHList(X),se,Z,q=0;q<p.length;++q){se=p[q],Z=se.systemString;var le=ne(Z,oe);se.uuid in he&&_e.push({ks:se,initData:he[se.uuid],protData:le,cdmData:se.getCDMData(le?le.cdmData:null),sessionId:ae(le),sessionType:ce(le,ge)})}return _e}function re(X,oe,ge){if(ge==="license-release"||ge==="individualization-request")return null;var _e=null;return oe&&oe.hasOwnProperty("drmtoday")?_e=(0,E.default)(R).getInstance({BASE64:C}):X.systemString===P.default.WIDEVINE_KEYSTEM_STRING?_e=(0,y.default)(R).getInstance():X.systemString===P.default.PLAYREADY_KEYSTEM_STRING?_e=(0,c.default)(R).getInstance():X.systemString===P.default.CLEARKEY_KEYSTEM_STRING&&(_e=(0,O.default)(R).getInstance()),_e}function ie(X,oe,ge){try{return X.getClearKeysFromProtectionData(oe,ge)}catch{return M.error("Failed to retrieve clearkeys from ProtectionData"),null}}function ee(X){for(var oe=function(se){var Z=null;return X&&(Z=se in X?X[se]:null),Z},ge=0;ge<p.length;ge++){var _e=p[ge];_e.hasOwnProperty("init")&&_e.init(oe(_e.systemString))}}function ne(X,oe){return oe&&X in oe?oe[X]:null}function ae(X,oe){return X&&X.sessionId?X.sessionId:oe&&oe.sessionId?oe.sessionId:null}function ce(X,oe){return X&&X.sessionType?X.sessionType:oe}return T={initialize:F,setProtectionData:ee,isClearKey:Q,initDataEquals:$,getKeySystems:k,setKeySystems:j,getKeySystemBySystemString:V,getSupportedKeySystemsFromContentProtection:K,getSupportedKeySystemsFromSegmentPssh:Y,getLicenseServerModelInstance:re,processClearKeyLicenseRequest:ie,setConfig:x},T}b.__dashjs_factory_name="ProtectionKeyController";const L=dashjs.FactoryMaker.getSingletonFactory(b)},"./src/streaming/protection/drm/KeySystemClearKey.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>O});var u=r("./src/streaming/protection/vo/KeyPair.js"),l=r("./src/streaming/protection/vo/ClearKeyKeySet.js"),f=r("./src/streaming/protection/CommonEncryption.js"),d=r("./src/streaming/constants/ProtectionConstants.js"),_="e2719d58-a985-b3c9-781a-b030af78d30e",E=d.default.CLEARKEY_KEYSTEM_STRING,c="urn:uuid:"+_;function y(P){P=P||{};var b,L=P.BASE64;function R(A,S){var x=null;if(A){for(var F=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(S))),k=[],j=0;j<F.kids.length;j++){var V=F.kids[j],Q=A.clearkeys&&A.clearkeys.hasOwnProperty(V)?A.clearkeys[V]:null;if(!Q)throw new Error("DRM: ClearKey keyID ("+V+") is not known!");k.push(new u.default(V,Q))}x=new l.default(k)}return x}function T(A,S){try{var x=f.default.parseInitDataFromContentProtection(A,L);if(!x&&S){var F=m(S["cenc:default_KID"]),k={kids:[F]};x=new TextEncoder().encode(JSON.stringify(k))}return x}catch{return null}}function m(A){try{var S=A.replace(/-/g,"");return S=btoa(S.match(/\w{2}/g).map(function(x){return String.fromCharCode(parseInt(x,16))}).join("")),S.replace(/=/g,"").replace(/\//g,"_").replace(/\+/g,"-")}catch{return null}}function M(){return{"Content-Type":"application/json"}}function p(A){return JSON.stringify(JSON.parse(String.fromCharCode.apply(null,new Uint8Array(A))))}function C(){return null}function I(){return null}return b={uuid:_,schemeIdURI:c,systemString:E,getInitData:T,getRequestHeadersFromMessage:M,getLicenseRequestFromMessage:p,getLicenseServerURLFromInitData:C,getCDMData:I,getClearKeysFromProtectionData:R},b}y.__dashjs_factory_name="KeySystemClearKey";const O=dashjs.FactoryMaker.getSingletonFactory(y)},"./src/streaming/protection/drm/KeySystemPlayReady.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>y});var u=r("./src/streaming/protection/CommonEncryption.js"),l=r("./src/streaming/constants/ProtectionConstants.js"),f="9a04f079-9840-4286-ab92-e65be0885f95",d=l.default.PLAYREADY_KEYSTEM_STRING,_="urn:uuid:"+f,E='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>';function c(O){O=O||{};var P,b="utf-16",L=O.BASE64,R=O.settings;function T(){if(!L||!L.hasOwnProperty("decodeArray")||!L.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}function m(S){var x,F,k={},j=new DOMParser;if(R&&R.get().streaming.protection.detectPlayreadyMessageFormat&&b==="utf-16"&&S&&S.byteLength%2===1)return k["Content-Type"]="text/xml; charset=utf-8",k;var V=b==="utf-16"?new Uint16Array(S):new Uint8Array(S);x=String.fromCharCode.apply(null,V),F=j.parseFromString(x,"application/xml");for(var Q=F.getElementsByTagName("name"),$=F.getElementsByTagName("value"),K=0;K<Q.length;K++)k[Q[K].childNodes[0].nodeValue]=$[K].childNodes[0].nodeValue;return k.hasOwnProperty("Content")&&(k["Content-Type"]=k.Content,delete k.Content),k.hasOwnProperty("Content-Type")||(k["Content-Type"]="text/xml; charset=utf-8"),k}function M(S){var x=null,F=new DOMParser;if(R&&R.get().streaming.protection.detectPlayreadyMessageFormat&&b==="utf-16"&&S&&S.byteLength%2===1)return S;var k=b==="utf-16"?new Uint16Array(S):new Uint8Array(S);T();var j=String.fromCharCode.apply(null,k),V=F.parseFromString(j,"application/xml");if(V.getElementsByTagName("PlayReadyKeyMessage")[0]){var Q=V.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;Q&&(x=L.decode(Q))}else return S;return x}function p(S){if(S)for(var x=new DataView(S),F=x.getUint16(4,!0),k=6,j=new DOMParser,V=0;V<F;V++){var Q=x.getUint16(k,!0);k+=2;var $=x.getUint16(k,!0);if(k+=2,Q!==1){k+=$;continue}var K=S.slice(k,k+$),Y=String.fromCharCode.apply(null,new Uint16Array(K)),re=j.parseFromString(Y,"application/xml");if(re.getElementsByTagName("LA_URL")[0]){var ie=re.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(ie)return ie}if(re.getElementsByTagName("LUI_URL")[0]){var ee=re.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(ee)return ee}}return null}function C(S){var x=new Uint8Array([112,115,115,104,0,0,0,0]),F=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),k=0,j=null,V,Q,$,K,Y;if(T(),!S)return null;if("pssh"in S)return u.default.parseInitDataFromContentProtection(S,L);if("pro"in S)j=L.decodeArray(S.pro.__text);else if("prheader"in S)j=L.decodeArray(S.prheader.__text);else return null;return V=j.length,Q=4+x.length+F.length+4+V,$=new ArrayBuffer(Q),K=new Uint8Array($),Y=new DataView($),Y.setUint32(k,Q),k+=4,K.set(x,k),k+=x.length,K.set(F,k),k+=F.length,Y.setUint32(k,V),k+=4,K.set(j,k),k+=V,K.buffer}function I(S){if(S!=="utf-8"&&S!=="utf-16")throw new Error('Specified message format is not one of "utf-8" or "utf-16"');b=S}function A(S){var x,F,k,j;if(T(),!S)return null;for(x=[],j=0;j<S.length;++j)x.push(S.charCodeAt(j)),x.push(0);for(x=String.fromCharCode.apply(null,x),x=L.encode(x),F=E.replace("%CUSTOMDATA%",x),k=[],j=0;j<F.length;++j)k.push(F.charCodeAt(j)),k.push(0);return new Uint8Array(k).buffer}return P={uuid:f,schemeIdURI:_,systemString:d,getInitData:C,getRequestHeadersFromMessage:m,getLicenseRequestFromMessage:M,getLicenseServerURLFromInitData:p,getCDMData:A,setPlayReadyMessageFormat:I},P}c.__dashjs_factory_name="KeySystemPlayReady";const y=dashjs.FactoryMaker.getSingletonFactory(c)},"./src/streaming/protection/drm/KeySystemW3CClearKey.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>O});var u=r("./src/streaming/protection/vo/KeyPair.js"),l=r("./src/streaming/protection/vo/ClearKeyKeySet.js"),f=r("./src/streaming/protection/CommonEncryption.js"),d=r("./src/streaming/constants/ProtectionConstants.js"),_="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",E=d.default.CLEARKEY_KEYSTEM_STRING,c="urn:uuid:"+_;function y(P){var b,L=P.BASE64,R=P.debug.getLogger(b);function T(A,S){var x=null;if(A){for(var F=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(S))),k=[],j=0;j<F.kids.length;j++){var V=F.kids[j],Q=A.clearkeys&&A.clearkeys.hasOwnProperty(V)?A.clearkeys[V]:null;if(!Q)throw new Error("DRM: ClearKey keyID ("+V+") is not known!");k.push(new u.default(V,Q))}x=new l.default(k),R.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return x}function m(A){return f.default.parseInitDataFromContentProtection(A,L)}function M(){return null}function p(A){return new Uint8Array(A)}function C(){return null}function I(){return null}return b={uuid:_,schemeIdURI:c,systemString:E,getInitData:m,getRequestHeadersFromMessage:M,getLicenseRequestFromMessage:p,getLicenseServerURLFromInitData:C,getCDMData:I,getClearKeysFromProtectionData:T},b}y.__dashjs_factory_name="KeySystemW3CClearKey";const O=dashjs.FactoryMaker.getSingletonFactory(y)},"./src/streaming/protection/drm/KeySystemWidevine.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>c});var u=r("./src/streaming/protection/CommonEncryption.js"),l=r("./src/streaming/constants/ProtectionConstants.js"),f="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",d=l.default.WIDEVINE_KEYSTEM_STRING,_="urn:uuid:"+f;function E(y){y=y||{};var O,P=y.BASE64;function b(M){return u.default.parseInitDataFromContentProtection(M,P)}function L(){return null}function R(M){return new Uint8Array(M)}function T(){return null}function m(){return null}return O={uuid:f,schemeIdURI:_,systemString:d,getInitData:b,getRequestHeadersFromMessage:L,getLicenseRequestFromMessage:R,getLicenseServerURLFromInitData:T,getCDMData:m},O}E.__dashjs_factory_name="KeySystemWidevine";const c=dashjs.FactoryMaker.getSingletonFactory(E)},"./src/streaming/protection/errors/ProtectionErrors.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/core/errors/ErrorsBase.js");function l(T){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(M){return typeof M}:l=function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},l(T)}function f(T,m){if(!(T instanceof m))throw new TypeError("Cannot call a class as a function")}function d(T,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(m&&m.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),m&&_(T,m)}function _(T,m){return _=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},_(T,m)}function E(T){var m=O();return function(){var p=P(T),C;if(m){var I=P(this).constructor;C=Reflect.construct(p,arguments,I)}else C=p.apply(this,arguments);return c(this,C)}}function c(T,m){return m&&(l(m)==="object"||typeof m=="function")?m:y(T)}function y(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(T){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},P(T)}var b=function(T){d(M,T);var m=E(M);function M(){var p;return f(this,M),p=m.call(this),p.MEDIA_KEYERR_CODE=100,p.MEDIA_KEYERR_UNKNOWN_CODE=101,p.MEDIA_KEYERR_CLIENT_CODE=102,p.MEDIA_KEYERR_SERVICE_CODE=103,p.MEDIA_KEYERR_OUTPUT_CODE=104,p.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,p.MEDIA_KEYERR_DOMAIN_CODE=106,p.MEDIA_KEY_MESSAGE_ERROR_CODE=107,p.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,p.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,p.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,p.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,p.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,p.KEY_SESSION_CREATED_ERROR_CODE=113,p.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,p.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",p.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",p.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",p.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",p.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",p.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",p.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",p.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",p.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",p.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",p.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",p.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",p.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",p.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",p}return M}(u.default),L=new b;const R=L},"./src/streaming/protection/models/ProtectionModel_01b.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>O});var u=r("./src/streaming/protection/controllers/ProtectionKeyController.js"),l=r("./src/streaming/protection/vo/NeedKey.js"),f=r("./src/streaming/vo/DashJSError.js"),d=r("./src/streaming/protection/vo/KeyMessage.js"),_=r("./src/streaming/protection/vo/KeySystemConfiguration.js"),E=r("./src/streaming/protection/vo/KeySystemAccess.js"),c=r("./src/streaming/protection/errors/ProtectionErrors.js");function y(P){P=P||{};var b=this.context,L=P.eventBus,R=P.events,T=P.debug,m=P.api,M=P.errHandler,p,C,I,A,S,x,F,k,j;function V(){C=T.getLogger(p),I=null,A=null,x=[],F=[],S=(0,u.default)(b).getInstance(),j=ge()}function Q(){I&&he();for(var se=0;se<F.length;se++)ae(F[se]);L.trigger(R.TEARDOWN_COMPLETE)}function $(){for(var se=[],Z=0;Z<x.length;Z++)se.push(x[Z].initData);for(var q=0;q<F.length;q++)se.push(F[q].initData);return se}function K(){return F.concat(x)}function Y(se){return new Promise(function(Z,q){var le=I;le||(le=document.createElement("video"));for(var te=!1,N=0;N<se.length;N++)for(var D=se[N].ks.systemString,w=se[N].configs,W=null,H=null,U=0;U<w.length;U++){var B=w[U].videoCapabilities;if(B&&B.length!==0){H=[];for(var G=0;G<B.length;G++)le.canPlayType(B[G].contentType,D)!==""&&H.push(B[G])}if(!(!W&&!H||W&&W.length===0||H&&H.length===0)){te=!0;var z=new _.default(W,H),fe=S.getKeySystemBySystemString(D),ue=new E.default(fe,z);L.trigger(R.KEY_SYSTEM_ACCESS_COMPLETE,{data:ue}),Z({data:ue});break}}if(!te){var J="Key system access denied! -- No valid audio/video content configurations detected!";L.trigger(R.KEY_SYSTEM_ACCESS_COMPLETE,{error:J}),q({error:J})}})}function re(se){return A=se.keySystem,Promise.resolve(A)}function ie(se){if(I!==se){if(I){he();for(var Z=0;Z<F.length;Z++)ae(F[Z]);F=[]}I=se,I&&(I.addEventListener(m.keyerror,j),I.addEventListener(m.needkey,j),I.addEventListener(m.keymessage,j),I.addEventListener(m.keyadded,j),L.trigger(R.VIDEO_ELEMENT_SELECTED))}}function ee(se){if(!A)throw new Error("Can not create sessions until you have selected a key system");if(k||F.length===0){var Z={sessionId:null,keyId:se.keyId,initData:se.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return x.push(Z),I[m.generateKeyRequest](A.systemString,new Uint8Array(se.initData)),Z}else throw new Error("Multiple sessions not allowed!")}function ne(se,Z){var q=se.sessionId;if(!S.isClearKey(A))I[m.addKey](A.systemString,new Uint8Array(Z),new Uint8Array(se.initData),q);else for(var le=0;le<Z.keyPairs.length;le++)I[m.addKey](A.systemString,Z.keyPairs[le].key,Z.keyPairs[le].keyID,q);L.trigger(R.KEY_SESSION_UPDATED)}function ae(se){try{I[m.cancelKeyRequest](A.systemString,se.sessionId)}catch(Z){L.trigger(R.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+se.sessionId+") "+Z.message})}}function ce(){}function X(){}function oe(){}function ge(){return{handleEvent:function(Z){var q=null;switch(Z.type){case m.needkey:var le=ArrayBuffer.isView(Z.initData)?Z.initData.buffer:Z.initData;L.trigger(R.NEED_KEY,{key:new l.default(le,"cenc")});break;case m.keyerror:if(q=_e(F,Z.sessionId),q||(q=_e(x,Z.sessionId)),q){var te=c.default.MEDIA_KEYERR_CODE,N="";switch(Z.errorCode.code){case 1:te=c.default.MEDIA_KEYERR_UNKNOWN_CODE,N+="MEDIA_KEYERR_UNKNOWN - "+c.default.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:te=c.default.MEDIA_KEYERR_CLIENT_CODE,N+="MEDIA_KEYERR_CLIENT - "+c.default.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:te=c.default.MEDIA_KEYERR_SERVICE_CODE,N+="MEDIA_KEYERR_SERVICE - "+c.default.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:te=c.default.MEDIA_KEYERR_OUTPUT_CODE,N+="MEDIA_KEYERR_OUTPUT - "+c.default.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:te=c.default.MEDIA_KEYERR_HARDWARECHANGE_CODE,N+="MEDIA_KEYERR_HARDWARECHANGE - "+c.default.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:te=c.default.MEDIA_KEYERR_DOMAIN_CODE,N+="MEDIA_KEYERR_DOMAIN - "+c.default.MEDIA_KEYERR_DOMAIN_MESSAGE;break}N+="  System Code = "+Z.systemCode,L.trigger(R.KEY_ERROR,{error:new f.default(te,N,q)})}else C.error("No session token found for key error");break;case m.keyadded:q=_e(F,Z.sessionId),q||(q=_e(x,Z.sessionId)),q?(C.debug("DRM: Key added."),L.trigger(R.KEY_ADDED,{data:q})):C.debug("No session token found for key added");break;case m.keymessage:if(k=Z.sessionId!==null&&Z.sessionId!==void 0,k?(q=_e(F,Z.sessionId),!q&&x.length>0&&(q=x.shift(),F.push(q),q.sessionId=Z.sessionId,L.trigger(R.KEY_SESSION_CREATED,{data:q}))):x.length>0&&(q=x.shift(),F.push(q),x.length!==0&&M.error(new f.default(c.default.MEDIA_KEY_MESSAGE_ERROR_CODE,c.default.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),q){var D=ArrayBuffer.isView(Z.message)?Z.message.buffer:Z.message;q.keyMessage=D,L.trigger(R.INTERNAL_KEY_MESSAGE,{data:new d.default(q,D,Z.defaultURL)})}else C.warn("No session token found for key message");break}}}}function _e(se,Z){if(!Z||!se)return null;for(var q=se.length,le=0;le<q;le++)if(se[le].sessionId==Z)return se[le];return null}function he(){I.removeEventListener(m.keyerror,j),I.removeEventListener(m.needkey,j),I.removeEventListener(m.keymessage,j),I.removeEventListener(m.keyadded,j)}return p={getAllInitData:$,getSessions:K,requestKeySystemAccess:Y,selectKeySystem:re,setMediaElement:ie,createKeySession:ee,updateKeySession:ne,closeKeySession:ae,setServerCertificate:ce,loadKeySession:X,removeKeySession:oe,stop:Q,reset:Q},V(),p}y.__dashjs_factory_name="ProtectionModel_01b";const O=dashjs.FactoryMaker.getClassFactory(y)},"./src/streaming/protection/models/ProtectionModel_21Jan2015.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>P});var u=r("./src/streaming/protection/controllers/ProtectionKeyController.js"),l=r("./src/streaming/protection/vo/NeedKey.js"),f=r("./src/streaming/protection/errors/ProtectionErrors.js"),d=r("./src/streaming/vo/DashJSError.js"),_=r("./src/streaming/protection/vo/KeyMessage.js"),E=r("./src/streaming/protection/vo/KeySystemAccess.js"),c=r("./src/streaming/constants/ProtectionConstants.js"),y={};y[c.default.PLAYREADY_KEYSTEM_STRING]=[c.default.PLAYREADY_KEYSTEM_STRING,c.default.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING],y[c.default.WIDEVINE_KEYSTEM_STRING]=[c.default.WIDEVINE_KEYSTEM_STRING],y[c.default.CLEARKEY_KEYSTEM_STRING]=[c.default.CLEARKEY_KEYSTEM_STRING];function O(b){b=b||{};var L=this.context,R=b.eventBus,T=b.events,m=b.debug,M,p,C,I,A,S,x,F;function k(){p=m.getLogger(M),C=null,I=null,A=null,S=[],F=(0,u.default)(L).getInstance(),x=se()}function j(){var te=S.length,N;te!==0?function(){for(var D=function(H){Z(H),S.length===0&&(I?(I.removeEventListener("encrypted",x),I.setMediaKeys(null).then(function(){R.trigger(T.TEARDOWN_COMPLETE)})):R.trigger(T.TEARDOWN_COMPLETE))},w=0;w<te;w++)N=S[w],function(W){N.session.closed.then(function(){D(W)}),he(N).catch(function(){D(W)})}(N)}():R.trigger(T.TEARDOWN_COMPLETE)}function V(){for(var te,N=0;N<S.length;N++)te=S[N],te.getUsable()||he(te).catch(function(){Z(te)})}function Q(){for(var te=[],N=0;N<S.length;N++)S[N].initData&&te.push(S[N].initData);return te}function $(){return S}function K(te){return new Promise(function(N,D){Y(te,0,N,D)})}function Y(te,N,D,w){if(navigator.requestMediaKeySystemAccess===void 0||typeof navigator.requestMediaKeySystemAccess!="function"){var W="Insecure origins are not allowed";R.trigger(T.KEY_SYSTEM_ACCESS_COMPLETE,{error:W}),w({error:W});return}var H=te[N].protData&&te[N].protData.systemStringPriority?te[N].protData.systemStringPriority:null,U=te[N].configs,B=te[N].ks,G=B.systemString,z=H||(y[G]?y[G]:[G]);re(z,U).then(function(fe){var ue=typeof fe.getConfiguration=="function"?fe.getConfiguration():null,J=new E.default(B,ue);J.mksa=fe,R.trigger(T.KEY_SYSTEM_ACCESS_COMPLETE,{data:J}),D({data:J})}).catch(function(fe){if(N+1<te.length)Y(te,N+1,D,w);else{var ue="Key system access denied! ";R.trigger(T.KEY_SYSTEM_ACCESS_COMPLETE,{error:ue+fe.message}),w({error:ue+fe.message})}})}function re(te,N){return new Promise(function(D,w){ie(te,N,0,D,w)})}function ie(te,N,D,w,W){var H=te[D];p.debug("Requesting key system access for system string ".concat(H)),navigator.requestMediaKeySystemAccess(H,N).then(function(U){U.selectedSystemString=H,w(U)}).catch(function(U){D+1<te.length?ie(te,N,D+1,w,W):W(U)})}function ee(te){return new Promise(function(N,D){te.mksa.createMediaKeys().then(function(w){return C=te.keySystem,A=w,I?I.setMediaKeys(A):Promise.resolve()}).then(function(){N(C)}).catch(function(){D({error:"Error selecting keys system ("+te.keySystem.systemString+")! Could not create MediaKeys -- TODO"})})})}function ne(te){I!==te&&(I&&(I.removeEventListener("encrypted",x),I.setMediaKeys&&I.setMediaKeys(null)),I=te,I&&(I.addEventListener("encrypted",x),I.setMediaKeys&&A&&I.setMediaKeys(A)))}function ae(te){if(!C||!A)throw new Error("Can not set server certificate until you have selected a key system");A.setServerCertificate(te).then(function(){p.info("DRM: License server certificate successfully updated."),R.trigger(T.SERVER_CERTIFICATE_UPDATED)}).catch(function(N){R.trigger(T.SERVER_CERTIFICATE_UPDATED,{error:new d.default(f.default.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,f.default.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+N.name)})})}function ce(te){if(!C||!A)throw new Error("Can not create sessions until you have selected a key system");var N=A.createSession(te.sessionType),D=le(N,te),w=C.systemString===c.default.CLEARKEY_KEYSTEM_STRING&&(te.initData||te.protData&&te.protData.clearkeys)?c.default.INITIALIZATION_DATA_TYPE_KEYIDS:c.default.INITIALIZATION_DATA_TYPE_CENC;N.generateRequest(w,te.initData).then(function(){p.debug("DRM: Session created.  SessionID = "+D.getSessionId()),R.trigger(T.KEY_SESSION_CREATED,{data:D})}).catch(function(W){Z(D),R.trigger(T.KEY_SESSION_CREATED,{data:null,error:new d.default(f.default.KEY_SESSION_CREATED_ERROR_CODE,f.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+W.name)})})}function X(te,N){var D=te.session;F.isClearKey(C)&&(N=N.toJWK()),D.update(N).then(function(){R.trigger(T.KEY_SESSION_UPDATED)}).catch(function(w){R.trigger(T.KEY_ERROR,{error:new d.default(f.default.MEDIA_KEYERR_CODE,"Error sending update() message! "+w.name,te)})})}function oe(te){if(!C||!A)throw new Error("Can not load sessions until you have selected a key system");for(var N=te.sessionId,D=0;D<S.length;D++)if(N===S[D].sessionId){p.warn("DRM: Ignoring session ID because we have already seen it!");return}var w=A.createSession(te.sessionType),W=le(w,te);w.load(N).then(function(H){H?(p.debug("DRM: Session loaded.  SessionID = "+W.getSessionId()),R.trigger(T.KEY_SESSION_CREATED,{data:W})):(Z(W),R.trigger(T.KEY_SESSION_CREATED,{data:null,error:new d.default(f.default.KEY_SESSION_CREATED_ERROR_CODE,f.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+N+")")}))}).catch(function(H){Z(W),R.trigger(T.KEY_SESSION_CREATED,{data:null,error:new d.default(f.default.KEY_SESSION_CREATED_ERROR_CODE,f.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+N+")! "+H.name)})})}function ge(te){var N=te.session;N.remove().then(function(){p.debug("DRM: Session removed.  SessionID = "+te.getSessionId()),R.trigger(T.KEY_SESSION_REMOVED,{data:te.getSessionId()})},function(D){R.trigger(T.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+te.getSessionId()+"). "+D.name})})}function _e(te){he(te).catch(function(N){Z(te),R.trigger(T.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+te.getSessionId()+") "+N.name})})}function he(te){var N=te.session;return N.removeEventListener("keystatuseschange",te),N.removeEventListener("message",te),N.close()}function se(){return{handleEvent:function(N){switch(N.type){case"encrypted":if(N.initData){var D=ArrayBuffer.isView(N.initData)?N.initData.buffer:N.initData;R.trigger(T.NEED_KEY,{key:new l.default(D,N.initDataType)})}break}}}}function Z(te){for(var N=0;N<S.length;N++)if(S[N]===te){S.splice(N,1);break}}function q(te){var N,D;return te&&te.length>0&&(te[0]&&(typeof te[0]=="string"?N=te[0]:D=te[0]),te[1]&&(typeof te[1]=="string"?N=te[1]:D=te[1])),{status:N,keyId:D}}function le(te,N){var D={session:te,keyId:N.keyId,initData:N.initData,sessionId:N.sessionId,sessionType:N.sessionType,handleEvent:function(W){switch(W.type){case"keystatuseschange":R.trigger(T.KEY_STATUSES_CHANGED,{data:this}),W.target.keyStatuses.forEach(function(){var U=q(arguments);switch(U.status){case"expired":R.trigger(T.INTERNAL_KEY_STATUS_CHANGED,{error:new d.default(f.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,f.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)});break;default:R.trigger(T.INTERNAL_KEY_STATUS_CHANGED,U);break}});break;case"message":var H=ArrayBuffer.isView(W.message)?W.message.buffer:W.message;R.trigger(T.INTERNAL_KEY_MESSAGE,{data:new _.default(this,H,void 0,W.messageType)});break}},getKeyId:function(){return this.keyId},getSessionId:function(){return te.sessionId},getSessionType:function(){return this.sessionType},getExpirationTime:function(){return te.expiration},getKeyStatuses:function(){return te.keyStatuses},getUsable:function(){var W=!1;return te.keyStatuses.forEach(function(){var H=q(arguments);H.status==="usable"&&(W=!0)}),W}};return te.addEventListener("keystatuseschange",D),te.addEventListener("message",D),te.closed.then(function(){Z(D),p.debug("DRM: Session closed.  SessionID = "+D.getSessionId()),R.trigger(T.KEY_SESSION_CLOSED,{data:D.getSessionId()})}),S.push(D),D}return M={getAllInitData:Q,getSessions:$,requestKeySystemAccess:K,selectKeySystem:ee,setMediaElement:ne,setServerCertificate:ae,createKeySession:ce,updateKeySession:X,loadKeySession:oe,removeKeySession:ge,closeKeySession:_e,stop:V,reset:j},k(),M}O.__dashjs_factory_name="ProtectionModel_21Jan2015";const P=dashjs.FactoryMaker.getClassFactory(O)},"./src/streaming/protection/models/ProtectionModel_3Feb2014.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>O});var u=r("./src/streaming/protection/controllers/ProtectionKeyController.js"),l=r("./src/streaming/protection/vo/NeedKey.js"),f=r("./src/streaming/vo/DashJSError.js"),d=r("./src/streaming/protection/errors/ProtectionErrors.js"),_=r("./src/streaming/protection/vo/KeyMessage.js"),E=r("./src/streaming/protection/vo/KeySystemConfiguration.js"),c=r("./src/streaming/protection/vo/KeySystemAccess.js");function y(P){P=P||{};var b=this.context,L=P.eventBus,R=P.events,T=P.debug,m=P.api,M,p,C,I,A,S,x,F,k;function j(){p=T.getLogger(M),C=null,I=null,A=null,S=null,x=[],k=(0,u.default)(b).getInstance(),F=oe()}function V(){try{for(var he=0;he<x.length;he++)ne(x[he]);C&&C.removeEventListener(m.needkey,F),L.trigger(R.TEARDOWN_COMPLETE)}catch(se){L.trigger(R.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+se.message})}}function Q(){for(var he=[],se=0;se<x.length;se++)he.push(x[se].initData);return he}function $(){return x}function K(he){return new Promise(function(se,Z){for(var q=!1,le=0;le<he.length;le++)for(var te=he[le].ks.systemString,N=he[le].configs,D=null,w=null,W=0;W<N.length;W++){var H=N[W].audioCapabilities,U=N[W].videoCapabilities;if(H&&H.length!==0){D=[];for(var B=0;B<H.length;B++)window[m.MediaKeys].isTypeSupported(te,H[B].contentType)&&D.push(H[B])}if(U&&U.length!==0){w=[];for(var G=0;G<U.length;G++)window[m.MediaKeys].isTypeSupported(te,U[G].contentType)&&w.push(U[G])}if(!(!D&&!w||D&&D.length===0||w&&w.length===0)){q=!0;var z=new E.default(D,w),fe=k.getKeySystemBySystemString(te),ue=new c.default(fe,z);L.trigger(R.KEY_SYSTEM_ACCESS_COMPLETE,{data:ue}),se({data:ue});break}}if(!q){var J="Key system access denied! -- No valid audio/video content configurations detected!";L.trigger(R.KEY_SYSTEM_ACCESS_COMPLETE,{error:J}),Z({error:J})}})}function Y(he){return new Promise(function(se,Z){try{A=he.mediaKeys=new window[m.MediaKeys](he.keySystem.systemString),I=he.keySystem,S=he,C&&ge(),se(I)}catch{Z({error:"Error selecting keys system ("+I.systemString+")! Could not create MediaKeys -- TODO"})}})}function re(he){C!==he&&(C&&C.removeEventListener(m.needkey,F),C=he,C&&(C.addEventListener(m.needkey,F),A&&ge()))}function ie(he){if(!I||!A||!S)throw new Error("Can not create sessions until you have selected a key system");var se=null;if(S.ksConfiguration.videoCapabilities&&S.ksConfiguration.videoCapabilities.length>0&&(se=S.ksConfiguration.videoCapabilities[0]),se===null&&S.ksConfiguration.audioCapabilities&&S.ksConfiguration.audioCapabilities.length>0&&(se=S.ksConfiguration.audioCapabilities[0]),se===null)throw new Error("Can not create sessions for unknown content types.");var Z=se.contentType,q=A.createSession(Z,new Uint8Array(he.initData),he.cdmData?new Uint8Array(he.cdmData):null),le=_e(q,he);q.addEventListener(m.error,le),q.addEventListener(m.message,le),q.addEventListener(m.ready,le),q.addEventListener(m.close,le),x.push(le),p.debug("DRM: Session created.  SessionID = "+le.getSessionId()),L.trigger(R.KEY_SESSION_CREATED,{data:le})}function ee(he,se){var Z=he.session;k.isClearKey(I)?Z.update(new Uint8Array(se.toJWK())):Z.update(new Uint8Array(se)),L.trigger(R.KEY_SESSION_UPDATED)}function ne(he){var se=he.session;se.removeEventListener(m.error,he),se.removeEventListener(m.message,he),se.removeEventListener(m.ready,he),se.removeEventListener(m.close,he);for(var Z=0;Z<x.length;Z++)if(x[Z]===he){x.splice(Z,1);break}se[m.release]()}function ae(){}function ce(){}function X(){}function oe(){return{handleEvent:function(se){switch(se.type){case m.needkey:if(se.initData){var Z=ArrayBuffer.isView(se.initData)?se.initData.buffer:se.initData;L.trigger(R.NEED_KEY,{key:new l.default(Z,"cenc")})}break}}}}function ge(){var he=null,se=function(){C.removeEventListener("loadedmetadata",he),C[m.setMediaKeys](A),L.trigger(R.VIDEO_ELEMENT_SELECTED)};C.readyState>=1?se():(he=se.bind(this),C.addEventListener("loadedmetadata",he))}function _e(he,se){return{session:he,keyId:se.keyId,initData:se.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(q){switch(q.type){case m.error:var le="KeyError";L.trigger(R.KEY_ERROR,{error:new f.default(d.default.MEDIA_KEYERR_CODE,le,this)});break;case m.message:var te=ArrayBuffer.isView(q.message)?q.message.buffer:q.message;L.trigger(R.INTERNAL_KEY_MESSAGE,{data:new _.default(this,te,q.destinationURL)});break;case m.ready:p.debug("DRM: Key added."),L.trigger(R.KEY_ADDED);break;case m.close:p.debug("DRM: Session closed.  SessionID = "+this.getSessionId()),L.trigger(R.KEY_SESSION_CLOSED,{data:this.getSessionId()});break}}}}return M={getAllInitData:Q,getSessions:$,requestKeySystemAccess:K,selectKeySystem:Y,setMediaElement:re,createKeySession:ie,updateKeySession:ee,closeKeySession:ne,setServerCertificate:ae,loadKeySession:ce,removeKeySession:X,stop:V,reset:V},j(),M}y.__dashjs_factory_name="ProtectionModel_3Feb2014";const O=dashjs.FactoryMaker.getClassFactory(y)},"./src/streaming/protection/servers/ClearKey.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/streaming/protection/vo/KeyPair.js"),l=r("./src/streaming/protection/vo/ClearKeyKeySet.js");function f(){var _;function E(b){return b}function c(){return"POST"}function y(){return"json"}function O(b){if(!b.hasOwnProperty("keys"))return null;for(var L=[],R=0;R<b.keys.length;R++){var T=b.keys[R],m=T.kid.replace(/=/g,""),M=T.k.replace(/=/g,"");L.push(new u.default(m,M))}return new l.default(L)}function P(b){return String.fromCharCode.apply(null,new Uint8Array(b))}return _={getServerURLFromMessage:E,getHTTPMethod:c,getResponseType:y,getLicenseMessage:O,getErrorResponse:P},_}f.__dashjs_factory_name="ClearKey";const d=dashjs.FactoryMaker.getSingletonFactory(f)},"./src/streaming/protection/servers/DRMToday.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/streaming/constants/ProtectionConstants.js");function l(d){d=d||{};var _=d.BASE64,E={};E[u.default.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(m){return _.decodeArray(m.license)},getErrorResponse:function(m){return m}},E[u.default.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(m){return m},getErrorResponse:function(m){return String.fromCharCode.apply(null,new Uint8Array(m))}};var c;function y(){if(!_||!_.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}function O(T){return T}function P(){return"POST"}function b(T){return E[T].responseType}function L(T,m){return y(),E[m].getLicenseMessage(T)}function R(T,m){return E[m].getErrorResponse(T)}return c={getServerURLFromMessage:O,getHTTPMethod:P,getResponseType:b,getLicenseMessage:L,getErrorResponse:R},c}l.__dashjs_factory_name="DRMToday";const f=dashjs.FactoryMaker.getSingletonFactory(l)},"./src/streaming/protection/servers/PlayReady.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/core/FactoryMaker.js");function l(){var d,_="http://schemas.xmlsoap.org/soap/envelope/";function E(T){var m=String.fromCharCode.apply(null,new Uint8Array(T)),M=decodeURIComponent(escape(m));return M}function c(T){if(window.DOMParser){var m=E(T),M=new window.DOMParser,p=M.parseFromString(m,"text/xml"),C=p?p.getElementsByTagNameNS(_,"Envelope")[0]:null,I=C?C.getElementsByTagNameNS(_,"Body")[0]:null,A=I?I.getElementsByTagNameNS(_,"Fault")[0]:null;if(A)return null}return T}function y(T){var m="",M="",p="",C=-1,I=-1;if(window.DOMParser){var A=E(T),S=new window.DOMParser,x=S.parseFromString(A,"text/xml"),F=x?x.getElementsByTagNameNS(_,"Envelope")[0]:null,k=F?F.getElementsByTagNameNS(_,"Body")[0]:null,j=k?k.getElementsByTagNameNS(_,"Fault")[0]:null,V=j?j.getElementsByTagName("detail")[0]:null,Q=V?V.getElementsByTagName("Exception")[0]:null,$=null;if(j===null)return A;$=j.getElementsByTagName("faultstring")[0].firstChild,m=$?$.nodeValue:null,Q!==null&&($=Q.getElementsByTagName("StatusCode")[0],M=$?$.firstChild.nodeValue:null,$=Q.getElementsByTagName("Message")[0],p=$?$.firstChild.nodeValue:null,C=p?p.lastIndexOf("[")+1:-1,I=p?p.indexOf("]"):-1,p=p?p.substring(C,I):"")}var K="code: ".concat(M,", name: ").concat(m);return p&&(K+=", message: ".concat(p)),K}function O(T){return T}function P(){return"POST"}function b(){return"arraybuffer"}function L(T){return c.call(this,T)}function R(T){return y.call(this,T)}return d={getServerURLFromMessage:O,getHTTPMethod:P,getResponseType:b,getLicenseMessage:L,getErrorResponse:R},d}l.__dashjs_factory_name="PlayReady";const f=u.default.getSingletonFactory(l)},"./src/streaming/protection/servers/Widevine.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>l});function u(){var f;function d(O){return O}function _(){return"POST"}function E(){return"arraybuffer"}function c(O){return O}function y(O){return String.fromCharCode.apply(null,new Uint8Array(O))}return f={getServerURLFromMessage:d,getHTTPMethod:_,getResponseType:E,getLicenseMessage:c,getErrorResponse:y},f}u.__dashjs_factory_name="Widevine";const l=dashjs.FactoryMaker.getSingletonFactory(u)},"./src/streaming/protection/vo/ClearKeyKeySet.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});function u(E,c){if(!(E instanceof c))throw new TypeError("Cannot call a class as a function")}function l(E,c){for(var y=0;y<c.length;y++){var O=c[y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(E,O.key,O)}}function f(E,c,y){return c&&l(E.prototype,c),y&&l(E,y),E}var d=function(){function E(c,y){if(u(this,E),y&&y!=="persistent"&&y!=="temporary")throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=c,this.type=y}return f(E,[{key:"toJWK",value:function(){var y,O=this.keyPairs.length,P={keys:[]};for(y=0;y<O;y++){var b={kty:"oct",alg:"A128KW",kid:this.keyPairs[y].keyID,k:this.keyPairs[y].key};P.keys.push(b)}this.type&&(P.type=this.type);var L=JSON.stringify(P),R=L.length,T=new ArrayBuffer(R),m=new Uint8Array(T);for(y=0;y<R;y++)m[y]=L.charCodeAt(y);return T}}]),E}();const _=d},"./src/streaming/protection/vo/KeyMessage.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(_,E,c,y){u(this,d),this.sessionToken=_,this.message=E,this.defaultURL=c,this.messageType=y||"license-request"};const f=l},"./src/streaming/protection/vo/KeyPair.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(_,E){u(this,d),this.keyID=_,this.key=E};const f=l},"./src/streaming/protection/vo/KeySystemAccess.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(_,E){u(this,d),this.keySystem=_,this.ksConfiguration=E};const f=l},"./src/streaming/protection/vo/KeySystemConfiguration.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(_,E,c,y,O){u(this,d),this.initDataTypes=["cenc"],_&&_.length&&(this.audioCapabilities=_),E&&E.length&&(this.videoCapabilities=E),this.distinctiveIdentifier=c,this.persistentState=y,this.sessionTypes=O};const f=l},"./src/streaming/protection/vo/LicenseRequest.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(_,E,c,y,O,P,b,L){u(this,d),this.url=_,this.method=E,this.responseType=c,this.headers=y,this.withCredentials=O,this.messageType=P,this.sessionId=b,this.data=L};const f=l},"./src/streaming/protection/vo/LicenseResponse.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(_,E,c){u(this,d),this.url=_,this.headers=E,this.data=c};const f=l},"./src/streaming/protection/vo/MediaCapability.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(_,E){u(this,d),this.contentType=_,this.robustness=E};const f=l},"./src/streaming/protection/vo/NeedKey.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(_,E){u(this,d),this.initData=_,this.initDataType=E};const f=l},"./src/streaming/rules/DroppedFramesHistory.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/core/FactoryMaker.js");function l(){var _={},E={},c={};function y(L,R,T){if(R){_[L]||(_[L]=[],E[L]=0,c[L]=0);var m=T&&T.droppedVideoFrames?T.droppedVideoFrames:0,M=T&&T.totalVideoFrames?T.totalVideoFrames:0,p=m-E[L];E[L]=m;var C=M-c[L];c[L]=M;var I=_[L];isNaN(R)||(I[R]?(I[R].droppedVideoFrames+=p,I[R].totalVideoFrames+=C):I[R]={droppedVideoFrames:p,totalVideoFrames:C})}}function O(L){return _[L]}function P(L){try{delete _[L],delete E[L],delete c[L]}catch{}}function b(){_={},E={},c={}}return{push:y,getFrameHistory:O,clearForStream:P,reset:b}}l.__dashjs_factory_name="DroppedFramesHistory";var f=u.default.getClassFactory(l);const d=f},"./src/streaming/rules/RulesContext.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/core/FactoryMaker.js");function l(d){d=d||{};var _,E=d.abrController,c=d.switchHistory,y=d.droppedFramesHistory,O=d.currentRequest,P=d.useBufferOccupancyABR,b=d.useL2AABR,L=d.useLoLPABR,R=d.streamProcessor?d.streamProcessor.getScheduleController():null,T=d.streamProcessor?d.streamProcessor.getRepresentationInfo():null,m=d.videoModel?d.videoModel:null;function M(){var K=C();return K?K.type:null}function p(){var K=C();return K?K.streamInfo:null}function C(){return T?T.mediaInfo:null}function I(){return T}function A(){return R}function S(){return E}function x(){return c}function F(){return m}function k(){return y}function j(){return O}function V(){return P}function Q(){return b}function $(){return L}return _={getMediaType:M,getMediaInfo:C,getDroppedFramesHistory:k,getCurrentRequest:j,getSwitchHistory:x,getStreamInfo:p,getScheduleController:A,getAbrController:S,getRepresentationInfo:I,useBufferOccupancyABR:V,useL2AABR:Q,useLoLPABR:$,getVideoModel:F},_}l.__dashjs_factory_name="RulesContext";const f=u.default.getClassFactory(l)},"./src/streaming/rules/SwitchRequest.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/core/FactoryMaker.js"),l=-1,f={DEFAULT:.5,STRONG:1,WEAK:0};function d(c,y,O){var P,b,L,R;function T(m){var M=f.DEFAULT;return(m===f.DEFAULT||m===f.STRONG||m===f.WEAK)&&(M=m),M}return b=c===void 0?l:c,L=T(O),R=y===void 0?null:y,P={quality:b,reason:R,priority:L},P}d.__dashjs_factory_name="SwitchRequest";var _=u.default.getClassFactory(d);_.NO_CHANGE=l,_.PRIORITY=f,u.default.updateClassFactory(d.__dashjs_factory_name,_);const E=_},"./src/streaming/rules/SwitchRequestHistory.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/rules/SwitchRequest.js"),f=8;function d(){var c=[],y=[];function O(L){L.newValue===l.default.NO_CHANGE&&(L.newValue=L.oldValue),c[L.oldValue]||(c[L.oldValue]={noDrops:0,drops:0,dropSize:0});var R=L.newValue-L.oldValue,T=R<0?1:0,m=T?-R:0,M=T?0:1;if(c[L.oldValue].drops+=T,c[L.oldValue].dropSize+=m,c[L.oldValue].noDrops+=M,y.push({idx:L.oldValue,noDrop:M,drop:T,dropSize:m}),y.length>f){var p=y.shift();c[p.idx].drops-=p.drop,c[p.idx].dropSize-=p.dropSize,c[p.idx].noDrops-=p.noDrop}}function P(){return c}function b(){c=[],y=[]}return{push:O,getSwitchRequests:P,reset:b}}d.__dashjs_factory_name="SwitchRequestHistory";var _=u.default.getClassFactory(d);const E=_},"./src/streaming/rules/ThroughputHistory.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/core/FactoryMaker.js");function f(_){_=_||{};var E=20,c=3,y=4,O=4,P=1.3,b=1.3,L=8,R=3,T=2,m=1,M=_.settings,p,C,I,A,S;function x(){S={throughputHalfLife:{fast:R,slow:L},latencyHalfLife:{fast:m,slow:T}},ae()}function F(X,oe,ge){if(X===u.default.VIDEO)return ge<M.get().streaming.cacheLoadThresholds[u.default.VIDEO];if(X===u.default.AUDIO)return ge<M.get().streaming.cacheLoadThresholds[u.default.AUDIO]}function k(X,oe,ge){if(!(!oe.trace||!oe.trace.length)){var _e=oe.tresponse.getTime()-oe.trequest.getTime()||1,he=oe._tfinish.getTime()-oe.tresponse.getTime()||1,se=oe.trace.reduce(function(N,D){return N+D.b[0]},0),Z=0,q=0;if(oe._fileLoaderType&&oe._fileLoaderType===u.default.FILE_LOADER_TYPES.FETCH?Z=oe.trace.reduce(function(N,D){return N+D.d},0):Z=ge?he:_e+he,Z!==0&&(q=Math.round(8*se/Z)),oe.cmsd){var le=oe.cmsd.dynamic&&oe.cmsd.dynamic.etp?oe.cmsd.dynamic.etp:null;if(le){var te=M.get().streaming.cmsd.abr.etpWeightRatio;te>0&&te<=1&&(q=q*(1-te)+le*te)}}if(ee(X),F(X,_e,he)){if(p[X].length>0&&!p[X].hasCachedEntries)return;p[X].hasCachedEntries=!0}else p[X]&&p[X].hasCachedEntries&&ne(X);p[X].push(q),p[X].length>E&&p[X].shift(),C[X].push(_e),C[X].length>E&&C[X].shift(),j(I[X],q,.001*he,S.throughputHalfLife),j(A[X],_e,1,S.latencyHalfLife)}}function j(X,oe,ge,_e){var he=Math.pow(.5,ge/_e.fast);X.fastEstimate=(1-he)*oe+he*X.fastEstimate;var se=Math.pow(.5,ge/_e.slow);X.slowEstimate=(1-se)*oe+se*X.slowEstimate,X.totalWeight+=ge}function V(X,oe,ge){var _e,he;if(X?(_e=p[oe],he=ge?c:y):(_e=C[oe],he=O),!_e)he=0;else if(he>=_e.length)he=_e.length;else if(X)for(var se=1;se<he;++se){var Z=_e[_e.length-se]/_e[_e.length-se-1];if((Z>=b||Z<=1/P)&&(he+=1,he===_e.length))break}return he}function Q(X,oe,ge){return M.get().streaming.abr.movingAverageMethod!==u.default.MOVING_AVERAGE_SLIDING_WINDOW?K(X,oe):$(X,oe,ge)}function $(X,oe,ge){var _e=V(X,oe,ge),he=X?p:C,se=he[oe];return _e===0||!se||se.length===0?NaN:(se=se.slice(-_e),se.reduce(function(Z,q){return Z+q})/se.length)}function K(X,oe){var ge=X?S.throughputHalfLife:S.latencyHalfLife,_e=X?I[oe]:A[oe];if(!_e||_e.totalWeight<=0)return NaN;var he=_e.fastEstimate/(1-Math.pow(.5,_e.totalWeight/ge.fast)),se=_e.slowEstimate/(1-Math.pow(.5,_e.totalWeight/ge.slow));return X?Math.min(he,se):Math.max(he,se)}function Y(X,oe){return Q(!0,X,oe)}function re(X,oe){var ge=Y(X,oe);return isNaN(ge)||(ge*=M.get().streaming.abr.bandwidthSafetyFactor),ge}function ie(X){return Q(!1,X)}function ee(X){p[X]=p[X]||[],C[X]=C[X]||[],I[X]=I[X]||{fastEstimate:0,slowEstimate:0,totalWeight:0},A[X]=A[X]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function ne(X){delete p[X],delete C[X],delete I[X],delete A[X],ee(X)}function ae(){p={},C={},I={},A={}}var ce={push:k,getAverageThroughput:Y,getSafeAverageThroughput:re,getAverageLatency:ie,reset:ae};return x(),ce}f.__dashjs_factory_name="ThroughputHistory";const d=l.default.getClassFactory(f)},"./src/streaming/rules/abr/ABRRulesCollection.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>M});var u=r("./src/streaming/rules/abr/ThroughputRule.js"),l=r("./src/streaming/rules/abr/InsufficientBufferRule.js"),f=r("./src/streaming/rules/abr/AbandonRequestsRule.js"),d=r("./src/streaming/rules/abr/DroppedFramesRule.js"),_=r("./src/streaming/rules/abr/SwitchHistoryRule.js"),E=r("./src/streaming/rules/abr/BolaRule.js"),c=r("./src/streaming/rules/abr/L2ARule.js"),y=r("./src/streaming/rules/abr/lolp/LoLpRule.js"),O=r("./src/core/FactoryMaker.js"),P=r("./src/streaming/rules/SwitchRequest.js"),b=r("./src/streaming/constants/Constants.js"),L="qualitySwitchRules",R="abandonFragmentRules";function T(p){p=p||{};var C=this.context,I=p.mediaPlayerModel,A=p.customParametersModel,S=p.dashMetrics,x=p.settings,F,k,j;function V(){k=[],j=[],x.get().streaming.abr.useDefaultABRRules&&(x.get().streaming.abr.ABRStrategy===b.default.ABR_STRATEGY_L2A?k.push((0,c.default)(C).create({dashMetrics:S,settings:x})):x.get().streaming.abr.ABRStrategy===b.default.ABR_STRATEGY_LoLP?k.push((0,y.default)(C).create({dashMetrics:S})):(k.push((0,E.default)(C).create({dashMetrics:S,mediaPlayerModel:I,settings:x})),k.push((0,u.default)(C).create({dashMetrics:S})),x.get().streaming.abr.additionalAbrRules.insufficientBufferRule&&k.push((0,l.default)(C).create({dashMetrics:S,settings:x})),x.get().streaming.abr.additionalAbrRules.switchHistoryRule&&k.push((0,_.default)(C).create()),x.get().streaming.abr.additionalAbrRules.droppedFramesRule&&k.push((0,d.default)(C).create()),x.get().streaming.abr.additionalAbrRules.abandonRequestsRule&&j.push((0,f.default)(C).create({dashMetrics:S,mediaPlayerModel:I,settings:x}))));var ee=A.getAbrCustomRules();ee.forEach(function(ne){ne.type===L&&k.push(ne.rule(C).create()),ne.type===R&&j.push(ne.rule(C).create())})}function Q(ee){return ee.filter(function(ne){return ne.quality>P.default.NO_CHANGE})}function $(ee){var ne={},ae=null,ce,X,oe,ge,_e;if(ee.length!==0){for(ne[P.default.PRIORITY.STRONG]={quality:P.default.NO_CHANGE,reason:null},ne[P.default.PRIORITY.WEAK]={quality:P.default.NO_CHANGE,reason:null},ne[P.default.PRIORITY.DEFAULT]={quality:P.default.NO_CHANGE,reason:null},ce=0,X=ee.length;ce<X;ce+=1)oe=ee[ce],oe.quality!==P.default.NO_CHANGE&&(ne[oe.priority].quality===P.default.NO_CHANGE||ne[oe.priority].quality>oe.quality)&&(ne[oe.priority].quality=oe.quality,ne[oe.priority].reason=oe.reason||null);return ne[P.default.PRIORITY.WEAK].quality!==P.default.NO_CHANGE&&(ae=ne[P.default.PRIORITY.WEAK]),ne[P.default.PRIORITY.DEFAULT].quality!==P.default.NO_CHANGE&&(ae=ne[P.default.PRIORITY.DEFAULT]),ne[P.default.PRIORITY.STRONG].quality!==P.default.NO_CHANGE&&(ae=ne[P.default.PRIORITY.STRONG]),ae&&(ge=ae.quality,_e=ae.reason),(0,P.default)(C).create(ge,_e)}}function K(ee){var ne=k.map(function(X){return X.getMaxIndex(ee)}),ae=Q(ne),ce=$(ae);return ce||(0,P.default)(C).create()}function Y(ee,ne){var ae=j.map(function(oe){return oe.shouldAbandon(ee,ne)}),ce=Q(ae),X=$(ce);return X||(0,P.default)(C).create()}function re(){[k,j].forEach(function(ee){ee&&ee.length&&ee.forEach(function(ne){return ne.reset&&ne.reset()})}),k=[],j=[]}function ie(){return k}return F={initialize:V,reset:re,getMaxQuality:K,getMinSwitchRequest:$,shouldAbandonFragment:Y,getQualitySwitchRules:ie},F}T.__dashjs_factory_name="ABRRulesCollection";var m=O.default.getClassFactory(T);m.QUALITY_SWITCH_RULES=L,m.ABANDON_FRAGMENT_RULES=R,O.default.updateSingletonFactory(T.__dashjs_factory_name,m);const M=m},"./src/streaming/rules/abr/AbandonRequestsRule.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/streaming/rules/SwitchRequest.js"),l=r("./src/core/FactoryMaker.js"),f=r("./src/core/Debug.js");function d(E){E=E||{};var c=1.8,y=500,O=5,P=this.context,b=E.mediaPlayerModel,L=E.dashMetrics,R=E.settings,T,m,M,p,C;function I(){m=(0,f.default)(P).getInstance().getLogger(T),F()}function A(k,j){M[k]=M[k]||{},M[k][j]=M[k][j]||{}}function S(k,j){C[k]=C[k]||[],C[k].push(j)}function x(k){var j=(0,u.default)(P).create(u.default.NO_CHANGE,{name:d.__dashjs_factory_name});if(!k||!k.hasOwnProperty("getMediaInfo")||!k.hasOwnProperty("getMediaType")||!k.hasOwnProperty("getCurrentRequest")||!k.hasOwnProperty("getRepresentationInfo")||!k.hasOwnProperty("getAbrController"))return j;var V=k.getMediaInfo(),Q=k.getMediaType(),$=k.getStreamInfo(),K=$?$.id:null,Y=k.getCurrentRequest();if(!isNaN(Y.index)){A(Q,Y.index);var re=b.getStableBufferTime(),ie=L.getCurrentBufferLevel(Q);if(ie>re)return j;var ee=M[Q][Y.index];if(ee===null||Y.firstByteDate===null||p.hasOwnProperty(ee.id))return j;if(ee.firstByteTime===void 0&&(C[Q]=[],ee.firstByteTime=Y.firstByteDate.getTime(),ee.segmentDuration=Y.duration,ee.bytesTotal=Y.bytesTotal,ee.id=Y.index),ee.bytesLoaded=Y.bytesLoaded,ee.elapsedTime=new Date().getTime()-ee.firstByteTime,ee.bytesLoaded>0&&ee.elapsedTime>0&&S(Q,Math.round(ee.bytesLoaded*8/ee.elapsedTime)),C[Q].length>=O&&ee.elapsedTime>y&&ee.bytesLoaded<ee.bytesTotal){var ne=C[Q].reduce(function(se,Z){return se+Z},0);if(ee.measuredBandwidthInKbps=Math.round(ne/C[Q].length),ee.estimatedTimeOfDownload=+(ee.bytesTotal*8/ee.measuredBandwidthInKbps/1e3).toFixed(2),ee.estimatedTimeOfDownload<ee.segmentDuration*c||k.getRepresentationInfo().quality===0)return j;if(!p.hasOwnProperty(ee.id)){var ae=k.getAbrController(),ce=ee.bytesTotal-ee.bytesLoaded,X=ae.getBitrateList(V),oe=ae.getQualityForBitrate(V,ee.measuredBandwidthInKbps*R.get().streaming.abr.bandwidthSafetyFactor,K),ge=ae.getMinAllowedIndexFor(Q,K),_e=ge!==void 0?Math.max(ge,oe):oe,he=ee.bytesTotal*X[_e].bitrate/X[ae.getQualityFor(Q,K)].bitrate;ce>he&&(j.quality=_e,j.reason.throughput=ee.measuredBandwidthInKbps,j.reason.fragmentID=ee.id,p[ee.id]=ee,m.debug("["+Q+"] frag id",ee.id," is asking to abandon and switch to quality to ",_e," measured bandwidth was",ee.measuredBandwidthInKbps),delete M[Q][ee.id])}}else ee.bytesLoaded===ee.bytesTotal&&delete M[Q][ee.id]}return j}function F(){M={},p={},C=[]}return T={shouldAbandon:x,reset:F},I(),T}d.__dashjs_factory_name="AbandonRequestsRule";const _=l.default.getClassFactory(d)},"./src/streaming/rules/abr/BolaRule.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>p});var u=r("./src/streaming/constants/MetricsConstants.js"),l=r("./src/streaming/rules/SwitchRequest.js"),f=r("./src/core/FactoryMaker.js"),d=r("./src/streaming/vo/metrics/HTTPRequest.js"),_=r("./src/core/EventBus.js"),E=r("./src/core/events/Events.js"),c=r("./src/core/Debug.js"),y=r("./src/streaming/MediaPlayerEvents.js"),O=r("./src/streaming/constants/Constants.js"),P=0,b=1,L=2,R=10,T=2,m=.99;function M(C){C=C||{};var I=this.context,A=C.dashMetrics,S=C.mediaPlayerModel,x=(0,_.default)(I).getInstance(),F,k,j;function V(){k=(0,c.default)(I).getInstance().getLogger(F),le(),x.on(y.default.BUFFER_EMPTY,X,F),x.on(y.default.PLAYBACK_SEEKING,oe,F),x.on(y.default.METRIC_ADDED,_e,F),x.on(y.default.QUALITY_CHANGE_REQUESTED,se,F),x.on(y.default.FRAGMENT_LOADING_ABANDONED,Z,F),x.on(E.default.MEDIA_FRAGMENT_LOADED,ge,F)}function Q(N){return N.map(function(D){return Math.log(D)})}function $(N,D,w){var W=w.reduce(function(G,z,fe){return z>w[G]?fe:G},0);if(W===0)return null;var H=Math.max(N,R+T*D.length),U=(w[W]-1)/(H/R-1),B=R/U;return{gp:U,Vp:B}}function K(N){var D={},w=N.getMediaInfo(),W=w.bitrateList.map(function(G){return G.bandwidth}),H=Q(W);H=H.map(function(G){return G-H[0]+1});var U=S.getStableBufferTime(),B=$(U,W,H);return B?(D.state=b,D.bitrates=W,D.utilities=H,D.stableBufferTime=U,D.Vp=B.Vp,D.gp=B.gp,D.lastQuality=0,Y(D)):D.state=P,D}function Y(N){N.placeholderBuffer=0,N.mostAdvancedSegmentStart=NaN,N.lastSegmentWasReplacement=!1,N.lastSegmentStart=NaN,N.lastSegmentDurationS=NaN,N.lastSegmentRequestTimeMs=NaN,N.lastSegmentFinishTimeMs=NaN}function re(N,D){var w=S.getStableBufferTime();if(N.stableBufferTime!==w){var W=$(w,N.bitrates,N.utilities);if(W.Vp!==N.Vp||W.gp!==N.gp){var H=A.getCurrentBufferLevel(D),U=H+N.placeholderBuffer;U-=R,U*=W.Vp/N.Vp,U+=R,N.stableBufferTime=w,N.Vp=W.Vp,N.gp=W.gp,N.placeholderBuffer=Math.max(0,U-H)}}}function ie(N){var D=N.getMediaType(),w=j[D];return w?w.state!==P&&re(w,D):(w=K(N),j[D]=w),w}function ee(N,D){for(var w=N.bitrates.length,W=NaN,H=NaN,U=0;U<w;++U){var B=(N.Vp*(N.utilities[U]+N.gp)-D)/N.bitrates[U];(isNaN(H)||B>=H)&&(H=B,W=U)}return W}function ne(N,D){return N.Vp*(N.utilities[D]+N.gp)}function ae(N,D){for(var w=N.bitrates[D],W=N.utilities[D],H=0,U=D-1;U>=0;--U)if(N.utilities[U]<N.utilities[D]){var B=N.bitrates[U],G=N.utilities[U],z=N.Vp*(N.gp+(w*G-B*W)/(w-B));H=Math.max(H,z)}return H}function ce(N,D){var w=Date.now();if(isNaN(N.lastSegmentFinishTimeMs)){if(!isNaN(N.lastCallTimeMs)){var H=.001*(w-N.lastCallTimeMs);N.placeholderBuffer+=Math.max(0,H)}}else{var W=.001*(w-N.lastSegmentFinishTimeMs);N.placeholderBuffer+=Math.max(0,W)}N.lastCallTimeMs=w,N.lastSegmentStart=NaN,N.lastSegmentRequestTimeMs=NaN,N.lastSegmentFinishTimeMs=NaN,re(N,D)}function X(N){var D=N.mediaType,w=D===O.default.AUDIO?[O.default.AUDIO]:j;for(var W in w)j.hasOwnProperty(W)&&j[W].state===L&&(j[W].placeholderBuffer=0)}function oe(){for(var N in j)if(j.hasOwnProperty(N)){var D=j[N];D.state!==P&&(D.state=b,Y(D))}}function ge(N){if(N&&N.chunk&&N.chunk.mediaInfo){var D=j[N.chunk.mediaInfo.type];if(D&&D.state!==P){var w=N.chunk.start;isNaN(D.mostAdvancedSegmentStart)||w>D.mostAdvancedSegmentStart?(D.mostAdvancedSegmentStart=w,D.lastSegmentWasReplacement=!1):D.lastSegmentWasReplacement=!0,D.lastSegmentStart=w,D.lastSegmentDurationS=N.chunk.duration,D.lastQuality=N.chunk.quality,he(D,N.chunk.mediaInfo.type)}}}function _e(N){if(N&&N.metric===u.default.HTTP_REQUEST&&N.value&&N.value.type===d.HTTPRequest.MEDIA_SEGMENT_TYPE&&N.value.trace&&N.value.trace.length){var D=j[N.mediaType];D&&D.state!==P&&(D.lastSegmentRequestTimeMs=N.value.trequest.getTime(),D.lastSegmentFinishTimeMs=N.value._tfinish.getTime(),he(D,N.mediaType))}}function he(N,D){if(!isNaN(N.lastSegmentStart)&&!isNaN(N.lastSegmentRequestTimeMs)&&!isNaN(N.placeholderBuffer)){if(N.placeholderBuffer*=m,!isNaN(N.lastSegmentFinishTimeMs)){var w=A.getCurrentBufferLevel(D),W=w+.001*(N.lastSegmentFinishTimeMs-N.lastSegmentRequestTimeMs),H=ne(N,N.lastQuality),U=Math.max(0,H-W);N.placeholderBuffer=Math.min(U,N.placeholderBuffer)}N.lastSegmentWasReplacement&&!isNaN(N.lastSegmentDurationS)&&(N.placeholderBuffer+=N.lastSegmentDurationS),N.lastSegmentStart=NaN,N.lastSegmentRequestTimeMs=NaN}}function se(N){if(N){var D=j[N.mediaType];D&&D.state!==P&&(D.abrQuality=N.newQuality)}}function Z(N){if(N){var D=j[N.mediaType];if(D&&D.state!==P){var w=A.getCurrentBufferLevel(N.mediaType),W;D.abrQuality>0?W=ae(D,D.abrQuality):W=R;var H=Math.max(0,W-w);D.placeholderBuffer=Math.min(D.placeholderBuffer,H)}}}function q(N){var D=(0,l.default)(I).create();if(!N||!N.hasOwnProperty("getMediaInfo")||!N.hasOwnProperty("getMediaType")||!N.hasOwnProperty("getScheduleController")||!N.hasOwnProperty("getStreamInfo")||!N.hasOwnProperty("getAbrController")||!N.hasOwnProperty("useBufferOccupancyABR"))return D;var w=N.getMediaInfo(),W=N.getMediaType(),H=N.getScheduleController(),U=N.getStreamInfo(),B=N.getAbrController(),G=B.getThroughputHistory(),z=U?U.id:null,fe=U&&U.manifestInfo&&U.manifestInfo.isDynamic,ue=N.useBufferOccupancyABR();if(D.reason=D.reason||{},!ue)return D;H.setTimeToLoadDelay(0);var J=ie(N);if(J.state===P)return D;var ve=A.getCurrentBufferLevel(W),me=G.getAverageThroughput(W,fe),Ae=G.getSafeAverageThroughput(W,fe),be=G.getAverageLatency(W),Be;if(D.reason.state=J.state,D.reason.throughput=me,D.reason.latency=be,isNaN(me))return D;switch(J.state){case b:Be=B.getQualityForBitrate(w,Ae,z,be),D.quality=Be,D.reason.throughput=Ae,J.placeholderBuffer=Math.max(0,ae(J,Be)-ve),J.lastQuality=Be,!isNaN(J.lastSegmentDurationS)&&ve>=J.lastSegmentDurationS&&(J.state=L);break;case L:ce(J,W),Be=ee(J,ve+J.placeholderBuffer);var ke=B.getQualityForBitrate(w,Ae,z,be);Be>J.lastQuality&&Be>ke&&(Be=Math.max(ke,J.lastQuality));var Ye=Math.max(0,ve+J.placeholderBuffer-ne(J,Be));Ye<=J.placeholderBuffer?(J.placeholderBuffer-=Ye,Ye=0):(Ye-=J.placeholderBuffer,J.placeholderBuffer=0,Be<B.getMaxAllowedIndexFor(W,z)?H.setTimeToLoadDelay(1e3*Ye):Ye=0),D.quality=Be,D.reason.throughput=me,D.reason.latency=be,D.reason.bufferLevel=ve,D.reason.placeholderBuffer=J.placeholderBuffer,D.reason.delay=Ye,J.lastQuality=Be;break;default:k.debug("BOLA ABR rule invoked in bad state."),D.quality=B.getQualityForBitrate(w,Ae,z,be),D.reason.state=J.state,D.reason.throughput=Ae,D.reason.latency=be,J.state=b,Y(J)}return D}function le(){j={}}function te(){le(),x.off(y.default.BUFFER_EMPTY,X,F),x.off(y.default.PLAYBACK_SEEKING,oe,F),x.off(y.default.METRIC_ADDED,_e,F),x.off(y.default.QUALITY_CHANGE_REQUESTED,se,F),x.off(y.default.FRAGMENT_LOADING_ABANDONED,Z,F),x.off(E.default.MEDIA_FRAGMENT_LOADED,ge,F)}return F={getMaxIndex:q,reset:te},V(),F}M.__dashjs_factory_name="BolaRule";const p=f.default.getClassFactory(M)},"./src/streaming/rules/abr/DroppedFramesRule.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/rules/SwitchRequest.js"),f=r("./src/core/Debug.js");function d(){var E=this.context,c,y,O=.15,P=375;function b(){y=(0,f.default)(E).getInstance().getLogger(c)}function L(R){var T=(0,l.default)(E).create();if(!R||!R.hasOwnProperty("getDroppedFramesHistory"))return T;var m=R.getDroppedFramesHistory(),M=R.getStreamInfo().id;if(m){var p=m.getFrameHistory(M);if(!p||p.length===0)return T;for(var C=0,I=0,A=l.default.NO_CHANGE,S=1;S<p.length;S++)if(p[S]&&(C=p[S].droppedVideoFrames,I=p[S].totalVideoFrames,I>P&&C/I>O)){A=S-1,y.debug("index: "+A+" Dropped Frames: "+C+" Total Frames: "+I);break}return(0,l.default)(E).create(A,{droppedFrames:C})}return T}return c={getMaxIndex:L},b(),c}d.__dashjs_factory_name="DroppedFramesRule";const _=u.default.getClassFactory(d)},"./src/streaming/rules/abr/InsufficientBufferRule.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>P});var u=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),f=r("./src/core/FactoryMaker.js"),d=r("./src/core/Debug.js"),_=r("./src/streaming/rules/SwitchRequest.js"),E=r("./src/streaming/constants/Constants.js"),c=r("./src/streaming/constants/MetricsConstants.js"),y=r("./src/streaming/MediaPlayerEvents.js");function O(b){b=b||{};var L=.5,R=2,T=this.context,m=(0,u.default)(T).getInstance(),M=b.dashMetrics,p,C,I;function A(){C=(0,d.default)(T).getInstance().getLogger(p),k(),m.on(y.default.PLAYBACK_SEEKING,j,p),m.on(l.default.BYTES_APPENDED_END_FRAGMENT,V,p)}function S(){if(!M||!M.hasOwnProperty("getCurrentBufferLevel")||!M.hasOwnProperty("getCurrentBufferState"))throw new Error(E.default.MISSING_CONFIG_ERROR)}function x($){var K=(0,_.default)(T).create();if(!$||!$.hasOwnProperty("getMediaType"))return K;S();var Y=$.getMediaType(),re=M.getCurrentBufferState(Y),ie=$.getRepresentationInfo(),ee=ie.fragmentDuration,ne=$.getStreamInfo(),ae=ne?ne.id:null,ce=$.getScheduleController(),X=ne&&ne.manifestInfo&&ne.manifestInfo.isDynamic,oe=ce.getPlaybackController(),ge=oe.getLowLatencyModeEnabled();if(F(ge,Y)||!ee)return K;if(re&&re.state===c.default.BUFFER_EMPTY)C.debug("["+Y+"] Switch to index 0; buffer is empty."),K.quality=0,K.reason="InsufficientBufferRule: Buffer is empty";else{var _e=$.getMediaInfo(),he=$.getAbrController(),se=he.getThroughputHistory(),Z=M.getCurrentBufferLevel(Y),q=se.getAverageThroughput(Y,X),le=se.getAverageLatency(Y),te=q*(Z/ee)*L;K.quality=he.getQualityForBitrate(_e,te,ae,le),K.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return K}function F($,K){return!$&&I[K].ignoreCount>0}function k(){I={},I[E.default.VIDEO]={ignoreCount:R},I[E.default.AUDIO]={ignoreCount:R}}function j(){k()}function V($){!isNaN($.startTime)&&($.mediaType===E.default.AUDIO||$.mediaType===E.default.VIDEO)&&I[$.mediaType].ignoreCount>0&&I[$.mediaType].ignoreCount--}function Q(){k(),m.off(y.default.PLAYBACK_SEEKING,j,p),m.off(l.default.BYTES_APPENDED_END_FRAGMENT,V,p)}return p={getMaxIndex:x,reset:Q},A(),p}O.__dashjs_factory_name="InsufficientBufferRule";const P=f.default.getClassFactory(O)},"./src/streaming/rules/abr/L2ARule.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/streaming/constants/MetricsConstants.js"),l=r("./src/streaming/rules/SwitchRequest.js"),f=r("./src/core/FactoryMaker.js"),d=r("./src/streaming/vo/metrics/HTTPRequest.js"),_=r("./src/core/EventBus.js"),E=r("./src/core/events/Events.js"),c=r("./src/core/Debug.js"),y=r("./src/streaming/constants/Constants.js"),O=0,P=1,b=2;function L(T){T=T||{};var m=this.context,M=T.dashMetrics,p=(0,_.default)(m).getInstance(),C,I,A,S;function x(){S=(0,c.default)(m).getInstance().getLogger(C),ae(),p.on(E.default.PLAYBACK_SEEKING,Q,C),p.on(E.default.MEDIA_FRAGMENT_LOADED,$,C),p.on(E.default.METRIC_ADDED,K,C),p.on(E.default.QUALITY_CHANGE_REQUESTED,re,C)}function F(X){var oe={},ge=X.getMediaInfo(),_e=ge.bitrateList.map(function(he){return he.bandwidth/1e3});return oe.state=P,oe.bitrates=_e,oe.lastQuality=0,k(ge),j(oe),oe}function k(X){!X||!X.type||(A[X.type]={},A[X.type].w=[],A[X.type].prev_w=[],A[X.type].Q=0,A[X.type].segment_request_start_s=0,A[X.type].segment_download_finish_s=0,A[X.type].B_target=1.5)}function j(X){X.placeholderBuffer=0,X.mostAdvancedSegmentStart=NaN,X.lastSegmentWasReplacement=!1,X.lastSegmentStart=NaN,X.lastSegmentDurationS=NaN,X.lastSegmentRequestTimeMs=NaN,X.lastSegmentFinishTimeMs=NaN}function V(X){var oe=X.getMediaType(),ge=I[oe];return ge||(ge=F(X),I[oe]=ge),ge}function Q(){for(var X in I)if(I.hasOwnProperty(X)){var oe=I[X];oe.state!==O&&(oe.state=P,j(oe))}}function $(X){if(X&&X.chunk&&X.chunk.mediaInfo){var oe=I[X.chunk.mediaInfo.type],ge=A[X.chunk.mediaInfo.type];if(oe&&oe.state!==O){var _e=X.chunk.start;isNaN(oe.mostAdvancedSegmentStart)||_e>oe.mostAdvancedSegmentStart?(oe.mostAdvancedSegmentStart=_e,oe.lastSegmentWasReplacement=!1):oe.lastSegmentWasReplacement=!0,oe.lastSegmentStart=_e,oe.lastSegmentDurationS=X.chunk.duration,oe.lastQuality=X.chunk.quality,Y(oe,ge)}}}function K(X){if(X&&X.metric===u.default.HTTP_REQUEST&&X.value&&X.value.type===d.HTTPRequest.MEDIA_SEGMENT_TYPE&&X.value.trace&&X.value.trace.length){var oe=I[X.mediaType],ge=A[X.mediaType];oe&&oe.state!==O&&(oe.lastSegmentRequestTimeMs=X.value.trequest.getTime(),oe.lastSegmentFinishTimeMs=X.value._tfinish.getTime(),Y(oe,ge))}}function Y(X,oe){!isNaN(X.lastSegmentStart)&&!isNaN(X.lastSegmentRequestTimeMs)&&(oe.segment_request_start_s=.001*X.lastSegmentRequestTimeMs,oe.segment_download_finish_s=.001*X.lastSegmentFinishTimeMs,X.lastSegmentStart=NaN,X.lastSegmentRequestTimeMs=NaN)}function re(X){if(X&&X.mediaType){var oe=I[X.mediaType];oe&&oe.state!==O&&(oe.abrQuality=X.newQuality)}}function ie(X,oe){if(X.length!==oe.length)return-1;for(var ge=0,_e=0;_e<X.length;_e++)ge=ge+X[_e]*oe[_e];return ge}function ee(X){for(var oe=X.length,ge=!1,_e=[],he=0;he<oe;++he)_e[he]=X[he];for(var se=X.sort(function(D,w){return w-D}),Z=0,q=0,le=[],te=0;te<oe-1;++te)if(Z=Z+se[te],q=(Z-1)/(te+1),q>=se[te+1]){ge=!0;break}ge||(q=(Z+se[oe-1]-1)/oe);for(var N=0;N<oe;++N)le[N]=Math.max(_e[N]-q,0);return le}function ne(X){var oe=(0,l.default)(m).create(),ge=4,_e=Math.pow(ge,.99),he=Math.max(Math.pow(ge,1),_e*Math.sqrt(ge)),se=X.getMediaInfo(),Z=X.getMediaType(),q=se.bitrateList.map(function(je){return je.bandwidth}),le=q.length,te=X.getScheduleController(),N=X.getStreamInfo(),D=X.getAbrController(),w=D.getThroughputHistory(),W=N&&N.manifestInfo&&N.manifestInfo.isDynamic,H=X.useL2AABR(),U=M.getCurrentBufferLevel(Z,!0),B=w.getSafeAverageThroughput(Z,W),G=w.getAverageThroughput(Z,W),z=2,fe=w.getAverageLatency(Z),ue=X.getVideoModel(),J,ve=ue.getPlaybackRate();if(!X||!X.hasOwnProperty("getMediaInfo")||!X.hasOwnProperty("getMediaType")||!X.hasOwnProperty("getScheduleController")||!X.hasOwnProperty("getStreamInfo")||!X.hasOwnProperty("getAbrController")||!X.hasOwnProperty("useL2AABR")||(oe.reason=oe.reason||{},!H||Z===y.default.AUDIO))return oe;te.setTimeToLoadDelay(0);var me=V(X);if(me.state===O)return oe;var Ae=A[Z];if(!Ae||(oe.reason.state=me.state,oe.reason.throughput=G,oe.reason.latency=fe,isNaN(G)))return oe;switch(me.state){case P:if(J=D.getQualityForBitrate(se,B,N.id,fe),oe.quality=J,oe.reason.throughput=B,me.lastQuality=J,!isNaN(me.lastSegmentDurationS)&&U>=Ae.B_target){me.state=b,Ae.Q=_e;for(var be=0;be<le;++be)be===me.lastQuality?Ae.prev_w[be]=1:Ae.prev_w[be]=0}break;case b:var Be=[],ke=M.getCurrentHttpRequest(Z).trace.reduce(function(je,Ge){return je+Ge.d},0),Ye=M.getCurrentHttpRequest(Z).trace.reduce(function(je,Ge){return je+Ge.b[0]},0),Le=Math.round(8*Ye/ke);Le<1&&(Le=1);for(var Se=me.lastSegmentDurationS,Me=1,qe=0;qe<le;++qe)q[qe]=q[qe]/1e3,ve*q[qe]>Le&&(Me=-1),Ae.w[qe]=Ae.prev_w[qe]+Me*(Se/(2*he))*((Ae.Q+_e)*(ve*q[qe]/Le));Ae.w=ee(Ae.w);for(var it=0;it<le;++it)Be[it]=Ae.w[it]-Ae.prev_w[it],Ae.prev_w[it]=Ae.w[it];Ae.Q=Math.max(0,Ae.Q-Se+Se*ve*((ie(q,Ae.prev_w)+ie(q,Be))/Le));for(var at=[],Ce=0;Ce<le;++Ce)at[Ce]=Math.abs(q[Ce]-ie(Ae.w,q));J=at.indexOf(Math.min.apply(Math,at)),J>me.lastQuality&&q[me.lastQuality+1]<=Le&&(J=me.lastQuality+1),q[J]>=Le&&(Ae.Q=z*Math.max(_e,Ae.Q)),oe.quality=J,oe.reason.throughput=G,oe.reason.latency=fe,oe.reason.bufferLevel=U,me.lastQuality=oe.quality;break;default:S.debug("L2A ABR rule invoked in bad state."),oe.quality=D.getQualityForBitrate(se,B,N.id,fe),oe.reason.state=me.state,oe.reason.throughput=B,oe.reason.latency=fe,me.state=P,j(me)}return oe}function ae(){I={},A={}}function ce(){ae(),p.off(E.default.PLAYBACK_SEEKING,Q,C),p.off(E.default.MEDIA_FRAGMENT_LOADED,$,C),p.off(E.default.METRIC_ADDED,K,C),p.off(E.default.QUALITY_CHANGE_REQUESTED,re,C)}return C={getMaxIndex:ne,reset:ce},x(),C}L.__dashjs_factory_name="L2ARule";const R=f.default.getClassFactory(L)},"./src/streaming/rules/abr/SwitchHistoryRule.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),f=r("./src/streaming/rules/SwitchRequest.js");function d(){var E=this.context,c,y,O=.075,P=6;function b(){y=(0,l.default)(E).getInstance().getLogger(c)}function L(R){for(var T=R?R.getSwitchHistory():null,m=T?T.getSwitchRequests():[],M=0,p=0,C=0,I=(0,f.default)(E).create(),A=0;A<m.length;A++)if(m[A]!==void 0&&(M+=m[A].drops,p+=m[A].noDrops,C+=m[A].dropSize,M+p>=P&&M/p>O)){I.quality=A>0&&m[A].drops>0?A-1:A,I.reason={index:I.quality,drops:M,noDrops:p,dropSize:C},y.debug("Switch history rule index: "+I.quality+" samples: "+(M+p)+" drops: "+M);break}return I}return c={getMaxIndex:L},b(),c}d.__dashjs_factory_name="SwitchHistoryRule";const _=u.default.getClassFactory(d)},"./src/streaming/rules/abr/ThroughputRule.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/rules/SwitchRequest.js"),f=r("./src/streaming/constants/Constants.js"),d=r("./src/streaming/constants/MetricsConstants.js");function _(c){c=c||{};var y=this.context,O=c.dashMetrics,P;function b(){if(!O||!O.hasOwnProperty("getCurrentBufferState"))throw new Error(f.default.MISSING_CONFIG_ERROR)}function L(T){var m=(0,l.default)(y).create();if(!T||!T.hasOwnProperty("getMediaInfo")||!T.hasOwnProperty("getMediaType")||!T.hasOwnProperty("useBufferOccupancyABR")||!T.hasOwnProperty("getAbrController")||!T.hasOwnProperty("getScheduleController"))return m;b();var M=T.getMediaInfo(),p=T.getMediaType(),C=O.getCurrentBufferState(p),I=T.getScheduleController(),A=T.getAbrController(),S=T.getStreamInfo(),x=S?S.id:null,F=S&&S.manifestInfo?S.manifestInfo.isDynamic:null,k=A.getThroughputHistory(),j=k.getSafeAverageThroughput(p,F),V=k.getAverageLatency(p),Q=T.useBufferOccupancyABR();return isNaN(j)||!C||Q||A.getAbandonmentStateFor(x,p)!==d.default.ABANDON_LOAD&&(C.state===d.default.BUFFER_LOADED||F)&&(m.quality=A.getQualityForBitrate(M,j,x,V),I.setTimeToLoadDelay(0),m.reason={throughput:j,latency:V}),m}function R(){}return P={getMaxIndex:L,reset:R},P}_.__dashjs_factory_name="ThroughputRule";const E=u.default.getClassFactory(_)},"./src/streaming/rules/abr/lolp/LearningAbrController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),f={MANUAL:"manual_weight_selection",RANDOM:"random_weight_selection",DYNAMIC:"dynamic_weight_selection"};function d(){var E=this.context,c,y,O,P,b,L,R,T,m;function M(){y=(0,l.default)(E).getInstance().getLogger(c),C()}function p(){C()}function C(){O=null,P=1,b=100,L=0,R=null,T=null,m=f.DYNAMIC}function I(){var ne=0;if(O)for(var ae=0;ae<O.length;ae++){var ce=O[ae];ce.state.throughput>ne&&(ne=ce.state.throughput)}return ne}function A(ne){var ae=ne.map(function(ce){return Math.pow(ce,2)}).reduce(function(ce,X){return ce+X});return Math.sqrt(ae)}function S(ne,ae,ce){var X=ne.map(function(ge,_e){return ce[_e]*Math.pow(ge-ae[_e],2)}).reduce(function(ge,_e){return ge+_e}),oe=X<0?-1:1;return oe*Math.sqrt(Math.abs(X))}function x(ne,ae){var ce=[ne.state.throughput,ne.state.latency,ne.state.rebuffer,ne.state.switch],X=[ae.state.throughput,ae.state.latency,ae.state.rebuffer,ae.state.switch];return S(ce,X,[1,1,1,1])}function F(ne,ae,ce){for(var X=0;X<ae.length;X++){var oe=ae[X],ge=.1,_e=x(oe,ne),he=Math.exp(-1*Math.pow(_e,2)/(2*Math.pow(ge,2)));k(oe,ce,he)}}function k(ne,ae,ce){var X=ne.state,oe=[.01,.01,.01,.01];X.throughput=X.throughput+(ae[0]-X.throughput)*oe[0]*ce,X.latency=X.latency+(ae[1]-X.latency)*oe[1]*ce,X.rebuffer=X.rebuffer+(ae[2]-X.rebuffer)*oe[2]*ce,X.switch=X.switch+(ae[3]-X.switch)*oe[3]*ce}function j(ne,ae){var ce=0,X=ne;if(O)for(var oe=0;oe<O.length;oe++){var ge=O[oe];ge.bitrate<ne.bitrate&&ge.bitrate>ce&&ae>ge.bitrate&&(ce=ge.bitrate,X=ge)}return X}function V(ne,ae,ce,X,oe,ge,_e){var he=ce,se=X,Z=ae,q=re(ne),le=ae/P;le>1&&(le=I()),ce=ce/b;var te=0,N=0,D=0,w=1e4;y.debug("getNextQuality called throughput:".concat(le," latency:").concat(ce," bufferSize:").concat(X," currentQualityIndex:").concat(ge," playbackRate:").concat(oe));var W=q[ge],H=W.bitrate*_e.getSegmentDuration()/Z,U=Math.max(0,H-se);if(se-H<_e.getMinBuffer())return y.debug("Buffer is low for bitrate= ".concat(W.bitrate," downloadTime=").concat(H," currentBuffer=").concat(se," rebuffer=").concat(U)),j(W,Z).qualityIndex;switch(m){case f.MANUAL:Q();break;case f.RANDOM:$(q);break;case f.DYNAMIC:K(_e,q,he,se,U,Z,oe);break;default:K(_e,q,he,se,U,Z,oe)}for(var B=null,G=null,z=null,fe=0;fe<q.length;fe++){var ue=q[fe],J=ue.state,ve=[J.throughput,J.latency,J.rebuffer,J.switch],me=R.slice(),Ae=_e.getNextBufferWithBitrate(ue.bitrate,se,Z),be=Ae<_e.getMinBuffer();be&&y.debug("Buffer is low for bitrate=".concat(ue.bitrate," downloadTime=").concat(H," currentBuffer=").concat(se," nextBuffer=").concat(Ae)),(ue.bitrate>ae-w||be)&&ue.bitrate!==L&&(me[0]=100);var Be=S(ve,[le,te,N,D],me);(B===null||Be<B)&&(B=Be,G=ue.qualityIndex,z=ue)}var ke=Math.abs(W.bitrate-z.bitrate)/P;return F(W,q,[le,ce,U,ke]),F(z,q,[le,te,N,ke]),G}function Q(){var ne=.4,ae=.4,ce=.4,X=.4;R=[ne,ae,ce,X]}function $(ne){R=Y(ne.length,4)}function K(ne,ae,ce,X,oe,ge,_e){R||(R=T[T.length-1]);var he=ne.findWeightVector(ae,ce,X,oe,ge,_e);he!==null&&he!==-1&&(R=he)}function Y(ne,ae){for(var ce=[],X=Math.sqrt(2/ne),oe=0;oe<ae;oe++)ce.push(Math.random()*X);return R=ce,R}function re(ne){if(!O){O=[];var ae=ne.bitrateList,ce=[];L=ae[0].bandwidth,ae.forEach(function(ge){ce.push(ge.bandwidth),ge.bandwidth<L&&(L=ge.bandwidth)}),P=A(ce);for(var X=0;X<ae.length;X++){var oe={qualityIndex:X,bitrate:ae[X].bandwidth,state:{throughput:ae[X].bandwidth/P,latency:0,rebuffer:0,switch:0}};O.push(oe)}T=ee(O)}return O}function ie(ne){for(var ae=[],ce=0;ce<ne;ce++){var X=[Math.random()*I(),Math.random(),Math.random(),Math.random()];ae.push(X)}return ae}function ee(ne){var ae=[],ce=ie(Math.pow(ne.length,2));ae.push(ce[0]);for(var X=[1,1,1,1],oe=1;oe<ne.length;oe++){for(var ge=null,_e=null,he=0;he<ce.length;he++){for(var se=ce[he],Z=null,q=0;q<ae.length;q++){var le=S(se,ae[q],X);(Z===null||le<Z)&&(Z=le)}(_e===null||Z>_e)&&(ge=se,_e=Z)}ae.push(ge)}for(var te=null,N=null,D=0;D<ae.length;D++){for(var w=0,W=0;W<ae.length;W++)D!==W&&(w+=S(ae[D],ae[W],X));(te===null||w>te)&&(te=w,N=D)}var H=[];for(H.push(ae[N]),ae.splice(N,1);ae.length>0;){for(var U=null,B=null,G=0;G<ae.length;G++){var z=S(H[0],ae[G],X);(U===null||z<U)&&(U=z,B=G)}H.push(ae[B]),ae.splice(B,1)}return H}return c={getNextQuality:V,reset:p},M(),c}d.__dashjs_factory_name="LearningAbrController";const _=u.default.getClassFactory(d)},"./src/streaming/rules/abr/lolp/LoLpQoEEvaluator.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/rules/abr/lolp/QoeInfo.js");function f(){var _,E,c,y,O;function P(){b()}function b(){E=null,c=null,y=null,O=null}function L(I,A,S){E=R("segment",I,A,S),c=I,y=A,O=S}function R(I,A,S,x){var F=new l.default;return F.type=I,A?F.weights.bitrateReward=A:F.weights.bitrateReward=1,F.weights.bitrateSwitchPenalty=1,S?F.weights.rebufferPenalty=S:F.weights.rebufferPenalty=1e3,F.weights.latencyPenalty=[],F.weights.latencyPenalty.push({threshold:1.1,penalty:x*.05}),F.weights.latencyPenalty.push({threshold:1e8,penalty:S*.1}),x?F.weights.playbackSpeedPenalty=x:F.weights.playbackSpeedPenalty=200,F}function T(I,A,S,x){E&&m(I,A,S,x,E)}function m(I,A,S,x,F){F.bitrateWSum+=F.weights.bitrateReward*I,F.lastBitrate&&(F.bitrateSwitchWSum+=F.weights.bitrateSwitchPenalty*Math.abs(I-F.lastBitrate)),F.lastBitrate=I,F.rebufferWSum+=F.weights.rebufferPenalty*A;for(var k=0;k<F.weights.latencyPenalty.length;k++){var j=F.weights.latencyPenalty[k];if(S<=j.threshold){F.latencyWSum+=j.penalty*S;break}}F.playbackSpeedWSum+=F.weights.playbackSpeedPenalty*Math.abs(1-x),F.totalQoe=F.bitrateWSum-F.bitrateSwitchWSum-F.rebufferWSum-F.latencyWSum-F.playbackSpeedWSum}function M(){return E}function p(I,A,S,x){var F=null;return c&&y&&O&&(F=R("segment",c,y,O)),F?(m(I,A,S,x,F),F.totalQoe):0}function C(){b()}return _={setupPerSegmentQoe:L,logSegmentMetrics:T,getPerSegmentQoe:M,calculateSingleUseQoe:p,reset:C},P(),_}f.__dashjs_factory_name="LoLpQoeEvaluator";const d=u.default.getClassFactory(f)},"./src/streaming/rules/abr/lolp/LoLpRule.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>L});var u=r("./src/core/Debug.js"),l=r("./src/core/FactoryMaker.js"),f=r("./src/streaming/rules/abr/lolp/LearningAbrController.js"),d=r("./src/streaming/rules/abr/lolp/LoLpQoEEvaluator.js"),_=r("./src/streaming/rules/SwitchRequest.js"),E=r("./src/streaming/constants/MetricsConstants.js"),c=r("./src/streaming/rules/abr/lolp/LoLpWeightSelector.js"),y=r("./src/streaming/constants/Constants.js"),O=1.5,P=.3;function b(R){R=R||{};var T=R.dashMetrics,m=this.context,M,p,C,I;function A(){M=(0,u.default)(m).getInstance().getLogger(p),C=(0,f.default)(m).create(),I=(0,d.default)(m).create()}function S(k){try{var j=(0,_.default)(m).create(),V=k.getMediaInfo().type,Q=k.getAbrController(),$=k.getStreamInfo(),K=Q.getQualityFor(V,$.id),Y=k.getMediaInfo(),re=T.getCurrentBufferState(V),ie=k.getScheduleController(),ee=T.getCurrentBufferLevel(V,!0),ne=$&&$.manifestInfo?$.manifestInfo.isDynamic:null,ae=ie.getPlaybackController(),ce=ae.getCurrentLiveLatency();if(!k.useLoLPABR()||V===y.default.AUDIO)return j;ce||(ce=0);var X=ae.getPlaybackRate(),oe=Q.getThroughputHistory(),ge=oe.getSafeAverageThroughput(V,ne);if(M.debug("Throughput ".concat(Math.round(ge)," kbps")),isNaN(ge)||!re||Q.getAbandonmentStateFor($.id,V)===E.default.ABANDON_LOAD)return j;for(var _e=Y.bitrateList,he=k.getRepresentationInfo().fragmentDuration,se=_e[0].bandwidth/1e3,Z=_e[_e.length-1].bandwidth/1e3,q=0;q<_e.length;q++){var le=_e[q].bandwidth/1e3;le>Z?Z=le:le<se&&(se=le)}var te=_e[K].bandwidth,N=te/1e3,D=T.getCurrentHttpRequest(V,!0),w=(D.tresponse.getTime()-D.trequest.getTime())/1e3,W=w>he?w-he:0;I.setupPerSegmentQoe(he,Z,se),I.logSegmentMetrics(N,W,ce,X);var H=(0,c.default)(m).create({targetLatency:O,bufferMin:P,segmentDuration:he,qoeEvaluator:I});return j.quality=C.getNextQuality(Y,ge*1e3,ce,ee,X,K,H),j.reason={throughput:ge,latency:ce},j.priority=_.default.PRIORITY.STRONG,ie.setTimeToLoadDelay(0),j.quality!==K&&console.log("[TgcLearningRule]["+V+"] requesting switch to index: ",j.quality,"Average throughput",Math.round(ge),"kbps"),j}catch(U){throw U}}function x(){C.reset(),I.reset()}function F(){x()}return p={getMaxIndex:S,reset:F},A(),p}b.__dashjs_factory_name="LoLPRule";const L=l.default.getClassFactory(b)},"./src/streaming/rules/abr/lolp/LoLpWeightSelector.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/core/FactoryMaker.js");function l(d){var _=d.targetLatency,E=d.bufferMin,c=d.segmentDuration,y=d.qoeEvaluator,O,P,b,L,R;function T(){m()}function m(){P=[.2,.4,.6,.8,1],b=4,L=C(P,b),R=0}function M(F,k,j,V,Q,$){var K=null,Y=null,re=null,ie=Math.abs(k-R);return F.forEach(function(ee){L.forEach(function(ne){var ae={throughput:ne[0],latency:ne[1],buffer:ne[2],switch:ne[3]},ce=ee.bitrate*c/Q,X=x(j,ce),oe=Math.max(1e-5,ce-X),ge;ae.buffer===0?ge=10:ge=1/ae.buffer;var _e=ge*oe;ae.latency===0?ge=10:ge=1/ae.latency;var he=ge*ee.state.latency,se=y.calculateSingleUseQoe(ee.bitrate,_e,he,$);(K===null||se>K)&&p(k,X,ie)&&(K=se,Y=ne,re=ee.bitrate)})}),Y===null&&re===null&&(Y=-1),R=k,Y}function p(F,k,j){return F>_+j?!1:k>=E}function C(F,k){var j=F.map(function(Q){return[Q]}),V=function Q($,K,Y){if(Y===K)return $;for(var re=$.length,ie=0;ie<re;ie++)for(var ee=$.shift(),ne=0;ne<F.length;ne++)$.push(ee.concat(F[ne]));return Q($,K,Y+1)};return V(j,k,1)}function I(){return E}function A(){return c}function S(F,k,j){var V=F*c/j;return x(k,V)}function x(F,k){var j=A(),V;return k>j?V=F-j:V=F+j-k,V}return O={getMinBuffer:I,getSegmentDuration:A,getNextBufferWithBitrate:S,getNextBuffer:x,findWeightVector:M},T(),O}l.__dashjs_factory_name="LoLpWeightSelector";const f=u.default.getClassFactory(l)},"./src/streaming/rules/abr/lolp/QoeInfo.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0};const f=l},"./src/streaming/text/EmbeddedTextHtmlRender.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/core/FactoryMaker.js");function l(){var d=0,_;function E(R){for(var T="",m=0;m<R.length;++m){var M=R[m];T+=M.uchar}var p=T.length,C=T.replace(/^\s+/,"").length;return p-C}function c(R){return"left: "+R.x*3.125+"%; top: "+R.y1*6.66+"%; width: "+(100-R.x*3.125)+"%; height: "+Math.max(R.y2-1-R.y1,1)*6.66+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function y(R){return R==="red"?"rgb(255, 0, 0)":R==="green"?"rgb(0, 255, 0)":R==="blue"?"rgb(0, 0, 255)":R==="cyan"?"rgb(0, 255, 255)":R==="magenta"?"rgb(255, 0, 255)":R==="yellow"?"rgb(255, 255, 0)":R==="white"?"rgb(255, 255, 255)":R==="black"?"rgb(0, 0, 0)":R}function O(R,T){var m=R.videoHeight/15;return T?"font-size: "+m+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(T.foreground?y(T.foreground):"rgb(255, 255, 255)")+"; font-style: "+(T.italics?"italic":"normal")+"; text-decoration: "+(T.underline?"underline":"none")+"; white-space: pre; background-color: "+(T.background?y(T.background):"transparent")+";":"font-size: "+m+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function P(R){return R.replace(/^\s+/g,"")}function b(R){return R.replace(/\s+$/g,"")}function L(R,T,m,M){var p=null,C=null,I=!1,A=-1,S={start:T,end:m,spans:[]},x="style_cea608_white_black",F={},k={},j=[],V,Q;for(V=0;V<15;++V){var $=M.rows[V],K="",Y=null;if($.isEmpty()===!1){var re=E($.chars);p===null&&(p={x:re,y1:V,y2:V+1,p:[]}),re!==A&&I&&(p.p.push(S),S={start:T,end:m,spans:[]},p.y2=V,p.name="region_"+p.x+"_"+p.y1+"_"+p.y2,F.hasOwnProperty(p.name)===!1?(j.push(p),F[p.name]=p):(C=F[p.name],C.p.contat(p.p)),p={x:re,y1:V,y2:V+1,p:[]});for(var ie=0;ie<$.chars.length;++ie){var ee=$.chars[ie],ne=ee.penState;if(Y===null||!ne.equals(Y)){K.trim().length>0&&(S.spans.push({name:x,line:K,row:V}),K="");var ae="style_cea608_"+ne.foreground+"_"+ne.background;ne.underline&&(ae+="_underline"),ne.italics&&(ae+="_italics"),k.hasOwnProperty(ae)||(k[ae]=JSON.parse(JSON.stringify(ne))),Y=ne,x=ae}K+=ee.uchar}K.trim().length>0&&S.spans.push({name:x,line:K,row:V}),I=!0,A=re}else I=!1,A=-1,p&&(p.p.push(S),S={start:T,end:m,spans:[]},p.y2=V,p.name="region_"+p.x+"_"+p.y1+"_"+p.y2,F.hasOwnProperty(p.name)===!1?(j.push(p),F[p.name]=p):(C=F[p.name],C.p.contat(p.p)),p=null)}p&&(p.p.push(S),p.y2=V+1,p.name="region_"+p.x+"_"+p.y1+"_"+p.y2,F.hasOwnProperty(p.name)===!1?(j.push(p),F[p.name]=p):(C=F[p.name],C.p.contat(p.p)),p=null);var ce=[];for(V=0;V<j.length;++V){var X=j[V],oe="sub_cea608_"+d++,ge=document.createElement("div");ge.id=oe;var _e=c(X);ge.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+_e;var he=document.createElement("div");he.className="paragraph bodyStyle",he.style.cssText=O(R);var se=document.createElement("div");se.className="cueUniWrapper",se.style.cssText="unicode-bidi: normal; direction: ltr;";for(var Z=0;Z<X.p.length;++Z){var q=X.p[Z],le=0;for(Q=0;Q<q.spans.length;++Q){var te=q.spans[Q];if(te.line.length>0){if(Q!==0&&le!=te.row){var N=document.createElement("br");N.className="lineBreak",se.appendChild(N)}var D=!1;le===te.row&&(D=!0),le=te.row;var w=k[te.name],W=document.createElement("span");W.className="spanPadding "+te.name+" customSpanColor",W.style.cssText=O(R,w),Q!==0&&D?Q===q.spans.length-1?W.textContent=b(te.line):W.textContent=te.line:q.spans.length>1&&Q<q.spans.length-1&&te.row===q.spans[Q+1].row?W.textContent=P(te.line):W.textContent=te.line.trim(),se.appendChild(W)}}}he.appendChild(se),ge.appendChild(he);var H={bodyStyle:["%",90]};for(var U in k)k.hasOwnProperty(U)&&(H[U]=["%",90]);ce.push({type:"html",start:T,end:m,cueHTMLElement:ge,cueID:oe,cellResolution:[32,15],isFromCEA608:!0,fontSize:H,lineHeight:{},linePadding:{}})}return ce}return _={createHTMLCaptionsFromScreen:L},_}l.__dashjs_factory_name="EmbeddedTextHtmlRender";const f=u.default.getSingletonFactory(l)},"./src/streaming/text/NotFragmentedTextBufferController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>P});var u=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),f=r("./src/core/FactoryMaker.js"),d=r("./src/streaming/utils/InitCache.js"),_=r("./src/streaming/SourceBufferSink.js"),E=r("./src/streaming/vo/DashJSError.js"),c=r("./src/core/errors/Errors.js"),y="NotFragmentedTextBufferController";function O(b){b=b||{};var L=this.context,R=(0,u.default)(L).getInstance(),T=b.textController,m=b.errHandler,M=b.streamInfo,p=b.type,C,I,A,S,x,F;function k(){A=!1,S=null,I=!1,F=(0,d.default)(L).getInstance(),R.on(l.default.INIT_FRAGMENT_LOADED,_e,C)}function j(){return y}function V(z){re(z)}function Q(z){return new Promise(function(fe,ue){try{x=(0,_.default)(L).create({mediaSource:S,textController:T,eventBus:R}),x.initializeForFirstUse(M,z),A||(x.getBuffer()&&typeof x.getBuffer().initialize=="function"&&x.getBuffer().initialize(),A=!0),fe(x)}catch(J){m.error(new E.default(c.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,c.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+p)),ue(J)}})}function $(){return M.id}function K(){return p}function Y(){return x}function re(z){S=z}function ie(){return S}function ee(){return!1}function ne(){}function ae(){return 0}function ce(){return I}function X(z){I!==z&&(I=z,I&&G(l.default.BUFFERING_COMPLETED))}function oe(z){R.off(l.default.INIT_FRAGMENT_LOADED,_e,C),!z&&x&&(x.abort(),x.reset(),x=null)}function ge(z){return F.extract(M.id,z)!==null}function _e(z){!z.chunk.bytes||I||(F.save(z.chunk),x.append(z.chunk),X(!0))}function he(){return null}function se(){return!0}function Z(){return[]}function q(){return Number.POSITIVE_INFINITY}function le(){return Promise.resolve()}function te(){}function N(){return Promise.resolve()}function D(){return Promise.resolve()}function w(){return I=!1,Promise.resolve()}function W(){return Promise.resolve()}function H(){}function U(){}function B(){return Promise.resolve()}function G(z,fe){var ue=fe||{};R.trigger(z,ue,{streamId:M.id,mediaType:p})}return C={initialize:V,getStreamId:$,getType:K,getBufferControllerType:j,createBufferSink:Q,dischargePreBuffer:ne,getBuffer:Y,getBufferLevel:ae,getRangeAt:he,pruneBuffer:te,hasBufferAtTime:se,getAllRangesWithSafetyFactor:Z,getContinuousBufferTimeForTargetTime:q,setMediaSource:re,getMediaSource:ie,appendInitSegmentFromCache:ge,getIsBufferingCompleted:ce,setIsBufferingCompleted:X,getIsPruningInProgress:ee,reset:oe,clearBuffers:le,prepareForPlaybackSeek:D,prepareForReplacementTrackSwitch:w,setSeekTarget:H,updateAppendWindow:W,pruneAllSafely:B,updateBufferTimestampOffset:N,segmentRequestingCompleted:U},k(),C}O.__dashjs_factory_name=y;const P=f.default.getClassFactory(O)},"./src/streaming/text/TextController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/core/FactoryMaker.js"),f=r("./src/streaming/text/TextSourceBuffer.js"),d=r("./src/streaming/text/TextTracks.js"),_=r("./src/streaming/utils/VTTParser.js"),E=r("./src/streaming/utils/VttCustomRenderingParser.js"),c=r("./src/streaming/utils/TTMLParser.js"),y=r("./src/core/EventBus.js"),O=r("./src/core/events/Events.js"),P=r("./src/streaming/MediaPlayerEvents.js"),b=r("./src/streaming/utils/SupervisorTools.js");function L(T){var m=this.context,M=T.adapter,p=T.errHandler,C=T.manifestModel,I=T.mediaController,A=T.videoModel,S=T.settings,x,F,k,j,V,Q,$,K,Y,re,ie,ee;function ne(){re=!1,ie=!1,ee=!1,V=(0,_.default)(m).getInstance(),Q=(0,E.default)(m).getInstance(),$=(0,c.default)(m).getInstance(),K=(0,y.default)(m).getInstance(),B()}function ae(){K.on(O.default.TEXT_TRACKS_QUEUE_INITIALIZED,se,x),S.get().streaming.text.webvtt.customRenderingEnabled&&(K.on(O.default.PLAYBACK_TIME_UPDATED,Z,x),K.on(O.default.PLAYBACK_SEEKING,q,x))}function ce(z){var fe=z.id,ue=(0,d.default)(m).create({videoModel:A,settings:S,streamInfo:z});ue.initialize(),j[fe]=ue;var J=(0,f.default)(m).create({errHandler:p,adapter:M,manifestModel:C,mediaController:I,videoModel:A,textTracks:ue,vttParser:V,vttCustomRenderingParser:Q,ttmlParser:$,streamInfo:z,settings:S});J.initialize(),k[fe]=J,F[fe]={},F[fe].lastEnabledIndex=-1}function X(z){var fe=z.id;j[fe]&&j[fe].createTracks()}function oe(z,fe,ue){var J=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,ve=z.id;k[ve]&&k[ve].addMediaInfos(fe,ue,J)}function ge(z){var fe=z.id;if(k&&k[fe])return k[fe]}function _e(){return Y}function he(z,fe){var ue=z.id;k[ue]&&k[ue].addEmbeddedTrack(fe)}function se(z){var fe=z.tracks,ue=z.index,J=z.streamId,ve=S.get().streaming.text.defaultEnabled;if(ve===!1&&!te()||ee)D(J,-1);else{var me=I.getCurrentTrackFor(u.default.TEXT,J);if(me){var Ae={lang:me.lang,role:me.roles[0],index:me.index,codec:me.codec,accessibility:me.accessibility[0]};fe.some(function(be,Be){if(I.matchSettings(Ae,be))return D(J,Be),ue=Be,!0})}Y=!1}F[J].lastEnabledIndex=ue,K.trigger(P.default.TEXT_TRACKS_ADDED,{enabled:te(),index:ue,tracks:fe,streamId:J}),ie=!0}function Z(z){try{var fe=z.streamId;if(!j[fe]||isNaN(z.time))return;j[fe].manualCueProcessing(z.time)}catch{}}function q(z){try{var fe=z.streamId;if(!j[fe])return;j[fe].disableManualTracks()}catch{}}function le(z,fe){(0,b.checkParameterType)(fe,"boolean"),te()!==fe&&(fe&&D(z,F[z].lastEnabledIndex),fe||(F[z].lastEnabledIndex=H(z),ie?D(z,-1):ee=!0))}function te(){var z=!0;return Y&&!re&&(z=!1),z}function N(z){(0,b.checkParameterType)(z,"boolean"),re=z}function D(z,fe){Y=fe===-1,Y&&I&&I.saveTextSettingsDisabled();var ue=H(z);if(!(ue===fe||!j[z])){j[z].disableManualTracks(),j[z].setModeForTrackIdx(ue,u.default.TEXT_HIDDEN),j[z].setCurrentTrackIdx(fe),j[z].setModeForTrackIdx(fe,u.default.TEXT_SHOWING);var J=j[z].getCurrentTrackInfo();J&&J.isFragmented&&!J.isEmbedded?w(z,J,ue):J&&!J.isFragmented&&W(z,J),I.setTrack(J)}}function w(z,fe,ue){if(k[z])for(var J=k[z].getConfig(),ve=J.fragmentedTracks,me=0;me<ve.length;me++){var Ae=ve[me];if(fe.lang===Ae.lang&&(Ae.id?fe.id===Ae.id:fe.index===Ae.index)){var be=I.getCurrentTrackFor(u.default.TEXT,z);(Ae.id?be.id!==Ae.id:be.index!==Ae.index)?(j[z].deleteCuesFromTrackIdx(ue),k[z].setCurrentFragmentedTrackIdx(me)):ue===-1&&K.trigger(O.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,{},{streamId:z,mediaType:u.default.TEXT})}}}function W(z,fe){K.trigger(O.default.SET_NON_FRAGMENTED_TEXT,{currentTrackInfo:fe},{streamId:z,mediaType:u.default.TEXT})}function H(z){return j[z].getCurrentTrackIdx()}function U(z){if(z){var fe=z.id;k[fe]&&k[fe].resetMediaInfos(),j[fe]&&j[fe].deleteAllTextTracks()}}function B(){k={},j={},F={},Y=!0,ie=!1,ee=!1}function G(){B(),K.off(O.default.TEXT_TRACKS_QUEUE_INITIALIZED,se,x),S.get().streaming.text.webvtt.customRenderingEnabled&&(K.off(O.default.PLAYBACK_TIME_UPDATED,Z,x),K.off(O.default.PLAYBACK_SEEKING,q,x)),Object.keys(k).forEach(function(z){k[z].resetEmbedded(),k[z].reset()})}return x={deactivateStream:U,initialize:ae,initializeForStream:ce,createTracks:X,getTextSourceBuffer:ge,getAllTracksAreDisabled:_e,addEmbeddedTrack:he,enableText:le,isTextEnabled:te,setTextTrack:D,getCurrentTrackIdx:H,enableForcedTextStreaming:N,addMediaInfosToBuffer:oe,reset:G},ne(),x}L.__dashjs_factory_name="TextController";const R=l.default.getClassFactory(L)},"./src/streaming/text/TextSourceBuffer.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>p});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/streaming/vo/metrics/HTTPRequest.js"),f=r("./src/streaming/vo/TextTrackInfo.js"),d=r("./src/streaming/utils/BoxParser.js"),_=r("./src/streaming/utils/CustomTimeRanges.js"),E=r("./src/core/FactoryMaker.js"),c=r("./src/core/Debug.js"),y=r("./src/streaming/text/EmbeddedTextHtmlRender.js"),O=r("./node_modules/codem-isoboxer/dist/iso_boxer.js"),P=r("./externals/cea608-parser.js"),b=r.n(P),L=r("./src/core/EventBus.js"),R=r("./src/core/events/Events.js"),T=r("./src/streaming/vo/DashJSError.js"),m=r("./src/core/errors/Errors.js");function M(C){var I=C.errHandler,A=C.manifestModel,S=C.mediaController,x=C.videoModel,F=C.textTracks,k=C.vttParser,j=C.vttCustomRenderingParser,V=C.ttmlParser,Q=C.streamInfo,$=C.settings,K=this.context,Y=(0,L.default)(K).getInstance(),re=!1,ie,ee,ne,ae,ce,X,oe,ge,_e,he,se,Z,q,le,te,N;function D(){ee=(0,c.default)(K).getInstance().getLogger(ie),ne=(0,d.default)(K).getInstance(),H()}function w(){return Q.id}function W(){X=null,ge=NaN,_e=[],he=null,oe=!1}function H(){W(),ce=[],ae=null}function U(){re||J()}function B($e,Te,de){if(ce=ce.concat(Te),$e===u.default.TEXT&&Te[0].isFragmented&&!Te[0].isEmbedded){X=de,ie.buffered=(0,_.default)(K).create(),_e=S.getTracksFor(u.default.TEXT,Q.id).filter(function(Xe){return Xe.isFragmented});for(var Re=S.getCurrentTrackFor(u.default.TEXT,Q.id),xe=0;xe<_e.length;xe++)if(_e[xe]===Re){be(xe);break}}for(var Ne=0;Ne<Te.length;Ne++)G(Te[Ne])}function G($e){var Te=new f.default,de={subtitle:"subtitles",caption:"captions"};for(var Re in $e)Te[Re]=$e[Re];Te.labels=$e.labels,Te.defaultTrack=tt($e),Te.isFragmented=$e.isFragmented,Te.isEmbedded=!!$e.isEmbedded,Te.isTTML=Be($e),Te.kind=ke($e,de),F.addTextTrack(Te)}function z(){}function fe(){H(),ce=[],ne=null}function ue($e){var Te=$e.chunk;Te.mediaInfo.embeddedCaptions&&Ye(Te.bytes,Te)}function J(){Z=[],se=null,q=0,te=[],le=null,re=!0,N=(0,y.default)(K).getInstance(),Y.on(R.default.VIDEO_CHUNK_RECEIVED,ue,ie),Y.on(R.default.BUFFER_CLEARED,gt,ie)}function ve(){Y.off(R.default.VIDEO_CHUNK_RECEIVED,ue,ie),Y.off(R.default.BUFFER_CLEARED,gt,ie),F&&F.deleteAllTextTracks(),re=!1,Z=[],te=[null,null],le=null}function me($e){if(re&&$e)if($e.id===u.default.CC1||$e.id===u.default.CC3){for(var Te=0;Te<Z.length;Te++)if(Z[Te].id===$e.id)return;Z.push($e)}else ee.warn("Embedded track "+$e.id+" not supported!")}function Ae(){var $e={fragmentModel:X,fragmentedTracks:_e,videoModel:x};return $e}function be($e){se=$e}function Be($e){return $e.codec&&$e.codec.search(u.default.STPP)>=0||$e.mimeType&&$e.mimeType.search(u.default.TTML)>=0}function ke($e,Te){var de=$e.roles&&$e.roles.length>0?Te[$e.roles[0]]:Te.caption;return de=de===Te.caption||de===Te.subtitle?de:Te.caption,de}function Ye($e,Te){var de=Te.mediaInfo,Re=de.type,xe=de.mimeType,Ne=de.codec||xe;if(!Ne){ee.error("No text type defined");return}de.codec.indexOf("application/mp4")!==-1?Le($e,Te,Ne):Re===u.default.VIDEO?it($e,Te):qe($e,Te,Ne)}function Le($e,Te,de){var Re,xe;if(Te.segmentType==="InitializationSegment")oe=!0,ge=ne.getMediaTimescaleFromMoov($e);else{if(!oe)return;xe=ne.getSamplesInfo($e),Re=xe.sampleList,Re.length>0&&(he=Re[0].cts-Te.start*ge),de.search(u.default.STPP)>=0?Se($e,Re,de):Me($e,Re)}}function Se($e,Te,de){var Re,xe;for(ae=ae!==null?ae:ot(de),Re=0;Re<Te.length;Re++){var Ne=Te[Re],Xe=Ne.cts,nt=Ge(),et=nt+Xe/ge,ht=et+Ne.duration/ge;ie.buffered.add(et,ht);var yt=new DataView($e,Ne.offset,Ne.subSizes[0]),Pt=O.Utils.dataViewToString(yt,u.default.UTF8),De=[],Ue=Ne.offset+Ne.subSizes[0];for(xe=1;xe<Ne.subSizes.length;xe++){var Ze=new Uint8Array($e,Ue,Ne.subSizes[xe]),Et=String.fromCharCode.apply(null,Ze);De.push(Et),Ue+=Ne.subSizes[xe]}try{var ct=A.getValue(),Tt=ct.ttmlTimeIsRelative?Xe/ge:0,Ot=ae.parse(Pt,Tt,Xe/ge,(Xe+Ne.duration)/ge,De);F.addCaptions(se,nt,Ot)}catch(jt){X.removeExecutedRequestsBeforeTime(),this.remove(),ee.error("TTML parser error: "+jt.message)}}}function Me($e,Te){var de,Re,xe,Ne=[];for(de=0;de<Te.length;de++){var Xe=Te[de];Xe.cts-=he;var nt=Ge(),et=nt+Xe.cts/ge,ht=et+Xe.duration/ge;ie.buffered.add(et,ht);var yt=$e.slice(Xe.offset,Xe.offset+Xe.size),Pt=O.parseBuffer(yt);for(Re=0;Re<Pt.boxes.length;Re++){var De=Pt.boxes[Re];if(ee.debug("VTT box1: "+De.type),De.type!=="vtte"&&De.type==="vttc")for(ee.debug("VTT vttc boxes.length = "+De.boxes.length),xe=0;xe<De.boxes.length;xe++){var Ue=De.boxes[xe];if(ee.debug("VTT box2: "+Ue.type),Ue.type==="payl"){var Ze=Ue.cue_text;ee.debug("VTT cue_text = "+Ze);var Et=Xe.cts/ge,ct=(Xe.cts+Xe.duration)/ge;Ne.push({start:Et,end:ct,data:Ze,styles:{}}),ee.debug("VTT "+Et+"-"+ct+" : "+Ze)}}}}Ne.length>0&&F.addCaptions(se,0,Ne)}function qe($e,Te,de){var Re,xe,Ne=new DataView($e,0,$e.byteLength);xe=O.Utils.dataViewToString(Ne,u.default.UTF8);try{Re=ot(de).parse(xe,0),F.addCaptions(F.getCurrentTrackIdx(),0,Re),ie.buffered&&ie.buffered.add(Te.start,Te.end)}catch(Xe){I.error(new T.default(m.default.TIMED_TEXT_ERROR_ID_PARSE_CODE,m.default.TIMED_TEXT_ERROR_MESSAGE_PARSE+Xe.message,xe))}}function it($e,Te){var de,Re;if(Te.segmentType===l.HTTPRequest.INIT_SEGMENT_TYPE)q===0&&(q=ne.getMediaTimescaleFromMoov($e));else if(Te.segmentType===l.HTTPRequest.MEDIA_SEGMENT_TYPE){if(q===0){ee.warn("CEA-608: No timescale for embeddedTextTrack yet");return}Re=ne.getSamplesInfo($e);var xe=Re.lastSequenceNumber;if(!te[0]&&!te[1]&&at(),q){if(le!==null&&xe!==le+Re.numSequences)for(de=0;de<te.length;de++)te[de]&&te[de].reset();for(var Ne=je($e,Re.sampleList),Xe=0;Xe<te.length;Xe++){var nt=Ne.fields[Xe],et=te[Xe];if(et)for(de=0;de<nt.length;de++)et.addData(nt[de][0]/q,nt[de][1])}le=xe}}}function at(){for(var $e,Te=0;Te<Z.length;Te++){if($e=F.getTrackIdxForId(Z[Te].id),$e===-1){ee.warn("CEA-608: data before track is ready.");return}var de=Ce($e);te[Te]=new(b()).Cea608Parser(Te+1,{newCue:de},null)}}function Ce($e){function Te(de,Re,xe){var Ne;if(x.getTTMLRenderingDiv())Ne=N.createHTMLCaptionsFromScreen(x.getElement(),de,Re,xe);else{var Xe=xe.getDisplayText();Ne=[{start:de,end:Re,data:Xe,styles:{}}]}Ne&&F.addCaptions($e,0,Ne)}return Te}function je($e,Te){if(Te.length===0)return null;for(var de={splits:[],fields:[[],[]]},Re=new DataView($e),xe=0;xe<Te.length;xe++)for(var Ne=Te[xe],Xe=b().findCea608Nalus(Re,Ne.offset,Ne.size),nt=null,et=0,ht=0;ht<Xe.length;ht++)for(var yt=b().extractCea608DataFromRange(Re,Xe[ht]),Pt=0;Pt<2;Pt++)if(yt[Pt].length>0){Ne.cts!==nt?et=0:et+=1;var De=Ge();de.fields[Pt].push([Ne.cts+De*q,yt[Pt],et]),nt=Ne.cts}return de.fields.forEach(function(Ze){Ze.sort(function(Et,ct){return Et[0]===ct[0]?Et[2]-ct[2]:Et[0]-ct[0]})}),de}function Ge(){return isNaN(ie.timestampOffset)?0:ie.timestampOffset}function tt($e){var Te=!1;return Z.length>1&&$e.isEmbedded?Te=$e.id&&$e.id===u.default.CC1:Z.length===1?$e.id&&typeof $e.id=="string"&&$e.id.substring(0,2)==="CC"&&(Te=!0):Z.length===0&&(Te=$e.index===ce[0].index),Te}function ot($e){var Te;return $e.search(u.default.VTT)>=0?Te=$.get().streaming.text.webvtt.customRenderingEnabled&&j?j:k:($e.search(u.default.TTML)>=0||$e.search(u.default.STPP)>=0)&&(Te=V),Te}function dt($e,Te){$e===void 0&&$e===Te&&($e=ie.buffered.start(0),Te=ie.buffered.end(ie.buffered.length-1)),ie.buffered.remove($e,Te),F.deleteCuesFromTrackIdx(se,$e,Te)}function gt($e){Z.forEach(function(Te){var de=F.getTrackIdxForId(Te.id);de>=0&&F.deleteCuesFromTrackIdx(de,$e.from,$e.to)})}function Mt(){ce=[]}return ie={initialize:U,addMediaInfos:B,resetMediaInfos:Mt,getStreamId:w,append:Ye,abort:z,addEmbeddedTrack:me,resetEmbedded:ve,getConfig:Ae,setCurrentFragmentedTrackIdx:be,remove:dt,reset:fe},D(),ie}M.__dashjs_factory_name="TextSourceBuffer";const p=E.default.getClassFactory(M)},"./src/streaming/text/TextTracks.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js"),d=r("./src/streaming/MediaPlayerEvents.js"),_=r("./src/core/FactoryMaker.js"),E=r("./src/core/Debug.js"),c=r("./node_modules/imsc/src/main/js/main.js");function y(T,m){var M;if(typeof Symbol>"u"||T[Symbol.iterator]==null){if(Array.isArray(T)||(M=O(T))||m&&T&&typeof T.length=="number"){M&&(T=M);var p=0,C=function(){};return{s:C,n:function(){return p>=T.length?{done:!0}:{done:!1,value:T[p++]}},e:function(F){throw F},f:C}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var I=!0,A=!1,S;return{s:function(){M=T[Symbol.iterator]()},n:function(){var F=M.next();return I=F.done,F},e:function(F){A=!0,S=F},f:function(){try{!I&&M.return!=null&&M.return()}finally{if(A)throw S}}}}function O(T,m){if(T){if(typeof T=="string")return P(T,m);var M=Object.prototype.toString.call(T).slice(8,-1);if(M==="Object"&&T.constructor&&(M=T.constructor.name),M==="Map"||M==="Set")return Array.from(T);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return P(T,m)}}function P(T,m){(m==null||m>T.length)&&(m=T.length);for(var M=0,p=new Array(m);M<m;M++)p[M]=T[M];return p}var b=["text","images","embeddedImages","align","fontSize","id","isd","line","lineAlign","lineHeight","linePadding","position","positionAlign","region","size","snapToLines","vertical"];function L(T){var m=this.context,M=(0,l.default)(m).getInstance(),p=T.videoModel,C=T.streamInfo,I=T.settings,A,S,x,F,k,j,V,Q,$,K,Y,re,ie,ee,ne,ae,ce,X;function oe(){S=(0,E.default)(m).getInstance().getLogger(A)}function ge(){typeof window>"u"||typeof navigator>"u"||(x=window.VTTCue||window.TextTrackCue,F=[],k=[],j=-1,V=0,Q=0,$=0,K=0,Y=null,re=null,ie=null,ne=!1,ce=2147483647,ae=null,document.fullscreenElement!==void 0?ee="fullscreenElement":document.webkitIsFullScreen!==void 0?ee="webkitIsFullScreen":document.msFullscreenElement?ee="msFullscreenElement":document.mozFullScreen&&(ee="mozFullScreen"))}function _e(){return C.id}function he(Ce){var je=Ce.kind,Ge=Ce.id!==void 0?Ce.id:Ce.lang,tt=Ce.lang,ot=Ce.isTTML,dt=Ce.isEmbedded,gt=p.addTextTrack(je,Ge,tt,ot,dt);return gt}function se(Ce){F.push(Ce)}function Z(){F.sort(function(Mt,$e){return Mt.index-$e.index}),Y=p.getTTMLRenderingDiv(),re=p.getVttRenderingDiv();for(var Ce=-1,je=0;je<F.length;je++){var Ge=he(F[je]);k.push(Ge),F[je].defaultTrack&&(Ge.default=!0,Ce=je);var tt=fe(je);tt&&(tt.mode=u.default.TEXT_SHOWING,Y&&(F[je].isTTML||F[je].isEmbedded)?tt.renderingType="html":tt.renderingType="default"),W(je,0,F[je].captionData),M.trigger(d.default.TEXT_TRACK_ADDED)}if(ve.call(this,Ce),Ce>=0){var ot=function Mt(){var $e=fe(Ce);$e&&$e.renderingType==="html"&&le.call(this,$e,!0),M.off(d.default.PLAYBACK_METADATA_LOADED,Mt,this)};M.on(d.default.PLAYBACK_METADATA_LOADED,ot,this);for(var dt=0;dt<F.length;dt++){var gt=fe(dt);gt&&(gt.mode=dt===Ce?u.default.TEXT_SHOWING:u.default.TEXT_HIDDEN,gt.manualMode=dt===Ce?u.default.TEXT_SHOWING:u.default.TEXT_HIDDEN)}}M.trigger(f.default.TEXT_TRACKS_QUEUE_INITIALIZED,{index:j,tracks:F,streamId:C.id})}function q(Ce,je,Ge,tt,ot,dt){var gt=Ce/je,Mt=Ge/tt,$e=0,Te=0;gt>Mt?(Te=je,$e=Te/tt*Ge):($e=Ce,Te=$e/Ge*tt);var de=0,Re=0,xe=0,Ne=0,Xe=$e/Te;return Xe>ot?(Ne=Te,xe=Te*ot):(xe=$e,Ne=$e/ot),de=(Ce-xe)/2,Re=(je-Ne)/2,dt?{x:de+xe*.1,y:Re+Ne*.1,w:xe*.8,h:Ne*.8}:{x:de,y:Re,w:xe,h:Ne}}function le(Ce,je){var Ge=p.getClientWidth(),tt=p.getClientHeight(),ot=p.getVideoWidth(),dt=p.getVideoHeight(),gt=p.getVideoRelativeOffsetTop(),Mt=p.getVideoRelativeOffsetLeft();if(ot!==0&&dt!==0){var $e=ot/dt,Te=!1;Ce.isFromCEA608&&($e=1.1666666666666667,Te=!0);var de=q.call(this,Ge,tt,ot,dt,$e,Te),Re=de.w,xe=de.h,Ne=de.x,Xe=de.y;if(Re!=$||xe!=K||Ne!=V||Xe!=Q||je){if(V=Ne+Mt,Q=Xe+gt,$=Re,K=xe,Y){var nt=Y.style;nt&&(nt.left=V+"px",nt.top=Q+"px",nt.width=$+"px",nt.height=K+"px",nt.zIndex=ee&&document[ee]||ne?ce:null,M.trigger(d.default.CAPTION_CONTAINER_RESIZE))}var et=Ce.activeCues;if(et)for(var ht=et.length,yt=0;yt<ht;++yt){var Pt=et[yt];Pt.scaleCue(Pt)}}}}function te(Ce){var je=$,Ge=K,tt,ot,dt,gt,Mt;if(Ce.cellResolution){var $e=[je/Ce.cellResolution[0],Ge/Ce.cellResolution[1]];if(Ce.linePadding){for(tt in Ce.linePadding)if(Ce.linePadding.hasOwnProperty(tt)){var Te=Ce.linePadding[tt];ot=(Te*$e[0]).toString();for(var de=document.getElementsByClassName("spanPadding"),Re=0;Re<de.length;Re++)de[Re].style.cssText=de[Re].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+ot),de[Re].style.cssText=de[Re].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+ot)}}if(Ce.fontSize){for(tt in Ce.fontSize)if(Ce.fontSize.hasOwnProperty(tt)){Ce.fontSize[tt][0]==="%"?dt=Ce.fontSize[tt][1]/100:Ce.fontSize[tt][0]==="c"&&(dt=Ce.fontSize[tt][1]),ot=(dt*$e[1]).toString(),tt!=="defaultFontSize"?Mt=document.getElementsByClassName(tt):Mt=document.getElementsByClassName("paragraph");for(var xe=0;xe<Mt.length;xe++)Mt[xe].style.cssText=Mt[xe].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+ot)}if(Ce.lineHeight){for(tt in Ce.lineHeight)if(Ce.lineHeight.hasOwnProperty(tt)){Ce.lineHeight[tt][0]==="%"?gt=Ce.lineHeight[tt][1]/100:Ce.fontSize[tt][0]==="c"&&(gt=Ce.lineHeight[tt][1]),ot=(gt*$e[1]).toString(),Mt=document.getElementsByClassName(tt);for(var Ne=0;Ne<Mt.length;Ne++)Mt[Ne].style.cssText=Mt[Ne].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+ot)}}}}if(Ce.isd){var Xe=document.getElementById(Ce.cueID);Xe&&Y.removeChild(Xe),N(Ce)}}function N(Ce){if(Y){var je=document.createElement("div");Y.appendChild(je),ae=(0,c.renderHTML)(Ce.isd,je,function(Ge){var tt=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,ot=/^#(.*)$/;if(tt.test(Ge)){var dt=tt.exec(Ge),gt=parseInt(dt[4],10)-1,Mt=btoa(Ce.images[gt]),$e="data:image/png;base64,"+Mt;return $e}else if(ot.test(Ge)){var Te=ot.exec(Ge),de=Te[1],Re="data:image/png;base64,"+Ce.embeddedImages[de];return Re}else return null},Y.clientHeight,Y.clientWidth,!1,function(Ge){S.info("renderCaption :",Ge)},ae,!0),je.id=Ce.cueID,M.trigger(d.default.CAPTION_RENDERED,{captionDiv:je,currentTrackIdx:j})}}function D(Ce,je){if(!I.get().streaming.text.extendSegmentedCues||!je.cues||je.cues.length===0)return!1;var Ge=je.cues[je.cues.length-1];return Ge.endTime!==Ce.startTime||!w(Ge,Ce,b)?!1:(Ge.endTime=Ce.endTime,!0)}function w(Ce,je,Ge){for(var tt=0;tt<Ge.length;tt++){var ot=Ge[tt];if(JSON.stringify(Ce[ot])!==JSON.stringify(je[ot]))return!1}return!0}function W(Ce,je,Ge){var tt=fe(Ce);if(tt&&!(!Array.isArray(Ge)||Ge.length===0))for(var ot=0;ot<Ge.length;ot++){var dt=void 0,gt=Ge[ot];tt.cellResolution=gt.cellResolution,tt.isFromCEA608=gt.isFromCEA608,!isNaN(gt.start)&&!isNaN(gt.end)&&(dt=gt.type==="html"&&Y?H(gt,je,tt):gt.data?U(gt,je,tt):null);try{dt?Ae(tt,dt)||(I.get().streaming.text.webvtt.customRenderingEnabled?(tt.manualCueList||(tt.manualCueList=[]),tt.manualCueList.push(dt)):D(dt,tt)||tt.addCue(dt)):S.error("Impossible to display subtitles. You might have missed setting a TTML rendering div via player.attachTTMLRenderingDiv(TTMLRenderingDiv)")}catch(Mt){throw Be(tt),tt.addCue(dt),Mt}}}function H(Ce,je,Ge){var tt=this,ot=new x(Ce.start+je,Ce.end+je,"");return ot.cueHTMLElement=Ce.cueHTMLElement,ot.isd=Ce.isd,ot.images=Ce.images,ot.embeddedImages=Ce.embeddedImages,ot.cueID=Ce.cueID,ot.scaleCue=te.bind(tt),ot.cellResolution=Ce.cellResolution,ot.lineHeight=Ce.lineHeight,ot.linePadding=Ce.linePadding,ot.fontSize=Ce.fontSize,Y.style.left=V+"px",Y.style.top=Q+"px",Y.style.width=$+"px",Y.style.height=K+"px",ot.onenter=function(){Ge.mode===u.default.TEXT_SHOWING&&(this.isd?(N(this),S.debug("Cue enter id:"+this.cueID)):(Y.appendChild(this.cueHTMLElement),te.call(tt,this),M.trigger(d.default.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:j})))},ot.onexit=function(){if(Y)for(var dt=Y.childNodes,gt=0;gt<dt.length;++gt)dt[gt].id===this.cueID&&(S.debug("Cue exit id:"+dt[gt].id),Y.removeChild(dt[gt]),--gt)},ot}function U(Ce,je,Ge){var tt=new x(Ce.start-je,Ce.end-je,Ce.data);if(tt.cueID="".concat(tt.startTime,"_").concat(tt.endTime),tt.isActive=!1,Ce.styles)try{Ce.styles.align!==void 0&&"align"in tt&&(tt.align=Ce.styles.align),Ce.styles.line!==void 0&&"line"in tt&&(tt.line=Ce.styles.line),Ce.styles.position!==void 0&&"position"in tt&&(tt.position=Ce.styles.position),Ce.styles.size!==void 0&&"size"in tt&&(tt.size=Ce.styles.size)}catch(ot){S.error(ot)}return tt.onenter=function(){Ge.mode===u.default.TEXT_SHOWING&&M.trigger(d.default.CAPTION_RENDERED,{currentTrackIdx:j})},tt}function B(Ce){var je=z();if(je&&je.length>0){var Ge=je[0],tt=Ge.manualCueList;tt&&tt.length>0&&tt.forEach(function(ot){if(ot.startTime<=Ce&&ot.endTime>=Ce&&!ot.isActive)ot.isActive=!0,WebVTT.processCues(window,[ot],re,ot.cueID);else if(ot.isActive&&(ot.startTime>Ce||ot.endTime<Ce)&&(ot.isActive=!1,re))for(var dt=re.childNodes,gt=0;gt<dt.length;++gt)dt[gt].id===ot.cueID&&(re.removeChild(dt[gt]),--gt)})}}function G(){var Ce=z();if(Ce&&Ce.length>0){var je=Ce[0],Ge=je.manualCueList;Ge&&Ge.length>0&&Ge.forEach(function(tt){if(tt.isActive&&(tt.isActive=!1,re))for(var ot=re.childNodes,dt=0;dt<ot.length;++dt)ot[dt].id===tt.cueID&&(re.removeChild(ot[dt]),--dt)})}}function z(){var Ce=p.getTextTracks(),je=[],Ge=y(Ce),tt;try{for(Ge.s();!(tt=Ge.n()).done;){var ot=tt.value;ot.manualMode===u.default.TEXT_SHOWING&&je.push(ot)}}catch(dt){Ge.e(dt)}finally{Ge.f()}return je}function fe(Ce){return Ce>=0&&F[Ce]?p.getTextTrack(F[Ce].kind,F[Ce].id,F[Ce].lang,F[Ce].isTTML,F[Ce].isEmbedded):null}function ue(){return j}function J(Ce){for(var je=-1,Ge=0;Ge<F.length;Ge++)if(F[Ge].id===Ce){je=Ge;break}return je}function ve(Ce){var je=this;if(Ce!==j){j=Ce;var Ge=fe(j);me.call(this,Ge),ie&&(clearInterval(ie),ie=null),Ge&&Ge.renderingType==="html"&&(le.call(this,Ge,!0),window.ResizeObserver?(X=new window.ResizeObserver(function(){le.call(je,Ge,!0)}),X.observe(p.getElement())):ie=setInterval(le.bind(this,Ge),500))}}function me(Ce){qe.call(this),Ce?Ce.renderingType==="html"?Se.call(this):Me.call(this):Me.call(this)}function Ae(Ce,je){if(!Ce.cues)return!1;for(var Ge=0;Ge<Ce.cues.length;Ge++)if(Ce.cues[Ge].startTime===je.startTime&&Ce.cues[Ge].endTime===je.endTime)return!0;return!1}function be(Ce,je,Ge){var tt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return(isNaN(je)||(tt?Ce.startTime:Ce.endTime)>=je)&&(isNaN(Ge)||(tt?Ce.endTime:Ce.startTime)<=Ge)}function Be(Ce,je,Ge){var tt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;if(Ce.cues)for(var ot=Ce.cues,dt=ot.length-1,gt=dt;gt>=0;gt--)be(ot[gt],je,Ge,tt)&&(ot[gt].onexit&&ot[gt].onexit(),Ce.removeCue(ot[gt]))}function ke(Ce,je,Ge){var tt=fe(Ce);tt&&Be(tt,je,Ge)}function Ye(){for(var Ce=k?k.length:0,je=0;je<Ce;je++){var Ge=fe(je);Ge&&Be.call(this,Ge,C.start,C.start+C.duration,!1)}k=[],F=[],ie&&(clearInterval(ie),ie=null),X&&p&&(X.unobserve(p.getElement()),X=null),j=-1,qe.call(this)}function Le(Ce){p.removeChild(k[Ce]),k.splice(Ce,1)}function Se(){var Ce=document.getElementById("native-cue-style");if(!Ce){Ce=document.createElement("style"),Ce.id="native-cue-style",document.head.appendChild(Ce);var je=Ce.sheet,Ge=p.getElement();try{Ge&&(Ge.id?je.insertRule("#"+Ge.id+"::cue {background: transparent}",0):Ge.classList.length!==0?je.insertRule("."+Ge.className+"::cue {background: transparent}",0):je.insertRule("video::cue {background: transparent}",0))}catch(tt){S.info(""+tt.message)}}}function Me(){var Ce=document.getElementById("native-cue-style");Ce&&document.head.removeChild(Ce)}function qe(){if(Y)for(;Y.firstChild;)Y.removeChild(Y.firstChild)}function it(Ce,je){var Ge=fe(Ce);Ge&&Ge.mode!==je&&(Ge.mode=je),Ge&&Ge.manualMode!==je&&(Ge.manualMode=je)}function at(){return F[j]}return A={initialize:ge,getStreamId:_e,addTextTrack:se,addCaptions:W,createTracks:Z,getCurrentTrackIdx:ue,setCurrentTrackIdx:ve,getTrackIdxForId:J,getCurrentTrackInfo:at,setModeForTrackIdx:it,deleteCuesFromTrackIdx:ke,deleteAllTextTracks:Ye,deleteTextTrack:Le,manualCueProcessing:B,disableManualTracks:G},oe(),A}L.__dashjs_factory_name="TextTracks";const R=_.default.getClassFactory(L)},"./src/streaming/thumbnail/ThumbnailController.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>y});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/constants/Constants.js"),f=r("./src/streaming/vo/Thumbnail.js"),d=r("./src/streaming/thumbnail/ThumbnailTracks.js"),_=r("./src/streaming/vo/BitrateInfo.js"),E=r("./src/dash/utils/SegmentsUtils.js");function c(O){var P=this.context,b=O.streamInfo,L,R;function T(){x(),R=(0,d.default)(P).create({streamInfo:b,adapter:O.adapter,baseURLController:O.baseURLController,timelineConverter:O.timelineConverter,debug:O.debug,eventBus:O.eventBus,events:O.events,dashConstants:O.dashConstants,dashMetrics:O.dashMetrics,segmentBaseController:O.segmentBaseController})}function m(){R.addTracks();var F=R.getTracks();F&&F.length>0&&I(0)}function M(){return b.id}function p(F,k){if(typeof k=="function"){var j=R.getCurrentTrack(),V,Q;if(!j||j.segmentDuration<=0||F===void 0||F===null){k(null);return}Q=R.getThumbnailRequestForTime(F),Q&&(j.segmentDuration=Q.duration),V=F%j.segmentDuration;var $=Math.floor(V*j.tilesHor*j.tilesVert/j.segmentDuration),K=new f.default;if(K.width=Math.floor(j.widthPerTile),K.height=Math.floor(j.heightPerTile),K.x=Math.floor($%j.tilesHor)*j.widthPerTile,K.y=Math.floor($/j.tilesHor)*j.heightPerTile,"readThumbnail"in j)return j.readThumbnail(F,function(re){K.url=re,k(K)});if(Q)K.url=Q.url,j.segmentDuration=NaN;else{var Y=Math.floor(F/j.segmentDuration);K.url=C(j,Y)}k(K)}}function C(F,k){var j=k+F.startNumber,V=(0,E.replaceTokenForTemplate)(F.templateUrl,"Number",j);return V=(0,E.replaceTokenForTemplate)(V,"Time",(j-1)*F.segmentDuration*F.timescale),V=(0,E.replaceTokenForTemplate)(V,"Bandwidth",F.bandwidth),(0,E.unescapeDollarsInTemplate)(V)}function I(F){R.setTrackByIndex(F)}function A(){return R.getCurrentTrackIndex()}function S(){var F=R.getTracks(),k=0;return F.map(function(j){var V=new _.default;return V.mediaType=l.default.IMAGE,V.qualityIndex=k++,V.bitrate=j.bitrate,V.width=j.width,V.height=j.height,V})}function x(){R&&R.reset()}return L={getStreamId:M,initialize:m,provide:p,setTrackByIndex:I,getCurrentTrackIndex:A,getBitrateList:S,reset:x},T(),L}c.__dashjs_factory_name="ThumbnailController";const y=u.default.getClassFactory(c)},"./src/streaming/thumbnail/ThumbnailTracks.js":(h,i,r)=>{r.r(i),r.d(i,{THUMBNAILS_SCHEME_ID_URIS:()=>b,default:()=>R});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/dash/constants/DashConstants.js"),f=r("./src/core/FactoryMaker.js"),d=r("./src/streaming/vo/ThumbnailTrackInfo.js"),_=r("./src/streaming/utils/URLUtils.js"),E=r("./src/dash/utils/SegmentsUtils.js"),c=r("./src/streaming/utils/BoxParser.js"),y=r("./src/streaming/net/XHRLoader.js"),O=r("./src/dash/DashHandler.js"),P=r("./src/dash/controllers/SegmentsController.js"),b=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function L(T){var m=this.context,M=T.adapter,p=T.baseURLController,C=T.streamInfo,I=T.timelineConverter,A=T.debug,S=T.eventBus,x=T.events,F=T.dashConstants,k=(0,_.default)(m).getInstance(),j,V,Q,$,K,Y,re,ie;function ee(){q(),re=(0,y.default)(m).create({}),ie=(0,c.default)(m).getInstance(),Y=(0,P.default)(m).create({events:x,eventBus:S,streamInfo:C,timelineConverter:I,dashConstants:F,dashMetrics:T.dashMetrics,segmentBaseController:T.segmentBaseController,type:u.default.IMAGE}),Q=(0,O.default)(m).create({streamInfo:C,type:u.default.IMAGE,timelineConverter:I,segmentsController:Y,baseURLController:p,debug:A,eventBus:S,events:x,dashConstants:F,urlUtils:k}),Q.initialize(M?M.getIsDynamic():!1)}function ne(){if(!(!C||!M)&&(K=M.getMediaInfoForType(C,u.default.IMAGE),!!K)){var le=M.getVoRepresentations(K);le&&le.length>0&&le.forEach(function(te){(te.segmentInfoType===l.default.SEGMENT_TEMPLATE&&te.segmentDuration>0&&te.media||te.segmentInfoType===l.default.SEGMENT_TIMELINE)&&ae(te),te.segmentInfoType===l.default.SEGMENT_BASE&&ae(te,!0)}),V.length>0&&V.sort(function(te,N){return te.bitrate-N.bitrate})}}function ae(le,te){var N=new d.default;N.id=le.id,N.bitrate=le.bandwidth,N.width=le.width,N.height=le.height,N.tilesHor=1,N.tilesVert=1,le.essentialProperties&&le.essentialProperties.forEach(function(D){if(b.indexOf(D.schemeIdUri)>=0&&D.value){var w=D.value.split("x");w.length===2&&!isNaN(w[0])&&!isNaN(w[1])&&(N.tilesHor=parseInt(w[0],10),N.tilesVert=parseInt(w[1],10))}}),te?Y.updateSegmentData(le).then(function(D){ce(N,le,D)}):(N.startNumber=le.startNumber,N.segmentDuration=le.segmentDuration,N.timescale=le.timescale,N.templateUrl=oe(le)),N.tilesHor>0&&N.tilesVert>0&&(N.widthPerTile=N.width/N.tilesHor,N.heightPerTile=N.height/N.tilesVert,V.push(N))}function ce(le,te,N){var D=[],w=X(N,te);te.segments=w,le.segmentDuration=te.segments[0].duration,le.readThumbnail=function(W,H){var U=null;D.some(function(B){if(B.start<=W&&B.end>W)return U=B.url,!0}),U?H(U):te.segments.some(function(B){if(B.mediaStartTime<=W&&B.mediaStartTime+B.duration>W){var G=p.resolve(te.path);return re.load({method:"get",url:G.url,request:{range:B.mediaRange,responseType:"arraybuffer"},onload:function(fe){var ue=ie.getSamplesInfo(fe.target.response),J=new Blob([fe.target.response.slice(ue.sampleList[0].offset,ue.sampleList[0].offset+ue.sampleList[0].size)],{type:"image/jpeg"}),ve=window.URL.createObjectURL(J);D.push({start:B.mediaStartTime,end:B.mediaStartTime+B.duration,url:ve}),H&&H(ve)}}),!0}})}}function X(le,te){var N=[],D=0,w,W,H,U;for(w=0,W=le.segments.length;w<W;w++)H=le.segments[w],U=(0,E.getTimeBasedSegment)(I,M.getIsDynamic(),te,H.startTime,H.duration,H.timescale,H.media,H.mediaRange,D),U&&(N.push(U),U=null,D++);return N}function oe(le){var te=k.isRelative(le.media)?k.resolve(le.media,p.resolve(le.path).url):le.media;return te?(0,E.replaceIDForTemplate)(te,le.id):""}function ge(){return V}function _e(){return $}function he(){return $<0?null:V[$]}function se(le){!V||V.length===0||(le>=V.length&&(le=V.length-1),$=le)}function Z(le){for(var te,N=M.getVoRepresentations(K),D=0;D<N.length;D++)if(V[$].id===N[D].id){te=N[D];break}return Q.getSegmentRequestForTime(K,te,le)}function q(){V=[],$=-1,K=null}return j={getTracks:ge,addTracks:ne,reset:q,setTrackByIndex:se,getCurrentTrack:he,getCurrentTrackIndex:_e,getThumbnailRequestForTime:Z},ee(),j}L.__dashjs_factory_name="ThumbnailTracks";const R=f.default.getClassFactory(L)},"./src/streaming/utils/BaseURLSelector.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/core/errors/Errors.js"),l=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js"),d=r("./src/streaming/controllers/BlacklistController.js"),_=r("./src/streaming/utils/baseUrlResolution/DVBSelector.js"),E=r("./src/streaming/utils/baseUrlResolution/BasicSelector.js"),c=r("./src/core/FactoryMaker.js"),y=r("./src/streaming/vo/DashJSError.js"),O=r("./src/streaming/utils/SupervisorTools.js"),P=r("./src/streaming/utils/baseUrlResolution/ContentSteeringSelector.js"),b=r("./src/core/Settings.js");function L(){var T=this.context,m=(0,l.default)(T).getInstance(),M=(0,b.default)(T).getInstance(),p,C,I,A,S,x;function F(){C=(0,d.default)(T).create({updateEventName:f.default.SERVICE_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:f.default.SERVICE_LOCATION_BLACKLIST_ADD}),I=(0,E.default)(T).create({blacklistController:C}),A=(0,_.default)(T).create({blacklistController:C}),S=(0,P.default)(T).create(),S.setConfig({blacklistController:C}),x=I}function k($){$.selector&&(x=$.selector),$.contentSteeringSelector&&(S=$.contentSteeringSelector)}function j($){(0,O.checkParameterType)($,"boolean"),x=$?A:I}function V($){if($){if(M.get().streaming.applyContentSteering){var K=S.selectBaseUrlIndex($);!isNaN(K)&&K!==-1&&($.selectedIdx=K)}if(!isNaN($.selectedIdx))return $.baseUrls[$.selectedIdx];var Y=x.select($.baseUrls);if(!Y){m.trigger(f.default.URL_RESOLUTION_FAILED,{error:new y.default(u.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,u.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),x===I&&Q();return}return $.selectedIdx=$.baseUrls.indexOf(Y),Y}}function Q(){C.reset()}return p={chooseSelector:j,select:V,reset:Q,setConfig:k},F(),p}L.__dashjs_factory_name="BaseURLSelector";const R=c.default.getClassFactory(L)},"./src/streaming/utils/BoxParser.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>c});var u=r("./src/core/Debug.js"),l=r("./src/streaming/utils/IsoFile.js"),f=r("./src/core/FactoryMaker.js"),d=r("./node_modules/codem-isoboxer/dist/iso_boxer.js"),_=r("./src/streaming/vo/IsoBoxSearchInfo.js");function E(){var y,O,P=this.context;function b(){y=(0,u.default)(P).getInstance().getLogger(O)}function L(A){if(!A)return null;A.fileStart===void 0&&(A.fileStart=0);var S=d.parseBuffer(A),x=(0,l.default)(P).create();return x.setData(S),x}function R(A,S,x){if(x===void 0&&(x=0),!S||x+8>=S.byteLength)return new _.default(0,!1);for(var F=S instanceof ArrayBuffer?new Uint8Array(S):S,k,j=0;x<F.byteLength;){var V=M(F,x),Q=p(F,x+4);if(V===0)break;x+V<=F.byteLength&&(A.indexOf(Q)>=0?k=new _.default(x,!0,V):j=x+V),x+=V}return k||new _.default(j,!1)}function T(A){if(!A||A.byteLength===0)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var S=L(A),x=S.getBoxes("moof"),F=S.getBoxes("mfhd"),k,j,V,Q,$,K,Y,re,ie,ee,ne,ae,ce,X,oe,ge,_e;ge=S.getBoxes("moof").length,oe=F[F.length-1].sequence_number,V=0,K=[];var he=-1,se=-1;for(ne=0;ne<x.length;ne++){var Z=x[ne],q=Z.getChildBoxes("traf");for(ie=0;ie<q.length;ie++){var le=q[ie],te=le.getChildBox("tfhd"),N=le.getChildBox("tfdt");$=N.baseMediaDecodeTime;var D=le.getChildBoxes("trun"),w=le.getChildBoxes("subs");for(ee=0;ee<D.length;ee++){var W=D[ee];for(V=W.sample_count,X=(te.base_data_offset||0)+(W.data_offset||0),re=0;re<V;re++){Y=W.samples[re],k=Y.sample_duration!==void 0?Y.sample_duration:te.default_sample_duration,Q=Y.sample_size!==void 0?Y.sample_size:te.default_sample_size,j=Y.sample_composition_time_offset!==void 0?Y.sample_composition_time_offset:0;var H={dts:$,cts:$+j,duration:k,offset:Z.offset+X,size:Q,subSizes:[Q]};if(w)for(ae=0;ae<w.length;ae++){var U=w[ae];if(he<U.entry_count-1&&re>se&&(he++,se+=U.entries[he].sample_delta),re==se){H.subSizes=[];var B=U.entries[he];for(ce=0;ce<B.subsample_count;ce++)H.subSizes.push(B.subsamples[ce].subsample_size)}}K.push(H),X+=Q,$+=k}}_e=$-N.baseMediaDecodeTime}}return{sampleList:K,lastSequenceNumber:oe,totalDuration:_e,numSequences:ge}}function m(A){var S=L(A),x=S?S.getBox("mdhd"):void 0;return x?x.timescale:NaN}function M(A,S){return A[S+3]>>>0|A[S+2]<<8>>>0|A[S+1]<<16>>>0|A[S]<<24>>>0}function p(A,S){return String.fromCharCode(A[S++])+String.fromCharCode(A[S++])+String.fromCharCode(A[S++])+String.fromCharCode(A[S])}function C(A){var S=null,x,F,k=L(A);if(!k)return S;var j=k.getBox("ftyp"),V=k.getBox("moov");return y.debug("Searching for initialization."),V&&V.isComplete&&(x=j?j.offset:V.offset,F=V.offset+V.size-1,S=x+"-"+F,y.debug("Found the initialization.  Range: "+S)),S}function I(A,S,x){if(x===void 0&&(x=0),!S||x+8>=S.byteLength)return new _.default(0,!1);for(var F=S instanceof ArrayBuffer?new Uint8Array(S):S,k,j=0;x<F.byteLength;){var V=M(F,x),Q=p(F,x+4);if(V===0)break;x+V<=F.byteLength&&(A.indexOf(Q)>=0?k=new _.default(x,!0,V,Q):j=x+V),x+=V}return k||new _.default(j,!1)}return O={parse:L,findLastTopIsoBoxCompleted:R,getMediaTimescaleFromMoov:m,getSamplesInfo:T,findInitRange:C,parsePayload:I},b(),O}E.__dashjs_factory_name="BoxParser";const c=f.default.getSingletonFactory(E)},"./src/streaming/utils/Capabilities.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>c,supportsMediaSource:()=>_});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/thumbnail/ThumbnailTracks.js"),f=r("./src/streaming/constants/Constants.js"),d=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function _(){var y="WebKitMediaSource"in window,O="MediaSource"in window;return y||O}function E(){var y,O,P;function b(){P=!1}function L(S){S&&S.settings&&(O=S.settings)}function R(){return P}function T(S){P=S}function m(S,x){return x!==f.default.AUDIO&&x!==f.default.VIDEO?Promise.resolve(!0):M(S,x)?C(S,x):p(S)}function M(S,x){return O.get().streaming.capabilities.useMediaCapabilitiesApi&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo&&(S.codec&&x===f.default.AUDIO||x===f.default.VIDEO&&S.codec&&S.width&&S.height&&S.bitrate&&S.framerate)}function p(S){return new Promise(function(x){if(!S||!S.codec){x(!1);return}var F=S.codec;if(S.width&&S.height&&(F+=';width="'+S.width+'";height="'+S.height+'"'),"MediaSource"in window&&MediaSource.isTypeSupported(F)){x(!0);return}else if("WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(F)){x(!0);return}x(!1)})}function C(S,x){return new Promise(function(F){if(!S||!S.codec){F(!1);return}var k={type:"media-source"};k[x]={},k[x].contentType=S.codec,k[x].width=S.width,k[x].height=S.height,k[x].bitrate=parseInt(S.bitrate),k[x].framerate=parseFloat(S.framerate),navigator.mediaCapabilities.decodingInfo(k).then(function(j){F(j.supported)}).catch(function(){F(!1)})})}function I(S){try{return l.THUMBNAILS_SCHEME_ID_URIS.indexOf(S.schemeIdUri)!==-1}catch{return!0}}function A(S,x){for(var F=S.split(".")[0],k=x.indexOf(F)===0,j,V=0;V<d.length;V++)if(d[V].codec===F){j=d[V];break}return j?k||j.compatibleCodecs.some(function(Q){return x.indexOf(Q)===0}):k}return y={setConfig:L,supportsMediaSource:_,supportsEncryptedMedia:R,supportsCodec:m,setEncryptedMediaSupported:T,supportsEssentialProperty:I,codecRootCompatibleWithCodec:A},b(),y}E.__dashjs_factory_name="Capabilities";const c=u.default.getSingletonFactory(E)},"./src/streaming/utils/CapabilitiesFilter.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>c});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),f=r("./src/streaming/constants/Constants.js"),d=r("./src/core/EventBus.js"),_=r("./src/core/events/Events.js");function E(){var y=this.context,O=(0,d.default)(y).getInstance(),P,b,L,R,T,m;function M(){m=(0,l.default)(y).getInstance().getLogger(P)}function p(Q){Q&&(Q.adapter&&(b=Q.adapter),Q.capabilities&&(L=Q.capabilities),Q.settings&&(R=Q.settings),Q.customParametersModel&&(T=Q.customParametersModel))}function C(Q){return new Promise(function($){var K=[];K.push(I(f.default.VIDEO,Q)),K.push(I(f.default.AUDIO,Q)),Promise.all(K).then(function(){R.get().streaming.capabilities.filterUnsupportedEssentialProperties&&j(Q),V(Q),$()}).catch(function(){$()})})}function I(Q,$){if(!$||!$.Period_asArray||$.Period_asArray.length===0)return Promise.resolve();var K=[];return $.Period_asArray.forEach(function(Y){K.push(A(Y,Q))}),Promise.all(K)}function A(Q,$){return new Promise(function(K){if(!Q||!Q.AdaptationSet_asArray||Q.AdaptationSet_asArray.length===0){K();return}var Y=[];Q.AdaptationSet_asArray.forEach(function(re){b.getIsTypeOf(re,$)&&Y.push(S(re,$))}),Promise.all(Y).then(function(){Q.AdaptationSet_asArray=Q.AdaptationSet_asArray.filter(function(re){var ie=re.Representation_asArray&&re.Representation_asArray.length>0;return ie||(O.trigger(_.default.ADAPTATION_SET_REMOVED_NO_CAPABILITIES,{adaptationSet:re}),m.warn("AdaptationSet has been removed because of no supported Representation")),ie}),K()}).catch(function(){K()})})}function S(Q,$){return new Promise(function(K){if(!Q.Representation_asArray||Q.Representation_asArray.length===0){K();return}var Y=[],re=[];Q.Representation_asArray.forEach(function(ie,ee){var ne=b.getCodec(Q,ee,!1),ae=x($,ie,ne);re.push(ae),Y.push(L.supportsCodec(ae,$))}),Promise.all(Y).then(function(ie){Q.Representation_asArray=Q.Representation_asArray.filter(function(ee,ne){return ie[ne]||m.debug("[Stream] Codec ".concat(re[ne].codec," not supported ")),ie[ne]}),K()}).catch(function(){K()})})}function x(Q,$,K){switch(Q){case f.default.VIDEO:return F($,K);case f.default.AUDIO:return k($,K);default:return null}}function F(Q,$){var K=Q.width||null,Y=Q.height||null,re=Q.frameRate||null,ie=Q.bandwidth||null;return{codec:$,width:K,height:Y,framerate:re,bitrate:ie}}function k(Q,$){var K=Q.audioSamplingRate||null,Y=Q.bandwidth||null;return{codec:$,bitrate:Y,samplerate:K}}function j(Q){!Q||!Q.Period_asArray||Q.Period_asArray.length===0||Q.Period_asArray.forEach(function($){$.AdaptationSet_asArray=$.AdaptationSet_asArray.filter(function(K){return!K.Representation_asArray||K.Representation_asArray.length===0?!0:(K.Representation_asArray=K.Representation_asArray.filter(function(Y){var re=b.getEssentialPropertiesForRepresentation(Y);if(re&&re.length>0)for(var ie=0;ie<re.length;){if(!L.supportsEssentialProperty(re[ie]))return m.debug("[Stream] EssentialProperty not supported: "+re[ie].schemeIdUri),!1;ie+=1}return!0}),K.Representation_asArray&&K.Representation_asArray.length>0)})})}function V(Q){var $=T.getCustomCapabilitiesFilters();!$||$.length===0||!Q||!Q.Period_asArray||Q.Period_asArray.length===0||Q.Period_asArray.forEach(function(K){K.AdaptationSet_asArray=K.AdaptationSet_asArray.filter(function(Y){return!Y.Representation_asArray||Y.Representation_asArray.length===0?!0:(Y.Representation_asArray=Y.Representation_asArray.filter(function(re){return!$.some(function(ie){return!ie(re)})}),Y.Representation_asArray&&Y.Representation_asArray.length>0)})})}return P={setConfig:p,filterUnsupportedFeatures:C},M(),P}E.__dashjs_factory_name="CapabilitiesFilter";const c=u.default.getSingletonFactory(E)},"./src/streaming/utils/CustomTimeRanges.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/utils/SupervisorTools.js");function f(){var _=[],E=0;function c(R,T){var m=0;for(m=0;m<this.customTimeRangeArray.length&&R>this.customTimeRangeArray[m].start;m++);for(this.customTimeRangeArray.splice(m,0,{start:R,end:T}),m=0;m<this.customTimeRangeArray.length-1;m++)this.mergeRanges(m,m+1)&&m--;this.length=this.customTimeRangeArray.length}function y(){this.customTimeRangeArray=[],this.length=0}function O(R,T){for(var m=0;m<this.customTimeRangeArray.length;m++)if(R<=this.customTimeRangeArray[m].start&&T>=this.customTimeRangeArray[m].end)this.customTimeRangeArray.splice(m,1),m--;else if(R>this.customTimeRangeArray[m].start&&T<this.customTimeRangeArray[m].end){this.customTimeRangeArray.splice(m+1,0,{start:T,end:this.customTimeRangeArray[m].end}),this.customTimeRangeArray[m].end=R;break}else R>this.customTimeRangeArray[m].start&&R<this.customTimeRangeArray[m].end?this.customTimeRangeArray[m].end=R:T>this.customTimeRangeArray[m].start&&T<this.customTimeRangeArray[m].end&&(this.customTimeRangeArray[m].start=T);this.length=this.customTimeRangeArray.length}function P(R,T){var m=this.customTimeRangeArray[R],M=this.customTimeRangeArray[T];return m.start<=M.start&&M.start<=m.end&&m.end<=M.end?(m.end=M.end,this.customTimeRangeArray.splice(T,1),!0):M.start<=m.start&&m.start<=M.end&&M.end<=m.end?(m.start=M.start,this.customTimeRangeArray.splice(T,1),!0):M.start<=m.start&&m.start<=M.end&&m.end<=M.end?(this.customTimeRangeArray.splice(R,1),!0):m.start<=M.start&&M.start<=m.end&&M.end<=m.end?(this.customTimeRangeArray.splice(T,1),!0):!1}function b(R){return(0,l.checkInteger)(R),R>=this.customTimeRangeArray.length||R<0?NaN:this.customTimeRangeArray[R].start}function L(R){return(0,l.checkInteger)(R),R>=this.customTimeRangeArray.length||R<0?NaN:this.customTimeRangeArray[R].end}return{customTimeRangeArray:_,length:E,add:c,clear:y,remove:O,mergeRanges:P,start:b,end:L}}f.__dashjs_factory_name="CustomTimeRanges";const d=u.default.getClassFactory(f)},"./src/streaming/utils/DOMStorage.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),f=r("./src/streaming/constants/Constants.js"),d=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],_="dashjs_?_bitrate",E="dashjs_?_settings",c="localStorage",y="sessionStorage",O="lastBitrate",P="lastMediaSettings";function b(T){T=T||{};var m=this.context,M=T.settings,p,C,I;function A(){C=(0,l.default)(m).getInstance().getLogger(p),x()}function S(Y){if(I!==void 0)return I;I=!1;var re="1",ie="1",ee;try{typeof window<"u"&&(ee=window[Y])}catch(ne){return C.warn("DOMStorage access denied: "+ne.message),I}if(!ee||Y!==c&&Y!==y)return I;try{ee.setItem(re,ie),ee.removeItem(re),I=!0}catch(ne){C.warn("DOMStorage is supported, but cannot be used: "+ne.message)}return I}function x(){S(c)&&d.forEach(function(Y){var re=localStorage.getItem(Y.oldKey);if(re){localStorage.removeItem(Y.oldKey);try{localStorage.setItem(Y.newKey,re)}catch(ie){C.error(ie.message)}}})}function F(){var Y=6e5;return Math.round(new Date().getTime()/Y)*Y}function k(Y,re){return S(Y)&&M.get().streaming[re+"CachingInfo"].enabled}function j(){if(!M)throw new Error(f.default.MISSING_CONFIG_ERROR)}function V(Y){if(j(),!M.get().streaming.lastMediaSettingsCachingInfo.enabled)return null;var re=null;if(k(c,P)){var ie=E.replace(/\?/,Y);try{var ee=JSON.parse(localStorage.getItem(ie))||{},ne=new Date().getTime()-parseInt(ee.timestamp,10)>=M.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;re=ee.settings,ne&&(localStorage.removeItem(ie),re=null)}catch{return null}}return re}function Q(Y){if(j(),!M.get().streaming.lastBitrateCachingInfo.enabled)return NaN;var re=NaN;if(k(c,O)){var ie=_.replace(/\?/,Y);try{var ee=JSON.parse(localStorage.getItem(ie))||{},ne=new Date().getTime()-parseInt(ee.timestamp,10)>=M.get().streaming.lastBitrateCachingInfo.ttl||!1,ae=parseFloat(ee.bitrate);!isNaN(ae)&&!ne?(re=ae,C.debug("Last saved bitrate for "+Y+" was "+ae)):ne&&localStorage.removeItem(ie)}catch{return null}}return re}function $(Y,re){if(k(c,P)){var ie=E.replace(/\?/,Y);try{localStorage.setItem(ie,JSON.stringify({settings:re,timestamp:F()}))}catch(ee){C.error(ee.message)}}}function K(Y,re){if(k(c,O)&&re){var ie=_.replace(/\?/,Y);try{localStorage.setItem(ie,JSON.stringify({bitrate:re.toFixed(3),timestamp:F()}))}catch(ee){C.error(ee.message)}}}return p={getSavedBitrateSettings:Q,setSavedBitrateSettings:K,getSavedMediaSettings:V,setSavedMediaSettings:$},A(),p}b.__dashjs_factory_name="DOMStorage";var L=u.default.getSingletonFactory(b);const R=L},"./src/streaming/utils/DefaultURLUtils.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/core/FactoryMaker.js");function l(){var d,_=/^[a-z][a-z0-9+\-_.]*:/i,E=/^https?:\/\//i,c=/^https:\/\//i,y=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,O=function(k,j){try{return new window.URL(k,j).toString()}catch{return k}},P=function(k,j){var V=L;if(!j||!M(k))return k;p(k)&&(V=R),C(k)&&(V=m);var Q=V(j),$=Q.charAt(Q.length-1)!=="/"&&k.charAt(0)!=="/"?"/":"";return[Q,k].join($)};function b(){try{var F=new window.URL("x","http://y");d=O}catch{}finally{d=d||P}}function L(F){var k=F.indexOf("/"),j=F.lastIndexOf("/");return k!==-1?j===k+1?F:(F.indexOf("?")!==-1&&(F=F.substring(0,F.indexOf("?"))),F.substring(0,j+1)):""}function R(F){var k=F.match(y);return k?k[1]:""}function T(F){var k=/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(F);return k[2].substring(1)}function m(F){var k=F.match(_);return k?k[0]:""}function M(F){return!_.test(F)}function p(F){return M(F)&&F.charAt(0)==="/"}function C(F){return F.indexOf("//")===0}function I(F){return E.test(F)}function A(F){return c.test(F)}function S(F,k){return d(F,k)}b();var x={parseBaseUrl:L,parseOrigin:R,parseScheme:m,isRelative:M,isPathAbsolute:p,isSchemeRelative:C,isHTTPURL:I,isHTTPS:A,removeHostname:T,resolve:S};return x}l.__dashjs_factory_name="DefaultURLUtils";const f=u.default.getSingletonFactory(l)},"./src/streaming/utils/EBMLParser.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/core/FactoryMaker.js");function l(d){d=d||{};var _,E=new DataView(d.data),c=0;function y(){return c}function O(C){c=C}function P(C,I){var A=!0,S=0,x,F;if(I===void 0&&(I=!1),C.tag>16777215?(E.getUint32(c)!==C.tag&&(A=!1),S=4):C.tag>65535?(x=E.getUint16(c),F=E.getUint8(c+2),x*256+F!==C.tag&&(A=!1),S=3):C.tag>255?(E.getUint16(c)!==C.tag&&(A=!1),S=2):(E.getUint8(c)!==C.tag&&(A=!1),S=1),!A&&C.required&&!I)throw new Error("required tag not found");return A&&(c+=S),A}function b(C,I){var A=P(C,I);return A&&T(),A}function L(C){var I;return P(C),I=T(),_[C.parse](I)}function R(C,I){var A=P(C,I),S;return A&&(S=T(),c+=S),A}function T(C){var I=1,A=128,S=8,x=-1,F=0,k=E.getUint8(c),j=0;for(j=0;j<S;j+=1){if((k&A)===A){F=C===void 0?k&~A:k,x=j;break}A>>=1}for(j=0;j<x;j+=1,I+=1)F=F<<8|255&E.getUint8(c+I);return c+=I,F}function m(C){var I;switch(C){case 4:I=E.getFloat32(c),c+=4;break;case 8:I=E.getFloat64(c),c+=8;break}return I}function M(C){for(var I=0,A=0;A<C;A+=1)I<<=8,I|=E.getUint8(c+A)&255;return c+=C,I}function p(){return c<E.byteLength}return _={getPos:y,setPos:O,consumeTag:P,consumeTagAndSize:b,parseTag:L,skipOverElement:R,getMatroskaCodedNum:T,getMatroskaFloat:m,getMatroskaUint:M,moreData:p},_}l.__dashjs_factory_name="EBMLParser";const f=u.default.getClassFactory(l)},"./src/streaming/utils/ErrorHandler.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),f=r("./src/core/FactoryMaker.js");function d(){var E,c=this.context,y=(0,u.default)(c).getInstance();function O(P){y.trigger(l.default.ERROR,{error:P})}return E={error:O},E}d.__dashjs_factory_name="ErrorHandler";const _=f.default.getSingletonFactory(d)},"./src/streaming/utils/InitCache.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/core/FactoryMaker.js");function l(){var d={};function _(O){var P=O.streamId,b=O.representationId;d[P]=d[P]||{},d[P][b]=O}function E(O,P){return d&&d[O]&&d[O][P]?d[O][P]:null}function c(){d={}}var y={save:_,extract:E,reset:c};return y}l.__dashjs_factory_name="InitCache";const f=u.default.getSingletonFactory(l)},"./src/streaming/utils/IsoFile.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/streaming/vo/IsoBox.js"),l=r("./src/core/FactoryMaker.js");function f(){var _,E;function c(L){return!L||!E||!E.boxes||E.boxes.length===0||typeof E.fetch!="function"?null:b(E.fetch(L))}function y(L){var R=[];if(!L||!E||typeof E.fetchAll!="function")return R;for(var T=E.fetchAll(L),m,M=0,p=T.length;M<p;M++)m=b(T[M]),m&&R.push(m);return R}function O(L){E=L}function P(){if(!E||!E.boxes||!E.boxes.length)return null;var L=E.boxes[E.boxes.length-1].type,R=y(L);return R.length>0?R[R.length-1]:null}function b(L){if(!L)return null;var R=new u.default(L);return L.hasOwnProperty("_incomplete")&&(R.isComplete=!L._incomplete),R}return _={getBox:c,getBoxes:y,setData:O,getLastBox:P},_}f.__dashjs_factory_name="IsoFile";const d=l.default.getClassFactory(f)},"./src/streaming/utils/ObjectUtils.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/FactoryMaker.js"),l=r("./node_modules/fast-deep-equal/index.js"),f=r.n(l);function d(){var E;function c(y,O){return f()(y,O)}return E={areEqual:c},E}d.__dashjs_factory_name="ObjectUtils";const _=u.default.getSingletonFactory(d)},"./src/streaming/utils/RequestModifier.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d,modifyRequest:()=>l});var u=r("./src/core/FactoryMaker.js");function l(_,E){var c={url:_.url,method:_.method,headers:Object.assign({},_.headers),credentials:_.withCredentials?"include":void 0};return Promise.resolve(E.modifyRequest(c)).then(function(){return Object.assign(_,c,{withCredentials:c.credentials==="include"})})}function f(){var _;function E(y){return y}function c(y,O){return O.url,y}return _={modifyRequest:null,modifyRequestURL:E,modifyRequestHeader:c},_}f.__dashjs_factory_name="RequestModifier";const d=u.default.getSingletonFactory(f)},"./src/streaming/utils/SegmentResponseModifier.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/core/FactoryMaker.js");function l(){var d;function _(E){return Promise.resolve(E)}return d={modifyResponseAsync:_},d}l.__dashjs_factory_name="SegmentResponseModifier";const f=u.default.getSingletonFactory(l)},"./src/streaming/utils/SupervisorTools.js":(h,i,r)=>{r.r(i),r.d(i,{checkInteger:()=>d,checkIsVideoOrAudioType:()=>E,checkParameterType:()=>f,checkRange:()=>_});var u=r("./src/streaming/constants/Constants.js");function l(c){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(O){return typeof O}:l=function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},l(c)}function f(c,y){if(l(c)!==y)throw u.default.BAD_ARGUMENT_ERROR}function d(c){var y=c!==null&&!isNaN(c)&&c%1===0;if(!y)throw u.default.BAD_ARGUMENT_ERROR+" : argument is not an integer"}function _(c,y,O){if(c<y||c>O)throw u.default.BAD_ARGUMENT_ERROR+" : argument out of range"}function E(c){if(typeof c!="string"||c!==u.default.AUDIO&&c!==u.default.VIDEO)throw u.default.BAD_ARGUMENT_ERROR}},"./src/streaming/utils/TTMLParser.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>O});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),f=r("./src/core/EventBus.js"),d=r("./src/core/events/Events.js"),_=r("./node_modules/imsc/src/main/js/main.js"),E=r("./src/streaming/MediaPlayerEvents.js"),c=r("./src/streaming/constants/ConformanceViolationConstants.js");function y(){var P=this.context,b=(0,f.default)(P).getInstance(),L,R,T=0;function m(){R=(0,l.default)(P).getInstance().getLogger(L)}function M(){var C="cue_TTML_"+T;return T++,C}function p(C,I,A,S,x){var F="",k=[],j,V,Q,$={},K={},Y="",re="",ie={onOpenTag:function(X,oe,ge){if(ge[" imagetype"]&&!ge[" imageType"]&&(b.trigger(E.default.CONFORMANCE_VIOLATION,{level:c.default.LEVELS.ERROR,event:c.default.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),ge[" imageType"]=ge[" imagetype"]),oe==="image"&&(X==="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"||X==="http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt")){if(!ge[" imageType"]||ge[" imageType"].value!=="PNG"){R.warn("smpte-tt imageType != PNG. Discarded");return}Y=ge["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){Y&&(K[Y]=re.trim()),re="",Y=""},onText:function(X){Y&&(re=re+X)}};if(!C)throw F="no ttml data to parse",new Error(F);$.data=C,b.trigger(d.default.TTML_TO_PARSE,$);var ee=(0,_.fromXML)($.data,function(ce){F=ce},ie);b.trigger(d.default.TTML_PARSED,{ttmlString:$.data,ttmlDoc:ee});var ne=ee.getMediaTimeEvents();for(Q=0;Q<ne.length;Q++){var ae=(0,_.generateISD)(ee,ne[Q],function(ce){F=ce});ae.contents.some(function(ce){return ce.contents.length})&&(j=ne[Q]+I<A?A:ne[Q]+I,V=ne[Q+1]+I>S?S:ne[Q+1]+I,j<V&&k.push({start:j,end:V,type:"html",cueID:M(),isd:ae,images:x,embeddedImages:K}))}if(F!=="")throw R.error(F),new Error(F);return k}return L={parse:p},m(),L}y.__dashjs_factory_name="TTMLParser";const O=u.default.getSingletonFactory(y)},"./src/streaming/utils/URLUtils.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/utils/DefaultURLUtils.js");function f(){var E,c,y=[],O=this.context;function P(k){var j;for(j=0;j<y.length;j++){var V=y[j].regex;if(V.test(k))return y[j].utils}return c}function b(){c=(0,l.default)(O).getInstance()}function L(k,j){y.push({regex:k,utils:j})}function R(k,j,V){var Q=P(V||j);return Q&&typeof Q[k]=="function"?Q[k](j,V):c[k](j,V)}function T(k){return R("parseBaseUrl",k)}function m(k){return R("parseOrigin",k)}function M(k){return R("removeHostname",k)}function p(k){return R("parseScheme",k)}function C(k){return R("isRelative",k)}function I(k){return R("isPathAbsolute",k)}function A(k){return R("isSchemeRelative",k)}function S(k){return R("isHTTPURL",k)}function x(k){return R("isHTTPS",k)}function F(k,j){return R("resolve",k,j)}return b(),E={registerUrlRegex:L,parseBaseUrl:T,parseOrigin:m,parseScheme:p,isRelative:C,isPathAbsolute:I,isSchemeRelative:A,isHTTPURL:S,isHTTPS:x,removeHostname:M,resolve:F},E}f.__dashjs_factory_name="URLUtils";var d=u.default.getSingletonFactory(f);const _=d},"./src/streaming/utils/VTTParser.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});var u=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),f="WEBVTT";function d(){var E=this.context,c,y,O,P,b,L;function R(){y=(0,l.default)(E).getInstance().getLogger(c),O=/(?:\r\n|\r|\n)/gm,P=/-->/,b=/(^[\s]+|[\s]+$)/g,L=/\s\b/g}function T(I){var A=[],S,x;if(!I)return A;I=I.split(O),S=I.length,x=-1;for(var F=0;F<S;F++){var k=I[F];if(k.length>0&&k!==f&&k.match(P)){var j=M(k),V=j.cuePoints,Q=j.styles,$=C(I,F+1),K=m(V[0].replace(b,"")),Y=m(V[1].replace(b,""));!isNaN(K)&&!isNaN(Y)&&K>=x&&Y>K?$!==""?(x=K,A.push({start:K,end:Y,data:$,styles:Q})):y.error("Skipping cue due to empty/malformed cue text"):y.error("Skipping cue due to incorrect cue timing")}}return A}function m(I){var A=I.split(":"),S=A.length-1;return I=parseInt(A[S-1],10)*60+parseFloat(A[S]),S===2&&(I+=parseInt(A[0],10)*3600),I}function M(I){var A=I.split(P),S=A[1].split(L);return S.shift(),A[1]=S[0],S.shift(),{cuePoints:A,styles:p(S)}}function p(I){var A={};return I.forEach(function(S){if(S.split(/:/).length>1){var x=S.split(/:/)[1];x&&x.search(/%/)!=-1&&(x=parseInt(x.replace(/%/,""),10)),(S.match(/align/)||S.match(/A/))&&(A.align=x),(S.match(/line/)||S.match(/L/))&&(A.line=x),(S.match(/position/)||S.match(/P/))&&(A.position=x),(S.match(/size/)||S.match(/S/))&&(A.size=x)}}),A}function C(I,A){for(var S=A,x="",F="",k;I[S]!==""&&S<I.length;)S++;if(k=S-A,k>1)for(var j=0;j<k;j++)if(F=I[A+j],!F.match(P))x+=F,j!==k-1&&(x+=`
`);else{x="";break}else F=I[A],F.match(P)||(x=F);return x}return c={parse:T},R(),c}d.__dashjs_factory_name="VTTParser";const _=u.default.getSingletonFactory(d)},"./src/streaming/utils/VttCustomRenderingParser.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/core/FactoryMaker.js");function l(){var d,_;function E(){try{window&&window.WebVTT&&window.WebVTT.Parser&&(_=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()))}catch{}}function c(y){var O=[];return _.oncue=function(P){P.start=P.startTime,P.end=P.endTime,P.data=P.text,P.styles={align:P.align,line:P.line,position:P.position,size:P.size},O.push(P)},_.parse(y),O}return d={parse:c},E(),d}l.__dashjs_factory_name="VttCustomRenderingParser";const f=u.default.getSingletonFactory(l)},"./src/streaming/utils/baseUrlResolution/BasicSelector.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/core/FactoryMaker.js");function l(d){d=d||{};var _,E=d.blacklistController;function c(y){var O=0,P;return y&&y.some(function(b,L){return O=L,!E.contains(b.serviceLocation)})&&(P=y[O]),P}return _={select:c},_}l.__dashjs_factory_name="BasicSelector";const f=u.default.getClassFactory(l)},"./src/streaming/utils/baseUrlResolution/ContentSteeringSelector.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/core/FactoryMaker.js"),l=r("./src/dash/controllers/ContentSteeringController.js");function f(){var _=this.context,E,c,y;function O(){c=(0,l.default)(_).getInstance()}function P(R){R.blacklistController&&(y=R.blacklistController),R.contentSteeringController&&(c=R.contentSteeringController)}function b(R){var T=NaN;if(isNaN(R.selectedIdx)){var m=c.getSteeringDataFromManifest();m&&m.defaultServiceLocation&&(T=L([m.defaultServiceLocation],R.baseUrls))}var M=c.getCurrentSteeringResponseData();return R.baseUrls&&R.baseUrls.length&&M&&M.serviceLocationPriority&&M.serviceLocationPriority.length&&(T=L(M.serviceLocationPriority,R.baseUrls)),T}function L(){for(var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],m=0,M=NaN,p=function(){var A=R[m],S=T.findIndex(function(x){return x.serviceLocation&&x.serviceLocation===A});if(S!==-1&&!y.contains(T[S].serviceLocation))return M=S,"break";m+=1};m<R.length;){var C=p();if(C==="break")break}return M}return E={selectBaseUrlIndex:b,setConfig:P},O(),E}f.__dashjs_factory_name="ContentSteeringSelector";const d=u.default.getClassFactory(f)},"./src/streaming/utils/baseUrlResolution/DVBSelector.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});var u=r("./src/core/FactoryMaker.js");function l(d){d=d||{};var _,E=d.blacklistController;function c(P){var b=[],L=function(m){return!(b.length&&m.dvb_priority&&b.indexOf(m.dvb_priority)!==-1)},R=function(m){return E.contains(m.serviceLocation)?(m.dvb_priority&&b.push(m.dvb_priority),!1):!0};return P.filter(R).filter(L)}function y(P){var b=function(I,A){var S=I.dvb_priority-A.dvb_priority;return isNaN(S)?0:S},L=function(I,A,S){return!A||S[0].dvb_priority&&I.dvb_priority&&S[0].dvb_priority===I.dvb_priority},R=0,T=[],m=0,M,p;if(p=P.sort(b).filter(L),p.length)return p.length>1&&(p.forEach(function(C){R+=C.dvb_weight,T.push(R)}),M=Math.floor(Math.random()*(R-1)),T.every(function(C,I){return m=I,!(M<C)})),p[m]}function O(P){return P&&y(c(P))}return _={select:O},_}l.__dashjs_factory_name="DVBSelector";const f=u.default.getClassFactory(l)},"./src/streaming/vo/BitrateInfo.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN};const f=l},"./src/streaming/vo/DashJSError.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(_,E,c){u(this,d),this.code=_||null,this.message=E||null,this.data=c||null};const f=l},"./src/streaming/vo/DataChunk.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null};const f=l},"./src/streaming/vo/FragmentRequest.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>E});var u=r("./src/streaming/vo/metrics/HTTPRequest.js");function l(c,y){if(!(c instanceof y))throw new TypeError("Cannot call a class as a function")}function f(c,y){for(var O=0;O<y.length;O++){var P=y[O];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(c,P.key,P)}}function d(c,y,O){return y&&f(c.prototype,y),O&&f(c,O),c}var _=function(){function c(y){l(this,c),this.action=c.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaStartTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=y||null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}return d(c,[{key:"isInitializationRequest",value:function(){return this.type&&this.type===u.HTTPRequest.INIT_SEGMENT_TYPE}},{key:"setInfo",value:function(O){this.type=O&&O.init?u.HTTPRequest.INIT_SEGMENT_TYPE:u.HTTPRequest.MEDIA_SEGMENT_TYPE,this.url=O&&O.url?O.url:null,this.range=O&&O.range?O.range.start+"-"+O.range.end:null,this.mediaType=O&&O.mediaType?O.mediaType:null}}]),c}();_.ACTION_DOWNLOAD="download",_.ACTION_COMPLETE="complete";const E=_},"./src/streaming/vo/HeadRequest.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>L});var u=r("./src/streaming/vo/FragmentRequest.js");function l(R){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(m){return typeof m}:l=function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(R)}function f(R,T){if(!(R instanceof T))throw new TypeError("Cannot call a class as a function")}function d(R,T){if(typeof T!="function"&&T!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(T&&T.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),T&&_(R,T)}function _(R,T){return _=Object.setPrototypeOf||function(M,p){return M.__proto__=p,M},_(R,T)}function E(R){var T=O();return function(){var M=P(R),p;if(T){var C=P(this).constructor;p=Reflect.construct(M,arguments,C)}else p=M.apply(this,arguments);return c(this,p)}}function c(R,T){return T&&(l(T)==="object"||typeof T=="function")?T:y(R)}function y(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(R){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(m){return m.__proto__||Object.getPrototypeOf(m)},P(R)}var b=function(R){d(m,R);var T=E(m);function m(M){var p;return f(this,m),p=T.call(this,M),p.checkForExistenceOnly=!0,p}return m}(u.default);const L=b},"./src/streaming/vo/IsoBox.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>_});function u(E,c){if(!(E instanceof c))throw new TypeError("Cannot call a class as a function")}function l(E,c){for(var y=0;y<c.length;y++){var O=c[y];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(E,O.key,O)}}function f(E,c,y){return c&&l(E.prototype,c),y&&l(E,y),E}var d=function(){function E(c){if(u(this,E),this.offset=c._offset,this.type=c.type,this.size=c.size,this.boxes=[],c.boxes)for(var y=0;y<c.boxes.length;y++)this.boxes.push(new E(c.boxes[y]));switch(this.isComplete=!0,c.type){case"sidx":if(this.timescale=c.timescale,this.earliest_presentation_time=c.earliest_presentation_time,this.first_offset=c.first_offset,this.references=c.references,c.references){this.references=[];for(var O=0;O<c.references.length;O++){var P={reference_type:c.references[O].reference_type,referenced_size:c.references[O].referenced_size,subsegment_duration:c.references[O].subsegment_duration};this.references.push(P)}}break;case"emsg":this.id=c.id,this.version=c.version===1?1:0,this.value=c.value,this.timescale=c.timescale,this.scheme_id_uri=c.scheme_id_uri,this.presentation_time_delta=c.version===1?c.presentation_time:c.presentation_time_delta,this.event_duration=c.event_duration,this.message_data=c.message_data;break;case"mdhd":this.timescale=c.timescale;break;case"mfhd":this.sequence_number=c.sequence_number;break;case"subs":this.entry_count=c.entry_count,this.entries=c.entries;break;case"tfhd":this.base_data_offset=c.base_data_offset,this.sample_description_index=c.sample_description_index,this.default_sample_duration=c.default_sample_duration,this.default_sample_size=c.default_sample_size,this.default_sample_flags=c.default_sample_flags,this.flags=c.flags;break;case"tfdt":this.version=c.version,this.baseMediaDecodeTime=c.baseMediaDecodeTime,this.flags=c.flags;break;case"trun":if(this.sample_count=c.sample_count,this.first_sample_flags=c.first_sample_flags,this.data_offset=c.data_offset,this.flags=c.flags,this.samples=c.samples,c.samples){this.samples=[];for(var b=0,L=c.samples.length;b<L;b++){var R={sample_size:c.samples[b].sample_size,sample_duration:c.samples[b].sample_duration,sample_composition_time_offset:c.samples[b].sample_composition_time_offset};this.samples.push(R)}}break}}return f(E,[{key:"getChildBox",value:function(y){for(var O=0;O<this.boxes.length;O++)if(this.boxes[O].type===y)return this.boxes[O]}},{key:"getChildBoxes",value:function(y){for(var O=[],P=0;P<this.boxes.length;P++)this.boxes[P].type===y&&O.push(this.boxes[P]);return O}}]),E}();const _=d},"./src/streaming/vo/IsoBoxSearchInfo.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(_,E,c){u(this,d),this.lastCompletedOffset=_,this.found=E,this.size=c};const f=l},"./src/streaming/vo/MetricsList.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]};const f=l},"./src/streaming/vo/TextRequest.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>R});var u=r("./src/streaming/constants/Constants.js"),l=r("./src/streaming/vo/FragmentRequest.js");function f(T){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?f=function(M){return typeof M}:f=function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},f(T)}function d(T,m){if(!(T instanceof m))throw new TypeError("Cannot call a class as a function")}function _(T,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(m&&m.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),m&&E(T,m)}function E(T,m){return E=Object.setPrototypeOf||function(p,C){return p.__proto__=C,p},E(T,m)}function c(T){var m=P();return function(){var p=b(T),C;if(m){var I=b(this).constructor;C=Reflect.construct(p,arguments,I)}else C=p.apply(this,arguments);return y(this,C)}}function y(T,m){return m&&(f(m)==="object"||typeof m=="function")?m:O(T)}function O(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function b(T){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},b(T)}var L=function(T){_(M,T);var m=c(M);function M(p,C){var I;return d(this,M),I=m.call(this),I.url=p||null,I.type=C||null,I.mediaType=u.default.STREAM,I.responseType="",I}return M}(l.default);const R=L},"./src/streaming/vo/TextTrackInfo.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>L});var u=r("./src/dash/vo/MediaInfo.js");function l(R){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(m){return typeof m}:l=function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(R)}function f(R,T){if(!(R instanceof T))throw new TypeError("Cannot call a class as a function")}function d(R,T){if(typeof T!="function"&&T!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(T&&T.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),T&&_(R,T)}function _(R,T){return _=Object.setPrototypeOf||function(M,p){return M.__proto__=p,M},_(R,T)}function E(R){var T=O();return function(){var M=P(R),p;if(T){var C=P(this).constructor;p=Reflect.construct(M,arguments,C)}else p=M.apply(this,arguments);return c(this,p)}}function c(R,T){return T&&(l(T)==="object"||typeof T=="function")?T:y(R)}function y(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(R){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(m){return m.__proto__||Object.getPrototypeOf(m)},P(R)}var b=function(R){d(m,R);var T=E(m);function m(){var M;return f(this,m),M=T.call(this),M.captionData=null,M.label=null,M.defaultTrack=!1,M.kind=null,M.isFragmented=!1,M.isEmbedded=!1,M.isTTML=null,M}return m}(u.default);const L=b},"./src/streaming/vo/Thumbnail.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null};const f=l},"./src/streaming/vo/ThumbnailTrackInfo.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""};const f=l},"./src/streaming/vo/URIFragmentData.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null};const f=l},"./src/streaming/vo/metrics/BufferLevel.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.t=null,this.level=null};const f=l},"./src/streaming/vo/metrics/BufferState.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>d});var u=r("./src/streaming/constants/MetricsConstants.js");function l(_,E){if(!(_ instanceof E))throw new TypeError("Cannot call a class as a function")}var f=function _(){l(this,_),this.target=null,this.state=u.default.BUFFER_EMPTY};const d=f},"./src/streaming/vo/metrics/DVRInfo.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.time=null,this.range=null,this.manifestInfo=null};const f=l},"./src/streaming/vo/metrics/DroppedFrames.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.time=null,this.droppedFrames=null};const f=l},"./src/streaming/vo/metrics/HTTPRequest.js":(h,i,r)=>{r.r(i),r.d(i,{HTTPRequest:()=>l,HTTPRequestTrace:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this.cmsd=null,this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null,this._fileLoaderType=null},f=function d(){u(this,d),this.s=null,this.d=null,this.b=[]};l.GET="GET",l.HEAD="HEAD",l.MPD_TYPE="MPD",l.XLINK_EXPANSION_TYPE="XLinkExpansion",l.INIT_SEGMENT_TYPE="InitializationSegment",l.INDEX_SEGMENT_TYPE="IndexSegment",l.MEDIA_SEGMENT_TYPE="MediaSegment",l.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",l.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",l.DVB_REPORTING_TYPE="DVBReporting",l.LICENSE="license",l.CONTENT_STEERING_TYPE="ContentSteering",l.OTHER_TYPE="other"},"./src/streaming/vo/metrics/ManifestUpdate.js":(h,i,r)=>{r.r(i),r.d(i,{ManifestUpdate:()=>l,ManifestUpdateRepresentationInfo:()=>d,ManifestUpdateStreamInfo:()=>f});function u(_,E){if(!(_ instanceof E))throw new TypeError("Cannot call a class as a function")}var l=function _(){u(this,_),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},f=function _(){u(this,_),this.id=null,this.index=null,this.start=null,this.duration=null},d=function _(){u(this,_),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null}},"./src/streaming/vo/metrics/PlayList.js":(h,i,r)=>{r.r(i),r.d(i,{PlayList:()=>l,PlayListTrace:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};l.INITIAL_PLAYOUT_START_REASON="initial_playout",l.SEEK_START_REASON="seek",l.RESUME_FROM_PAUSE_START_REASON="resume",l.METRICS_COLLECTION_START_REASON="metrics_collection_start";var f=function d(){u(this,d),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};f.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",f.REBUFFERING_REASON="rebuffering",f.USER_REQUEST_STOP_REASON="user_request",f.END_OF_PERIOD_STOP_REASON="end_of_period",f.END_OF_CONTENT_STOP_REASON="end_of_content",f.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",f.FAILURE_STOP_REASON="failure"},"./src/streaming/vo/metrics/RepresentationSwitch.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.t=null,this.mt=null,this.to=null,this.lto=null};const f=l},"./src/streaming/vo/metrics/RequestsQueue.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.loadingRequests=[],this.executedRequests=[]};const f=l},"./src/streaming/vo/metrics/SchedulingInfo.js":(h,i,r)=>{r.r(i),r.d(i,{default:()=>f});function u(d,_){if(!(d instanceof _))throw new TypeError("Cannot call a class as a function")}var l=function d(){u(this,d),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null};const f=l},"./node_modules/bcp-47-match/index.js":(h,i)=>{i.basicFilter=f(r,!0),i.extendedFilter=f(u,!0),i.lookup=f(l);function r(_,E){return E==="*"||_===E||_.indexOf(E+"-")>-1}function u(_,E){var c=_.split("-"),y=E.split("-"),O=0,P=0;if(y[P]!=="*"&&c[O]!==y[P])return!1;for(O++,P++;P<y.length;){if(y[P]==="*"){P++;continue}if(!c[O])return!1;if(c[O]===y[P]){O++,P++;continue}if(c[O].length===1)return!1;O++}return!0}function l(_,E){for(var c=E,y;;){if(c==="*"||_===c)return!0;if(y=c.lastIndexOf("-"),y<0)return!1;c.charAt(y-2)==="-"&&(y-=2),c=c.slice(0,y)}}function f(_,E){return c;function c(y,O){for(var P=d(y,"tag"),b=d(O??"*","range"),L=[],R=-1,T,m,M;++R<b.length;)if(T=b[R].toLowerCase(),!(!E&&T==="*")){for(m=-1,M=[];++m<P.length;)if(_(P[m].toLowerCase(),T)){if(!E)return P[m];L.push(P[m])}else M.push(P[m]);P=M}return E?L:void 0}}function d(_,E){var c=_&&typeof _=="string"?[_]:_;if(!c||typeof c!="object"||!("length"in c))throw new Error("Invalid "+E+" `"+c+"`, expected non-empty string");return c}},"./node_modules/bcp-47-normalize/index.js":(h,i,r)=>{h.exports=r("./node_modules/bcp-47-normalize/lib/index.js")},"./node_modules/bcp-47-normalize/lib/index.js":(h,i,r)=>{var u=r("./node_modules/bcp-47/index.js"),l=r("./node_modules/bcp-47-match/index.js"),f=r("./node_modules/bcp-47-normalize/lib/matches.json"),d=r("./node_modules/bcp-47-normalize/lib/fields.json"),_=r("./node_modules/bcp-47-normalize/lib/defaults.json"),E=r("./node_modules/bcp-47-normalize/lib/many.json");h.exports=P;var c={}.hasOwnProperty,y=new Intl.Collator,O={variants:[],extensions:[],privateuse:[],irregular:null,regular:null};function P(m,M){var p=M||{},C=u.parse(String(m||"").toLowerCase(),p),I=u.stringify(C),A=-1,S;if(!I)return I;for(;++A<f.length;)l.extendedFilter(I,f[A].from).length&&(b(C,f[A].from,f[A].to),I=u.stringify(C));for(A=-1;++A<d.length;)L(C,d[A].from.field,d[A].from.value)&&R(C,d[A].to.field,d[A].to.value);for(I=u.stringify(Object.assign({},C,O)),A=-1;++A<_.length;)I===_[A]&&(b(C,_[A],_[A].split("-").slice(0,-1).join("-")),I=u.stringify(Object.assign({},C,O)));if(C.extensions.sort(T),p.warning)for(S in E)c.call(E[S],C[S])&&p.warning("Deprecated "+S+" `"+C[S]+"`, expected one of `"+E[S][C[S]].join("`, `")+"`",null,7);return C.script&&(C.script=C.script.charAt(0).toUpperCase()+C.script.slice(1)),C.region&&(C.region=C.region.toUpperCase()),u.stringify(C)}function b(m,M,p){var C=u.parse(M),I=u.parse(p),A=[],S;for(S in C)C[S]&&C[S].length&&L(m,S,C[S])&&A.push(S);for(S in I)I[S]&&I[S].length&&(A.indexOf(S)>-1||!m[S]||!m[S].length)&&R(m,S,I[S])}function L(m,M,p){var C=!1,I,A,S,x;if(p){if(I=m[M],A=I,I&&typeof I=="object")for(A=[],S=-1;++S<I.length;)x=I[S],p.indexOf(x)<0?A.push(x):C=!0;else I===p&&(A=null,C=!0);m[M]=A}return C}function R(m,M,p){var C=m[M],I,A,S;if(C&&typeof C=="object")for(I=[].concat(p),A=-1;++A<I.length;)S=I[A],C.indexOf(S)<0&&C.push(S);else m[M]=p}function T(m,M){return y.compare(m.singleton,M.singleton)}},"./node_modules/bcp-47/index.js":(h,i,r)=>{i.parse=r("./node_modules/bcp-47/lib/parse.js"),i.stringify=r("./node_modules/bcp-47/lib/stringify.js")},"./node_modules/bcp-47/lib/parse.js":(h,i,r)=>{var u=r("./node_modules/is-alphanumerical/index.js"),l=r("./node_modules/is-alphabetical/index.js"),f=r("./node_modules/is-decimal/index.js"),d=r("./node_modules/bcp-47/lib/regular.json"),_=r("./node_modules/bcp-47/lib/normalize.json");h.exports=c;var E={}.hasOwnProperty;function c(O,P){var b=P||{},L=y(),R=String(O),T=R.toLowerCase(),m=0,M,p,C;if(O==null)throw new Error("Expected string, got `"+O+"`");if(E.call(_,T))return(b.normalize==null||b.normalize)&&_[T]?c(_[T]):(L[d.indexOf(T)===-1?"irregular":"regular"]=R,L);for(;l(T.charCodeAt(m))&&m<9;)m++;if(m>1&&m<9){if(L.language=R.slice(0,m),m<4)for(p=0;T.charCodeAt(m)===45&&l(T.charCodeAt(m+1))&&l(T.charCodeAt(m+2))&&l(T.charCodeAt(m+3))&&!l(T.charCodeAt(m+4));){if(p>2)return I(m,3,"Too many extended language subtags, expected at most 3 subtags");L.extendedLanguageSubtags.push(R.slice(m+1,m+4)),m+=4,p++}for(T.charCodeAt(m)===45&&l(T.charCodeAt(m+1))&&l(T.charCodeAt(m+2))&&l(T.charCodeAt(m+3))&&l(T.charCodeAt(m+4))&&!l(T.charCodeAt(m+5))&&(L.script=R.slice(m+1,m+5),m+=5),T.charCodeAt(m)===45&&(l(T.charCodeAt(m+1))&&l(T.charCodeAt(m+2))&&!l(T.charCodeAt(m+3))?(L.region=R.slice(m+1,m+3),m+=3):f(T.charCodeAt(m+1))&&f(T.charCodeAt(m+2))&&f(T.charCodeAt(m+3))&&!f(T.charCodeAt(m+4))&&(L.region=R.slice(m+1,m+4),m+=4));T.charCodeAt(m)===45;){for(C=M=m+1;u(T.charCodeAt(C));){if(C-M>7)return I(C,1,"Too long variant, expected at most 8 characters");C++}if(C-M>4||C-M>3&&f(T.charCodeAt(M)))L.variants.push(R.slice(M,C)),m=C;else break}for(;T.charCodeAt(m)===45&&!(T.charCodeAt(m+1)===120||!u(T.charCodeAt(m+1))||T.charCodeAt(m+2)!==45||!u(T.charCodeAt(m+3)));){for(C=m+2,p=0;T.charCodeAt(C)===45&&u(T.charCodeAt(C+1))&&u(T.charCodeAt(C+2));)for(M=C+1,C=M+2,p++;u(T.charCodeAt(C));){if(C-M>7)return I(C,2,"Too long extension, expected at most 8 characters");C++}if(!p)return I(C,4,"Empty extension, extensions must have at least 2 characters of content");L.extensions.push({singleton:R.charAt(m+1),extensions:R.slice(m+3,C).split("-")}),m=C}}else m=0;if(m===0&&T.charCodeAt(m)===120||T.charCodeAt(m)===45&&T.charCodeAt(m+1)===120)for(C=m=m?m+2:1;T.charCodeAt(C)===45&&u(T.charCodeAt(C+1));){for(C=M=m+1;u(T.charCodeAt(C));){if(C-M>7)return I(C,5,"Too long private-use area, expected at most 8 characters");C++}L.privateuse.push(R.slice(m+1,C)),m=C}if(m!==R.length)return I(m,6,"Found superfluous content after tag");return L;function I(A,S,x){return b.warning&&b.warning(x,S,A),b.forgiving?L:y()}}function y(){return{language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null}}},"./node_modules/bcp-47/lib/stringify.js":h=>{h.exports=i;function i(r){var u=r||{},l=[],f,d,_;if(u.irregular||u.regular)return u.irregular||u.regular;if(u.language)for(l=l.concat(u.language,u.extendedLanguageSubtags||[],u.script||[],u.region||[],u.variants||[]),f=u.extensions||[],d=-1;++d<f.length;)_=f[d],_.singleton&&_.extensions&&_.extensions.length&&(l=l.concat(_.singleton,_.extensions));return u.privateuse&&u.privateuse.length&&(l=l.concat("x",u.privateuse)),l.join("-")}},"./node_modules/buffer/index.js":(h,i,r)=>{/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var u=r("./node_modules/buffer/node_modules/base64-js/index.js"),l=r("./node_modules/buffer/node_modules/ieee754/index.js"),f=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;i.Buffer=c,i.SlowBuffer=C,i.INSPECT_MAX_BYTES=50;var d=2147483647;i.kMaxLength=d,c.TYPED_ARRAY_SUPPORT=_(),!c.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function _(){try{var U=new Uint8Array(1),B={foo:function(){return 42}};return Object.setPrototypeOf(B,Uint8Array.prototype),Object.setPrototypeOf(U,B),U.foo()===42}catch{return!1}}Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}});function E(U){if(U>d)throw new RangeError('The value "'+U+'" is invalid for option "size"');var B=new Uint8Array(U);return Object.setPrototypeOf(B,c.prototype),B}function c(U,B,G){if(typeof U=="number"){if(typeof B=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return b(U)}return y(U,B,G)}c.poolSize=8192;function y(U,B,G){if(typeof U=="string")return L(U,B);if(ArrayBuffer.isView(U))return T(U);if(U==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U);if(w(U,ArrayBuffer)||U&&w(U.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(w(U,SharedArrayBuffer)||U&&w(U.buffer,SharedArrayBuffer)))return m(U,B,G);if(typeof U=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var z=U.valueOf&&U.valueOf();if(z!=null&&z!==U)return c.from(z,B,G);var fe=M(U);if(fe)return fe;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof U[Symbol.toPrimitive]=="function")return c.from(U[Symbol.toPrimitive]("string"),B,G);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U)}c.from=function(U,B,G){return y(U,B,G)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array);function O(U){if(typeof U!="number")throw new TypeError('"size" argument must be of type number');if(U<0)throw new RangeError('The value "'+U+'" is invalid for option "size"')}function P(U,B,G){return O(U),U<=0?E(U):B!==void 0?typeof G=="string"?E(U).fill(B,G):E(U).fill(B):E(U)}c.alloc=function(U,B,G){return P(U,B,G)};function b(U){return O(U),E(U<0?0:p(U)|0)}c.allocUnsafe=function(U){return b(U)},c.allocUnsafeSlow=function(U){return b(U)};function L(U,B){if((typeof B!="string"||B==="")&&(B="utf8"),!c.isEncoding(B))throw new TypeError("Unknown encoding: "+B);var G=I(U,B)|0,z=E(G),fe=z.write(U,B);return fe!==G&&(z=z.slice(0,fe)),z}function R(U){for(var B=U.length<0?0:p(U.length)|0,G=E(B),z=0;z<B;z+=1)G[z]=U[z]&255;return G}function T(U){if(w(U,Uint8Array)){var B=new Uint8Array(U);return m(B.buffer,B.byteOffset,B.byteLength)}return R(U)}function m(U,B,G){if(B<0||U.byteLength<B)throw new RangeError('"offset" is outside of buffer bounds');if(U.byteLength<B+(G||0))throw new RangeError('"length" is outside of buffer bounds');var z;return B===void 0&&G===void 0?z=new Uint8Array(U):G===void 0?z=new Uint8Array(U,B):z=new Uint8Array(U,B,G),Object.setPrototypeOf(z,c.prototype),z}function M(U){if(c.isBuffer(U)){var B=p(U.length)|0,G=E(B);return G.length===0||U.copy(G,0,0,B),G}if(U.length!==void 0)return typeof U.length!="number"||W(U.length)?E(0):R(U);if(U.type==="Buffer"&&Array.isArray(U.data))return R(U.data)}function p(U){if(U>=d)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+d.toString(16)+" bytes");return U|0}function C(U){return+U!=U&&(U=0),c.alloc(+U)}c.isBuffer=function(B){return B!=null&&B._isBuffer===!0&&B!==c.prototype},c.compare=function(B,G){if(w(B,Uint8Array)&&(B=c.from(B,B.offset,B.byteLength)),w(G,Uint8Array)&&(G=c.from(G,G.offset,G.byteLength)),!c.isBuffer(B)||!c.isBuffer(G))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(B===G)return 0;for(var z=B.length,fe=G.length,ue=0,J=Math.min(z,fe);ue<J;++ue)if(B[ue]!==G[ue]){z=B[ue],fe=G[ue];break}return z<fe?-1:fe<z?1:0},c.isEncoding=function(B){switch(String(B).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(B,G){if(!Array.isArray(B))throw new TypeError('"list" argument must be an Array of Buffers');if(B.length===0)return c.alloc(0);var z;if(G===void 0)for(G=0,z=0;z<B.length;++z)G+=B[z].length;var fe=c.allocUnsafe(G),ue=0;for(z=0;z<B.length;++z){var J=B[z];if(w(J,Uint8Array))ue+J.length>fe.length?c.from(J).copy(fe,ue):Uint8Array.prototype.set.call(fe,J,ue);else if(c.isBuffer(J))J.copy(fe,ue);else throw new TypeError('"list" argument must be an Array of Buffers');ue+=J.length}return fe};function I(U,B){if(c.isBuffer(U))return U.length;if(ArrayBuffer.isView(U)||w(U,ArrayBuffer))return U.byteLength;if(typeof U!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof U);var G=U.length,z=arguments.length>2&&arguments[2]===!0;if(!z&&G===0)return 0;for(var fe=!1;;)switch(B){case"ascii":case"latin1":case"binary":return G;case"utf8":case"utf-8":return q(U).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G*2;case"hex":return G>>>1;case"base64":return N(U).length;default:if(fe)return z?-1:q(U).length;B=(""+B).toLowerCase(),fe=!0}}c.byteLength=I;function A(U,B,G){var z=!1;if((B===void 0||B<0)&&(B=0),B>this.length||((G===void 0||G>this.length)&&(G=this.length),G<=0)||(G>>>=0,B>>>=0,G<=B))return"";for(U||(U="utf8");;)switch(U){case"hex":return ae(this,B,G);case"utf8":case"utf-8":return Y(this,B,G);case"ascii":return ee(this,B,G);case"latin1":case"binary":return ne(this,B,G);case"base64":return K(this,B,G);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ce(this,B,G);default:if(z)throw new TypeError("Unknown encoding: "+U);U=(U+"").toLowerCase(),z=!0}}c.prototype._isBuffer=!0;function S(U,B,G){var z=U[B];U[B]=U[G],U[G]=z}c.prototype.swap16=function(){var B=this.length;if(B%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var G=0;G<B;G+=2)S(this,G,G+1);return this},c.prototype.swap32=function(){var B=this.length;if(B%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var G=0;G<B;G+=4)S(this,G,G+3),S(this,G+1,G+2);return this},c.prototype.swap64=function(){var B=this.length;if(B%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var G=0;G<B;G+=8)S(this,G,G+7),S(this,G+1,G+6),S(this,G+2,G+5),S(this,G+3,G+4);return this},c.prototype.toString=function(){var B=this.length;return B===0?"":arguments.length===0?Y(this,0,B):A.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(B){if(!c.isBuffer(B))throw new TypeError("Argument must be a Buffer");return this===B?!0:c.compare(this,B)===0},c.prototype.inspect=function(){var B="",G=i.INSPECT_MAX_BYTES;return B=this.toString("hex",0,G).replace(/(.{2})/g,"$1 ").trim(),this.length>G&&(B+=" ... "),"<Buffer "+B+">"},f&&(c.prototype[f]=c.prototype.inspect),c.prototype.compare=function(B,G,z,fe,ue){if(w(B,Uint8Array)&&(B=c.from(B,B.offset,B.byteLength)),!c.isBuffer(B))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof B);if(G===void 0&&(G=0),z===void 0&&(z=B?B.length:0),fe===void 0&&(fe=0),ue===void 0&&(ue=this.length),G<0||z>B.length||fe<0||ue>this.length)throw new RangeError("out of range index");if(fe>=ue&&G>=z)return 0;if(fe>=ue)return-1;if(G>=z)return 1;if(G>>>=0,z>>>=0,fe>>>=0,ue>>>=0,this===B)return 0;for(var J=ue-fe,ve=z-G,me=Math.min(J,ve),Ae=this.slice(fe,ue),be=B.slice(G,z),Be=0;Be<me;++Be)if(Ae[Be]!==be[Be]){J=Ae[Be],ve=be[Be];break}return J<ve?-1:ve<J?1:0};function x(U,B,G,z,fe){if(U.length===0)return-1;if(typeof G=="string"?(z=G,G=0):G>2147483647?G=2147483647:G<-2147483648&&(G=-2147483648),G=+G,W(G)&&(G=fe?0:U.length-1),G<0&&(G=U.length+G),G>=U.length){if(fe)return-1;G=U.length-1}else if(G<0)if(fe)G=0;else return-1;if(typeof B=="string"&&(B=c.from(B,z)),c.isBuffer(B))return B.length===0?-1:F(U,B,G,z,fe);if(typeof B=="number")return B=B&255,typeof Uint8Array.prototype.indexOf=="function"?fe?Uint8Array.prototype.indexOf.call(U,B,G):Uint8Array.prototype.lastIndexOf.call(U,B,G):F(U,[B],G,z,fe);throw new TypeError("val must be string, number or Buffer")}function F(U,B,G,z,fe){var ue=1,J=U.length,ve=B.length;if(z!==void 0&&(z=String(z).toLowerCase(),z==="ucs2"||z==="ucs-2"||z==="utf16le"||z==="utf-16le")){if(U.length<2||B.length<2)return-1;ue=2,J/=2,ve/=2,G/=2}function me(Ye,Le){return ue===1?Ye[Le]:Ye.readUInt16BE(Le*ue)}var Ae;if(fe){var be=-1;for(Ae=G;Ae<J;Ae++)if(me(U,Ae)===me(B,be===-1?0:Ae-be)){if(be===-1&&(be=Ae),Ae-be+1===ve)return be*ue}else be!==-1&&(Ae-=Ae-be),be=-1}else for(G+ve>J&&(G=J-ve),Ae=G;Ae>=0;Ae--){for(var Be=!0,ke=0;ke<ve;ke++)if(me(U,Ae+ke)!==me(B,ke)){Be=!1;break}if(Be)return Ae}return-1}c.prototype.includes=function(B,G,z){return this.indexOf(B,G,z)!==-1},c.prototype.indexOf=function(B,G,z){return x(this,B,G,z,!0)},c.prototype.lastIndexOf=function(B,G,z){return x(this,B,G,z,!1)};function k(U,B,G,z){G=Number(G)||0;var fe=U.length-G;z?(z=Number(z),z>fe&&(z=fe)):z=fe;var ue=B.length;z>ue/2&&(z=ue/2);for(var J=0;J<z;++J){var ve=parseInt(B.substr(J*2,2),16);if(W(ve))return J;U[G+J]=ve}return J}function j(U,B,G,z){return D(q(B,U.length-G),U,G,z)}function V(U,B,G,z){return D(le(B),U,G,z)}function Q(U,B,G,z){return D(N(B),U,G,z)}function $(U,B,G,z){return D(te(B,U.length-G),U,G,z)}c.prototype.write=function(B,G,z,fe){if(G===void 0)fe="utf8",z=this.length,G=0;else if(z===void 0&&typeof G=="string")fe=G,z=this.length,G=0;else if(isFinite(G))G=G>>>0,isFinite(z)?(z=z>>>0,fe===void 0&&(fe="utf8")):(fe=z,z=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var ue=this.length-G;if((z===void 0||z>ue)&&(z=ue),B.length>0&&(z<0||G<0)||G>this.length)throw new RangeError("Attempt to write outside buffer bounds");fe||(fe="utf8");for(var J=!1;;)switch(fe){case"hex":return k(this,B,G,z);case"utf8":case"utf-8":return j(this,B,G,z);case"ascii":case"latin1":case"binary":return V(this,B,G,z);case"base64":return Q(this,B,G,z);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,B,G,z);default:if(J)throw new TypeError("Unknown encoding: "+fe);fe=(""+fe).toLowerCase(),J=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function K(U,B,G){return B===0&&G===U.length?u.fromByteArray(U):u.fromByteArray(U.slice(B,G))}function Y(U,B,G){G=Math.min(U.length,G);for(var z=[],fe=B;fe<G;){var ue=U[fe],J=null,ve=ue>239?4:ue>223?3:ue>191?2:1;if(fe+ve<=G){var me,Ae,be,Be;switch(ve){case 1:ue<128&&(J=ue);break;case 2:me=U[fe+1],(me&192)===128&&(Be=(ue&31)<<6|me&63,Be>127&&(J=Be));break;case 3:me=U[fe+1],Ae=U[fe+2],(me&192)===128&&(Ae&192)===128&&(Be=(ue&15)<<12|(me&63)<<6|Ae&63,Be>2047&&(Be<55296||Be>57343)&&(J=Be));break;case 4:me=U[fe+1],Ae=U[fe+2],be=U[fe+3],(me&192)===128&&(Ae&192)===128&&(be&192)===128&&(Be=(ue&15)<<18|(me&63)<<12|(Ae&63)<<6|be&63,Be>65535&&Be<1114112&&(J=Be))}}J===null?(J=65533,ve=1):J>65535&&(J-=65536,z.push(J>>>10&1023|55296),J=56320|J&1023),z.push(J),fe+=ve}return ie(z)}var re=4096;function ie(U){var B=U.length;if(B<=re)return String.fromCharCode.apply(String,U);for(var G="",z=0;z<B;)G+=String.fromCharCode.apply(String,U.slice(z,z+=re));return G}function ee(U,B,G){var z="";G=Math.min(U.length,G);for(var fe=B;fe<G;++fe)z+=String.fromCharCode(U[fe]&127);return z}function ne(U,B,G){var z="";G=Math.min(U.length,G);for(var fe=B;fe<G;++fe)z+=String.fromCharCode(U[fe]);return z}function ae(U,B,G){var z=U.length;(!B||B<0)&&(B=0),(!G||G<0||G>z)&&(G=z);for(var fe="",ue=B;ue<G;++ue)fe+=H[U[ue]];return fe}function ce(U,B,G){for(var z=U.slice(B,G),fe="",ue=0;ue<z.length-1;ue+=2)fe+=String.fromCharCode(z[ue]+z[ue+1]*256);return fe}c.prototype.slice=function(B,G){var z=this.length;B=~~B,G=G===void 0?z:~~G,B<0?(B+=z,B<0&&(B=0)):B>z&&(B=z),G<0?(G+=z,G<0&&(G=0)):G>z&&(G=z),G<B&&(G=B);var fe=this.subarray(B,G);return Object.setPrototypeOf(fe,c.prototype),fe};function X(U,B,G){if(U%1!==0||U<0)throw new RangeError("offset is not uint");if(U+B>G)throw new RangeError("Trying to access beyond buffer length")}c.prototype.readUintLE=c.prototype.readUIntLE=function(B,G,z){B=B>>>0,G=G>>>0,z||X(B,G,this.length);for(var fe=this[B],ue=1,J=0;++J<G&&(ue*=256);)fe+=this[B+J]*ue;return fe},c.prototype.readUintBE=c.prototype.readUIntBE=function(B,G,z){B=B>>>0,G=G>>>0,z||X(B,G,this.length);for(var fe=this[B+--G],ue=1;G>0&&(ue*=256);)fe+=this[B+--G]*ue;return fe},c.prototype.readUint8=c.prototype.readUInt8=function(B,G){return B=B>>>0,G||X(B,1,this.length),this[B]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(B,G){return B=B>>>0,G||X(B,2,this.length),this[B]|this[B+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(B,G){return B=B>>>0,G||X(B,2,this.length),this[B]<<8|this[B+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(B,G){return B=B>>>0,G||X(B,4,this.length),(this[B]|this[B+1]<<8|this[B+2]<<16)+this[B+3]*16777216},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(B,G){return B=B>>>0,G||X(B,4,this.length),this[B]*16777216+(this[B+1]<<16|this[B+2]<<8|this[B+3])},c.prototype.readIntLE=function(B,G,z){B=B>>>0,G=G>>>0,z||X(B,G,this.length);for(var fe=this[B],ue=1,J=0;++J<G&&(ue*=256);)fe+=this[B+J]*ue;return ue*=128,fe>=ue&&(fe-=Math.pow(2,8*G)),fe},c.prototype.readIntBE=function(B,G,z){B=B>>>0,G=G>>>0,z||X(B,G,this.length);for(var fe=G,ue=1,J=this[B+--fe];fe>0&&(ue*=256);)J+=this[B+--fe]*ue;return ue*=128,J>=ue&&(J-=Math.pow(2,8*G)),J},c.prototype.readInt8=function(B,G){return B=B>>>0,G||X(B,1,this.length),this[B]&128?(255-this[B]+1)*-1:this[B]},c.prototype.readInt16LE=function(B,G){B=B>>>0,G||X(B,2,this.length);var z=this[B]|this[B+1]<<8;return z&32768?z|4294901760:z},c.prototype.readInt16BE=function(B,G){B=B>>>0,G||X(B,2,this.length);var z=this[B+1]|this[B]<<8;return z&32768?z|4294901760:z},c.prototype.readInt32LE=function(B,G){return B=B>>>0,G||X(B,4,this.length),this[B]|this[B+1]<<8|this[B+2]<<16|this[B+3]<<24},c.prototype.readInt32BE=function(B,G){return B=B>>>0,G||X(B,4,this.length),this[B]<<24|this[B+1]<<16|this[B+2]<<8|this[B+3]},c.prototype.readFloatLE=function(B,G){return B=B>>>0,G||X(B,4,this.length),l.read(this,B,!0,23,4)},c.prototype.readFloatBE=function(B,G){return B=B>>>0,G||X(B,4,this.length),l.read(this,B,!1,23,4)},c.prototype.readDoubleLE=function(B,G){return B=B>>>0,G||X(B,8,this.length),l.read(this,B,!0,52,8)},c.prototype.readDoubleBE=function(B,G){return B=B>>>0,G||X(B,8,this.length),l.read(this,B,!1,52,8)};function oe(U,B,G,z,fe,ue){if(!c.isBuffer(U))throw new TypeError('"buffer" argument must be a Buffer instance');if(B>fe||B<ue)throw new RangeError('"value" argument is out of bounds');if(G+z>U.length)throw new RangeError("Index out of range")}c.prototype.writeUintLE=c.prototype.writeUIntLE=function(B,G,z,fe){if(B=+B,G=G>>>0,z=z>>>0,!fe){var ue=Math.pow(2,8*z)-1;oe(this,B,G,z,ue,0)}var J=1,ve=0;for(this[G]=B&255;++ve<z&&(J*=256);)this[G+ve]=B/J&255;return G+z},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(B,G,z,fe){if(B=+B,G=G>>>0,z=z>>>0,!fe){var ue=Math.pow(2,8*z)-1;oe(this,B,G,z,ue,0)}var J=z-1,ve=1;for(this[G+J]=B&255;--J>=0&&(ve*=256);)this[G+J]=B/ve&255;return G+z},c.prototype.writeUint8=c.prototype.writeUInt8=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,1,255,0),this[G]=B&255,G+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,2,65535,0),this[G]=B&255,this[G+1]=B>>>8,G+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,2,65535,0),this[G]=B>>>8,this[G+1]=B&255,G+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,4,4294967295,0),this[G+3]=B>>>24,this[G+2]=B>>>16,this[G+1]=B>>>8,this[G]=B&255,G+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,4,4294967295,0),this[G]=B>>>24,this[G+1]=B>>>16,this[G+2]=B>>>8,this[G+3]=B&255,G+4},c.prototype.writeIntLE=function(B,G,z,fe){if(B=+B,G=G>>>0,!fe){var ue=Math.pow(2,8*z-1);oe(this,B,G,z,ue-1,-ue)}var J=0,ve=1,me=0;for(this[G]=B&255;++J<z&&(ve*=256);)B<0&&me===0&&this[G+J-1]!==0&&(me=1),this[G+J]=(B/ve>>0)-me&255;return G+z},c.prototype.writeIntBE=function(B,G,z,fe){if(B=+B,G=G>>>0,!fe){var ue=Math.pow(2,8*z-1);oe(this,B,G,z,ue-1,-ue)}var J=z-1,ve=1,me=0;for(this[G+J]=B&255;--J>=0&&(ve*=256);)B<0&&me===0&&this[G+J+1]!==0&&(me=1),this[G+J]=(B/ve>>0)-me&255;return G+z},c.prototype.writeInt8=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,1,127,-128),B<0&&(B=255+B+1),this[G]=B&255,G+1},c.prototype.writeInt16LE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,2,32767,-32768),this[G]=B&255,this[G+1]=B>>>8,G+2},c.prototype.writeInt16BE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,2,32767,-32768),this[G]=B>>>8,this[G+1]=B&255,G+2},c.prototype.writeInt32LE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,4,2147483647,-2147483648),this[G]=B&255,this[G+1]=B>>>8,this[G+2]=B>>>16,this[G+3]=B>>>24,G+4},c.prototype.writeInt32BE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,4,2147483647,-2147483648),B<0&&(B=4294967295+B+1),this[G]=B>>>24,this[G+1]=B>>>16,this[G+2]=B>>>8,this[G+3]=B&255,G+4};function ge(U,B,G,z,fe,ue){if(G+z>U.length)throw new RangeError("Index out of range");if(G<0)throw new RangeError("Index out of range")}function _e(U,B,G,z,fe){return B=+B,G=G>>>0,fe||ge(U,B,G,4),l.write(U,B,G,z,23,4),G+4}c.prototype.writeFloatLE=function(B,G,z){return _e(this,B,G,!0,z)},c.prototype.writeFloatBE=function(B,G,z){return _e(this,B,G,!1,z)};function he(U,B,G,z,fe){return B=+B,G=G>>>0,fe||ge(U,B,G,8),l.write(U,B,G,z,52,8),G+8}c.prototype.writeDoubleLE=function(B,G,z){return he(this,B,G,!0,z)},c.prototype.writeDoubleBE=function(B,G,z){return he(this,B,G,!1,z)},c.prototype.copy=function(B,G,z,fe){if(!c.isBuffer(B))throw new TypeError("argument should be a Buffer");if(z||(z=0),!fe&&fe!==0&&(fe=this.length),G>=B.length&&(G=B.length),G||(G=0),fe>0&&fe<z&&(fe=z),fe===z||B.length===0||this.length===0)return 0;if(G<0)throw new RangeError("targetStart out of bounds");if(z<0||z>=this.length)throw new RangeError("Index out of range");if(fe<0)throw new RangeError("sourceEnd out of bounds");fe>this.length&&(fe=this.length),B.length-G<fe-z&&(fe=B.length-G+z);var ue=fe-z;return this===B&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(G,z,fe):Uint8Array.prototype.set.call(B,this.subarray(z,fe),G),ue},c.prototype.fill=function(B,G,z,fe){if(typeof B=="string"){if(typeof G=="string"?(fe=G,G=0,z=this.length):typeof z=="string"&&(fe=z,z=this.length),fe!==void 0&&typeof fe!="string")throw new TypeError("encoding must be a string");if(typeof fe=="string"&&!c.isEncoding(fe))throw new TypeError("Unknown encoding: "+fe);if(B.length===1){var ue=B.charCodeAt(0);(fe==="utf8"&&ue<128||fe==="latin1")&&(B=ue)}}else typeof B=="number"?B=B&255:typeof B=="boolean"&&(B=Number(B));if(G<0||this.length<G||this.length<z)throw new RangeError("Out of range index");if(z<=G)return this;G=G>>>0,z=z===void 0?this.length:z>>>0,B||(B=0);var J;if(typeof B=="number")for(J=G;J<z;++J)this[J]=B;else{var ve=c.isBuffer(B)?B:c.from(B,fe),me=ve.length;if(me===0)throw new TypeError('The value "'+B+'" is invalid for argument "value"');for(J=0;J<z-G;++J)this[J+G]=ve[J%me]}return this};var se=/[^+/0-9A-Za-z-_]/g;function Z(U){if(U=U.split("=")[0],U=U.trim().replace(se,""),U.length<2)return"";for(;U.length%4!==0;)U=U+"=";return U}function q(U,B){B=B||1/0;for(var G,z=U.length,fe=null,ue=[],J=0;J<z;++J){if(G=U.charCodeAt(J),G>55295&&G<57344){if(!fe){if(G>56319){(B-=3)>-1&&ue.push(239,191,189);continue}else if(J+1===z){(B-=3)>-1&&ue.push(239,191,189);continue}fe=G;continue}if(G<56320){(B-=3)>-1&&ue.push(239,191,189),fe=G;continue}G=(fe-55296<<10|G-56320)+65536}else fe&&(B-=3)>-1&&ue.push(239,191,189);if(fe=null,G<128){if((B-=1)<0)break;ue.push(G)}else if(G<2048){if((B-=2)<0)break;ue.push(G>>6|192,G&63|128)}else if(G<65536){if((B-=3)<0)break;ue.push(G>>12|224,G>>6&63|128,G&63|128)}else if(G<1114112){if((B-=4)<0)break;ue.push(G>>18|240,G>>12&63|128,G>>6&63|128,G&63|128)}else throw new Error("Invalid code point")}return ue}function le(U){for(var B=[],G=0;G<U.length;++G)B.push(U.charCodeAt(G)&255);return B}function te(U,B){for(var G,z,fe,ue=[],J=0;J<U.length&&!((B-=2)<0);++J)G=U.charCodeAt(J),z=G>>8,fe=G%256,ue.push(fe),ue.push(z);return ue}function N(U){return u.toByteArray(Z(U))}function D(U,B,G,z){for(var fe=0;fe<z&&!(fe+G>=B.length||fe>=U.length);++fe)B[fe+G]=U[fe];return fe}function w(U,B){return U instanceof B||U!=null&&U.constructor!=null&&U.constructor.name!=null&&U.constructor.name===B.name}function W(U){return U!==U}var H=function(){for(var U="0123456789abcdef",B=new Array(256),G=0;G<16;++G)for(var z=G*16,fe=0;fe<16;++fe)B[z+fe]=U[G]+U[fe];return B}()},"./node_modules/buffer/node_modules/base64-js/index.js":(h,i)=>{i.byteLength=c,i.toByteArray=O,i.fromByteArray=L;for(var r=[],u=[],l=typeof Uint8Array<"u"?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,_=f.length;d<_;++d)r[d]=f[d],u[f.charCodeAt(d)]=d;u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63;function E(R){var T=R.length;if(T%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=R.indexOf("=");m===-1&&(m=T);var M=m===T?0:4-m%4;return[m,M]}function c(R){var T=E(R),m=T[0],M=T[1];return(m+M)*3/4-M}function y(R,T,m){return(T+m)*3/4-m}function O(R){var T,m=E(R),M=m[0],p=m[1],C=new l(y(R,M,p)),I=0,A=p>0?M-4:M,S;for(S=0;S<A;S+=4)T=u[R.charCodeAt(S)]<<18|u[R.charCodeAt(S+1)]<<12|u[R.charCodeAt(S+2)]<<6|u[R.charCodeAt(S+3)],C[I++]=T>>16&255,C[I++]=T>>8&255,C[I++]=T&255;return p===2&&(T=u[R.charCodeAt(S)]<<2|u[R.charCodeAt(S+1)]>>4,C[I++]=T&255),p===1&&(T=u[R.charCodeAt(S)]<<10|u[R.charCodeAt(S+1)]<<4|u[R.charCodeAt(S+2)]>>2,C[I++]=T>>8&255,C[I++]=T&255),C}function P(R){return r[R>>18&63]+r[R>>12&63]+r[R>>6&63]+r[R&63]}function b(R,T,m){for(var M,p=[],C=T;C<m;C+=3)M=(R[C]<<16&16711680)+(R[C+1]<<8&65280)+(R[C+2]&255),p.push(P(M));return p.join("")}function L(R){for(var T,m=R.length,M=m%3,p=[],C=16383,I=0,A=m-M;I<A;I+=C)p.push(b(R,I,I+C>A?A:I+C));return M===1?(T=R[m-1],p.push(r[T>>2]+r[T<<4&63]+"==")):M===2&&(T=(R[m-2]<<8)+R[m-1],p.push(r[T>>10]+r[T>>4&63]+r[T<<2&63]+"=")),p.join("")}},"./node_modules/buffer/node_modules/ieee754/index.js":(h,i)=>{/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */i.read=function(r,u,l,f,d){var _,E,c=d*8-f-1,y=(1<<c)-1,O=y>>1,P=-7,b=l?d-1:0,L=l?-1:1,R=r[u+b];for(b+=L,_=R&(1<<-P)-1,R>>=-P,P+=c;P>0;_=_*256+r[u+b],b+=L,P-=8);for(E=_&(1<<-P)-1,_>>=-P,P+=f;P>0;E=E*256+r[u+b],b+=L,P-=8);if(_===0)_=1-O;else{if(_===y)return E?NaN:(R?-1:1)*(1/0);E=E+Math.pow(2,f),_=_-O}return(R?-1:1)*E*Math.pow(2,_-f)},i.write=function(r,u,l,f,d,_){var E,c,y,O=_*8-d-1,P=(1<<O)-1,b=P>>1,L=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=f?0:_-1,T=f?1:-1,m=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(c=isNaN(u)?1:0,E=P):(E=Math.floor(Math.log(u)/Math.LN2),u*(y=Math.pow(2,-E))<1&&(E--,y*=2),E+b>=1?u+=L/y:u+=L*Math.pow(2,1-b),u*y>=2&&(E++,y/=2),E+b>=P?(c=0,E=P):E+b>=1?(c=(u*y-1)*Math.pow(2,d),E=E+b):(c=u*Math.pow(2,b-1)*Math.pow(2,d),E=0));d>=8;r[l+R]=c&255,R+=T,c/=256,d-=8);for(E=E<<d|c,O+=d;O>0;r[l+R]=E&255,R+=T,E/=256,O-=8);r[l+R-T]|=m*128}},"./node_modules/codem-isoboxer/dist/iso_boxer.js":(h,i)=>{/*! codem-isoboxer v0.3.6 https://github.com/madebyhiro/codem-isoboxer/blob/master/LICENSE.txt */var r={};r.parseBuffer=function(f){return new u(f).parse()},r.addBoxProcessor=function(f,d){typeof f!="string"||typeof d!="function"||(l.prototype._boxProcessors[f]=d)},r.createFile=function(){return new u},r.createBox=function(f,d,_){var E=l.create(f);return d&&d.append(E,_),E},r.createFullBox=function(f,d,_){var E=r.createBox(f,d,_);return E.version=0,E.flags=0,E},r.Utils={},r.Utils.dataViewToString=function(f,d){var _=d||"utf-8";if(typeof TextDecoder<"u")return new TextDecoder(_).decode(f);var E=[],c=0;if(_==="utf-8")for(;c<f.byteLength;){var y=f.getUint8(c++);y<128||(y<224?(y=(y&31)<<6,y|=f.getUint8(c++)&63):y<240?(y=(y&15)<<12,y|=(f.getUint8(c++)&63)<<6,y|=f.getUint8(c++)&63):(y=(y&7)<<18,y|=(f.getUint8(c++)&63)<<12,y|=(f.getUint8(c++)&63)<<6,y|=f.getUint8(c++)&63)),E.push(String.fromCharCode(y))}else for(;c<f.byteLength;)E.push(String.fromCharCode(f.getUint8(c++)));return E.join("")},r.Utils.utf8ToByteArray=function(f){var d,_;if(typeof TextEncoder<"u")d=new TextEncoder().encode(f);else for(d=[],_=0;_<f.length;++_){var E=f.charCodeAt(_);E<128?d.push(E):E<2048?(d.push(192|E>>6),d.push(128|63&E)):E<65536?(d.push(224|E>>12),d.push(128|63&E>>6),d.push(128|63&E)):(d.push(240|E>>18),d.push(128|63&E>>12),d.push(128|63&E>>6),d.push(128|63&E))}return d},r.Utils.appendBox=function(f,d,_){if(d._offset=f._cursor.offset,d._root=f._root?f._root:f,d._raw=f._raw,d._parent=f,_!==-1){if(_==null){f.boxes.push(d);return}var E=-1,c;if(typeof _=="number")E=_;else{if(typeof _=="string")c=_;else if(typeof _=="object"&&_.type)c=_.type;else{f.boxes.push(d);return}for(var y=0;y<f.boxes.length;y++)if(c===f.boxes[y].type){E=y+1;break}}f.boxes.splice(E,0,d)}},i.parseBuffer=r.parseBuffer,i.addBoxProcessor=r.addBoxProcessor,i.createFile=r.createFile,i.createBox=r.createBox,i.createFullBox=r.createFullBox,i.Utils=r.Utils,r.Cursor=function(f){this.offset=typeof f>"u"?0:f};var u=function(f){this._cursor=new r.Cursor,this.boxes=[],f&&(this._raw=new DataView(f))};u.prototype.fetch=function(f){var d=this.fetchAll(f,!0);return d.length?d[0]:null},u.prototype.fetchAll=function(f,d){var _=[];return u._sweep.call(this,f,_,d),_},u.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var f=l.parse(this);if(typeof f.type>"u")break;this.boxes.push(f)}return this},u._sweep=function(f,d,_){this.type&&this.type==f&&d.push(this);for(var E in this.boxes){if(d.length&&_)return;u._sweep.call(this.boxes[E],f,d,_)}},u.prototype.write=function(){var f=0,d;for(d=0;d<this.boxes.length;d++)f+=this.boxes[d].getLength(!1);var _=new Uint8Array(f);for(this._rawo=new DataView(_.buffer),this.bytes=_,this._cursor.offset=0,d=0;d<this.boxes.length;d++)this.boxes[d].write();return _.buffer},u.prototype.append=function(f,d){r.Utils.appendBox(this,f,d)};var l=function(){this._cursor=new r.Cursor};l.parse=function(f){var d=new l;return d._offset=f._cursor.offset,d._root=f._root?f._root:f,d._raw=f._raw,d._parent=f,d._parseBox(),f._cursor.offset=d._raw.byteOffset+d._raw.byteLength,d},l.create=function(f){var d=new l;return d.type=f,d.boxes=[],d},l.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],l.prototype._boxProcessors={},l.prototype._procField=function(f,d,_){this._parsing?this[f]=this._readField(d,_):this._writeField(d,_,this[f])},l.prototype._procFieldArray=function(f,d,_,E){var c;if(this._parsing)for(this[f]=[],c=0;c<d;c++)this[f][c]=this._readField(_,E);else for(c=0;c<this[f].length;c++)this._writeField(_,E,this[f][c])},l.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},l.prototype._procEntries=function(f,d,_){var E;if(this._parsing)for(this[f]=[],E=0;E<d;E++)this[f].push({}),_.call(this,this[f][E]);else for(E=0;E<d;E++)_.call(this,this[f][E])},l.prototype._procSubEntries=function(f,d,_,E){var c;if(this._parsing)for(f[d]=[],c=0;c<_;c++)f[d].push({}),E.call(this,f[d][c]);else for(c=0;c<_;c++)E.call(this,f[d][c])},l.prototype._procEntryField=function(f,d,_,E){this._parsing?f[d]=this._readField(_,E):this._writeField(_,E,f[d])},l.prototype._procSubBoxes=function(f,d){var _;if(this._parsing)for(this[f]=[],_=0;_<d;_++)this[f].push(l.parse(this));else for(_=0;_<d;_++)this._rawo?this[f][_].write():this.size+=this[f][_].getLength()},l.prototype._readField=function(f,d){switch(f){case"uint":return this._readUint(d);case"int":return this._readInt(d);case"template":return this._readTemplate(d);case"string":return d===-1?this._readTerminatedString():this._readString(d);case"data":return this._readData(d);case"utf8":return this._readUTF8String();default:return-1}},l.prototype._readInt=function(f){var d=null,_=this._cursor.offset-this._raw.byteOffset;switch(f){case 8:d=this._raw.getInt8(_);break;case 16:d=this._raw.getInt16(_);break;case 32:d=this._raw.getInt32(_);break;case 64:var E=this._raw.getInt32(_),c=this._raw.getInt32(_+4);d=E*Math.pow(2,32)+c;break}return this._cursor.offset+=f>>3,d},l.prototype._readUint=function(f){var d=null,_=this._cursor.offset-this._raw.byteOffset,E,c;switch(f){case 8:d=this._raw.getUint8(_);break;case 16:d=this._raw.getUint16(_);break;case 24:E=this._raw.getUint16(_),c=this._raw.getUint8(_+2),d=(E<<8)+c;break;case 32:d=this._raw.getUint32(_);break;case 64:E=this._raw.getUint32(_),c=this._raw.getUint32(_+4),d=E*Math.pow(2,32)+c;break}return this._cursor.offset+=f>>3,d},l.prototype._readString=function(f){for(var d="",_=0;_<f;_++){var E=this._readUint(8);d+=String.fromCharCode(E)}return d},l.prototype._readTemplate=function(f){var d=this._readUint(f/2),_=this._readUint(f/2);return d+_/Math.pow(2,f/2)},l.prototype._readTerminatedString=function(){for(var f="";this._cursor.offset-this._offset<this._raw.byteLength;){var d=this._readUint(8);if(d===0)break;f+=String.fromCharCode(d)}return f},l.prototype._readData=function(f){var d=f>0?f:this._raw.byteLength-(this._cursor.offset-this._offset);if(d>0){var _=new Uint8Array(this._raw.buffer,this._cursor.offset,d);return this._cursor.offset+=d,_}else return null},l.prototype._readUTF8String=function(){var f=this._raw.byteLength-(this._cursor.offset-this._offset),d=null;return f>0&&(d=new DataView(this._raw.buffer,this._cursor.offset,f),this._cursor.offset+=f),d&&r.Utils.dataViewToString(d)},l.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength){this._root._incomplete=!0;return}switch(this._procField("size","uint",32),this._procField("type","string",4),this.size===1&&this._procField("largesize","uint",64),this.type==="uuid"&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1?this._parseContainerBox():this._data=this._readData())},l.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},l.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(l.parse(this))},l.prototype.append=function(f,d){r.Utils.appendBox(this,f,d)},l.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),this.size===1&&this._procField("largesize","uint",64),this.type==="uuid"&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1)for(var f=0;f<this.boxes.length;f++)this.size+=this.boxes[f].getLength();return this._data&&this._writeData(this._data),this.size},l.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),this.size===1&&this._procField("largesize","uint",64),this.type==="uuid"&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1)for(var f=0;f<this.boxes.length;f++)this.boxes[f].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},l.prototype._writeInt=function(f,d){if(this._rawo){var _=this._cursor.offset-this._rawo.byteOffset;switch(f){case 8:this._rawo.setInt8(_,d);break;case 16:this._rawo.setInt16(_,d);break;case 32:this._rawo.setInt32(_,d);break;case 64:var E=Math.floor(d/Math.pow(2,32)),c=d-E*Math.pow(2,32);this._rawo.setUint32(_,E),this._rawo.setUint32(_+4,c);break}this._cursor.offset+=f>>3}else this.size+=f>>3},l.prototype._writeUint=function(f,d){if(this._rawo){var _=this._cursor.offset-this._rawo.byteOffset,E,c;switch(f){case 8:this._rawo.setUint8(_,d);break;case 16:this._rawo.setUint16(_,d);break;case 24:E=(d&16776960)>>8,c=d&255,this._rawo.setUint16(_,E),this._rawo.setUint8(_+2,c);break;case 32:this._rawo.setUint32(_,d);break;case 64:E=Math.floor(d/Math.pow(2,32)),c=d-E*Math.pow(2,32),this._rawo.setUint32(_,E),this._rawo.setUint32(_+4,c);break}this._cursor.offset+=f>>3}else this.size+=f>>3},l.prototype._writeString=function(f,d){for(var _=0;_<f;_++)this._writeUint(8,d.charCodeAt(_))},l.prototype._writeTerminatedString=function(f){if(f.length!==0){for(var d=0;d<f.length;d++)this._writeUint(8,f.charCodeAt(d));this._writeUint(8,0)}},l.prototype._writeTemplate=function(f,d){var _=Math.floor(d),E=(d-_)*Math.pow(2,f/2);this._writeUint(f/2,_),this._writeUint(f/2,E)},l.prototype._writeData=function(f){var d;if(f)if(this._rawo){if(f instanceof Array){for(var _=this._cursor.offset-this._rawo.byteOffset,d=0;d<f.length;d++)this._rawo.setInt8(_+d,f[d]);this._cursor.offset+=f.length}f instanceof Uint8Array&&(this._root.bytes.set(f,this._cursor.offset),this._cursor.offset+=f.length)}else this.size+=f.length},l.prototype._writeUTF8String=function(f){var d=r.Utils.utf8ToByteArray(f);if(this._rawo)for(var _=new DataView(this._rawo.buffer,this._cursor.offset,d.length),E=0;E<d.length;E++)_.setUint8(E,d[E]);else this.size+=d.length},l.prototype._writeField=function(f,d,_){switch(f){case"uint":this._writeUint(d,_);break;case"int":this._writeInt(d,_);break;case"template":this._writeTemplate(d,_);break;case"string":d==-1?this._writeTerminatedString(_):this._writeString(d,_);break;case"data":this._writeData(_);break;case"utf8":this._writeUTF8String(_);break}},l.prototype._boxProcessors.avc1=l.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},l.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},l.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(f){this._procEntryField(f,"segment_duration","uint",this.version===1?64:32),this._procEntryField(f,"media_time","int",this.version===1?64:32),this._procEntryField(f,"media_rate_integer","int",16),this._procEntryField(f,"media_rate_fraction","int",16)})},l.prototype._boxProcessors.emsg=function(){this._procFullBox(),this.version==1?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},l.prototype._boxProcessors.free=l.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},l.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},l.prototype._boxProcessors.ftyp=l.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var f=-1;this._parsing&&(f=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",f,"string",4)},l.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},l.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},l.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",this.version==1?64:32),this._procField("modification_time","uint",this.version==1?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",this.version==1?64:32),!this._parsing&&typeof this.language=="string"&&(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode((this.language>>10&31)+96,(this.language>>5&31)+96,(this.language&31)+96)),this._procField("pre_defined","uint",16)},l.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",this.version==1?64:32)},l.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},l.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},l.prototype._boxProcessors.mp4a=l.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},l.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",this.version==1?64:32),this._procField("modification_time","uint",this.version==1?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",this.version==1?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},l.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},l.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},l.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),this.flags&1&&this._procField("scheme_uri","string",-1)},l.prototype._boxProcessors.sdtp=function(){this._procFullBox();var f=-1;this._parsing&&(f=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",f,"uint",8)},l.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",this.version==1?64:32),this._procField("first_offset","uint",this.version==1?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,function(f){this._parsing||(f.reference=(f.reference_type&1)<<31,f.reference|=f.referenced_size&2147483647,f.sap=(f.starts_with_SAP&1)<<31,f.sap|=(f.SAP_type&3)<<28,f.sap|=f.SAP_delta_time&268435455),this._procEntryField(f,"reference","uint",32),this._procEntryField(f,"subsegment_duration","uint",32),this._procEntryField(f,"sap","uint",32),this._parsing&&(f.reference_type=f.reference>>31&1,f.referenced_size=f.reference&2147483647,f.starts_with_SAP=f.sap>>31&1,f.SAP_type=f.sap>>28&7,f.SAP_delta_time=f.sap&268435455)})},l.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},l.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,function(f){this._procEntryField(f,"ranges_count","uint",32),this._procSubEntries(f,"ranges",f.ranges_count,function(d){this._procEntryField(d,"level","uint",8),this._procEntryField(d,"range_size","uint",24)})})},l.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},l.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(f){this._procEntryField(f,"sample_delta","uint",32),this._procEntryField(f,"subsample_count","uint",16),this._procSubEntries(f,"subsamples",f.subsample_count,function(d){this._procEntryField(d,"subsample_size","uint",this.version===1?32:16),this._procEntryField(d,"subsample_priority","uint",8),this._procEntryField(d,"discardable","uint",8),this._procEntryField(d,"codec_specific_parameters","uint",32)})})},l.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},l.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",this.version==1?64:32)},l.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),this.flags&1&&this._procField("base_data_offset","uint",64),this.flags&2&&this._procField("sample_description_offset","uint",32),this.flags&8&&this._procField("default_sample_duration","uint",32),this.flags&16&&this._procField("default_sample_size","uint",32),this.flags&32&&this._procField("default_sample_flags","uint",32)},l.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(this.length_size_of_traf_num&48)<<4,this.reserved|=(this.length_size_of_trun_num&12)<<2,this.reserved|=this.length_size_of_sample_num&3),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(this.reserved&48)>>4,this.length_size_of_trun_num=(this.reserved&12)>>2,this.length_size_of_sample_num=this.reserved&3),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,function(f){this._procEntryField(f,"time","uint",this.version===1?64:32),this._procEntryField(f,"moof_offset","uint",this.version===1?64:32),this._procEntryField(f,"traf_number","uint",(this.length_size_of_traf_num+1)*8),this._procEntryField(f,"trun_number","uint",(this.length_size_of_trun_num+1)*8),this._procEntryField(f,"sample_number","uint",(this.length_size_of_sample_num+1)*8)})},l.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",this.version==1?64:32),this._procField("modification_time","uint",this.version==1?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",this.version==1?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},l.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},l.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),this.flags&1&&this._procField("data_offset","int",32),this.flags&4&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,function(f){this.flags&256&&this._procEntryField(f,"sample_duration","uint",32),this.flags&512&&this._procEntryField(f,"sample_size","uint",32),this.flags&1024&&this._procEntryField(f,"sample_flags","uint",32),this.flags&2048&&this._procEntryField(f,"sample_composition_time_offset",this.version===1?"int":"uint",32)})},l.prototype._boxProcessors["url "]=l.prototype._boxProcessors["urn "]=function(){this._procFullBox(),this.type==="urn "&&this._procField("name","string",-1),this._procField("location","string",-1)},l.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},l.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},l.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},l.prototype._boxProcessors.vtte=function(){}},"./node_modules/es6-promise/auto.js":(h,i,r)=>{h.exports=r("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},"./node_modules/es6-promise/dist/es6-promise.js":function(h,i,r){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(u,l){h.exports=l()})(this,function(){function u(J){var ve=typeof J;return J!==null&&(ve==="object"||ve==="function")}function l(J){return typeof J=="function"}var f=void 0;Array.isArray?f=Array.isArray:f=function(J){return Object.prototype.toString.call(J)==="[object Array]"};var d=f,_=0,E=void 0,c=void 0,y=function(ve,me){S[_]=ve,S[_+1]=me,_+=2,_===2&&(c?c(x):k())};function O(J){c=J}function P(J){y=J}var b=typeof window<"u"?window:void 0,L=b||{},R=L.MutationObserver||L.WebKitMutationObserver,T=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",m=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function M(){return function(){return process.nextTick(x)}}function p(){return typeof E<"u"?function(){E(x)}:A()}function C(){var J=0,ve=new R(x),me=document.createTextNode("");return ve.observe(me,{characterData:!0}),function(){me.data=J=++J%2}}function I(){var J=new MessageChannel;return J.port1.onmessage=x,function(){return J.port2.postMessage(0)}}function A(){var J=setTimeout;return function(){return J(x,1)}}var S=new Array(1e3);function x(){for(var J=0;J<_;J+=2){var ve=S[J],me=S[J+1];ve(me),S[J]=void 0,S[J+1]=void 0}_=0}function F(){try{var J=Function("return this")().require("vertx");return E=J.runOnLoop||J.runOnContext,p()}catch{return A()}}var k=void 0;T?k=M():R?k=C():m?k=I():b===void 0?k=F():k=A();function j(J,ve){var me=this,Ae=new this.constructor($);Ae[Q]===void 0&&D(Ae);var be=me._state;if(be){var Be=arguments[be-1];y(function(){return q(be,Ae,Be,me._result)})}else se(me,Ae,J,ve);return Ae}function V(J){var ve=this;if(J&&typeof J=="object"&&J.constructor===ve)return J;var me=new ve($);return oe(me,J),me}var Q=Math.random().toString(36).substring(2);function $(){}var K=void 0,Y=1,re=2;function ie(){return new TypeError("You cannot resolve a promise with itself")}function ee(){return new TypeError("A promises callback cannot return that same promise.")}function ne(J,ve,me,Ae){try{J.call(ve,me,Ae)}catch(be){return be}}function ae(J,ve,me){y(function(Ae){var be=!1,Be=ne(me,ve,function(ke){be||(be=!0,ve!==ke?oe(Ae,ke):_e(Ae,ke))},function(ke){be||(be=!0,he(Ae,ke))},"Settle: "+(Ae._label||" unknown promise"));!be&&Be&&(be=!0,he(Ae,Be))},J)}function ce(J,ve){ve._state===Y?_e(J,ve._result):ve._state===re?he(J,ve._result):se(ve,void 0,function(me){return oe(J,me)},function(me){return he(J,me)})}function X(J,ve,me){ve.constructor===J.constructor&&me===j&&ve.constructor.resolve===V?ce(J,ve):me===void 0?_e(J,ve):l(me)?ae(J,ve,me):_e(J,ve)}function oe(J,ve){if(J===ve)he(J,ie());else if(u(ve)){var me=void 0;try{me=ve.then}catch(Ae){he(J,Ae);return}X(J,ve,me)}else _e(J,ve)}function ge(J){J._onerror&&J._onerror(J._result),Z(J)}function _e(J,ve){J._state===K&&(J._result=ve,J._state=Y,J._subscribers.length!==0&&y(Z,J))}function he(J,ve){J._state===K&&(J._state=re,J._result=ve,y(ge,J))}function se(J,ve,me,Ae){var be=J._subscribers,Be=be.length;J._onerror=null,be[Be]=ve,be[Be+Y]=me,be[Be+re]=Ae,Be===0&&J._state&&y(Z,J)}function Z(J){var ve=J._subscribers,me=J._state;if(ve.length!==0){for(var Ae=void 0,be=void 0,Be=J._result,ke=0;ke<ve.length;ke+=3)Ae=ve[ke],be=ve[ke+me],Ae?q(me,Ae,be,Be):be(Be);J._subscribers.length=0}}function q(J,ve,me,Ae){var be=l(me),Be=void 0,ke=void 0,Ye=!0;if(be){try{Be=me(Ae)}catch(Le){Ye=!1,ke=Le}if(ve===Be){he(ve,ee());return}}else Be=Ae;ve._state!==K||(be&&Ye?oe(ve,Be):Ye===!1?he(ve,ke):J===Y?_e(ve,Be):J===re&&he(ve,Be))}function le(J,ve){try{ve(function(Ae){oe(J,Ae)},function(Ae){he(J,Ae)})}catch(me){he(J,me)}}var te=0;function N(){return te++}function D(J){J[Q]=te++,J._state=void 0,J._result=void 0,J._subscribers=[]}function w(){return new Error("Array Methods must be provided an Array")}var W=function(){function J(ve,me){this._instanceConstructor=ve,this.promise=new ve($),this.promise[Q]||D(this.promise),d(me)?(this.length=me.length,this._remaining=me.length,this._result=new Array(this.length),this.length===0?_e(this.promise,this._result):(this.length=this.length||0,this._enumerate(me),this._remaining===0&&_e(this.promise,this._result))):he(this.promise,w())}return J.prototype._enumerate=function(me){for(var Ae=0;this._state===K&&Ae<me.length;Ae++)this._eachEntry(me[Ae],Ae)},J.prototype._eachEntry=function(me,Ae){var be=this._instanceConstructor,Be=be.resolve;if(Be===V){var ke=void 0,Ye=void 0,Le=!1;try{ke=me.then}catch(Me){Le=!0,Ye=Me}if(ke===j&&me._state!==K)this._settledAt(me._state,Ae,me._result);else if(typeof ke!="function")this._remaining--,this._result[Ae]=me;else if(be===fe){var Se=new be($);Le?he(Se,Ye):X(Se,me,ke),this._willSettleAt(Se,Ae)}else this._willSettleAt(new be(function(Me){return Me(me)}),Ae)}else this._willSettleAt(Be(me),Ae)},J.prototype._settledAt=function(me,Ae,be){var Be=this.promise;Be._state===K&&(this._remaining--,me===re?he(Be,be):this._result[Ae]=be),this._remaining===0&&_e(Be,this._result)},J.prototype._willSettleAt=function(me,Ae){var be=this;se(me,void 0,function(Be){return be._settledAt(Y,Ae,Be)},function(Be){return be._settledAt(re,Ae,Be)})},J}();function H(J){return new W(this,J).promise}function U(J){var ve=this;return d(J)?new ve(function(me,Ae){for(var be=J.length,Be=0;Be<be;Be++)ve.resolve(J[Be]).then(me,Ae)}):new ve(function(me,Ae){return Ae(new TypeError("You must pass an array to race."))})}function B(J){var ve=this,me=new ve($);return he(me,J),me}function G(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var fe=function(){function J(ve){this[Q]=N(),this._result=this._state=void 0,this._subscribers=[],$!==ve&&(typeof ve!="function"&&G(),this instanceof J?le(this,ve):z())}return J.prototype.catch=function(me){return this.then(null,me)},J.prototype.finally=function(me){var Ae=this,be=Ae.constructor;return l(me)?Ae.then(function(Be){return be.resolve(me()).then(function(){return Be})},function(Be){return be.resolve(me()).then(function(){throw Be})}):Ae.then(me,me)},J}();fe.prototype.then=j,fe.all=H,fe.race=U,fe.resolve=V,fe.reject=B,fe._setScheduler=O,fe._setAsap=P,fe._asap=y;function ue(){var J=void 0;if(typeof r.g<"u")J=r.g;else if(typeof self<"u")J=self;else try{J=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var ve=J.Promise;if(ve){var me=null;try{me=Object.prototype.toString.call(ve.resolve())}catch{}if(me==="[object Promise]"&&!ve.cast)return}J.Promise=fe}return fe.polyfill=ue,fe.Promise=fe,fe})},"./node_modules/events/events.js":h=>{var i=typeof Reflect=="object"?Reflect:null,r=i&&typeof i.apply=="function"?i.apply:function(A,S,x){return Function.prototype.apply.call(A,S,x)},u;i&&typeof i.ownKeys=="function"?u=i.ownKeys:Object.getOwnPropertySymbols?u=function(A){return Object.getOwnPropertyNames(A).concat(Object.getOwnPropertySymbols(A))}:u=function(A){return Object.getOwnPropertyNames(A)};function l(I){console&&console.warn&&console.warn(I)}var f=Number.isNaN||function(A){return A!==A};function d(){d.init.call(this)}h.exports=d,h.exports.once=M,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var _=10;function E(I){if(typeof I!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return _},set:function(I){if(typeof I!="number"||I<0||f(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");_=I}}),d.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(A){if(typeof A!="number"||A<0||f(A))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+A+".");return this._maxListeners=A,this};function c(I){return I._maxListeners===void 0?d.defaultMaxListeners:I._maxListeners}d.prototype.getMaxListeners=function(){return c(this)},d.prototype.emit=function(A){for(var S=[],x=1;x<arguments.length;x++)S.push(arguments[x]);var F=A==="error",k=this._events;if(k!==void 0)F=F&&k.error===void 0;else if(!F)return!1;if(F){var j;if(S.length>0&&(j=S[0]),j instanceof Error)throw j;var V=new Error("Unhandled error."+(j?" ("+j.message+")":""));throw V.context=j,V}var Q=k[A];if(Q===void 0)return!1;if(typeof Q=="function")r(Q,this,S);else for(var $=Q.length,K=R(Q,$),x=0;x<$;++x)r(K[x],this,S);return!0};function y(I,A,S,x){var F,k,j;if(E(S),k=I._events,k===void 0?(k=I._events=Object.create(null),I._eventsCount=0):(k.newListener!==void 0&&(I.emit("newListener",A,S.listener?S.listener:S),k=I._events),j=k[A]),j===void 0)j=k[A]=S,++I._eventsCount;else if(typeof j=="function"?j=k[A]=x?[S,j]:[j,S]:x?j.unshift(S):j.push(S),F=c(I),F>0&&j.length>F&&!j.warned){j.warned=!0;var V=new Error("Possible EventEmitter memory leak detected. "+j.length+" "+String(A)+" listeners added. Use emitter.setMaxListeners() to increase limit");V.name="MaxListenersExceededWarning",V.emitter=I,V.type=A,V.count=j.length,l(V)}return I}d.prototype.addListener=function(A,S){return y(this,A,S,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(A,S){return y(this,A,S,!0)};function O(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function P(I,A,S){var x={fired:!1,wrapFn:void 0,target:I,type:A,listener:S},F=O.bind(x);return F.listener=S,x.wrapFn=F,F}d.prototype.once=function(A,S){return E(S),this.on(A,P(this,A,S)),this},d.prototype.prependOnceListener=function(A,S){return E(S),this.prependListener(A,P(this,A,S)),this},d.prototype.removeListener=function(A,S){var x,F,k,j,V;if(E(S),F=this._events,F===void 0)return this;if(x=F[A],x===void 0)return this;if(x===S||x.listener===S)--this._eventsCount===0?this._events=Object.create(null):(delete F[A],F.removeListener&&this.emit("removeListener",A,x.listener||S));else if(typeof x!="function"){for(k=-1,j=x.length-1;j>=0;j--)if(x[j]===S||x[j].listener===S){V=x[j].listener,k=j;break}if(k<0)return this;k===0?x.shift():T(x,k),x.length===1&&(F[A]=x[0]),F.removeListener!==void 0&&this.emit("removeListener",A,V||S)}return this},d.prototype.off=d.prototype.removeListener,d.prototype.removeAllListeners=function(A){var S,x,F;if(x=this._events,x===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[A]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete x[A]),this;if(arguments.length===0){var k=Object.keys(x),j;for(F=0;F<k.length;++F)j=k[F],j!=="removeListener"&&this.removeAllListeners(j);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(S=x[A],typeof S=="function")this.removeListener(A,S);else if(S!==void 0)for(F=S.length-1;F>=0;F--)this.removeListener(A,S[F]);return this};function b(I,A,S){var x=I._events;if(x===void 0)return[];var F=x[A];return F===void 0?[]:typeof F=="function"?S?[F.listener||F]:[F]:S?m(F):R(F,F.length)}d.prototype.listeners=function(A){return b(this,A,!0)},d.prototype.rawListeners=function(A){return b(this,A,!1)},d.listenerCount=function(I,A){return typeof I.listenerCount=="function"?I.listenerCount(A):L.call(I,A)},d.prototype.listenerCount=L;function L(I){var A=this._events;if(A!==void 0){var S=A[I];if(typeof S=="function")return 1;if(S!==void 0)return S.length}return 0}d.prototype.eventNames=function(){return this._eventsCount>0?u(this._events):[]};function R(I,A){for(var S=new Array(A),x=0;x<A;++x)S[x]=I[x];return S}function T(I,A){for(;A+1<I.length;A++)I[A]=I[A+1];I.pop()}function m(I){for(var A=new Array(I.length),S=0;S<A.length;++S)A[S]=I[S].listener||I[S];return A}function M(I,A){return new Promise(function(S,x){function F(j){I.removeListener(A,k),x(j)}function k(){typeof I.removeListener=="function"&&I.removeListener("error",F),S([].slice.call(arguments))}C(I,A,k,{once:!0}),A!=="error"&&p(I,F,{once:!0})})}function p(I,A,S){typeof I.on=="function"&&C(I,"error",A,S)}function C(I,A,S,x){if(typeof I.on=="function")x.once?I.once(A,S):I.on(A,S);else if(typeof I.addEventListener=="function")I.addEventListener(A,function F(k){x.once&&I.removeEventListener(A,F),S(k)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I)}},"./node_modules/fast-deep-equal/index.js":h=>{var i=Array.isArray,r=Object.keys,u=Object.prototype.hasOwnProperty;h.exports=function l(f,d){if(f===d)return!0;if(f&&d&&typeof f=="object"&&typeof d=="object"){var _=i(f),E=i(d),c,y,O;if(_&&E){if(y=f.length,y!=d.length)return!1;for(c=y;c--!==0;)if(!l(f[c],d[c]))return!1;return!0}if(_!=E)return!1;var P=f instanceof Date,b=d instanceof Date;if(P!=b)return!1;if(P&&b)return f.getTime()==d.getTime();var L=f instanceof RegExp,R=d instanceof RegExp;if(L!=R)return!1;if(L&&R)return f.toString()==d.toString();var T=r(f);if(y=T.length,y!==r(d).length)return!1;for(c=y;c--!==0;)if(!u.call(d,T[c]))return!1;for(c=y;c--!==0;)if(O=T[c],!l(f[O],d[O]))return!1;return!0}return f!==f&&d!==d}},"./node_modules/imsc/src/main/js/doc.js":(h,i,r)=>{(function(u,l,f,d,_){u.fromXML=function(N,D,w){var W=l.parser(!0,{xmlns:!0}),H=[],U=[],B=[],G=0,z=null;W.onclosetag=function(me){if(H[0]instanceof P)for(var Ae in H[0].styles)_e(H[0],H[0].styles[Ae],D);else if(H[0]instanceof x||H[0]instanceof F){if(H[0].contents.length>1){var be=[H[0].contents[0]],Be;for(Be=1;Be<H[0].contents.length;Be++)H[0].contents[Be]instanceof k&&be[be.length-1]instanceof k?be[be.length-1].text+=H[0].contents[Be].text:be.push(H[0].contents[Be]);H[0].contents=be}H[0]instanceof F&&H[0].contents.length===1&&H[0].contents[0]instanceof k&&(H[0].text=H[0].contents[0].text,delete H[0].contents)}else H[0]instanceof c&&(H[0].node.uri===f.ns_tt&&H[0].node.local==="metadata"?G--:G>0&&w&&"onCloseTag"in w&&w.onCloseTag());B.shift(),U.shift(),H.shift()},W.ontext=function(me){if(H[0]!==void 0)if(H[0]instanceof F||H[0]instanceof x){var Ae=new k;Ae.initFromText(z,H[0],me,B[0],D),H[0].contents.push(Ae)}else H[0]instanceof c&&G>0&&w&&"onText"in w&&w.onText(me)},W.onopentag=function(me){var Ae=me.attributes["xml:space"];Ae?B.unshift(Ae.value):B.length===0?B.unshift("default"):B.unshift(B[0]);var be=me.attributes["xml:lang"];if(be?U.unshift(be.value):U.length===0?U.unshift(""):U.unshift(U[0]),me.uri===f.ns_tt)if(me.local==="tt")z!==null&&le(D,"Two <tt> elements at ("+this.line+","+this.column+")"),z=new y,z.initFromNode(me,D),H.unshift(z);else if(me.local==="head")H[0]instanceof y||le(D,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),z.head!==null&&le("Second <head> element at ("+this.line+","+this.column+")"),z.head=new O,H.unshift(z.head);else if(me.local==="styling")H[0]instanceof O||le(D,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),z.head.styling!==null&&le("Second <styling> element at ("+this.line+","+this.column+")"),z.head.styling=new P,H.unshift(z.head.styling);else if(me.local==="style"){var Be;H[0]instanceof P?(Be=new b,Be.initFromNode(me,D),Be.id?z.head.styling.styles[Be.id]=Be:q(D,"<style> element missing @id attribute"),H.unshift(Be)):H[0]instanceof V?(Be=new b,Be.initFromNode(me,D),se(Be.styleAttrs,H[0].styleAttrs),H.unshift(Be)):le(D,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if(me.local==="layout")H[0]instanceof O||le(D,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),z.head.layout!==null&&le(D,"Second <layout> element at "+this.line+","+this.column+")"),z.head.layout=new L,H.unshift(z.head.layout);else if(me.local==="region"){H[0]instanceof L||le(D,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var ke=new V;ke.initFromNode(z,me,D),!ke.id||ke.id in z.head.layout.regions?q(D,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):z.head.layout.regions[ke.id]=ke,H.unshift(ke)}else if(me.local==="body"){H[0]instanceof y||le(D,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),z.body!==null&&le(D,"Second <body> element at "+this.line+","+this.column+")");var Ye=new A;Ye.initFromNode(z,me,D),z.body=Ye,H.unshift(Ye)}else if(me.local==="div"){H[0]instanceof S||H[0]instanceof A||le(D,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var Le=new S;Le.initFromNode(z,H[0],me,D),H[0].contents.push(Le),H.unshift(Le)}else if(me.local==="p"){H[0]instanceof S||le(D,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var Se=new x;Se.initFromNode(z,H[0],me,D),H[0].contents.push(Se),H.unshift(Se)}else if(me.local==="span"){H[0]instanceof F||H[0]instanceof x||le(D,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var Me=new F;Me.initFromNode(z,H[0],me,B[0],D),H[0].contents.push(Me),H.unshift(Me)}else if(me.local==="br"){H[0]instanceof F||H[0]instanceof x||le(D,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var qe=new j;qe.initFromNode(z,H[0],me,D),H[0].contents.push(qe),H.unshift(qe)}else if(me.local==="set"){H[0]instanceof F||H[0]instanceof x||H[0]instanceof S||H[0]instanceof A||H[0]instanceof V||H[0]instanceof j||le(D,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var it=new Q;it.initFromNode(z,H[0],me,D),H[0].sets.push(it),H.unshift(it)}else H.unshift(new c(me));else H.unshift(new c(me));if(H[0]instanceof c){if(me.uri===f.ns_tt&&me.local==="metadata")G++;else if(G>0&&w&&"onOpenTag"in w){var at=[];for(var Ce in me.attributes)at[me.attributes[Ce].uri+" "+me.attributes[Ce].local]={uri:me.attributes[Ce].uri,local:me.attributes[Ce].local,value:me.attributes[Ce].value};w.onOpenTag(me.uri,me.local,at)}}},W.write(N).close(),z.head!==null?delete z.head.styling:z.head=new O,z.head.layout===null&&(z.head.layout=new L);var fe=!1;for(var ue in z.head.layout.regions){fe=!0;break}if(!fe){var J=V.prototype.createDefaultRegion();z.head.layout.regions[J.id]=J}for(var ve in z.head.layout.regions)E(z,z.head.layout.regions[ve],null,null);return z.body&&E(z,z.body,null,null),z};function E(N,D,w,W){var H=W&&W.timeContainer==="seq",U=0;W&&(H&&w?U=w.end:U=W.begin),D.begin=D.explicit_begin?D.explicit_begin+U:U;var B=D.begin,G=null;for(var z in D.sets)E(N,D.sets[z],G,D),D.timeContainer==="seq"?B=D.sets[z].end:B=Math.max(B,D.sets[z].end),G=D.sets[z];if(!("contents"in D))H?B=D.begin:B=Number.POSITIVE_INFINITY;else for(var fe in D.contents)E(N,D.contents[fe],G,D),D.timeContainer==="seq"?B=D.contents[fe].end:B=Math.max(B,D.contents[fe].end),G=D.contents[fe];D.explicit_end!==null&&D.explicit_dur!==null?D.end=Math.min(D.begin+D.explicit_dur,U+D.explicit_end):D.explicit_end===null&&D.explicit_dur!==null?D.end=D.begin+D.explicit_dur:D.explicit_end!==null&&D.explicit_dur===null?D.end=U+D.explicit_end:D.end=B,delete D.explicit_begin,delete D.explicit_dur,delete D.explicit_end,N._registerEvent(D)}function c(N){this.node=N}function y(){this.events=[],this.head=null,this.body=null}y.prototype.initFromNode=function(N,D){this.cellResolution=ae(N,D);var w=ce(N,D);this.effectiveFrameRate=w.effectiveFrameRate,this.tickRate=w.tickRate,this.aspectRatio=ne(N,D);var W=ee(N,f.ns_ttp,"timeBase");W!==null&&W!=="media"&&le(D,"Unsupported time base");var H=X(N,D);H===null?this.pxDimensions={h:480,w:640}:((H.h.unit!=="px"||H.w.unit!=="px")&&le(D,"Extent on TT must be in px or absent"),this.pxDimensions={h:H.h.value,w:H.w.value})},y.prototype._registerEvent=function(N){if(!(N.end<=N.begin)){var D=te(this.events,N.begin);if(D.found||this.events.splice(D.index,0,N.begin),N.end!==Number.POSITIVE_INFINITY){var w=te(this.events,N.end);w.found||this.events.splice(w.index,0,N.end)}}},y.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},y.prototype.getMediaTimeEvents=function(){return this.events};function O(){this.styling=null,this.layout=null}function P(){this.styles={}}function b(){this.id=null,this.styleAttrs=null,this.styleRefs=null}b.prototype.initFromNode=function(N,D){this.id=$(N),this.styleAttrs=ie(N,D),this.styleRefs=re(N)};function L(){this.regions={}}function R(N){this.kind=N}function T(N){this.id=N}T.prototype.initFromNode=function(N,D,w,W){this.id=$(w)};function m(N){this.regionID=N}m.prototype.initFromNode=function(N,D,w,W){this.regionID=K(w)};function M(N){this.styleAttrs=N}M.prototype.initFromNode=function(N,D,w,W){this.styleAttrs=ie(w,W),N.head!==null&&N.head.styling!==null&&he(N.head.styling,re(w),this.styleAttrs,W)};function p(N){this.sets=N}p.prototype.initFromNode=function(N,D,w,W){this.sets=[]};function C(N){this.contents=N}C.prototype.initFromNode=function(N,D,w,W){this.contents=[]};function I(N,D,w){this.explicit_begin=N,this.explicit_end=D,this.explicit_dur=w}I.prototype.initFromNode=function(N,D,w,W){var H=ge(N,D,w,W);this.explicit_begin=H.explicit_begin,this.explicit_end=H.explicit_end,this.explicit_dur=H.explicit_dur,this.timeContainer=Y(w,W)};function A(){R.call(this,"body")}A.prototype.initFromNode=function(N,D,w){M.prototype.initFromNode.call(this,N,null,D,w),I.prototype.initFromNode.call(this,N,null,D,w),p.prototype.initFromNode.call(this,N,null,D,w),m.prototype.initFromNode.call(this,N,null,D,w),C.prototype.initFromNode.call(this,N,null,D,w)};function S(){R.call(this,"div")}S.prototype.initFromNode=function(N,D,w,W){M.prototype.initFromNode.call(this,N,D,w,W),I.prototype.initFromNode.call(this,N,D,w,W),p.prototype.initFromNode.call(this,N,D,w,W),m.prototype.initFromNode.call(this,N,D,w,W),C.prototype.initFromNode.call(this,N,D,w,W)};function x(){R.call(this,"p")}x.prototype.initFromNode=function(N,D,w,W){M.prototype.initFromNode.call(this,N,D,w,W),I.prototype.initFromNode.call(this,N,D,w,W),p.prototype.initFromNode.call(this,N,D,w,W),m.prototype.initFromNode.call(this,N,D,w,W),C.prototype.initFromNode.call(this,N,D,w,W)};function F(){R.call(this,"span")}F.prototype.initFromNode=function(N,D,w,W,H){M.prototype.initFromNode.call(this,N,D,w,H),I.prototype.initFromNode.call(this,N,D,w,H),p.prototype.initFromNode.call(this,N,D,w,H),m.prototype.initFromNode.call(this,N,D,w,H),C.prototype.initFromNode.call(this,N,D,w,H),this.space=W};function k(){R.call(this,"span")}k.prototype.initFromText=function(N,D,w,W,H){I.prototype.initFromNode.call(this,N,D,null,H),this.text=w,this.space=W};function j(){R.call(this,"br")}j.prototype.initFromNode=function(N,D,w,W){m.prototype.initFromNode.call(this,N,D,w,W),I.prototype.initFromNode.call(this,N,D,w,W)};function V(){}V.prototype.createDefaultRegion=function(){var N=new V;return T.call(N,""),M.call(N,{}),p.call(N,[]),I.call(N,0,Number.POSITIVE_INFINITY,null),N},V.prototype.initFromNode=function(N,D,w){T.prototype.initFromNode.call(this,N,null,D,w),M.prototype.initFromNode.call(this,N,null,D,w),I.prototype.initFromNode.call(this,N,null,D,w),p.prototype.initFromNode.call(this,N,null,D,w),N.head!==null&&N.head.styling!==null&&he(N.head.styling,re(D),this.styleAttrs,w)};function Q(){}Q.prototype.initFromNode=function(N,D,w,W){I.prototype.initFromNode.call(this,N,D,w,W);var H=ie(w,W);this.qname=null,this.value=null;for(var U in H){if(this.qname){q(W,"More than one style specified on set");break}this.qname=U,this.value=H[U]}};function $(N){return N&&"xml:id"in N.attributes&&N.attributes["xml:id"].value||null}function K(N){return N&&"region"in N.attributes?N.attributes.region.value:""}function Y(N,D){var w=N&&"timeContainer"in N.attributes?N.attributes.timeContainer.value:null;return!w||w==="par"?"par":w==="seq"?"seq":(q(D,"Illegal value of timeContainer (assuming 'par')"),"par")}function re(N){return N&&"style"in N.attributes?N.attributes.style.value.split(" "):[]}function ie(N,D){var w={};if(N!==null)for(var W in N.attributes){var H=N.attributes[W].uri+" "+N.attributes[W].local,U=d.byQName[H];if(U!==void 0){var B=U.parse(N.attributes[W].value);B!==null?(w[H]=B,U===d.byName.zIndex&&Z(D,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):q(D,"Cannot parse styling attribute "+H+" --> "+N.attributes[W].value)}}return w}function ee(N,D,w){for(var W in N.attributes)if(N.attributes[W].uri===D&&N.attributes[W].local===w)return N.attributes[W].value;return null}function ne(N,D){var w=ee(N,f.ns_ittp,"aspectRatio"),W=null;if(w!==null){var H=/(\d+) (\d+)/,U=H.exec(w);if(U!==null){var B=parseInt(U[1]),G=parseInt(U[2]);B!==0&&G!==0?W=B/G:q(D,"Illegal aspectRatio values (ignoring)")}else q(D,"Malformed aspectRatio attribute (ignoring)")}return W}function ae(N,D){var w=ee(N,f.ns_ttp,"cellResolution"),W=15,H=32;if(w!==null){var U=/(\d+) (\d+)/,B=U.exec(w);B!==null?(H=parseInt(B[1]),W=parseInt(B[2])):Z(D,"Malformed cellResolution value (using initial value instead)")}return{w:H,h:W}}function ce(N,D){var w=ee(N,f.ns_ttp,"frameRate"),W=30,H;if(w!==null){var U=/(\d+)/;H=U.exec(w),H!==null?W=parseInt(H[1]):Z(D,"Malformed frame rate attribute (using initial value instead)")}var B=ee(N,f.ns_ttp,"frameRateMultiplier"),G=1;if(B!==null){var z=/(\d+) (\d+)/;H=z.exec(B),H!==null?G=parseInt(H[1])/parseInt(H[2]):Z(D,"Malformed frame rate multiplier attribute (using initial value instead)")}var fe=G*W,ue=1,J=ee(N,f.ns_ttp,"tickRate");if(J===null)w!==null&&(ue=fe);else{var ve=/(\d+)/;H=ve.exec(J),H!==null?ue=parseInt(H[1]):Z(D,"Malformed tick rate attribute (using initial value instead)")}return{effectiveFrameRate:fe,tickRate:ue}}function X(N,D){var w=ee(N,f.ns_tts,"extent");if(w===null)return null;var W=w.split(" ");if(W.length!==2)return Z(D,"Malformed extent (ignoring)"),null;var H=_.parseLength(W[0]),U=_.parseLength(W[1]);return!U||!H?(Z(D,"Malformed extent values (ignoring)"),null):{h:U,w:H}}function oe(N,D,w){var W=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/,H=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/,U=/^(\d+(?:\.\d+)?)f$/,B=/^(\d+(?:\.\d+)?)t$/,G=/^(\d+(?:\.\d+)?)ms$/,z=/^(\d+(?:\.\d+)?)s$/,fe=/^(\d+(?:\.\d+)?)h$/,ue=/^(\d+(?:\.\d+)?)m$/,J,ve=null;return(J=U.exec(w))!==null?D!==null&&(ve=parseFloat(J[1])/D):(J=B.exec(w))!==null?N!==null&&(ve=parseFloat(J[1])/N):(J=G.exec(w))!==null?ve=parseFloat(J[1])/1e3:(J=z.exec(w))!==null?ve=parseFloat(J[1]):(J=fe.exec(w))!==null?ve=parseFloat(J[1])*3600:(J=ue.exec(w))!==null?ve=parseFloat(J[1])*60:(J=W.exec(w))!==null?ve=parseInt(J[1])*3600+parseInt(J[2])*60+parseFloat(J[3]):(J=H.exec(w))!==null&&D!==null&&(ve=parseInt(J[1])*3600+parseInt(J[2])*60+parseInt(J[3])+(J[4]===null?0:parseInt(J[4])/D)),ve}function ge(N,D,w,W){var H=null;w&&"begin"in w.attributes&&(H=oe(N.tickRate,N.effectiveFrameRate,w.attributes.begin.value),H===null&&Z(W,"Malformed begin value "+w.attributes.begin.value+" (using 0)"));var U=null;w&&"dur"in w.attributes&&(U=oe(N.tickRate,N.effectiveFrameRate,w.attributes.dur.value),U===null&&Z(W,"Malformed dur value "+w.attributes.dur.value+" (ignoring)"));var B=null;return w&&"end"in w.attributes&&(B=oe(N.tickRate,N.effectiveFrameRate,w.attributes.end.value),B===null&&Z(W,"Malformed end value (ignoring)")),{explicit_begin:H,explicit_end:B,explicit_dur:U}}function _e(N,D,w){for(;D.styleRefs.length>0;){var W=D.styleRefs.pop();if(!(W in N.styles)){q(w,"Non-existant style id referenced");continue}_e(N,N.styles[W],w),se(N.styles[W].styleAttrs,D.styleAttrs)}}function he(N,D,w,W){for(var H=D.length-1;H>=0;H--){var U=D[H];if(!(U in N.styles)){q(W,"Non-existant style id referenced");continue}se(N.styles[U].styleAttrs,w)}}function se(N,D){for(var w in N)w in D||(D[w]=N[w])}function Z(N,D){if(N&&N.warn&&N.warn(D))throw D}function q(N,D){if(N&&N.error&&N.error(D))throw D}function le(N,D){throw N&&N.fatal&&N.fatal(D),D}function te(N,D){for(var w=0,W=N.length-1,H;w<=W;){H=Math.floor((w+W)/2);var U=N[H];if(U<D)w=H+1;else if(U>D)W=H-1;else return{found:!0,index:H}}return{found:!1,index:w}}})(i,typeof sax>"u"?r("./node_modules/sax/lib/sax.js"):sax,typeof imscNames>"u"?r("./node_modules/imsc/src/main/js/names.js"):imscNames,typeof imscStyles>"u"?r("./node_modules/imsc/src/main/js/styles.js"):imscStyles,typeof imscUtils>"u"?r("./node_modules/imsc/src/main/js/utils.js"):imscUtils)},"./node_modules/imsc/src/main/js/html.js":(h,i,r)=>{(function(u,l,f){u.render=function(p,C,I,A,S,x,F,k,j){var V=A||C.clientHeight,Q=S||C.clientWidth;if(p.aspectRatio!==null){var $=V*p.aspectRatio;$>Q?V=Math.round(Q/p.aspectRatio):Q=$}var K=document.createElement("div");K.style.position="relative",K.style.width=Q+"px",K.style.height=V+"px",K.style.margin="auto",K.style.top=0,K.style.bottom=0,K.style.left=0,K.style.right=0,K.style.zIndex=0;var Y={h:V,w:Q,regionH:null,regionW:null,imgResolver:I,displayForcedOnlyMode:x||!1,isd:p,errorHandler:F,previousISDState:k,enableRollUp:j||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null};C.appendChild(K);for(var re in p.contents)d(Y,K,p.contents[re]);return Y.currentISDState};function d(p,C,I){var A;if(I.kind==="region"?(A=document.createElement("div"),A.style.position="absolute"):I.kind==="body"||I.kind==="div"?A=document.createElement("div"):I.kind==="p"?A=document.createElement("p"):I.kind==="span"?A=document.createElement("span"):I.kind==="br"&&(A=document.createElement("br")),!A){M(p.errorHandler,"Error processing ISD element kind: "+I.kind);return}A.style.margin="0";for(var S in R){var x=R[S],F=I.styleAttrs[x.qname];F!==void 0&&x.map!==null&&x.map(p,A,I,F)}var k=A;if(I.kind==="region"){var j=I.styleAttrs[f.byName.writingMode.qname];j==="lrtb"||j==="lr"?(p.ipd="lr",p.bpd="tb"):j==="rltb"||j==="rl"?(p.ipd="rl",p.bpd="tb"):j==="tblr"?(p.ipd="tb",p.bpd="lr"):(j==="tbrl"||j==="tb")&&(p.ipd="tb",p.bpd="rl")}var V=I.styleAttrs[f.byName.linePadding.qname];if(V&&V>0){var Q=Math.ceil(V*p.h)+"px";p.bpd==="tb"?(k.style.paddingLeft=Q,k.style.paddingRight=Q):(k.style.paddingTop=Q,k.style.paddingBottom=Q),p.lp=V}var $=I.styleAttrs[f.byName.multiRowAlign.qname];if($&&$!=="auto"){var K=document.createElement("span");K.style.display="inline-block",K.style.textAlign=$,A.appendChild(K),k=K,p.mra=$}if(I.styleAttrs[f.byName.fillLineGap.qname]&&(p.flg=!0),I.kind==="span"&&I.text)if(p.lp||p.mra||p.flg)for(var Y="",re=0;re<I.text.length;re++){Y+=I.text.charAt(re);var ie=I.text.charCodeAt(re);if(ie<55296||ie>56319||re===I.text.length){var ee=document.createElement("span");ee.textContent=Y,A.appendChild(ee),Y=""}}else A.textContent=I.text;C.appendChild(A);for(var ne in I.contents)d(p,k,I.contents[ne]);var ae=[];if((p.lp||p.mra||p.flg)&&I.kind==="p"&&(P(p,k,ae,null),p.mra&&(E(ae),p.mra=null),p.lp&&(_(ae,p.lp*p.h,p),p.lp=null),p.flg)){var ce=O(k.getBoundingClientRect(),p);c(ae,ce.before,ce.after,p),p.flg=null}if(I.kind==="region"&&(P(p,k,ae),p.bpd==="tb"&&p.enableRollUp&&I.contents.length>0&&I.styleAttrs[f.byName.displayAlign.qname]==="after")){var X=I.id===""?"_":I.id,oe=new y(X,ae);if(p.currentISDState[oe.id]=oe,p.previousISDState&&oe.id in p.previousISDState&&p.previousISDState[oe.id].plist.length>0&&oe.plist.length>1&&oe.plist[oe.plist.length-2].text===p.previousISDState[oe.id].plist[p.previousISDState[oe.id].plist.length-1].text){var ge=A.firstElementChild,_e=oe.plist[oe.plist.length-1].after-oe.plist[oe.plist.length-1].before;ge.style.bottom="-"+_e+"px",ge.style.transition="transform 0.4s",ge.style.position="relative",ge.style.transform="translateY(-"+_e+"px)"}}}function _(p,C,I){for(var A in p){var S=p[A].elements.length,x=p[A].elements[p[A].start_elem],F=p[A].elements[p[A].end_elem],k=Math.ceil(C)+"px",j="-"+Math.ceil(C)+"px";S!==0&&(I.ipd==="lr"?(x.node.style.borderLeftColor=x.bgcolor||"#00000000",x.node.style.borderLeftStyle="solid",x.node.style.borderLeftWidth=k,x.node.style.marginLeft=j):I.ipd==="rl"?(x.node.style.borderRightColor=x.bgcolor||"#00000000",x.node.style.borderRightStyle="solid",x.node.style.borderRightWidth=k,x.node.style.marginRight=j):I.ipd==="tb"&&(x.node.style.borderTopColor=x.bgcolor||"#00000000",x.node.style.borderTopStyle="solid",x.node.style.borderTopWidth=k,x.node.style.marginTop=j),I.ipd==="lr"?(F.node.style.borderRightColor=F.bgcolor||"#00000000",F.node.style.borderRightStyle="solid",F.node.style.borderRightWidth=k,F.node.style.marginRight=j):I.ipd==="rl"?(F.node.style.borderLeftColor=F.bgcolor||"#00000000",F.node.style.borderLeftStyle="solid",F.node.style.borderLeftWidth=k,F.node.style.marginLeft=j):I.ipd==="tb"&&(F.node.style.borderBottomColor=F.bgcolor||"#00000000",F.node.style.borderBottomStyle="solid",F.node.style.borderBottomWidth=k,F.node.style.marginBottom=j))}}function E(p){for(var C=0;C<p.length-1;C++){var I=p[C].elements.length;if(I!==0&&p[C].br===!1){var A=document.createElement("br"),S=p[C].elements[I-1].node;S.parentElement.insertBefore(A,S.nextSibling)}}}function c(p,C,I,A){for(var S=Math.sign(I-C),x=0;x<=p.length;x++){var F;x===0?F=C:x===p.length?F=I:F=(p[x].before+p[x-1].after)/2;var k,j;if(x>0)for(var V=0;V<p[x-1].elements.length;V++)p[x-1].elements[V].bgcolor!==null&&(j=p[x-1].elements[V],S*(j.after-F)<0&&(k=Math.ceil(Math.abs(F-j.after))+"px",j.node.style.backgroundColor=j.bgcolor,A.bpd==="lr"?j.node.style.paddingRight=k:A.bpd==="rl"?j.node.style.paddingLeft=k:A.bpd==="tb"&&(j.node.style.paddingBottom=k)));if(x<p.length)for(var Q=0;Q<p[x].elements.length;Q++)j=p[x].elements[Q],j.bgcolor!==null&&S*(j.before-F)>0&&(k=Math.ceil(Math.abs(j.before-F))+"px",j.node.style.backgroundColor=j.bgcolor,A.bpd==="lr"?j.node.style.paddingLeft=k:A.bpd==="rl"?j.node.style.paddingRight=k:A.bpd==="tb"&&(j.node.style.paddingTop=k))}}function y(p,C){this.id=p,this.plist=C}function O(p,C){var I={before:null,after:null,start:null,end:null};return C.bpd==="tb"?(I.before=p.top,I.after=p.bottom,C.ipd==="lr"?(I.start=p.left,I.end=p.right):(I.start=p.right,I.end=p.left)):C.bpd==="lr"?(I.before=p.left,I.after=p.right,I.start=p.top,I.end=p.bottom):C.bpd==="rl"&&(I.before=p.right,I.after=p.left,I.start=p.top,I.end=p.bottom),I}function P(p,C,I,A){var S=C.style.backgroundColor||A;if(C.childElementCount===0)if(C.localName==="span"){var x=C.getBoundingClientRect();if(x.height===0||x.width===0)return;var F=O(x,p);if(I.length===0||!b(F.before,F.after,I[I.length-1].before,I[I.length-1].after))I.push({before:F.before,after:F.after,start:F.start,end:F.end,start_elem:0,end_elem:0,elements:[],text:"",br:!1});else{var k=Math.sign(F.after-F.before),j=Math.sign(F.end-F.start);k*(F.before-I[I.length-1].before)<0&&(I[I.length-1].before=F.before),k*(F.after-I[I.length-1].after)>0&&(I[I.length-1].after=F.after),j*(F.start-I[I.length-1].start)<0&&(I[I.length-1].start=F.start,I[I.length-1].start_elem=I[I.length-1].elements.length),j*(F.end-I[I.length-1].end)>0&&(I[I.length-1].end=F.end,I[I.length-1].end_elem=I[I.length-1].elements.length)}I[I.length-1].text+=C.textContent,I[I.length-1].elements.push({node:C,bgcolor:S,before:F.before,after:F.after})}else C.localName==="br"&&I.length!==0&&(I[I.length-1].br=!0);else for(var V=C.firstChild;V;)V.nodeType===Node.ELEMENT_NODE&&P(p,V,I,S),V=V.nextSibling}function b(p,C,I,A){return C<A&&p>I||A<=C&&I>=p}function L(p,C){this.qname=p,this.map=C}var R=[new L("http://www.w3.org/ns/ttml#styling backgroundColor",function(p,C,I,A){A[3]!==0&&(C.style.backgroundColor="rgba("+A[0].toString()+","+A[1].toString()+","+A[2].toString()+","+(A[3]/255).toString()+")")}),new L("http://www.w3.org/ns/ttml#styling color",function(p,C,I,A){C.style.color="rgba("+A[0].toString()+","+A[1].toString()+","+A[2].toString()+","+(A[3]/255).toString()+")"}),new L("http://www.w3.org/ns/ttml#styling direction",function(p,C,I,A){C.style.direction=A}),new L("http://www.w3.org/ns/ttml#styling display",function(p,C,I,A){}),new L("http://www.w3.org/ns/ttml#styling displayAlign",function(p,C,I,A){C.style.display="flex",C.style.flexDirection="column",A==="before"?C.style.justifyContent="flex-start":A==="center"?C.style.justifyContent="center":A==="after"&&(C.style.justifyContent="flex-end")}),new L("http://www.w3.org/ns/ttml#styling extent",function(p,C,I,A){p.regionH=A.h*p.h,p.regionW=A.w*p.w;var S=0,x=0,F=I.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];F&&(S=(F[0]+F[2])*p.h,x=(F[1]+F[3])*p.w),C.style.height=p.regionH-S+"px",C.style.width=p.regionW-x+"px"}),new L("http://www.w3.org/ns/ttml#styling fontFamily",function(p,C,I,A){var S=[];for(var x in A)A[x]==="monospaceSerif"?(S.push("Courier New"),S.push('"Liberation Mono"'),S.push("Courier"),S.push("monospace")):A[x]==="proportionalSansSerif"?(S.push("Arial"),S.push("Helvetica"),S.push('"Liberation Sans"'),S.push("sans-serif")):A[x]==="monospace"?S.push("monospace"):A[x]==="sansSerif"?S.push("sans-serif"):A[x]==="serif"?S.push("serif"):A[x]==="monospaceSansSerif"?(S.push("Consolas"),S.push("monospace")):A[x]==="proportionalSerif"?S.push("serif"):S.push(A[x]);C.style.fontFamily=S.join(",")}),new L("http://www.w3.org/ns/ttml#styling fontSize",function(p,C,I,A){C.style.fontSize=A*p.h+"px"}),new L("http://www.w3.org/ns/ttml#styling fontStyle",function(p,C,I,A){C.style.fontStyle=A}),new L("http://www.w3.org/ns/ttml#styling fontWeight",function(p,C,I,A){C.style.fontWeight=A}),new L("http://www.w3.org/ns/ttml#styling lineHeight",function(p,C,I,A){A==="normal"?C.style.lineHeight="normal":C.style.lineHeight=A*p.h+"px"}),new L("http://www.w3.org/ns/ttml#styling opacity",function(p,C,I,A){C.style.opacity=A}),new L("http://www.w3.org/ns/ttml#styling origin",function(p,C,I,A){C.style.top=A.h*p.h+"px",C.style.left=A.w*p.w+"px"}),new L("http://www.w3.org/ns/ttml#styling overflow",function(p,C,I,A){C.style.overflow=A}),new L("http://www.w3.org/ns/ttml#styling padding",function(p,C,I,A){var S=[];S[0]=A[0]*p.h+"px",S[1]=A[3]*p.w+"px",S[2]=A[2]*p.h+"px",S[3]=A[1]*p.w+"px",C.style.padding=S.join(" ")}),new L("http://www.w3.org/ns/ttml#styling showBackground",null),new L("http://www.w3.org/ns/ttml#styling textAlign",function(p,C,I,A){var S,x=I.styleAttrs[f.byName.direction.qname];A==="start"?S=x==="rtl"?"right":"left":A==="end"?S=x==="rtl"?"left":"right":S=A,C.style.textAlign=S}),new L("http://www.w3.org/ns/ttml#styling textDecoration",function(p,C,I,A){C.style.textDecoration=A.join(" ").replace("lineThrough","line-through")}),new L("http://www.w3.org/ns/ttml#styling textOutline",function(p,C,I,A){A==="none"?C.style.textShadow="":C.style.textShadow="rgba("+A.color[0].toString()+","+A.color[1].toString()+","+A.color[2].toString()+","+(A.color[3]/255).toString()+") 0px 0px "+A.thickness*p.h+"px"}),new L("http://www.w3.org/ns/ttml#styling unicodeBidi",function(p,C,I,A){var S;A==="bidiOverride"?S="bidi-override":S=A,C.style.unicodeBidi=S}),new L("http://www.w3.org/ns/ttml#styling visibility",function(p,C,I,A){C.style.visibility=A}),new L("http://www.w3.org/ns/ttml#styling wrapOption",function(p,C,I,A){A==="wrap"?I.space==="preserve"?C.style.whiteSpace="pre-wrap":C.style.whiteSpace="normal":I.space==="preserve"?C.style.whiteSpace="pre":C.style.whiteSpace="noWrap"}),new L("http://www.w3.org/ns/ttml#styling writingMode",function(p,C,I,A){A==="lrtb"||A==="lr"||A==="rltb"||A==="rl"?C.style.writingMode="horizontal-tb":A==="tblr"?C.style.writingMode="vertical-lr":(A==="tbrl"||A==="tb")&&(C.style.writingMode="vertical-rl")}),new L("http://www.w3.org/ns/ttml#styling zIndex",function(p,C,I,A){C.style.zIndex=A}),new L("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt backgroundImage",function(p,C,I,A){if(p.imgResolver!==null&&A!==null){var S=document.createElement("img"),x=p.imgResolver(A,S);x&&(S.src=x),S.height=p.regionH,S.width=p.regionW,C.appendChild(S)}}),new L("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",function(p,C,I,A){p.displayForcedOnlyMode&&A===!1&&(C.style.visibility="hidden")})],T={};for(var m in R)T[R[m].qname]=R[m];function M(p,C){if(p&&p.error&&p.error(C))throw C}})(i,typeof imscNames>"u"?r("./node_modules/imsc/src/main/js/names.js"):imscNames,typeof imscStyles>"u"?r("./node_modules/imsc/src/main/js/styles.js"):imscStyles)},"./node_modules/imsc/src/main/js/isd.js":(h,i,r)=>{(function(u,l,f){u.generateISD=function(P,b,L){var R=new c(P),T={};for(var m in P.head.layout.regions){var M=d(P,b,P.head.layout.regions[m],P.body,null,"",P.head.layout.regions[m],L,T);M!==null&&R.contents.push(M.element)}return R};function d(P,b,L,R,T,m,M,p,C){if(b<M.begin||b>=M.end)return null;var I="regionID"in M&&M.regionID!==""?M.regionID:m;if(T!==null&&I!==L.id&&(!("contents"in M)||"contents"in M&&M.contents.length===0||I!==""))return null;var A=new y(M);for(var S in M.sets)b<M.sets[S].begin||b>=M.sets[S].end||(A.styleAttrs[M.sets[S].qname]=M.sets[S].value);var x={};for(var F in A.styleAttrs)if(x[F]=!0,F===f.byName.writingMode.qname&&!(f.byName.direction.qname in A.styleAttrs)){var k=A.styleAttrs[F];k==="lrtb"||k==="lr"?A.styleAttrs[f.byName.direction.qname]="ltr":(k==="rltb"||k==="rl")&&(A.styleAttrs[f.byName.direction.qname]="rtl")}if(T!==null)for(var j in f.all){var V=f.all[j];if(V.qname===f.byName.textDecoration.qname){var Q=T.styleAttrs[V.qname],$=A.styleAttrs[V.qname],K=[];$===void 0?K=Q:$.indexOf("none")===-1?(($.indexOf("noUnderline")===-1&&Q.indexOf("underline")!==-1||$.indexOf("underline")!==-1)&&K.push("underline"),($.indexOf("noLineThrough")===-1&&Q.indexOf("lineThrough")!==-1||$.indexOf("lineThrough")!==-1)&&K.push("lineThrough"),($.indexOf("noOverline")===-1&&Q.indexOf("overline")!==-1||$.indexOf("overline")!==-1)&&K.push("overline")):K.push("none"),A.styleAttrs[V.qname]=K}else V.inherit&&V.qname in T.styleAttrs&&!(V.qname in A.styleAttrs)&&(A.styleAttrs[V.qname]=T.styleAttrs[V.qname])}for(var Y in f.all){var re=f.all[Y];re.qname in A.styleAttrs||(A.kind==="region"||re.inherit===!1&&re.initial!==null)&&(A.styleAttrs[re.qname]=re.parse(re.initial),x[re.qname]=!0)}for(var ie in f.all){var ee=f.all[ie];if(ee.qname in x&&ee.compute!==null){var ne=ee.compute(P,T,A,A.styleAttrs[ee.qname],C);ne!==null?A.styleAttrs[ee.qname]=ne:O(p,"Style '"+ee.qname+"' on element '"+A.kind+"' cannot be computed")}}if(A.styleAttrs[f.byName.display.qname]==="none")return null;var ae;T===null?R===null?ae=[]:ae=[R]:"contents"in M&&(ae=M.contents);for(var ce in ae){var X=d(P,b,L,R,A,I,ae[ce],p,C);X!==null&&A.contents.push(X.element)}for(var oe in A.styleAttrs){var ge=f.byQName[oe];ge.applies.indexOf(A.kind)===-1&&delete A.styleAttrs[oe]}if(A.kind==="span"&&A.text&&A.space==="default"){var _e=A.text.replace(/\s+/g," ");A.text=_e}if(A.kind==="p"){var he=[];_(A,he);for(var se=0,Z="after_br",q=0;;)if(Z==="after_br")se>=he.length||he[se].kind==="br"?(Z="before_br",q=se,se--):(he[se].space!=="preserve"&&(he[se].text=he[se].text.replace(/^\s+/g,"")),he[se].text.length>0?(Z="looking_br",se++):he.splice(se,1));else if(Z==="before_br")if(se<0||he[se].kind==="br"){if(Z="after_br",se=q+1,se>=he.length)break}else if(he[se].space!=="preserve"&&(he[se].text=he[se].text.replace(/\s+$/g,"")),he[se].text.length>0){if(Z="after_br",se=q+1,se>=he.length)break}else he.splice(se,1),se--;else se>=he.length||he[se].kind==="br"?(Z="before_br",q=se,se--):se++;E(A)}return A.kind==="div"&&f.byName.backgroundImage.qname in A.styleAttrs||A.kind==="br"||"contents"in A&&A.contents.length>0||A.kind==="span"&&A.text!==null||A.kind==="region"&&A.styleAttrs[f.byName.showBackground.qname]==="always"?{region_id:I,element:A}:null}function _(P,b){if("contents"in P)for(var L in P.contents)_(P.contents[L],b);else b.push(P)}function E(P){if(P.kind==="br")return!1;if("text"in P)return P.text.length===0;if("contents"in P){for(var b=P.contents.length;b--;)E(P.contents[b])&&P.contents.splice(b,1);return P.contents.length===0}}function c(P){this.contents=[],this.aspectRatio=P.aspectRatio}function y(P){this.kind=P.kind||"region",P.id&&(this.id=P.id),this.styleAttrs={};for(var b in P.styleAttrs)this.styleAttrs[b]=P.styleAttrs[b];"text"in P?this.text=P.text:P.kind!=="br"&&(this.contents=[]),"space"in P&&(this.space=P.space)}function O(P,b){if(P&&P.error&&P.error(b))throw b}})(i,typeof imscNames>"u"?r("./node_modules/imsc/src/main/js/names.js"):imscNames,typeof imscStyles>"u"?r("./node_modules/imsc/src/main/js/styles.js"):imscStyles)},"./node_modules/imsc/src/main/js/main.js":(h,i,r)=>{i.generateISD=r("./node_modules/imsc/src/main/js/isd.js").generateISD,i.fromXML=r("./node_modules/imsc/src/main/js/doc.js").fromXML,i.renderHTML=r("./node_modules/imsc/src/main/js/html.js").render},"./node_modules/imsc/src/main/js/names.js":(h,i)=>{(function(r){r.ns_tt="http://www.w3.org/ns/ttml",r.ns_tts="http://www.w3.org/ns/ttml#styling",r.ns_ttp="http://www.w3.org/ns/ttml#parameter",r.ns_xml="http://www.w3.org/XML/1998/namespace",r.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",r.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",r.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",r.ns_ebutts="urn:ebu:tt:style"})(i)},"./node_modules/imsc/src/main/js/styles.js":(h,i,r)=>{(function(u,l,f){function d(c,y,O,P,b,L,R,T){this.name=y,this.ns=c,this.qname=c+" "+y,this.inherit=b,this.animatable=L,this.initial=O,this.applies=P,this.parse=R,this.compute=T}u.all=[new d(l.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,f.parseColor,null),new d(l.ns_tts,"color","white",["span"],!0,!0,f.parseColor,null),new d(l.ns_tts,"direction","ltr",["p","span"],!0,!0,function(c){return c},null),new d(l.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,function(c){return c},null),new d(l.ns_tts,"displayAlign","before",["region"],!1,!0,function(c){return c},null),new d(l.ns_tts,"extent","auto",["tt","region"],!1,!0,function(c){if(c==="auto")return c;var y=c.split(" ");if(y.length!==2)return null;var O=f.parseLength(y[0]),P=f.parseLength(y[1]);return!P||!O?null:{h:P,w:O}},function(c,y,O,P,b){var L,R;if(P==="auto")L=1;else if(P.h.unit==="%")L=P.h.value/100;else if(P.h.unit==="px")L=P.h.value/c.pxDimensions.h;else return null;if(P==="auto")R=1;else if(P.w.unit==="%")R=P.w.value/100;else if(P.w.unit==="px")R=P.w.value/c.pxDimensions.w;else return null;return{h:L,w:R}}),new d(l.ns_tts,"fontFamily","default",["span"],!0,!0,function(c){var y=c.split(","),O=[];for(var P in y)y[P].charAt(0)!=="'"&&y[P].charAt(0)!=='"'&&y[P]==="default"?O.push("monospaceSerif"):O.push(y[P]);return O},null),new d(l.ns_tts,"fontSize","1c",["span"],!0,!0,f.parseLength,function(c,y,O,P,b){var L;if(P.unit==="%")y!==null?L=y.styleAttrs[u.byName.fontSize.qname]*P.value/100:L=P.value/100/c.cellResolution.h;else if(P.unit==="em")y!==null?L=y.styleAttrs[u.byName.fontSize.qname]*P.value:L=P.value/c.cellResolution.h;else if(P.unit==="c")L=P.value/c.cellResolution.h;else if(P.unit==="px")L=P.value/c.pxDimensions.h;else return null;return L}),new d(l.ns_tts,"fontStyle","normal",["span"],!0,!0,function(c){return c},null),new d(l.ns_tts,"fontWeight","normal",["span"],!0,!0,function(c){return c},null),new d(l.ns_tts,"lineHeight","normal",["p"],!0,!0,function(c){return c==="normal"?c:f.parseLength(c)},function(c,y,O,P,b){var L;if(P==="normal")L=P;else if(P.unit==="%")L=O.styleAttrs[u.byName.fontSize.qname]*P.value/100;else if(P.unit==="em")L=O.styleAttrs[u.byName.fontSize.qname]*P.value;else if(P.unit==="c")L=P.value/c.cellResolution.h;else if(P.unit==="px")L=P.value/c.pxDimensions.h;else return null;return L}),new d(l.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new d(l.ns_tts,"origin","auto",["region"],!1,!0,function(c){if(c==="auto")return c;var y=c.split(" ");if(y.length!==2)return null;var O=f.parseLength(y[0]),P=f.parseLength(y[1]);return!P||!O?null:{h:P,w:O}},function(c,y,O,P,b){var L,R;if(P==="auto")L=0;else if(P.h.unit==="%")L=P.h.value/100;else if(P.h.unit==="px")L=P.h.value/c.pxDimensions.h;else return null;if(P==="auto")R=0;else if(P.w.unit==="%")R=P.w.value/100;else if(P.w.unit==="px")R=P.w.value/c.pxDimensions.w;else return null;return{h:L,w:R}}),new d(l.ns_tts,"overflow","hidden",["region"],!1,!0,function(c){return c},null),new d(l.ns_tts,"padding","0px",["region"],!1,!0,function(c){var y=c.split(" ");if(y.length>4)return null;var O=[];for(var P in y){var b=f.parseLength(y[P]);if(!b)return null;O.push(b)}return O},function(c,y,O,P,b){var L;if(P.length===1)L=[P[0],P[0],P[0],P[0]];else if(P.length===2)L=[P[0],P[1],P[0],P[1]];else if(P.length===3)L=[P[0],P[1],P[2],P[1]];else if(P.length===4)L=[P[0],P[1],P[2],P[3]];else return null;var R=O.styleAttrs[u.byName.writingMode.qname];if(R==="lrtb"||R==="lr")L=[L[0],L[3],L[2],L[1]];else if(R==="rltb"||R==="rl")L=[L[0],L[1],L[2],L[3]];else if(R==="tblr")L=[L[3],L[0],L[1],L[2]];else if(R==="tbrl"||R==="tb")L=[L[3],L[2],L[1],L[0]];else return null;var T=[];for(var m in L)if(L[m].value===0)T[m]=0;else if(L[m].unit==="%")m==="0"||m==="2"?T[m]=O.styleAttrs[u.byName.extent.qname].h*L[m].value/100:T[m]=O.styleAttrs[u.byName.extent.qname].w*L[m].value/100;else if(L[m].unit==="em")T[m]=O.styleAttrs[u.byName.fontSize.qname]*L[m].value;else if(L[m].unit==="c")T[m]=L[m].value/c.cellResolution.h;else if(L[m].unit==="px")m==="0"||m==="2"?T[m]=L[m].value/c.pxDimensions.h:T[m]=L[m].value/c.pxDimensions.w;else return null;return T}),new d(l.ns_tts,"showBackground","always",["region"],!1,!0,function(c){return c},null),new d(l.ns_tts,"textAlign","start",["p"],!0,!0,function(c){return c},function(c,y,O,P,b){return P==="left"?"start":P==="right"?"end":P}),new d(l.ns_tts,"textDecoration","none",["span"],!0,!0,function(c){return c.split(" ")},null),new d(l.ns_tts,"textOutline","none",["span"],!0,!0,function(c){if(c==="none")return c;var y={},O=c.split(" ");if(O.length===0||O.length>2)return null;var P=f.parseColor(O[0]);if(y.color=P,P!==null&&O.shift(),O.length!==1)return null;var b=f.parseLength(O[0]);return b?(y.thickness=b,y):null},function(c,y,O,P,b){if(P==="none")return P;var L={};if(P.color===null?L.color=O.styleAttrs[u.byName.color.qname]:L.color=P.color,P.thickness.unit==="%")L.thickness=O.styleAttrs[u.byName.fontSize.qname]*P.thickness.value/100;else if(P.thickness.unit==="em")L.thickness=O.styleAttrs[u.byName.fontSize.qname]*P.thickness.value;else if(P.thickness.unit==="c")L.thickness=P.thickness.value/c.cellResolution.h;else if(P.thickness.unit==="px")L.thickness=P.thickness.value/c.pxDimensions.h;else return null;return L}),new d(l.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,function(c){return c},null),new d(l.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,function(c){return c},null),new d(l.ns_tts,"wrapOption","wrap",["span"],!0,!0,function(c){return c},null),new d(l.ns_tts,"writingMode","lrtb",["region"],!1,!0,function(c){return c},null),new d(l.ns_tts,"zIndex","auto",["region"],!1,!0,function(c){var y;return c==="auto"?y=c:(y=parseInt(c),isNaN(y)&&(y=null)),y},null),new d(l.ns_ebutts,"linePadding","0c",["p"],!0,!1,f.parseLength,function(c,y,O,P,b){return P.unit==="c"?P.value/c.cellResolution.h:null}),new d(l.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,function(c){return c},null),new d(l.ns_smpte,"backgroundImage",null,["div"],!1,!1,function(c){return c},null),new d(l.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,function(c){return c==="true"},null),new d(l.ns_itts,"fillLineGap","false",["p"],!0,!0,function(c){return c==="true"},null)],u.byQName={};for(var _ in u.all)u.byQName[u.all[_].qname]=u.all[_];u.byName={};for(var E in u.all)u.byName[u.all[E].name]=u.all[E]})(i,typeof imscNames>"u"?r("./node_modules/imsc/src/main/js/names.js"):imscNames,typeof imscUtils>"u"?r("./node_modules/imsc/src/main/js/utils.js"):imscUtils)},"./node_modules/imsc/src/main/js/utils.js":(h,i)=>{(function(r){var u=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,l=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,f=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,d={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};r.parseColor=function(E){var c,y=null,O=d[E.toLowerCase()];return O!==void 0?y=O:(c=u.exec(E))!==null?y=[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16),c[4]!==void 0?parseInt(c[4],16):255]:(c=l.exec(E))!==null?y=[parseInt(c[1]),parseInt(c[2]),parseInt(c[3]),255]:(c=f.exec(E))!==null&&(y=[parseInt(c[1]),parseInt(c[2]),parseInt(c[3]),parseInt(c[4])]),y};var _=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%)$/;r.parseLength=function(E){var c,y=null;return(c=_.exec(E))!==null&&(y={value:parseFloat(c[1]),unit:c[2]}),y}})(i)},"./node_modules/is-alphabetical/index.js":h=>{h.exports=i;function i(r){var u=typeof r=="string"?r.charCodeAt(0):r;return u>=97&&u<=122||u>=65&&u<=90}},"./node_modules/is-alphanumerical/index.js":(h,i,r)=>{var u=r("./node_modules/is-alphabetical/index.js"),l=r("./node_modules/is-decimal/index.js");h.exports=f;function f(d){return u(d)||l(d)}},"./node_modules/is-decimal/index.js":h=>{h.exports=i;function i(r){var u=typeof r=="string"?r.charCodeAt(0):r;return u>=48&&u<=57}},"./node_modules/path-browserify/index.js":h=>{function i(f){if(typeof f!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(f))}function r(f,d){for(var _="",E=0,c=-1,y=0,O,P=0;P<=f.length;++P){if(P<f.length)O=f.charCodeAt(P);else{if(O===47)break;O=47}if(O===47){if(!(c===P-1||y===1))if(c!==P-1&&y===2){if(_.length<2||E!==2||_.charCodeAt(_.length-1)!==46||_.charCodeAt(_.length-2)!==46){if(_.length>2){var b=_.lastIndexOf("/");if(b!==_.length-1){b===-1?(_="",E=0):(_=_.slice(0,b),E=_.length-1-_.lastIndexOf("/")),c=P,y=0;continue}}else if(_.length===2||_.length===1){_="",E=0,c=P,y=0;continue}}d&&(_.length>0?_+="/..":_="..",E=2)}else _.length>0?_+="/"+f.slice(c+1,P):_=f.slice(c+1,P),E=P-c-1;c=P,y=0}else O===46&&y!==-1?++y:y=-1}return _}function u(f,d){var _=d.dir||d.root,E=d.base||(d.name||"")+(d.ext||"");return _?_===d.root?_+E:_+f+E:E}var l={resolve:function(){for(var d="",_=!1,E,c=arguments.length-1;c>=-1&&!_;c--){var y;c>=0?y=arguments[c]:(E===void 0&&(E=process.cwd()),y=E),i(y),y.length!==0&&(d=y+"/"+d,_=y.charCodeAt(0)===47)}return d=r(d,!_),_?d.length>0?"/"+d:"/":d.length>0?d:"."},normalize:function(d){if(i(d),d.length===0)return".";var _=d.charCodeAt(0)===47,E=d.charCodeAt(d.length-1)===47;return d=r(d,!_),d.length===0&&!_&&(d="."),d.length>0&&E&&(d+="/"),_?"/"+d:d},isAbsolute:function(d){return i(d),d.length>0&&d.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var d,_=0;_<arguments.length;++_){var E=arguments[_];i(E),E.length>0&&(d===void 0?d=E:d+="/"+E)}return d===void 0?".":l.normalize(d)},relative:function(d,_){if(i(d),i(_),d===_||(d=l.resolve(d),_=l.resolve(_),d===_))return"";for(var E=1;E<d.length&&d.charCodeAt(E)===47;++E);for(var c=d.length,y=c-E,O=1;O<_.length&&_.charCodeAt(O)===47;++O);for(var P=_.length,b=P-O,L=y<b?y:b,R=-1,T=0;T<=L;++T){if(T===L){if(b>L){if(_.charCodeAt(O+T)===47)return _.slice(O+T+1);if(T===0)return _.slice(O+T)}else y>L&&(d.charCodeAt(E+T)===47?R=T:T===0&&(R=0));break}var m=d.charCodeAt(E+T),M=_.charCodeAt(O+T);if(m!==M)break;m===47&&(R=T)}var p="";for(T=E+R+1;T<=c;++T)(T===c||d.charCodeAt(T)===47)&&(p.length===0?p+="..":p+="/..");return p.length>0?p+_.slice(O+R):(O+=R,_.charCodeAt(O)===47&&++O,_.slice(O))},_makeLong:function(d){return d},dirname:function(d){if(i(d),d.length===0)return".";for(var _=d.charCodeAt(0),E=_===47,c=-1,y=!0,O=d.length-1;O>=1;--O)if(_=d.charCodeAt(O),_===47){if(!y){c=O;break}}else y=!1;return c===-1?E?"/":".":E&&c===1?"//":d.slice(0,c)},basename:function(d,_){if(_!==void 0&&typeof _!="string")throw new TypeError('"ext" argument must be a string');i(d);var E=0,c=-1,y=!0,O;if(_!==void 0&&_.length>0&&_.length<=d.length){if(_.length===d.length&&_===d)return"";var P=_.length-1,b=-1;for(O=d.length-1;O>=0;--O){var L=d.charCodeAt(O);if(L===47){if(!y){E=O+1;break}}else b===-1&&(y=!1,b=O+1),P>=0&&(L===_.charCodeAt(P)?--P===-1&&(c=O):(P=-1,c=b))}return E===c?c=b:c===-1&&(c=d.length),d.slice(E,c)}else{for(O=d.length-1;O>=0;--O)if(d.charCodeAt(O)===47){if(!y){E=O+1;break}}else c===-1&&(y=!1,c=O+1);return c===-1?"":d.slice(E,c)}},extname:function(d){i(d);for(var _=-1,E=0,c=-1,y=!0,O=0,P=d.length-1;P>=0;--P){var b=d.charCodeAt(P);if(b===47){if(!y){E=P+1;break}continue}c===-1&&(y=!1,c=P+1),b===46?_===-1?_=P:O!==1&&(O=1):_!==-1&&(O=-1)}return _===-1||c===-1||O===0||O===1&&_===c-1&&_===E+1?"":d.slice(_,c)},format:function(d){if(d===null||typeof d!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof d);return u("/",d)},parse:function(d){i(d);var _={root:"",dir:"",base:"",ext:"",name:""};if(d.length===0)return _;var E=d.charCodeAt(0),c=E===47,y;c?(_.root="/",y=1):y=0;for(var O=-1,P=0,b=-1,L=!0,R=d.length-1,T=0;R>=y;--R){if(E=d.charCodeAt(R),E===47){if(!L){P=R+1;break}continue}b===-1&&(L=!1,b=R+1),E===46?O===-1?O=R:T!==1&&(T=1):O!==-1&&(T=-1)}return O===-1||b===-1||T===0||T===1&&O===b-1&&O===P+1?b!==-1&&(P===0&&c?_.base=_.name=d.slice(1,b):_.base=_.name=d.slice(P,b)):(P===0&&c?(_.name=d.slice(1,O),_.base=d.slice(1,b)):(_.name=d.slice(P,O),_.base=d.slice(P,b)),_.ext=d.slice(O,b)),P>0?_.dir=d.slice(0,P-1):c&&(_.dir="/"),_},sep:"/",delimiter:":",win32:null,posix:null};l.posix=l,h.exports=l},"./node_modules/safe-buffer/index.js":(h,i,r)=>{var u=r("./node_modules/buffer/index.js"),l=u.Buffer;function f(_,E){for(var c in _)E[c]=_[c]}l.from&&l.alloc&&l.allocUnsafe&&l.allocUnsafeSlow?h.exports=u:(f(u,i),i.Buffer=d);function d(_,E,c){return l(_,E,c)}f(l,d),d.from=function(_,E,c){if(typeof _=="number")throw new TypeError("Argument must not be a number");return l(_,E,c)},d.alloc=function(_,E,c){if(typeof _!="number")throw new TypeError("Argument must be a number");var y=l(_);return E!==void 0?typeof c=="string"?y.fill(E,c):y.fill(E):y.fill(0),y},d.allocUnsafe=function(_){if(typeof _!="number")throw new TypeError("Argument must be a number");return l(_)},d.allocUnsafeSlow=function(_){if(typeof _!="number")throw new TypeError("Argument must be a number");return u.SlowBuffer(_)}},"./node_modules/sax/lib/sax.js":(h,i,r)=>{(function(u){u.parser=function(N,D){return new f(N,D)},u.SAXParser=f,u.SAXStream=P,u.createStream=O,u.MAX_BUFFER_LENGTH=65536;var l=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];u.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function f(N,D){if(!(this instanceof f))return new f(N,D);var w=this;_(w),w.q=w.c="",w.bufferCheckPosition=u.MAX_BUFFER_LENGTH,w.opt=D||{},w.opt.lowercase=w.opt.lowercase||w.opt.lowercasetags,w.looseCase=w.opt.lowercase?"toLowerCase":"toUpperCase",w.tags=[],w.closed=w.closedRoot=w.sawRoot=!1,w.tag=w.error=null,w.strict=!!N,w.noscript=!!(N||w.opt.noscript),w.state=K.BEGIN,w.strictEntities=w.opt.strictEntities,w.ENTITIES=w.strictEntities?Object.create(u.XML_ENTITIES):Object.create(u.ENTITIES),w.attribList=[],w.opt.xmlns&&(w.ns=Object.create(A)),w.trackPosition=w.opt.position!==!1,w.trackPosition&&(w.position=w.line=w.column=0),re(w,"onready")}Object.create||(Object.create=function(N){function D(){}D.prototype=N;var w=new D;return w}),Object.keys||(Object.keys=function(N){var D=[];for(var w in N)N.hasOwnProperty(w)&&D.push(w);return D});function d(N){for(var D=Math.max(u.MAX_BUFFER_LENGTH,10),w=0,W=0,H=l.length;W<H;W++){var U=N[l[W]].length;if(U>D)switch(l[W]){case"textNode":ee(N);break;case"cdata":ie(N,"oncdata",N.cdata),N.cdata="";break;case"script":ie(N,"onscript",N.script),N.script="";break;default:ae(N,"Max buffer length exceeded: "+l[W])}w=Math.max(w,U)}var B=u.MAX_BUFFER_LENGTH-w;N.bufferCheckPosition=B+N.position}function _(N){for(var D=0,w=l.length;D<w;D++)N[l[D]]=""}function E(N){ee(N),N.cdata!==""&&(ie(N,"oncdata",N.cdata),N.cdata=""),N.script!==""&&(ie(N,"onscript",N.script),N.script="")}f.prototype={end:function(){ce(this)},write:te,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){E(this)}};var c;try{c=r("./node_modules/stream-browserify/index.js").Stream}catch{c=function(){}}var y=u.EVENTS.filter(function(N){return N!=="error"&&N!=="end"});function O(N,D){return new P(N,D)}function P(N,D){if(!(this instanceof P))return new P(N,D);c.apply(this),this._parser=new f(N,D),this.writable=!0,this.readable=!0;var w=this;this._parser.onend=function(){w.emit("end")},this._parser.onerror=function(W){w.emit("error",W),w._parser.error=null},this._decoder=null,y.forEach(function(W){Object.defineProperty(w,"on"+W,{get:function(){return w._parser["on"+W]},set:function(H){if(!H)return w.removeAllListeners(W),w._parser["on"+W]=H,H;w.on(W,H)},enumerable:!0,configurable:!1})})}P.prototype=Object.create(c.prototype,{constructor:{value:P}}),P.prototype.write=function(N){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(N)){if(!this._decoder){var D=r("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder;this._decoder=new D("utf8")}N=this._decoder.write(N)}return this._parser.write(N.toString()),this.emit("data",N),!0},P.prototype.end=function(N){return N&&N.length&&this.write(N),this._parser.end(),!0},P.prototype.on=function(N,D){var w=this;return!w._parser["on"+N]&&y.indexOf(N)!==-1&&(w._parser["on"+N]=function(){var W=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);W.splice(0,0,N),w.emit.apply(w,W)}),c.prototype.on.call(w,N,D)};var b=`\r
	 `,L="0124356789",R="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",T=`'"`,m=b+">",M="[CDATA[",p="DOCTYPE",C="http://www.w3.org/XML/1998/namespace",I="http://www.w3.org/2000/xmlns/",A={xml:C,xmlns:I};b=j(b),L=j(L),R=j(R);var S=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,x=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,F=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,k=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;T=j(T),m=j(m);function j(N){return N.split("").reduce(function(D,w){return D[w]=!0,D},{})}function V(N){return Object.prototype.toString.call(N)==="[object RegExp]"}function Q(N,D){return V(N)?!!D.match(N):N[D]}function $(N,D){return!Q(N,D)}var K=0;u.STATE={BEGIN:K++,BEGIN_WHITESPACE:K++,TEXT:K++,TEXT_ENTITY:K++,OPEN_WAKA:K++,SGML_DECL:K++,SGML_DECL_QUOTED:K++,DOCTYPE:K++,DOCTYPE_QUOTED:K++,DOCTYPE_DTD:K++,DOCTYPE_DTD_QUOTED:K++,COMMENT_STARTING:K++,COMMENT:K++,COMMENT_ENDING:K++,COMMENT_ENDED:K++,CDATA:K++,CDATA_ENDING:K++,CDATA_ENDING_2:K++,PROC_INST:K++,PROC_INST_BODY:K++,PROC_INST_ENDING:K++,OPEN_TAG:K++,OPEN_TAG_SLASH:K++,ATTRIB:K++,ATTRIB_NAME:K++,ATTRIB_NAME_SAW_WHITE:K++,ATTRIB_VALUE:K++,ATTRIB_VALUE_QUOTED:K++,ATTRIB_VALUE_CLOSED:K++,ATTRIB_VALUE_UNQUOTED:K++,ATTRIB_VALUE_ENTITY_Q:K++,ATTRIB_VALUE_ENTITY_U:K++,CLOSE_TAG:K++,CLOSE_TAG_SAW_WHITE:K++,SCRIPT:K++,SCRIPT_ENDING:K++},u.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},u.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(u.ENTITIES).forEach(function(N){var D=u.ENTITIES[N],w=typeof D=="number"?String.fromCharCode(D):D;u.ENTITIES[N]=w});for(var Y in u.STATE)u.STATE[u.STATE[Y]]=Y;K=u.STATE;function re(N,D,w){N[D]&&N[D](w)}function ie(N,D,w){N.textNode&&ee(N),re(N,D,w)}function ee(N){N.textNode=ne(N.opt,N.textNode),N.textNode&&re(N,"ontext",N.textNode),N.textNode=""}function ne(N,D){return N.trim&&(D=D.trim()),N.normalize&&(D=D.replace(/\s+/g," ")),D}function ae(N,D){return ee(N),N.trackPosition&&(D+=`
Line: `+N.line+`
Column: `+N.column+`
Char: `+N.c),D=new Error(D),N.error=D,re(N,"onerror",D),N}function ce(N){return N.sawRoot&&!N.closedRoot&&X(N,"Unclosed root tag"),N.state!==K.BEGIN&&N.state!==K.BEGIN_WHITESPACE&&N.state!==K.TEXT&&ae(N,"Unexpected end"),ee(N),N.c="",N.closed=!0,re(N,"onend"),f.call(N,N.strict,N.opt),N}function X(N,D){if(typeof N!="object"||!(N instanceof f))throw new Error("bad call to strictFail");N.strict&&ae(N,D)}function oe(N){N.strict||(N.tagName=N.tagName[N.looseCase]());var D=N.tags[N.tags.length-1]||N,w=N.tag={name:N.tagName,attributes:{}};N.opt.xmlns&&(w.ns=D.ns),N.attribList.length=0,ie(N,"onopentagstart",w)}function ge(N,D){var w=N.indexOf(":"),W=w<0?["",N]:N.split(":"),H=W[0],U=W[1];return D&&N==="xmlns"&&(H="xmlns",U=""),{prefix:H,local:U}}function _e(N){if(N.strict||(N.attribName=N.attribName[N.looseCase]()),N.attribList.indexOf(N.attribName)!==-1||N.tag.attributes.hasOwnProperty(N.attribName)){N.attribName=N.attribValue="";return}if(N.opt.xmlns){var D=ge(N.attribName,!0),w=D.prefix,W=D.local;if(w==="xmlns")if(W==="xml"&&N.attribValue!==C)X(N,"xml: prefix must be bound to "+C+`
Actual: `+N.attribValue);else if(W==="xmlns"&&N.attribValue!==I)X(N,"xmlns: prefix must be bound to "+I+`
Actual: `+N.attribValue);else{var H=N.tag,U=N.tags[N.tags.length-1]||N;H.ns===U.ns&&(H.ns=Object.create(U.ns)),H.ns[W]=N.attribValue}N.attribList.push([N.attribName,N.attribValue])}else N.tag.attributes[N.attribName]=N.attribValue,ie(N,"onattribute",{name:N.attribName,value:N.attribValue});N.attribName=N.attribValue=""}function he(N,D){if(N.opt.xmlns){var w=N.tag,W=ge(N.tagName);w.prefix=W.prefix,w.local=W.local,w.uri=w.ns[W.prefix]||"",w.prefix&&!w.uri&&(X(N,"Unbound namespace prefix: "+JSON.stringify(N.tagName)),w.uri=W.prefix);var H=N.tags[N.tags.length-1]||N;w.ns&&H.ns!==w.ns&&Object.keys(w.ns).forEach(function(be){ie(N,"onopennamespace",{prefix:be,uri:w.ns[be]})});for(var U=0,B=N.attribList.length;U<B;U++){var G=N.attribList[U],z=G[0],fe=G[1],ue=ge(z,!0),J=ue.prefix,ve=ue.local,me=J===""?"":w.ns[J]||"",Ae={name:z,value:fe,prefix:J,local:ve,uri:me};J&&J!=="xmlns"&&!me&&(X(N,"Unbound namespace prefix: "+JSON.stringify(J)),Ae.uri=J),N.tag.attributes[z]=Ae,ie(N,"onattribute",Ae)}N.attribList.length=0}N.tag.isSelfClosing=!!D,N.sawRoot=!0,N.tags.push(N.tag),ie(N,"onopentag",N.tag),D||(!N.noscript&&N.tagName.toLowerCase()==="script"?N.state=K.SCRIPT:N.state=K.TEXT,N.tag=null,N.tagName=""),N.attribName=N.attribValue="",N.attribList.length=0}function se(N){if(!N.tagName){X(N,"Weird empty close tag."),N.textNode+="</>",N.state=K.TEXT;return}if(N.script){if(N.tagName!=="script"){N.script+="</"+N.tagName+">",N.tagName="",N.state=K.SCRIPT;return}ie(N,"onscript",N.script),N.script=""}var D=N.tags.length,w=N.tagName;N.strict||(w=w[N.looseCase]());for(var W=w;D--;){var H=N.tags[D];if(H.name!==W)X(N,"Unexpected close tag");else break}if(D<0){X(N,"Unmatched closing tag: "+N.tagName),N.textNode+="</"+N.tagName+">",N.state=K.TEXT;return}N.tagName=w;for(var U=N.tags.length;U-- >D;){var B=N.tag=N.tags.pop();N.tagName=N.tag.name,ie(N,"onclosetag",N.tagName);var G={};for(var z in B.ns)G[z]=B.ns[z];var fe=N.tags[N.tags.length-1]||N;N.opt.xmlns&&B.ns!==fe.ns&&Object.keys(B.ns).forEach(function(ue){var J=B.ns[ue];ie(N,"onclosenamespace",{prefix:ue,uri:J})})}D===0&&(N.closedRoot=!0),N.tagName=N.attribValue=N.attribName="",N.attribList.length=0,N.state=K.TEXT}function Z(N){var D=N.entity,w=D.toLowerCase(),W,H="";return N.ENTITIES[D]?N.ENTITIES[D]:N.ENTITIES[w]?N.ENTITIES[w]:(D=w,D.charAt(0)==="#"&&(D.charAt(1)==="x"?(D=D.slice(2),W=parseInt(D,16),H=W.toString(16)):(D=D.slice(1),W=parseInt(D,10),H=W.toString(10))),D=D.replace(/^0+/,""),H.toLowerCase()!==D?(X(N,"Invalid character entity"),"&"+N.entity+";"):String.fromCodePoint(W))}function q(N,D){D==="<"?(N.state=K.OPEN_WAKA,N.startTagPosition=N.position):$(b,D)&&(X(N,"Non-whitespace before first tag."),N.textNode=D,N.state=K.TEXT)}function le(N,D){var w="";return D<N.length&&(w=N.charAt(D)),w}function te(N){var D=this;if(this.error)throw this.error;if(D.closed)return ae(D,"Cannot write after close. Assign an onready handler.");if(N===null)return ce(D);typeof N=="object"&&(N=N.toString());for(var w=0,W="";W=le(N,w++),D.c=W,!!W;)switch(D.trackPosition&&(D.position++,W===`
`?(D.line++,D.column=0):D.column++),D.state){case K.BEGIN:if(D.state=K.BEGIN_WHITESPACE,W==="\uFEFF")continue;q(D,W);continue;case K.BEGIN_WHITESPACE:q(D,W);continue;case K.TEXT:if(D.sawRoot&&!D.closedRoot){for(var H=w-1;W&&W!=="<"&&W!=="&";)W=le(N,w++),W&&D.trackPosition&&(D.position++,W===`
`?(D.line++,D.column=0):D.column++);D.textNode+=N.substring(H,w-1)}W==="<"&&!(D.sawRoot&&D.closedRoot&&!D.strict)?(D.state=K.OPEN_WAKA,D.startTagPosition=D.position):($(b,W)&&(!D.sawRoot||D.closedRoot)&&X(D,"Text data outside of root node."),W==="&"?D.state=K.TEXT_ENTITY:D.textNode+=W);continue;case K.SCRIPT:W==="<"?D.state=K.SCRIPT_ENDING:D.script+=W;continue;case K.SCRIPT_ENDING:W==="/"?D.state=K.CLOSE_TAG:(D.script+="<"+W,D.state=K.SCRIPT);continue;case K.OPEN_WAKA:if(W==="!")D.state=K.SGML_DECL,D.sgmlDecl="";else if(!Q(b,W))if(Q(S,W))D.state=K.OPEN_TAG,D.tagName=W;else if(W==="/")D.state=K.CLOSE_TAG,D.tagName="";else if(W==="?")D.state=K.PROC_INST,D.procInstName=D.procInstBody="";else{if(X(D,"Unencoded <"),D.startTagPosition+1<D.position){var U=D.position-D.startTagPosition;W=new Array(U).join(" ")+W}D.textNode+="<"+W,D.state=K.TEXT}continue;case K.SGML_DECL:(D.sgmlDecl+W).toUpperCase()===M?(ie(D,"onopencdata"),D.state=K.CDATA,D.sgmlDecl="",D.cdata=""):D.sgmlDecl+W==="--"?(D.state=K.COMMENT,D.comment="",D.sgmlDecl=""):(D.sgmlDecl+W).toUpperCase()===p?(D.state=K.DOCTYPE,(D.doctype||D.sawRoot)&&X(D,"Inappropriately located doctype declaration"),D.doctype="",D.sgmlDecl=""):W===">"?(ie(D,"onsgmldeclaration",D.sgmlDecl),D.sgmlDecl="",D.state=K.TEXT):(Q(T,W)&&(D.state=K.SGML_DECL_QUOTED),D.sgmlDecl+=W);continue;case K.SGML_DECL_QUOTED:W===D.q&&(D.state=K.SGML_DECL,D.q=""),D.sgmlDecl+=W;continue;case K.DOCTYPE:W===">"?(D.state=K.TEXT,ie(D,"ondoctype",D.doctype),D.doctype=!0):(D.doctype+=W,W==="["?D.state=K.DOCTYPE_DTD:Q(T,W)&&(D.state=K.DOCTYPE_QUOTED,D.q=W));continue;case K.DOCTYPE_QUOTED:D.doctype+=W,W===D.q&&(D.q="",D.state=K.DOCTYPE);continue;case K.DOCTYPE_DTD:D.doctype+=W,W==="]"?D.state=K.DOCTYPE:Q(T,W)&&(D.state=K.DOCTYPE_DTD_QUOTED,D.q=W);continue;case K.DOCTYPE_DTD_QUOTED:D.doctype+=W,W===D.q&&(D.state=K.DOCTYPE_DTD,D.q="");continue;case K.COMMENT:W==="-"?D.state=K.COMMENT_ENDING:D.comment+=W;continue;case K.COMMENT_ENDING:W==="-"?(D.state=K.COMMENT_ENDED,D.comment=ne(D.opt,D.comment),D.comment&&ie(D,"oncomment",D.comment),D.comment=""):(D.comment+="-"+W,D.state=K.COMMENT);continue;case K.COMMENT_ENDED:W!==">"?(X(D,"Malformed comment"),D.comment+="--"+W,D.state=K.COMMENT):D.state=K.TEXT;continue;case K.CDATA:W==="]"?D.state=K.CDATA_ENDING:D.cdata+=W;continue;case K.CDATA_ENDING:W==="]"?D.state=K.CDATA_ENDING_2:(D.cdata+="]"+W,D.state=K.CDATA);continue;case K.CDATA_ENDING_2:W===">"?(D.cdata&&ie(D,"oncdata",D.cdata),ie(D,"onclosecdata"),D.cdata="",D.state=K.TEXT):W==="]"?D.cdata+="]":(D.cdata+="]]"+W,D.state=K.CDATA);continue;case K.PROC_INST:W==="?"?D.state=K.PROC_INST_ENDING:Q(b,W)?D.state=K.PROC_INST_BODY:D.procInstName+=W;continue;case K.PROC_INST_BODY:if(!D.procInstBody&&Q(b,W))continue;W==="?"?D.state=K.PROC_INST_ENDING:D.procInstBody+=W;continue;case K.PROC_INST_ENDING:W===">"?(ie(D,"onprocessinginstruction",{name:D.procInstName,body:D.procInstBody}),D.procInstName=D.procInstBody="",D.state=K.TEXT):(D.procInstBody+="?"+W,D.state=K.PROC_INST_BODY);continue;case K.OPEN_TAG:Q(x,W)?D.tagName+=W:(oe(D),W===">"?he(D):W==="/"?D.state=K.OPEN_TAG_SLASH:($(b,W)&&X(D,"Invalid character in tag name"),D.state=K.ATTRIB));continue;case K.OPEN_TAG_SLASH:W===">"?(he(D,!0),se(D)):(X(D,"Forward-slash in opening tag not followed by >"),D.state=K.ATTRIB);continue;case K.ATTRIB:if(Q(b,W))continue;W===">"?he(D):W==="/"?D.state=K.OPEN_TAG_SLASH:Q(S,W)?(D.attribName=W,D.attribValue="",D.state=K.ATTRIB_NAME):X(D,"Invalid attribute name");continue;case K.ATTRIB_NAME:W==="="?D.state=K.ATTRIB_VALUE:W===">"?(X(D,"Attribute without value"),D.attribValue=D.attribName,_e(D),he(D)):Q(b,W)?D.state=K.ATTRIB_NAME_SAW_WHITE:Q(x,W)?D.attribName+=W:X(D,"Invalid attribute name");continue;case K.ATTRIB_NAME_SAW_WHITE:if(W==="=")D.state=K.ATTRIB_VALUE;else{if(Q(b,W))continue;X(D,"Attribute without value"),D.tag.attributes[D.attribName]="",D.attribValue="",ie(D,"onattribute",{name:D.attribName,value:""}),D.attribName="",W===">"?he(D):Q(S,W)?(D.attribName=W,D.state=K.ATTRIB_NAME):(X(D,"Invalid attribute name"),D.state=K.ATTRIB)}continue;case K.ATTRIB_VALUE:if(Q(b,W))continue;Q(T,W)?(D.q=W,D.state=K.ATTRIB_VALUE_QUOTED):(X(D,"Unquoted attribute value"),D.state=K.ATTRIB_VALUE_UNQUOTED,D.attribValue=W);continue;case K.ATTRIB_VALUE_QUOTED:if(W!==D.q){W==="&"?D.state=K.ATTRIB_VALUE_ENTITY_Q:D.attribValue+=W;continue}_e(D),D.q="",D.state=K.ATTRIB_VALUE_CLOSED;continue;case K.ATTRIB_VALUE_CLOSED:Q(b,W)?D.state=K.ATTRIB:W===">"?he(D):W==="/"?D.state=K.OPEN_TAG_SLASH:Q(S,W)?(X(D,"No whitespace between attributes"),D.attribName=W,D.attribValue="",D.state=K.ATTRIB_NAME):X(D,"Invalid attribute name");continue;case K.ATTRIB_VALUE_UNQUOTED:if($(m,W)){W==="&"?D.state=K.ATTRIB_VALUE_ENTITY_U:D.attribValue+=W;continue}_e(D),W===">"?he(D):D.state=K.ATTRIB;continue;case K.CLOSE_TAG:if(D.tagName)W===">"?se(D):Q(x,W)?D.tagName+=W:D.script?(D.script+="</"+D.tagName,D.tagName="",D.state=K.SCRIPT):($(b,W)&&X(D,"Invalid tagname in closing tag"),D.state=K.CLOSE_TAG_SAW_WHITE);else{if(Q(b,W))continue;$(S,W)?D.script?(D.script+="</"+W,D.state=K.SCRIPT):X(D,"Invalid tagname in closing tag."):D.tagName=W}continue;case K.CLOSE_TAG_SAW_WHITE:if(Q(b,W))continue;W===">"?se(D):X(D,"Invalid characters in closing tag");continue;case K.TEXT_ENTITY:case K.ATTRIB_VALUE_ENTITY_Q:case K.ATTRIB_VALUE_ENTITY_U:var B,G;switch(D.state){case K.TEXT_ENTITY:B=K.TEXT,G="textNode";break;case K.ATTRIB_VALUE_ENTITY_Q:B=K.ATTRIB_VALUE_QUOTED,G="attribValue";break;case K.ATTRIB_VALUE_ENTITY_U:B=K.ATTRIB_VALUE_UNQUOTED,G="attribValue";break}W===";"?(D[G]+=Z(D),D.entity="",D.state=B):Q(D.entity.length?k:F,W)?D.entity+=W:(X(D,"Invalid character in entity name"),D[G]+="&"+D.entity+W,D.entity="",D.state=B);continue;default:throw new Error(D,"Unknown state: "+D.state)}return D.position>=D.bufferCheckPosition&&d(D),D}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */String.fromCodePoint||function(){var N=String.fromCharCode,D=Math.floor,w=function(){var W=16384,H=[],U,B,G=-1,z=arguments.length;if(!z)return"";for(var fe="";++G<z;){var ue=Number(arguments[G]);if(!isFinite(ue)||ue<0||ue>1114111||D(ue)!==ue)throw RangeError("Invalid code point: "+ue);ue<=65535?H.push(ue):(ue-=65536,U=(ue>>10)+55296,B=ue%1024+56320,H.push(U,B)),(G+1===z||H.length>W)&&(fe+=N.apply(null,H),H.length=0)}return fe};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:w,configurable:!0,writable:!0}):String.fromCodePoint=w}()})(i)},"./node_modules/stream-browserify/index.js":(h,i,r)=>{h.exports=f;var u=r("./node_modules/events/events.js").EventEmitter,l=r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js");l(f,u),f.Readable=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_readable.js"),f.Writable=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_writable.js"),f.Duplex=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),f.Transform=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_transform.js"),f.PassThrough=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_passthrough.js"),f.finished=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"),f.pipeline=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/pipeline.js"),f.Stream=f;function f(){u.call(this)}f.prototype.pipe=function(d,_){var E=this;function c(T){d.writable&&d.write(T)===!1&&E.pause&&E.pause()}E.on("data",c);function y(){E.readable&&E.resume&&E.resume()}d.on("drain",y),!d._isStdio&&(!_||_.end!==!1)&&(E.on("end",P),E.on("close",b));var O=!1;function P(){O||(O=!0,d.end())}function b(){O||(O=!0,typeof d.destroy=="function"&&d.destroy())}function L(T){if(R(),u.listenerCount(this,"error")===0)throw T}E.on("error",L),d.on("error",L);function R(){E.removeListener("data",c),d.removeListener("drain",y),E.removeListener("end",P),E.removeListener("close",b),E.removeListener("error",L),d.removeListener("error",L),E.removeListener("end",R),E.removeListener("close",R),d.removeListener("close",R)}return E.on("end",R),E.on("close",R),d.on("close",R),d.emit("pipe",E),d}},"./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js":h=>{typeof Object.create=="function"?h.exports=function(r,u){u&&(r.super_=u,r.prototype=Object.create(u.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}))}:h.exports=function(r,u){if(u){r.super_=u;var l=function(){};l.prototype=u.prototype,r.prototype=new l,r.prototype.constructor=r}}},"./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js":h=>{function i(E,c){E.prototype=Object.create(c.prototype),E.prototype.constructor=E,E.__proto__=c}var r={};function u(E,c,y){y||(y=Error);function O(b,L,R){return typeof c=="string"?c:c(b,L,R)}var P=function(b){i(L,b);function L(R,T,m){return b.call(this,O(R,T,m))||this}return L}(y);P.prototype.name=y.name,P.prototype.code=E,r[E]=P}function l(E,c){if(Array.isArray(E)){var y=E.length;return E=E.map(function(O){return String(O)}),y>2?"one of ".concat(c," ").concat(E.slice(0,y-1).join(", "),", or ")+E[y-1]:y===2?"one of ".concat(c," ").concat(E[0]," or ").concat(E[1]):"of ".concat(c," ").concat(E[0])}else return"of ".concat(c," ").concat(String(E))}function f(E,c,y){return E.substr(!y||y<0?0:+y,c.length)===c}function d(E,c,y){return(y===void 0||y>E.length)&&(y=E.length),E.substring(y-c.length,y)===c}function _(E,c,y){return typeof y!="number"&&(y=0),y+c.length>E.length?!1:E.indexOf(c,y)!==-1}u("ERR_INVALID_OPT_VALUE",function(E,c){return'The value "'+c+'" is invalid for option "'+E+'"'},TypeError),u("ERR_INVALID_ARG_TYPE",function(E,c,y){var O;typeof c=="string"&&f(c,"not ")?(O="must not be",c=c.replace(/^not /,"")):O="must be";var P;if(d(E," argument"))P="The ".concat(E," ").concat(O," ").concat(l(c,"type"));else{var b=_(E,".")?"property":"argument";P='The "'.concat(E,'" ').concat(b," ").concat(O," ").concat(l(c,"type"))}return P+=". Received type ".concat(typeof y),P},TypeError),u("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),u("ERR_METHOD_NOT_IMPLEMENTED",function(E){return"The "+E+" method is not implemented"}),u("ERR_STREAM_PREMATURE_CLOSE","Premature close"),u("ERR_STREAM_DESTROYED",function(E){return"Cannot call "+E+" after a stream was destroyed"}),u("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),u("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),u("ERR_STREAM_WRITE_AFTER_END","write after end"),u("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),u("ERR_UNKNOWN_ENCODING",function(E){return"Unknown encoding: "+E},TypeError),u("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),h.exports.codes=r},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js":(h,i,r)=>{var u=Object.keys||function(P){var b=[];for(var L in P)b.push(L);return b};h.exports=c;var l=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_readable.js"),f=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_writable.js");r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(c,l);for(var d=u(f.prototype),_=0;_<d.length;_++){var E=d[_];c.prototype[E]||(c.prototype[E]=f.prototype[E])}function c(P){if(!(this instanceof c))return new c(P);l.call(this,P),f.call(this,P),this.allowHalfOpen=!0,P&&(P.readable===!1&&(this.readable=!1),P.writable===!1&&(this.writable=!1),P.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",y)))}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function y(){this._writableState.ended||process.nextTick(O,this)}function O(P){P.end()}Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(b){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=b,this._writableState.destroyed=b)}})},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_passthrough.js":(h,i,r)=>{h.exports=l;var u=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_transform.js");r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(l,u);function l(f){if(!(this instanceof l))return new l(f);u.call(this,f)}l.prototype._transform=function(f,d,_){_(null,f)}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_readable.js":(h,i,r)=>{h.exports=V;var u;V.ReadableState=j,r("./node_modules/events/events.js").EventEmitter;var l=function(w,W){return w.listeners(W).length},f=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/stream-browser.js"),d=r("./node_modules/buffer/index.js").Buffer,_=r.g.Uint8Array||function(){};function E(D){return d.from(D)}function c(D){return d.isBuffer(D)||D instanceof _}var y=r("?19e6"),O;y&&y.debuglog?O=y.debuglog("stream"):O=function(){};var P=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/buffer_list.js"),b=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/destroy.js"),L=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/state.js"),R=L.getHighWaterMark,T=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,m=T.ERR_INVALID_ARG_TYPE,M=T.ERR_STREAM_PUSH_AFTER_EOF,p=T.ERR_METHOD_NOT_IMPLEMENTED,C=T.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,I,A,S;r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(V,f);var x=b.errorOrDestroy,F=["error","close","destroy","pause","resume"];function k(D,w,W){if(typeof D.prependListener=="function")return D.prependListener(w,W);!D._events||!D._events[w]?D.on(w,W):Array.isArray(D._events[w])?D._events[w].unshift(W):D._events[w]=[W,D._events[w]]}function j(D,w,W){u=u||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),D=D||{},typeof W!="boolean"&&(W=w instanceof u),this.objectMode=!!D.objectMode,W&&(this.objectMode=this.objectMode||!!D.readableObjectMode),this.highWaterMark=R(this,D,"readableHighWaterMark",W),this.buffer=new P,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=D.emitClose!==!1,this.autoDestroy=!!D.autoDestroy,this.destroyed=!1,this.defaultEncoding=D.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,D.encoding&&(I||(I=r("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder),this.decoder=new I(D.encoding),this.encoding=D.encoding)}function V(D){if(u=u||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),!(this instanceof V))return new V(D);var w=this instanceof u;this._readableState=new j(D,this,w),this.readable=!0,D&&(typeof D.read=="function"&&(this._read=D.read),typeof D.destroy=="function"&&(this._destroy=D.destroy)),f.call(this)}Object.defineProperty(V.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(w){this._readableState&&(this._readableState.destroyed=w)}}),V.prototype.destroy=b.destroy,V.prototype._undestroy=b.undestroy,V.prototype._destroy=function(D,w){w(D)},V.prototype.push=function(D,w){var W=this._readableState,H;return W.objectMode?H=!0:typeof D=="string"&&(w=w||W.defaultEncoding,w!==W.encoding&&(D=d.from(D,w),w=""),H=!0),Q(this,D,w,!1,H)},V.prototype.unshift=function(D){return Q(this,D,null,!0,!1)};function Q(D,w,W,H,U){O("readableAddChunk",w);var B=D._readableState;if(w===null)B.reading=!1,ee(D,B);else{var G;if(U||(G=K(B,w)),G)x(D,G);else if(B.objectMode||w&&w.length>0)if(typeof w!="string"&&!B.objectMode&&Object.getPrototypeOf(w)!==d.prototype&&(w=E(w)),H)B.endEmitted?x(D,new C):$(D,B,w,!0);else if(B.ended)x(D,new M);else{if(B.destroyed)return!1;B.reading=!1,B.decoder&&!W?(w=B.decoder.write(w),B.objectMode||w.length!==0?$(D,B,w,!1):ce(D,B)):$(D,B,w,!1)}else H||(B.reading=!1,ce(D,B))}return!B.ended&&(B.length<B.highWaterMark||B.length===0)}function $(D,w,W,H){w.flowing&&w.length===0&&!w.sync?(w.awaitDrain=0,D.emit("data",W)):(w.length+=w.objectMode?1:W.length,H?w.buffer.unshift(W):w.buffer.push(W),w.needReadable&&ne(D)),ce(D,w)}function K(D,w){var W;return!c(w)&&typeof w!="string"&&w!==void 0&&!D.objectMode&&(W=new m("chunk",["string","Buffer","Uint8Array"],w)),W}V.prototype.isPaused=function(){return this._readableState.flowing===!1},V.prototype.setEncoding=function(D){I||(I=r("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder);var w=new I(D);this._readableState.decoder=w,this._readableState.encoding=this._readableState.decoder.encoding;for(var W=this._readableState.buffer.head,H="";W!==null;)H+=w.write(W.data),W=W.next;return this._readableState.buffer.clear(),H!==""&&this._readableState.buffer.push(H),this._readableState.length=H.length,this};var Y=1073741824;function re(D){return D>=Y?D=Y:(D--,D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,D|=D>>>16,D++),D}function ie(D,w){return D<=0||w.length===0&&w.ended?0:w.objectMode?1:D!==D?w.flowing&&w.length?w.buffer.head.data.length:w.length:(D>w.highWaterMark&&(w.highWaterMark=re(D)),D<=w.length?D:w.ended?w.length:(w.needReadable=!0,0))}V.prototype.read=function(D){O("read",D),D=parseInt(D,10);var w=this._readableState,W=D;if(D!==0&&(w.emittedReadable=!1),D===0&&w.needReadable&&((w.highWaterMark!==0?w.length>=w.highWaterMark:w.length>0)||w.ended))return O("read: emitReadable",w.length,w.ended),w.length===0&&w.ended?le(this):ne(this),null;if(D=ie(D,w),D===0&&w.ended)return w.length===0&&le(this),null;var H=w.needReadable;O("need readable",H),(w.length===0||w.length-D<w.highWaterMark)&&(H=!0,O("length less than watermark",H)),w.ended||w.reading?(H=!1,O("reading or ended",H)):H&&(O("do read"),w.reading=!0,w.sync=!0,w.length===0&&(w.needReadable=!0),this._read(w.highWaterMark),w.sync=!1,w.reading||(D=ie(W,w)));var U;return D>0?U=q(D,w):U=null,U===null?(w.needReadable=w.length<=w.highWaterMark,D=0):(w.length-=D,w.awaitDrain=0),w.length===0&&(w.ended||(w.needReadable=!0),W!==D&&w.ended&&le(this)),U!==null&&this.emit("data",U),U};function ee(D,w){if(O("onEofChunk"),!w.ended){if(w.decoder){var W=w.decoder.end();W&&W.length&&(w.buffer.push(W),w.length+=w.objectMode?1:W.length)}w.ended=!0,w.sync?ne(D):(w.needReadable=!1,w.emittedReadable||(w.emittedReadable=!0,ae(D)))}}function ne(D){var w=D._readableState;O("emitReadable",w.needReadable,w.emittedReadable),w.needReadable=!1,w.emittedReadable||(O("emitReadable",w.flowing),w.emittedReadable=!0,process.nextTick(ae,D))}function ae(D){var w=D._readableState;O("emitReadable_",w.destroyed,w.length,w.ended),!w.destroyed&&(w.length||w.ended)&&(D.emit("readable"),w.emittedReadable=!1),w.needReadable=!w.flowing&&!w.ended&&w.length<=w.highWaterMark,Z(D)}function ce(D,w){w.readingMore||(w.readingMore=!0,process.nextTick(X,D,w))}function X(D,w){for(;!w.reading&&!w.ended&&(w.length<w.highWaterMark||w.flowing&&w.length===0);){var W=w.length;if(O("maybeReadMore read 0"),D.read(0),W===w.length)break}w.readingMore=!1}V.prototype._read=function(D){x(this,new p("_read()"))},V.prototype.pipe=function(D,w){var W=this,H=this._readableState;switch(H.pipesCount){case 0:H.pipes=D;break;case 1:H.pipes=[H.pipes,D];break;default:H.pipes.push(D);break}H.pipesCount+=1,O("pipe count=%d opts=%j",H.pipesCount,w);var U=(!w||w.end!==!1)&&D!==process.stdout&&D!==process.stderr,B=U?z:Be;H.endEmitted?process.nextTick(B):W.once("end",B),D.on("unpipe",G);function G(ke,Ye){O("onunpipe"),ke===W&&Ye&&Ye.hasUnpiped===!1&&(Ye.hasUnpiped=!0,J())}function z(){O("onend"),D.end()}var fe=oe(W);D.on("drain",fe);var ue=!1;function J(){O("cleanup"),D.removeListener("close",Ae),D.removeListener("finish",be),D.removeListener("drain",fe),D.removeListener("error",me),D.removeListener("unpipe",G),W.removeListener("end",z),W.removeListener("end",Be),W.removeListener("data",ve),ue=!0,H.awaitDrain&&(!D._writableState||D._writableState.needDrain)&&fe()}W.on("data",ve);function ve(ke){O("ondata");var Ye=D.write(ke);O("dest.write",Ye),Ye===!1&&((H.pipesCount===1&&H.pipes===D||H.pipesCount>1&&N(H.pipes,D)!==-1)&&!ue&&(O("false write response, pause",H.awaitDrain),H.awaitDrain++),W.pause())}function me(ke){O("onerror",ke),Be(),D.removeListener("error",me),l(D,"error")===0&&x(D,ke)}k(D,"error",me);function Ae(){D.removeListener("finish",be),Be()}D.once("close",Ae);function be(){O("onfinish"),D.removeListener("close",Ae),Be()}D.once("finish",be);function Be(){O("unpipe"),W.unpipe(D)}return D.emit("pipe",W),H.flowing||(O("pipe resume"),W.resume()),D};function oe(D){return function(){var W=D._readableState;O("pipeOnDrain",W.awaitDrain),W.awaitDrain&&W.awaitDrain--,W.awaitDrain===0&&l(D,"data")&&(W.flowing=!0,Z(D))}}V.prototype.unpipe=function(D){var w=this._readableState,W={hasUnpiped:!1};if(w.pipesCount===0)return this;if(w.pipesCount===1)return D&&D!==w.pipes?this:(D||(D=w.pipes),w.pipes=null,w.pipesCount=0,w.flowing=!1,D&&D.emit("unpipe",this,W),this);if(!D){var H=w.pipes,U=w.pipesCount;w.pipes=null,w.pipesCount=0,w.flowing=!1;for(var B=0;B<U;B++)H[B].emit("unpipe",this,{hasUnpiped:!1});return this}var G=N(w.pipes,D);return G===-1?this:(w.pipes.splice(G,1),w.pipesCount-=1,w.pipesCount===1&&(w.pipes=w.pipes[0]),D.emit("unpipe",this,W),this)},V.prototype.on=function(D,w){var W=f.prototype.on.call(this,D,w),H=this._readableState;return D==="data"?(H.readableListening=this.listenerCount("readable")>0,H.flowing!==!1&&this.resume()):D==="readable"&&!H.endEmitted&&!H.readableListening&&(H.readableListening=H.needReadable=!0,H.flowing=!1,H.emittedReadable=!1,O("on readable",H.length,H.reading),H.length?ne(this):H.reading||process.nextTick(_e,this)),W},V.prototype.addListener=V.prototype.on,V.prototype.removeListener=function(D,w){var W=f.prototype.removeListener.call(this,D,w);return D==="readable"&&process.nextTick(ge,this),W},V.prototype.removeAllListeners=function(D){var w=f.prototype.removeAllListeners.apply(this,arguments);return(D==="readable"||D===void 0)&&process.nextTick(ge,this),w};function ge(D){var w=D._readableState;w.readableListening=D.listenerCount("readable")>0,w.resumeScheduled&&!w.paused?w.flowing=!0:D.listenerCount("data")>0&&D.resume()}function _e(D){O("readable nexttick read 0"),D.read(0)}V.prototype.resume=function(){var D=this._readableState;return D.flowing||(O("resume"),D.flowing=!D.readableListening,he(this,D)),D.paused=!1,this};function he(D,w){w.resumeScheduled||(w.resumeScheduled=!0,process.nextTick(se,D,w))}function se(D,w){O("resume",w.reading),w.reading||D.read(0),w.resumeScheduled=!1,D.emit("resume"),Z(D),w.flowing&&!w.reading&&D.read(0)}V.prototype.pause=function(){return O("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(O("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Z(D){var w=D._readableState;for(O("flow",w.flowing);w.flowing&&D.read()!==null;);}V.prototype.wrap=function(D){var w=this,W=this._readableState,H=!1;D.on("end",function(){if(O("wrapped end"),W.decoder&&!W.ended){var G=W.decoder.end();G&&G.length&&w.push(G)}w.push(null)}),D.on("data",function(G){if(O("wrapped data"),W.decoder&&(G=W.decoder.write(G)),!(W.objectMode&&G==null)&&!(!W.objectMode&&(!G||!G.length))){var z=w.push(G);z||(H=!0,D.pause())}});for(var U in D)this[U]===void 0&&typeof D[U]=="function"&&(this[U]=function(z){return function(){return D[z].apply(D,arguments)}}(U));for(var B=0;B<F.length;B++)D.on(F[B],this.emit.bind(this,F[B]));return this._read=function(G){O("wrapped _read",G),H&&(H=!1,D.resume())},this},typeof Symbol=="function"&&(V.prototype[Symbol.asyncIterator]=function(){return A===void 0&&(A=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/async_iterator.js")),A(this)}),Object.defineProperty(V.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(V.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(V.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(w){this._readableState&&(this._readableState.flowing=w)}}),V._fromList=q,Object.defineProperty(V.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function q(D,w){if(w.length===0)return null;var W;return w.objectMode?W=w.buffer.shift():!D||D>=w.length?(w.decoder?W=w.buffer.join(""):w.buffer.length===1?W=w.buffer.first():W=w.buffer.concat(w.length),w.buffer.clear()):W=w.buffer.consume(D,w.decoder),W}function le(D){var w=D._readableState;O("endReadable",w.endEmitted),w.endEmitted||(w.ended=!0,process.nextTick(te,w,D))}function te(D,w){if(O("endReadableNT",D.endEmitted,D.length),!D.endEmitted&&D.length===0&&(D.endEmitted=!0,w.readable=!1,w.emit("end"),D.autoDestroy)){var W=w._writableState;(!W||W.autoDestroy&&W.finished)&&w.destroy()}}typeof Symbol=="function"&&(V.from=function(D,w){return S===void 0&&(S=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/from-browser.js")),S(V,D,w)});function N(D,w){for(var W=0,H=D.length;W<H;W++)if(D[W]===w)return W;return-1}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_transform.js":(h,i,r)=>{h.exports=y;var u=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,l=u.ERR_METHOD_NOT_IMPLEMENTED,f=u.ERR_MULTIPLE_CALLBACK,d=u.ERR_TRANSFORM_ALREADY_TRANSFORMING,_=u.ERR_TRANSFORM_WITH_LENGTH_0,E=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js");r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(y,E);function c(b,L){var R=this._transformState;R.transforming=!1;var T=R.writecb;if(T===null)return this.emit("error",new f);R.writechunk=null,R.writecb=null,L!=null&&this.push(L),T(b);var m=this._readableState;m.reading=!1,(m.needReadable||m.length<m.highWaterMark)&&this._read(m.highWaterMark)}function y(b){if(!(this instanceof y))return new y(b);E.call(this,b),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,b&&(typeof b.transform=="function"&&(this._transform=b.transform),typeof b.flush=="function"&&(this._flush=b.flush)),this.on("prefinish",O)}function O(){var b=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(L,R){P(b,L,R)}):P(this,null,null)}y.prototype.push=function(b,L){return this._transformState.needTransform=!1,E.prototype.push.call(this,b,L)},y.prototype._transform=function(b,L,R){R(new l("_transform()"))},y.prototype._write=function(b,L,R){var T=this._transformState;if(T.writecb=R,T.writechunk=b,T.writeencoding=L,!T.transforming){var m=this._readableState;(T.needTransform||m.needReadable||m.length<m.highWaterMark)&&this._read(m.highWaterMark)}},y.prototype._read=function(b){var L=this._transformState;L.writechunk!==null&&!L.transforming?(L.transforming=!0,this._transform(L.writechunk,L.writeencoding,L.afterTransform)):L.needTransform=!0},y.prototype._destroy=function(b,L){E.prototype._destroy.call(this,b,function(R){L(R)})};function P(b,L,R){if(L)return b.emit("error",L);if(R!=null&&b.push(R),b._writableState.length)throw new _;if(b._transformState.transforming)throw new d;return b.push(null)}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_writable.js":(h,i,r)=>{h.exports=j;function u(Z){var q=this;this.next=null,this.entry=null,this.finish=function(){se(q,Z)}}var l;j.WritableState=F;var f={deprecate:r("./node_modules/util-deprecate/browser.js")},d=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/stream-browser.js"),_=r("./node_modules/buffer/index.js").Buffer,E=r.g.Uint8Array||function(){};function c(Z){return _.from(Z)}function y(Z){return _.isBuffer(Z)||Z instanceof E}var O=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/destroy.js"),P=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/state.js"),b=P.getHighWaterMark,L=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,R=L.ERR_INVALID_ARG_TYPE,T=L.ERR_METHOD_NOT_IMPLEMENTED,m=L.ERR_MULTIPLE_CALLBACK,M=L.ERR_STREAM_CANNOT_PIPE,p=L.ERR_STREAM_DESTROYED,C=L.ERR_STREAM_NULL_VALUES,I=L.ERR_STREAM_WRITE_AFTER_END,A=L.ERR_UNKNOWN_ENCODING,S=O.errorOrDestroy;r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(j,d);function x(){}function F(Z,q,le){l=l||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),Z=Z||{},typeof le!="boolean"&&(le=q instanceof l),this.objectMode=!!Z.objectMode,le&&(this.objectMode=this.objectMode||!!Z.writableObjectMode),this.highWaterMark=b(this,Z,"writableHighWaterMark",le),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var te=Z.decodeStrings===!1;this.decodeStrings=!te,this.defaultEncoding=Z.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(N){ee(q,N)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=Z.emitClose!==!1,this.autoDestroy=!!Z.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new u(this)}F.prototype.getBuffer=function(){for(var q=this.bufferedRequest,le=[];q;)le.push(q),q=q.next;return le},function(){try{Object.defineProperty(F.prototype,"buffer",{get:f.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var k;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(k=Function.prototype[Symbol.hasInstance],Object.defineProperty(j,Symbol.hasInstance,{value:function(q){return k.call(this,q)?!0:this!==j?!1:q&&q._writableState instanceof F}})):k=function(q){return q instanceof this};function j(Z){l=l||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js");var q=this instanceof l;if(!q&&!k.call(j,this))return new j(Z);this._writableState=new F(Z,this,q),this.writable=!0,Z&&(typeof Z.write=="function"&&(this._write=Z.write),typeof Z.writev=="function"&&(this._writev=Z.writev),typeof Z.destroy=="function"&&(this._destroy=Z.destroy),typeof Z.final=="function"&&(this._final=Z.final)),d.call(this)}j.prototype.pipe=function(){S(this,new M)};function V(Z,q){var le=new I;S(Z,le),process.nextTick(q,le)}function Q(Z,q,le,te){var N;return le===null?N=new C:typeof le!="string"&&!q.objectMode&&(N=new R("chunk",["string","Buffer"],le)),N?(S(Z,N),process.nextTick(te,N),!1):!0}j.prototype.write=function(Z,q,le){var te=this._writableState,N=!1,D=!te.objectMode&&y(Z);return D&&!_.isBuffer(Z)&&(Z=c(Z)),typeof q=="function"&&(le=q,q=null),D?q="buffer":q||(q=te.defaultEncoding),typeof le!="function"&&(le=x),te.ending?V(this,le):(D||Q(this,te,Z,le))&&(te.pendingcb++,N=K(this,te,D,Z,q,le)),N},j.prototype.cork=function(){this._writableState.corked++},j.prototype.uncork=function(){var Z=this._writableState;Z.corked&&(Z.corked--,!Z.writing&&!Z.corked&&!Z.bufferProcessing&&Z.bufferedRequest&&ce(this,Z))},j.prototype.setDefaultEncoding=function(q){if(typeof q=="string"&&(q=q.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((q+"").toLowerCase())>-1))throw new A(q);return this._writableState.defaultEncoding=q,this},Object.defineProperty(j.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function $(Z,q,le){return!Z.objectMode&&Z.decodeStrings!==!1&&typeof q=="string"&&(q=_.from(q,le)),q}Object.defineProperty(j.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function K(Z,q,le,te,N,D){if(!le){var w=$(q,te,N);te!==w&&(le=!0,N="buffer",te=w)}var W=q.objectMode?1:te.length;q.length+=W;var H=q.length<q.highWaterMark;if(H||(q.needDrain=!0),q.writing||q.corked){var U=q.lastBufferedRequest;q.lastBufferedRequest={chunk:te,encoding:N,isBuf:le,callback:D,next:null},U?U.next=q.lastBufferedRequest:q.bufferedRequest=q.lastBufferedRequest,q.bufferedRequestCount+=1}else Y(Z,q,!1,W,te,N,D);return H}function Y(Z,q,le,te,N,D,w){q.writelen=te,q.writecb=w,q.writing=!0,q.sync=!0,q.destroyed?q.onwrite(new p("write")):le?Z._writev(N,q.onwrite):Z._write(N,D,q.onwrite),q.sync=!1}function re(Z,q,le,te,N){--q.pendingcb,le?(process.nextTick(N,te),process.nextTick(_e,Z,q),Z._writableState.errorEmitted=!0,S(Z,te)):(N(te),Z._writableState.errorEmitted=!0,S(Z,te),_e(Z,q))}function ie(Z){Z.writing=!1,Z.writecb=null,Z.length-=Z.writelen,Z.writelen=0}function ee(Z,q){var le=Z._writableState,te=le.sync,N=le.writecb;if(typeof N!="function")throw new m;if(ie(le),q)re(Z,le,te,q,N);else{var D=X(le)||Z.destroyed;!D&&!le.corked&&!le.bufferProcessing&&le.bufferedRequest&&ce(Z,le),te?process.nextTick(ne,Z,le,D,N):ne(Z,le,D,N)}}function ne(Z,q,le,te){le||ae(Z,q),q.pendingcb--,te(),_e(Z,q)}function ae(Z,q){q.length===0&&q.needDrain&&(q.needDrain=!1,Z.emit("drain"))}function ce(Z,q){q.bufferProcessing=!0;var le=q.bufferedRequest;if(Z._writev&&le&&le.next){var te=q.bufferedRequestCount,N=new Array(te),D=q.corkedRequestsFree;D.entry=le;for(var w=0,W=!0;le;)N[w]=le,le.isBuf||(W=!1),le=le.next,w+=1;N.allBuffers=W,Y(Z,q,!0,q.length,N,"",D.finish),q.pendingcb++,q.lastBufferedRequest=null,D.next?(q.corkedRequestsFree=D.next,D.next=null):q.corkedRequestsFree=new u(q),q.bufferedRequestCount=0}else{for(;le;){var H=le.chunk,U=le.encoding,B=le.callback,G=q.objectMode?1:H.length;if(Y(Z,q,!1,G,H,U,B),le=le.next,q.bufferedRequestCount--,q.writing)break}le===null&&(q.lastBufferedRequest=null)}q.bufferedRequest=le,q.bufferProcessing=!1}j.prototype._write=function(Z,q,le){le(new T("_write()"))},j.prototype._writev=null,j.prototype.end=function(Z,q,le){var te=this._writableState;return typeof Z=="function"?(le=Z,Z=null,q=null):typeof q=="function"&&(le=q,q=null),Z!=null&&this.write(Z,q),te.corked&&(te.corked=1,this.uncork()),te.ending||he(this,te,le),this},Object.defineProperty(j.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function X(Z){return Z.ending&&Z.length===0&&Z.bufferedRequest===null&&!Z.finished&&!Z.writing}function oe(Z,q){Z._final(function(le){q.pendingcb--,le&&S(Z,le),q.prefinished=!0,Z.emit("prefinish"),_e(Z,q)})}function ge(Z,q){!q.prefinished&&!q.finalCalled&&(typeof Z._final=="function"&&!q.destroyed?(q.pendingcb++,q.finalCalled=!0,process.nextTick(oe,Z,q)):(q.prefinished=!0,Z.emit("prefinish")))}function _e(Z,q){var le=X(q);if(le&&(ge(Z,q),q.pendingcb===0&&(q.finished=!0,Z.emit("finish"),q.autoDestroy))){var te=Z._readableState;(!te||te.autoDestroy&&te.endEmitted)&&Z.destroy()}return le}function he(Z,q,le){q.ending=!0,_e(Z,q),le&&(q.finished?process.nextTick(le):Z.once("finish",le)),q.ended=!0,Z.writable=!1}function se(Z,q,le){var te=Z.entry;for(Z.entry=null;te;){var N=te.callback;q.pendingcb--,N(le),te=te.next}q.corkedRequestsFree.next=Z}Object.defineProperty(j.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(q){this._writableState&&(this._writableState.destroyed=q)}}),j.prototype.destroy=O.destroy,j.prototype._undestroy=O.undestroy,j.prototype._destroy=function(Z,q){q(Z)}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/async_iterator.js":(h,i,r)=>{var u;function l(C,I,A){return I in C?Object.defineProperty(C,I,{value:A,enumerable:!0,configurable:!0,writable:!0}):C[I]=A,C}var f=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"),d=Symbol("lastResolve"),_=Symbol("lastReject"),E=Symbol("error"),c=Symbol("ended"),y=Symbol("lastPromise"),O=Symbol("handlePromise"),P=Symbol("stream");function b(C,I){return{value:C,done:I}}function L(C){var I=C[d];if(I!==null){var A=C[P].read();A!==null&&(C[y]=null,C[d]=null,C[_]=null,I(b(A,!1)))}}function R(C){process.nextTick(L,C)}function T(C,I){return function(A,S){C.then(function(){if(I[c]){A(b(void 0,!0));return}I[O](A,S)},S)}}var m=Object.getPrototypeOf(function(){}),M=Object.setPrototypeOf((u={get stream(){return this[P]},next:function(){var I=this,A=this[E];if(A!==null)return Promise.reject(A);if(this[c])return Promise.resolve(b(void 0,!0));if(this[P].destroyed)return new Promise(function(k,j){process.nextTick(function(){I[E]?j(I[E]):k(b(void 0,!0))})});var S=this[y],x;if(S)x=new Promise(T(S,this));else{var F=this[P].read();if(F!==null)return Promise.resolve(b(F,!1));x=new Promise(this[O])}return this[y]=x,x}},l(u,Symbol.asyncIterator,function(){return this}),l(u,"return",function(){var I=this;return new Promise(function(A,S){I[P].destroy(null,function(x){if(x){S(x);return}A(b(void 0,!0))})})}),u),m),p=function(I){var A,S=Object.create(M,(A={},l(A,P,{value:I,writable:!0}),l(A,d,{value:null,writable:!0}),l(A,_,{value:null,writable:!0}),l(A,E,{value:null,writable:!0}),l(A,c,{value:I._readableState.endEmitted,writable:!0}),l(A,O,{value:function(F,k){var j=S[P].read();j?(S[y]=null,S[d]=null,S[_]=null,F(b(j,!1))):(S[d]=F,S[_]=k)},writable:!0}),A));return S[y]=null,f(I,function(x){if(x&&x.code!=="ERR_STREAM_PREMATURE_CLOSE"){var F=S[_];F!==null&&(S[y]=null,S[d]=null,S[_]=null,F(x)),S[E]=x;return}var k=S[d];k!==null&&(S[y]=null,S[d]=null,S[_]=null,k(b(void 0,!0))),S[c]=!0}),I.on("readable",R.bind(null,S)),S};h.exports=p},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/buffer_list.js":(h,i,r)=>{function u(R,T){var m=Object.keys(R);if(Object.getOwnPropertySymbols){var M=Object.getOwnPropertySymbols(R);T&&(M=M.filter(function(p){return Object.getOwnPropertyDescriptor(R,p).enumerable})),m.push.apply(m,M)}return m}function l(R){for(var T=1;T<arguments.length;T++){var m=arguments[T]!=null?arguments[T]:{};T%2?u(Object(m),!0).forEach(function(M){f(R,M,m[M])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(m)):u(Object(m)).forEach(function(M){Object.defineProperty(R,M,Object.getOwnPropertyDescriptor(m,M))})}return R}function f(R,T,m){return T in R?Object.defineProperty(R,T,{value:m,enumerable:!0,configurable:!0,writable:!0}):R[T]=m,R}function d(R,T){if(!(R instanceof T))throw new TypeError("Cannot call a class as a function")}function _(R,T){for(var m=0;m<T.length;m++){var M=T[m];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(R,M.key,M)}}function E(R,T,m){return T&&_(R.prototype,T),m&&_(R,m),R}var c=r("./node_modules/buffer/index.js"),y=c.Buffer,O=r("?3e83"),P=O.inspect,b=P&&P.custom||"inspect";function L(R,T,m){y.prototype.copy.call(R,T,m)}h.exports=function(){function R(){d(this,R),this.head=null,this.tail=null,this.length=0}return E(R,[{key:"push",value:function(m){var M={data:m,next:null};this.length>0?this.tail.next=M:this.head=M,this.tail=M,++this.length}},{key:"unshift",value:function(m){var M={data:m,next:this.head};this.length===0&&(this.tail=M),this.head=M,++this.length}},{key:"shift",value:function(){if(this.length!==0){var m=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,m}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(m){if(this.length===0)return"";for(var M=this.head,p=""+M.data;M=M.next;)p+=m+M.data;return p}},{key:"concat",value:function(m){if(this.length===0)return y.alloc(0);for(var M=y.allocUnsafe(m>>>0),p=this.head,C=0;p;)L(p.data,M,C),C+=p.data.length,p=p.next;return M}},{key:"consume",value:function(m,M){var p;return m<this.head.data.length?(p=this.head.data.slice(0,m),this.head.data=this.head.data.slice(m)):m===this.head.data.length?p=this.shift():p=M?this._getString(m):this._getBuffer(m),p}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(m){var M=this.head,p=1,C=M.data;for(m-=C.length;M=M.next;){var I=M.data,A=m>I.length?I.length:m;if(A===I.length?C+=I:C+=I.slice(0,m),m-=A,m===0){A===I.length?(++p,M.next?this.head=M.next:this.head=this.tail=null):(this.head=M,M.data=I.slice(A));break}++p}return this.length-=p,C}},{key:"_getBuffer",value:function(m){var M=y.allocUnsafe(m),p=this.head,C=1;for(p.data.copy(M),m-=p.data.length;p=p.next;){var I=p.data,A=m>I.length?I.length:m;if(I.copy(M,M.length-m,0,A),m-=A,m===0){A===I.length?(++C,p.next?this.head=p.next:this.head=this.tail=null):(this.head=p,p.data=I.slice(A));break}++C}return this.length-=C,M}},{key:b,value:function(m,M){return P(this,l({},M,{depth:0,customInspect:!1}))}}]),R}()},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/destroy.js":h=>{function i(_,E){var c=this,y=this._readableState&&this._readableState.destroyed,O=this._writableState&&this._writableState.destroyed;return y||O?(E?E(_):_&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(f,this,_)):process.nextTick(f,this,_)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(_||null,function(P){!E&&P?c._writableState?c._writableState.errorEmitted?process.nextTick(u,c):(c._writableState.errorEmitted=!0,process.nextTick(r,c,P)):process.nextTick(r,c,P):E?(process.nextTick(u,c),E(P)):process.nextTick(u,c)}),this)}function r(_,E){f(_,E),u(_)}function u(_){_._writableState&&!_._writableState.emitClose||_._readableState&&!_._readableState.emitClose||_.emit("close")}function l(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function f(_,E){_.emit("error",E)}function d(_,E){var c=_._readableState,y=_._writableState;c&&c.autoDestroy||y&&y.autoDestroy?_.destroy(E):_.emit("error",E)}h.exports={destroy:i,undestroy:l,errorOrDestroy:d}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js":(h,i,r)=>{var u=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes.ERR_STREAM_PREMATURE_CLOSE;function l(E){var c=!1;return function(){if(!c){c=!0;for(var y=arguments.length,O=new Array(y),P=0;P<y;P++)O[P]=arguments[P];E.apply(this,O)}}}function f(){}function d(E){return E.setHeader&&typeof E.abort=="function"}function _(E,c,y){if(typeof c=="function")return _(E,null,c);c||(c={}),y=l(y||f);var O=c.readable||c.readable!==!1&&E.readable,P=c.writable||c.writable!==!1&&E.writable,b=function(){E.writable||R()},L=E._writableState&&E._writableState.finished,R=function(){P=!1,L=!0,O||y.call(E)},T=E._readableState&&E._readableState.endEmitted,m=function(){O=!1,T=!0,P||y.call(E)},M=function(A){y.call(E,A)},p=function(){var A;if(O&&!T)return(!E._readableState||!E._readableState.ended)&&(A=new u),y.call(E,A);if(P&&!L)return(!E._writableState||!E._writableState.ended)&&(A=new u),y.call(E,A)},C=function(){E.req.on("finish",R)};return d(E)?(E.on("complete",R),E.on("abort",p),E.req?C():E.on("request",C)):P&&!E._writableState&&(E.on("end",b),E.on("close",b)),E.on("end",m),E.on("finish",R),c.error!==!1&&E.on("error",M),E.on("close",p),function(){E.removeListener("complete",R),E.removeListener("abort",p),E.removeListener("request",C),E.req&&E.req.removeListener("finish",R),E.removeListener("end",b),E.removeListener("close",b),E.removeListener("finish",R),E.removeListener("end",m),E.removeListener("error",M),E.removeListener("close",p)}}h.exports=_},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/from-browser.js":h=>{h.exports=function(){throw new Error("Readable.from is not available in the browser")}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/pipeline.js":(h,i,r)=>{var u;function l(R){var T=!1;return function(){T||(T=!0,R.apply(void 0,arguments))}}var f=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,d=f.ERR_MISSING_ARGS,_=f.ERR_STREAM_DESTROYED;function E(R){if(R)throw R}function c(R){return R.setHeader&&typeof R.abort=="function"}function y(R,T,m,M){M=l(M);var p=!1;R.on("close",function(){p=!0}),u===void 0&&(u=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js")),u(R,{readable:T,writable:m},function(I){if(I)return M(I);p=!0,M()});var C=!1;return function(I){if(!p&&!C){if(C=!0,c(R))return R.abort();if(typeof R.destroy=="function")return R.destroy();M(I||new _("pipe"))}}}function O(R){R()}function P(R,T){return R.pipe(T)}function b(R){return!R.length||typeof R[R.length-1]!="function"?E:R.pop()}function L(){for(var R=arguments.length,T=new Array(R),m=0;m<R;m++)T[m]=arguments[m];var M=b(T);if(Array.isArray(T[0])&&(T=T[0]),T.length<2)throw new d("streams");var p,C=T.map(function(I,A){var S=A<T.length-1,x=A>0;return y(I,S,x,function(F){p||(p=F),F&&C.forEach(O),!S&&(C.forEach(O),M(p))})});return T.reduce(P)}h.exports=L},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/state.js":(h,i,r)=>{var u=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes.ERR_INVALID_OPT_VALUE;function l(d,_,E){return d.highWaterMark!=null?d.highWaterMark:_?d[E]:null}function f(d,_,E,c){var y=l(_,c,E);if(y!=null){if(!(isFinite(y)&&Math.floor(y)===y)||y<0){var O=c?E:"highWaterMark";throw new u(O,y)}return Math.floor(y)}return d.objectMode?16:16384}h.exports={getHighWaterMark:f}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/stream-browser.js":(h,i,r)=>{h.exports=r("./node_modules/events/events.js").EventEmitter},"./node_modules/string_decoder/lib/string_decoder.js":(h,i,r)=>{var u=r("./node_modules/safe-buffer/index.js").Buffer,l=u.isEncoding||function(C){switch(C=""+C,C&&C.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function f(C){if(!C)return"utf8";for(var I;;)switch(C){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return C;default:if(I)return;C=(""+C).toLowerCase(),I=!0}}function d(C){var I=f(C);if(typeof I!="string"&&(u.isEncoding===l||!l(C)))throw new Error("Unknown encoding: "+C);return I||C}i.StringDecoder=_;function _(C){this.encoding=d(C);var I;switch(this.encoding){case"utf16le":this.text=L,this.end=R,I=4;break;case"utf8":this.fillLast=O,I=4;break;case"base64":this.text=T,this.end=m,I=3;break;default:this.write=M,this.end=p;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=u.allocUnsafe(I)}_.prototype.write=function(C){if(C.length===0)return"";var I,A;if(this.lastNeed){if(I=this.fillLast(C),I===void 0)return"";A=this.lastNeed,this.lastNeed=0}else A=0;return A<C.length?I?I+this.text(C,A):this.text(C,A):I||""},_.prototype.end=b,_.prototype.text=P,_.prototype.fillLast=function(C){if(this.lastNeed<=C.length)return C.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);C.copy(this.lastChar,this.lastTotal-this.lastNeed,0,C.length),this.lastNeed-=C.length};function E(C){return C<=127?0:C>>5===6?2:C>>4===14?3:C>>3===30?4:C>>6===2?-1:-2}function c(C,I,A){var S=I.length-1;if(S<A)return 0;var x=E(I[S]);return x>=0?(x>0&&(C.lastNeed=x-1),x):--S<A||x===-2?0:(x=E(I[S]),x>=0?(x>0&&(C.lastNeed=x-2),x):--S<A||x===-2?0:(x=E(I[S]),x>=0?(x>0&&(x===2?x=0:C.lastNeed=x-3),x):0))}function y(C,I,A){if((I[0]&192)!==128)return C.lastNeed=0,"�";if(C.lastNeed>1&&I.length>1){if((I[1]&192)!==128)return C.lastNeed=1,"�";if(C.lastNeed>2&&I.length>2&&(I[2]&192)!==128)return C.lastNeed=2,"�"}}function O(C){var I=this.lastTotal-this.lastNeed,A=y(this,C);if(A!==void 0)return A;if(this.lastNeed<=C.length)return C.copy(this.lastChar,I,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);C.copy(this.lastChar,I,0,C.length),this.lastNeed-=C.length}function P(C,I){var A=c(this,C,I);if(!this.lastNeed)return C.toString("utf8",I);this.lastTotal=A;var S=C.length-(A-this.lastNeed);return C.copy(this.lastChar,0,S),C.toString("utf8",I,S)}function b(C){var I=C&&C.length?this.write(C):"";return this.lastNeed?I+"�":I}function L(C,I){if((C.length-I)%2===0){var A=C.toString("utf16le",I);if(A){var S=A.charCodeAt(A.length-1);if(S>=55296&&S<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=C[C.length-2],this.lastChar[1]=C[C.length-1],A.slice(0,-1)}return A}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=C[C.length-1],C.toString("utf16le",I,C.length-1)}function R(C){var I=C&&C.length?this.write(C):"";if(this.lastNeed){var A=this.lastTotal-this.lastNeed;return I+this.lastChar.toString("utf16le",0,A)}return I}function T(C,I){var A=(C.length-I)%3;return A===0?C.toString("base64",I):(this.lastNeed=3-A,this.lastTotal=3,A===1?this.lastChar[0]=C[C.length-1]:(this.lastChar[0]=C[C.length-2],this.lastChar[1]=C[C.length-1]),C.toString("base64",I,C.length-A))}function m(C){var I=C&&C.length?this.write(C):"";return this.lastNeed?I+this.lastChar.toString("base64",0,3-this.lastNeed):I}function M(C){return C.toString(this.encoding)}function p(C){return C&&C.length?this.write(C):""}},"./node_modules/ua-parser-js/src/ua-parser.js":function(h,i,r){var u;(function(l,f){var d="1.0.2",_="",E="?",c="function",y="undefined",O="object",P="string",b="major",L="model",R="name",T="type",m="vendor",M="version",p="architecture",C="console",I="mobile",A="tablet",S="smarttv",x="wearable",F="embedded",k=255,j="Amazon",V="Apple",Q="ASUS",$="BlackBerry",K="Browser",Y="Chrome",re="Edge",ie="Firefox",ee="Google",ne="Huawei",ae="LG",ce="Microsoft",X="Motorola",oe="Opera",ge="Samsung",_e="Sony",he="Xiaomi",se="Zebra",Z="Facebook",q=function(J,ve){var me={};for(var Ae in J)ve[Ae]&&ve[Ae].length%2===0?me[Ae]=ve[Ae].concat(J[Ae]):me[Ae]=J[Ae];return me},le=function(J){for(var ve={},me=0;me<J.length;me++)ve[J[me].toUpperCase()]=J[me];return ve},te=function(J,ve){return typeof J===P?N(ve).indexOf(N(J))!==-1:!1},N=function(J){return J.toLowerCase()},D=function(J){return typeof J===P?J.replace(/[^\d\.]/g,_).split(".")[0]:f},w=function(J,ve){if(typeof J===P)return J=J.replace(/^\s\s*/,_).replace(/\s\s*$/,_),typeof ve===y?J:J.substring(0,k)},W=function(J,ve){for(var me=0,Ae,be,Be,ke,Ye,Le;me<ve.length&&!Ye;){var Se=ve[me],Me=ve[me+1];for(Ae=be=0;Ae<Se.length&&!Ye;)if(Ye=Se[Ae++].exec(J),Ye)for(Be=0;Be<Me.length;Be++)Le=Ye[++be],ke=Me[Be],typeof ke===O&&ke.length>0?ke.length===2?typeof ke[1]==c?this[ke[0]]=ke[1].call(this,Le):this[ke[0]]=ke[1]:ke.length===3?typeof ke[1]===c&&!(ke[1].exec&&ke[1].test)?this[ke[0]]=Le?ke[1].call(this,Le,ke[2]):f:this[ke[0]]=Le?Le.replace(ke[1],ke[2]):f:ke.length===4&&(this[ke[0]]=Le?ke[3].call(this,Le.replace(ke[1],ke[2])):f):this[ke]=Le||f;me+=2}},H=function(J,ve){for(var me in ve)if(typeof ve[me]===O&&ve[me].length>0){for(var Ae=0;Ae<ve[me].length;Ae++)if(te(ve[me][Ae],J))return me===E?f:me}else if(te(ve[me],J))return me===E?f:me;return J},U={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},B={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},G={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[M,[R,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[M,[R,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[R,M],[/opios[\/ ]+([\w\.]+)/i],[M,[R,oe+" Mini"]],[/\bopr\/([\w\.]+)/i],[M,[R,oe]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[R,M],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[M,[R,"UC"+K]],[/\bqbcore\/([\w\.]+)/i],[M,[R,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[M,[R,"WeChat"]],[/konqueror\/([\w\.]+)/i],[M,[R,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[M,[R,"IE"]],[/yabrowser\/([\w\.]+)/i],[M,[R,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[R,/(.+)/,"$1 Secure "+K],M],[/\bfocus\/([\w\.]+)/i],[M,[R,ie+" Focus"]],[/\bopt\/([\w\.]+)/i],[M,[R,oe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[M,[R,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[M,[R,"Dolphin"]],[/coast\/([\w\.]+)/i],[M,[R,oe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[M,[R,"MIUI "+K]],[/fxios\/([-\w\.]+)/i],[M,[R,ie]],[/\bqihu|(qi?ho?o?|360)browser/i],[[R,"360 "+K]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[R,/(.+)/,"$1 "+K],M],[/(comodo_dragon)\/([\w\.]+)/i],[[R,/_/g," "],M],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[R,M],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[R],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[R,Z],M],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[R,M],[/\bgsa\/([\w\.]+) .*safari\//i],[M,[R,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[M,[R,Y+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[R,Y+" WebView"],M],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[M,[R,"Android "+K]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[R,M],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[M,[R,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[M,R],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[R,[M,H,U]],[/(webkit|khtml)\/([\w\.]+)/i],[R,M],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[R,"Netscape"],M],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[M,[R,ie+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[R,M]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,N]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,_,N]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,N]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[L,[m,ge],[T,A]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[L,[m,ge],[T,I]],[/\((ip(?:hone|od)[\w ]*);/i],[L,[m,V],[T,I]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[L,[m,V],[T,A]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[L,[m,ne],[T,A]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[L,[m,ne],[T,I]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[L,/_/g," "],[m,he],[T,I]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[L,/_/g," "],[m,he],[T,A]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[L,[m,"OPPO"],[T,I]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[L,[m,"Vivo"],[T,I]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[L,[m,"Realme"],[T,I]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[L,[m,X],[T,I]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[L,[m,X],[T,A]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[L,[m,ae],[T,A]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[L,[m,ae],[T,I]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[L,[m,"Lenovo"],[T,A]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[L,/_/g," "],[m,"Nokia"],[T,I]],[/(pixel c)\b/i],[L,[m,ee],[T,A]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[L,[m,ee],[T,I]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[L,[m,_e],[T,I]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[L,"Xperia Tablet"],[m,_e],[T,A]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[L,[m,"OnePlus"],[T,I]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[L,[m,j],[T,A]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[L,/(.+)/g,"Fire Phone $1"],[m,j],[T,I]],[/(playbook);[-\w\),; ]+(rim)/i],[L,m,[T,A]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[L,[m,$],[T,I]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[L,[m,Q],[T,A]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[L,[m,Q],[T,I]],[/(nexus 9)/i],[L,[m,"HTC"],[T,A]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[m,[L,/_/g," "],[T,I]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[L,[m,"Acer"],[T,A]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[L,[m,"Meizu"],[T,I]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[L,[m,"Sharp"],[T,I]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,L,[T,I]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,L,[T,A]],[/(surface duo)/i],[L,[m,ce],[T,A]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[L,[m,"Fairphone"],[T,I]],[/(u304aa)/i],[L,[m,"AT&T"],[T,I]],[/\bsie-(\w*)/i],[L,[m,"Siemens"],[T,I]],[/\b(rct\w+) b/i],[L,[m,"RCA"],[T,A]],[/\b(venue[\d ]{2,7}) b/i],[L,[m,"Dell"],[T,A]],[/\b(q(?:mv|ta)\w+) b/i],[L,[m,"Verizon"],[T,A]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[L,[m,"Barnes & Noble"],[T,A]],[/\b(tm\d{3}\w+) b/i],[L,[m,"NuVision"],[T,A]],[/\b(k88) b/i],[L,[m,"ZTE"],[T,A]],[/\b(nx\d{3}j) b/i],[L,[m,"ZTE"],[T,I]],[/\b(gen\d{3}) b.+49h/i],[L,[m,"Swiss"],[T,I]],[/\b(zur\d{3}) b/i],[L,[m,"Swiss"],[T,A]],[/\b((zeki)?tb.*\b) b/i],[L,[m,"Zeki"],[T,A]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],L,[T,A]],[/\b(ns-?\w{0,9}) b/i],[L,[m,"Insignia"],[T,A]],[/\b((nxa|next)-?\w{0,9}) b/i],[L,[m,"NextBook"],[T,A]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],L,[T,I]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],L,[T,I]],[/\b(ph-1) /i],[L,[m,"Essential"],[T,I]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[L,[m,"Envizen"],[T,A]],[/\b(trio[-\w\. ]+) b/i],[L,[m,"MachSpeed"],[T,A]],[/\btu_(1491) b/i],[L,[m,"Rotor"],[T,A]],[/(shield[\w ]+) b/i],[L,[m,"Nvidia"],[T,A]],[/(sprint) (\w+)/i],[m,L,[T,I]],[/(kin\.[onetw]{3})/i],[[L,/\./g," "],[m,ce],[T,I]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[L,[m,se],[T,A]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[L,[m,se],[T,I]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,L,[T,C]],[/droid.+; (shield) bui/i],[L,[m,"Nvidia"],[T,C]],[/(playstation [345portablevi]+)/i],[L,[m,_e],[T,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[L,[m,ce],[T,C]],[/smart-tv.+(samsung)/i],[m,[T,S]],[/hbbtv.+maple;(\d+)/i],[[L,/^/,"SmartTV"],[m,ge],[T,S]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,ae],[T,S]],[/(apple) ?tv/i],[m,[L,V+" TV"],[T,S]],[/crkey/i],[[L,Y+"cast"],[m,ee],[T,S]],[/droid.+aft(\w)( bui|\))/i],[L,[m,j],[T,S]],[/\(dtv[\);].+(aquos)/i],[L,[m,"Sharp"],[T,S]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[m,w],[L,w],[T,S]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[T,S]],[/((pebble))app/i],[m,L,[T,x]],[/droid.+; (glass) \d/i],[L,[m,ee],[T,x]],[/droid.+; (wt63?0{2,3})\)/i],[L,[m,se],[T,x]],[/(quest( 2)?)/i],[L,[m,Z],[T,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[T,F]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[L,[T,I]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[L,[T,A]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[T,A]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[T,I]],[/(android[-\w\. ]{0,9});.+buil/i],[L,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[M,[R,re+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[M,[R,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[R,M],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[M,R]],os:[[/microsoft (windows) (vista|xp)/i],[R,M],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[R,[M,H,B]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[R,"Windows"],[M,H,B]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[M,/_/g,"."],[R,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[R,"Mac OS"],[M,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[M,R],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[R,M],[/\(bb(10);/i],[M,[R,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[M,[R,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[M,[R,ie+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[M,[R,"webOS"]],[/crkey\/([\d\.]+)/i],[M,[R,Y+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[R,"Chromium OS"],M],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[R,M],[/(sunos) ?([\w\.\d]*)/i],[[R,"Solaris"],M],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[R,M]]},z=function(J,ve){if(typeof J===O&&(ve=J,J=f),!(this instanceof z))return new z(J,ve).getResult();var me=J||(typeof l!==y&&l.navigator&&l.navigator.userAgent?l.navigator.userAgent:_),Ae=ve?q(G,ve):G;return this.getBrowser=function(){var be={};return be[R]=f,be[M]=f,W.call(be,me,Ae.browser),be.major=D(be.version),be},this.getCPU=function(){var be={};return be[p]=f,W.call(be,me,Ae.cpu),be},this.getDevice=function(){var be={};return be[m]=f,be[L]=f,be[T]=f,W.call(be,me,Ae.device),be},this.getEngine=function(){var be={};return be[R]=f,be[M]=f,W.call(be,me,Ae.engine),be},this.getOS=function(){var be={};return be[R]=f,be[M]=f,W.call(be,me,Ae.os),be},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return me},this.setUA=function(be){return me=typeof be===P&&be.length>k?w(be,k):be,this},this.setUA(me),this};z.VERSION=d,z.BROWSER=le([R,M,b]),z.CPU=le([p]),z.DEVICE=le([L,m,T,C,I,S,A,x,F]),z.ENGINE=z.OS=le([R,M]),typeof i!==y?(h.exports&&(i=h.exports=z),i.UAParser=z):r.amdO?(u=function(){return z}.call(i,r,i,h),u!==f&&(h.exports=u)):typeof l!==y&&(l.UAParser=z);var fe=typeof l!==y&&(l.jQuery||l.Zepto);if(fe&&!fe.ua){var ue=new z;fe.ua=ue.getResult(),fe.ua.get=function(){return ue.getUA()},fe.ua.set=function(J){ue.setUA(J);var ve=ue.getResult();for(var me in ve)fe.ua[me]=ve[me]}}})(typeof window=="object"?window:this)},"./node_modules/util-deprecate/browser.js":(h,i,r)=>{h.exports=u;function u(f,d){if(l("noDeprecation"))return f;var _=!1;function E(){if(!_){if(l("throwDeprecation"))throw new Error(d);l("traceDeprecation")?console.trace(d):console.warn(d),_=!0}return f.apply(this,arguments)}return E}function l(f){try{if(!r.g.localStorage)return!1}catch{return!1}var d=r.g.localStorage[f];return d==null?!1:String(d).toLowerCase()==="true"}},"?3e83":()=>{},"?19e6":()=>{},"./node_modules/bcp-47-normalize/lib/defaults.json":h=>{h.exports=JSON.parse('["mni-beng-in","mni-mtei-in","sat-deva-in","sat-olck-in","shi-latn-ma","shi-tfng-ma","vai-latn-lr","vai-vaii-lr","yue-hans-cn","yue-hant-hk","az-arab-ir","az-cyrl-az","az-latn-az","bm-nkoo-ml","bs-cyrl-ba","bs-latn-ba","en-dsrt-us","ff-adlm-gn","ff-latn-sn","ha-arab-ng","hi-latn-in","iu-latn-ca","ks-arab-in","ks-deva-in","mn-mong-cn","ms-arab-my","pa-arab-pk","pa-guru-in","sd-arab-pk","sd-deva-in","sr-cyrl-rs","sr-latn-rs","su-latn-id","uz-arab-af","uz-cyrl-uz","uz-latn-uz","zh-hans-cn","zh-hant-tw","mni-beng","sat-olck","shi-tfng","vai-vaii","yue-hant","az-latn","bs-latn","ff-latn","jbo-001","ks-arab","pa-guru","prg-001","sd-arab","sr-cyrl","su-latn","uz-latn","zh-hans","agq-cm","ar-001","arn-cl","asa-tz","ast-es","bas-cm","bem-zm","bez-tz","bgn-pk","blt-vn","brx-in","bss-cm","byn-er","cad-us","cch-ng","ccp-bd","ceb-ph","cgg-ug","chr-us","cic-us","ckb-iq","dav-ke","dje-ne","doi-in","dsb-de","dua-cm","dyo-sn","ebu-ke","eo-001","ewo-cm","fil-ph","fur-it","gaa-gh","gez-et","gsw-ch","guz-ke","haw-us","hsb-de","ia-001","ife-tg","io-001","jgo-cm","jmc-tz","kab-dz","kaj-ng","kam-ke","kcg-ng","kde-tz","kea-cv","ken-cm","khq-ml","kkj-cm","kln-ke","kok-in","kpe-lr","ksb-tz","ksf-cm","ksh-de","lag-tz","lkt-us","lrc-ir","luo-ke","luy-ke","mai-in","mas-ke","mer-ke","mfe-mu","mgh-mz","mgo-cm","moh-ca","mua-cm","mus-us","myv-ru","mzn-ir","naq-na","nds-de","nmg-cm","nnh-cm","nqo-gn","nso-za","nus-ss","nyn-ug","osa-us","pcm-ng","quc-gt","rof-tz","rwk-tz","sah-ru","saq-ke","sbp-tz","scn-it","sdh-ir","seh-mz","ses-ml","sid-et","sma-se","smj-se","smn-fi","sms-fi","ssy-er","syr-iq","szl-pl","teo-ug","tig-er","trv-tw","trw-pk","twq-ne","tzm-ma","vo-001","vun-tz","wae-ch","wal-et","wbp-au","xog-ug","yav-cm","yi-001","zgh-ma","aa-et","af-za","ak-gh","am-et","an-es","as-in","ba-ru","be-by","bg-bg","bm-ml","bn-bd","bo-cn","br-fr","ca-es","ce-ru","co-fr","cs-cz","cu-ru","cv-ru","cy-gb","da-dk","de-de","dv-mv","dz-bt","ee-gh","el-gr","en-us","es-es","et-ee","eu-es","fa-ir","fi-fi","fo-fo","fr-fr","fy-nl","ga-ie","gd-gb","gl-es","gn-py","gu-in","gv-im","ha-ng","he-il","hi-in","hr-hr","hu-hu","hy-am","id-id","ig-ng","ii-cn","is-is","it-it","iu-ca","ja-jp","jv-id","ka-ge","ki-ke","kk-kz","kl-gl","km-kh","kn-in","ko-kr","ku-tr","kw-gb","ky-kg","lb-lu","lg-ug","ln-cd","lo-la","lt-lt","lu-cd","lv-lv","mg-mg","mi-nz","mk-mk","ml-in","mn-mn","mr-in","ms-my","mt-mt","my-mm","nb-no","nd-zw","ne-np","nl-nl","nn-no","nr-za","nv-us","ny-mw","oc-fr","om-et","or-in","os-ge","pl-pl","ps-af","pt-br","qu-pe","rm-ch","rn-bi","ro-ro","ru-ru","rw-rw","sa-in","sc-it","se-no","sg-cf","si-lk","sk-sk","sl-si","sn-zw","so-so","sq-al","ss-za","st-za","sv-se","sw-tz","ta-in","te-in","tg-tj","th-th","ti-et","tk-tm","tn-za","to-to","tr-tr","ts-za","tt-ru","ug-cn","uk-ua","ur-pk","ve-za","vi-vn","wa-be","wo-sn","xh-za","yo-ng","zu-za"]')},"./node_modules/bcp-47-normalize/lib/fields.json":h=>{h.exports=JSON.parse('[{"from":{"field":"script","value":"qaai"},"to":{"field":"script","value":"zinh"}},{"from":{"field":"region","value":"bu"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"ct"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"dd"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"dy"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"fx"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"hv"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"jt"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"mi"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"nh"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"nq"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"pu"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"pz"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"qu"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"rh"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"tp"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"uk"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"vd"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"wk"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"yd"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"zr"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"230"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"280"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"736"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"886"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"958"},"to":{"field":"region","value":"aa"}},{"from":{"field":"region","value":"020"},"to":{"field":"region","value":"ad"}},{"from":{"field":"region","value":"784"},"to":{"field":"region","value":"ae"}},{"from":{"field":"region","value":"004"},"to":{"field":"region","value":"af"}},{"from":{"field":"region","value":"028"},"to":{"field":"region","value":"ag"}},{"from":{"field":"region","value":"660"},"to":{"field":"region","value":"ai"}},{"from":{"field":"region","value":"008"},"to":{"field":"region","value":"al"}},{"from":{"field":"region","value":"051"},"to":{"field":"region","value":"am"}},{"from":{"field":"region","value":"024"},"to":{"field":"region","value":"ao"}},{"from":{"field":"region","value":"010"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"032"},"to":{"field":"region","value":"ar"}},{"from":{"field":"region","value":"016"},"to":{"field":"region","value":"as"}},{"from":{"field":"region","value":"040"},"to":{"field":"region","value":"at"}},{"from":{"field":"region","value":"036"},"to":{"field":"region","value":"au"}},{"from":{"field":"region","value":"533"},"to":{"field":"region","value":"aw"}},{"from":{"field":"region","value":"248"},"to":{"field":"region","value":"ax"}},{"from":{"field":"region","value":"031"},"to":{"field":"region","value":"az"}},{"from":{"field":"region","value":"070"},"to":{"field":"region","value":"ba"}},{"from":{"field":"region","value":"052"},"to":{"field":"region","value":"bb"}},{"from":{"field":"region","value":"050"},"to":{"field":"region","value":"bd"}},{"from":{"field":"region","value":"056"},"to":{"field":"region","value":"be"}},{"from":{"field":"region","value":"854"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"100"},"to":{"field":"region","value":"bg"}},{"from":{"field":"region","value":"048"},"to":{"field":"region","value":"bh"}},{"from":{"field":"region","value":"108"},"to":{"field":"region","value":"bi"}},{"from":{"field":"region","value":"204"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"652"},"to":{"field":"region","value":"bl"}},{"from":{"field":"region","value":"060"},"to":{"field":"region","value":"bm"}},{"from":{"field":"region","value":"096"},"to":{"field":"region","value":"bn"}},{"from":{"field":"region","value":"068"},"to":{"field":"region","value":"bo"}},{"from":{"field":"region","value":"535"},"to":{"field":"region","value":"bq"}},{"from":{"field":"region","value":"076"},"to":{"field":"region","value":"br"}},{"from":{"field":"region","value":"044"},"to":{"field":"region","value":"bs"}},{"from":{"field":"region","value":"064"},"to":{"field":"region","value":"bt"}},{"from":{"field":"region","value":"104"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"074"},"to":{"field":"region","value":"bv"}},{"from":{"field":"region","value":"072"},"to":{"field":"region","value":"bw"}},{"from":{"field":"region","value":"112"},"to":{"field":"region","value":"by"}},{"from":{"field":"region","value":"084"},"to":{"field":"region","value":"bz"}},{"from":{"field":"region","value":"124"},"to":{"field":"region","value":"ca"}},{"from":{"field":"region","value":"166"},"to":{"field":"region","value":"cc"}},{"from":{"field":"region","value":"180"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"140"},"to":{"field":"region","value":"cf"}},{"from":{"field":"region","value":"178"},"to":{"field":"region","value":"cg"}},{"from":{"field":"region","value":"756"},"to":{"field":"region","value":"ch"}},{"from":{"field":"region","value":"384"},"to":{"field":"region","value":"ci"}},{"from":{"field":"region","value":"184"},"to":{"field":"region","value":"ck"}},{"from":{"field":"region","value":"152"},"to":{"field":"region","value":"cl"}},{"from":{"field":"region","value":"120"},"to":{"field":"region","value":"cm"}},{"from":{"field":"region","value":"156"},"to":{"field":"region","value":"cn"}},{"from":{"field":"region","value":"170"},"to":{"field":"region","value":"co"}},{"from":{"field":"region","value":"188"},"to":{"field":"region","value":"cr"}},{"from":{"field":"region","value":"192"},"to":{"field":"region","value":"cu"}},{"from":{"field":"region","value":"132"},"to":{"field":"region","value":"cv"}},{"from":{"field":"region","value":"531"},"to":{"field":"region","value":"cw"}},{"from":{"field":"region","value":"162"},"to":{"field":"region","value":"cx"}},{"from":{"field":"region","value":"196"},"to":{"field":"region","value":"cy"}},{"from":{"field":"region","value":"203"},"to":{"field":"region","value":"cz"}},{"from":{"field":"region","value":"278"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"276"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"262"},"to":{"field":"region","value":"dj"}},{"from":{"field":"region","value":"208"},"to":{"field":"region","value":"dk"}},{"from":{"field":"region","value":"212"},"to":{"field":"region","value":"dm"}},{"from":{"field":"region","value":"214"},"to":{"field":"region","value":"do"}},{"from":{"field":"region","value":"012"},"to":{"field":"region","value":"dz"}},{"from":{"field":"region","value":"218"},"to":{"field":"region","value":"ec"}},{"from":{"field":"region","value":"233"},"to":{"field":"region","value":"ee"}},{"from":{"field":"region","value":"818"},"to":{"field":"region","value":"eg"}},{"from":{"field":"region","value":"732"},"to":{"field":"region","value":"eh"}},{"from":{"field":"region","value":"232"},"to":{"field":"region","value":"er"}},{"from":{"field":"region","value":"724"},"to":{"field":"region","value":"es"}},{"from":{"field":"region","value":"231"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"246"},"to":{"field":"region","value":"fi"}},{"from":{"field":"region","value":"242"},"to":{"field":"region","value":"fj"}},{"from":{"field":"region","value":"238"},"to":{"field":"region","value":"fk"}},{"from":{"field":"region","value":"583"},"to":{"field":"region","value":"fm"}},{"from":{"field":"region","value":"234"},"to":{"field":"region","value":"fo"}},{"from":{"field":"region","value":"250"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"249"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"266"},"to":{"field":"region","value":"ga"}},{"from":{"field":"region","value":"826"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"308"},"to":{"field":"region","value":"gd"}},{"from":{"field":"region","value":"268"},"to":{"field":"region","value":"ge"}},{"from":{"field":"region","value":"254"},"to":{"field":"region","value":"gf"}},{"from":{"field":"region","value":"831"},"to":{"field":"region","value":"gg"}},{"from":{"field":"region","value":"288"},"to":{"field":"region","value":"gh"}},{"from":{"field":"region","value":"292"},"to":{"field":"region","value":"gi"}},{"from":{"field":"region","value":"304"},"to":{"field":"region","value":"gl"}},{"from":{"field":"region","value":"270"},"to":{"field":"region","value":"gm"}},{"from":{"field":"region","value":"324"},"to":{"field":"region","value":"gn"}},{"from":{"field":"region","value":"312"},"to":{"field":"region","value":"gp"}},{"from":{"field":"region","value":"226"},"to":{"field":"region","value":"gq"}},{"from":{"field":"region","value":"300"},"to":{"field":"region","value":"gr"}},{"from":{"field":"region","value":"239"},"to":{"field":"region","value":"gs"}},{"from":{"field":"region","value":"320"},"to":{"field":"region","value":"gt"}},{"from":{"field":"region","value":"316"},"to":{"field":"region","value":"gu"}},{"from":{"field":"region","value":"624"},"to":{"field":"region","value":"gw"}},{"from":{"field":"region","value":"328"},"to":{"field":"region","value":"gy"}},{"from":{"field":"region","value":"344"},"to":{"field":"region","value":"hk"}},{"from":{"field":"region","value":"334"},"to":{"field":"region","value":"hm"}},{"from":{"field":"region","value":"340"},"to":{"field":"region","value":"hn"}},{"from":{"field":"region","value":"191"},"to":{"field":"region","value":"hr"}},{"from":{"field":"region","value":"332"},"to":{"field":"region","value":"ht"}},{"from":{"field":"region","value":"348"},"to":{"field":"region","value":"hu"}},{"from":{"field":"region","value":"360"},"to":{"field":"region","value":"id"}},{"from":{"field":"region","value":"372"},"to":{"field":"region","value":"ie"}},{"from":{"field":"region","value":"376"},"to":{"field":"region","value":"il"}},{"from":{"field":"region","value":"833"},"to":{"field":"region","value":"im"}},{"from":{"field":"region","value":"356"},"to":{"field":"region","value":"in"}},{"from":{"field":"region","value":"086"},"to":{"field":"region","value":"io"}},{"from":{"field":"region","value":"368"},"to":{"field":"region","value":"iq"}},{"from":{"field":"region","value":"364"},"to":{"field":"region","value":"ir"}},{"from":{"field":"region","value":"352"},"to":{"field":"region","value":"is"}},{"from":{"field":"region","value":"380"},"to":{"field":"region","value":"it"}},{"from":{"field":"region","value":"832"},"to":{"field":"region","value":"je"}},{"from":{"field":"region","value":"388"},"to":{"field":"region","value":"jm"}},{"from":{"field":"region","value":"400"},"to":{"field":"region","value":"jo"}},{"from":{"field":"region","value":"392"},"to":{"field":"region","value":"jp"}},{"from":{"field":"region","value":"404"},"to":{"field":"region","value":"ke"}},{"from":{"field":"region","value":"417"},"to":{"field":"region","value":"kg"}},{"from":{"field":"region","value":"116"},"to":{"field":"region","value":"kh"}},{"from":{"field":"region","value":"296"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"174"},"to":{"field":"region","value":"km"}},{"from":{"field":"region","value":"659"},"to":{"field":"region","value":"kn"}},{"from":{"field":"region","value":"408"},"to":{"field":"region","value":"kp"}},{"from":{"field":"region","value":"410"},"to":{"field":"region","value":"kr"}},{"from":{"field":"region","value":"414"},"to":{"field":"region","value":"kw"}},{"from":{"field":"region","value":"136"},"to":{"field":"region","value":"ky"}},{"from":{"field":"region","value":"398"},"to":{"field":"region","value":"kz"}},{"from":{"field":"region","value":"418"},"to":{"field":"region","value":"la"}},{"from":{"field":"region","value":"422"},"to":{"field":"region","value":"lb"}},{"from":{"field":"region","value":"662"},"to":{"field":"region","value":"lc"}},{"from":{"field":"region","value":"438"},"to":{"field":"region","value":"li"}},{"from":{"field":"region","value":"144"},"to":{"field":"region","value":"lk"}},{"from":{"field":"region","value":"430"},"to":{"field":"region","value":"lr"}},{"from":{"field":"region","value":"426"},"to":{"field":"region","value":"ls"}},{"from":{"field":"region","value":"440"},"to":{"field":"region","value":"lt"}},{"from":{"field":"region","value":"442"},"to":{"field":"region","value":"lu"}},{"from":{"field":"region","value":"428"},"to":{"field":"region","value":"lv"}},{"from":{"field":"region","value":"434"},"to":{"field":"region","value":"ly"}},{"from":{"field":"region","value":"504"},"to":{"field":"region","value":"ma"}},{"from":{"field":"region","value":"492"},"to":{"field":"region","value":"mc"}},{"from":{"field":"region","value":"498"},"to":{"field":"region","value":"md"}},{"from":{"field":"region","value":"499"},"to":{"field":"region","value":"me"}},{"from":{"field":"region","value":"663"},"to":{"field":"region","value":"mf"}},{"from":{"field":"region","value":"450"},"to":{"field":"region","value":"mg"}},{"from":{"field":"region","value":"584"},"to":{"field":"region","value":"mh"}},{"from":{"field":"region","value":"807"},"to":{"field":"region","value":"mk"}},{"from":{"field":"region","value":"466"},"to":{"field":"region","value":"ml"}},{"from":{"field":"region","value":"496"},"to":{"field":"region","value":"mn"}},{"from":{"field":"region","value":"446"},"to":{"field":"region","value":"mo"}},{"from":{"field":"region","value":"580"},"to":{"field":"region","value":"mp"}},{"from":{"field":"region","value":"474"},"to":{"field":"region","value":"mq"}},{"from":{"field":"region","value":"478"},"to":{"field":"region","value":"mr"}},{"from":{"field":"region","value":"500"},"to":{"field":"region","value":"ms"}},{"from":{"field":"region","value":"470"},"to":{"field":"region","value":"mt"}},{"from":{"field":"region","value":"480"},"to":{"field":"region","value":"mu"}},{"from":{"field":"region","value":"462"},"to":{"field":"region","value":"mv"}},{"from":{"field":"region","value":"454"},"to":{"field":"region","value":"mw"}},{"from":{"field":"region","value":"484"},"to":{"field":"region","value":"mx"}},{"from":{"field":"region","value":"458"},"to":{"field":"region","value":"my"}},{"from":{"field":"region","value":"508"},"to":{"field":"region","value":"mz"}},{"from":{"field":"region","value":"516"},"to":{"field":"region","value":"na"}},{"from":{"field":"region","value":"540"},"to":{"field":"region","value":"nc"}},{"from":{"field":"region","value":"562"},"to":{"field":"region","value":"ne"}},{"from":{"field":"region","value":"574"},"to":{"field":"region","value":"nf"}},{"from":{"field":"region","value":"566"},"to":{"field":"region","value":"ng"}},{"from":{"field":"region","value":"558"},"to":{"field":"region","value":"ni"}},{"from":{"field":"region","value":"528"},"to":{"field":"region","value":"nl"}},{"from":{"field":"region","value":"578"},"to":{"field":"region","value":"no"}},{"from":{"field":"region","value":"524"},"to":{"field":"region","value":"np"}},{"from":{"field":"region","value":"520"},"to":{"field":"region","value":"nr"}},{"from":{"field":"region","value":"570"},"to":{"field":"region","value":"nu"}},{"from":{"field":"region","value":"554"},"to":{"field":"region","value":"nz"}},{"from":{"field":"region","value":"512"},"to":{"field":"region","value":"om"}},{"from":{"field":"region","value":"591"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"604"},"to":{"field":"region","value":"pe"}},{"from":{"field":"region","value":"258"},"to":{"field":"region","value":"pf"}},{"from":{"field":"region","value":"598"},"to":{"field":"region","value":"pg"}},{"from":{"field":"region","value":"608"},"to":{"field":"region","value":"ph"}},{"from":{"field":"region","value":"586"},"to":{"field":"region","value":"pk"}},{"from":{"field":"region","value":"616"},"to":{"field":"region","value":"pl"}},{"from":{"field":"region","value":"666"},"to":{"field":"region","value":"pm"}},{"from":{"field":"region","value":"612"},"to":{"field":"region","value":"pn"}},{"from":{"field":"region","value":"630"},"to":{"field":"region","value":"pr"}},{"from":{"field":"region","value":"275"},"to":{"field":"region","value":"ps"}},{"from":{"field":"region","value":"620"},"to":{"field":"region","value":"pt"}},{"from":{"field":"region","value":"585"},"to":{"field":"region","value":"pw"}},{"from":{"field":"region","value":"600"},"to":{"field":"region","value":"py"}},{"from":{"field":"region","value":"634"},"to":{"field":"region","value":"qa"}},{"from":{"field":"region","value":"959"},"to":{"field":"region","value":"qm"}},{"from":{"field":"region","value":"960"},"to":{"field":"region","value":"qn"}},{"from":{"field":"region","value":"962"},"to":{"field":"region","value":"qp"}},{"from":{"field":"region","value":"963"},"to":{"field":"region","value":"qq"}},{"from":{"field":"region","value":"964"},"to":{"field":"region","value":"qr"}},{"from":{"field":"region","value":"965"},"to":{"field":"region","value":"qs"}},{"from":{"field":"region","value":"966"},"to":{"field":"region","value":"qt"}},{"from":{"field":"region","value":"967"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"968"},"to":{"field":"region","value":"qv"}},{"from":{"field":"region","value":"969"},"to":{"field":"region","value":"qw"}},{"from":{"field":"region","value":"970"},"to":{"field":"region","value":"qx"}},{"from":{"field":"region","value":"971"},"to":{"field":"region","value":"qy"}},{"from":{"field":"region","value":"972"},"to":{"field":"region","value":"qz"}},{"from":{"field":"region","value":"638"},"to":{"field":"region","value":"re"}},{"from":{"field":"region","value":"642"},"to":{"field":"region","value":"ro"}},{"from":{"field":"region","value":"688"},"to":{"field":"region","value":"rs"}},{"from":{"field":"region","value":"643"},"to":{"field":"region","value":"ru"}},{"from":{"field":"region","value":"646"},"to":{"field":"region","value":"rw"}},{"from":{"field":"region","value":"682"},"to":{"field":"region","value":"sa"}},{"from":{"field":"region","value":"090"},"to":{"field":"region","value":"sb"}},{"from":{"field":"region","value":"690"},"to":{"field":"region","value":"sc"}},{"from":{"field":"region","value":"729"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"752"},"to":{"field":"region","value":"se"}},{"from":{"field":"region","value":"702"},"to":{"field":"region","value":"sg"}},{"from":{"field":"region","value":"654"},"to":{"field":"region","value":"sh"}},{"from":{"field":"region","value":"705"},"to":{"field":"region","value":"si"}},{"from":{"field":"region","value":"744"},"to":{"field":"region","value":"sj"}},{"from":{"field":"region","value":"703"},"to":{"field":"region","value":"sk"}},{"from":{"field":"region","value":"694"},"to":{"field":"region","value":"sl"}},{"from":{"field":"region","value":"674"},"to":{"field":"region","value":"sm"}},{"from":{"field":"region","value":"686"},"to":{"field":"region","value":"sn"}},{"from":{"field":"region","value":"706"},"to":{"field":"region","value":"so"}},{"from":{"field":"region","value":"740"},"to":{"field":"region","value":"sr"}},{"from":{"field":"region","value":"728"},"to":{"field":"region","value":"ss"}},{"from":{"field":"region","value":"678"},"to":{"field":"region","value":"st"}},{"from":{"field":"region","value":"222"},"to":{"field":"region","value":"sv"}},{"from":{"field":"region","value":"534"},"to":{"field":"region","value":"sx"}},{"from":{"field":"region","value":"760"},"to":{"field":"region","value":"sy"}},{"from":{"field":"region","value":"748"},"to":{"field":"region","value":"sz"}},{"from":{"field":"region","value":"796"},"to":{"field":"region","value":"tc"}},{"from":{"field":"region","value":"148"},"to":{"field":"region","value":"td"}},{"from":{"field":"region","value":"260"},"to":{"field":"region","value":"tf"}},{"from":{"field":"region","value":"768"},"to":{"field":"region","value":"tg"}},{"from":{"field":"region","value":"764"},"to":{"field":"region","value":"th"}},{"from":{"field":"region","value":"762"},"to":{"field":"region","value":"tj"}},{"from":{"field":"region","value":"772"},"to":{"field":"region","value":"tk"}},{"from":{"field":"region","value":"626"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"795"},"to":{"field":"region","value":"tm"}},{"from":{"field":"region","value":"788"},"to":{"field":"region","value":"tn"}},{"from":{"field":"region","value":"776"},"to":{"field":"region","value":"to"}},{"from":{"field":"region","value":"792"},"to":{"field":"region","value":"tr"}},{"from":{"field":"region","value":"780"},"to":{"field":"region","value":"tt"}},{"from":{"field":"region","value":"798"},"to":{"field":"region","value":"tv"}},{"from":{"field":"region","value":"158"},"to":{"field":"region","value":"tw"}},{"from":{"field":"region","value":"834"},"to":{"field":"region","value":"tz"}},{"from":{"field":"region","value":"804"},"to":{"field":"region","value":"ua"}},{"from":{"field":"region","value":"800"},"to":{"field":"region","value":"ug"}},{"from":{"field":"region","value":"581"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"840"},"to":{"field":"region","value":"us"}},{"from":{"field":"region","value":"858"},"to":{"field":"region","value":"uy"}},{"from":{"field":"region","value":"860"},"to":{"field":"region","value":"uz"}},{"from":{"field":"region","value":"336"},"to":{"field":"region","value":"va"}},{"from":{"field":"region","value":"670"},"to":{"field":"region","value":"vc"}},{"from":{"field":"region","value":"862"},"to":{"field":"region","value":"ve"}},{"from":{"field":"region","value":"092"},"to":{"field":"region","value":"vg"}},{"from":{"field":"region","value":"850"},"to":{"field":"region","value":"vi"}},{"from":{"field":"region","value":"704"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"548"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"876"},"to":{"field":"region","value":"wf"}},{"from":{"field":"region","value":"882"},"to":{"field":"region","value":"ws"}},{"from":{"field":"region","value":"973"},"to":{"field":"region","value":"xa"}},{"from":{"field":"region","value":"974"},"to":{"field":"region","value":"xb"}},{"from":{"field":"region","value":"975"},"to":{"field":"region","value":"xc"}},{"from":{"field":"region","value":"976"},"to":{"field":"region","value":"xd"}},{"from":{"field":"region","value":"977"},"to":{"field":"region","value":"xe"}},{"from":{"field":"region","value":"978"},"to":{"field":"region","value":"xf"}},{"from":{"field":"region","value":"979"},"to":{"field":"region","value":"xg"}},{"from":{"field":"region","value":"980"},"to":{"field":"region","value":"xh"}},{"from":{"field":"region","value":"981"},"to":{"field":"region","value":"xi"}},{"from":{"field":"region","value":"982"},"to":{"field":"region","value":"xj"}},{"from":{"field":"region","value":"983"},"to":{"field":"region","value":"xk"}},{"from":{"field":"region","value":"984"},"to":{"field":"region","value":"xl"}},{"from":{"field":"region","value":"985"},"to":{"field":"region","value":"xm"}},{"from":{"field":"region","value":"986"},"to":{"field":"region","value":"xn"}},{"from":{"field":"region","value":"987"},"to":{"field":"region","value":"xo"}},{"from":{"field":"region","value":"988"},"to":{"field":"region","value":"xp"}},{"from":{"field":"region","value":"989"},"to":{"field":"region","value":"xq"}},{"from":{"field":"region","value":"990"},"to":{"field":"region","value":"xr"}},{"from":{"field":"region","value":"991"},"to":{"field":"region","value":"xs"}},{"from":{"field":"region","value":"992"},"to":{"field":"region","value":"xt"}},{"from":{"field":"region","value":"993"},"to":{"field":"region","value":"xu"}},{"from":{"field":"region","value":"994"},"to":{"field":"region","value":"xv"}},{"from":{"field":"region","value":"995"},"to":{"field":"region","value":"xw"}},{"from":{"field":"region","value":"996"},"to":{"field":"region","value":"xx"}},{"from":{"field":"region","value":"997"},"to":{"field":"region","value":"xy"}},{"from":{"field":"region","value":"998"},"to":{"field":"region","value":"xz"}},{"from":{"field":"region","value":"720"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"887"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"175"},"to":{"field":"region","value":"yt"}},{"from":{"field":"region","value":"710"},"to":{"field":"region","value":"za"}},{"from":{"field":"region","value":"894"},"to":{"field":"region","value":"zm"}},{"from":{"field":"region","value":"716"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"999"},"to":{"field":"region","value":"zz"}},{"from":{"field":"variants","value":"aaland"},"to":{"field":"region","value":"ax"}},{"from":{"field":"variants","value":"polytoni"},"to":{"field":"variants","value":"polyton"}},{"from":{"field":"variants","value":"heploc"},"to":{"field":"variants","value":"alalc97"}},{"from":{"field":"variants","value":"arevela"},"to":{"field":"language","value":"hy"}},{"from":{"field":"variants","value":"arevmda"},"to":{"field":"language","value":"hyw"}}]')},"./node_modules/bcp-47-normalize/lib/many.json":h=>{h.exports=JSON.parse('{"region":{"172":["ru","am","az","by","ge","kg","kz","md","tj","tm","ua","uz"],"200":["cz","sk"],"530":["cw","sx","bq"],"532":["cw","sx","bq"],"536":["sa","iq"],"582":["fm","mh","mp","pw"],"810":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"830":["je","gg"],"890":["rs","me","si","hr","mk","ba"],"891":["rs","me"],"an":["cw","sx","bq"],"cs":["rs","me"],"fq":["aq","tf"],"nt":["sa","iq"],"pc":["fm","mh","mp","pw"],"su":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yu":["rs","me"],"062":["034","143"],"ant":["cw","sx","bq"],"scg":["rs","me"],"ntz":["sa","iq"],"sun":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yug":["rs","me"]}}')},"./node_modules/bcp-47-normalize/lib/matches.json":h=>{h.exports=JSON.parse('[{"from":"in","to":"id"},{"from":"iw","to":"he"},{"from":"ji","to":"yi"},{"from":"jw","to":"jv"},{"from":"mo","to":"ro"},{"from":"scc","to":"sr"},{"from":"scr","to":"hr"},{"from":"aam","to":"aas"},{"from":"adp","to":"dz"},{"from":"aue","to":"ktz"},{"from":"ayx","to":"nun"},{"from":"bgm","to":"bcg"},{"from":"bjd","to":"drl"},{"from":"ccq","to":"rki"},{"from":"cjr","to":"mom"},{"from":"cka","to":"cmr"},{"from":"cmk","to":"xch"},{"from":"coy","to":"pij"},{"from":"cqu","to":"quh"},{"from":"drh","to":"mn"},{"from":"drw","to":"fa-af"},{"from":"gav","to":"dev"},{"from":"gfx","to":"vaj"},{"from":"ggn","to":"gvr"},{"from":"gti","to":"nyc"},{"from":"guv","to":"duz"},{"from":"hrr","to":"jal"},{"from":"ibi","to":"opa"},{"from":"ilw","to":"gal"},{"from":"jeg","to":"oyb"},{"from":"kgc","to":"tdf"},{"from":"kgh","to":"kml"},{"from":"koj","to":"kwv"},{"from":"krm","to":"bmf"},{"from":"ktr","to":"dtp"},{"from":"kvs","to":"gdj"},{"from":"kwq","to":"yam"},{"from":"kxe","to":"tvd"},{"from":"kzj","to":"dtp"},{"from":"kzt","to":"dtp"},{"from":"lii","to":"raq"},{"from":"lmm","to":"rmx"},{"from":"meg","to":"cir"},{"from":"mst","to":"mry"},{"from":"mwj","to":"vaj"},{"from":"myt","to":"mry"},{"from":"nad","to":"xny"},{"from":"ncp","to":"kdz"},{"from":"nnx","to":"ngv"},{"from":"nts","to":"pij"},{"from":"oun","to":"vaj"},{"from":"pcr","to":"adx"},{"from":"pmc","to":"huw"},{"from":"pmu","to":"phr"},{"from":"ppa","to":"bfy"},{"from":"ppr","to":"lcq"},{"from":"pry","to":"prt"},{"from":"puz","to":"pub"},{"from":"sca","to":"hle"},{"from":"skk","to":"oyb"},{"from":"tdu","to":"dtp"},{"from":"thc","to":"tpo"},{"from":"thx","to":"oyb"},{"from":"tie","to":"ras"},{"from":"tkk","to":"twm"},{"from":"tlw","to":"weo"},{"from":"tmp","to":"tyj"},{"from":"tne","to":"kak"},{"from":"tnf","to":"fa-af"},{"from":"tsf","to":"taj"},{"from":"uok","to":"ema"},{"from":"xba","to":"cax"},{"from":"xia","to":"acn"},{"from":"xkh","to":"waw"},{"from":"xsj","to":"suj"},{"from":"ybd","to":"rki"},{"from":"yma","to":"lrr"},{"from":"ymt","to":"mtm"},{"from":"yos","to":"zom"},{"from":"yuu","to":"yug"},{"from":"asd","to":"snz"},{"from":"dit","to":"dif"},{"from":"llo","to":"ngt"},{"from":"myd","to":"aog"},{"from":"nns","to":"nbr"},{"from":"sgn-br","to":"bzs"},{"from":"sgn-co","to":"csn"},{"from":"sgn-de","to":"gsg"},{"from":"sgn-dk","to":"dsl"},{"from":"sgn-fr","to":"fsl"},{"from":"sgn-gb","to":"bfi"},{"from":"sgn-gr","to":"gss"},{"from":"sgn-ie","to":"isg"},{"from":"sgn-it","to":"ise"},{"from":"sgn-jp","to":"jsl"},{"from":"sgn-mx","to":"mfs"},{"from":"sgn-ni","to":"ncs"},{"from":"sgn-nl","to":"dse"},{"from":"sgn-no","to":"nsi"},{"from":"sgn-pt","to":"psr"},{"from":"sgn-se","to":"swl"},{"from":"sgn-us","to":"ase"},{"from":"sgn-za","to":"sfs"},{"from":"no-bokmal","to":"nb"},{"from":"no-nynorsk","to":"nn"},{"from":"aa-saaho","to":"ssy"},{"from":"sh","to":"sr-latn"},{"from":"cnr","to":"sr-me"},{"from":"no","to":"nb"},{"from":"tl","to":"fil"},{"from":"az-az","to":"az-latn-az"},{"from":"bs-ba","to":"bs-latn-ba"},{"from":"ha-latn-gh","to":"ha-gh"},{"from":"ha-latn-ne","to":"ha-ne"},{"from":"ha-latn-ng","to":"ha-ng"},{"from":"kk-cyrl-kz","to":"kk-kz"},{"from":"ky-cyrl-kg","to":"ky-kg"},{"from":"ks-arab-in","to":"ks-in"},{"from":"mn-cyrl-mn","to":"mn-mn"},{"from":"ms-latn-bn","to":"ms-bn"},{"from":"ms-latn-my","to":"ms-my"},{"from":"ms-latn-sg","to":"ms-sg"},{"from":"pa-in","to":"pa-guru-in"},{"from":"pa-pk","to":"pa-arab-pk"},{"from":"shi-ma","to":"shi-tfng-ma"},{"from":"sr-ba","to":"sr-cyrl-ba"},{"from":"sr-me","to":"sr-latn-me"},{"from":"sr-rs","to":"sr-cyrl-rs"},{"from":"sr-xk","to":"sr-cyrl-xk"},{"from":"tzm-latn-ma","to":"tzm-ma"},{"from":"ug-arab-cn","to":"ug-cn"},{"from":"uz-af","to":"uz-arab-af"},{"from":"uz-uz","to":"uz-latn-uz"},{"from":"vai-lr","to":"vai-vaii-lr"},{"from":"yue-cn","to":"yue-hans-cn"},{"from":"yue-hk","to":"yue-hant-hk"},{"from":"zh-cn","to":"zh-hans-cn"},{"from":"zh-hk","to":"zh-hant-hk"},{"from":"zh-mo","to":"zh-hant-mo"},{"from":"zh-sg","to":"zh-hans-sg"},{"from":"zh-tw","to":"zh-hant-tw"},{"from":"aju","to":"jrb"},{"from":"als","to":"sq"},{"from":"arb","to":"ar"},{"from":"ayr","to":"ay"},{"from":"azj","to":"az"},{"from":"bcc","to":"bal"},{"from":"bcl","to":"bik"},{"from":"bxk","to":"luy"},{"from":"bxr","to":"bua"},{"from":"cld","to":"syr"},{"from":"cmn","to":"zh"},{"from":"cwd","to":"cr"},{"from":"dgo","to":"doi"},{"from":"dhd","to":"mwr"},{"from":"dik","to":"din"},{"from":"diq","to":"zza"},{"from":"lbk","to":"bnc"},{"from":"ekk","to":"et"},{"from":"emk","to":"man"},{"from":"esk","to":"ik"},{"from":"fat","to":"ak"},{"from":"fuc","to":"ff"},{"from":"gaz","to":"om"},{"from":"gbo","to":"grb"},{"from":"gno","to":"gon"},{"from":"gug","to":"gn"},{"from":"gya","to":"gba"},{"from":"hdn","to":"hai"},{"from":"hea","to":"hmn"},{"from":"ike","to":"iu"},{"from":"kmr","to":"ku"},{"from":"knc","to":"kr"},{"from":"kng","to":"kg"},{"from":"knn","to":"kok"},{"from":"kpv","to":"kv"},{"from":"lvs","to":"lv"},{"from":"mhr","to":"chm"},{"from":"mup","to":"raj"},{"from":"khk","to":"mn"},{"from":"npi","to":"ne"},{"from":"ojg","to":"oj"},{"from":"ory","to":"or"},{"from":"pbu","to":"ps"},{"from":"pes","to":"fa"},{"from":"plt","to":"mg"},{"from":"pnb","to":"lah"},{"from":"quz","to":"qu"},{"from":"rmy","to":"rom"},{"from":"spy","to":"kln"},{"from":"src","to":"sc"},{"from":"swh","to":"sw"},{"from":"ttq","to":"tmh"},{"from":"tw","to":"ak"},{"from":"umu","to":"del"},{"from":"uzn","to":"uz"},{"from":"xpe","to":"kpe"},{"from":"xsl","to":"den"},{"from":"ydd","to":"yi"},{"from":"zai","to":"zap"},{"from":"zsm","to":"ms"},{"from":"zyb","to":"za"},{"from":"him","to":"srx"},{"from":"mnk","to":"man"},{"from":"bh","to":"bho"},{"from":"prs","to":"fa-af"},{"from":"swc","to":"sw-cd"},{"from":"aar","to":"aa"},{"from":"abk","to":"ab"},{"from":"ave","to":"ae"},{"from":"afr","to":"af"},{"from":"aka","to":"ak"},{"from":"amh","to":"am"},{"from":"arg","to":"an"},{"from":"ara","to":"ar"},{"from":"asm","to":"as"},{"from":"ava","to":"av"},{"from":"aym","to":"ay"},{"from":"aze","to":"az"},{"from":"bak","to":"ba"},{"from":"bel","to":"be"},{"from":"bul","to":"bg"},{"from":"bih","to":"bho"},{"from":"bis","to":"bi"},{"from":"bam","to":"bm"},{"from":"ben","to":"bn"},{"from":"bod","to":"bo"},{"from":"bre","to":"br"},{"from":"bos","to":"bs"},{"from":"cat","to":"ca"},{"from":"che","to":"ce"},{"from":"cha","to":"ch"},{"from":"cos","to":"co"},{"from":"cre","to":"cr"},{"from":"ces","to":"cs"},{"from":"chu","to":"cu"},{"from":"chv","to":"cv"},{"from":"cym","to":"cy"},{"from":"dan","to":"da"},{"from":"deu","to":"de"},{"from":"div","to":"dv"},{"from":"dzo","to":"dz"},{"from":"ewe","to":"ee"},{"from":"ell","to":"el"},{"from":"eng","to":"en"},{"from":"epo","to":"eo"},{"from":"spa","to":"es"},{"from":"est","to":"et"},{"from":"eus","to":"eu"},{"from":"fas","to":"fa"},{"from":"ful","to":"ff"},{"from":"fin","to":"fi"},{"from":"fij","to":"fj"},{"from":"fao","to":"fo"},{"from":"fra","to":"fr"},{"from":"fry","to":"fy"},{"from":"gle","to":"ga"},{"from":"gla","to":"gd"},{"from":"glg","to":"gl"},{"from":"grn","to":"gn"},{"from":"guj","to":"gu"},{"from":"glv","to":"gv"},{"from":"hau","to":"ha"},{"from":"heb","to":"he"},{"from":"hin","to":"hi"},{"from":"hmo","to":"ho"},{"from":"hrv","to":"hr"},{"from":"hat","to":"ht"},{"from":"hun","to":"hu"},{"from":"hye","to":"hy"},{"from":"her","to":"hz"},{"from":"ina","to":"ia"},{"from":"ind","to":"id"},{"from":"ile","to":"ie"},{"from":"ibo","to":"ig"},{"from":"iii","to":"ii"},{"from":"ipk","to":"ik"},{"from":"ido","to":"io"},{"from":"isl","to":"is"},{"from":"ita","to":"it"},{"from":"iku","to":"iu"},{"from":"jpn","to":"ja"},{"from":"jav","to":"jv"},{"from":"kat","to":"ka"},{"from":"kon","to":"kg"},{"from":"kik","to":"ki"},{"from":"kua","to":"kj"},{"from":"kaz","to":"kk"},{"from":"kal","to":"kl"},{"from":"khm","to":"km"},{"from":"kan","to":"kn"},{"from":"kor","to":"ko"},{"from":"kau","to":"kr"},{"from":"kas","to":"ks"},{"from":"kur","to":"ku"},{"from":"kom","to":"kv"},{"from":"cor","to":"kw"},{"from":"kir","to":"ky"},{"from":"lat","to":"la"},{"from":"ltz","to":"lb"},{"from":"lug","to":"lg"},{"from":"lim","to":"li"},{"from":"lin","to":"ln"},{"from":"lao","to":"lo"},{"from":"lit","to":"lt"},{"from":"lub","to":"lu"},{"from":"lav","to":"lv"},{"from":"mlg","to":"mg"},{"from":"mah","to":"mh"},{"from":"mri","to":"mi"},{"from":"mkd","to":"mk"},{"from":"mal","to":"ml"},{"from":"mon","to":"mn"},{"from":"mol","to":"ro"},{"from":"mar","to":"mr"},{"from":"msa","to":"ms"},{"from":"mlt","to":"mt"},{"from":"mya","to":"my"},{"from":"nau","to":"na"},{"from":"nob","to":"nb"},{"from":"nde","to":"nd"},{"from":"nep","to":"ne"},{"from":"ndo","to":"ng"},{"from":"nld","to":"nl"},{"from":"nno","to":"nn"},{"from":"nor","to":"nb"},{"from":"nbl","to":"nr"},{"from":"nav","to":"nv"},{"from":"nya","to":"ny"},{"from":"oci","to":"oc"},{"from":"oji","to":"oj"},{"from":"orm","to":"om"},{"from":"ori","to":"or"},{"from":"oss","to":"os"},{"from":"pan","to":"pa"},{"from":"pli","to":"pi"},{"from":"pol","to":"pl"},{"from":"pus","to":"ps"},{"from":"por","to":"pt"},{"from":"que","to":"qu"},{"from":"roh","to":"rm"},{"from":"run","to":"rn"},{"from":"ron","to":"ro"},{"from":"rus","to":"ru"},{"from":"kin","to":"rw"},{"from":"san","to":"sa"},{"from":"srd","to":"sc"},{"from":"snd","to":"sd"},{"from":"sme","to":"se"},{"from":"sag","to":"sg"},{"from":"hbs","to":"sr-latn"},{"from":"sin","to":"si"},{"from":"slk","to":"sk"},{"from":"slv","to":"sl"},{"from":"smo","to":"sm"},{"from":"sna","to":"sn"},{"from":"som","to":"so"},{"from":"sqi","to":"sq"},{"from":"srp","to":"sr"},{"from":"ssw","to":"ss"},{"from":"sot","to":"st"},{"from":"sun","to":"su"},{"from":"swe","to":"sv"},{"from":"swa","to":"sw"},{"from":"tam","to":"ta"},{"from":"tel","to":"te"},{"from":"tgk","to":"tg"},{"from":"tha","to":"th"},{"from":"tir","to":"ti"},{"from":"tuk","to":"tk"},{"from":"tgl","to":"fil"},{"from":"tsn","to":"tn"},{"from":"ton","to":"to"},{"from":"tur","to":"tr"},{"from":"tso","to":"ts"},{"from":"tat","to":"tt"},{"from":"twi","to":"ak"},{"from":"tah","to":"ty"},{"from":"uig","to":"ug"},{"from":"ukr","to":"uk"},{"from":"urd","to":"ur"},{"from":"uzb","to":"uz"},{"from":"ven","to":"ve"},{"from":"vie","to":"vi"},{"from":"vol","to":"vo"},{"from":"wln","to":"wa"},{"from":"wol","to":"wo"},{"from":"xho","to":"xh"},{"from":"yid","to":"yi"},{"from":"yor","to":"yo"},{"from":"zha","to":"za"},{"from":"zho","to":"zh"},{"from":"zul","to":"zu"},{"from":"alb","to":"sq"},{"from":"arm","to":"hy"},{"from":"baq","to":"eu"},{"from":"bur","to":"my"},{"from":"chi","to":"zh"},{"from":"cze","to":"cs"},{"from":"dut","to":"nl"},{"from":"fre","to":"fr"},{"from":"geo","to":"ka"},{"from":"ger","to":"de"},{"from":"gre","to":"el"},{"from":"ice","to":"is"},{"from":"mac","to":"mk"},{"from":"mao","to":"mi"},{"from":"may","to":"ms"},{"from":"per","to":"fa"},{"from":"rum","to":"ro"},{"from":"slo","to":"sk"},{"from":"tib","to":"bo"},{"from":"wel","to":"cy"}]')},"./node_modules/bcp-47/lib/normalize.json":h=>{h.exports=JSON.parse('{"en-gb-oed":"en-GB-oxendict","i-ami":"ami","i-bnn":"bnn","i-default":null,"i-enochian":null,"i-hak":"hak","i-klingon":"tlh","i-lux":"lb","i-mingo":null,"i-navajo":"nv","i-pwn":"pwn","i-tao":"tao","i-tay":"tay","i-tsu":"tsu","sgn-be-fr":"sfb","sgn-be-nl":"vgt","sgn-ch-de":"sgg","art-lojban":"jbo","cel-gaulish":null,"no-bok":"nb","no-nyn":"nn","zh-guoyu":"cmn","zh-hakka":"hak","zh-min":null,"zh-min-nan":"nan","zh-xiang":"hsn"}')},"./node_modules/bcp-47/lib/regular.json":h=>{h.exports=JSON.parse('["art-lojban","cel-gaulish","no-bok","no-nyn","zh-guoyu","zh-hakka","zh-min","zh-min-nan","zh-xiang"]')}},n={};function o(h){var i=n[h];if(i!==void 0)return i.exports;var r=n[h]={exports:{}};return t[h].call(r.exports,r,r.exports,o),r.exports}o.amdO={},o.n=h=>{var i=h&&h.__esModule?()=>h.default:()=>h;return o.d(i,{a:i}),i},o.d=(h,i)=>{for(var r in i)o.o(i,r)&&!o.o(h,r)&&Object.defineProperty(h,r,{enumerable:!0,get:i[r]})},o.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),o.o=(h,i)=>Object.prototype.hasOwnProperty.call(h,i),o.r=h=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})};var g={};return(()=>{/*!******************!*\
  !*** ./index.js ***!
  \******************/o.r(g),o.d(g,{Debug:()=>f.default,MediaPlayer:()=>h.MediaPlayer,MediaPlayerFactory:()=>l.default,MetricsReporting:()=>r.default,Protection:()=>u.default,default:()=>d,supportsMediaSource:()=>i.supportsMediaSource});var h=o("./index_mediaplayerOnly.js"),i=o("./src/streaming/utils/Capabilities.js"),r=o("./src/streaming/metrics/MetricsReporting.js"),u=o("./src/streaming/protection/Protection.js"),l=o("./src/streaming/MediaPlayerFactory.js"),f=o("./src/core/Debug.js");dashjs.Protection=u.default,dashjs.MetricsReporting=r.default,dashjs.MediaPlayerFactory=l.default,dashjs.Debug=f.default,dashjs.supportsMediaSource=i.supportsMediaSource;const d=dashjs})(),g=g.default,g})())})(kh);const Kh=Gl(da);async function jh(v){let e;switch(v){case"mp4":e=await Ii.get("http://101.43.161.79:9002/media/mp4.json");break;case"hls":e=await Ii.get("http://101.43.161.79:9002/media/hls.json");break;case"dash":e=await Ii.get("http://101.43.161.79:9002/media/dash.json")}return e.data}const al=v=>(Ql("data-v-00cabda1"),v=v(),Jl(),v),Wh={class:"main clearfix"},Gh={class:"control"},Hh=al(()=>Pr("span",{style:{"margin-right":"10px"}},"视频类型",-1)),Vh={key:0,style:{"margin-left":"50px"}},Yh=al(()=>Pr("span",{style:{"margin-right":"10px"}},"Abr算法",-1)),zh={class:"flex"},$h={class:"v"},Xh=["src"],Qh=["onClick"],Jh={style:{"text-align":"center"}},Zh={class:"name"},qh={class:"desc"},eg=Hl({__name:"VideoView",setup(v){const e=Ba(),t=Ba(),n=$l(),o=Vl({type:"mp4",algorithm:"abrThroughput",id:0,video:{},videos:[]}),g=[{value:"abrThroughput",label:"abrThroughput"},{value:"abrBola",label:"abrBola"},{value:"abrDynamic",label:"abrDynamic"},{value:"abrL2A",label:"abrL2A"},{value:"abrLoLP",label:"abrLoLP"}],h=[{value:"mp4",label:"MP4"},{value:"hls",label:"HLS"},{value:"dash",label:"DASH"}],i=async r=>{let u=await jh(r);o.videos=u,o.type=r,o.video=u[o.id];let l=u[o.id];switch(r){case"mp4":break;case"hls":if(jr.isSupported()){const d=new jr;d.attachMedia(e.value),d.on(jr.Events.MEDIA_ATTACHED,function(){d.loadSource(l.feedurl)})}break;case"dash":let f=Kh.MediaPlayer().create();f.updateSettings({streaming:{abr:{ABRStrategy:o.algorithm}}}),f.initialize(t.value,l.feedurl,!0);break}};return Yl(()=>[o.type,o.id,o.algorithm],()=>{console.log("[video change]",o.type,o.id),i(o.type)}),zl(()=>{const r=n.query.type||"mp4";i(r)}),(r,u)=>{const l=pn("el-option"),f=pn("el-select"),d=pn("el-image"),_=pn("el-scrollbar"),E=pn("el-card");return Br(),wr("div",Wh,[Pr("div",Gh,[Pr("div",null,[Hh,qr(f,{style:{width:"150px","background-color":"rgba(13, 22, 53, .5)"},modelValue:o.type,"onUpdate:modelValue":u[0]||(u[0]=c=>o.type=c),class:"m-2",placeholder:"Select",size:"large"},{default:vn(()=>[(Br(),wr(Ti,null,yi(h,c=>qr(l,{key:c.value,label:c.label,value:c.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),o.type==="dash"?(Br(),wr("div",Vh,[Yh,qr(f,{style:{width:"150px","background-color":"rgba(13, 22, 53, .5)"},modelValue:o.algorithm,"onUpdate:modelValue":u[1]||(u[1]=c=>o.algorithm=c),class:"m-2",placeholder:"Select",size:"large"},{default:vn(()=>[(Br(),wr(Ti,null,yi(g,c=>qr(l,{key:c.value,label:c.label,value:c.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])):Ua("",!0)]),Pr("div",zh,[Pr("div",$h,[o.type==="hls"?(Br(),wr("video",{key:0,ref_key:"HlsVideoRef",ref:e,width:"1200",height:"700",controls:""},null,512)):o.type==="mp4"?(Br(),wr("video",{key:1,width:"1200",height:"700",controls:"",src:o.video.feedurl||""},null,8,Xh)):o.type==="dash"?(Br(),wr("video",{key:2,ref_key:"DashVideoRef",ref:t,width:"1200",height:"700",controls:""},null,512)):Ua("",!0)]),qr(E,{class:"list"},{header:vn(()=>[Xl(" Video List ")]),default:vn(()=>[qr(_,{height:"600px",class:"videos"},{default:vn(()=>[(Br(!0),wr(Ti,null,yi(o.videos,(c,y)=>(Br(),wr("div",{class:"video",key:y},[Pr("div",{onClick:()=>o.id=y},[qr(d,{src:c.avatar},null,8,["src"]),Pr("div",Jh,[Pr("span",Zh,ka(c.nickname),1),Pr("span",qh,ka(c.description),1)])],8,Qh)]))),128))]),_:1})]),_:1})])])}}});const ig=Zl(eg,[["__scopeId","data-v-00cabda1"]]);export{ig as default};
