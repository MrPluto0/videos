import{g as Lo,a as Xn,d as Oo,r as qi,b as bo,w as xo,o as No,c as Lr,e as Rr,f as Vr,h as ln,i as ea,u as Fo,j as un,k as Or,F as Qn,l as Jn,m as wo,p as Bo,n as Uo,t as ta,_ as ko}from"./index-d300db76.js";var hn={},Ko={get exports(){return hn},set exports(b){hn=b}};(function(b,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,u=/^(?=([^\/?#]*))\1([^]*)$/,_=/(?:\/|^)\.(?=\/)/g,g=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,i={buildAbsoluteURL:function(r,d,o){if(o=o||{},r=r.trim(),d=d.trim(),!d){if(!o.alwaysNormalize)return r;var l=i.parseURL(r);if(!l)throw new Error("Error trying to parse base URL.");return l.path=i.normalizePath(l.path),i.buildURLFromParts(l)}var c=i.parseURL(d);if(!c)throw new Error("Error trying to parse relative URL.");if(c.scheme)return o.alwaysNormalize?(c.path=i.normalizePath(c.path),i.buildURLFromParts(c)):d;var E=i.parseURL(r);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var m=u.exec(E.path);E.netLoc=m[1],E.path=m[2]}E.netLoc&&!E.path&&(E.path="/");var f={scheme:E.scheme,netLoc:c.netLoc,path:null,params:c.params,query:c.query,fragment:c.fragment};if(!c.netLoc&&(f.netLoc=E.netLoc,c.path[0]!=="/"))if(!c.path)f.path=E.path,c.params||(f.params=E.params,c.query||(f.query=E.query));else{var T=E.path,L=T.substring(0,T.lastIndexOf("/")+1)+c.path;f.path=i.normalizePath(L)}return f.path===null&&(f.path=o.alwaysNormalize?i.normalizePath(c.path):c.path),i.buildURLFromParts(f)},parseURL:function(r){var d=n.exec(r);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(r){for(r=r.split("").reverse().join("").replace(_,"");r.length!==(r=r.replace(g,"")).length;);return r.split("").reverse().join("")},buildURLFromParts:function(r){return r.scheme+r.netLoc+r.path+r.params+r.query+r.fragment}};b.exports=i})()})(Ko);function ra(b,e){var t=Object.keys(b);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(b);e&&(n=n.filter(function(u){return Object.getOwnPropertyDescriptor(b,u).enumerable})),t.push.apply(t,n)}return t}function dr(b){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ra(Object(t),!0).forEach(function(n){Wo(b,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(t)):ra(Object(t)).forEach(function(n){Object.defineProperty(b,n,Object.getOwnPropertyDescriptor(t,n))})}return b}function Wo(b,e,t){return e=Go(e),e in b?Object.defineProperty(b,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):b[e]=t,b}function rr(){return rr=Object.assign?Object.assign.bind():function(b){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(b[n]=t[n])}return b},rr.apply(this,arguments)}function jo(b,e){if(typeof b!="object"||b===null)return b;var t=b[Symbol.toPrimitive];if(t!==void 0){var n=t.call(b,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(b)}function Go(b){var e=jo(b,"string");return typeof e=="symbol"?e:String(e)}const bt=Number.isFinite||function(b){return typeof b=="number"&&isFinite(b)};let Ee=function(b){return b.MEDIA_ATTACHING="hlsMediaAttaching",b.MEDIA_ATTACHED="hlsMediaAttached",b.MEDIA_DETACHING="hlsMediaDetaching",b.MEDIA_DETACHED="hlsMediaDetached",b.BUFFER_RESET="hlsBufferReset",b.BUFFER_CODECS="hlsBufferCodecs",b.BUFFER_CREATED="hlsBufferCreated",b.BUFFER_APPENDING="hlsBufferAppending",b.BUFFER_APPENDED="hlsBufferAppended",b.BUFFER_EOS="hlsBufferEos",b.BUFFER_FLUSHING="hlsBufferFlushing",b.BUFFER_FLUSHED="hlsBufferFlushed",b.MANIFEST_LOADING="hlsManifestLoading",b.MANIFEST_LOADED="hlsManifestLoaded",b.MANIFEST_PARSED="hlsManifestParsed",b.LEVEL_SWITCHING="hlsLevelSwitching",b.LEVEL_SWITCHED="hlsLevelSwitched",b.LEVEL_LOADING="hlsLevelLoading",b.LEVEL_LOADED="hlsLevelLoaded",b.LEVEL_UPDATED="hlsLevelUpdated",b.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",b.LEVELS_UPDATED="hlsLevelsUpdated",b.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",b.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",b.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",b.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",b.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",b.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",b.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",b.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",b.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",b.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",b.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",b.CUES_PARSED="hlsCuesParsed",b.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",b.INIT_PTS_FOUND="hlsInitPtsFound",b.FRAG_LOADING="hlsFragLoading",b.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",b.FRAG_LOADED="hlsFragLoaded",b.FRAG_DECRYPTED="hlsFragDecrypted",b.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",b.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",b.FRAG_PARSING_METADATA="hlsFragParsingMetadata",b.FRAG_PARSED="hlsFragParsed",b.FRAG_BUFFERED="hlsFragBuffered",b.FRAG_CHANGED="hlsFragChanged",b.FPS_DROP="hlsFpsDrop",b.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",b.ERROR="hlsError",b.DESTROYING="hlsDestroying",b.KEY_LOADING="hlsKeyLoading",b.KEY_LOADED="hlsKeyLoaded",b.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",b.BACK_BUFFER_REACHED="hlsBackBufferReached",b}({}),Nt=function(b){return b.NETWORK_ERROR="networkError",b.MEDIA_ERROR="mediaError",b.KEY_SYSTEM_ERROR="keySystemError",b.MUX_ERROR="muxError",b.OTHER_ERROR="otherError",b}({}),st=function(b){return b.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",b.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",b.KEY_SYSTEM_NO_SESSION="keySystemNoSession",b.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",b.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",b.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",b.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",b.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",b.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",b.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",b.MANIFEST_LOAD_ERROR="manifestLoadError",b.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",b.MANIFEST_PARSING_ERROR="manifestParsingError",b.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",b.LEVEL_EMPTY_ERROR="levelEmptyError",b.LEVEL_LOAD_ERROR="levelLoadError",b.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",b.LEVEL_PARSING_ERROR="levelParsingError",b.LEVEL_SWITCH_ERROR="levelSwitchError",b.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",b.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",b.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",b.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",b.FRAG_LOAD_ERROR="fragLoadError",b.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",b.FRAG_DECRYPT_ERROR="fragDecryptError",b.FRAG_PARSING_ERROR="fragParsingError",b.FRAG_GAP="fragGap",b.REMUX_ALLOC_ERROR="remuxAllocError",b.KEY_LOAD_ERROR="keyLoadError",b.KEY_LOAD_TIMEOUT="keyLoadTimeOut",b.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",b.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",b.BUFFER_APPEND_ERROR="bufferAppendError",b.BUFFER_APPENDING_ERROR="bufferAppendingError",b.BUFFER_STALLED_ERROR="bufferStalledError",b.BUFFER_FULL_ERROR="bufferFullError",b.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",b.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",b.INTERNAL_EXCEPTION="internalException",b.INTERNAL_ABORTED="aborted",b.UNKNOWN="unknown",b}({});const zr=function(){},Si={trace:zr,debug:zr,log:zr,warn:zr,info:zr,error:zr};let cn=Si;function Ho(b){const e=self.console[b];return e?e.bind(self.console,`[${b}] >`):zr}function Vo(b,...e){e.forEach(function(t){cn[t]=b[t]?b[t].bind(b):Ho(t)})}function Yo(b,e){if(self.console&&b===!0||typeof b=="object"){Vo(b,"debug","log","info","warn","error");try{cn.log(`Debug logs enabled for "${e}" in hls.js version 1.4.0`)}catch{cn=Si}}else cn=Si}const je=cn,zo=/^(\d+)x(\d+)$/,na=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Zt{constructor(e){typeof e=="string"&&(e=Zt.parseAttrList(e));for(const t in e)e.hasOwnProperty(t)&&(t.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let u=0;u<t.length/2;u++)n[u]=parseInt(t.slice(u*2,u*2+2),16);return n}else return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const t=zo.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const n={},u='"';for(na.lastIndex=0;(t=na.exec(e))!==null;){let _=t[2];_.indexOf(u)===0&&_.lastIndexOf(u)===_.length-1&&(_=_.slice(1,-1));const g=t[1].trim();n[g]=_}return n}}function $o(b){return b!=="ID"&&b!=="CLASS"&&b!=="START-DATE"&&b!=="DURATION"&&b!=="END-DATE"&&b!=="END-ON-NEXT"}function Xo(b){return b==="SCTE35-OUT"||b==="SCTE35-IN"}class Xa{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const n=t.attr;for(const u in n)if(Object.prototype.hasOwnProperty.call(e,u)&&e[u]!==n[u]){je.warn(`DATERANGE tag attribute: "${u}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=u;break}e=rr(new Zt({}),n,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const n=new Date(this.attr["END-DATE"]);bt(n.getTime())&&(this._endDate=n)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(bt(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&bt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class kn{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Xt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Qa{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[Xt.AUDIO]:null,[Xt.VIDEO]:null,[Xt.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const n=e.split("@",2),u=[];n.length===1?u[0]=t?t.byteRangeEndOffset:0:u[0]=parseInt(n[1]),u[1]=parseInt(n[0])+u[0],this._byteRange=u}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=hn.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Zn extends Qa{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new kn,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const n=Object.keys(this.levelkeys);if(n.length===1)return this._decryptdata=this.levelkeys[n[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!bt(this.programDateTime))return null;const e=bt(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),n=t.length;if(n>1||n===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,u,_,g=!1){const{elementaryStreams:i}=this,r=i[e];if(!r){i[e]={startPTS:t,endPTS:n,startDTS:u,endDTS:_,partial:g};return}r.startPTS=Math.min(r.startPTS,t),r.endPTS=Math.max(r.endPTS,n),r.startDTS=Math.min(r.startDTS,u),r.endDTS=Math.max(r.endDTS,_)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Xt.AUDIO]=null,e[Xt.VIDEO]=null,e[Xt.AUDIOVIDEO]=null}}class Qo extends Qa{constructor(e,t,n,u,_){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new kn,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=u;const g=e.enumeratedString("BYTERANGE");g&&this.setByteRange(g,_),_&&(this.fragOffset=_.fragOffset+_.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const Jo=10;class Zo{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?bt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Jo}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function Ni(b){return Uint8Array.from(atob(b),e=>e.charCodeAt(0))}function qo(b){const e=Ja(b).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function el(b){const e=function(n,u,_){const g=n[u];n[u]=n[_],n[_]=g};e(b,0,3),e(b,1,2),e(b,4,5),e(b,6,7)}function tl(b){const e=b.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),u=n[n.length-1].split(",");if(u.length===2){const _=u[0]==="base64",g=u[1];_?(n.splice(-1,1),t=Ni(g)):t=qo(g)}}return t}function Ja(b){return Uint8Array.from(unescape(encodeURIComponent(b)),e=>e.charCodeAt(0))}var qt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},cr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ia(b){switch(b){case cr.FAIRPLAY:return qt.FAIRPLAY;case cr.PLAYREADY:return qt.PLAYREADY;case cr.WIDEVINE:return qt.WIDEVINE;case cr.CLEARKEY:return qt.CLEARKEY}}var Za={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function rl(b){if(b===Za.WIDEVINE)return qt.WIDEVINE}function aa(b){switch(b){case qt.FAIRPLAY:return cr.FAIRPLAY;case qt.PLAYREADY:return cr.PLAYREADY;case qt.WIDEVINE:return cr.WIDEVINE;case qt.CLEARKEY:return cr.CLEARKEY}}function qn(b){const{drmSystems:e,widevineLicenseUrl:t}=b,n=e?[qt.FAIRPLAY,qt.WIDEVINE,qt.PLAYREADY,qt.CLEARKEY].filter(u=>!!e[u]):[];return!n[qt.WIDEVINE]&&t&&n.push(qt.WIDEVINE),n}const qa=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function nl(b,e,t,n){let u;switch(b){case qt.FAIRPLAY:u=["cenc","sinf"];break;case qt.WIDEVINE:case qt.PLAYREADY:u=["cenc"];break;case qt.CLEARKEY:u=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${b}`)}return il(u,e,t,n)}function il(b,e,t,n){return[{initDataTypes:b,persistentState:n.persistentState||"not-allowed",distinctiveIdentifier:n.distinctiveIdentifier||"not-allowed",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(_=>({contentType:`audio/mp4; codecs="${_}"`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(_=>({contentType:`video/mp4; codecs="${_}"`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function $r(b,e,t){return Uint8Array.prototype.slice?b.slice(e,t):new Uint8Array(Array.prototype.slice.call(b,e,t))}const Fi=(b,e)=>e+10<=b.length&&b[e]===73&&b[e+1]===68&&b[e+2]===51&&b[e+3]<255&&b[e+4]<255&&b[e+6]<128&&b[e+7]<128&&b[e+8]<128&&b[e+9]<128,es=(b,e)=>e+10<=b.length&&b[e]===51&&b[e+1]===68&&b[e+2]===73&&b[e+3]<255&&b[e+4]<255&&b[e+6]<128&&b[e+7]<128&&b[e+8]<128&&b[e+9]<128,xn=(b,e)=>{const t=e;let n=0;for(;Fi(b,e);){n+=10;const u=Kn(b,e+6);n+=u,es(b,e+10)&&(n+=10),e+=n}if(n>0)return b.subarray(t,t+n)},Kn=(b,e)=>{let t=0;return t=(b[e]&127)<<21,t|=(b[e+1]&127)<<14,t|=(b[e+2]&127)<<7,t|=b[e+3]&127,t},al=(b,e)=>Fi(b,e)&&Kn(b,e+6)+10<=b.length-e,sl=b=>{const e=rs(b);for(let t=0;t<e.length;t++){const n=e[t];if(ts(n))return dl(n)}},ts=b=>b&&b.key==="PRIV"&&b.info==="com.apple.streaming.transportStreamTimestamp",ol=b=>{const e=String.fromCharCode(b[0],b[1],b[2],b[3]),t=Kn(b,4),n=10;return{type:e,size:t,data:b.subarray(n,n+t)}},rs=b=>{let e=0;const t=[];for(;Fi(b,e);){const n=Kn(b,e+6);e+=10;const u=e+n;for(;e+8<u;){const _=ol(b.subarray(e)),g=ll(_);g&&t.push(g),e+=_.size+10}es(b,e)&&(e+=10)}return t},ll=b=>b.type==="PRIV"?ul(b):b.type[0]==="W"?cl(b):fl(b),ul=b=>{if(b.size<2)return;const e=Cr(b.data,!0),t=new Uint8Array(b.data.subarray(e.length+1));return{key:b.type,info:e,data:t.buffer}},fl=b=>{if(b.size<2)return;if(b.type==="TXXX"){let t=1;const n=Cr(b.data.subarray(t),!0);t+=n.length+1;const u=Cr(b.data.subarray(t));return{key:b.type,info:n,data:u}}const e=Cr(b.data.subarray(1));return{key:b.type,data:e}},cl=b=>{if(b.type==="WXXX"){if(b.size<2)return;let t=1;const n=Cr(b.data.subarray(t),!0);t+=n.length+1;const u=Cr(b.data.subarray(t));return{key:b.type,info:n,data:u}}const e=Cr(b.data);return{key:b.type,data:e}},dl=b=>{if(b.data.byteLength===8){const e=new Uint8Array(b.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}},Cr=(b,e=!1)=>{const t=hl();if(t){const d=t.decode(b);if(e){const o=d.indexOf("\0");return o!==-1?d.substring(0,o):d}return d.replace(/\0/g,"")}const n=b.length;let u,_,g,i="",r=0;for(;r<n;){if(u=b[r++],u===0&&e)return i;if(u===0||u===3)continue;switch(u>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i+=String.fromCharCode(u);break;case 12:case 13:_=b[r++],i+=String.fromCharCode((u&31)<<6|_&63);break;case 14:_=b[r++],g=b[r++],i+=String.fromCharCode((u&15)<<12|(_&63)<<6|(g&63)<<0);break}}return i};let ei;function hl(){return!ei&&typeof self.TextDecoder<"u"&&(ei=new self.TextDecoder("utf-8")),ei}const Dr={hexDump:function(b){let e="";for(let t=0;t<b.length;t++){let n=b[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}},Nn=Math.pow(2,32)-1,gl=[].push,ns={video:1,audio:2,id3:3,text:4};function ir(b){return String.fromCharCode.apply(null,b)}function is(b,e){const t=b[e]<<8|b[e+1];return t<0?65536+t:t}function Ut(b,e){const t=as(b,e);return t<0?4294967296+t:t}function as(b,e){return b[e]<<24|b[e+1]<<16|b[e+2]<<8|b[e+3]}function ti(b,e,t){b[e]=t>>24,b[e+1]=t>>16&255,b[e+2]=t>>8&255,b[e+3]=t&255}function Yt(b,e){const t=[];if(!e.length)return t;const n=b.byteLength;for(let u=0;u<n;){const _=Ut(b,u),g=ir(b.subarray(u+4,u+8)),i=_>1?u+_:n;if(g===e[0])if(e.length===1)t.push(b.subarray(u+8,i));else{const r=Yt(b.subarray(u+8,i),e.slice(1));r.length&&gl.apply(t,r)}u=i}return t}function ml(b){const e=[],t=b[0];let n=8;const u=Ut(b,n);n+=4;const _=0,g=0;t===0?n+=8:n+=16,n+=2;let i=b.length+g;const r=is(b,n);n+=2;for(let d=0;d<r;d++){let o=n;const l=Ut(b,o);o+=4;const c=l&2147483647;if((l&2147483648)>>>31===1)return je.warn("SIDX has hierarchical references (not supported)"),null;const m=Ut(b,o);o+=4,e.push({referenceSize:c,subsegmentDuration:m,info:{duration:m/u,start:i,end:i+c-1}}),i+=c,o+=4,n=o}return{earliestPresentationTime:_,timescale:u,version:t,referencesCount:r,references:e}}function ss(b){const e=[],t=Yt(b,["moov","trak"]);for(let u=0;u<t.length;u++){const _=t[u],g=Yt(_,["tkhd"])[0];if(g){let i=g[0],r=i===0?12:20;const d=Ut(g,r),o=Yt(_,["mdia","mdhd"])[0];if(o){i=o[0],r=i===0?12:20;const l=Ut(o,r),c=Yt(_,["mdia","hdlr"])[0];if(c){const E=ir(c.subarray(8,12)),m={soun:Xt.AUDIO,vide:Xt.VIDEO}[E];if(m){const f=Yt(_,["mdia","minf","stbl","stsd"])[0];let T;f&&(T=ir(f.subarray(12,16))),e[d]={timescale:l,type:m},e[m]={timescale:l,id:d,codec:T}}}}}}return Yt(b,["moov","mvex","trex"]).forEach(u=>{const _=Ut(u,4),g=e[_];g&&(g.default={duration:Ut(u,12),flags:Ut(u,20)})}),e}function El(b,e){if(!b||!e)return b;const t=e.keyId;return t&&e.isCommonEncryption&&Yt(b,["moov","trak"]).forEach(u=>{const g=Yt(u,["mdia","minf","stbl","stsd"])[0].subarray(8);let i=Yt(g,["enca"]);const r=i.length>0;r||(i=Yt(g,["encv"])),i.forEach(d=>{const o=r?d.subarray(28):d.subarray(78);Yt(o,["sinf"]).forEach(c=>{const E=os(c);if(E){const m=E.subarray(8,24);m.some(f=>f!==0)||(je.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Dr.hexDump(m)} -> ${Dr.hexDump(t)}`),E.set(t,8))}})})}),b}function os(b){const e=Yt(b,["schm"])[0];if(e){const t=ir(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Yt(b,["schi","tenc"])[0]}return je.error("[eme] missing 'schm' box"),null}function _l(b,e){return Yt(e,["moof","traf"]).reduce((t,n)=>{const u=Yt(n,["tfdt"])[0],_=u[0],g=Yt(n,["tfhd"]).reduce((i,r)=>{const d=Ut(r,4),o=b[d];if(o){let l=Ut(u,4);if(_===1){if(l===Nn)return je.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),i;l*=Nn+1,l+=Ut(u,8)}const c=o.timescale||9e4,E=l/c;if(isFinite(E)&&(i===null||E<i))return E}return i},null);return g!==null&&isFinite(g)&&(t===null||g<t)?g:t},null)}function vl(b,e){let t=0,n=0,u=0;const _=Yt(b,["moof","traf"]);for(let g=0;g<_.length;g++){const i=_[g],r=Yt(i,["tfhd"])[0],d=Ut(r,4),o=e[d];if(!o)continue;const l=o.default,c=Ut(r,0)|(l==null?void 0:l.flags);let E=l==null?void 0:l.duration;c&8&&(c&2?E=Ut(r,12):E=Ut(r,8));const m=o.timescale||9e4,f=Yt(i,["trun"]);for(let T=0;T<f.length;T++){if(t=pl(f[T]),!t&&E){const L=Ut(f[T],4);t=E*L}o.type===Xt.VIDEO?n+=t/m:o.type===Xt.AUDIO&&(u+=t/m)}}if(n===0&&u===0){let g=0;const i=Yt(b,["sidx"]);for(let r=0;r<i.length;r++){const d=ml(i[r]);d!=null&&d.references&&(g+=d.references.reduce((o,l)=>o+l.info.duration||0,0))}return g}return n||u}function pl(b){const e=Ut(b,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let n=0;const u=Ut(b,4);for(let _=0;_<u;_++){if(e&256){const g=Ut(b,t);n+=g,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return n}function Tl(b,e,t){Yt(e,["moof","traf"]).forEach(n=>{Yt(n,["tfhd"]).forEach(u=>{const _=Ut(u,4),g=b[_];if(!g)return;const i=g.timescale||9e4;Yt(n,["tfdt"]).forEach(r=>{const d=r[0];let o=Ut(r,4);if(d===0)o-=t*i,o=Math.max(o,0),ti(r,4,o);else{o*=Math.pow(2,32),o+=Ut(r,8),o-=t*i,o=Math.max(o,0);const l=Math.floor(o/(Nn+1)),c=Math.floor(o%(Nn+1));ti(r,4,l),ti(r,8,c)}})})})}function yl(b){const e={valid:null,remainder:null},t=Yt(b,["moof"]);if(t){if(t.length<2)return e.remainder=b,e}else return e;const n=t[t.length-1];return e.valid=$r(b,0,n.byteOffset-8),e.remainder=$r(b,n.byteOffset-8),e}function Xr(b,e){const t=new Uint8Array(b.length+e.length);return t.set(b),t.set(e,b.length),t}function sa(b,e){const t=[],n=e.samples,u=e.timescale,_=e.id;let g=!1;return Yt(n,["moof"]).map(r=>{const d=r.byteOffset-8;Yt(r,["traf"]).map(l=>{const c=Yt(l,["tfdt"]).map(E=>{const m=E[0];let f=Ut(E,4);return m===1&&(f*=Math.pow(2,32),f+=Ut(E,8)),f/u})[0];return c!==void 0&&(b=c),Yt(l,["tfhd"]).map(E=>{const m=Ut(E,4),f=Ut(E,0)&16777215,T=(f&1)!==0,L=(f&2)!==0,P=(f&8)!==0;let O=0;const M=(f&16)!==0;let S=0;const p=(f&32)!==0;let h=8;m===_&&(T&&(h+=8),L&&(h+=4),P&&(O=Ut(E,h),h+=4),M&&(S=Ut(E,h),h+=4),p&&(h+=4),e.type==="video"&&(g=Al(e.codec)),Yt(l,["trun"]).map(C=>{const v=C[0],I=Ut(C,0)&16777215,D=(I&1)!==0;let y=0;const A=(I&4)!==0,x=(I&256)!==0;let F=0;const k=(I&512)!==0;let W=0;const V=(I&1024)!==0,Q=(I&2048)!==0;let $=0;const K=Ut(C,4);let Y=8;D&&(y=Ut(C,Y),Y+=4),A&&(Y+=4);let re=y+d;for(let ie=0;ie<K;ie++){if(x?(F=Ut(C,Y),Y+=4):F=O,k?(W=Ut(C,Y),Y+=4):W=S,V&&(Y+=4),Q&&(v===0?$=Ut(C,Y):$=as(C,Y),Y+=4),e.type===Xt.VIDEO){let ee=0;for(;ee<W;){const ne=Ut(n,re);if(re+=4,Sl(g,n[re])){const ae=n.subarray(re,re+ne);ls(ae,g?2:1,b+$/u,t)}re+=ne,ee+=ne+4}}b+=F/u}}))})})}),t}function Al(b){if(!b)return!1;const e=b.indexOf("."),t=e<0?b:b.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function Sl(b,e){if(b){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function ls(b,e,t,n){const u=us(b);let _=0;_+=e;let g=0,i=0,r=!1,d=0;for(;_<u.length;){g=0;do{if(_>=u.length)break;d=u[_++],g+=d}while(d===255);i=0;do{if(_>=u.length)break;d=u[_++],i+=d}while(d===255);const o=u.length-_;if(!r&&g===4&&_<u.length){if(r=!0,u[_++]===181){const c=is(u,_);if(_+=2,c===49){const E=Ut(u,_);if(_+=4,E===1195456820){const m=u[_++];if(m===3){const f=u[_++],T=31&f,L=64&f,P=L?2+T*3:0,O=new Uint8Array(P);if(L){O[0]=f;for(let M=1;M<P;M++)O[M]=u[_++]}n.push({type:m,payloadType:g,pts:t,bytes:O})}}}}}else if(g===5&&i<o){if(r=!0,i>16){const l=[];for(let m=0;m<16;m++){const f=u[_++].toString(16);l.push(f.length==1?"0"+f:f),(m===3||m===5||m===7||m===9)&&l.push("-")}const c=i-16,E=new Uint8Array(c);for(let m=0;m<c;m++)E[m]=u[_++];n.push({payloadType:g,pts:t,uuid:l.join(""),userData:Cr(E),userDataBytes:E})}}else if(i<o)_+=i;else if(i>o)break}}function us(b){const e=b.byteLength,t=[];let n=1;for(;n<e-2;)b[n]===0&&b[n+1]===0&&b[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return b;const u=e-t.length,_=new Uint8Array(u);let g=0;for(n=0;n<u;g++,n++)g===t[0]&&(g++,t.shift()),_[n]=b[g];return _}function Rl(b){const e=b[0];let t="",n="",u=0,_=0,g=0,i=0,r=0,d=0;if(e===0){for(;ir(b.subarray(d,d+1))!=="\0";)t+=ir(b.subarray(d,d+1)),d+=1;for(t+=ir(b.subarray(d,d+1)),d+=1;ir(b.subarray(d,d+1))!=="\0";)n+=ir(b.subarray(d,d+1)),d+=1;n+=ir(b.subarray(d,d+1)),d+=1,u=Ut(b,12),_=Ut(b,16),i=Ut(b,20),r=Ut(b,24),d=28}else if(e===1){d+=4,u=Ut(b,d),d+=4;const l=Ut(b,d);d+=4;const c=Ut(b,d);for(d+=4,g=2**32*l+c,Number.isSafeInteger(g)||(g=Number.MAX_SAFE_INTEGER,je.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),i=Ut(b,d),d+=4,r=Ut(b,d),d+=4;ir(b.subarray(d,d+1))!=="\0";)t+=ir(b.subarray(d,d+1)),d+=1;for(t+=ir(b.subarray(d,d+1)),d+=1;ir(b.subarray(d,d+1))!=="\0";)n+=ir(b.subarray(d,d+1)),d+=1;n+=ir(b.subarray(d,d+1)),d+=1}const o=b.subarray(d,b.byteLength);return{schemeIdUri:t,value:n,timeScale:u,presentationTime:g,presentationTimeDelta:_,eventDuration:i,id:r,payload:o}}function Dl(b,...e){const t=e.length;let n=8,u=t;for(;u--;)n+=e[u].byteLength;const _=new Uint8Array(n);for(_[0]=n>>24&255,_[1]=n>>16&255,_[2]=n>>8&255,_[3]=n&255,_.set(b,4),u=0,n=8;u<t;u++)_.set(e[u],n),n+=e[u].byteLength;return _}function Il(b,e,t){if(b.byteLength!==16)throw new RangeError("Invalid system id");let n,u;if(e){n=1,u=new Uint8Array(e.length*16);for(let i=0;i<e.length;i++){const r=e[i];if(r.byteLength!==16)throw new RangeError("Invalid key");u.set(r,i*16)}}else n=0,u=new Uint8Array;let _;n>0?(_=new Uint8Array(4),e.length>0&&new DataView(_.buffer).setUint32(0,e.length,!1)):_=new Uint8Array;const g=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(g.buffer).setUint32(0,t.byteLength,!1),Dl([112,115,115,104],new Uint8Array([n,0,0,0]),b,_,u,g,t||new Uint8Array)}function Cl(b){if(!(b instanceof ArrayBuffer)||b.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},t=new DataView(b),n=t.getUint32(0);if(b.byteLength!==n&&n>44||t.getUint32(4)!==1886614376||(e.version=t.getUint32(8)>>>24,e.version>1))return null;e.systemId=Dr.hexDump(new Uint8Array(b,12,16));const _=t.getUint32(28);if(e.version===0){if(n-32<_)return null;e.data=new Uint8Array(b,32,_)}else if(e.version===1){e.kids=[];for(let g=0;g<_;g++)e.kids.push(new Uint8Array(b,32+g*16,16))}return e}let Sn={};class gn{static clearKeyUriToKeyIdMap(){Sn={}}constructor(e,t,n,u=[1],_=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=u,this.iv=_,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case cr.FAIRPLAY:case cr.WIDEVINE:case cr.PLAYREADY:case cr.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&je.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const n=Pl(e);return new gn(this.method,this.uri,"identity",this.keyFormatVersions,n)}const t=tl(this.uri);if(t)switch(this.keyFormat){case cr.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case cr.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Il(n,null,t);const u=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),_=String.fromCharCode.apply(null,Array.from(u)),g=_.substring(_.indexOf("<"),_.length),d=new DOMParser().parseFromString(g,"text/xml").getElementsByTagName("KID")[0];if(d){const o=d.childNodes[0]?d.childNodes[0].nodeValue:d.getAttribute("VALUE");if(o){const l=Ni(o).subarray(0,16);el(l),this.keyId=l}}break}default:{let n=t.subarray(0,16);if(n.length!==16){const u=new Uint8Array(16);u.set(n,16-n.length),n=u}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n=Sn[this.uri];if(!n){const u=Object.keys(Sn).length%Number.MAX_SAFE_INTEGER;n=new Uint8Array(16),new DataView(n.buffer,12,4).setUint32(0,u),Sn[this.uri]=n}this.keyId=n}return this}}function Pl(b){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=b>>8*(15-t)&255;return e}const fs=/\{\$([a-zA-Z0-9-_]+)\}/g;function oa(b){return fs.test(b)}function ur(b,e,t){if(b.variableList!==null||b.hasVariableRefs)for(let n=t.length;n--;){const u=t[n],_=e[u];_&&(e[u]=Ri(b,_))}}function Ri(b,e){if(b.variableList!==null||b.hasVariableRefs){const t=b.variableList;return e.replace(fs,n=>{const u=n.substring(2,n.length-1),_=t==null?void 0:t[u];return _===void 0?(b.playlistParsingError||(b.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${u}"`)),n):_})}return e}function la(b,e,t){let n=b.variableList;n||(b.variableList=n={});let u,_;if("QUERYPARAM"in e){u=e.QUERYPARAM;try{const g=new self.URL(t).searchParams;if(g.has(u))_=g.get(u);else throw new Error(`"${u}" does not match any query parameter in URI: "${t}"`)}catch(g){b.playlistParsingError||(b.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${g.message}`))}}else u=e.NAME,_=e.VALUE;u in n?b.playlistParsingError||(b.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${u}"`)):n[u]=_||""}function Ml(b,e,t){const n=e.IMPORT;if(t&&n in t){let u=b.variableList;u||(b.variableList=u={}),u[n]=t[n]}else b.playlistParsingError||(b.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const Ll={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function Ol(b,e){const t=Ll[e];return!!t&&t[b.slice(0,4)]===!0}function ri(b,e){return MediaSource.isTypeSupported(`${e||"video"}/mp4;codecs="${b}"`)}const ua=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,fa=/#EXT-X-MEDIA:(.*)/g,bl=/^#EXT(?:INF|-X-TARGETDURATION):/m,ca=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),xl=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Tr{static findGroup(e,t){for(let n=0;n<e.length;n++){const u=e[n];if(u.id===t)return u}}static convertAVC1ToAVCOTI(e){const t=e.split(".");if(t.length>2){let n=t.shift()+".";return n+=parseInt(t.shift()).toString(16),n+=("000"+parseInt(t.shift()).toString(16)).slice(-4),n}return e}static resolve(e,t){return hn.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return bl.test(e)}static parseMasterPlaylist(e,t){const n=oa(e),u={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},_=[];ua.lastIndex=0;let g;for(;(g=ua.exec(e))!=null;)if(g[1]){var i;const d=new Zt(g[1]);ur(u,d,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const o=Ri(u,g[2]),l={attrs:d,bitrate:d.decimalInteger("AVERAGE-BANDWIDTH")||d.decimalInteger("BANDWIDTH"),name:d.NAME,url:Tr.resolve(o,t)},c=d.decimalResolution("RESOLUTION");c&&(l.width=c.width,l.height=c.height),Nl((d.CODECS||"").split(/[ ,]+/).filter(E=>E),l),l.videoCodec&&l.videoCodec.indexOf("avc1")!==-1&&(l.videoCodec=Tr.convertAVC1ToAVCOTI(l.videoCodec)),(i=l.unknownCodecs)!=null&&i.length||_.push(l),u.levels.push(l)}else if(g[3]){const d=g[3],o=g[4];switch(d){case"SESSION-DATA":{const l=new Zt(o);ur(u,l,["DATA-ID","LANGUAGE","VALUE","URI"]);const c=l["DATA-ID"];c&&(u.sessionData===null&&(u.sessionData={}),u.sessionData[c]=l);break}case"SESSION-KEY":{const l=da(o,t,u);l.encrypted&&l.isSupported()?(u.sessionKeys===null&&(u.sessionKeys=[]),u.sessionKeys.push(l)):je.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${o}"`);break}case"DEFINE":{{const l=new Zt(o);ur(u,l,["NAME","VALUE","QUERYPARAM"]),la(u,l,t)}break}case"CONTENT-STEERING":{const l=new Zt(o);ur(u,l,["SERVER-URI","PATHWAY-ID"]),u.contentSteering={uri:Tr.resolve(l["SERVER-URI"],t),pathwayId:l["PATHWAY-ID"]||"."};break}case"START":{u.startTimeOffset=ha(o);break}}}const r=_.length>0&&_.length<u.levels.length;return u.levels=r?_:u.levels,u.levels.length===0&&(u.playlistParsingError=new Error("no levels found in manifest")),u}static parseMasterPlaylistMedia(e,t,n){let u;const _={},g=n.levels,i={AUDIO:g.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:g.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let r=0;for(fa.lastIndex=0;(u=fa.exec(e))!==null;){const d=new Zt(u[1]),o=d.TYPE;if(o){const l=i[o],c=_[o]||[];_[o]=c,ur(n,d,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const E={attrs:d,bitrate:0,id:r++,groupId:d["GROUP-ID"]||"",instreamId:d["INSTREAM-ID"],name:d.NAME||d.LANGUAGE||"",type:o,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:d.LANGUAGE,url:d.URI?Tr.resolve(d.URI,t):""};if(l!=null&&l.length){const m=Tr.findGroup(l,E.groupId)||l[0];ga(E,m,"audioCodec"),ga(E,m,"textCodec")}c.push(E)}}return _}static parseLevelPlaylist(e,t,n,u,_,g){const i=new Zo(t),r=i.fragments;let d=null,o=0,l=0,c=0,E=0,m=null,f=new Zn(u,t),T,L,P,O=-1,M=!1;for(ca.lastIndex=0,i.m3u8=e,i.hasVariableRefs=oa(e);(T=ca.exec(e))!==null;){M&&(M=!1,f=new Zn(u,t),f.start=c,f.sn=o,f.cc=E,f.level=n,d&&(f.initSegment=d,f.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null));const C=T[1];if(C){f.duration=parseFloat(C);const v=(" "+T[2]).slice(1);f.title=v||null,f.tagList.push(v?["INF",C,v]:["INF",C])}else if(T[3]){if(bt(f.duration)){f.start=c,P&&_a(f,P,i),f.sn=o,f.level=n,f.cc=E,f.urlId=_,r.push(f);const v=(" "+T[3]).slice(1);f.relurl=Ri(i,v),ma(f,m),m=f,c+=f.duration,o++,l=0,M=!0}}else if(T[4]){const v=(" "+T[4]).slice(1);m?f.setByteRange(v,m):f.setByteRange(v)}else if(T[5])f.rawProgramDateTime=(" "+T[5]).slice(1),f.tagList.push(["PROGRAM-DATE-TIME",f.rawProgramDateTime]),O===-1&&(O=r.length);else{if(T=T[0].match(xl),!T){je.warn("No matches on slow regex match for level playlist!");continue}for(L=1;L<T.length&&!(typeof T[L]<"u");L++);const v=(" "+T[L]).slice(1),I=(" "+T[L+1]).slice(1),D=T[L+2]?(" "+T[L+2]).slice(1):"";switch(v){case"PLAYLIST-TYPE":i.type=I.toUpperCase();break;case"MEDIA-SEQUENCE":o=i.startSN=parseInt(I);break;case"SKIP":{const y=new Zt(I);ur(i,y,["RECENTLY-REMOVED-DATERANGES"]);const A=y.decimalInteger("SKIPPED-SEGMENTS");if(bt(A)){i.skippedSegments=A;for(let F=A;F--;)r.unshift(null);o+=A}const x=y.enumeratedString("RECENTLY-REMOVED-DATERANGES");x&&(i.recentlyRemovedDateranges=x.split("	"));break}case"TARGETDURATION":i.targetduration=Math.max(parseInt(I),1);break;case"VERSION":i.version=parseInt(I);break;case"EXTM3U":break;case"ENDLIST":i.live=!1;break;case"#":(I||D)&&f.tagList.push(D?[I,D]:[I]);break;case"DISCONTINUITY":E++,f.tagList.push(["DIS"]);break;case"GAP":f.gap=!0,f.tagList.push([v]);break;case"BITRATE":f.tagList.push([v,I]);break;case"DATERANGE":{const y=new Zt(I);ur(i,y,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),ur(i,y,y.clientAttrs);const A=new Xa(y,i.dateRanges[y.ID]);A.isValid||i.skippedSegments?i.dateRanges[A.id]=A:je.warn(`Ignoring invalid DATERANGE tag: "${I}"`),f.tagList.push(["EXT-X-DATERANGE",I]);break}case"DEFINE":{{const y=new Zt(I);ur(i,y,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in y?Ml(i,y,g):la(i,y,t)}break}case"DISCONTINUITY-SEQUENCE":E=parseInt(I);break;case"KEY":{const y=da(I,t,i);if(y.isSupported()){if(y.method==="NONE"){P=void 0;break}P||(P={}),P[y.keyFormat]&&(P=rr({},P)),P[y.keyFormat]=y}else je.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${I}"`);break}case"START":i.startTimeOffset=ha(I);break;case"MAP":{const y=new Zt(I);if(ur(i,y,["BYTERANGE","URI"]),f.duration){const A=new Zn(u,t);Ea(A,y,n,P),d=A,f.initSegment=d,d.rawProgramDateTime&&!f.rawProgramDateTime&&(f.rawProgramDateTime=d.rawProgramDateTime)}else Ea(f,y,n,P),d=f,M=!0;break}case"SERVER-CONTROL":{const y=new Zt(I);i.canBlockReload=y.bool("CAN-BLOCK-RELOAD"),i.canSkipUntil=y.optionalFloat("CAN-SKIP-UNTIL",0),i.canSkipDateRanges=i.canSkipUntil>0&&y.bool("CAN-SKIP-DATERANGES"),i.partHoldBack=y.optionalFloat("PART-HOLD-BACK",0),i.holdBack=y.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const y=new Zt(I);i.partTarget=y.decimalFloatingPoint("PART-TARGET");break}case"PART":{let y=i.partList;y||(y=i.partList=[]);const A=l>0?y[y.length-1]:void 0,x=l++,F=new Zt(I);ur(i,F,["BYTERANGE","URI"]);const k=new Qo(F,f,t,x,A);y.push(k),f.duration+=k.duration;break}case"PRELOAD-HINT":{const y=new Zt(I);ur(i,y,["URI"]),i.preloadHint=y;break}case"RENDITION-REPORT":{const y=new Zt(I);ur(i,y,["URI"]),i.renditionReports=i.renditionReports||[],i.renditionReports.push(y);break}default:je.warn(`line parsed but not handled: ${T}`);break}}}m&&!m.relurl?(r.pop(),c-=m.duration,i.partList&&(i.fragmentHint=m)):i.partList&&(ma(f,m),f.cc=E,i.fragmentHint=f,P&&_a(f,P,i));const S=r.length,p=r[0],h=r[S-1];if(c+=i.skippedSegments*i.targetduration,c>0&&S&&h){i.averagetargetduration=c/S;const C=h.sn;i.endSN=C!=="initSegment"?C:0,i.live||(h.endList=!0),p&&(i.startCC=p.cc)}else i.endSN=0,i.startCC=0;return i.fragmentHint&&(c+=i.fragmentHint.duration),i.totalduration=c,i.endCC=E,O>0&&Fl(r,O),i}}function da(b,e,t){var n,u;const _=new Zt(b);ur(t,_,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const g=(n=_.METHOD)!=null?n:"",i=_.URI,r=_.hexadecimalInteger("IV"),d=_.KEYFORMATVERSIONS,o=(u=_.KEYFORMAT)!=null?u:"identity";i&&_.IV&&!r&&je.error(`Invalid IV: ${_.IV}`);const l=i?Tr.resolve(i,e):"",c=(d||"1").split("/").map(Number).filter(Number.isFinite);return new gn(g,l,o,c,r)}function ha(b){const t=new Zt(b).decimalFloatingPoint("TIME-OFFSET");return bt(t)?t:null}function Nl(b,e){["video","audio","text"].forEach(t=>{const n=b.filter(u=>Ol(u,t));if(n.length){const u=n.filter(_=>_.lastIndexOf("avc1",0)===0||_.lastIndexOf("mp4a",0)===0);e[`${t}Codec`]=u.length>0?u[0]:n[0],b=b.filter(_=>n.indexOf(_)===-1)}}),e.unknownCodecs=b}function ga(b,e,t){const n=e[t];n&&(b[t]=n)}function Fl(b,e){let t=b[e];for(let n=e;n--;){const u=b[n];if(!u)return;u.programDateTime=t.programDateTime-u.duration*1e3,t=u}}function ma(b,e){b.rawProgramDateTime?b.programDateTime=Date.parse(b.rawProgramDateTime):e!=null&&e.programDateTime&&(b.programDateTime=e.endProgramDateTime),bt(b.programDateTime)||(b.programDateTime=null,b.rawProgramDateTime=null)}function Ea(b,e,t,n){b.relurl=e.URI,e.BYTERANGE&&b.setByteRange(e.BYTERANGE),b.level=t,b.sn="initSegment",n&&(b.levelkeys=n),b.initSegment=null}function _a(b,e,t){b.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(u=>e[u].isCommonEncryption)&&n.push(b)}var zt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},wt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function va(b){const{type:e}=b;switch(e){case zt.AUDIO_TRACK:return wt.AUDIO;case zt.SUBTITLE_TRACK:return wt.SUBTITLE;default:return wt.MAIN}}function ni(b,e){let t=b.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class wl{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(Ee.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(Ee.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.off(Ee.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(Ee.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,u=t.loader,_=n||u,g=new _(t);return this.loaders[e.type]=g,g}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:zt.MANIFEST,url:n,deliveryDirectives:null})}onLevelLoading(e,t){const{id:n,level:u,url:_,deliveryDirectives:g}=t;this.load({id:n,level:u,responseType:"text",type:zt.LEVEL,url:_,deliveryDirectives:g})}onAudioTrackLoading(e,t){const{id:n,groupId:u,url:_,deliveryDirectives:g}=t;this.load({id:n,groupId:u,level:null,responseType:"text",type:zt.AUDIO_TRACK,url:_,deliveryDirectives:g})}onSubtitleTrackLoading(e,t){const{id:n,groupId:u,url:_,deliveryDirectives:g}=t;this.load({id:n,groupId:u,level:null,responseType:"text",type:zt.SUBTITLE_TRACK,url:_,deliveryDirectives:g})}load(e){var t;const n=this.hls.config;let u=this.getInternalLoader(e);if(u){const d=u.context;if(d&&d.url===e.url){je.trace("[playlist-loader]: playlist request ongoing");return}je.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),u.abort()}let _;if(e.type===zt.MANIFEST?_=n.manifestLoadPolicy.default:_=rr({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),u=this.createInternalLoader(e),(t=e.deliveryDirectives)!=null&&t.part){let d;if(e.type===zt.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===zt.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===zt.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const o=d.partTarget,l=d.targetduration;if(o&&l){const c=Math.max(o*3,l*.8)*1e3;_=rr({},_,{maxTimeToFirstByteMs:Math.min(c,_.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(c,_.maxTimeToFirstByteMs)})}}}const g=_.errorRetry||_.timeoutRetry||{},i={loadPolicy:_,timeout:_.maxLoadTimeMs,maxRetry:g.maxNumRetry||0,retryDelay:g.retryDelayMs||0,maxRetryDelay:g.maxRetryDelayMs||0},r={onSuccess:(d,o,l,c)=>{const E=this.getInternalLoader(l);this.resetInternalLoader(l.type);const m=d.data;if(m.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(d,l,new Error("no EXTM3U delimiter"),c||null,o);return}o.parsing.start=performance.now(),Tr.isMediaPlaylist(m)?this.handleTrackOrLevelPlaylist(d,o,l,c||null,E):this.handleMasterPlaylist(d,o,l,c)},onError:(d,o,l,c)=>{this.handleNetworkError(o,l,!1,d,c)},onTimeout:(d,o,l)=>{this.handleNetworkError(o,l,!0,void 0,d)}};u.load(e,i,r)}handleMasterPlaylist(e,t,n,u){const _=this.hls,g=e.data,i=ni(e,n),r=Tr.parseMasterPlaylist(g,i);if(r.playlistParsingError){this.handleManifestParsingError(e,n,r.playlistParsingError,u,t);return}const{contentSteering:d,levels:o,sessionData:l,sessionKeys:c,startTimeOffset:E,variableList:m}=r;this.variableList=m;const{AUDIO:f=[],SUBTITLES:T,"CLOSED-CAPTIONS":L}=Tr.parseMasterPlaylistMedia(g,i,r);f.length&&!f.some(O=>!O.url)&&o[0].audioCodec&&!o[0].attrs.AUDIO&&(je.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),f.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Zt({}),bitrate:0,url:""})),_.trigger(Ee.MANIFEST_LOADED,{levels:o,audioTracks:f,subtitles:T,captions:L,contentSteering:d,url:i,stats:t,networkDetails:u,sessionData:l,sessionKeys:c,startTimeOffset:E,variableList:m})}handleTrackOrLevelPlaylist(e,t,n,u,_){const g=this.hls,{id:i,level:r,type:d}=n,o=ni(e,n),l=bt(i)?i:0,c=bt(r)?r:l,E=va(n),m=Tr.parseLevelPlaylist(e.data,o,c,E,l,this.variableList);if(d===zt.MANIFEST){const f={attrs:new Zt({}),bitrate:0,details:m,name:"",url:o};g.trigger(Ee.MANIFEST_LOADED,{levels:[f],audioTracks:[],url:o,stats:t,networkDetails:u,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=m,this.handlePlaylistLoaded(m,e,t,n,u,_)}handleManifestParsingError(e,t,n,u,_){this.hls.trigger(Ee.ERROR,{type:Nt.NETWORK_ERROR,details:st.MANIFEST_PARSING_ERROR,fatal:t.type===zt.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:u,stats:_})}handleNetworkError(e,t,n=!1,u,_){let g=`A network ${n?"timeout":"error"+(u?" (status "+u.code+")":"")} occurred while loading ${e.type}`;e.type===zt.LEVEL?g+=`: ${e.level} id: ${e.id}`:(e.type===zt.AUDIO_TRACK||e.type===zt.SUBTITLE_TRACK)&&(g+=` id: ${e.id} group-id: "${e.groupId}"`);const i=new Error(g);je.warn(`[playlist-loader]: ${g}`);let r=st.UNKNOWN,d=!1;const o=this.getInternalLoader(e);switch(e.type){case zt.MANIFEST:r=n?st.MANIFEST_LOAD_TIMEOUT:st.MANIFEST_LOAD_ERROR,d=!0;break;case zt.LEVEL:r=n?st.LEVEL_LOAD_TIMEOUT:st.LEVEL_LOAD_ERROR,d=!1;break;case zt.AUDIO_TRACK:r=n?st.AUDIO_TRACK_LOAD_TIMEOUT:st.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case zt.SUBTITLE_TRACK:r=n?st.SUBTITLE_TRACK_LOAD_TIMEOUT:st.SUBTITLE_LOAD_ERROR,d=!1;break}o&&this.resetInternalLoader(e.type);const l={type:Nt.NETWORK_ERROR,details:r,fatal:d,url:e.url,loader:o,context:e,error:i,networkDetails:t,stats:_};if(u){const c=(t==null?void 0:t.url)||e.url;l.response=dr({url:c,data:void 0},u)}this.hls.trigger(Ee.ERROR,l)}handlePlaylistLoaded(e,t,n,u,_,g){const i=this.hls,{type:r,level:d,id:o,groupId:l,deliveryDirectives:c}=u,E=ni(t,u),m=va(u),f=typeof u.level=="number"&&m===wt.MAIN?d:void 0;if(!e.fragments.length){const L=new Error("No Segments found in Playlist");i.trigger(Ee.ERROR,{type:Nt.NETWORK_ERROR,details:st.LEVEL_EMPTY_ERROR,fatal:!1,url:E,error:L,reason:L.message,response:t,context:u,level:f,parent:m,networkDetails:_,stats:n});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const T=e.playlistParsingError;if(T){i.trigger(Ee.ERROR,{type:Nt.NETWORK_ERROR,details:st.LEVEL_PARSING_ERROR,fatal:!1,url:E,error:T,reason:T.message,response:t,context:u,level:f,parent:m,networkDetails:_,stats:n});return}switch(e.live&&g&&(g.getCacheAge&&(e.ageHeader=g.getCacheAge()||0),(!g.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),r){case zt.MANIFEST:case zt.LEVEL:i.trigger(Ee.LEVEL_LOADED,{details:e,level:f||0,id:o||0,stats:n,networkDetails:_,deliveryDirectives:c});break;case zt.AUDIO_TRACK:i.trigger(Ee.AUDIO_TRACK_LOADED,{details:e,id:o||0,groupId:l||"",stats:n,networkDetails:_,deliveryDirectives:c});break;case zt.SUBTITLE_TRACK:i.trigger(Ee.SUBTITLE_TRACK_LOADED,{details:e,id:o||0,groupId:l||"",stats:n,networkDetails:_,deliveryDirectives:c});break}}}function cs(b,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=b,e.dispatchEvent(t)}function ds(b,e){const t=b.mode;if(t==="disabled"&&(b.mode="hidden"),b.cues&&!b.cues.getCueById(e.id))try{if(b.addCue(e),!b.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){je.debug(`[texttrack-utils]: ${n}`);const u=new self.TextTrackCue(e.startTime,e.endTime,e.text);u.id=e.id,b.addCue(u)}t==="disabled"&&(b.mode=t)}function rn(b){const e=b.mode;if(e==="disabled"&&(b.mode="hidden"),b.cues)for(let t=b.cues.length;t--;)b.removeCue(b.cues[t]);e==="disabled"&&(b.mode=e)}function Di(b,e,t,n){const u=b.mode;if(u==="disabled"&&(b.mode="hidden"),b.cues&&b.cues.length>0){const _=Ul(b.cues,e,t);for(let g=0;g<_.length;g++)(!n||n(_[g]))&&b.removeCue(_[g])}u==="disabled"&&(b.mode=u)}function Bl(b,e){if(e<b[0].startTime)return 0;const t=b.length-1;if(e>b[t].endTime)return-1;let n=0,u=t;for(;n<=u;){const _=Math.floor((u+n)/2);if(e<b[_].startTime)u=_-1;else if(e>b[_].startTime&&n<t)n=_+1;else return _}return b[n].startTime-e<e-b[u].startTime?n:u}function Ul(b,e,t){const n=[],u=Bl(b,e);if(u>-1)for(let _=u,g=b.length;_<g;_++){const i=b[_];if(i.startTime>=e&&i.endTime<=t)n.push(i);else if(i.startTime>t)return n}return n}var pr={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const kl=.25;function Ii(){if(!(typeof self>"u"))return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const Rn=(()=>{const b=Ii();try{new b(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function ii(b,e){return b.getTime()/1e3-e}function Kl(b){return Uint8Array.from(b.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class Wl{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Ee.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Ee.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(rn(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return cs(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:u}}}=this;if(!n&&!u)return;const{samples:_}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const g=Ii();for(let i=0;i<_.length;i++){const r=_[i].type;if(r===pr.emsg&&!n||!u)continue;const d=rs(_[i].data);if(d){const o=_[i].pts;let l=o+_[i].duration;l>Rn&&(l=Rn),l-o<=0&&(l=o+kl);for(let E=0;E<d.length;E++){const m=d[E];if(!ts(m)){this.updateId3CueEnds(o);const f=new g(o,l,"");f.value=m,r&&(f.type=r),this.id3Track.addCue(f)}}}}}updateId3CueEnds(e){var t;const n=(t=this.id3Track)==null?void 0:t.cues;if(n)for(let u=n.length;u--;){const _=n[u];_.startTime<e&&_.endTime===Rn&&(_.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:u}){const{id3Track:_,hls:g}=this;if(!g)return;const{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:r}}=g;if(_&&(i||r)){let d;u==="audio"?d=o=>o.type===pr.audioId3&&r:u==="video"?d=o=>o.type===pr.emsg&&i:d=o=>o.type===pr.audioId3&&r||o.type===pr.emsg&&i,Di(_,t,n,d)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:n,id3Track:u}=this,{dateRanges:_}=t,g=Object.keys(_);if(u){const o=Object.keys(n).filter(l=>!g.includes(l));for(let l=o.length;l--;){const c=o[l];Object.keys(n[c].cues).forEach(E=>{u.removeCue(n[c].cues[E])}),delete n[c]}}const i=t.fragments[t.fragments.length-1];if(g.length===0||!bt(i==null?void 0:i.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const r=i.programDateTime/1e3-i.start,d=Ii();for(let o=0;o<g.length;o++){const l=g[o],c=_[l],E=n[l],m=(E==null?void 0:E.cues)||{};let f=(E==null?void 0:E.durationKnown)||!1;const T=ii(c.startDate,r);let L=Rn;const P=c.endDate;if(P)L=ii(P,r),f=!0;else if(c.endOnNext&&!f){const M=g.reduce((S,p)=>{const h=_[p];return h.class===c.class&&h.id!==p&&h.startDate>c.startDate&&S.push(h),S},[]).sort((S,p)=>S.startDate.getTime()-p.startDate.getTime())[0];M&&(L=ii(M.startDate,r),f=!0)}const O=Object.keys(c.attr);for(let M=0;M<O.length;M++){const S=O[M];if(!$o(S))continue;let p=m[S];if(p)f&&!E.durationKnown&&(p.endTime=L);else{let h=c.attr[S];p=new d(T,L,""),Xo(S)&&(h=Kl(h)),p.value={key:S,data:h},p.type=pr.dateRange,p.id=l,this.id3Track.addCue(p),m[S]=p}}n[l]={cues:m,dateRange:c,durationKnown:f}}}}class jl{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:t,partHoldBack:n,targetduration:u}=e,{liveSyncDuration:_,liveSyncDurationCount:g,lowLatencyMode:i}=this.config,r=this.hls.userConfig;let d=i&&n||t;(r.liveSyncDuration||r.liveSyncDurationCount||d===0)&&(d=_!==void 0?_:g*u);const o=u,l=1;return d+Math.min(this.stallCount*l,o)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,n=this.levelDetails;if(e===null||t===null||n===null)return null;const u=n.edge,_=e-t-this.edgeStalled,g=u-n.totalduration,i=u-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(g,_),i)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Ee.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Ee.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Ee.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Ee.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var n;t.details===st.BUFFER_STALLED_ERROR&&(this.stallCount++,(n=this.levelDetails)!=null&&n.live&&je.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:u,maxLiveSyncPlaybackRate:_}=this.config;if(!u||_===1)return;const g=this.targetLatency;if(g===null)return;const i=n-g,r=Math.min(this.maxLatency,g+t.targetduration),d=i<r;if(t.live&&d&&i>.05&&this.forwardBufferLength>1){const o=Math.min(2,Math.max(1,_)),l=Math.round(2/(1+Math.exp(-.75*i-this.edgeStalled))*20)/20;e.playbackRate=Math.min(o,Math.max(1,l))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const Ci=["NONE","TYPE-0","TYPE-1",null];var dn={No:"",Yes:"YES",v2:"v2"};function Gl(b,e){const{canSkipUntil:t,canSkipDateRanges:n,endSN:u}=b,_=e!==void 0?e-u:0;return t&&_<t?n?dn.v2:dn.Yes:dn.No}class pa{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class mn{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>t).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){const t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return(e=this.audioGroupIds)==null?void 0:e[this.urlId]}get textGroupId(){var e;return(e=this.textGroupIds)==null?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function ai(b,e){const t=e.startPTS;if(bt(t)){let n=0,u;e.sn>b.sn?(n=t-b.start,u=b):(n=b.start-t,u=e),u.duration!==n&&(u.duration=n)}else e.sn>b.sn?b.cc===e.cc&&b.minEndPTS?e.start=b.start+(b.minEndPTS-b.start):e.start=b.start+b.duration:e.start=Math.max(b.start-e.duration,0)}function hs(b,e,t,n,u,_){n-t<=0&&(je.warn("Fragment should have a positive duration",e),n=t+e.duration,_=u+e.duration);let i=t,r=n;const d=e.startPTS,o=e.endPTS;if(bt(d)){const T=Math.abs(d-t);bt(e.deltaPTS)?e.deltaPTS=Math.max(T,e.deltaPTS):e.deltaPTS=T,i=Math.max(t,d),t=Math.min(t,d),u=Math.min(u,e.startDTS),r=Math.min(n,o),n=Math.max(n,o),_=Math.max(_,e.endDTS)}const l=t-e.start;e.start!==0&&(e.start=t),e.duration=n-e.start,e.startPTS=t,e.maxStartPTS=i,e.startDTS=u,e.endPTS=n,e.minEndPTS=r,e.endDTS=_;const c=e.sn;if(!b||c<b.startSN||c>b.endSN)return 0;let E;const m=c-b.startSN,f=b.fragments;for(f[m]=e,E=m;E>0;E--)ai(f[E],f[E-1]);for(E=m;E<f.length-1;E++)ai(f[E],f[E+1]);return b.fragmentHint&&ai(f[f.length-1],b.fragmentHint),b.PTSKnown=b.alignedSliding=!0,l}function Hl(b,e){let t=null;const n=b.fragments;for(let r=n.length-1;r>=0;r--){const d=n[r].initSegment;if(d){t=d;break}}b.fragmentHint&&delete b.fragmentHint.endPTS;let u=0,_;if(zl(b,e,(r,d)=>{r.relurl&&(u=r.cc-d.cc),bt(r.startPTS)&&bt(r.endPTS)&&(d.start=d.startPTS=r.startPTS,d.startDTS=r.startDTS,d.maxStartPTS=r.maxStartPTS,d.endPTS=r.endPTS,d.endDTS=r.endDTS,d.minEndPTS=r.minEndPTS,d.duration=r.endPTS-r.startPTS,d.duration&&(_=d),e.PTSKnown=e.alignedSliding=!0),d.elementaryStreams=r.elementaryStreams,d.loader=r.loader,d.stats=r.stats,d.urlId=r.urlId,r.initSegment&&(d.initSegment=r.initSegment,t=r.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(d=>{var o;(!d.initSegment||d.initSegment.relurl===((o=t)==null?void 0:o.relurl))&&(d.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(r=>!r),e.deltaUpdateFailed){je.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let r=e.skippedSegments;r--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=Vl(b.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const g=e.fragments;if(u){je.warn("discontinuity sliding from playlist, take drift into account");for(let r=0;r<g.length;r++)g[r].cc+=u}e.skippedSegments&&(e.startCC=e.fragments[0].cc),Yl(b.partList,e.partList,(r,d)=>{d.elementaryStreams=r.elementaryStreams,d.stats=r.stats}),_?hs(e,_,_.startPTS,_.endPTS,_.startDTS,_.endDTS):gs(b,e),g.length&&(e.totalduration=e.edge-g[0].start),e.driftStartTime=b.driftStartTime,e.driftStart=b.driftStart;const i=e.advancedDateTime;if(e.advanced&&i){const r=e.edge;e.driftStart||(e.driftStartTime=i,e.driftStart=r),e.driftEndTime=i,e.driftEnd=r}else e.driftEndTime=b.driftEndTime,e.driftEnd=b.driftEnd,e.advancedDateTime=b.advancedDateTime}function Vl(b,e,t){const n=rr({},b);return t&&t.forEach(u=>{delete n[u]}),Object.keys(e).forEach(u=>{const _=new Xa(e[u].attr,n[u]);_.isValid?n[u]=_:je.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[u].attr)}"`)}),n}function Yl(b,e,t){if(b&&e){let n=0;for(let u=0,_=b.length;u<=_;u++){const g=b[u],i=e[u+n];g&&i&&g.index===i.index&&g.fragment.sn===i.fragment.sn?t(g,i):n--}}}function zl(b,e,t){const n=e.skippedSegments,u=Math.max(b.startSN,e.startSN)-e.startSN,_=(b.fragmentHint?1:0)+(n?e.endSN:Math.min(b.endSN,e.endSN))-e.startSN,g=e.startSN-b.startSN,i=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,r=b.fragmentHint?b.fragments.concat(b.fragmentHint):b.fragments;for(let d=u;d<=_;d++){const o=r[g+d];let l=i[d];n&&!l&&d<n&&(l=e.fragments[d]=o),o&&l&&t(o,l)}}function gs(b,e){const t=e.startSN+e.skippedSegments-b.startSN,n=b.fragments;t<0||t>=n.length||Pi(e,n[t].start)}function Pi(b,e){if(e){const t=b.fragments;for(let n=b.skippedSegments;n<t.length;n++)t[n].start+=e;b.fragmentHint&&(b.fragmentHint.start+=e)}}function $l(b,e=1/0){let t=1e3*b.targetduration;if(b.updated){const n=b.fragments,u=4;if(n.length&&t*u>e){const _=n[n.length-1].duration*1e3;_<t&&(t=_)}}else t/=2;return Math.round(t)}function Xl(b,e,t){if(!(b!=null&&b.details))return null;const n=b.details;let u=n.fragments[e-n.startSN];return u||(u=n.fragmentHint,u&&u.sn===e)?u:e<n.startSN&&t&&t.sn===e?t:null}function Ta(b,e,t){var n;return b!=null&&b.details?ms((n=b.details)==null?void 0:n.partList,e,t):null}function ms(b,e,t){if(b)for(let n=b.length;n--;){const u=b[n];if(u.index===t&&u.fragment.sn===e)return u}return null}function Fn(b){switch(b.details){case st.FRAG_LOAD_TIMEOUT:case st.KEY_LOAD_TIMEOUT:case st.LEVEL_LOAD_TIMEOUT:case st.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ya(b,e){const t=Fn(e);return b.default[`${t?"timeout":"error"}Retry`]}function wi(b,e){const t=b.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*b.retryDelayMs,b.maxRetryDelayMs)}function Aa(b){return dr(dr({},b),{errorRetry:null,timeoutRetry:null})}function wn(b,e,t,n){return!!b&&e<b.maxNumRetry&&(Ql(n)||!!t)}function Ql(b){return b===0&&navigator.onLine===!1||!!b&&(b<400||b>499)}const Es={search:function(b,e){let t=0,n=b.length-1,u=null,_=null;for(;t<=n;){u=(t+n)/2|0,_=b[u];const g=e(_);if(g>0)t=u+1;else if(g<0)n=u-1;else return _}return null}};function Jl(b,e,t){if(e===null||!Array.isArray(b)||!b.length||!bt(e))return null;const n=b[0].programDateTime;if(e<(n||0))return null;const u=b[b.length-1].endProgramDateTime;if(e>=(u||0))return null;t=t||0;for(let _=0;_<b.length;++_){const g=b[_];if(Zl(e,t,g))return g}return null}function En(b,e,t=0,n=0){let u=null;if(b?u=e[b.sn-e[0].sn+1]||null:t===0&&e[0].start===0&&(u=e[0]),u&&Mi(t,n,u)===0)return u;const _=Es.search(e,Mi.bind(null,t,n));return _&&(_!==b||!u)?_:u}function Mi(b=0,e=0,t){if(t.start<=b&&t.start+t.duration>b)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=b?1:t.start-n>b&&t.start?-1:0}function Zl(b,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>b}function ql(b,e){return Es.search(b,t=>t.cc<e?1:t.cc>e?-1:0)}const eu=3e5;var fr={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Er={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class tu{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=je.log.bind(je,"[info]:"),this.warn=je.warn.bind(je,"[warning]:"),this.error=je.error.bind(je,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(Ee.ERROR,this.onError,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Ee.ERROR,this.onError,this),e.off(Ee.ERROR,this.onErrorOut,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return(e==null?void 0:e.type)===wt.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onError(e,t){var n;if(t.fatal)return;const u=this.hls,_=t.context;switch(t.details){case st.FRAG_LOAD_ERROR:case st.FRAG_LOAD_TIMEOUT:case st.KEY_LOAD_ERROR:case st.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case st.FRAG_GAP:case st.FRAG_PARSING_ERROR:case st.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=fr.SendAlternateToPenaltyBox;return}case st.LEVEL_EMPTY_ERROR:case st.LEVEL_PARSING_ERROR:{var g,i;const r=t.parent===wt.MAIN?t.level:u.loadLevel;t.details===st.LEVEL_EMPTY_ERROR&&((g=t.context)!=null&&(i=g.levelDetails)!=null&&i.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,r))}return;case st.LEVEL_LOAD_ERROR:case st.LEVEL_LOAD_TIMEOUT:typeof(_==null?void 0:_.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,_.level));return;case st.AUDIO_TRACK_LOAD_ERROR:case st.AUDIO_TRACK_LOAD_TIMEOUT:case st.SUBTITLE_LOAD_ERROR:case st.SUBTITLE_TRACK_LOAD_TIMEOUT:if(_){const r=u.levels[u.loadLevel];if(r&&(_.type===zt.AUDIO_TRACK&&_.groupId===r.audioGroupId||_.type===zt.SUBTITLE_TRACK&&_.groupId===r.textGroupId)){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u.loadLevel),t.errorAction.action=fr.SendAlternateToPenaltyBox,t.errorAction.flags=Er.MoveAllAlternatesMatchingHost;return}}return;case st.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const r=u.levels[u.loadLevel],d=r==null?void 0:r.attrs["HDCP-LEVEL"];d&&(t.errorAction={action:fr.SendAlternateToPenaltyBox,flags:Er.MoveAllAlternatesMatchingHDCP,hdcpLevel:d})}return;case st.BUFFER_ADD_CODEC_ERROR:case st.REMUX_ALLOC_ERROR:t.errorAction=this.getLevelSwitchAction(t,(n=t.level)!=null?n:u.loadLevel);return;case st.INTERNAL_EXCEPTION:case st.BUFFER_APPENDING_ERROR:case st.BUFFER_APPEND_ERROR:case st.BUFFER_FULL_ERROR:case st.LEVEL_SWITCH_ERROR:case st.BUFFER_STALLED_ERROR:case st.BUFFER_SEEK_OVER_HOLE:case st.BUFFER_NUDGE_ON_STALL:t.errorAction={action:fr.DoNothing,flags:Er.None};return}if(t.type===Nt.KEY_SYSTEM_ERROR){const r=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,r);return}}getPlaylistRetryOrSwitchAction(e,t){var n,u;const _=this.hls,g=ya(_.config.playlistLoadPolicy,e),i=this.playlistError++,r=(n=e.response)==null?void 0:n.code;return wn(g,i,Fn(e),r)?{action:fr.RetryRequest,flags:Er.None,retryConfig:g,retryCount:i}:(u=e.context)!=null&&u.deliveryDirectives?{action:fr.DoNothing,flags:Er.None,retryConfig:g||{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},retryCount:i}:this.getLevelSwitchAction(e,t)}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),u=t.levels[n],{fragLoadPolicy:_,keyLoadPolicy:g}=t.config,i=ya(e.details.startsWith("key")?g:_,e),r=t.levels.reduce((l,c)=>l+c.fragmentError,0);if(u){var d;e.details!==st.FRAG_GAP&&u.fragmentError++;const l=(d=e.response)==null?void 0:d.code;if(wn(i,r,Fn(e),l))return{action:fr.RetryRequest,flags:Er.None,retryConfig:i,retryCount:r}}const o=this.getLevelSwitchAction(e,n);return i&&(o.retryConfig=i,o.retryCount=r),o}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const u=this.hls.levels[t];if(u&&(u.loadError++,n.autoLevelEnabled)){var _,g;let i=-1;const r=n.levels,d=(_=e.frag)==null?void 0:_.type,{type:o,groupId:l}=(g=e.context)!=null?g:{};for(let c=r.length;c--;){const E=(c+n.loadLevel)%r.length;if(E!==n.loadLevel&&r[E].loadError===0){const m=r[E];if(e.details===st.FRAG_GAP&&e.frag){const f=r[E].details;if(f){const T=En(e.frag,f.fragments,e.frag.start);if(T!=null&&T.gap)continue}}else{if(o===zt.AUDIO_TRACK&&l===m.audioGroupId||o===zt.SUBTITLE_TRACK&&l===m.textGroupId)continue;if(d===wt.AUDIO&&u.audioGroupId===m.audioGroupId||d===wt.SUBTITLE&&u.textGroupId===m.textGroupId)continue}i=E;break}}if(i>-1&&n.loadLevel!==i)return e.levelRetry=!0,{action:fr.SendAlternateToPenaltyBox,flags:Er.None,nextAutoLevel:i}}return{action:fr.SendAlternateToPenaltyBox,flags:Er.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case fr.DoNothing:break;case fr.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==st.FRAG_GAP&&(t.fatal=!0);break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:u,hdcpLevel:_,nextAutoLevel:g}=n;switch(u){case Er.None:this.switchLevel(e,g);break;case Er.MoveAllAlternatesMatchingHost:n.resolved||(n.resolved=this.redundantFailover(e));break;case Er.MoveAllAlternatesMatchingHDCP:_&&(t.maxHdcpLevel=Ci[Ci.indexOf(_)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}n.resolved||this.switchLevel(e,g)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){const{hls:t,penalizedRenditions:n}=this,u=e.parent===wt.MAIN?e.level:t.loadLevel,_=t.levels[u],g=_.url.length,i=e.frag?e.frag.urlId:_.urlId;_.urlId===i&&(!e.frag||_.details)&&this.penalizeRendition(_,e);for(let r=1;r<g;r++){const d=(i+r)%g,o=n[d];if(!o||ru(o,e,n[i]))return this.warn(`Switching to Redundant Stream ${d+1}/${g}: "${_.url[d]}" after ${e.details}`),this.playlistError=0,t.levels.forEach(l=>{l.urlId=d}),t.nextLoadLevel=u,!0}return!1}penalizeRendition(e,t){const{penalizedRenditions:n}=this,u=n[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};u.lastErrorPerfMs=performance.now(),u.errors.push(t),u.details=e.details,n[e.urlId]=u}}function ru(b,e,t){if(performance.now()-b.lastErrorPerfMs>eu)return!0;const n=b.details;if(e.details===st.FRAG_GAP&&n&&e.frag){const u=e.frag.start,_=En(null,n.fragments,u);if(_&&!_.gap)return!0}if(t&&b.errors.length<t.errors.length){const u=b.errors[b.errors.length-1];if(n&&u.frag&&e.frag&&Math.abs(u.frag.start-e.frag.start)>n.targetduration*3)return!0}return!1}class Bi{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=je.log.bind(je,`${t}:`),this.warn=je.warn.bind(je,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){const n=t==null?void 0:t.renditionReports;if(n){let u=-1;for(let _=0;_<n.length;_++){const g=n[_];let i;try{i=new self.URL(g.URI,t.url).href}catch(r){je.warn(`Could not construct new URL for Rendition Report: ${r}`),i=g.URI||""}if(i===e){u=_;break}else i===e.substring(0,i.length)&&(u=_)}if(u!==-1){const _=n[u],g=parseInt(_["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let i=parseInt(_["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const r=Math.min(t.age-t.partTarget,t.targetduration);i>=0&&r>t.partTarget&&(i+=1)}return new pa(g,i>=0?i:void 0,dn.No)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,n){const{details:u,stats:_}=t,g=self.performance.now(),i=_.loading.first?Math.max(0,g-_.loading.first):0;if(u.advancedDateTime=Date.now()-i,u.live||n!=null&&n.live){if(u.reloaded(n),n&&this.log(`live playlist ${e} ${u.advanced?"REFRESHED "+u.lastPartSn+"-"+u.lastPartIndex:"MISSED"}`),n&&u.fragments.length>0&&Hl(n,u),!this.canLoad||!u.live)return;let r,d,o;if(u.canBlockReload&&u.endSN&&u.advanced){const T=this.hls.config.lowLatencyMode,L=u.lastPartSn,P=u.endSN,O=u.lastPartIndex,M=O!==-1,S=L===P,p=T?0:O;M?(d=S?P+1:L,o=S?p:O+1):d=P+1;const h=u.age,C=h+u.ageHeader;let v=Math.min(C-u.partTarget,u.targetduration*1.5);if(v>0){if(n&&v>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${v} with playlist age: ${u.age}`),v=0;else{const I=Math.floor(v/u.targetduration);if(d+=I,o!==void 0){const D=Math.round(v%u.targetduration/u.partTarget);o+=D}this.log(`CDN Tune-in age: ${u.ageHeader}s last advanced ${h.toFixed(2)}s goal: ${v} skip sn ${I} to part ${o}`)}u.tuneInGoal=v}if(r=this.getDeliveryDirectives(u,t.deliveryDirectives,d,o),T||!S){this.loadPlaylist(r);return}}else u.canBlockReload&&(r=this.getDeliveryDirectives(u,t.deliveryDirectives,d,o));const l=this.hls.mainForwardBufferInfo,c=l?l.end-l.len:0,E=(u.edge-c)*1e3,m=$l(u,E);u.updated&&g>this.requestScheduled+m&&(this.requestScheduled=_.loading.start),d!==void 0&&u.canBlockReload?this.requestScheduled=_.loading.first+m-(u.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+m<g?this.requestScheduled=g:this.requestScheduled-g<=0&&(this.requestScheduled+=m);let f=this.requestScheduled-g;f=Math.max(0,f),this.log(`reload live playlist ${e} in ${Math.round(f)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(r),f)}else this.clearTimer()}getDeliveryDirectives(e,t,n,u){let _=Gl(e,n);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,u=t.part,_=dn.No),new pa(n,u,_)}checkRetry(e){const t=e.details,n=Fn(e),u=e.errorAction,{action:_,retryCount:g=0,retryConfig:i}=u||{},r=_===fr.RetryRequest&&!!u&&!!i;if(r){var d;if(this.requestScheduled=-1,n&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${g+1}/${i.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const o=wi(i,g);this.timer=self.setTimeout(()=>this.loadPlaylist(),o),this.warn(`Retrying playlist loading ${g+1}/${i.maxNumRetry} after "${t}" in ${o}ms`)}e.levelRetry=!0,u.resolved=!0}return r}}let si;class nu extends Bi{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Ee.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(Ee.FRAG_LOADED,this.onFragLoaded,this),e.on(Ee.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Ee.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(Ee.FRAG_LOADED,this.onFragLoaded,this),e.off(Ee.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=[],u={};let _;t.levels.forEach(g=>{var i;const r=g.attrs;((i=g.audioCodec)==null?void 0:i.indexOf("mp4a.40.34"))!==-1&&(si||(si=/chrome|firefox/i.test(navigator.userAgent)),si&&(g.audioCodec=void 0));const{AUDIO:d,CODECS:o,"FRAME-RATE":l,"PATHWAY-ID":c,RESOLUTION:E,SUBTITLES:m}=r,T=`${`${c||"."}-`}${g.bitrate}-${E}-${l}-${o}`;_=u[T],_?_.addFallback(g):(_=new mn(g),u[T]=_,n.push(_)),Bn(_,"audio",d),Bn(_,"text",m)}),this.filterAndSortMediaOptions(n,t)}filterAndSortMediaOptions(e,t){let n=[],u=[],_=!1,g=!1,i=!1,r=e.filter(({audioCodec:E,videoCodec:m,width:f,height:T,unknownCodecs:L})=>(_||(_=!!(f&&T)),g||(g=!!m),i||(i=!!E),!(L!=null&&L.length)&&(!E||ri(E,"audio"))&&(!m||ri(m,"video"))));if((_||g)&&i&&(r=r.filter(({videoCodec:E,width:m,height:f})=>!!E||!!(m&&f))),r.length===0){Promise.resolve().then(()=>{if(this.hls){const E=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:E,reason:E.message})}});return}t.audioTracks&&(n=t.audioTracks.filter(E=>!E.audioCodec||ri(E.audioCodec,"audio")),Sa(n)),t.subtitles&&(u=t.subtitles,Sa(u));const d=r.slice(0);r.sort((E,m)=>E.attrs["HDCP-LEVEL"]!==m.attrs["HDCP-LEVEL"]?(E.attrs["HDCP-LEVEL"]||"")>(m.attrs["HDCP-LEVEL"]||"")?1:-1:E.bitrate!==m.bitrate?E.bitrate-m.bitrate:E.attrs["FRAME-RATE"]!==m.attrs["FRAME-RATE"]?E.attrs.decimalFloatingPoint("FRAME-RATE")-m.attrs.decimalFloatingPoint("FRAME-RATE"):E.attrs.SCORE!==m.attrs.SCORE?E.attrs.decimalFloatingPoint("SCORE")-m.attrs.decimalFloatingPoint("SCORE"):_&&E.height!==m.height?E.height-m.height:0);let o=d[0];if(this.steering&&(r=this.steering.filterParsedLevels(r),r.length!==d.length)){for(let E=0;E<d.length;E++)if(d[E].pathwayId===r[0].pathwayId){o=d[E];break}}this._levels=r;for(let E=0;E<r.length;E++)if(r[E]===o){this._firstLevel=E,this.log(`manifest loaded, ${r.length} level(s) found, first bitrate: ${o.bitrate}`);break}const l=i&&!g,c={levels:r,audioTracks:n,subtitleTracks:u,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:g,altAudio:!l&&n.some(E=>!!E.url)};this.hls.trigger(Ee.MANIFEST_PARSED,c),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const o=new Error("invalid level idx"),l=e<0;if(this.hls.trigger(Ee.ERROR,{type:Nt.OTHER_ERROR,details:st.LEVEL_SWITCH_ERROR,level:e,fatal:l,error:o,reason:o.message}),l)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,u=this.currentLevel,_=u?u.attrs["PATHWAY-ID"]:void 0,g=t[e],i=g.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=g,n===e&&g.details&&u&&_===i)return;this.log(`Switching to level ${e}${i?" with Pathway "+i:""} from level ${n}${_?" with Pathway "+_:""}`);const r=rr({},g,{level:e,maxBitrate:g.maxBitrate,attrs:g.attrs,uri:g.uri,urlId:g.urlId});delete r._attrs,delete r._urlId,this.hls.trigger(Ee.LEVEL_SWITCHING,r);const d=g.details;if(!d||d.live){const o=this.switchParams(g.uri,u==null?void 0:u.details);this.loadPlaylist(o)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this._firstLevel}else return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===zt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(t!==void 0&&t.type===wt.MAIN){const n=this._levels[t.level];n!==void 0&&(n.loadError=0)}}onLevelLoaded(e,t){var n;const{level:u,details:_}=t,g=this._levels[u];if(!g){var i;this.warn(`Invalid level index ${u}`),(i=t.deliveryDirectives)!=null&&i.skip&&(_.deltaUpdateFailed=!0);return}u===this.currentLevelIndex?(g.fragmentError===0&&(g.loadError=0),this.playlistLoaded(u,t,g.details)):(n=t.deliveryDirectives)!=null&&n.skip&&(_.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){const n=this.currentLevel;if(!n)return;const u=this.hls.audioTracks[t.id].groupId;if(n.audioGroupIds&&n.audioGroupId!==u){let _=-1;for(let g=0;g<n.audioGroupIds.length;g++)if(n.audioGroupIds[g]===u){_=g;break}_!==-1&&_!==n.urlId&&(n.urlId=_,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){const u=n.urlId;let _=n.uri;if(e)try{_=e.addDirectives(_)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}const g=n.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${g?" Pathway "+g:""} URI ${u+1}/${n.url.length} ${_}`),this.clearTimer(),this.hls.trigger(Ee.LEVEL_LOADING,{url:_,level:t,id:u,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){const n=(_,g)=>g!==t,u=this._levels.filter((_,g)=>g!==e?!0:_.url.length>1&&t!==void 0?(_.url=_.url.filter(n),_.audioGroupIds&&(_.audioGroupIds=_.audioGroupIds.filter(n)),_.textGroupIds&&(_.textGroupIds=_.textGroupIds.filter(n)),_.urlId=0,!0):(this.steering&&this.steering.removeLevel(_),!1));this.hls.trigger(Ee.LEVELS_UPDATED,{levels:u})}onLevelsUpdated(e,{levels:t}){t.forEach((n,u)=>{const{details:_}=n;_!=null&&_.fragments&&_.fragments.forEach(g=>{g.level=u})}),this._levels=t}}function Bn(b,e,t){t&&(e==="audio"?(b.audioGroupIds||(b.audioGroupIds=[]),b.audioGroupIds[b.url.length-1]=t):e==="text"&&(b.textGroupIds||(b.textGroupIds=[]),b.textGroupIds[b.url.length-1]=t))}function Sa(b){const e={};b.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}var ar={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class iu{constructor(e){this.mainFragEntity=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Ee.BUFFER_APPENDED,this.onBufferAppended,this),e.on(Ee.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Ee.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.BUFFER_APPENDED,this.onBufferAppended,this),e.off(Ee.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Ee.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.mainFragEntity=this.activeParts=null}getAppendedFrag(e,t){if(t===wt.MAIN){const{mainFragEntity:n,activeParts:u}=this;if(n){if(n&&u)for(let _=u.length;_--;){const g=u[_],i=g?g.end:n.appendedPTS;if(g.start<=e&&i!==null&&e<=i)return _>9&&(this.activeParts=u.slice(_-9)),g}else if(n.body.start<=e&&n.appendedPTS!==null&&e<=n.appendedPTS)return n.body}}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:n}=this,u=Object.keys(n);for(let _=u.length;_--;){const g=n[u[_]];if((g==null?void 0:g.body.type)===t&&g.buffered){const i=g.body;if(i.start<=e&&e<=i.end)return i}}return null}detectEvictedFragments(e,t,n){this.timeRanges&&(this.timeRanges[e]=t),Object.keys(this.fragments).forEach(u=>{const _=this.fragments[u];if(!_)return;if(!_.buffered&&!_.loaded){_.body.type===n&&this.removeFragment(_.body);return}const g=_.range[e];g&&g.time.some(i=>{const r=!this.isTimeBuffered(i.startPTS,i.endPTS,t);return r&&this.removeFragment(_.body),r})})}detectPartialFragments(e){const t=this.timeRanges,{frag:n,part:u}=e;if(!t||n.sn==="initSegment")return;const _=wr(n),g=this.fragments[_];g&&(Object.keys(t).forEach(i=>{const r=n.elementaryStreams[i];if(!r)return;const d=t[i],o=u!==null||r.partial===!0;g.range[i]=this.getBufferedTimes(n,u,o,d)}),g.loaded=null,Object.keys(g.range).length?(g.buffered=!0,g.body.endList&&(this.endListFragments[g.body.type]=g)):this.removeFragment(g.body))}fragBuffered(e,t){const n=wr(e);let u=this.fragments[n];!u&&t&&(u=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),u&&(u.loaded=null,u.buffered=!0)}getBufferedTimes(e,t,n,u){const _={time:[],partial:n},g=t?t.start:e.start,i=t?t.end:e.end,r=e.minEndPTS||i,d=e.maxStartPTS||g;for(let o=0;o<u.length;o++){const l=u.start(o)-this.bufferPadding,c=u.end(o)+this.bufferPadding;if(d>=l&&r<=c){_.time.push({startPTS:Math.max(g,u.start(o)),endPTS:Math.min(i,u.end(o))});break}else if(g<c&&i>l)_.partial=!0,_.time.push({startPTS:Math.max(g,u.start(o)),endPTS:Math.min(i,u.end(o))});else if(i<=l)break}return _}getPartialFragment(e){let t=null,n,u,_,g=0;const{bufferPadding:i,fragments:r}=this;return Object.keys(r).forEach(d=>{const o=r[d];o&&oi(o)&&(u=o.body.start-i,_=o.body.end+i,e>=u&&e<=_&&(n=Math.min(e-u,_-e),g<=n&&(t=o.body,g=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||oi(t))}getState(e){const t=wr(e),n=this.fragments[t];return n?n.buffered?oi(n)?ar.PARTIAL:ar.OK:ar.APPENDING:ar.NOT_LOADED}isTimeBuffered(e,t,n){let u,_;for(let g=0;g<n.length;g++){if(u=n.start(g)-this.bufferPadding,_=n.end(g)+this.bufferPadding,e>=u&&t<=_)return!0;if(t<=u)return!1}return!1}onFragLoaded(e,t){const{frag:n,part:u}=t;if(n.sn==="initSegment"||n.bitrateTest||u)return;const _=wr(n);this.fragments[_]={body:n,appendedPTS:null,loaded:t,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:u,timeRanges:_}=t;let g=this.mainFragEntity;if(n.type===wt.MAIN){const i=g?g.body:null;if(i!==n){g&&i&&i.sn!==n.sn&&(g.buffered=!0,this.fragments[wr(i)]=g);const r=wr(n);g=this.mainFragEntity=this.fragments[r]||{body:n,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)}}if(u){let r=this.activeParts;r||(this.activeParts=r=[]),r.push(u)}else this.activeParts=null}this.timeRanges=_,Object.keys(_).forEach(i=>{const r=_[i];if(this.detectEvictedFragments(i,r),!u&&g){const d=n.elementaryStreams[i];if(!d)return;for(let o=0;o<r.length;o++){const l=r.end(o);l<=d.endPTS&&l>d.startPTS?g.appendedPTS=Math.max(l,g.appendedPTS||0):g.appendedPTS=d.endPTS}}})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=wr(e);return!!this.fragments[t]}removeFragmentsInRange(e,t,n,u,_){u&&!this.hasGaps||Object.keys(this.fragments).forEach(g=>{const i=this.fragments[g];if(!i)return;const r=i.body;r.type!==n||u&&!r.gap||r.start<t&&r.end>e&&(i.buffered||_)&&this.removeFragment(r)})}removeFragment(e){const t=wr(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),this.mainFragEntity===this.fragments[t]&&(this.mainFragEntity=null),delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.mainFragEntity=null,this.activeParts=null,this.hasGaps=!1}}function oi(b){var e,t;return b.buffered&&(b.body.gap||((e=b.range.video)==null?void 0:e.partial)||((t=b.range.audio)==null?void 0:t.partial))}function wr(b){return`${b.type}_${b.level}_${b.urlId}_${b.sn}`}const Ra=Math.pow(2,17);class au{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new xr({type:Nt.NETWORK_ERROR,details:st.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const u=this.config,_=u.fLoader,g=u.loader;return new Promise((i,r)=>{if(this.loader&&this.loader.destroy(),e.gap){r(Ia(e));return}const d=this.loader=e.loader=_?new _(u):new g(u),o=Da(e),l=Aa(u.fragLoadPolicy.default),c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Ra};e.stats=d.stats,d.load(o,c,{onSuccess:(E,m,f,T)=>{this.resetLoader(e,d);let L=E.data;f.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(L.slice(0,16)),L=L.slice(16)),i({frag:e,part:null,payload:L,networkDetails:T})},onError:(E,m,f,T)=>{this.resetLoader(e,d),r(new xr({type:Nt.NETWORK_ERROR,details:st.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:dr({url:n,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:f,stats:T}))},onAbort:(E,m,f)=>{this.resetLoader(e,d),r(new xr({type:Nt.NETWORK_ERROR,details:st.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:f,stats:E}))},onTimeout:(E,m,f)=>{this.resetLoader(e,d),r(new xr({type:Nt.NETWORK_ERROR,details:st.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${c.timeout}ms`),networkDetails:f,stats:E}))},onProgress:(E,m,f,T)=>{t&&t({frag:e,part:null,payload:f,networkDetails:T})}})})}loadPart(e,t,n){this.abort();const u=this.config,_=u.fLoader,g=u.loader;return new Promise((i,r)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){r(Ia(e,t));return}const d=this.loader=e.loader=_?new _(u):new g(u),o=Da(e,t),l=Aa(u.fragLoadPolicy.default),c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ra};t.stats=d.stats,d.load(o,c,{onSuccess:(E,m,f,T)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const L={frag:e,part:t,payload:E.data,networkDetails:T};n(L),i(L)},onError:(E,m,f,T)=>{this.resetLoader(e,d),r(new xr({type:Nt.NETWORK_ERROR,details:st.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:dr({url:o.url,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:f,stats:T}))},onAbort:(E,m,f)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),r(new xr({type:Nt.NETWORK_ERROR,details:st.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:f,stats:E}))},onTimeout:(E,m,f)=>{this.resetLoader(e,d),r(new xr({type:Nt.NETWORK_ERROR,details:st.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${c.timeout}ms`),networkDetails:f,stats:E}))}})})}updateStatsFromPart(e,t){const n=e.stats,u=t.stats,_=u.total;if(n.loaded+=u.loaded,_){const r=Math.round(e.duration/t.duration),d=Math.min(Math.round(n.loaded/_),r),l=(r-d)*Math.round(n.loaded/d);n.total=n.loaded+l}else n.total=Math.max(n.loaded,n.total);const g=n.loading,i=u.loading;g.start?g.first+=i.first-i.start:(g.start=i.start,g.first=i.first),g.end=i.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Da(b,e=null){const t=e||b,n={frag:b,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},u=t.byteRangeStartOffset,_=t.byteRangeEndOffset;if(bt(u)&&bt(_)){var g;let i=u,r=_;if(b.sn==="initSegment"&&((g=b.decryptdata)==null?void 0:g.method)==="AES-128"){const d=_-u;d%16&&(r=_+(16-d%16)),u!==0&&(n.resetIV=!0,i=u-16)}n.rangeStart=i,n.rangeEnd=r}return n}function Ia(b,e){const t=new Error(`GAP ${b.gap?"tag":"attribute"} found`),n={type:Nt.MEDIA_ERROR,details:st.FRAG_GAP,fatal:!1,frag:b,error:t,networkDetails:null};return e&&(n.part=e),(e||b).stats.aborted=!0,new xr(n)}class xr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class su{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.abort()}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=st.KEY_LOAD_ERROR,n,u,_){return new xr({type:Nt.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:_,error:n,networkDetails:u})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:n,cc:u}=e;for(let _=0;_<t.length;_++){const g=t[_];if(u<=g.cc&&(n==="initSegment"||g.sn==="initSegment"||n<g.sn)){this.emeController.selectKeySystemFormat(g).then(i=>{g.setKeyFormat(i)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,u;t&&e.setKeyFormat(t);const _=e.decryptdata;if(!_){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,st.KEY_LOAD_ERROR,d))}const g=_.uri;if(!g)return Promise.reject(this.createKeyLoadError(e,st.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${g}"`)));let i=this.keyUriToKeyInfo[g];if((n=i)!=null&&n.decryptdata.key)return _.key=i.decryptdata.key,Promise.resolve({frag:e,keyInfo:i});if((u=i)!=null&&u.keyLoadPromise){var r;switch((r=i.mediaKeySessionContext)==null?void 0:r.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return i.keyLoadPromise.then(d=>(_.key=d.keyInfo.decryptdata.key,{frag:e,keyInfo:i}))}}switch(i=this.keyUriToKeyInfo[g]={decryptdata:_,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},_.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return _.keyFormat==="identity"?this.loadKeyHTTP(i,e):this.loadKeyEME(i,e);case"AES-128":return this.loadKeyHTTP(i,e);default:return Promise.reject(this.createKeyLoadError(e,st.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${_.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const u=this.emeController.loadKey(n);if(u)return(e.keyLoadPromise=u.then(_=>(e.mediaKeySessionContext=_,n))).catch(_=>{throw e.keyLoadPromise=null,_})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,u=n.loader,_=new u(n);return t.keyLoader=e.loader=_,e.keyLoadPromise=new Promise((g,i)=>{const r={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=n.keyLoadPolicy.default,o={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},l={onSuccess:(c,E,m,f)=>{const{frag:T,keyInfo:L,url:P}=m;if(!T.decryptdata||L!==this.keyUriToKeyInfo[P])return i(this.createKeyLoadError(T,st.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),f));L.decryptdata.key=T.decryptdata.key=new Uint8Array(c.data),T.keyLoader=null,L.loader=null,g({frag:T,keyInfo:L})},onError:(c,E,m,f)=>{this.resetLoader(E),i(this.createKeyLoadError(t,st.KEY_LOAD_ERROR,new Error(`HTTP Error ${c.code} loading key ${c.text}`),m,dr({url:r.url,data:void 0},c)))},onTimeout:(c,E,m)=>{this.resetLoader(E),i(this.createKeyLoadError(t,st.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(c,E,m)=>{this.resetLoader(E),i(this.createKeyLoadError(t,st.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};_.load(r,o,l)})}resetLoader(e){const{frag:t,keyInfo:n,url:u}=e,_=n.loader;t.keyLoader===_&&(t.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[u],_&&_.destroy()}}class ou{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const lu={length:0,start:()=>0,end:()=>0};class Jt{static isBuffered(e,t){try{if(e){const n=Jt.getBuffered(e);for(let u=0;u<n.length;u++)if(t>=n.start(u)&&t<=n.end(u))return!0}}catch{}return!1}static bufferInfo(e,t,n){try{if(e){const u=Jt.getBuffered(e),_=[];let g;for(g=0;g<u.length;g++)_.push({start:u.start(g),end:u.end(g)});return this.bufferedInfo(_,t,n)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.sort(function(d,o){const l=d.start-o.start;return l||o.end-d.end});let u=[];if(n)for(let d=0;d<e.length;d++){const o=u.length;if(o){const l=u[o-1].end;e[d].start-l<n?e[d].end>l&&(u[o-1].end=e[d].end):u.push(e[d])}else u.push(e[d])}else u=e;let _=0,g,i=t,r=t;for(let d=0;d<u.length;d++){const o=u[d].start,l=u[d].end;if(t+n>=o&&t<l)i=o,r=l,_=r-t;else if(t+n<o){g=o;break}}return{len:_,start:i||0,end:r||0,nextStart:g}}static getBuffered(e){try{return e.buffered}catch(t){return je.log("failed to get media.buffered",t),lu}}}class Ui{constructor(e,t,n,u=0,_=-1,g=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Dn(),this.buffering={audio:Dn(),video:Dn(),audiovideo:Dn()},this.level=e,this.sn=t,this.id=n,this.size=u,this.part=_,this.partial=g}}function Dn(){return{start:0,executeStart:0,executeEnd:0,end:0}}function _s(b,e){let t=null;for(let n=0,u=b.length;n<u;n++){const _=b[n];if(_&&_.cc===e){t=_;break}}return t}function uu(b,e,t){return!!(e.details&&(t.endCC>t.startCC||b&&b.cc<t.startCC))}function fu(b,e,t=0){const n=b.fragments,u=e.fragments;if(!u.length||!n.length){je.log("No fragments to align");return}const _=_s(n,u[0].cc);if(!_||_&&!_.startPTS){je.log("No frag in previous level to align on");return}return _}function Ca(b,e){if(b){const t=b.start+e;b.start=b.startPTS=t,b.endPTS=t+b.duration}}function ki(b,e){const t=e.fragments;for(let n=0,u=t.length;n<u;n++)Ca(t[n],b);e.fragmentHint&&Ca(e.fragmentHint,b),e.alignedSliding=!0}function cu(b,e,t){e&&(du(b,t,e),!t.alignedSliding&&e.details&&hu(t,e.details),!t.alignedSliding&&e.details&&!t.skippedSegments&&gs(e.details,t))}function du(b,e,t){if(uu(b,t,e)){const n=fu(t.details,e);n&&bt(n.start)&&(je.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),ki(n.start,e))}}function hu(b,e){if(!e.fragments.length||!b.hasProgramDateTime||!e.hasProgramDateTime)return;const t=e.fragments[0].programDateTime,n=b.fragments[0].programDateTime,u=(n-t)/1e3+e.fragments[0].start;u&&bt(u)&&(je.log(`Adjusting PTS using programDateTime delta ${n-t}ms, sliding:${u.toFixed(3)} ${b.url} `),ki(u,b))}function vs(b,e){if(!b.hasProgramDateTime||!e.hasProgramDateTime)return;const t=b.fragments,n=e.fragments;if(!t.length||!n.length)return;const u=Math.round(n.length/2)-1,_=n[u],g=_s(t,_.cc)||t[Math.round(t.length/2)-1],i=_.programDateTime,r=g.programDateTime;if(i===null||r===null)return;const d=(r-i)/1e3-(g.start-_.start);ki(d,b)}class gu{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class mu{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function Eu(b){const e=b.byteLength,t=e&&new DataView(b.buffer).getUint8(e-1);return t?$r(b,0,e-t):b}class _u{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let u=0;u<4;u++)n[u]=t.getUint32(u*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,u=n[0],_=n[1],g=n[2],i=n[3],r=this.invSubMix,d=r[0],o=r[1],l=r[2],c=r[3],E=new Uint32Array(256);let m=0,f=0,T=0;for(T=0;T<256;T++)T<128?E[T]=T<<1:E[T]=T<<1^283;for(T=0;T<256;T++){let L=f^f<<1^f<<2^f<<3^f<<4;L=L>>>8^L&255^99,e[m]=L,t[L]=m;const P=E[m],O=E[P],M=E[O];let S=E[L]*257^L*16843008;u[m]=S<<24|S>>>8,_[m]=S<<16|S>>>16,g[m]=S<<8|S>>>24,i[m]=S,S=M*16843009^O*65537^P*257^m*16843008,d[L]=S<<24|S>>>8,o[L]=S<<16|S>>>16,l[L]=S<<8|S>>>24,c[L]=S,m?(m=P^E[E[E[M^P]]],f^=E[E[f]]):m=f=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,u=0;for(;u<t.length&&n;)n=t[u]===this.key[u],u++;if(n)return;this.key=t;const _=this.keySize=t.length;if(_!==4&&_!==6&&_!==8)throw new Error("Invalid aes key size="+_);const g=this.ksRows=(_+6+1)*4;let i,r;const d=this.keySchedule=new Uint32Array(g),o=this.invKeySchedule=new Uint32Array(g),l=this.sBox,c=this.rcon,E=this.invSubMix,m=E[0],f=E[1],T=E[2],L=E[3];let P,O;for(i=0;i<g;i++){if(i<_){P=d[i]=t[i];continue}O=P,i%_===0?(O=O<<8|O>>>24,O=l[O>>>24]<<24|l[O>>>16&255]<<16|l[O>>>8&255]<<8|l[O&255],O^=c[i/_|0]<<24):_>6&&i%_===4&&(O=l[O>>>24]<<24|l[O>>>16&255]<<16|l[O>>>8&255]<<8|l[O&255]),d[i]=P=(d[i-_]^O)>>>0}for(r=0;r<g;r++)i=g-r,r&3?O=d[i]:O=d[i-4],r<4||i<=4?o[r]=O:o[r]=m[l[O>>>24]]^f[l[O>>>16&255]]^T[l[O>>>8&255]]^L[l[O&255]],o[r]=o[r]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const u=this.keySize+6,_=this.invKeySchedule,g=this.invSBox,i=this.invSubMix,r=i[0],d=i[1],o=i[2],l=i[3],c=this.uint8ArrayToUint32Array_(n);let E=c[0],m=c[1],f=c[2],T=c[3];const L=new Int32Array(e),P=new Int32Array(L.length);let O,M,S,p,h,C,v,I,D,y,A,x,F,k;const W=this.networkToHostOrderSwap;for(;t<L.length;){for(D=W(L[t]),y=W(L[t+1]),A=W(L[t+2]),x=W(L[t+3]),h=D^_[0],C=x^_[1],v=A^_[2],I=y^_[3],F=4,k=1;k<u;k++)O=r[h>>>24]^d[C>>16&255]^o[v>>8&255]^l[I&255]^_[F],M=r[C>>>24]^d[v>>16&255]^o[I>>8&255]^l[h&255]^_[F+1],S=r[v>>>24]^d[I>>16&255]^o[h>>8&255]^l[C&255]^_[F+2],p=r[I>>>24]^d[h>>16&255]^o[C>>8&255]^l[v&255]^_[F+3],h=O,C=M,v=S,I=p,F=F+4;O=g[h>>>24]<<24^g[C>>16&255]<<16^g[v>>8&255]<<8^g[I&255]^_[F],M=g[C>>>24]<<24^g[v>>16&255]<<16^g[I>>8&255]<<8^g[h&255]^_[F+1],S=g[v>>>24]<<24^g[I>>16&255]<<16^g[h>>8&255]<<8^g[C&255]^_[F+2],p=g[I>>>24]<<24^g[h>>16&255]<<16^g[C>>8&255]<<8^g[v&255]^_[F+3],P[t]=W(O^E),P[t+1]=W(p^m),P[t+2]=W(S^f),P[t+3]=W(M^T),E=D,m=y,f=A,T=x,t=t+4}return P.buffer}}const vu=16;class Ki{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Eu(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n){return this.useSoftware?new Promise((u,_)=>{this.softwareDecrypt(new Uint8Array(e),t,n);const g=this.flush();g?u(g.buffer):_(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n)}softwareDecrypt(e,t,n){const{currentIV:u,currentResult:_,remainderData:g}=this;this.logOnce("JS AES decrypt"),g&&(e=Xr(g,e),this.remainderData=null);const i=this.getValidChunk(e);if(!i.length)return null;u&&(n=u);let r=this.softwareDecrypter;r||(r=this.softwareDecrypter=new _u),r.expandKey(t);const d=_;return this.currentResult=r.decrypt(i.buffer,0,n),this.currentIV=$r(i,-16).buffer,d||null}webCryptoDecrypt(e,t,n){const u=this.subtle;return(this.key!==t||!this.fastAesKey)&&(this.key=t,this.fastAesKey=new mu(u,t)),this.fastAesKey.expandKey().then(_=>u?(this.logOnce("WebCrypto AES decrypt"),new gu(u,new Uint8Array(n)).decrypt(e.buffer,_)):Promise.reject(new Error("web crypto not initialized"))).catch(_=>(je.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${_.name}: ${_.message}`),this.onWebCryptoError(e,t,n)))}onWebCryptoError(e,t,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n);const u=this.flush();if(u)return u.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%vu;return n!==e.length&&(t=$r(e,0,n),this.remainderData=$r(e,n)),t}logOnce(e){this.logEnabled&&(je.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const pu={toString:function(b){let e="";const t=b.length;for(let n=0;n<t;n++)e+=`[${b.start(n).toFixed(3)}-${b.end(n).toFixed(3)}]`;return e}},gt={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Wi extends ou{constructor(e,t,n,u,_){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=gt.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=_,this.logPrefix=u,this.log=je.log.bind(je,`${u}:`),this.warn=je.warn.bind(je,`${u}:`),this.hls=e,this.fragmentLoader=new au(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ki(e.config),e.on(Ee.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort();const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=gt.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const n=t.partList;if(n!=null&&n.length){const _=n[n.length-1];return Jt.isBuffered(this.media,_.start+_.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levels[this.levelLastLoaded])==null?void 0:e.details}}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);const u=this.config;this.levels&&u.autoStartLoad&&this.state===gt.STOPPED&&this.startLoad(u.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:n,mediaBuffer:u,state:_}=this,g=n?n.currentTime:0,i=Jt.bufferInfo(u||n,g,e.maxBufferHole);if(this.log(`media seeking to ${bt(g)?g.toFixed(3):g}, state: ${_}`),this.state===gt.ENDED)this.resetLoadingState();else if(t){const r=e.maxFragLookUpTolerance,d=t.start-r,o=t.start+t.duration+r;if(!i.len||o<i.start||d>i.end){const l=g>o;(g<d||l)&&(l&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests()),this.resetLoadingState())}}n&&(this.fragmentTracker.removeFragmentsInRange(g,1/0,this.playlistType,!0),this.lastCurrentTime=g),!this.loadedmetadata&&!i.len&&(this.nextLoadPosition=this.startPosition=g),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=gt.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const u=_=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${_.part?" p: "+_.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(_)};this._doFragLoad(e,t,n,u).then(_=>{if(!_)return;const g=this.state;if(this.fragContextChanged(e)){(g===gt.FRAG_LOADING||!this.fragCurrent&&g===gt.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=gt.IDLE);return}"payload"in _&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(Ee.FRAG_LOADED,_)),this._handleFragmentLoadComplete(_)}).catch(_=>{this.state===gt.STOPPED||this.state===gt.ERROR||(this.warn(_),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;if(this.fragmentTracker.getState(e)===ar.APPENDING){const u=e.type,_=this.getFwdBufferInfo(this.mediaBuffer,u),g=Math.max(e.duration,_?_.len:this.config.maxBufferLength);this.reduceMaxBufferLength(g)&&this.fragmentTracker.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0&&this.fragmentTracker.removeAllFragments()}flushMainBuffer(e,t,n=null){if(!(e-t))return;const u={startOffset:e,endOffset:t,type:n};this.hls.trigger(Ee.BUFFER_FLUSHING,u)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{if(!n||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:u}=this,{payload:_}=n,g=e.decryptdata;if(_&&_.byteLength>0&&g&&g.key&&g.iv&&g.method==="AES-128"){const i=self.performance.now();return this.decrypter.decrypt(new Uint8Array(_),g.key.buffer,g.iv.buffer).catch(r=>{throw u.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.FRAG_DECRYPT_ERROR,fatal:!1,error:r,reason:r.message,frag:e}),r}).then(r=>{const d=self.performance.now();return u.trigger(Ee.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:i,tdecrypt:d}}),n.payload=r,n})}return n}).then(n=>{const{fragCurrent:u,hls:_,levels:g}=this;if(!g)throw new Error("init load aborted, missing levels");const i=e.stats;this.state=gt.IDLE,t.fragmentError=0,e.data=new Uint8Array(n.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),n.frag===u&&_.trigger(Ee.FRAG_BUFFERED,{stats:i,frag:u,part:null,id:e.type}),this.tick()}).catch(n=>{this.state===gt.STOPPED||this.state===gt.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var n,u,_,g;const i=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level} (frag:[${((n=e.startPTS)!=null?n:NaN).toFixed(3)}-${((u=e.endPTS)!=null?u:NaN).toFixed(3)}] > buffer:${i?pu.toString(Jt.getBuffered(i)):"(detached)"})`),this.state=gt.IDLE,i&&(!this.loadedmetadata&&e.type==wt.MAIN&&i.buffered.length&&((_=this.fragCurrent)==null?void 0:_.sn)===((g=this.fragPrevious)==null?void 0:g.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:u,partsLoaded:_}=e,g=!_||_.length===0||_.some(r=>!r),i=new Ui(n.level,n.sn,n.stats.chunkCount+1,0,u?u.index:-1,!g);t.flush(i)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,u){var _;const g=t==null?void 0:t.details;if(!this.levels||!g)throw new Error(`frag load aborted, missing level${g?"":" detail"}s`);let i=null;if(e.encrypted&&!((_=e.decryptdata)!=null&&_.key)?(this.log(`Loading key for ${e.sn} of [${g.startSN}-${g.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=gt.KEY_LOADING,this.fragCurrent=e,i=this.keyLoader.load(e).then(o=>{if(!this.fragContextChanged(o.frag))return this.hls.trigger(Ee.KEY_LOADED,o),this.state===gt.KEY_LOADING&&(this.state=gt.IDLE),o}),this.hls.trigger(Ee.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(i=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&g.encryptedFragments.length&&this.keyLoader.loadClear(e,g.encryptedFragments),n=Math.max(e.start,n||0),this.config.lowLatencyMode){const o=g.partList;if(o&&u){n>e.end&&g.fragmentHint&&(e=g.fragmentHint);const l=this.getNextPart(o,e,n);if(l>-1){const c=o[l];this.log(`Loading part sn: ${e.sn} p: ${c.index} cc: ${e.cc} of playlist [${g.startSN}-${g.endSN}] parts [0-${l}-${o.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=c.start+c.duration,this.state=gt.FRAG_LOADING;let E;return i?E=i.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(e,c,t,u)).catch(m=>this.handleFragLoadError(m)):E=this.doFragPartsLoad(e,c,t,u).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(Ee.FRAG_LOADING,{frag:e,part:c,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(o,n))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${g?"of ["+g.startSN+"-"+g.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),bt(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=gt.FRAG_LOADING;const r=this.config.progressive;let d;return r&&i?d=i.then(o=>!o||this.fragContextChanged(o==null?void 0:o.frag)?null:this.fragmentLoader.load(e,u)).catch(o=>this.handleFragLoadError(o)):d=Promise.all([this.fragmentLoader.load(e,r?u:void 0),i]).then(([o])=>(!r&&o&&u&&u(o),o)).catch(o=>this.handleFragLoadError(o)),this.hls.trigger(Ee.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,n,u){return new Promise((_,g)=>{var i;const r=[],d=(i=n.details)==null?void 0:i.partList,o=l=>{this.fragmentLoader.loadPart(e,l,u).then(c=>{r[l.index]=c;const E=c.part;this.hls.trigger(Ee.FRAG_LOADED,c);const m=Ta(n,e.sn,l.index+1)||ms(d,e.sn,l.index+1);if(m)o(m);else return _({frag:e,part:E,partsLoaded:r})}).catch(g)};o(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===st.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(Ee.ERROR,t)}else this.hls.trigger(Ee.ERROR,{type:Nt.OTHER_ERROR,details:st.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==gt.PARSING){!this.fragCurrent&&this.state!==gt.STOPPED&&this.state!==gt.ERROR&&(this.state=gt.IDLE);return}const{frag:n,part:u,level:_}=t,g=self.performance.now();n.stats.parsing.end=g,u&&(u.stats.parsing.end=g),this.updateLevelTiming(n,u,_,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:u,sn:_,part:g}=e;if(!(t!=null&&t[u]))return this.warn(`Levels object was unset while buffering fragment ${_} of level ${u}. The current chunk will not be buffered.`),null;const i=t[u],r=g>-1?Ta(i,_,g):null,d=r?r.fragment:Xl(i,_,n);return d?(n&&n!==d&&(d.stats=n.stats),{frag:d,part:r,level:i}):null}bufferFragmentData(e,t,n,u){var _;if(!e||this.state!==gt.PARSING)return;const{data1:g,data2:i}=e;let r=g;if(g&&i&&(r=Xr(g,i)),!((_=r)!=null&&_.length))return;const d={type:e.type,frag:t,part:n,chunkMeta:u,parent:t.type,data:r};this.hls.trigger(Ee.BUFFER_APPENDING,d),e.dropped&&e.independent&&!n&&this.flushBufferGap(t)}flushBufferGap(e){const t=this.media;if(!t)return;if(!Jt.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,u=Jt.bufferInfo(t,n,0),_=e.duration,g=Math.min(this.config.maxFragLookUpTolerance*2,_*.25),i=Math.max(Math.min(e.start-g,u.end-g),n+g);e.start-i>g&&this.flushMainBuffer(i,e.start)}getFwdBufferInfo(e,t){const n=this.getLoadPosition();return bt(n)?this.getFwdBufferInfoAtPos(e,n,t):null}getFwdBufferInfoAtPos(e,t,n){const{config:{maxBufferHole:u}}=this,_=Jt.bufferInfo(e,t,u);if(_.len===0&&_.nextStart!==void 0){const g=this.fragmentTracker.getBufferedFrag(t,n);if(g&&_.nextStart<g.end)return Jt.bufferInfo(e,t,Math.max(_.nextStart,u))}return _}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,n=e||t.maxBufferLength;return t.maxMaxBufferLength>=n?(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0):!1}getNextFragment(e,t){const n=t.fragments,u=n.length;if(!u)return null;const{config:_}=this,g=n[0].start;let i;if(t.live){const r=_.initialLiveManifestSize;if(u<r)return this.warn(`Not enough fragments to start playback (have: ${u}, need: ${r})`),null;!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(i=this.getInitialLiveFragment(t,n),this.startPosition=i?this.hls.liveSyncPosition||i.start:e)}else e<=g&&(i=n[0]);if(!i){const r=_.lowLatencyMode?t.partEnd:t.fragmentEnd;i=this.getFragmentAtPosition(e,r,t)}return this.mapToInitFragWhenRequired(i)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===ar.OK||n===ar.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,u,_){const g=e.gap,i=this.getNextFragment(this.nextLoadPosition,t);if(i===null)return i;if(e=i,g&&e&&!e.gap&&n.nextStart){const r=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,u);if(r!==null&&n.len+r.len>=_)return this.log(`buffer full after gaps in "${u}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let u=-1,_=!1,g=!0;for(let i=0,r=e.length;i<r;i++){const d=e[i];if(g=g&&!d.independent,u>-1&&n<d.start)break;const o=d.loaded;o?u=-1:(_||d.independent||g)&&d.fragment===t&&(u=i),_=o}return u}loadedEndOfParts(e,t){const n=e[e.length-1];return n&&t>n.start&&n.loaded}getInitialLiveFragment(e,t){const n=this.fragPrevious;let u=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),u=Jl(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!u){const _=n.sn+1;if(_>=e.startSN&&_<=e.endSN){const g=t[_-e.startSN];n.cc===g.cc&&(u=g,this.log(`Live playlist, switching playlist, load frag with next SN: ${u.sn}`))}u||(u=ql(t,n.cc),u&&this.log(`Live playlist, switching playlist, load frag with same CC: ${u.sn}`))}}else{const _=this.hls.liveSyncPosition;_!==null&&(u=this.getFragmentAtPosition(_,this.bitrateTest?e.fragmentEnd:e.edge,e))}return u}getFragmentAtPosition(e,t,n){const{config:u}=this;let{fragPrevious:_}=this,{fragments:g,endSN:i}=n;const{fragmentHint:r}=n,d=u.maxFragLookUpTolerance,o=!!(u.lowLatencyMode&&n.partList&&r);o&&r&&!this.bitrateTest&&(g=g.concat(r),i=r.sn);let l;if(e<t){const c=e>t-d?0:d;l=En(_,g,e,c)}else l=g[g.length-1];if(l){const c=l.sn-n.startSN,E=this.fragmentTracker.getState(l);if((E===ar.OK||E===ar.PARTIAL&&l.gap)&&(_=l),_&&l.sn===_.sn&&!o&&_&&l.level===_.level){const f=g[c+1];l.sn<i&&this.fragmentTracker.getState(f)!==ar.OK?l=f:l=null}}return l}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const u=this.hls.liveSyncPosition,_=n.currentTime,g=e.fragments[0].start,i=e.edge,r=_>=g-t.maxFragLookUpTolerance&&_<=i;if(u!==null&&n.duration>u&&(_<u||!r)){const d=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!r&&n.readyState<4||_<i-d)&&(this.loadedmetadata||(this.nextLoadPosition=u),n.readyState&&(this.warn(`Playback: ${_.toFixed(3)} is located too far from the end of live sliding playlist: ${i}, reset currentTime to : ${u.toFixed(3)}`),n.currentTime=u))}}alignPlaylists(e,t){const{levels:n,levelLastLoaded:u,fragPrevious:_}=this,g=u!==null?n[u]:null,i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragments[0].start,d=!t,o=e.alignedSliding&&bt(r);if(d||!o&&!r){cu(_,g,e);const l=e.fragments[0].start;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${_?_.sn:"na"} fragments: ${i}`),l}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;if(n<t&&(n=-1),n===-1||this.lastCurrentTime===-1){const u=this.startTimeOffset!==null,_=u?this.startTimeOffset:e.startTimeOffset;_!==null&&bt(_)?(n=t+_,_<0&&(n+=e.totalduration),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Start time offset ${_} found in ${u?"multivariant":"media"} playlist, adjust startPosition to ${n}`),this.startPosition=n):e.live?n=this.hls.liveSyncPosition||t:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part"+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==gt.FRAG_LOADING_WAITING_RETRY)&&(this.state=gt.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const o=this.getCurrentContext(t.chunkMeta);o&&(t.frag=o.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var u;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(u=this.fragCurrent)==null?void 0:u.url}`);return}const _=t.details===st.FRAG_GAP;_&&this.fragmentTracker.fragBuffered(n,!0);const g=t.errorAction,{action:i,retryCount:r=0,retryConfig:d}=g||{};if(g&&i===fr.RetryRequest&&d){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);const o=wi(d,r);this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${r+1}/${d.maxNumRetry} in ${o}ms`),g.resolved=!0,this.retryDate=self.performance.now()+o,this.state=gt.FRAG_LOADING_WAITING_RETRY}else d&&g?(this.resetFragmentErrors(e),r<d.maxNumRetry?_||(g.resolved=!0):je.warn(`${t.details} reached or exceeded max retry (${r})`)):this.state=gt.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===gt.PARSING||this.state===gt.PARSED){const t=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,t),u=n&&n.len>.5;u&&this.reduceMaxBufferLength(n.len);const _=!u;return _&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),_}return!1}resetFragmentErrors(e){e===wt.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==gt.STOPPED&&(this.state=gt.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const u=Jt.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,u,n),this.state===gt.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=gt.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=this.levels?this.levels[e].details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,u){var _;const g=n.details;if(!g){this.warn("level.details undefined");return}if(Object.keys(e.elementaryStreams).reduce((r,d)=>{const o=e.elementaryStreams[d];if(o){const l=o.endPTS-o.startPTS;if(l<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${l})`),r||!1;const c=u?0:hs(g,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return this.hls.trigger(Ee.LEVEL_PTS_UPDATED,{details:g,level:n,drift:c,type:d,frag:e,start:o.startPTS,end:o.endPTS}),!0}return r},!1))n.fragmentError=0;else if(((_=this.transmuxer)==null?void 0:_.error)===null){const r=new Error(`Found no media in fragment ${e.sn} of level ${n.id} resetting transmuxer to fallback to playlist timing`);if(this.warn(r.message),this.hls.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,fatal:!1,error:r,frag:e,reason:`Found no media in msn ${e.sn} of level "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=gt.PARSED,this.hls.trigger(Ee.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.resetTransmuxer(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function ji(){if(!(typeof self>"u"))return self.MediaSource||self.WebKitMediaSource}function ps(){return self.SourceBuffer||self.WebKitSourceBuffer}function Tu(){const b=ji();if(!b)return!1;const e=ps(),t=b&&typeof b.isTypeSupported=="function"&&b.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function";return!!t&&!!n}function yu(){var b;const e=ps();return typeof(e==null||(b=e.prototype)==null?void 0:b.changeType)=="function"}function Au(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Su(){const b=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(b);return{worker:new self.Worker(e),objectURL:e}}function Ru(b){const e=new self.URL(b,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function Ir(b="",e=9e4){return{type:b,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Ts{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,u){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Xr(this.cachedData,e),this.cachedData=null);let n=xn(e,0),u=n?n.length:0,_;const g=this._audioTrack,i=this._id3Track,r=n?sl(n):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&bt(r))&&(this.basePTS=Du(r,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&i.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:pr.audioId3,duration:Number.POSITIVE_INFINITY});u<d;){if(this.canParse(e,u)){const o=this.appendFrame(g,e,u);o?(this.frameIndex++,this.lastPTS=o.sample.pts,u+=o.length,_=u):u=d}else al(e,u)?(n=xn(e,u),i.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:pr.audioId3,duration:Number.POSITIVE_INFINITY}),u+=n.length,_=u):u++;if(u===d&&_!==d){const o=$r(e,_);this.cachedData?this.cachedData=Xr(this.cachedData,o):this.cachedData=o}}return{audioTrack:g,videoTrack:Ir(),id3Track:i,textTrack:Ir()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Ir(),id3Track:this._id3Track,textTrack:Ir()}}destroy(){}}const Du=(b,e,t)=>{if(bt(b))return b*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};function Iu(b,e,t,n){let u,_,g,i;const r=navigator.userAgent.toLowerCase(),d=n,o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];u=((e[t+2]&192)>>>6)+1;const l=(e[t+2]&60)>>>2;if(l>o.length-1){b.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${l}`});return}return g=(e[t+2]&1)<<2,g|=(e[t+3]&192)>>>6,je.log(`manifest codec:${n}, ADTS type:${u}, samplingIndex:${l}`),/firefox/i.test(r)?l>=6?(u=5,i=new Array(4),_=l-3):(u=2,i=new Array(2),_=l):r.indexOf("android")!==-1?(u=2,i=new Array(2),_=l):(u=5,i=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&l>=6?_=l-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(l>=6&&g===1||/vivaldi/i.test(r))||!n&&g===1)&&(u=2,i=new Array(2)),_=l)),i[0]=u<<3,i[0]|=(l&14)>>1,i[1]|=(l&1)<<7,i[1]|=g<<3,u===5&&(i[1]|=(_&14)>>1,i[2]=(_&1)<<7,i[2]|=2<<2,i[3]=0),{config:i,samplerate:o[l],channelCount:g,codec:"mp4a.40."+u,manifestCodec:d}}function ys(b,e){return b[e]===255&&(b[e+1]&246)===240}function As(b,e){return b[e+1]&1?7:9}function Gi(b,e){return(b[e+3]&3)<<11|b[e+4]<<3|(b[e+5]&224)>>>5}function Cu(b,e){return e+5<b.length}function Un(b,e){return e+1<b.length&&ys(b,e)}function Pu(b,e){return Cu(b,e)&&ys(b,e)&&Gi(b,e)<=b.length-e}function Mu(b,e){if(Un(b,e)){const t=As(b,e);if(e+t>=b.length)return!1;const n=Gi(b,e);if(n<=t)return!1;const u=e+n;return u===b.length||Un(b,u)}return!1}function Ss(b,e,t,n,u){if(!b.samplerate){const _=Iu(e,t,n,u);if(!_)return;b.config=_.config,b.samplerate=_.samplerate,b.channelCount=_.channelCount,b.codec=_.codec,b.manifestCodec=_.manifestCodec,je.log(`parsed codec:${b.codec}, rate:${_.samplerate}, channels:${_.channelCount}`)}}function Rs(b){return 1024*9e4/b}function Lu(b,e){const t=As(b,e);if(e+t<=b.length){const n=Gi(b,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function Ds(b,e,t,n,u){const _=Rs(b.samplerate),g=n+u*_,i=Lu(e,t);let r;if(i){const{frameLength:l,headerLength:c}=i,E=c+l,m=Math.max(0,t+E-e.length);m?(r=new Uint8Array(E-c),r.set(e.subarray(t+c,e.length),0)):r=e.subarray(t+c,t+E);const f={unit:r,pts:g};return m||b.samples.push(f),{sample:f,length:E,missing:m}}const d=e.length-t;return r=new Uint8Array(d),r.set(e.subarray(t,e.length),0),{sample:{unit:r,pts:g},length:d,missing:-1}}class Ou extends Ts{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,u){super.resetInitSegment(e,t,n,u),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:u,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let n=(xn(e,0)||[]).length;for(let u=e.length;n<u;n++)if(Mu(e,n))return je.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Pu(e,t)}appendFrame(e,t,n){Ss(e,this.observer,t,n,e.manifestCodec);const u=Ds(e,t,n,this.basePTS,this.frameIndex);if(u&&u.missing===0)return u}}const bu=/\/emsg[-/]ID3/i;class xu{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,u){const _=this.videoTrack=Ir("video",1),g=this.audioTrack=Ir("audio",1),i=this.txtTrack=Ir("text",1);if(this.id3Track=Ir("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const r=ss(e);if(r.video){const{id:d,timescale:o,codec:l}=r.video;_.id=d,_.timescale=i.timescale=o,_.codec=l}if(r.audio){const{id:d,timescale:o,codec:l}=r.audio;g.id=d,g.timescale=o,g.codec=l}i.id=ns.text,_.sampleDuration=0,_.duration=g.duration=u}resetContiguity(){}static probe(e){return e=e.length>16384?e.subarray(0,16384):e,Yt(e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let n=e;const u=this.videoTrack,_=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Xr(this.remainderData,e));const i=yl(n);this.remainderData=i.remainder,u.samples=i.valid||new Uint8Array}else u.samples=n;const g=this.extractID3Track(u,t);return _.samples=sa(t,u),{videoTrack:u,audioTrack:this.audioTrack,id3Track:g,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const u=this.extractID3Track(t,this.timeOffset);return n.samples=sa(e,t),{videoTrack:t,audioTrack:Ir(),id3Track:u,textTrack:Ir()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const u=Yt(e.samples,["emsg"]);u&&u.forEach(_=>{const g=Rl(_);if(bu.test(g.schemeIdUri)){const i=bt(g.presentationTime)?g.presentationTime/g.timeScale:t+g.presentationTimeDelta/g.timeScale;let r=g.eventDuration===4294967295?Number.POSITIVE_INFINITY:g.eventDuration/g.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const d=g.payload;n.samples.push({data:d,len:d.byteLength,dts:i,pts:i,type:pr.emsg,duration:r})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}let In=null;const Nu=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Fu=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],wu=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Bu=[0,1,1,4];function Is(b,e,t,n,u){if(t+24>e.length)return;const _=Cs(e,t);if(_&&t+_.frameLength<=e.length){const g=_.samplesPerFrame*9e4/_.sampleRate,i=n+u*g,r={unit:e.subarray(t,t+_.frameLength),pts:i,dts:i};return b.config=[],b.channelCount=_.channelCount,b.samplerate=_.sampleRate,b.samples.push(r),{sample:r,length:_.frameLength,missing:0}}}function Cs(b,e){const t=b[e+1]>>3&3,n=b[e+1]>>1&3,u=b[e+2]>>4&15,_=b[e+2]>>2&3;if(t!==1&&u!==0&&u!==15&&_!==3){const g=b[e+2]>>1&1,i=b[e+3]>>6,r=t===3?3-n:n===3?3:4,d=Nu[r*14+u-1]*1e3,l=Fu[(t===3?0:t===2?1:2)*3+_],c=i===3?1:2,E=wu[t][n],m=Bu[n],f=E*8*m,T=Math.floor(E*d/l+g)*m;if(In===null){const O=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);In=O?parseInt(O[1]):0}return!!In&&In<=87&&n===2&&d>=224e3&&i===0&&(b[e+3]=b[e+3]|128),{sampleRate:l,channelCount:c,frameLength:T,samplesPerFrame:f}}}function Hi(b,e){return b[e]===255&&(b[e+1]&224)===224&&(b[e+1]&6)!==0}function Ps(b,e){return e+1<b.length&&Hi(b,e)}function Uu(b,e){return Hi(b,e)&&4<=b.length-e}function ku(b,e){if(e+1<b.length&&Hi(b,e)){const n=Cs(b,e);let u=4;n!=null&&n.frameLength&&(u=n.frameLength);const _=e+u;return _===b.length||Ps(b,_)}return!1}class Pa{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,u=new Uint8Array(4),_=Math.min(4,t);if(_===0)throw new Error("no bytes available");u.set(e.subarray(n,n+_)),this.word=new DataView(u.buffer).getUint32(0),this.bitsAvailable=_*8,this.bytesAvailable-=_}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&je.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,n=8,u;for(let _=0;_<e;_++)n!==0&&(u=this.readEG(),n=(t+u+256)%256),t=n===0?t:n}readSPS(){let e=0,t=0,n=0,u=0,_,g,i;const r=this.readUByte.bind(this),d=this.readBits.bind(this),o=this.readUEG.bind(this),l=this.readBoolean.bind(this),c=this.skipBits.bind(this),E=this.skipEG.bind(this),m=this.skipUEG.bind(this),f=this.skipScalingList.bind(this);r();const T=r();if(d(5),c(3),r(),m(),T===100||T===110||T===122||T===244||T===44||T===83||T===86||T===118||T===128){const p=o();if(p===3&&c(1),m(),m(),c(1),l())for(g=p!==3?8:12,i=0;i<g;i++)l()&&(i<6?f(16):f(64))}m();const L=o();if(L===0)o();else if(L===1)for(c(1),E(),E(),_=o(),i=0;i<_;i++)E();m(),c(1);const P=o(),O=o(),M=d(1);M===0&&c(1),c(1),l()&&(e=o(),t=o(),n=o(),u=o());let S=[1,1];if(l()&&l())switch(r()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:{S=[r()<<8|r(),r()<<8|r()];break}}return{width:Math.ceil((P+1)*16-e*2-t*2),height:(2-M)*(O+1)*16-(M?2:4)*(n+u),pixelRatio:S}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Ku{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Ki(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,n){const u=e[t].unit;if(u.length<=16)return;const _=u.subarray(16,u.length-u.length%16),g=_.buffer.slice(_.byteOffset,_.byteOffset+_.length);this.decryptBuffer(g).then(i=>{const r=new Uint8Array(i);u.set(r,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)})}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let u=0;for(let _=32;_<e.length-16;_+=160,u+=16)n.set(e.subarray(_,_+16),u);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let u=0;for(let _=32;_<e.length-16;_+=160,u+=16)e.set(n.subarray(u,u+16),_);return e}decryptAvcSample(e,t,n,u,_){const g=us(_.data),i=this.getAvcEncryptedData(g);this.decryptBuffer(i.buffer).then(r=>{_.data=this.getAvcDecryptedUnit(g,r),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,u)})}decryptAvcSamples(e,t,n,u){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){u();return}const _=e[t].units;for(;!(n>=_.length);n++){const g=_[n];if(!(g.data.length<=48||g.type!==1&&g.type!==5)&&(this.decryptAvcSample(e,t,n,u,g),!this.decrypter.isSync()))return}}}}const or=188;class Ur{constructor(e,t,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=n}static probe(e){const t=Ur.syncOffset(e);return t>0&&je.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){const t=e.length,n=Math.min(or*5,e.length-or)+1;let u=0;for(;u<n;){let _=!1;for(let g=u;g<t&&e[g]===71;g+=or)if(!_&&Li(e,g)===0&&(_=!0),_&&g+or>n)return u;u++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:ns[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,u){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=Ur.createTrack("video"),this._audioTrack=Ur.createTrack("audio",u),this._id3Track=Ur.createTrack("id3"),this._txtTrack=Ur.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n,this._duration=u}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_avcTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,n=!1,u=!1){n||(this.sampleAes=null);let _;const g=this._avcTrack,i=this._audioTrack,r=this._id3Track,d=this._txtTrack;let o=g.pid,l=g.pesData,c=i.pid,E=r.pid,m=i.pesData,f=r.pesData,T=null,L=this.pmtParsed,P=this._pmtId,O=e.length;if(this.remainderData&&(e=Xr(this.remainderData,e),O=e.length,this.remainderData=null),O<or&&!u)return this.remainderData=e,{audioTrack:i,videoTrack:g,id3Track:r,textTrack:d};const M=Math.max(0,Ur.syncOffset(e));O-=(O-M)%or,O<e.byteLength&&!u&&(this.remainderData=new Uint8Array(e.buffer,O,e.buffer.byteLength-O));let S=0;for(let h=M;h<O;h+=or)if(e[h]===71){const C=!!(e[h+1]&64),v=Li(e,h),I=(e[h+3]&48)>>4;let D;if(I>1){if(D=h+5+e[h+4],D===h+or)continue}else D=h+4;switch(v){case o:C&&(l&&(_=qr(l))&&this.parseAVCPES(g,d,_,!1),l={data:[],size:0}),l&&(l.data.push(e.subarray(D,h+or)),l.size+=h+or-D);break;case c:if(C){if(m&&(_=qr(m)))switch(i.segmentCodec){case"aac":this.parseAACPES(i,_);break;case"mp3":this.parseMPEGPES(i,_);break}m={data:[],size:0}}m&&(m.data.push(e.subarray(D,h+or)),m.size+=h+or-D);break;case E:C&&(f&&(_=qr(f))&&this.parseID3PES(r,_),f={data:[],size:0}),f&&(f.data.push(e.subarray(D,h+or)),f.size+=h+or-D);break;case 0:C&&(D+=e[D]+1),P=this._pmtId=Wu(e,D);break;case P:{C&&(D+=e[D]+1);const y=ju(e,D,this.typeSupported,n);o=y.avc,o>0&&(g.pid=o),c=y.audio,c>0&&(i.pid=c,i.segmentCodec=y.segmentCodec),E=y.id3,E>0&&(r.pid=E),T!==null&&!L&&(je.warn(`MPEG-TS PMT found at ${h} after unknown PID '${T}'. Backtracking to sync byte @${M} to parse all TS packets.`),T=null,h=M-188),L=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=v;break}}else S++;if(S>0){const h=new Error(`Found ${S} TS packet/s that do not start with 0x47`);this.observer.emit(Ee.ERROR,Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,fatal:!1,error:h,reason:h.message})}g.pesData=l,i.pesData=m,r.pesData=f;const p={audioTrack:i,videoTrack:g,id3Track:r,textTrack:d};return u&&this.extractRemainingSamples(p),p}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:u,textTrack:_}=e,g=n.pesData,i=t.pesData,r=u.pesData;let d;if(g&&(d=qr(g))?(this.parseAVCPES(n,_,d,!0),n.pesData=null):n.pesData=g,i&&(d=qr(i))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break}t.pesData=null}else i!=null&&i.size&&je.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=i;r&&(d=qr(r))?(this.parseID3PES(u,d),u.pesData=null):u.pesData=r}demuxSampleAes(e,t,n){const u=this.demux(e,n,!0,!this.config.progressive),_=this.sampleAes=new Ku(this.observer,this.config,t);return this.decrypt(u,_)}decrypt(e,t){return new Promise(n=>{const{audioTrack:u,videoTrack:_}=e;u.samples&&u.segmentCodec==="aac"?t.decryptAacSamples(u.samples,0,()=>{_.samples?t.decryptAvcSamples(_.samples,0,0,()=>{n(e)}):n(e)}):_.samples&&t.decryptAvcSamples(_.samples,0,0,()=>{n(e)})})}destroy(){this._duration=0}parseAVCPES(e,t,n,u){const _=this.parseAVCNALu(e,n.data);let g=this.avcSample,i,r=!1;n.data=null,g&&_.length&&!e.audFound&&(li(g,e),g=this.avcSample=Cn(!1,n.pts,n.dts,"")),_.forEach(d=>{switch(d.type){case 1:{i=!0,g||(g=this.avcSample=Cn(!0,n.pts,n.dts,"")),g.frame=!0;const o=d.data;if(r&&o.length>4){const l=new Pa(o).readSliceType();(l===2||l===4||l===7||l===9)&&(g.key=!0)}break}case 5:i=!0,g||(g=this.avcSample=Cn(!0,n.pts,n.dts,"")),g.key=!0,g.frame=!0;break;case 6:{i=!0,ls(d.data,1,n.pts,t.samples);break}case 7:if(i=!0,r=!0,!e.sps){const o=d.data,c=new Pa(o).readSPS();e.width=c.width,e.height=c.height,e.pixelRatio=c.pixelRatio,e.sps=[o],e.duration=this._duration;const E=o.subarray(1,4);let m="avc1.";for(let f=0;f<3;f++){let T=E[f].toString(16);T.length<2&&(T="0"+T),m+=T}e.codec=m}break;case 8:i=!0,e.pps||(e.pps=[d.data]);break;case 9:i=!1,e.audFound=!0,g&&li(g,e),g=this.avcSample=Cn(!1,n.pts,n.dts,"");break;case 12:i=!0;break;default:i=!1,g&&(g.debug+="unknown NAL "+d.type+" ");break}g&&i&&g.units.push(d)}),u&&g&&(li(g,e),this.avcSample=null)}getLastNalUnit(e){var t;let n=this.avcSample,u;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const _=n.units;u=_[_.length-1]}return u}parseAVCNALu(e,t){const n=t.byteLength;let u=e.naluState||0;const _=u,g=[];let i=0,r,d,o,l=-1,c=0;for(u===-1&&(l=0,c=t[0]&31,u=0,i=1);i<n;){if(r=t[i++],!u){u=r?0:1;continue}if(u===1){u=r?0:2;continue}if(!r)u=3;else if(r===1){if(l>=0){const E={data:t.subarray(l,i-u-1),type:c};g.push(E)}else{const E=this.getLastNalUnit(e.samples);if(E&&(_&&i<=4-_&&E.state&&(E.data=E.data.subarray(0,E.data.byteLength-_)),d=i-u-1,d>0)){const m=new Uint8Array(E.data.byteLength+d);m.set(E.data,0),m.set(t.subarray(0,d),E.data.byteLength),E.data=m,E.state=0}}i<n?(o=t[i]&31,l=i,c=o,u=0):u=-1}else u=0}if(l>=0&&u>=0){const E={data:t.subarray(l,n),type:c,state:u};g.push(E)}if(g.length===0){const E=this.getLastNalUnit(e.samples);if(E){const m=new Uint8Array(E.data.byteLength+t.byteLength);m.set(E.data,0),m.set(t,E.data.byteLength),E.data=m}}return e.naluState=u,g}parseAACPES(e,t){let n=0;const u=this.aacOverFlow;let _=t.data;if(u){this.aacOverFlow=null;const l=u.missing,c=u.sample.unit.byteLength;if(l===-1){const E=new Uint8Array(c+_.byteLength);E.set(u.sample.unit,0),E.set(_,c),_=E}else{const E=c-l;u.sample.unit.set(_.subarray(0,l),E),e.samples.push(u.sample),n=u.missing}}let g,i;for(g=n,i=_.length;g<i-1&&!Un(_,g);g++);if(g!==n){let l;const c=g<i-1;c?l=`AAC PES did not start with ADTS header,offset:${g}`:l="No ADTS header found in AAC PES";const E=new Error(l);if(je.warn(`parsing error: ${l}`),this.observer.emit(Ee.ERROR,Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,fatal:!1,levelRetry:c,error:E,reason:l}),!c)return}Ss(e,this.observer,_,g,this.audioCodec);let r;if(t.pts!==void 0)r=t.pts;else if(u){const l=Rs(e.samplerate);r=u.sample.pts+l}else{je.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,o;for(;g<i;)if(o=Ds(e,_,g,r,d),g+=o.length,o.missing){this.aacOverFlow=o;break}else for(d++;g<i-1&&!Un(_,g);g++);}parseMPEGPES(e,t){const n=t.data,u=n.length;let _=0,g=0;const i=t.pts;if(i===void 0){je.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;g<u;)if(Ps(n,g)){const r=Is(e,n,g,i,_);if(r)g+=r.length,_++;else break}else g++}parseID3PES(e,t){if(t.pts===void 0){je.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=rr({},t,{type:this._avcTrack?pr.emsg:pr.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function Cn(b,e,t,n){return{key:b,frame:!1,pts:e,dts:t,units:[],debug:n,length:0}}function Li(b,e){return((b[e+1]&31)<<8)+b[e+2]}function Wu(b,e){return(b[e+10]&31)<<8|b[e+11]}function ju(b,e,t,n){const u={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},_=(b[e+1]&15)<<8|b[e+2],g=e+3+_-4,i=(b[e+10]&15)<<8|b[e+11];for(e+=12+i;e<g;){const r=Li(b,e);switch(b[e]){case 207:if(!n){je.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:u.audio===-1&&(u.audio=r);break;case 21:u.id3===-1&&(u.id3=r);break;case 219:if(!n){je.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:u.avc===-1&&(u.avc=r);break;case 3:case 4:t.mpeg!==!0&&t.mp3!==!0?je.log("MPEG audio found, not supported in this browser"):u.audio===-1&&(u.audio=r,u.segmentCodec="mp3");break;case 36:je.warn("Unsupported HEVC stream type found");break}e+=((b[e+3]&15)<<8|b[e+4])+5}return u}function qr(b){let e=0,t,n,u,_,g;const i=b.data;if(!b||b.size===0)return null;for(;i[0].length<19&&i.length>1;){const d=new Uint8Array(i[0].length+i[1].length);d.set(i[0]),d.set(i[1],i[0].length),i[0]=d,i.splice(1,1)}if(t=i[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(n=(t[4]<<8)+t[5],n&&n>b.size-6)return null;const d=t[7];d&192&&(_=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,d&64?(g=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,_-g>60*9e4&&(je.warn(`${Math.round((_-g)/9e4)}s delta between PTS and DTS, align them`),_=g)):g=_),u=t[8];let o=u+9;if(b.size<=o)return null;b.size-=o;const l=new Uint8Array(b.size);for(let c=0,E=i.length;c<E;c++){t=i[c];let m=t.byteLength;if(o)if(o>m){o-=m;continue}else t=t.subarray(o),m-=o,o=0;l.set(t,e),e+=m}return n&&(n-=u+3),{data:l,pts:_,dts:g,len:n}}return null}function li(b,e){if(b.units.length&&b.frame){if(b.pts===void 0){const t=e.samples,n=t.length;if(n){const u=t[n-1];b.pts=u.pts,b.dts=u.dts}else{e.dropped++;return}}e.samples.push(b)}b.debug.length&&je.log(b.pts+"/"+b.dts+":"+b.debug)}class Gu extends Ts{resetInitSegment(e,t,n,u){super.resetInitSegment(e,t,n,u),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:u,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let n=(xn(e,0)||[]).length;for(let u=e.length;n<u;n++)if(ku(e,n))return je.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Uu(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return Is(e,t,n,this.basePTS,this.frameIndex)}}class Ma{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Br=Math.pow(2,32)-1;class Qe{static init(){Qe.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in Qe.types)Qe.types.hasOwnProperty(e)&&(Qe.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Qe.HDLR_TYPES={video:t,audio:n};const u=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),_=new Uint8Array([0,0,0,0,0,0,0,0]);Qe.STTS=Qe.STSC=Qe.STCO=_,Qe.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Qe.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Qe.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Qe.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const g=new Uint8Array([105,115,111,109]),i=new Uint8Array([97,118,99,49]),r=new Uint8Array([0,0,0,1]);Qe.FTYP=Qe.box(Qe.types.ftyp,g,r,g,i),Qe.DINF=Qe.box(Qe.types.dinf,Qe.box(Qe.types.dref,u))}static box(e,...t){let n=8,u=t.length;const _=u;for(;u--;)n+=t[u].byteLength;const g=new Uint8Array(n);for(g[0]=n>>24&255,g[1]=n>>16&255,g[2]=n>>8&255,g[3]=n&255,g.set(e,4),u=0,n=8;u<_;u++)g.set(t[u],n),n+=t[u].byteLength;return g}static hdlr(e){return Qe.box(Qe.types.hdlr,Qe.HDLR_TYPES[e])}static mdat(e){return Qe.box(Qe.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Br+1)),u=Math.floor(t%(Br+1));return Qe.box(Qe.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,u>>24,u>>16&255,u>>8&255,u&255,85,196,0,0]))}static mdia(e){return Qe.box(Qe.types.mdia,Qe.mdhd(e.timescale,e.duration),Qe.hdlr(e.type),Qe.minf(e))}static mfhd(e){return Qe.box(Qe.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?Qe.box(Qe.types.minf,Qe.box(Qe.types.smhd,Qe.SMHD),Qe.DINF,Qe.stbl(e)):Qe.box(Qe.types.minf,Qe.box(Qe.types.vmhd,Qe.VMHD),Qe.DINF,Qe.stbl(e))}static moof(e,t,n){return Qe.box(Qe.types.moof,Qe.mfhd(e),Qe.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=Qe.trak(e[t]);return Qe.box.apply(null,[Qe.types.moov,Qe.mvhd(e[0].timescale,e[0].duration)].concat(n).concat(Qe.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=Qe.trex(e[t]);return Qe.box.apply(null,[Qe.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Br+1)),u=Math.floor(t%(Br+1)),_=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,u>>24,u>>16&255,u>>8&255,u&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Qe.box(Qe.types.mvhd,_)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let u,_;for(u=0;u<t.length;u++)_=t[u].flags,n[u+4]=_.dependsOn<<4|_.isDependedOn<<2|_.hasRedundancy;return Qe.box(Qe.types.sdtp,n)}static stbl(e){return Qe.box(Qe.types.stbl,Qe.stsd(e),Qe.box(Qe.types.stts,Qe.STTS),Qe.box(Qe.types.stsc,Qe.STSC),Qe.box(Qe.types.stsz,Qe.STSZ),Qe.box(Qe.types.stco,Qe.STCO))}static avc1(e){let t=[],n=[],u,_,g;for(u=0;u<e.sps.length;u++)_=e.sps[u],g=_.byteLength,t.push(g>>>8&255),t.push(g&255),t=t.concat(Array.prototype.slice.call(_));for(u=0;u<e.pps.length;u++)_=e.pps[u],g=_.byteLength,n.push(g>>>8&255),n.push(g&255),n=n.concat(Array.prototype.slice.call(_));const i=Qe.box(Qe.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),r=e.width,d=e.height,o=e.pixelRatio[0],l=e.pixelRatio[1];return Qe.box(Qe.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>8&255,r&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i,Qe.box(Qe.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Qe.box(Qe.types.pasp,new Uint8Array([o>>24,o>>16&255,o>>8&255,o&255,l>>24,l>>16&255,l>>8&255,l&255])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static mp4a(e){const t=e.samplerate;return Qe.box(Qe.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0]),Qe.box(Qe.types.esds,Qe.esds(e)))}static mp3(e){const t=e.samplerate;return Qe.box(Qe.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0]))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?Qe.box(Qe.types.stsd,Qe.STSD,Qe.mp3(e)):Qe.box(Qe.types.stsd,Qe.STSD,Qe.mp4a(e)):Qe.box(Qe.types.stsd,Qe.STSD,Qe.avc1(e))}static tkhd(e){const t=e.id,n=e.duration*e.timescale,u=e.width,_=e.height,g=Math.floor(n/(Br+1)),i=Math.floor(n%(Br+1));return Qe.box(Qe.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,u>>8&255,u&255,0,0,_>>8&255,_&255,0,0]))}static traf(e,t){const n=Qe.sdtp(e),u=e.id,_=Math.floor(t/(Br+1)),g=Math.floor(t%(Br+1));return Qe.box(Qe.types.traf,Qe.box(Qe.types.tfhd,new Uint8Array([0,0,0,0,u>>24,u>>16&255,u>>8&255,u&255])),Qe.box(Qe.types.tfdt,new Uint8Array([1,0,0,0,_>>24,_>>16&255,_>>8&255,_&255,g>>24,g>>16&255,g>>8&255,g&255])),Qe.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,Qe.box(Qe.types.trak,Qe.tkhd(e),Qe.mdia(e))}static trex(e){const t=e.id;return Qe.box(Qe.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],u=n.length,_=12+16*u,g=new Uint8Array(_);let i,r,d,o,l,c;for(t+=8+_,g.set([e.type==="video"?1:0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,u&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),i=0;i<u;i++)r=n[i],d=r.duration,o=r.size,l=r.flags,c=r.cts,g.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,o>>>24&255,o>>>16&255,o>>>8&255,o&255,l.isLeading<<2|l.dependsOn,l.isDependedOn<<6|l.hasRedundancy<<4|l.paddingValue<<1|l.isNonSync,l.degradPrio&240<<8,l.degradPrio&15,c>>>24&255,c>>>16&255,c>>>8&255,c&255],12+16*i);return Qe.box(Qe.types.trun,g)}static initSegment(e){Qe.types||Qe.init();const t=Qe.moov(e),n=new Uint8Array(Qe.FTYP.byteLength+t.byteLength);return n.set(Qe.FTYP),n.set(t,Qe.FTYP.byteLength),n}}Qe.types=void 0;Qe.HDLR_TYPES=void 0;Qe.STTS=void 0;Qe.STSC=void 0;Qe.STCO=void 0;Qe.STSZ=void 0;Qe.VMHD=void 0;Qe.SMHD=void 0;Qe.STSD=void 0;Qe.FTYP=void 0;Qe.DINF=void 0;const Ms=9e4;function Vi(b,e,t=1,n=!1){const u=b*e*t;return n?Math.round(u):u}function Hu(b,e,t=1,n=!1){return Vi(b,e,1/t,n)}function fn(b,e=!1){return Vi(b,1e3,1/Ms,e)}function Vu(b,e=1){return Vi(b,Ms,1/e)}const Yu=10*1e3,La=1024,zu=1152;let Pn=null,ui=null;class fi{constructor(e,t,n,u=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Pn===null){const g=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Pn=g?parseInt(g[1]):0}if(ui===null){const _=navigator.userAgent.match(/Safari\/(\d+)/i);ui=_?parseInt(_[1]):0}}destroy(){}resetTimeStamp(e){je.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){je.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){je.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1;const n=e.reduce((u,_)=>{const g=_.pts-u;return g<-4294967296?(t=!0,_r(u,_.pts)):g>0?u:_.pts},e[0].pts);return t&&je.debug("PTS rollover detected"),n}remux(e,t,n,u,_,g,i,r){let d,o,l,c,E,m,f=_,T=_;const L=e.pid>-1,P=t.pid>-1,O=t.samples.length,M=e.samples.length>0,S=i&&O>0||O>1;if((!L||M)&&(!P||S)||this.ISGenerated||i){this.ISGenerated||(l=this.generateIS(e,t,_,g));const h=this.isVideoContiguous;let C=-1,v;if(S&&(C=$u(t.samples),!h&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,C>0){je.warn(`[mp4-remuxer]: Dropped ${C} out of ${O} video samples due to a missing keyframe`);const I=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(C),t.dropped+=C,T+=(t.samples[0].pts-I)/t.inputTimeScale,v=T}else C===-1&&(je.warn(`[mp4-remuxer]: No keyframe found out of ${O} video samples`),m=!1);if(this.ISGenerated){if(M&&S){const I=this.getVideoStartPts(t.samples),y=(_r(e.samples[0].pts,I)-I)/t.inputTimeScale;f+=Math.max(0,y),T+=Math.max(0,-y)}if(M){if(e.samplerate||(je.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),l=this.generateIS(e,t,_,g)),o=this.remuxAudio(e,f,this.isAudioContiguous,g,P||S||r===wt.AUDIO?T:void 0),S){const I=o?o.endPTS-o.startPTS:0;t.inputTimeScale||(je.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),l=this.generateIS(e,t,_,g)),d=this.remuxVideo(t,T,h,I)}}else S&&(d=this.remuxVideo(t,T,h,0));d&&(d.firstKeyFrame=C,d.independent=C!==-1,d.firstKeyFramePTS=v)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(E=Ls(n,_,this._initPTS,this._initDTS)),u.samples.length&&(c=Os(u,_,this._initPTS))),{audio:o,video:d,initSegment:l,independent:m,text:c,id3:E}}generateIS(e,t,n,u){const _=e.samples,g=t.samples,i=this.typeSupported,r={},d=this._initPTS;let o=!d||u,l="audio/mp4",c,E,m;if(o&&(c=E=1/0),e.config&&_.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":i.mpeg?(l="audio/mpeg",e.codec=""):i.mp3&&(e.codec="mp3");break}r.audio={id:"audio",container:l,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&i.mpeg?new Uint8Array(0):Qe.initSegment([e]),metadata:{channelCount:e.channelCount}},o&&(m=e.inputTimeScale,!d||m!==d.timescale?c=E=_[0].pts-Math.round(m*n):o=!1)}if(t.sps&&t.pps&&g.length&&(t.timescale=t.inputTimeScale,r.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Qe.initSegment([t]),metadata:{width:t.width,height:t.height}},o))if(m=t.inputTimeScale,!d||m!==d.timescale){const f=this.getVideoStartPts(g),T=Math.round(m*n);E=Math.min(E,_r(g[0].dts,f)-T),c=Math.min(c,f-T)}else o=!1;if(Object.keys(r).length)return this.ISGenerated=!0,o?(this._initPTS={baseTime:c,timescale:m},this._initDTS={baseTime:E,timescale:m}):c=m=void 0,{tracks:r,initPTS:c,timescale:m}}remuxVideo(e,t,n,u){const _=e.inputTimeScale,g=e.samples,i=[],r=g.length,d=this._initPTS;let o=this.nextAvcDts,l=8,c=this.videoSampleDuration,E,m,f=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,L=!1;if(!n||o===null){const V=t*_,Q=g[0].pts-_r(g[0].dts,g[0].pts);o=V-Q}const P=d.baseTime*_/d.timescale;for(let V=0;V<r;V++){const Q=g[V];Q.pts=_r(Q.pts-P,o),Q.dts=_r(Q.dts-P,o),Q.dts<g[V>0?V-1:V].dts&&(L=!0)}L&&g.sort(function(V,Q){const $=V.dts-Q.dts,K=V.pts-Q.pts;return $||K}),E=g[0].dts,m=g[g.length-1].dts;const O=m-E,M=O?Math.round(O/(r-1)):c||e.inputTimeScale/30;if(n){const V=E-o,Q=V>M,$=V<-1;if((Q||$)&&(Q?je.warn(`AVC: ${fn(V,!0)} ms (${V}dts) hole between fragments detected, filling it`):je.warn(`AVC: ${fn(-V,!0)} ms (${V}dts) overlapping between fragments detected`),!$||o>g[0].pts)){E=o;const K=g[0].pts-V;g[0].dts=E,g[0].pts=K,je.log(`Video: First PTS/DTS adjusted: ${fn(K,!0)}/${fn(E,!0)}, delta: ${fn(V,!0)} ms`)}}E=Math.max(0,E);let S=0,p=0;for(let V=0;V<r;V++){const Q=g[V],$=Q.units,K=$.length;let Y=0;for(let re=0;re<K;re++)Y+=$[re].data.length;p+=Y,S+=K,Q.length=Y,Q.dts=Math.max(Q.dts,E),f=Math.min(Q.pts,f),T=Math.max(Q.pts,T)}m=g[r-1].dts;const h=p+4*S+8;let C;try{C=new Uint8Array(h)}catch(V){this.observer.emit(Ee.ERROR,Ee.ERROR,{type:Nt.MUX_ERROR,details:st.REMUX_ALLOC_ERROR,fatal:!1,error:V,bytes:h,reason:`fail allocating video mdat ${h}`});return}const v=new DataView(C.buffer);v.setUint32(0,h),C.set(Qe.types.mdat,4);let I=!1,D=Number.POSITIVE_INFINITY,y=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,x=Number.NEGATIVE_INFINITY;for(let V=0;V<r;V++){const Q=g[V],$=Q.units;let K=0;for(let ie=0,ee=$.length;ie<ee;ie++){const ne=$[ie],ae=ne.data,ce=ne.data.byteLength;v.setUint32(l,ce),l+=4,C.set(ae,l),l+=ce,K+=4+ce}let Y;if(V<r-1)c=g[V+1].dts-Q.dts,Y=g[V+1].pts-Q.pts;else{const ie=this.config,ee=V>0?Q.dts-g[V-1].dts:M;if(Y=V>0?Q.pts-g[V-1].pts:M,ie.stretchShortVideoTrack&&this.nextAudioPts!==null){const ne=Math.floor(ie.maxBufferHole*_),ae=(u?f+u*_:this.nextAudioPts)-Q.pts;ae>ne?(c=ae-ee,c<0?c=ee:I=!0,je.log(`[mp4-remuxer]: It is approximately ${ae/90} ms to the next segment; using duration ${c/90} ms for the last video frame.`)):c=ee}else c=ee}const re=Math.round(Q.pts-Q.dts);D=Math.min(D,c),A=Math.max(A,c),y=Math.min(y,Y),x=Math.max(x,Y),i.push(new Oa(Q.key,c,K,re))}if(i.length){if(Pn){if(Pn<70){const V=i[0].flags;V.dependsOn=2,V.isNonSync=0}}else if(ui&&x-y<A-D&&M/A<.025&&i[0].cts===0){je.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let V=E;for(let Q=0,$=i.length;Q<$;Q++){const K=V+i[Q].duration,Y=V+i[Q].cts;if(Q<$-1){const re=K+i[Q+1].cts;i[Q].duration=re-Y}else i[Q].duration=Q?i[Q-1].duration:M;i[Q].cts=0,V=K}}}c=I||!c?M:c,this.nextAvcDts=o=m+c,this.videoSampleDuration=c,this.isVideoContiguous=!0;const F=Qe.moof(e.sequenceNumber++,E,rr({},e,{samples:i})),k="video",W={data1:F,data2:C,startPTS:f/_,endPTS:(T+c)/_,startDTS:E/_,endDTS:o/_,type:k,hasAudio:!1,hasVideo:!0,nb:i.length,dropped:e.dropped};return e.samples=[],e.dropped=0,W}remuxAudio(e,t,n,u,_){const g=e.inputTimeScale,i=e.samplerate?e.samplerate:g,r=g/i,d=e.segmentCodec==="aac"?La:zu,o=d*r,l=this._initPTS,c=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,E=[],m=_!==void 0;let f=e.samples,T=c?0:8,L=this.nextAudioPts||-1;const P=t*g,O=l.baseTime*g/l.timescale;if(this.isAudioContiguous=n=n||f.length&&L>0&&(u&&Math.abs(P-L)<9e3||Math.abs(_r(f[0].pts-O,P)-L)<20*o),f.forEach(function(k){k.pts=_r(k.pts-O,P)}),!n||L<0){if(f=f.filter(k=>k.pts>=0),!f.length)return;_===0?L=0:u&&!m?L=Math.max(0,P):L=f[0].pts}if(e.segmentCodec==="aac"){const k=this.config.maxAudioFramesDrift;for(let W=0,V=L;W<f.length;W++){const Q=f[W],$=Q.pts,K=$-V,Y=Math.abs(1e3*K/g);if(K<=-k*o&&m)W===0&&(je.warn(`Audio frame @ ${($/g).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*K/g)} ms.`),this.nextAudioPts=L=V=$);else if(K>=k*o&&Y<Yu&&m){let re=Math.round(K/o);V=$-re*o,V<0&&(re--,V+=o),W===0&&(this.nextAudioPts=L=V),je.warn(`[mp4-remuxer]: Injecting ${re} audio frame @ ${(V/g).toFixed(3)}s due to ${Math.round(1e3*K/g)} ms gap.`);for(let ie=0;ie<re;ie++){const ee=Math.max(V,0);let ne=Ma.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);ne||(je.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ne=Q.unit.subarray()),f.splice(W,0,{unit:ne,pts:ee}),V+=o,W++}}Q.pts=V,V+=o}}let M=null,S=null,p,h=0,C=f.length;for(;C--;)h+=f[C].unit.byteLength;for(let k=0,W=f.length;k<W;k++){const V=f[k],Q=V.unit;let $=V.pts;if(S!==null){const Y=E[k-1];Y.duration=Math.round(($-S)/r)}else if(n&&e.segmentCodec==="aac"&&($=L),M=$,h>0){h+=T;try{p=new Uint8Array(h)}catch(Y){this.observer.emit(Ee.ERROR,Ee.ERROR,{type:Nt.MUX_ERROR,details:st.REMUX_ALLOC_ERROR,fatal:!1,error:Y,bytes:h,reason:`fail allocating audio mdat ${h}`});return}c||(new DataView(p.buffer).setUint32(0,h),p.set(Qe.types.mdat,4))}else return;p.set(Q,T);const K=Q.byteLength;T+=K,E.push(new Oa(!0,d,K,0)),S=$}const v=E.length;if(!v)return;const I=E[E.length-1];this.nextAudioPts=L=S+r*I.duration;const D=c?new Uint8Array(0):Qe.moof(e.sequenceNumber++,M/r,rr({},e,{samples:E}));e.samples=[];const y=M/g,A=L/g,F={data1:D,data2:p,startPTS:y,endPTS:A,startDTS:y,endDTS:A,type:"audio",hasAudio:!0,hasVideo:!1,nb:v};return this.isAudioContiguous=!0,F}remuxEmptyAudio(e,t,n,u){const _=e.inputTimeScale,g=e.samplerate?e.samplerate:_,i=_/g,r=this.nextAudioPts,d=this._initDTS,o=d.baseTime*9e4/d.timescale,l=(r!==null?r:u.startDTS*_)+o,c=u.endDTS*_+o,E=i*La,m=Math.ceil((c-l)/E),f=Ma.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(je.warn("[mp4-remuxer]: remux empty Audio"),!f){je.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const T=[];for(let L=0;L<m;L++){const P=l+L*E;T.push({unit:f,pts:P,dts:P})}return e.samples=T,this.remuxAudio(e,t,n,!1)}}function _r(b,e){let t;if(e===null)return b;for(e<b?t=-8589934592:t=8589934592;Math.abs(b-e)>4294967296;)b+=t;return b}function $u(b){for(let e=0;e<b.length;e++)if(b[e].key)return e;return-1}function Ls(b,e,t,n){const u=b.samples.length;if(!u)return;const _=b.inputTimeScale;for(let i=0;i<u;i++){const r=b.samples[i];r.pts=_r(r.pts-t.baseTime*9e4/t.timescale,e*_)/_,r.dts=_r(r.dts-n.baseTime*9e4/n.timescale,e*_)/_}const g=b.samples;return b.samples=[],{samples:g}}function Os(b,e,t){const n=b.samples.length;if(!n)return;const u=b.inputTimeScale;for(let g=0;g<n;g++){const i=b.samples[g];i.pts=_r(i.pts-t.baseTime*9e4/t.timescale,e*u)/u}b.samples.sort((g,i)=>g.pts-i.pts);const _=b.samples;return b.samples=[],{samples:_}}class Oa{constructor(e,t,n,u){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=n,this.cts=u,this.flags=new Xu(e)}}class Xu{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}class Qu{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,n,u){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(El(e,u)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const u=this.initData=ss(e);t||(t=ba(u.audio,Xt.AUDIO)),n||(n=ba(u.video,Xt.VIDEO));const _={};u.audio&&u.video?_.audiovideo={container:"video/mp4",codec:t+","+n,initSegment:e,id:"main"}:u.audio?_.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:u.video?_.video={container:"video/mp4",codec:n,initSegment:e,id:"main"}:je.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=_}remux(e,t,n,u,_,g){var i,r;let{initPTS:d,lastEndTime:o}=this;const l={audio:void 0,video:void 0,text:u,id3:n,initSegment:void 0};bt(o)||(o=this.lastEndTime=_||0);const c=t.samples;if(!(c!=null&&c.length))return l;const E={initPTS:void 0,timescale:1};let m=this.initData;if((i=m)!=null&&i.length||(this.generateInitSegment(c),m=this.initData),!((r=m)!=null&&r.length))return je.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),l;this.emitInitSegment&&(E.tracks=this.initTracks,this.emitInitSegment=!1);const f=_l(m,c),T=f===null?_:f;(Ju(d,T,_)||E.timescale!==d.timescale&&g)&&(E.initPTS=T-_,this.initPTS=d={baseTime:E.initPTS,timescale:1});const L=vl(c,m),P=e?T-d.baseTime/d.timescale:o,O=P+L;Tl(m,c,d.baseTime/d.timescale),L>0?this.lastEndTime=O:(je.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const M=!!m.audio,S=!!m.video;let p="";M&&(p+="audio"),S&&(p+="video");const h={data1:c,startPTS:P,startDTS:P,endPTS:O,endDTS:O,type:p,hasAudio:M,hasVideo:S,nb:1,dropped:0};return l.audio=h.type==="audio"?h:void 0,l.video=h.type!=="audio"?h:void 0,l.initSegment=E,l.id3=Ls(n,_,d,d),u.samples.length&&(l.text=Os(u,_,d)),l}}function Ju(b,e,t){if(b===null)return!0;const n=e-b.baseTime/b.timescale;return n<0&&Math.abs(n-t)>1}function ba(b,e){const t=b==null?void 0:b.codec;return t&&t.length>4?t:t==="hvc1"||t==="hev1"?"hvc1.1.c.L120.90":t==="av01"?"av01.0.04M.08":t==="avc1"||e===Xt.VIDEO?"avc1.42e01e":"mp4a.40.5"}let Nr;try{Nr=self.performance.now.bind(self.performance)}catch{je.debug("Unable to use Performance API on this environment"),Nr=typeof self<"u"&&self.Date.now}const ci=[{demux:xu,remux:Qu},{demux:Ur,remux:fi},{demux:Ou,remux:fi},{demux:Gu,remux:fi}];class xa{constructor(e,t,n,u,_){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.vendor=u,this.id=_}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,u){const _=n.transmuxing;_.executeStart=Nr();let g=new Uint8Array(e);const{currentTransmuxState:i,transmuxConfig:r}=this;u&&(this.currentTransmuxState=u);const{contiguous:d,discontinuity:o,trackSwitch:l,accurateTimeOffset:c,timeOffset:E,initSegmentChange:m}=u||i,{audioCodec:f,videoCodec:T,defaultInitPts:L,duration:P,initSegmentData:O}=r,M=Zu(g,t);if(M&&M.method==="AES-128"){const C=this.getDecrypter();if(C.isSync()){let v=C.softwareDecrypt(g,M.key.buffer,M.iv.buffer);if(n.part>-1&&(v=C.flush()),!v)return _.executeEnd=Nr(),di(n);g=new Uint8Array(v)}else return this.decryptionPromise=C.webCryptoDecrypt(g,M.key.buffer,M.iv.buffer).then(v=>{const I=this.push(v,null,n);return this.decryptionPromise=null,I}),this.decryptionPromise}const S=this.needsProbing(o,l);if(S){const C=this.configureTransmuxer(g);if(C)return je.warn(`[transmuxer] ${C.message}`),this.observer.emit(Ee.ERROR,Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,fatal:!1,error:C,reason:C.message}),_.executeEnd=Nr(),di(n)}(o||l||m||S)&&this.resetInitSegment(O,f,T,P,t),(o||m||S)&&this.resetInitialTimestamp(L),d||this.resetContiguity();const p=this.transmux(g,M,E,c,n),h=this.currentTransmuxState;return h.contiguous=!0,h.discontinuity=!1,h.trackSwitch=!1,_.executeEnd=Nr(),p}flush(e){const t=e.transmuxing;t.executeStart=Nr();const{decrypter:n,currentTransmuxState:u,decryptionPromise:_}=this;if(_)return _.then(()=>this.flush(e));const g=[],{timeOffset:i}=u;if(n){const l=n.flush();l&&g.push(this.push(l,null,e))}const{demuxer:r,remuxer:d}=this;if(!r||!d)return t.executeEnd=Nr(),[di(e)];const o=r.flush(i);return bn(o)?o.then(l=>(this.flushRemux(g,l,e),g)):(this.flushRemux(g,o,e),g)}flushRemux(e,t,n){const{audioTrack:u,videoTrack:_,id3Track:g,textTrack:i}=t,{accurateTimeOffset:r,timeOffset:d}=this.currentTransmuxState;je.log(`[transmuxer.ts]: Flushed fragment ${n.sn}${n.part>-1?" p: "+n.part:""} of level ${n.level}`);const o=this.remuxer.remux(u,_,g,i,d,r,!0,this.id);e.push({remuxResult:o,chunkMeta:n}),n.transmuxing.executeEnd=Nr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,u,_){const{demuxer:g,remuxer:i}=this;!g||!i||(g.resetInitSegment(e,t,n,u),i.resetInitSegment(e,t,n,_))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,u,_){let g;return t&&t.method==="SAMPLE-AES"?g=this.transmuxSampleAes(e,t,n,u,_):g=this.transmuxUnencrypted(e,n,u,_),g}transmuxUnencrypted(e,t,n,u){const{audioTrack:_,videoTrack:g,id3Track:i,textTrack:r}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(_,g,i,r,t,n,!1,this.id),chunkMeta:u}}transmuxSampleAes(e,t,n,u,_){return this.demuxer.demuxSampleAes(e,t,n).then(g=>({remuxResult:this.remuxer.remux(g.audioTrack,g.videoTrack,g.id3Track,g.textTrack,n,u,!1,this.id),chunkMeta:_}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:u,vendor:_}=this;let g;for(let l=0,c=ci.length;l<c;l++)if(ci[l].demux.probe(e)){g=ci[l];break}if(!g)return new Error("Failed to find demuxer by probing fragment data");const i=this.demuxer,r=this.remuxer,d=g.remux,o=g.demux;(!r||!(r instanceof d))&&(this.remuxer=new d(n,t,u,_)),(!i||!(i instanceof o))&&(this.demuxer=new o(n,t,u),this.probe=o.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ki(this.config)),e}}function Zu(b,e){let t=null;return b.byteLength>0&&e!=null&&e.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const di=b=>({remuxResult:{},chunkMeta:b});function bn(b){return"then"in b&&b.then instanceof Function}class qu{constructor(e,t,n,u,_){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=u,this.defaultInitPts=_||null}}class ef{constructor(e,t,n,u,_,g){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=u,this.timeOffset=_,this.initSegmentChange=g}}var _n={},tf={get exports(){return _n},set exports(b){_n=b}};(function(b){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function u(r,d,o){this.fn=r,this.context=d,this.once=o||!1}function _(r,d,o,l,c){if(typeof o!="function")throw new TypeError("The listener must be a function");var E=new u(o,l||r,c),m=t?t+d:d;return r._events[m]?r._events[m].fn?r._events[m]=[r._events[m],E]:r._events[m].push(E):(r._events[m]=E,r._eventsCount++),r}function g(r,d){--r._eventsCount===0?r._events=new n:delete r._events[d]}function i(){this._events=new n,this._eventsCount=0}i.prototype.eventNames=function(){var d=[],o,l;if(this._eventsCount===0)return d;for(l in o=this._events)e.call(o,l)&&d.push(t?l.slice(1):l);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(o)):d},i.prototype.listeners=function(d){var o=t?t+d:d,l=this._events[o];if(!l)return[];if(l.fn)return[l.fn];for(var c=0,E=l.length,m=new Array(E);c<E;c++)m[c]=l[c].fn;return m},i.prototype.listenerCount=function(d){var o=t?t+d:d,l=this._events[o];return l?l.fn?1:l.length:0},i.prototype.emit=function(d,o,l,c,E,m){var f=t?t+d:d;if(!this._events[f])return!1;var T=this._events[f],L=arguments.length,P,O;if(T.fn){switch(T.once&&this.removeListener(d,T.fn,void 0,!0),L){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,o),!0;case 3:return T.fn.call(T.context,o,l),!0;case 4:return T.fn.call(T.context,o,l,c),!0;case 5:return T.fn.call(T.context,o,l,c,E),!0;case 6:return T.fn.call(T.context,o,l,c,E,m),!0}for(O=1,P=new Array(L-1);O<L;O++)P[O-1]=arguments[O];T.fn.apply(T.context,P)}else{var M=T.length,S;for(O=0;O<M;O++)switch(T[O].once&&this.removeListener(d,T[O].fn,void 0,!0),L){case 1:T[O].fn.call(T[O].context);break;case 2:T[O].fn.call(T[O].context,o);break;case 3:T[O].fn.call(T[O].context,o,l);break;case 4:T[O].fn.call(T[O].context,o,l,c);break;default:if(!P)for(S=1,P=new Array(L-1);S<L;S++)P[S-1]=arguments[S];T[O].fn.apply(T[O].context,P)}}return!0},i.prototype.on=function(d,o,l){return _(this,d,o,l,!1)},i.prototype.once=function(d,o,l){return _(this,d,o,l,!0)},i.prototype.removeListener=function(d,o,l,c){var E=t?t+d:d;if(!this._events[E])return this;if(!o)return g(this,E),this;var m=this._events[E];if(m.fn)m.fn===o&&(!c||m.once)&&(!l||m.context===l)&&g(this,E);else{for(var f=0,T=[],L=m.length;f<L;f++)(m[f].fn!==o||c&&!m[f].once||l&&m[f].context!==l)&&T.push(m[f]);T.length?this._events[E]=T.length===1?T[0]:T:g(this,E)}return this},i.prototype.removeAllListeners=function(d){var o;return d?(o=t?t+d:d,this._events[o]&&g(this,o)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=t,i.EventEmitter=i,b.exports=i})(tf);const hi=ji()||{isTypeSupported:()=>!1};class bs{constructor(e,t,n,u){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const _=e.config;this.hls=e,this.id=t,this.useWorker=!!_.enableWorker,this.onTransmuxComplete=n,this.onFlush=u;const g=(d,o)=>{o=o||{},o.frag=this.frag,o.id=this.id,d===Ee.ERROR&&(this.error=o.error),this.hls.trigger(d,o)};this.observer=new _n,this.observer.on(Ee.FRAG_DECRYPTED,g),this.observer.on(Ee.ERROR,g);const i={mp4:hi.isTypeSupported("video/mp4"),mpeg:hi.isTypeSupported("audio/mpeg"),mp3:hi.isTypeSupported('audio/mp4; codecs="mp3"')},r=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(_.workerPath||Au())){try{_.workerPath?(je.log(`loading Web Worker ${_.workerPath} for "${t}"`),this.workerContext=Ru(_.workerPath)):(je.log(`injecting Web Worker for "${t}"`),this.workerContext=Su()),this.onwmsg=l=>this.onWorkerMessage(l);const{worker:o}=this.workerContext;o.addEventListener("message",this.onwmsg),o.onerror=l=>{const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);_.enableWorker=!1,je.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(Ee.ERROR,{type:Nt.OTHER_ERROR,details:st.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})},o.postMessage({cmd:"init",typeSupported:i,vendor:r,id:t,config:JSON.stringify(_)})}catch(o){je.warn(`Error setting up "${t}" Web Worker, fallback to inline`,o),this.resetWorker(),this.error=null,this.transmuxer=new xa(this.observer,i,_,r,t)}return}this.transmuxer=new xa(this.observer,i,_,r,t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,n,u,_,g,i,r,d,o){var l,c;d.transmuxing.start=self.performance.now();const{transmuxer:E}=this,m=g?g.start:_.start,f=_.decryptdata,T=this.frag,L=!(T&&_.cc===T.cc),P=!(T&&d.level===T.level),O=T?d.sn-T.sn:-1,M=this.part?d.part-this.part.index:-1,S=O===0&&d.id>1&&d.id===(T==null?void 0:T.stats.chunkCount),p=!P&&(O===1||O===0&&(M===1||S&&M<=0)),h=self.performance.now();(P||O||_.stats.parsing.start===0)&&(_.stats.parsing.start=h),g&&(M||!p)&&(g.stats.parsing.start=h);const C=!(T&&((l=_.initSegment)==null?void 0:l.url)===((c=T.initSegment)==null?void 0:c.url)),v=new ef(L,p,r,P,m,C);if(!p||L||C){je.log(`[transmuxer-interface, ${_.type}]: Starting new transmux session for sn: ${d.sn} p: ${d.part} level: ${d.level} id: ${d.id}
        discontinuity: ${L}
        trackSwitch: ${P}
        contiguous: ${p}
        accurateTimeOffset: ${r}
        timeOffset: ${m}
        initSegmentChange: ${C}`);const I=new qu(n,u,t,i,o);this.configureTransmuxer(I)}if(this.frag=_,this.part=g,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:f,chunkMeta:d,state:v},e instanceof ArrayBuffer?[e]:[]);else if(E){const I=E.push(e,f,d,v);bn(I)?(E.async=!0,I.then(D=>{this.handleTransmuxComplete(D)}).catch(D=>{this.transmuxerError(D,d,"transmuxer-interface push error")})):(E.async=!1,this.handleTransmuxComplete(I))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let n=t.flush(e);bn(n)||t.async?(bn(n)||(n=Promise.resolve(n)),n.then(_=>{this.handleFlushResult(_,e)}).catch(_=>{this.transmuxerError(_,e,"transmuxer-interface flush error")})):this.handleFlushResult(n,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data,n=this.hls;switch(t.event){case"init":{var u;const _=(u=this.workerContext)==null?void 0:u.objectURL;_&&self.URL.revokeObjectURL(_);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":je[t.data.logType]&&je[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data);break}}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const rf=250,gi=2,nf=.1,af=.05;class sf{constructor(e,t,n,u){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=n,this.hls=u}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:n,media:u,stalled:_}=this;if(u===null)return;const{currentTime:g,seeking:i}=u,r=this.seeking&&!i,d=!this.seeking&&i;if(this.seeking=i,g!==e){if(this.moved=!0,_!==null){if(this.stallReported){const L=self.performance.now()-_;je.warn(`playback not stuck anymore @${g}, after ${Math.round(L)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(d||r){this.stalled=null;return}if(u.paused&&!i||u.ended||u.playbackRate===0||!Jt.getBuffered(u).length)return;const o=Jt.bufferInfo(u,g,0),l=o.len>0,c=o.nextStart||0;if(!l&&!c)return;if(i){const L=o.len>gi,P=!c||t&&t.start<=g||c-g>gi&&!this.fragmentTracker.getPartialFragment(g);if(L||P)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var E;const L=Math.max(c,o.start||0)-g,P=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,M=(P==null||(E=P.details)==null?void 0:E.live)?P.details.targetduration*2:gi,S=this.fragmentTracker.getPartialFragment(g);if(L>0&&(L<=M||S)){this._trySkipBufferHole(S);return}}const m=self.performance.now();if(_===null){this.stalled=m;return}const f=m-_;if(!i&&f>=rf&&(this._reportStall(o),!this.media))return;const T=Jt.bufferInfo(u,g,n.maxBufferHole);this._tryFixBufferStall(T,f)}_tryFixBufferStall(e,t){const{config:n,fragmentTracker:u,media:_}=this;if(_===null)return;const g=_.currentTime,i=u.getPartialFragment(g);i&&(this._trySkipBufferHole(i)||!this.media)||(e.len>n.maxBufferHole||e.nextStart&&e.nextStart-g<n.maxBufferHole)&&t>n.highBufferWatchdogPeriod*1e3&&(je.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:n,stallReported:u}=this;if(!u&&n){this.stallReported=!0;const _=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${JSON.stringify(e)})`);je.warn(_.message),t.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.BUFFER_STALLED_ERROR,fatal:!1,error:_,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:n,media:u}=this;if(u===null)return 0;const _=u.currentTime,g=Jt.bufferInfo(u,_,0),i=_<g.start?g.start:g.nextStart;if(i){const r=g.len<=t.maxBufferHole,d=g.len>0&&g.len<1&&u.readyState<3,o=i-_;if(o>0&&(r||d)){if(o>t.maxBufferHole){const{fragmentTracker:c}=this;let E=!1;if(_===0){const m=c.getAppendedFrag(0,wt.MAIN);m&&i<m.end&&(E=!0)}if(!E){const m=e||c.getAppendedFrag(_,wt.MAIN);if(m){let f=!1,T=m.end;for(;T<i;){const L=c.getPartialFragment(T);if(L)T+=L.duration;else{f=!0;break}}if(f)return 0}}}const l=Math.max(i+af,_+nf);if(je.warn(`skipping hole, adjusting currentTime from ${_} to ${l}`),this.moved=!0,this.stalled=null,u.currentTime=l,e&&!e.gap){const c=new Error(`fragment loaded with buffer holes, seeking from ${_} to ${l}`);n.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:c,reason:c.message,frag:e})}return l}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:n,nudgeRetry:u}=this;if(n===null)return;const _=n.currentTime;if(this.nudgeRetry++,u<e.nudgeMaxRetry){const g=_+(u+1)*e.nudgeOffset,i=new Error(`Nudging 'currentTime' from ${_} to ${g}`);je.warn(i.message),n.currentTime=g,t.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.BUFFER_NUDGE_ON_STALL,error:i,fatal:!1})}else{const g=new Error(`Playhead still not moving while enough data buffered @${_} after ${e.nudgeMaxRetry} nudges`);je.error(g.message),t.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.BUFFER_STALLED_ERROR,error:g,fatal:!0})}}}const of=100;class lf extends Wi{constructor(e,t,n){super(e,t,n,"[stream-controller]",wt.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Ee.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(Ee.ERROR,this.onError,this),e.on(Ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Ee.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(Ee.BUFFER_CREATED,this.onBufferCreated,this),e.on(Ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Ee.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(Ee.ERROR,this.onError,this),e.off(Ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Ee.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(Ee.BUFFER_CREATED,this.onBufferCreated,this),e.off(Ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Ee.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:n}=this;if(this.stopLoad(),this.setInterval(of),this.level=-1,!this.startFragRequested){let u=n.startLevel;u===-1&&(n.config.testBandwidth&&this.levels.length>1?(u=0,this.bitrateTest=!0):u=n.nextAutoLevel),this.level=n.nextLoadLevel=u,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=gt.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=gt.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case gt.WAITING_LEVEL:{var e;const{levels:n,level:u}=this,_=n==null||(e=n[u])==null?void 0:e.details;if(_&&(!_.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(_))break;this.state=gt.IDLE;break}break}case gt.FRAG_LOADING_WAITING_RETRY:{var t;const n=self.performance.now(),u=this.retryDate;(!u||n>=u||(t=this.media)!=null&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=gt.IDLE)}break}this.state===gt.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:u}=this,{config:_,nextLoadLevel:g}=e;if(t===null||!u&&(this.startFragRequested||!_.startFragPrefetch)||this.altAudio&&this.audioOnly||!(n!=null&&n[g]))return;const i=n[g],r=this.getMainFwdBufferInfo();if(r===null)return;const d=this.getLevelDetails();if(d&&this._streamEnded(r,d)){const T={};this.altAudio&&(T.type="video"),this.hls.trigger(Ee.BUFFER_EOS,T),this.state=gt.ENDED;return}e.loadLevel!==g&&e.manualLevel===-1&&this.log(`Adapting to level ${g} from level ${this.level}`),this.level=e.nextLoadLevel=g;const o=i.details;if(!o||this.state===gt.WAITING_LEVEL||o.live&&this.levelLastLoaded!==g){this.level=g,this.state=gt.WAITING_LEVEL;return}const l=r.len,c=this.getMaxBufferLength(i.maxBitrate);if(l>=c)return;this.backtrackFragment&&this.backtrackFragment.start>r.end&&(this.backtrackFragment=null);const E=this.backtrackFragment?this.backtrackFragment.start:r.end;let m=this.getNextFragment(E,o);if(this.couldBacktrack&&!this.fragPrevious&&m&&m.sn!=="initSegment"&&this.fragmentTracker.getState(m)!==ar.OK){var f;const L=((f=this.backtrackFragment)!=null?f:m).sn-o.startSN,P=o.fragments[L-1];P&&m.cc===P.cc&&(m=P,this.fragmentTracker.removeFragment(P))}else this.backtrackFragment&&r.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,E)){if(!m.gap){const L=this.audioOnly&&!this.altAudio?Xt.AUDIO:Xt.VIDEO,P=(L===Xt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;P&&this.afterBufferFlushed(P,L,wt.MAIN)}m=this.getNextFragmentLoopLoading(m,o,r,wt.MAIN,c)}m&&(m.initSegment&&!m.initSegment.data&&!this.bitrateTest&&(m=m.initSegment),this.loadFragment(m,i,E))}loadFragment(e,t,n){const u=this.fragmentTracker.getState(e);this.fragCurrent=e,u===ar.NOT_LOADED?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,n)):this.clearTrackerIfNeeded(e)}getAppendedFrag(e){const t=this.fragmentTracker.getAppendedFrag(e,wt.MAIN);return t&&"fragment"in t?t.fragment:t}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,wt.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const u=this.getAppendedFrag(t.currentTime);if(u&&u.start>1&&this.flushMainBuffer(0,u.start-1),!t.paused&&e){const g=this.hls.nextLoadLevel,i=e[g],r=this.fragLastKbps;r&&this.fragCurrent?n=this.fragCurrent.duration*i.maxBitrate/(1e3*r)+1:n=0}else n=0;const _=this.getBufferedFrag(t.currentTime+n);if(_){const g=this.followingBufferedFrag(_);if(g){this.abortCurrentFrag();const i=g.maxStartPTS?g.maxStartPTS:g.start,r=g.duration,d=Math.max(_.end,i+Math.min(Math.max(r-this.config.maxFragLookUpTolerance,r*.5),r*.75));this.flushMainBuffer(d,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case gt.KEY_LOADING:case gt.FRAG_LOADING:case gt.FRAG_LOADING_WAITING_RETRY:case gt.PARSING:case gt.PARSED:this.state=gt.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new sf(this.config,n,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;bt(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const n=this.getMainFwdBufferInfo();if(n===null||n.len===0){this.warn(`Main forward buffer length on "seeked" event ${n?n.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Ee.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null}onManifestParsed(e,t){let n=!1,u=!1,_;t.levels.forEach(g=>{_=g.audioCodec,_&&(_.indexOf("mp4a.40.2")!==-1&&(n=!0),_.indexOf("mp4a.40.5")!==-1&&(u=!0))}),this.audioCodecSwitch=n&&u&&!yu(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==gt.IDLE)return;const u=n[t.level];(!u.details||u.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(u.details))&&(this.state=gt.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:u}=this,_=t.level,g=t.details,i=g.totalduration;if(!u){this.warn(`Levels were reset while loading level ${_}`);return}this.log(`Level ${_} loaded [${g.startSN},${g.endSN}], cc [${g.startCC}, ${g.endCC}] duration:${i}`);const r=u[_],d=this.fragCurrent;d&&(this.state===gt.FRAG_LOADING||this.state===gt.FRAG_LOADING_WAITING_RETRY)&&(d.level!==t.level||d.urlId!==r.urlId)&&d.loader&&this.abortCurrentFrag();let o=0;if(g.live||(n=r.details)!=null&&n.live){if(g.fragments[0]||(g.deltaUpdateFailed=!0),g.deltaUpdateFailed)return;o=this.alignPlaylists(g,r.details)}if(r.details=g,this.levelLastLoaded=_,this.hls.trigger(Ee.LEVEL_UPDATED,{details:g,level:_}),this.state===gt.WAITING_LEVEL){if(this.waitForCdnTuneIn(g))return;this.state=gt.IDLE}this.startFragRequested?g.live&&this.synchronizeToLiveEdge(g):this.setStartPosition(g,o),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:n,part:u,payload:_}=e,{levels:g}=this;if(!g){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const i=g[n.level],r=i.details;if(!r){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const d=i.videoCodec,o=r.PTSKnown||!r.live,l=(t=n.initSegment)==null?void 0:t.data,c=this._getAudioCodec(i),E=this.transmuxer=this.transmuxer||new bs(this.hls,wt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=u?u.index:-1,f=m!==-1,T=new Ui(n.level,n.sn,n.stats.chunkCount,_.byteLength,m,f),L=this.initPTS[n.cc];E.push(_,l,c,d,n,u,r.totalduration,o,T,L)}onAudioTrackSwitching(e,t){const n=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const g=this.fragCurrent;g&&(this.log("Switching to main audio track, cancel main fragment load"),g.abortRequests(),this.fragmentTracker.removeFragment(g)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const _=this.hls;n&&(_.trigger(Ee.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),_.trigger(Ee.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=t.id,u=!!this.hls.audioTracks[n].url;if(u){const _=this.videoBuffer;_&&this.mediaBuffer!==_&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=_)}this.altAudio=u,this.tick()}onBufferCreated(e,t){const n=t.tracks;let u,_,g=!1;for(const i in n){const r=n[i];if(r.id==="main"){if(_=i,u=r,i==="video"){const d=n[i];d&&(this.videoBuffer=d.buffer)}}else g=!0}g&&u?(this.log(`Alternate track found, use ${_}.buffered to schedule main fragment loading`),this.mediaBuffer=u.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:u}=t;if(n&&n.type!==wt.MAIN)return;if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${u?" p: "+u.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===gt.PARSED&&(this.state=gt.IDLE);return}const _=u?u.stats:n.stats;this.fragLastKbps=Math.round(8*_.total/(_.buffering.end-_.loading.first)),n.sn!=="initSegment"&&(this.fragPrevious=n),this.fragBufferedComplete(n,u)}onError(e,t){var n;if(t.fatal){this.state=gt.ERROR;return}switch(t.details){case st.FRAG_GAP:case st.FRAG_PARSING_ERROR:case st.FRAG_DECRYPT_ERROR:case st.FRAG_LOAD_ERROR:case st.FRAG_LOAD_TIMEOUT:case st.KEY_LOAD_ERROR:case st.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(wt.MAIN,t);break;case st.LEVEL_LOAD_ERROR:case st.LEVEL_LOAD_TIMEOUT:case st.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===gt.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===zt.LEVEL&&(this.state=gt.IDLE);break;case st.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case st.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!Jt.getBuffered(e).length){const n=this.state!==gt.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,n)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=gt.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Xt.AUDIO||this.audioOnly&&!this.altAudio){const n=(t===Xt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,t,wt.MAIN)}}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const u=Jt.getBuffered(e),g=(u.length?u.start(0):0)-n;g>0&&(g<this.config.maxBufferHole||g<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${g} to match buffer start`),n+=g,this.startPosition=n),this.log(`seek to target start position ${n} from current time ${t}`),e.currentTime=n}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:u}=this;if(!n||this.fragContextChanged(e))return;t.fragmentError=0,this.state=gt.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const _=e.stats;_.parsing.start=_.parsing.end=_.buffering.start=_.buffering.end=self.performance.now(),u.trigger(Ee.FRAG_LOADED,n),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const n="main",{hls:u}=this,{remuxResult:_,chunkMeta:g}=e,i=this.getCurrentContext(g);if(!i){this.resetWhenMissingContext(g);return}const{frag:r,part:d,level:o}=i,{video:l,text:c,id3:E,initSegment:m}=_,{details:f}=o,T=this.altAudio?void 0:_.audio;if(this.fragContextChanged(r)){this.fragmentTracker.removeFragment(r);return}if(this.state=gt.PARSING,m){m.tracks&&(this._bufferInitSegment(o,m.tracks,r,g),u.trigger(Ee.FRAG_PARSING_INIT_SEGMENT,{frag:r,id:n,tracks:m.tracks}));const L=m.initPTS,P=m.timescale;bt(L)&&(this.initPTS[r.cc]={baseTime:L,timescale:P},u.trigger(Ee.INIT_PTS_FOUND,{frag:r,id:n,initPTS:L,timescale:P}))}if(l&&_.independent!==!1){if(f){const{startPTS:L,endPTS:P,startDTS:O,endDTS:M}=l;if(d)d.elementaryStreams[l.type]={startPTS:L,endPTS:P,startDTS:O,endDTS:M};else if(l.firstKeyFrame&&l.independent&&g.id===1&&(this.couldBacktrack=!0),l.dropped&&l.independent){const S=this.getMainFwdBufferInfo(),p=(S?S.end:this.getLoadPosition())+this.config.maxBufferHole,h=l.firstKeyFramePTS?l.firstKeyFramePTS:L;if(p<h-this.config.maxBufferHole){this.backtrack(r);return}r.setElementaryStreamInfo(l.type,r.start,P,r.start,M,!0)}r.setElementaryStreamInfo(l.type,L,P,O,M),this.backtrackFragment&&(this.backtrackFragment=r),this.bufferFragmentData(l,r,d,g)}}else if(_.independent===!1){this.backtrack(r);return}if(T){const{startPTS:L,endPTS:P,startDTS:O,endDTS:M}=T;d&&(d.elementaryStreams[Xt.AUDIO]={startPTS:L,endPTS:P,startDTS:O,endDTS:M}),r.setElementaryStreamInfo(Xt.AUDIO,L,P,O,M),this.bufferFragmentData(T,r,d,g)}if(f&&E!=null&&(t=E.samples)!=null&&t.length){const L={id:n,frag:r,details:f,samples:E.samples};u.trigger(Ee.FRAG_PARSING_METADATA,L)}if(f&&c){const L={id:n,frag:r,details:f,samples:c.samples};u.trigger(Ee.FRAG_PARSING_USERDATA,L)}}_bufferInitSegment(e,t,n,u){if(this.state!==gt.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:_,video:g,audiovideo:i}=t;if(_){let r=e.audioCodec;const d=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(r&&(r.indexOf("mp4a.40.5")!==-1?r="mp4a.40.2":r="mp4a.40.5"),_.metadata.channelCount!==1&&d.indexOf("firefox")===-1&&(r="mp4a.40.5")),d.indexOf("android")!==-1&&_.container!=="audio/mpeg"&&(r="mp4a.40.2",this.log(`Android: force audio codec to ${r}`)),e.audioCodec&&e.audioCodec!==r&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${r}"`),_.levelCodec=r,_.id="main",this.log(`Init audio buffer, container:${_.container}, codecs[selected/level/parsed]=[${r||""}/${e.audioCodec||""}/${_.codec}]`)}g&&(g.levelCodec=e.videoCodec,g.id="main",this.log(`Init video buffer, container:${g.container}, codecs[level/parsed]=[${e.videoCodec||""}/${g.codec}]`)),i&&this.log(`Init audiovideo buffer, container:${i.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${i.codec}]`),this.hls.trigger(Ee.BUFFER_CODECS,t),Object.keys(t).forEach(r=>{const o=t[r].initSegment;o!=null&&o.byteLength&&this.hls.trigger(Ee.BUFFER_APPENDING,{type:r,data:o,frag:n,part:null,chunkMeta:u,parent:n.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,wt.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=gt.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(Jt.isBuffered(e,n)?t=this.getAppendedFrag(n):Jt.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const u=this.fragPlaying,_=t.level;(!u||t.sn!==u.sn||u.level!==_||t.urlId!==u.urlId)&&(this.fragPlaying=t,this.hls.trigger(Ee.FRAG_CHANGED,{frag:t}),(!u||u.level!==_)&&this.hls.trigger(Ee.LEVEL_SWITCHED,{level:_}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,n=this.currentFrag;if(n&&bt(t)&&bt(n.programDateTime)){const u=n.programDateTime+(t-n.start)*1e3;return new Date(u)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class en{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class uf{constructor(e,t,n,u=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new en(e),this.fast_=new en(t),this.defaultTTFB_=u,this.ttfb_=new en(e)}update(e,t){const{slow_:n,fast_:u,ttfb_:_}=this;n.halfLife!==e&&(this.slow_=new en(e,n.getEstimate(),n.getTotalWeight())),u.halfLife!==t&&(this.fast_=new en(t,u.getEstimate(),u.getTotalWeight())),_.halfLife!==e&&(this.ttfb_=new en(e,_.getEstimate(),_.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,u=e/1e3,_=n/u;this.fast_.sample(u,_),this.slow_.sample(u,_)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class ff{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;const t=e.config;this.bwEstimator=new uf(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(Ee.FRAG_LOADING,this.onFragLoading,this),e.on(Ee.FRAG_LOADED,this.onFragLoaded,this),e.on(Ee.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Ee.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:e}=this;e.off(Ee.FRAG_LOADING,this.onFragLoading,this),e.off(Ee.FRAG_LOADED,this.onFragLoaded,this),e.off(Ee.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Ee.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var n;const u=t.frag;this.ignoreFragment(u)||(this.fragCurrent=u,this.partCurrent=(n=t.part)!=null?n:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,n,u){const _=e+n/t,g=u?this.lastLevelLoadSec:0;return _+g}onLevelLoaded(e,t){const n=this.hls.config,{total:u,bwEstimate:_}=t.stats;bt(u)&&bt(_)&&(this.lastLevelLoadSec=8*u/_),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:e,partCurrent:t,hls:n}=this,{autoLevelEnabled:u,media:_}=n;if(!e||!_)return;const g=performance.now(),i=t?t.stats:e.stats,r=t?t.duration:e.duration,d=g-i.loading.start;if(i.aborted||i.loaded&&i.loaded===i.total||e.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u||_.paused||!_.playbackRate||!_.readyState)return;const o=n.mainForwardBufferInfo;if(o===null)return;const l=this.bwEstimator.getEstimateTTFB(),c=Math.abs(_.playbackRate);if(d<=Math.max(l,1e3*(r/(c*2))))return;const E=o.len/c;if(E>=2*r/c)return;const m=i.loading.first?i.loading.first-i.loading.start:-1,f=i.loaded&&m>-1,T=this.bwEstimator.getEstimate(),{levels:L,minAutoLevel:P}=n,O=L[e.level],M=i.total||Math.max(i.loaded,Math.round(r*O.maxBitrate/8));let S=d-m;S<1&&f&&(S=Math.min(d,i.loaded*8/T));const p=f?i.loaded*1e3/S:0,h=p?(M-i.loaded)/p:M*8/T+l/1e3;if(h<=E)return;const C=p?p*8:T;let v=Number.POSITIVE_INFINITY,I;for(I=e.level-1;I>P;I--){const D=L[I].maxBitrate;if(v=this.getTimeToLoadFrag(l/1e3,C,r*D,!L[I].details),v<E)break}v>=h||v>r*10||(n.nextLoadLevel=I,f?this.bwEstimator.sample(d-Math.min(l,m),i.loaded):this.bwEstimator.sampleTTFB(d),this.clearTimer(),je.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;
      Time to underbuffer: ${E.toFixed(3)} s
      Estimated load time for current fragment: ${h.toFixed(3)} s
      Estimated load time for down switch fragment: ${v.toFixed(3)} s
      TTFB estimate: ${m}
      Current BW estimate: ${bt(T)?(T/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${I}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),n.trigger(Ee.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:i}))}onFragLoaded(e,{frag:t,part:n}){const u=n?n.stats:t.stats;if(t.type===wt.MAIN&&this.bwEstimator.sampleTTFB(u.loading.first-u.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const _=n?n.duration:t.duration,g=this.hls.levels[t.level],i=(g.loaded?g.loaded.bytes:0)+u.loaded,r=(g.loaded?g.loaded.duration:0)+_;g.loaded={bytes:i,duration:r},g.realBitrate=Math.round(8*i/r)}if(t.bitrateTest){const _={stats:u,frag:t,part:n,id:t.type};this.onFragBuffered(Ee.FRAG_BUFFERED,_),t.bitrateTest=!1}}}onFragBuffered(e,t){const{frag:n,part:u}=t,_=u!=null&&u.stats.loaded?u.stats:n.stats;if(_.aborted||this.ignoreFragment(n))return;const g=_.parsing.end-_.loading.start-Math.min(_.loading.first-_.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(g,_.loaded),_.bwEstimate=this.bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=g/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==wt.MAIN||e.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const e=this._nextAutoLevel,t=this.bwEstimator;if(e!==-1&&!t.canEstimate())return e;let n=this.getNextABRAutoLevel();if(e!==-1){const u=this.hls.levels;if(u.length>Math.max(e,n)&&u[e].loadError<=u[n].loadError)return e}return e!==-1&&(n=Math.min(e,n)),n}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this,{maxAutoLevel:u,config:_,minAutoLevel:g,media:i}=n,r=t?t.duration:e?e.duration:0,d=i&&i.playbackRate!==0?Math.abs(i.playbackRate):1,o=this.bwEstimator?this.bwEstimator.getEstimate():_.abrEwmaDefaultEstimate,l=n.mainForwardBufferInfo,c=(l?l.len:0)/d;let E=this.findBestLevel(o,g,u,c,_.abrBandWidthFactor,_.abrBandWidthUpFactor);if(E>=0)return E;je.trace(`[abr] ${c?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let m=r?Math.min(r,_.maxStarvationDelay):_.maxStarvationDelay,f=_.abrBandWidthFactor,T=_.abrBandWidthUpFactor;if(!c){const L=this.bitrateTestDelay;L&&(m=(r?Math.min(r,_.maxLoadingDelay):_.maxLoadingDelay)-L,je.trace(`[abr] bitrate test took ${Math.round(1e3*L)}ms, set first fragment max fetchDuration to ${Math.round(1e3*m)} ms`),f=T=1)}return E=this.findBestLevel(o,g,u,c+m,f,T),Math.max(E,0)}findBestLevel(e,t,n,u,_,g){var i;const{fragCurrent:r,partCurrent:d,lastLoadedFragLevel:o}=this,{levels:l}=this.hls,c=l[o],E=!!(c!=null&&(i=c.details)!=null&&i.live),m=c==null?void 0:c.codecSet,f=d?d.duration:r?r.duration:0,T=this.bwEstimator.getEstimateTTFB()/1e3;let L=t,P=-1;for(let O=n;O>=t;O--){const M=l[O];if(!M||m&&M.codecSet!==m){M&&(L=Math.min(O,L),P=Math.max(O,P));continue}P!==-1&&je.trace(`[abr] Skipped level(s) ${L}-${P} with CODECS:"${l[P].attrs.CODECS}"; not compatible with "${c.attrs.CODECS}"`);const S=M.details,p=(d?S==null?void 0:S.partTarget:S==null?void 0:S.averagetargetduration)||f;let h;O<=o?h=_*e:h=g*e;const C=l[O].maxBitrate,v=this.getTimeToLoadFrag(T,h,C*p,S===void 0);if(je.trace(`[abr] level:${O} adjustedbw-bitrate:${Math.round(h-C)} avgDuration:${p.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${v.toFixed(1)}`),h>C&&(v===0||!bt(v)||E&&!this.bitrateTestDelay||v<u))return O}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}}class xs{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=cf(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function cf(b,e){const t=new Uint8Array(e);let n=0;for(let u=0;u<b.length;u++){const _=b[u];t.set(_,n),n+=_.length}return t}const Na=100;class df extends Wi{constructor(e,t,n){super(e,t,n,"[audio-stream-controller]",wt.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Ee.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(Ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(Ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Ee.ERROR,this.onError,this),e.on(Ee.BUFFER_RESET,this.onBufferReset,this),e.on(Ee.BUFFER_CREATED,this.onBufferCreated,this),e.on(Ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(Ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Ee.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(Ee.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(Ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Ee.ERROR,this.onError,this),e.off(Ee.BUFFER_RESET,this.onBufferReset,this),e.off(Ee.BUFFER_CREATED,this.onBufferCreated,this),e.off(Ee.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(Ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:n,initPTS:u,timescale:_}){if(n==="main"){const g=t.cc;this.initPTS[t.cc]={baseTime:u,timescale:_},this.log(`InitPTS for cc: ${g} found from main: ${u}`),this.videoTrackCC=g,this.state===gt.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=gt.STOPPED;return}const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(Na),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=gt.IDLE):(this.loadedmetadata=!1,this.state=gt.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case gt.IDLE:this.doTickIdle();break;case gt.WAITING_TRACK:{var e;const{levels:n,trackId:u}=this,_=n==null||(e=n[u])==null?void 0:e.details;if(_){if(this.waitForCdnTuneIn(_))break;this.state=gt.WAITING_INIT_PTS}break}case gt.FRAG_LOADING_WAITING_RETRY:{var t;const n=performance.now(),u=this.retryDate;(!u||n>=u||(t=this.media)!=null&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=gt.IDLE);break}case gt.WAITING_INIT_PTS:{const n=this.waitingData;if(n){const{frag:u,part:_,cache:g,complete:i}=n;if(this.initPTS[u.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=gt.FRAG_LOADING;const r=g.flush(),d={frag:u,part:_,payload:r,networkDetails:null};this._handleFragmentLoadProgress(d),i&&super._handleFragmentLoadComplete(d)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${u.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const r=this.getLoadPosition(),d=Jt.bufferInfo(this.mediaBuffer,r,this.config.maxBufferHole);Mi(d.end,this.config.maxFragLookUpTolerance,u)<0&&(this.log(`Waiting fragment cc (${u.cc}) @ ${u.start} cancelled because another fragment at ${d.end} is needed`),this.clearWaitingFragment())}}else this.state=gt.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=gt.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:n,trackId:u}=this,_=e.config;if(!(t!=null&&t[u])||!n&&(this.startFragRequested||!_.startFragPrefetch))return;const g=t[u],i=g.details;if(!i||i.live&&this.levelLastLoaded!==u||this.waitForCdnTuneIn(i)){this.state=gt.WAITING_TRACK;return}const r=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&r&&(this.bufferFlushed=!1,this.afterBufferFlushed(r,Xt.AUDIO,wt.AUDIO));const d=this.getFwdBufferInfo(r,wt.AUDIO);if(d===null)return;const{bufferedTrack:o,switchingTrack:l}=this;if(!l&&this._streamEnded(d,i)){e.trigger(Ee.BUFFER_EOS,{type:"audio"}),this.state=gt.ENDED;return}const c=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,wt.MAIN),E=d.len,m=this.getMaxBufferLength(c==null?void 0:c.len);if(E>=m&&!l)return;const T=i.fragments[0].start;let L=d.end;if(l&&n){const S=this.getLoadPosition();o&&l.attrs!==o.attrs&&(L=S),i.PTSKnown&&S<T&&(d.end>T||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=T+.05)}let P=this.getNextFragment(L,i),O=!1;if(P&&this.isLoopLoading(P,L)&&(O=!!P.gap,P=this.getNextFragmentLoopLoading(P,i,d,wt.MAIN,m)),!P){this.bufferFlushed=!0;return}const M=c&&P.start>c.end+i.targetduration;if(M||!(c!=null&&c.len)&&d.len){const S=this.fragmentTracker.getBufferedFrag(P.start,wt.MAIN);if(S===null||(O||(O=!!S.gap||!!M&&c.len===0),M&&!O||O&&d.nextStart&&d.nextStart<S.end))return}this.loadFragment(P,g,L)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new mn(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:u}=this;u&&(u.abortRequests(),this.removeUnbufferedFrags(u.start)),this.resetLoadingState(),n?this.setInterval(Na):this.resetTransmuxer(),n?(this.switchingTrack=t,this.state=gt.IDLE):(this.switchingTrack=null,this.bufferedTrack=t,this.state=gt.STOPPED),this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.bufferedTrack=null,this.switchingTrack=null}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Ee.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var n;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}const{levels:u}=this,{details:_,id:g}=t;if(!u){this.warn(`Audio tracks were reset while loading level ${g}`);return}this.log(`Track ${g} loaded [${_.startSN},${_.endSN}],duration:${_.totalduration}`);const i=u[g];let r=0;if(_.live||(n=i.details)!=null&&n.live){const d=this.mainDetails;if(_.fragments[0]||(_.deltaUpdateFailed=!0),_.deltaUpdateFailed||!d)return;!i.details&&_.hasProgramDateTime&&d.hasProgramDateTime?(vs(_,d),r=_.fragments[0].start):r=this.alignPlaylists(_,i.details)}i.details=_,this.levelLastLoaded=g,!this.startFragRequested&&(this.mainDetails||!_.live)&&this.setStartPosition(i.details,r),this.state===gt.WAITING_TRACK&&!this.waitForCdnTuneIn(_)&&(this.state=gt.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:n,part:u,payload:_}=e,{config:g,trackId:i,levels:r}=this;if(!r){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const d=r[i];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const o=d.details;if(!o){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const l=g.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let c=this.transmuxer;c||(c=this.transmuxer=new bs(this.hls,wt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const E=this.initPTS[n.cc],m=(t=n.initSegment)==null?void 0:t.data;if(E!==void 0){const T=u?u.index:-1,L=T!==-1,P=new Ui(n.level,n.sn,n.stats.chunkCount,_.byteLength,T,L);c.push(_,m,l,"",n,u,o.totalduration,!1,P,E)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${o.startSN} ,${o.endSN}],track ${i}`);const{cache:f}=this.waitingData=this.waitingData||{frag:n,part:u,cache:new xs,complete:!1};f.push(new Uint8Array(_)),this.waitingVideoCC=this.videoTrackCC,this.state=gt.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:n,part:u}=t;if(n.type!==wt.AUDIO){if(!this.loadedmetadata&&n.type===wt.MAIN){var _;(_=this.videoBuffer||this.media)!=null&&_.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${u?" p: "+u.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(n.sn!=="initSegment"){this.fragPrevious=n;const g=this.switchingTrack;g&&(this.bufferedTrack=g,this.switchingTrack=null,this.hls.trigger(Ee.AUDIO_TRACK_SWITCHED,dr({},g)))}this.fragBufferedComplete(n,u)}onError(e,t){var n;if(t.fatal){this.state=gt.ERROR;return}switch(t.details){case st.FRAG_GAP:case st.FRAG_PARSING_ERROR:case st.FRAG_DECRYPT_ERROR:case st.FRAG_LOAD_ERROR:case st.FRAG_LOAD_TIMEOUT:case st.KEY_LOAD_ERROR:case st.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(wt.AUDIO,t);break;case st.AUDIO_TRACK_LOAD_ERROR:case st.AUDIO_TRACK_LOAD_TIMEOUT:case st.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===gt.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===zt.AUDIO_TRACK&&(this.state=gt.IDLE);break;case st.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case st.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushed(e,{type:t}){t===Xt.AUDIO&&(this.bufferFlushed=!0,this.state===gt.ENDED&&(this.state=gt.IDLE))}_handleTransmuxComplete(e){var t;const n="audio",{hls:u}=this,{remuxResult:_,chunkMeta:g}=e,i=this.getCurrentContext(g);if(!i){this.resetWhenMissingContext(g);return}const{frag:r,part:d,level:o}=i,{details:l}=o,{audio:c,text:E,id3:m,initSegment:f}=_;if(this.fragContextChanged(r)||!l){this.fragmentTracker.removeFragment(r);return}if(this.state=gt.PARSING,this.switchingTrack&&c&&this.completeAudioSwitch(this.switchingTrack),f!=null&&f.tracks&&(this._bufferInitSegment(f.tracks,r,g),u.trigger(Ee.FRAG_PARSING_INIT_SEGMENT,{frag:r,id:n,tracks:f.tracks})),c){const{startPTS:T,endPTS:L,startDTS:P,endDTS:O}=c;d&&(d.elementaryStreams[Xt.AUDIO]={startPTS:T,endPTS:L,startDTS:P,endDTS:O}),r.setElementaryStreamInfo(Xt.AUDIO,T,L,P,O),this.bufferFragmentData(c,r,d,g)}if(m!=null&&(t=m.samples)!=null&&t.length){const T=rr({id:n,frag:r,details:l},m);u.trigger(Ee.FRAG_PARSING_METADATA,T)}if(E){const T=rr({id:n,frag:r,details:l},E);u.trigger(Ee.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,n){if(this.state!==gt.PARSING)return;e.video&&delete e.video;const u=e.audio;if(!u)return;u.levelCodec=u.codec,u.id="audio",this.log(`Init audio buffer, container:${u.container}, codecs[parsed]=[${u.codec}]`),this.hls.trigger(Ee.BUFFER_CODECS,e);const _=u.initSegment;if(_!=null&&_.byteLength){const g={type:"audio",frag:t,part:null,chunkMeta:n,parent:t.type,data:_};this.hls.trigger(Ee.BUFFER_APPENDING,g)}this.tick()}loadFragment(e,t,n){const u=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||u===ar.NOT_LOADED||u===ar.PARTIAL){var _;e.sn==="initSegment"?this._loadInitSegment(e,t):(_=t.details)!=null&&_.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=gt.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(e,t,n))}else this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){const{hls:t,media:n,bufferedTrack:u}=this,_=u==null?void 0:u.attrs,g=e.attrs;n&&_&&(_.CHANNELS!==g.CHANNELS||_.NAME!==g.NAME||_.LANGUAGE!==g.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(Ee.AUDIO_TRACK_SWITCHED,dr({},e))}}class hf extends Bi{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(Ee.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.off(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Ee.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(Ee.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:u,details:_}=t,g=this.tracksInGroup[n];if(!g||g.groupId!==u){this.warn(`Track with id:${n} and group:${u} not found in active group ${g.groupId}`);return}const i=g.details;g.details=t.details,this.log(`audio-track ${n} "${g.name}" lang:${g.lang} group:${u} loaded [${_.startSN}-${_.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,i)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!(t!=null&&t.audioGroupIds))return;const n=t.audioGroupIds[t.urlId];if(this.groupId!==n){this.groupId=n||null;const u=this.tracks.filter(g=>!n||g.groupId===n);this.selectDefaultTrack&&!u.some(g=>g.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;const _={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group:${n}`),this.hls.trigger(Ee.AUDIO_TRACKS_UPDATED,_),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===zt.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();const n=this.currentTrack;t[this.trackId];const u=t[e],{groupId:_,name:g}=u;if(this.log(`Switching to audio-track ${e} "${g}" lang:${u.lang} group:${_}`),this.trackId=e,this.currentTrack=u,this.selectDefaultTrack=!1,this.hls.trigger(Ee.AUDIO_TRACK_SWITCHING,dr({},u)),u.details&&!u.details.live)return;const i=this.switchParams(u.url,n==null?void 0:n.details);this.loadPlaylist(i)}selectInitialTrack(){const e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(t!==-1)this.setAudioTrack(t);else{const n=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(n.message),this.hls.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:n})}}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const u=t[n];if((!this.selectDefaultTrack||u.default)&&(!e||e.attrs["STABLE-RENDITION-ID"]===u.attrs["STABLE-RENDITION-ID"]||e.name===u.name&&e.lang===u.lang))return u.id}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const n=t.id,u=t.groupId;let _=t.url;if(e)try{_=e.addDirectives(_)}catch(g){this.warn(`Could not construct new URL with HLS Delivery Directives: ${g}`)}this.log(`loading audio-track playlist ${n} "${t.name}" lang:${t.lang} group:${u}`),this.clearTimer(),this.hls.trigger(Ee.AUDIO_TRACK_LOADING,{url:_,id:n,groupId:u,deliveryDirectives:e||null})}}}function Ns(b,e){if(b.length!==e.length)return!1;for(let t=0;t<b.length;t++)if(!gf(b[t].attrs,e[t].attrs))return!1;return!0}function gf(b,e){const t=b["STABLE-RENDITION-ID"];return t?t===e["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(n=>b[n]!==e[n])}const Fa=500;class mf extends Wi{constructor(e,t,n){super(e,t,n,"[subtitle-stream-controller]",wt.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Ee.ERROR,this.onError,this),e.on(Ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Ee.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(Ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Ee.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Ee.ERROR,this.onError,this),e.off(Ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Ee.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(Ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Ee.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Ee.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=gt.IDLE,this.setInterval(Fa),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:u}=t;if(this.fragPrevious=n,this.state=gt.IDLE,!u)return;const _=this.tracksBuffered[this.currentTrackId];if(!_)return;let g;const i=n.start;for(let d=0;d<_.length;d++)if(i>=_[d].start&&i<=_[d].end){g=_[d];break}const r=n.start+n.duration;g?g.end=r:(g={start:i,end:r},_.push(g)),this.fragmentTracker.fragBuffered(n)}onBufferFlushing(e,t){const{startOffset:n,endOffset:u}=t;if(n===0&&u!==Number.POSITIVE_INFINITY){const{currentTrackId:_,levels:g}=this;if(!g.length||!g[_]||!g[_].details)return;const r=g[_].details.targetduration,d=u-r;if(d<=0)return;t.endOffsetSubtitles=Math.max(0,d),this.tracksBuffered.forEach(o=>{for(let l=0;l<o.length;){if(o[l].end<=d){o.shift();continue}else if(o[l].start<d)o[l].start=d;else break;l++}}),this.fragmentTracker.removeFragmentsInRange(n,d,wt.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===wt.MAIN){var n;(n=this.media)!=null&&n.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===wt.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==gt.STOPPED&&(this.state=gt.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(Ns(this.levels,t)){this.levels=t.map(n=>new mn(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const u=new mn(n);return this.tracksBuffered[u.id]=[],u}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,wt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(Fa)}onSubtitleTrackLoaded(e,t){var n;const{details:u,id:_}=t,{currentTrackId:g,levels:i}=this;if(!i.length)return;const r=i[g];if(_>=i.length||_!==g||!r)return;this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(u.live||(n=r.details)!=null&&n.live){const o=this.mainDetails;if(u.deltaUpdateFailed||!o)return;const l=o.fragments[0];r.details?(d=this.alignPlaylists(u,r.details),d===0&&l&&(d=l.start,Pi(u,d))):u.hasProgramDateTime&&o.hasProgramDateTime?(vs(u,o),d=u.fragments[0].start):l&&(d=l.start,Pi(u,d))}r.details=u,this.levelLastLoaded=_,!this.startFragRequested&&(this.mainDetails||!u.live)&&this.setStartPosition(r.details,d),this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===gt.IDLE&&(En(null,u.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),r.details=void 0))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,u=t.decryptdata,_=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&u&&u.key&&u.iv&&u.method==="AES-128"){const g=performance.now();this.decrypter.decrypt(new Uint8Array(n),u.key.buffer,u.iv.buffer).catch(i=>{throw _.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.FRAG_DECRYPT_ERROR,fatal:!1,error:i,reason:i.message,frag:t}),i}).then(i=>{const r=performance.now();_.trigger(Ee.FRAG_DECRYPTED,{frag:t,payload:i,stats:{tstart:g,tdecrypt:r}})}).catch(i=>{this.warn(`${i.name}: ${i.message}`),this.state=gt.IDLE})}}doTick(){if(!this.media){this.state=gt.IDLE;return}if(this.state===gt.IDLE){const{currentTrackId:e,levels:t}=this,n=t[e];if(!t.length||!n||!n.details)return;const u=n.details,_=u.targetduration,{config:g}=this,i=this.getLoadPosition(),r=Jt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i-_,g.maxBufferHole),{end:d,len:o}=r,l=this.getFwdBufferInfo(this.media,wt.MAIN),c=this.getMaxBufferLength(l==null?void 0:l.len)+_;if(o>c)return;const E=u.fragments,m=E.length,f=u.edge;let T=null;const L=this.fragPrevious;if(d<f){const{maxFragLookUpTolerance:P}=g;T=En(L,E,Math.max(E[0].start,d),P),!T&&L&&L.start<E[0].start&&(T=E[0])}else T=E[m-1];if(!T)return;T=this.mapToInitFragWhenRequired(T),this.fragmentTracker.getState(T)===ar.NOT_LOADED&&this.loadFragment(T,n,d)}}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,n){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,n))}get mediaBufferTimeRanges(){return new Ef(this.tracksBuffered[this.currentTrackId]||[])}}class Ef{constructor(e){this.buffered=void 0;const t=(n,u,_)=>{if(u=u>>>0,u>_-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${u}) is greater than the maximum bound (${_})`);return e[u][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}class _f extends Bi{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.on(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(Ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(Ee.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.LEVEL_LOADING,this.onLevelLoading,this),e.off(Ee.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(Ee.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(Ee.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),mi(this.media.textTracks).forEach(t=>{rn(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,details:u}=t,{trackId:_}=this,g=this.tracksInGroup[_];if(!g){this.warn(`Invalid subtitle track id ${n}`);return}const i=g.details;g.details=t.details,this.log(`subtitle track ${n} loaded [${u.startSN}-${u.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,i)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!(t!=null&&t.textGroupIds))return;const n=t.textGroupIds[t.urlId],u=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==n){const _=this.tracks.filter(r=>!n||r.groupId===n);this.tracksInGroup=_;const g=this.findTrackId(u==null?void 0:u.name)||this.findTrackId();this.groupId=n||null;const i={subtitleTracks:_};this.log(`Updating subtitle tracks, ${_.length} track(s) found in "${n}" group-id`),this.hls.trigger(Ee.SUBTITLE_TRACKS_UPDATED,i),g!==-1&&this.setSubtitleTrack(g,u)}else this.shouldReloadPlaylist(u)&&this.setSubtitleTrack(this.trackId,u)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const u=t[n];if((!this.selectDefaultTrack||u.default)&&(!e||e===u.name))return u.id}return-1}onError(e,t){t.fatal||!t.context||t.context.type===zt.SUBTITLE_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1;const t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const n=t.id,u=t.groupId;let _=t.url;if(e)try{_=e.addDirectives(_)}catch(g){this.warn(`Could not construct new URL with HLS Delivery Directives: ${g}`)}this.log(`Loading subtitle playlist for id ${n}`),this.hls.trigger(Ee.SUBTITLE_TRACK_LOADING,{url:_,id:n,groupId:u,deliveryDirectives:e||null})}}toggleTrackModes(e){const{media:t,trackId:n}=this;if(!t)return;const u=mi(t.textTracks),_=u.filter(i=>i.groupId===this.groupId);if(e===-1)[].slice.call(u).forEach(i=>{i.mode="disabled"});else{const i=_[n];i&&(i.mode="disabled")}const g=_[e];g&&(g.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var n;const u=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(e===-1||(n=u[e])!=null&&n.details)||e<-1||e>=u.length)return;this.clearTimer();const _=u[e];if(this.log(`Switching to subtitle-track ${e}`+(_?` "${_.name}" lang:${_.lang} group:${_.groupId}`:"")),this.trackId=e,_){const{id:g,groupId:i="",name:r,type:d,url:o}=_;this.hls.trigger(Ee.SUBTITLE_TRACK_SWITCH,{id:g,groupId:i,name:r,type:d,url:o});const l=this.switchParams(_.url,t==null?void 0:t.details);this.loadPlaylist(l)}else this.hls.trigger(Ee.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1;const t=mi(this.media.textTracks);for(let n=0;n<t.length;n++)if(t[n].mode==="hidden")e=n;else if(t[n].mode==="showing"){e=n;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}}function mi(b){const e=[];for(let t=0;t<b.length;t++){const n=b[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(b[t])}return e}class vf{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){const n=this.queues[t];n.push(e),n.length===1&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const n=new Promise(_=>{t=_}),u={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(u,e),n}executeNext(e){const{buffers:t,queues:n}=this,u=t[e],_=n[e];if(_.length){const g=_[0];try{g.execute()}catch(i){je.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),g.onError(i),u!=null&&u.updating||(_.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const wa=ji(),Ba=/([ha]vc.)(?:\.[^.,]+)+/;class pf{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:t,mediaSource:n}=this;je.log("[buffer-controller]: Media source opened"),t&&(t.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Ee.MEDIA_ATTACHED,{media:t})),n&&n.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{je.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{je.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:t,_objectUrl:n}=this;t&&t.src!==n&&je.error(`Media element src was set while attaching MediaSource (${n} > ${t.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:e}=this;e.on(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.BUFFER_RESET,this.onBufferReset,this),e.on(Ee.BUFFER_APPENDING,this.onBufferAppending,this),e.on(Ee.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Ee.BUFFER_EOS,this.onBufferEos,this),e.on(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(Ee.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(Ee.FRAG_PARSED,this.onFragParsed,this),e.on(Ee.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.BUFFER_RESET,this.onBufferReset,this),e.off(Ee.BUFFER_APPENDING,this.onBufferAppending,this),e.off(Ee.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Ee.BUFFER_EOS,this.onBufferEos,this),e.off(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(Ee.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(Ee.FRAG_PARSED,this.onFragParsed,this),e.off(Ee.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new vf(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestParsed(e,t){let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.details=null,je.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const n=this.media=t.media;if(n&&wa){const u=this.mediaSource=new wa;u.addEventListener("sourceopen",this._onMediaSourceOpen),u.addEventListener("sourceended",this._onMediaSourceEnded),u.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(u),this._objectUrl=n.src,n.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:n}=this;if(t){if(je.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(u){je.warn(`[buffer-controller]: onMediaDetaching: ${u.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),e.src===n?(e.removeAttribute("src"),e.load()):je.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Ee.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{const t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(n){je.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,n)}}),this._initSourceBuffer()}onBufferCodecs(e,t){const n=this.getSourceBufferTypes().length;Object.keys(t).forEach(u=>{if(n){const _=this.tracks[u];if(_&&typeof _.buffer.changeType=="function"){const{id:g,codec:i,levelCodec:r,container:d,metadata:o}=t[u],l=(_.levelCodec||_.codec).replace(Ba,"$1"),c=(r||i).replace(Ba,"$1");if(l!==c){const E=`${d};codecs=${r||i}`;this.appendChangeType(u,E),je.log(`[buffer-controller]: switching codec ${l} to ${c}`),this.tracks[u]={buffer:_.buffer,codec:i,container:d,levelCodec:r,metadata:o,id:g}}}}else this.pendingTracks[u]=t[u]}),!n&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(e,t){const{operationQueue:n}=this,u={execute:()=>{const _=this.sourceBuffer[e];_&&(je.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),_.changeType(t)),n.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:_=>{je.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,_)}};n.append(u,e)}onBufferAppending(e,t){const{hls:n,operationQueue:u,tracks:_}=this,{data:g,type:i,frag:r,part:d,chunkMeta:o}=t,l=o.buffering[i],c=self.performance.now();l.start=c;const E=r.stats.buffering,m=d?d.stats.buffering:null;E.start===0&&(E.start=c),m&&m.start===0&&(m.start=c);const f=_.audio;let T=!1;i==="audio"&&(f==null?void 0:f.container)==="audio/mpeg"&&(T=!this.lastMpegAudioChunk||o.id===1||this.lastMpegAudioChunk.sn!==o.sn,this.lastMpegAudioChunk=o);const L=r.start,P={execute:()=>{if(l.executeStart=self.performance.now(),T){const O=this.sourceBuffer[i];if(O){const M=L-O.timestampOffset;Math.abs(M)>=.1&&(je.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${L} (delta: ${M}) sn: ${r.sn})`),O.timestampOffset=L)}}this.appendExecutor(g,i)},onStart:()=>{},onComplete:()=>{const O=self.performance.now();l.executeEnd=l.end=O,E.first===0&&(E.first=O),m&&m.first===0&&(m.first=O);const{sourceBuffer:M}=this,S={};for(const p in M)S[p]=Jt.getBuffered(M[p]);this.appendError=0,this.hls.trigger(Ee.BUFFER_APPENDED,{type:i,frag:r,part:d,chunkMeta:o,parent:r.type,timeRanges:S})},onError:O=>{je.error(`[buffer-controller]: Error encountered while trying to append to the ${i} SourceBuffer`,O);const M={type:Nt.MEDIA_ERROR,parent:r.type,details:st.BUFFER_APPEND_ERROR,frag:r,part:d,chunkMeta:o,error:O,err:O,fatal:!1};O.code===DOMException.QUOTA_EXCEEDED_ERR?M.details=st.BUFFER_FULL_ERROR:(this.appendError++,M.details=st.BUFFER_APPEND_ERROR,this.appendError>n.config.appendErrorMaxRetry&&(je.error(`[buffer-controller]: Failed ${n.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),M.fatal=!0)),n.trigger(Ee.ERROR,M)}};u.append(P,i)}onBufferFlushing(e,t){const{operationQueue:n}=this,u=_=>({execute:this.removeExecutor.bind(this,_,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Ee.BUFFER_FLUSHED,{type:_})},onError:g=>{je.warn(`[buffer-controller]: Failed to remove from ${_} SourceBuffer`,g)}});t.type?n.append(u(t.type),t.type):this.getSourceBufferTypes().forEach(_=>{n.append(u(_),_)})}onFragParsed(e,t){const{frag:n,part:u}=t,_=[],g=u?u.elementaryStreams:n.elementaryStreams;g[Xt.AUDIOVIDEO]?_.push("audiovideo"):(g[Xt.AUDIO]&&_.push("audio"),g[Xt.VIDEO]&&_.push("video"));const i=()=>{const r=self.performance.now();n.stats.buffering.end=r,u&&(u.stats.buffering.end=r);const d=u?u.stats:n.stats;this.hls.trigger(Ee.FRAG_BUFFERED,{frag:n,part:u,stats:d,id:n.type})};_.length===0&&je.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(i,_)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((u,_)=>{const g=this.sourceBuffer[_];return g&&(!t.type||t.type===_)&&(g.ending=!0,g.ended||(g.ended=!0,je.log(`[buffer-controller]: ${_} sourceBuffer now EOS`))),u&&!!(!g||g.ended)},!0)&&(je.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(_=>{const g=this.sourceBuffer[_];g&&(g.ending=!1)});const{mediaSource:u}=this;if(!u||u.readyState!=="open"){u&&je.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${u.readyState}`);return}je.log("[buffer-controller]: Calling mediaSource.endOfStream()"),u.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:e,details:t,media:n,sourceBuffer:u}=this;if(!n||t===null)return;const _=this.getSourceBufferTypes();if(!_.length)return;const g=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!bt(g)||g<0)return;const i=n.currentTime,r=t.levelTargetDuration,d=Math.max(g,r),o=Math.floor(i/r)*r-d;_.forEach(l=>{const c=u[l];if(c){const E=Jt.getBuffered(c);if(E.length>0&&o>E.start(0)){if(e.trigger(Ee.BACK_BUFFER_REACHED,{bufferEnd:o}),t.live)e.trigger(Ee.LIVE_BACK_BUFFER_REACHED,{bufferEnd:o});else if(c.ended&&E.end(E.length-1)-i<r*2){je.info(`[buffer-controller]: Cannot flush ${l} back buffer while SourceBuffer is in ended state`);return}e.trigger(Ee.BUFFER_FLUSHING,{startOffset:0,endOffset:o,type:l})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:t,media:n,mediaSource:u}=this,_=e.fragments[0].start+e.totalduration,g=n.duration,i=bt(u.duration)?u.duration:0;e.live&&t.config.liveDurationInfinity?(je.log("[buffer-controller]: Media Source duration is set to Infinity"),u.duration=1/0,this.updateSeekableRange(e)):(_>i&&_>g||!bt(g))&&(je.log(`[buffer-controller]: Updating Media Source duration to ${_.toFixed(3)}`),u.duration=_)}updateSeekableRange(e){const t=this.mediaSource,n=e.fragments;if(n.length&&e.live&&t!=null&&t.setLiveSeekableRange){const _=Math.max(0,n[0].start),g=Math.max(_,_+e.totalduration);t.setLiveSeekableRange(_,g)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:n}=this,u=Object.keys(n).length;if(u&&!e||u===2){this.createSourceBuffers(n),this.pendingTracks={};const _=this.getSourceBufferTypes();if(_.length)this.hls.trigger(Ee.BUFFER_CREATED,{tracks:this.tracks}),_.forEach(g=>{t.executeNext(g)});else{const g=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:g,reason:g.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:n}=this;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(const u in e)if(!t[u]){const _=e[u];if(!_)throw Error(`source buffer exists for track ${u}, however track does not`);const g=_.levelCodec||_.codec,i=`${_.container};codecs=${g}`;je.log(`[buffer-controller]: creating sourceBuffer(${i})`);try{const r=t[u]=n.addSourceBuffer(i),d=u;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[u]={buffer:r,codec:g,container:_.container,levelCodec:_.levelCodec,metadata:_.metadata,id:_.id}}catch(r){je.error(`[buffer-controller]: error while trying to add sourceBuffer: ${r.message}`),this.hls.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:i})}}}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){const{operationQueue:t}=this;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){const n=new Error(`${e} SourceBuffer error`);je.error(`[buffer-controller]: ${n}`,t),this.hls.trigger(Ee.ERROR,{type:Nt.MEDIA_ERROR,details:st.BUFFER_APPENDING_ERROR,error:n,fatal:!1});const u=this.operationQueue.current(e);u&&u.onError(t)}removeExecutor(e,t,n){const{media:u,mediaSource:_,operationQueue:g,sourceBuffer:i}=this,r=i[e];if(!u||!_||!r){je.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),g.shiftAndExecuteNext(e);return}const d=bt(u.duration)?u.duration:1/0,o=bt(_.duration)?_.duration:1/0,l=Math.max(0,t),c=Math.min(n,d,o);c>l&&!r.ending?(r.ended=!1,je.log(`[buffer-controller]: Removing [${l},${c}] from the ${e} SourceBuffer`),r.remove(l,c)):g.shiftAndExecuteNext(e)}appendExecutor(e,t){const{operationQueue:n,sourceBuffer:u}=this,_=u[t];if(!_){je.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),n.shiftAndExecuteNext(t);return}_.ended=!1,_.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){je.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:n}=this,u=t.map(_=>n.appendBlocker(_));Promise.all(u).then(()=>{e(),t.forEach(_=>{const g=this.sourceBuffer[_];g!=null&&g.updating||n.shiftAndExecuteNext(_)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,n){const u=this.sourceBuffer[e];if(!u)return;const _=n.bind(this,e);this.listeners[e].push({event:t,listener:_}),u.addEventListener(t,_)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(n=>{t.removeEventListener(n.event,n.listener)})}}const Ua={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Fs=function(e){let t=e;return Ua.hasOwnProperty(e)&&(t=Ua[e]),String.fromCharCode(t)},vr=15,br=100,Tf={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},yf={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Af={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Sf={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Rf=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Df{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;je.log(`${this.time} [${e}] ${n}`)}}}const Yr=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class ws{constructor(e,t,n,u,_){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=u||"black",this.flash=_||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const u=t[n];e.hasOwnProperty(u)&&(this[u]=e[u])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class If{constructor(e,t,n,u,_,g){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new ws(t,n,u,_,g)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Cf{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let t=0;t<br;t++)this.chars.push(new If);this.logger=e,this.pos=0,this.currPenState=new ws}equals(e){let t=!0;for(let n=0;n<br;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t}copy(e){for(let t=0;t<br;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<br;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>br&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=br)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Fs(e);if(this.pos>=br){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<br;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<br;n++){const u=this.chars[n].uchar;u!==" "&&(t=!1),e.push(u)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Ei{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<vr;t++)this.rows.push(new Cf(e));this.logger=e,this.currRow=vr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<vr;e++)this.rows[e].clear();this.currRow=vr-1}equals(e){let t=!0;for(let n=0;n<vr;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<vr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<vr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let i=0;i<vr;i++)this.rows[i].clear();const _=this.currRow+1-this.nrRollUpRows,g=this.lastOutputScreen;if(g){const i=g.rows[_].cueStartTime,r=this.logger.time;if(i&&r!==null&&i<r)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(g.rows[_+d])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const _=e.indent,g=Math.max(_-1,0);n.setCursor(e.indent),e.color=n.chars[g].penState.foreground}const u={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(u)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",u=-1;for(let _=0;_<vr;_++){const g=this.rows[_].getTextString();g&&(u=_+1,e?t.push("Row "+u+": '"+g+"'"):t.push(g.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class ka{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ei(n),this.nonDisplayedMemory=new Ei(n),this.lastOutputScreen=new Ei(n),this.currRollUpRow=this.displayedMemory.rows[vr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[vr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,u=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=u[n]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Ka{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const u=new Df;this.channels=[null,new ka(e,t,u),new ka(e+1,n,u)],this.cmdHistory=ja(),this.logger=u}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let n,u,_,g=!1;this.logger.time=e;for(let i=0;i<t.length;i+=2)if(u=t[i]&127,_=t[i+1]&127,!(u===0&&_===0)){if(this.logger.log(3,"["+Yr([t[i],t[i+1]])+"] -> ("+Yr([u,_])+")"),n=this.parseCmd(u,_),n||(n=this.parseMidrow(u,_)),n||(n=this.parsePAC(u,_)),n||(n=this.parseBackgroundAttributes(u,_)),!n&&(g=this.parseChars(u,_),g)){const r=this.currentChannel;r&&r>0?this.channels[r].insertChars(g):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!n&&!g&&this.logger.log(2,"Couldn't parse cleaned data "+Yr([u,_])+" orig: "+Yr([t[i],t[i+1]]))}}parseCmd(e,t){const{cmdHistory:n}=this,u=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,_=(e===23||e===31)&&t>=33&&t<=35;if(!(u||_))return!1;if(Wa(e,t,n))return tn(null,null,n),this.logger.log(3,"Repeated command ("+Yr([e,t])+") is dropped"),!0;const g=e===20||e===21||e===23?1:2,i=this.channels[g];return e===20||e===21||e===28||e===29?t===32?i.ccRCL():t===33?i.ccBS():t===34?i.ccAOF():t===35?i.ccAON():t===36?i.ccDER():t===37?i.ccRU(2):t===38?i.ccRU(3):t===39?i.ccRU(4):t===40?i.ccFON():t===41?i.ccRDC():t===42?i.ccTR():t===43?i.ccRTD():t===44?i.ccEDM():t===45?i.ccCR():t===46?i.ccENM():t===47&&i.ccEOC():i.ccTO(t-32),tn(e,t,n),this.currentChannel=g,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const u=this.channels[n];return u?(u.ccMIDROW(t),this.logger.log(3,"MIDROW ("+Yr([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const u=this.cmdHistory,_=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,g=(e===16||e===24)&&t>=64&&t<=95;if(!(_||g))return!1;if(Wa(e,t,u))return tn(null,null,u),!0;const i=e<=23?1:2;t>=64&&t<=95?n=i===1?Tf[e]:Af[e]:n=i===1?yf[e]:Sf[e];const r=this.channels[i];return r?(r.setPAC(this.interpretPAC(n,t)),tn(e,t,u),this.currentChannel=i,!0):!1}interpretPAC(e,t){let n;const u={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,u.underline=(n&1)===1,n<=13?u.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(u.italics=!0,u.color="white"):u.indent=Math.floor((n-16)/2)*4,u}parseChars(e,t){let n,u=null,_=null;if(e>=25?(n=2,_=e-8):(n=1,_=e),_>=17&&_<=19){let g;_===17?g=t+80:_===18?g=t+112:g=t+144,this.logger.log(2,"Special char '"+Fs(g)+"' in channel "+n),u=[g]}else e>=32&&e<=127&&(u=t===0?[e]:[e,t]);if(u){const g=Yr(u);this.logger.log(3,"Char codes =  "+g.join(",")),tn(e,t,this.cmdHistory)}return u}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,u=(e===23||e===31)&&t>=45&&t<=47;if(!(n||u))return!1;let _;const g={};e===16||e===24?(_=Math.floor((t-32)/2),g.background=Rf[_],t%2===1&&(g.background=g.background+"_semi")):t===45?g.background="transparent":(g.foreground="black",t===47&&(g.underline=!0));const i=e<=23?1:2;return this.channels[i].setBkgData(g),tn(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory=ja()}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function tn(b,e,t){t.a=b,t.b=e}function Wa(b,e,t){return t.a===b&&t.b===e}function ja(){return{a:null,b:null}}class Mn{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Yi=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;const b=["","lr","rl"],e=["start","middle","end","left","right"];function t(i,r){if(typeof r!="string"||!Array.isArray(i))return!1;const d=r.toLowerCase();return~i.indexOf(d)?d:!1}function n(i){return t(b,i)}function u(i){return t(e,i)}function _(i,...r){let d=1;for(;d<arguments.length;d++){const o=arguments[d];for(const l in o)i[l]=o[l]}return i}function g(i,r,d){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",E=!1,m=i,f=r,T=d,L=null,P="",O=!0,M="auto",S="start",p=50,h="middle",C=50,v="middle";Object.defineProperty(o,"id",_({},l,{get:function(){return c},set:function(I){c=""+I}})),Object.defineProperty(o,"pauseOnExit",_({},l,{get:function(){return E},set:function(I){E=!!I}})),Object.defineProperty(o,"startTime",_({},l,{get:function(){return m},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");m=I,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",_({},l,{get:function(){return f},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");f=I,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",_({},l,{get:function(){return T},set:function(I){T=""+I,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",_({},l,{get:function(){return L},set:function(I){L=I,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",_({},l,{get:function(){return P},set:function(I){const D=n(I);if(D===!1)throw new SyntaxError("An invalid or illegal string was specified.");P=D,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",_({},l,{get:function(){return O},set:function(I){O=!!I,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",_({},l,{get:function(){return M},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");M=I,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",_({},l,{get:function(){return S},set:function(I){const D=u(I);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");S=D,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",_({},l,{get:function(){return p},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");p=I,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",_({},l,{get:function(){return h},set:function(I){const D=u(I);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");h=D,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",_({},l,{get:function(){return C},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");C=I,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",_({},l,{get:function(){return v},set:function(I){const D=u(I);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");v=D,this.hasBeenReset=!0}})),o.displayState=void 0}return g.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},g}();class Pf{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Bs(b){function e(n,u,_,g){return(n|0)*3600+(u|0)*60+(_|0)+parseFloat(g||0)}const t=b.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class Mf{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let u=0;u<n.length;++u)if(t===n[u]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function Us(b,e,t,n){const u=n?b.split(n):[b];for(const _ in u){if(typeof u[_]!="string")continue;const g=u[_].split(t);if(g.length!==2)continue;const i=g[0],r=g[1];e(i,r)}}const Oi=new Yi(0,0,""),Ln=Oi.align==="middle"?"middle":"center";function Lf(b,e,t){const n=b;function u(){const i=Bs(b);if(i===null)throw new Error("Malformed timestamp: "+n);return b=b.replace(/^[^\sa-zA-Z-]+/,""),i}function _(i,r){const d=new Mf;Us(i,function(c,E){let m;switch(c){case"region":for(let f=t.length-1;f>=0;f--)if(t[f].id===E){d.set(c,t[f].region);break}break;case"vertical":d.alt(c,E,["rl","lr"]);break;case"line":m=E.split(","),d.integer(c,m[0]),d.percent(c,m[0])&&d.set("snapToLines",!1),d.alt(c,m[0],["auto"]),m.length===2&&d.alt("lineAlign",m[1],["start",Ln,"end"]);break;case"position":m=E.split(","),d.percent(c,m[0]),m.length===2&&d.alt("positionAlign",m[1],["start",Ln,"end","line-left","line-right","auto"]);break;case"size":d.percent(c,E);break;case"align":d.alt(c,E,["start",Ln,"end","left","right"]);break}},/:/,/\s/),r.region=d.get("region",null),r.vertical=d.get("vertical","");let o=d.get("line","auto");o==="auto"&&Oi.line===-1&&(o=-1),r.line=o,r.lineAlign=d.get("lineAlign","start"),r.snapToLines=d.get("snapToLines",!0),r.size=d.get("size",100),r.align=d.get("align",Ln);let l=d.get("position","auto");l==="auto"&&Oi.position===50&&(l=r.align==="start"||r.align==="left"?0:r.align==="end"||r.align==="right"?100:50),r.position=l}function g(){b=b.replace(/^\s+/,"")}if(g(),e.startTime=u(),g(),b.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);b=b.slice(3),g(),e.endTime=u(),g(),_(b,e)}function ks(b){return b.replace(/<br(?: \/)?>/gi,`
`)}class Of{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Pf,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let _=t.buffer,g=0;for(_=ks(_);g<_.length&&_[g]!=="\r"&&_[g]!==`
`;)++g;const i=_.slice(0,g);return _[g]==="\r"&&++g,_[g]===`
`&&++g,t.buffer=_.slice(g),i}function u(_){Us(_,function(g,i){},/:/)}try{let _="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;_=n();const i=_.match(/^()?WEBVTT([ \t].*)?$/);if(!(i!=null&&i[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let g=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(g?g=!1:_=n(),t.state){case"HEADER":/:/.test(_)?u(_):_||(t.state="ID");continue;case"NOTE":_||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(_)){t.state="NOTE";break}if(!_)continue;if(t.cue=new Yi(0,0,""),t.state="CUE",_.indexOf("-->")===-1){t.cue.id=_;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Lf(_,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const i=_.indexOf("-->")!==-1;if(!_||i&&(g=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=_}continue;case"BADCUE":_||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const bf=/\r\n|\n\r|\n|\r/g,_i=function(e,t,n=0){return e.slice(n,n+t.length)===t},xf=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),u=parseInt(e.slice(-9,-7)),_=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!bt(t)||!bt(n)||!bt(u)||!bt(_))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*u,t+=60*60*1e3*_,t},vi=function(e){let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return(t>>>0).toString()};function zi(b,e,t){return vi(b.toString())+vi(e.toString())+vi(t)}const Nf=function(e,t,n){let u=e[t],_=e[u.prevCC];if(!_||!_.new&&u.new){e.ccOffset=e.presentationOffset=u.start,u.new=!1;return}for(;(g=_)!=null&&g.new;){var g;e.ccOffset+=u.start-_.start,u.new=!1,u=_,_=e[u.prevCC]}e.presentationOffset=n};function Ff(b,e,t,n,u,_,g){const i=new Of,r=Cr(new Uint8Array(b)).trim().replace(bf,`
`).split(`
`),d=[],o=Vu(e.baseTime,e.timescale);let l="00:00.000",c=0,E=0,m,f=!0;i.oncue=function(T){const L=t[n];let P=t.ccOffset;const O=(c-o)/9e4;L!=null&&L.new&&(E!==void 0?P=t.ccOffset=L.start:Nf(t,n,O)),O&&(P=O-t.presentationOffset);const M=T.endTime-T.startTime,S=_r((T.startTime+P-E)*9e4,u*9e4)/9e4;T.startTime=Math.max(S,0),T.endTime=Math.max(S+M,0);const p=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(p)),T.id||(T.id=zi(T.startTime,T.endTime,p)),T.endTime>0&&d.push(T)},i.onparsingerror=function(T){m=T},i.onflush=function(){if(m){g(m);return}_(d)},r.forEach(T=>{if(f)if(_i(T,"X-TIMESTAMP-MAP=")){f=!1,T.slice(16).split(",").forEach(L=>{_i(L,"LOCAL:")?l=L.slice(6):_i(L,"MPEGTS:")&&(c=parseInt(L.slice(7)))});try{E=xf(l)/1e3}catch(L){m=L}return}else T===""&&(f=!1);i.parse(T+`
`)}),i.flush()}const pi="stpp.ttml.im1t",Ks=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ws=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,wf={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ga(b,e,t,n){const u=Yt(new Uint8Array(b),["mdat"]);if(u.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const _=u.map(i=>Cr(i)),g=Hu(e.baseTime,1,e.timescale);try{_.forEach(i=>t(Bf(i,g)))}catch(i){n(i)}}function Bf(b,e){const u=new DOMParser().parseFromString(b,"text/xml").getElementsByTagName("tt")[0];if(!u)throw new Error("Invalid ttml");const _={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},g=Object.keys(_).reduce((l,c)=>(l[c]=u.getAttribute(`ttp:${c}`)||_[c],l),{}),i=u.getAttribute("xml:space")!=="preserve",r=Ha(Ti(u,"styling","style")),d=Ha(Ti(u,"layout","region")),o=Ti(u,"body","[begin]");return[].map.call(o,l=>{const c=js(l,i);if(!c||!l.hasAttribute("begin"))return null;const E=Ai(l.getAttribute("begin"),g),m=Ai(l.getAttribute("dur"),g);let f=Ai(l.getAttribute("end"),g);if(E===null)throw Va(l);if(f===null){if(m===null)throw Va(l);f=E+m}const T=new Yi(E-e,f-e,c);T.id=zi(T.startTime,T.endTime,T.text);const L=d[l.getAttribute("region")],P=r[l.getAttribute("style")],O=Uf(L,P,r),{textAlign:M}=O;if(M){const S=wf[M];S&&(T.lineAlign=S),T.align=M}return rr(T,O),T}).filter(l=>l!==null)}function Ti(b,e,t){const n=b.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function Ha(b){return b.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function js(b,e){return[].slice.call(b.childNodes).reduce((t,n,u)=>{var _;return n.nodeName==="br"&&u?t+`
`:(_=n.childNodes)!=null&&_.length?js(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function Uf(b,e,t){const n="http://www.w3.org/ns/ttml#styling";let u=null;const _=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],g=b!=null&&b.hasAttribute("style")?b.getAttribute("style"):null;return g&&t.hasOwnProperty(g)&&(u=t[g]),_.reduce((i,r)=>{const d=yi(e,n,r)||yi(b,n,r)||yi(u,n,r);return d&&(i[r]=d),i},{})}function yi(b,e,t){return b&&b.hasAttributeNS(e,t)?b.getAttributeNS(e,t):null}function Va(b){return new Error(`Could not parse ttml timestamp ${b}`)}function Ai(b,e){if(!b)return null;let t=Bs(b);return t===null&&(Ks.test(b)?t=kf(b,e):Ws.test(b)&&(t=Kf(b,e))),t}function kf(b,e){const t=Ks.exec(b),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function Kf(b,e){const t=Ws.exec(b),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class Wf{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ya(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const t=new Mn(this,"textTrack1"),n=new Mn(this,"textTrack2"),u=new Mn(this,"textTrack3"),_=new Mn(this,"textTrack4");this.cea608Parser1=new Ka(1,t,n),this.cea608Parser2=new Ka(3,u,_)}e.on(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(Ee.FRAG_LOADING,this.onFragLoading,this),e.on(Ee.FRAG_LOADED,this.onFragLoaded,this),e.on(Ee.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(Ee.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(Ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(Ee.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Ee.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(Ee.FRAG_LOADING,this.onFragLoading,this),e.off(Ee.FRAG_LOADED,this.onFragLoaded,this),e.off(Ee.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(Ee.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(Ee.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(Ee.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(Ee.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,n,u,_){let g=!1;for(let i=_.length;i--;){const r=_[i],d=Gf(r[0],r[1],t,n);if(d>=0&&(r[0]=Math.min(r[0],t),r[1]=Math.max(r[1],n),g=!0,d/(n-t)>.5))return}if(g||_.push([t,n]),this.config.renderTextTracksNatively){const i=this.captionsTracks[e];this.Cues.newCue(i,t,n,u)}else{const i=this.Cues.newCue(null,t,n,u);this.hls.trigger(Ee.CUES_PARSED,{type:"captions",cues:i,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:u,timescale:_}){const{unparsedVttFrags:g}=this;n==="main"&&(this.initPTS[t.cc]={baseTime:u,timescale:_}),g.length&&(this.unparsedVttFrags=[],g.forEach(i=>{this.onFragLoaded(Ee.FRAG_LOADED,i)}))}getExistingTrack(e){const{media:t}=this;if(t)for(let n=0;n<t.textTracks.length;n++){const u=t.textTracks[n];if(u[e])return u}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:u}=this,{label:_,languageCode:g}=t[e],i=this.getExistingTrack(e);if(i)n[e]=i,rn(n[e]),cs(n[e],u);else{const r=this.createTextTrack("captions",_,g);r&&(r[e]=!0,n[e]=r)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,u={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=u,this.hls.trigger(Ee.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[u]})}createTextTrack(e,t,n){const u=this.media;if(u)return u.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{rn(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ya(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)rn(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],u=n.some(_=>_.textCodec===pi);if(this.config.enableWebVTT||u&&this.config.enableIMSC1){if(Ns(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const g=this.media?this.media.textTracks:null;this.tracks.forEach((i,r)=>{let d;if(g&&r<g.length){let o=null;for(let l=0;l<g.length;l++)if(jf(g[l],i)){o=g[l];break}o&&(d=o)}if(d)rn(d);else{const o=this._captionsOrSubtitlesFromCharacteristics(i);d=this.createTextTrack(o,i.name,i.lang),d&&(d.mode="disabled")}d&&(d.groupId=i.groupId,this.textTracks.push(d))})}else if(this.tracks.length){const g=this.tracks.map(i=>({label:i.name,kind:i.type.toLowerCase(),default:i.default,subtitleTrack:i}));this.hls.trigger(Ee.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:g})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){const t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),n=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&n)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const u=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!u)return;const _=`textTrack${u[1]}`,g=this.captionsProperties[_];g&&(g.label=n.name,n.lang&&(g.languageCode=n.lang),g.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){const{cea608Parser1:n,cea608Parser2:u,lastSn:_,lastPartIndex:g}=this;if(!(!this.enabled||!(n&&u))&&t.frag.type===wt.MAIN){var i,r;const d=t.frag.sn,o=(i=t==null||(r=t.part)==null?void 0:r.index)!=null?i:-1;d===_+1||d===_&&o===g+1||(n.reset(),u.reset()),this.lastSn=d,this.lastPartIndex=o}}onFragLoaded(e,t){const{frag:n,payload:u}=t,{initPTS:_,unparsedVttFrags:g}=this;if(n.type===wt.SUBTITLE)if(u.byteLength){if(!_[n.cc]){g.push(t),_.length&&this.hls.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")});return}const i=n.decryptdata,r="stats"in t;if(i==null||!i.encrypted||r){const d=this.tracks[n.level],o=this.vttCCs;o[n.cc]||(o[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),d&&d.textCodec===pi?this._parseIMSC1(n,u):this._parseVTTs(n,u,o)}}else this.hls.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Ga(t,this.initPTS[e.cc],u=>{this._appendCues(u,e.level),n.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},u=>{je.log(`Failed to parse IMSC1: ${u}`),n.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:u})})}_parseVTTs(e,t,n){var u;const _=this.hls,g=(u=e.initSegment)!=null&&u.data?Xr(e.initSegment.data,new Uint8Array(t)):t;Ff(g,this.initPTS[e.cc],n,e.cc,e.start,i=>{this._appendCues(i,e.level),_.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{this._fallbackToIMSC1(e,t),je.log(`Failed to parse VTT cue: ${i}`),_.trigger(Ee.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Ga(t,this.initPTS[e.cc],()=>{n.textCodec=pi,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const u=this.textTracks[t];if(!u||u.mode==="disabled")return;e.forEach(_=>ds(u,_))}else{const u=this.tracks[t];if(!u)return;const _=u.default?"default":"subtitles"+t;n.trigger(Ee.CUES_PARSED,{type:"subtitles",cues:e,track:_})}}onFragDecrypted(e,t){const{frag:n}=t;if(n.type===wt.SUBTITLE){if(!this.initPTS[n.cc]){this.unparsedVttFrags.push(t);return}this.onFragLoaded(Ee.FRAG_LOADED,t)}}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){const{cea608Parser1:n,cea608Parser2:u}=this;if(!this.enabled||!(n&&u))return;const{frag:_,samples:g}=t;if(!(_.type===wt.MAIN&&this.closedCaptionsForLevel(_)==="NONE"))for(let i=0;i<g.length;i++){const r=g[i].bytes;if(r){const d=this.extractCea608Data(r);n.addData(g[i].pts,d[0]),u.addData(g[i].pts,d[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:u,type:_}){const{media:g}=this;if(!(!g||g.currentTime<n)){if(!_||_==="video"){const{captionsTracks:i}=this;Object.keys(i).forEach(r=>Di(i[r],t,n))}if(this.config.renderTextTracksNatively&&t===0&&u!==void 0){const{textTracks:i}=this;Object.keys(i).forEach(r=>Di(i[r],t,u))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let u=2;for(let _=0;_<n;_++){const g=e[u++],i=127&e[u++],r=127&e[u++];if(i===0&&r===0)continue;if((4&g)!==0){const o=3&g;(o===0||o===1)&&(t[o].push(i),t[o].push(r))}}return t}}function jf(b,e){return!!b&&b.label===e.name&&!(b.textTrack1||b.textTrack2)}function Gf(b,e,t,n){return Math.min(e,n)-Math.max(b,t)}function Ya(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class $i{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(Ee.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Ee.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(Ee.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Ee.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const e=this.hls.levels;if(e.length){const t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((u,_)=>this.isLevelAllowed(u)&&_<=e);return this.clientRect=null,$i.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const u=(g,i)=>i?g.width!==i.width||g.height!==i.height:!0;let _=e.length-1;for(let g=0;g<e.length;g+=1){const i=e[g];if((i.width>=t||i.height>=n)&&u(i,e[g+1])){_=g;break}}return _}}class Hf{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Ee.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const u=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=u,u&&typeof u.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,n){const u=performance.now();if(t){if(this.lastTime){const _=u-this.lastTime,g=n-this.lastDroppedFrames,i=t-this.lastDecodedFrames,r=1e3*g/_,d=this.hls;if(d.trigger(Ee.FPS_DROP,{currentDropped:g,currentDecoded:i,totalDroppedFrames:n}),r>0&&g>d.config.fpsDroppedMonitoringThreshold*i){let o=d.currentLevel;je.warn("drop FPS ratio greater than max allowed value for currentLevel: "+o),o>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=o)&&(o=o-1,d.trigger(Ee.FPS_DROP_LEVEL_CAPPING,{level:o,droppedLevel:d.currentLevel}),d.autoLevelCapping=o,this.streamController.nextLevelSwitch())}}this.lastTime=u,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const On="[eme]";class nn{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=nn.CDMCleanupPromise?[nn.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=je.debug.bind(je,On),this.log=je.log.bind(je,On),this.warn=je.warn.bind(je,On),this.error=je.error.bind(je,On),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Ee.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Ee.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Ee.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Ee.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,u=t[e];if(u)return u.licenseUrl;if(e===qt.WIDEVINE&&n)return n;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(g,i,r)=>!!g&&r.indexOf(g)===i,u=t.map(g=>g.audioCodec).filter(n),_=t.map(g=>g.videoCodec).filter(n);return u.length+_.length===0&&_.push("avc1.42e01e"),new Promise((g,i)=>{const r=d=>{const o=d.shift();this.getMediaKeysPromise(o,u,_).then(l=>g({keySystem:o,mediaKeys:l})).catch(l=>{d.length?r(d):l instanceof mr?i(l):i(new mr({type:Nt.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_NO_ACCESS,error:l,fatal:!0},l.message))})};r(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let u=`Configured requestMediaKeySystemAccess is not a function ${n}`;return qa===null&&self.location.protocol==="http:"&&(u=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(u))}return n(e,t)}getMediaKeysPromise(e,t,n){const u=nl(e,t,n,this.config.drmSystemOptions),_=this.keySystemAccessPromises[e];let g=_==null?void 0:_.keySystemAccess;if(!g){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(u)}`),g=this.requestMediaKeySystemAccess(e,u);const i=this.keySystemAccessPromises[e]={keySystemAccess:g};return g.catch(r=>{this.log(`Failed to obtain access to key-system "${e}": ${r}`)}),g.then(r=>{this.log(`Access for key-system "${r.keySystem}" obtained`);const d=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),i.mediaKeys=r.createMediaKeys().then(o=>(this.log(`Media-keys created for "${e}"`),d.then(l=>l?this.setMediaKeysServerCertificate(o,e,l):o))),i.mediaKeys.catch(o=>{this.error(`Failed to create media-keys for "${e}"}: ${o}`)}),i.mediaKeys})}return g.then(()=>_.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${Dr.hexDump(e.keyId||[])}`);const u=n.createSession(),_={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:u,keyStatus:"status-pending"};return this.mediaKeySessions.push(_),_}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),u=this.getKeyIdString(t),_="cenc";this.keyIdToKeySessionPromise[u]=this.generateRequestWithPreferredKeySession(n,_,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Dr.hexDump(e.keyId)}updateKeySession(e,t){var n;const u=e.mediaKeysSession;return this.log(`Updating key-session "${u.sessionId}" for keyID ${Dr.hexDump(((n=e.decryptdata)==null?void 0:n.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),u.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,n)=>{const u=qn(this.config),_=e.map(ia).filter(g=>!!g&&u.indexOf(g)!==-1);return this.getKeySystemSelectionPromise(_).then(({keySystem:g})=>{const i=aa(g);i?t(i):n(new Error(`Unable to find format for key-system "${g}"`))}).catch(n)})}loadKey(e){const t=e.keyInfo.decryptdata,n=this.getKeyIdString(t),u=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${u}`);let _=this.keyIdToKeySessionPromise[n];return _||(_=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(t).then(({keySystem:g,mediaKeys:i})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${u}`),this.attemptSetMediaKeys(g,i).then(()=>{this.throwIfDestroyed();const r=this.createMediaKeySessionContext({keySystem:g,mediaKeys:i,decryptdata:t}),d="cenc";return this.generateRequestWithPreferredKeySession(r,d,t.pssh,"playlist-key")}))),_.catch(g=>this.handleError(g))),_}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof mr?this.hls.trigger(Ee.ERROR,e.data):this.hls.trigger(Ee.ERROR,{type:Nt.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){const u=ia(e.keyFormat),_=u?[u]:qn(this.config);return this.attemptKeySystemAccess(_)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=qn(this.config)),e.length===0)throw new mr({type:Nt.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:n}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),n===null)return;let u,_;if(t==="sinf"&&this.config.drmSystems[qt.FAIRPLAY]){const o=ir(new Uint8Array(n));try{const l=Ni(JSON.parse(o).sinf),c=os(new Uint8Array(l));if(!c)return;u=c.subarray(8,24),_=qt.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const o=Cl(n);if(o===null)return;o.version===0&&o.systemId===Za.WIDEVINE&&o.data&&(u=o.data.subarray(8,24)),_=rl(o.systemId)}if(!_||!u)return;const g=Dr.hexDump(u),{keyIdToKeySessionPromise:i,mediaKeySessions:r}=this;let d=i[g];for(let o=0;o<r.length;o++){const l=r[o],c=l.decryptdata;if(c.pssh||!c.keyId)continue;const E=Dr.hexDump(c.keyId);if(g===E||c.uri.replace(/-/g,"").indexOf(g)!==-1){d=i[E],delete i[E],c.pssh=new Uint8Array(n),c.keyId=u,d=i[g]=d.then(()=>this.generateRequestWithPreferredKeySession(l,t,n,"encrypted-event-key-match"));break}}d||(d=i[g]=this.getKeySystemSelectionPromise([_]).then(({keySystem:o,mediaKeys:l})=>{var c;this.throwIfDestroyed();const E=new gn("ISO-23001-7",g,(c=aa(o))!=null?c:"");return E.pssh=new Uint8Array(n),E.keyId=u,this.attemptSetMediaKeys(o,l).then(()=>{this.throwIfDestroyed();const m=this.createMediaKeySessionContext({decryptdata:E,keySystem:o,mediaKeys:l});return this.generateRequestWithPreferredKeySession(m,t,n,"encrypted-event-no-match")})})),d.catch(o=>this.handleError(o))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const u=Promise.all(n).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(u),u.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(u),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(_=>n.indexOf(_)===-1)})}generateRequestWithPreferredKeySession(e,t,n,u){var _,g;const i=(_=this.config.drmSystems)==null||(g=_[e.keySystem])==null?void 0:g.generateRequest;if(i)try{const c=i.call(this.hls,t,n,e);if(!c)throw new Error("Invalid response from configured generateRequest filter");t=c.initDataType,n=e.decryptdata.pssh=c.initData?new Uint8Array(c.initData):null}catch(c){var r;if(this.warn(c.message),(r=this.hls)!=null&&r.config.debug)throw c}if(n===null)return this.log(`Skipping key-session request for "${u}" (no initData)`),Promise.resolve(e);const d=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${u}": ${d} (init data type: ${t} length: ${n?n.byteLength:null})`);const o=new _n;e.mediaKeysSession.onmessage=c=>{const E=e.mediaKeysSession;if(!E){o.emit("error",new Error("invalid state"));return}const{messageType:m,message:f}=c;this.log(`"${m}" message event for session "${E.sessionId}" message size: ${f.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(e,f).catch(T=>{this.handleError(T),o.emit("error",T)}):m==="license-release"?e.keySystem===qt.FAIRPLAY&&(this.updateKeySession(e,Ja("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${m}"`)},e.mediaKeysSession.onkeystatuseschange=c=>{if(!e.mediaKeysSession){o.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const m=e.keyStatus;o.emit("keyStatus",m),m==="expired"&&(this.warn(`${e.keySystem} expired for key ${d}`),this.renewKeySession(e))};const l=new Promise((c,E)=>{o.on("error",E),o.on("keyStatus",m=>{m.startsWith("usable")?c():m==="output-restricted"?E(new mr({type:Nt.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):m==="internal-error"?E(new mr({type:Nt.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${m}"`)):m==="expired"?E(new Error("key expired while generating request")):this.warn(`unhandled key status change "${m}"`)})});return e.mediaKeysSession.generateRequest(t,n).then(()=>{var c;this.log(`Request generated for key-session "${(c=e.mediaKeysSession)==null?void 0:c.sessionId}" keyId: ${d}`)}).catch(c=>{throw new mr({type:Nt.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_NO_SESSION,error:c,fatal:!1},`Error generating key-session request: ${c}`)}).then(()=>l).catch(c=>{throw o.removeAllListeners(),this.removeSession(e),c}).then(()=>(o.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,n)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Dr.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${Dr.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,n=t.loader,u=new n(t),_=this.getServerCertificateUrl(e);return _?(this.log(`Fetching serverCertificate for "${e}"`),new Promise((g,i)=>{const r={responseType:"arraybuffer",url:_},d=t.certLoadPolicy.default,o={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},l={onSuccess:(c,E,m,f)=>{g(c.data)},onError:(c,E,m,f)=>{i(new mr({type:Nt.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:dr({url:r.url,data:void 0},c)},`"${e}" certificate request failed (${_}). Status: ${c.code} (${c.text})`))},onTimeout:(c,E,m)=>{i(new mr({type:Nt.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:r.url,data:void 0}},`"${e}" certificate request timed out (${_})`))},onAbort:(c,E,m)=>{i(new Error("aborted"))}};u.load(r,o,l)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((u,_)=>{e.setServerCertificate(n).then(g=>{this.log(`setServerCertificate ${g?"success":"not supported by CDM"} (${n==null?void 0:n.byteLength}) on "${t}"`),u(e)}).catch(g=>{_(new mr({type:Nt.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:g,fatal:!0},g.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(u=>{throw new mr({type:Nt.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:u,fatal:!0},u.message)}))}setupLicenseXHR(e,t,n,u){const _=this.config.licenseXhrSetup;return _?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return _.call(this.hls,e,t,n,u)}).catch(g=>{if(!n.decryptdata)throw g;return e.open("POST",t,!0),_.call(this.hls,e,t,n,u)}).then(g=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:g||u})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:u}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((u,_)=>{const g=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${g}`);const i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return _(new Error("invalid state"));if(i.readyState===4)if(i.status===200){this._requestLicenseFailureCount=0;let r=i.response;this.log(`License received ${r instanceof ArrayBuffer?r.byteLength:r}`);const d=this.config.licenseResponseCallback;if(d)try{r=d.call(this.hls,i,g,e)}catch(o){this.error(o)}u(r)}else{const r=n.errorRetry,d=r?r.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||i.status>=400&&i.status<500)_(new mr({type:Nt.KEY_SYSTEM_ERROR,details:st.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:g,data:void 0,code:i.status,text:i.statusText}},`License Request XHR failed (${g}). Status: ${i.status} (${i.statusText})`));else{const o=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${o} attempts left`),this.requestLicense(e,t).then(u,_)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=i,this.setupLicenseXHR(i,g,e,t).then(({xhr:r,licenseChallenge:d})=>{r.send(d)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},gn.clearKeyUriToKeyIdMap();const n=t.length;nn.CDMCleanupPromise=Promise.all(t.map(u=>this.removeSession(u)).concat(e==null?void 0:e.setMediaKeys(null).catch(u=>{this.log(`Could not clear media keys: ${u}. media.src: ${e==null?void 0:e.src}`)}))).then(()=>{n&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(u=>{this.log(`Could not close sessions and clear media keys: ${u}. media.src: ${e==null?void 0:e.src}`)})}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((u,_)=>(u.indexOf(_.keyFormat)===-1&&u.push(_.keyFormat),u),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),t.onmessage=null,t.onkeystatuseschange=null,n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const u=this.mediaKeySessions.indexOf(e);return u>-1&&this.mediaKeySessions.splice(u,1),t.remove().catch(_=>{this.log(`Could not remove session: ${_}`)}).then(()=>t.close()).catch(_=>{this.log(`Could not close session: ${_}`)})}}}nn.CDMCleanupPromise=void 0;class mr extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}const Vf=1;var lr={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"};const Yf="h";class kr{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=u=>{try{this.apply(u,{ot:lr.MANIFEST,su:!this.initialized})}catch(_){je.warn("Could not generate manifest CMCD data.",_)}},this.applyFragmentData=u=>{try{const _=u.frag,g=this.hls.levels[_.level],i=this.getObjectType(_),r={d:_.duration*1e3,ot:i};(i===lr.VIDEO||i===lr.AUDIO||i==lr.MUXED)&&(r.br=g.bitrate/1e3,r.tb=this.getTopBandwidth(i)/1e3,r.bl=this.getBufferLength(i)),this.apply(u,r)}catch(_){je.warn("Could not generate segment CMCD data.",_)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||kr.uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.registerListeners())}registerListeners(){const e=this.hls;e.on(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(Ee.MEDIA_DETACHED,this.onMediaDetached,this),e.on(Ee.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(Ee.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(Ee.MEDIA_DETACHED,this.onMediaDetached,this),e.off(Ee.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,u;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(u=t.tracks.video)==null?void 0:u.buffer}createData(){var e;return{v:Vf,sf:Yf,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){rr(t,this.createData());const n=t.ot===lr.INIT||t.ot===lr.VIDEO||t.ot===lr.MUXED;if(this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){const u=kr.toHeaders(t);if(!Object.keys(u).length)return;e.headers||(e.headers={}),rr(e.headers,u)}else{const u=kr.toQuery(t);if(!u)return;e.url=kr.appendQueryToUri(e.url,u)}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return lr.TIMED_TEXT;if(e.sn==="initSegment")return lr.INIT;if(t==="audio")return lr.AUDIO;if(t==="main")return this.hls.audioTracks.length?lr.VIDEO:lr.MUXED}getTopBandwidth(e){let t=0,n;const u=this.hls;if(e===lr.AUDIO)n=u.audioTracks;else{const _=u.maxAutoLevel,g=_>-1?_+1:u.levels.length;n=u.levels.slice(0,g)}for(const _ of n)_.bitrate>t&&(t=_.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,n=e===lr.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:Jt.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(_){this.loader=void 0,this.loader=new n(_)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(_,g,i){t(_),this.loader.load(_,g,i)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(_){this.loader=void 0,this.loader=new n(_)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(_,g,i){t(_),this.loader.load(_,g,i)}}}static uuid(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){const t=[],n=d=>!Number.isNaN(d)&&d!=null&&d!==""&&d!==!1,u=d=>Math.round(d),_=d=>u(d/100)*100,i={br:u,d:u,bl:_,dl:_,mtp:_,nor:d=>encodeURIComponent(d),rtp:_,tb:u},r=Object.keys(e||{}).sort();for(const d of r){let o=e[d];if(!n(o)||d==="v"&&o===1||d=="pr"&&o===1)continue;const l=i[d];l&&(o=l(o));const c=typeof o;let E;d==="ot"||d==="sf"||d==="st"?E=`${d}=${o}`:c==="boolean"?E=d:c==="number"?E=`${d}=${o}`:E=`${d}=${JSON.stringify(o)}`,t.push(E)}return t.join(",")}static toHeaders(e){const t=Object.keys(e),n={},u=["Object","Request","Session","Status"],_=[{},{},{},{}],g={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const i of t){const r=g[i]!=null?g[i]:1;_[r][i]=e[i]}for(let i=0;i<_.length;i++){const r=kr.serialize(_[i]);r&&(n[`CMCD-${u[i]}`]=r)}return n}static toQuery(e){return`CMCD=${encodeURIComponent(kr.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;const n=e.includes("?")?"&":"?";return`${e}${n}${t}`}}const zf=3e5;class $f{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=je.log.bind(je,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.on(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Ee.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(Ee.MANIFEST_LOADING,this.onManifestLoading,this),e.off(Ee.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(Ee.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Ee.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const e=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===fr.SendAlternateToPenaltyBox&&n.flags===Er.MoveAllAlternatesMatchingHost){let u=this.pathwayPriority;const _=this.pathwayId;this.penalizedPathways[_]||(this.penalizedPathways[_]=performance.now()),!u&&this.levels&&(u=this.levels.reduce((g,i)=>(g.indexOf(i.pathwayId)===-1&&g.push(i.pathwayId),g),[])),u&&u.length>1&&(this.updatePathwayPriority(u),n.resolved=this.pathwayId!==_)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t;const n=this.penalizedPathways,u=performance.now();Object.keys(n).forEach(_=>{u-n[_]>zf&&delete n[_]});for(let _=0;_<e.length;_++){const g=e[_];if(n[g])continue;if(g===this.pathwayId)return;const i=this.hls.nextLoadLevel,r=this.hls.levels[i];if(t=this.getLevelsForPathway(g),t.length>0){this.log(`Setting Pathway to "${g}"`),this.pathwayId=g,this.hls.trigger(Ee.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[i];r&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==r.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==r.bitrate&&this.log(`Unstable Pathways change from bitrate ${r.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=i);break}}}clonePathways(e){const t=this.levels;if(!t)return;const n={},u={};e.forEach(_=>{const{ID:g,"BASE-ID":i,"URI-REPLACEMENT":r}=_;if(t.some(o=>o.pathwayId===g))return;const d=this.getLevelsForPathway(i).map(o=>{const l=rr({},o);l.details=void 0,l.url=Gs(o.uri,o.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",r);const c=new Zt(o.attrs);c["PATHWAY-ID"]=g;const E=c.AUDIO&&`${c.AUDIO}_clone_${g}`,m=c.SUBTITLES&&`${c.SUBTITLES}_clone_${g}`;E&&(n[c.AUDIO]=E,c.AUDIO=E),m&&(u[c.SUBTITLES]=m,c.SUBTITLES=m),l.attrs=c;const f=new mn(l);return Bn(f,"audio",E),Bn(f,"text",m),f});t.push(...d),za(this.audioTracks,n,r,g),za(this.subtitleTracks,u,r,g)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let u;try{u=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(u.protocol!=="data:"){const o=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;u.searchParams.set("_HLS_pathway",this.pathwayId),u.searchParams.set("_HLS_throughput",""+o)}const _={responseType:"json",url:u.href},g=t.steeringManifestLoadPolicy.default,i=g.errorRetry||g.timeoutRetry||{},r={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:i.maxNumRetry||0,retryDelay:i.retryDelayMs||0,maxRetryDelay:i.maxRetryDelayMs||0},d={onSuccess:(o,l,c,E)=>{this.log(`Loaded steering manifest: "${u}"`);const m=o.data;if(m.VERSION!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":f,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":L}=m;if(f)try{this.uri=new self.URL(f,u).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${f}`);return}this.scheduleRefresh(this.uri||c.url),T&&this.clonePathways(T),L&&this.updatePathwayPriority(L)},onError:(o,l,c,E)=>{if(this.log(`Error loading steering manifest: ${o.code} ${o.text} (${l.url})`),this.stopLoad(),o.code===410){this.enabled=!1,this.log(`Steering manifest ${l.url} no longer available`);return}let m=this.timeToLoad*1e3;if(o.code===429){const f=this.loader;if(typeof(f==null?void 0:f.getResponseHeader)=="function"){const T=f.getResponseHeader("Retry-After");T&&(m=parseFloat(T)*1e3)}this.log(`Steering manifest ${l.url} rate limited`);return}this.scheduleRefresh(this.uri||l.url,m)},onTimeout:(o,l,c)=>{this.log(`Timeout loading steering manifest (${l.url})`),this.scheduleRefresh(this.uri||l.url)}};this.log(`Requesting steering manifest: ${u}`),this.loader.load(_,r,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(e)},t)}}function za(b,e,t,n){b&&Object.keys(e).forEach(u=>{const _=b.filter(g=>g.groupId===u).map(g=>{const i=rr({},g);return i.details=void 0,i.attrs=new Zt(i.attrs),i.url=i.attrs.URI=Gs(g.url,g.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),i.groupId=i.attrs["GROUP-ID"]=e[u],i.attrs["PATHWAY-ID"]=n,i});b.push(..._)})}function Gs(b,e,t,n){const{HOST:u,PARAMS:_,[t]:g}=n;let i;e&&(i=g==null?void 0:g[e],i&&(b=i));const r=new self.URL(b);return u&&!i&&(r.host=u),_&&Object.keys(_).sort().forEach(d=>{d&&r.searchParams.set(d,_[d])}),r.href}const Xf=/^age:\s*[\d.]+\s*$/im;class Hs{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new kn,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e)return;const n=this.loader=new self.XMLHttpRequest,u=this.stats;u.loading.first=0,u.loaded=0;const _=this.xhrSetup;_?Promise.resolve().then(()=>{if(!this.stats.aborted)return _(n,t.url)}).catch(g=>(n.open("GET",t.url,!0),_(n,t.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(g=>{this.callbacks.onError({code:n.status,text:g.message},t,n,u)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const u=this.context.headers,{maxTimeToFirstByteMs:_,maxLoadTimeMs:g}=n.loadPolicy;if(u)for(const i in u)e.setRequestHeader(i,u[i]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=_&&bt(_)?_:g,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const u=t.readyState,_=this.config;if(!n.aborted&&u>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),_.timeout!==_.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),_.timeout=_.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),_.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),u===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const g=t.status,i=t.responseType!=="text";if(g>=200&&g<300&&(i&&t.response||t.responseText!==null)){n.loading.end=Math.max(self.performance.now(),n.loading.first);const r=i?t.response:t.responseText,d=t.responseType==="arraybuffer"?r.byteLength:r.length;if(n.loaded=n.total=d,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first),!this.callbacks)return;const o=this.callbacks.onProgress;if(o&&o(n,e,r,t),!this.callbacks)return;const l={url:t.responseURL,data:r,code:g};this.callbacks.onSuccess(l,n,e,t)}else{const r=_.loadPolicy.errorRetry,d=n.retry;wn(r,d,!1,g)?this.retry(r):(je.error(`${g} while loading ${e.url}`),this.callbacks.onError({code:g,text:t.statusText},e,t,n))}}}loadtimeout(){var e;const t=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry,n=this.stats.retry;if(wn(t,n,!0))this.retry(t);else{je.warn(`timeout while loading ${this.context.url}`);const u=this.callbacks;u&&(this.abortInternal(),u.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=wi(e,n.retry),n.retry++,je.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Xf.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function Qf(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Jf=/(\d+)-(\d+)\/(\d+)/;class $a{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||tc,this.controller=new self.AbortController,this.stats=new kn}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const e=this.response;e!=null&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const u=this.stats;if(u.loading.start)throw new Error("Loader can only be used once.");u.loading.start=self.performance.now();const _=Zf(e,this.controller.signal),g=n.onProgress,i=e.responseType==="arraybuffer",r=i?"byteLength":"length",{maxTimeToFirstByteMs:d,maxLoadTimeMs:o}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,_),self.clearTimeout(this.requestTimeout),t.timeout=d&&bt(d)?d:o,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(u,e,this.response)},t.timeout),self.fetch(this.request).then(l=>{this.response=this.loader=l;const c=Math.max(self.performance.now(),u.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=o,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(u,e,this.response)},o-(c-u.loading.start)),!l.ok){const{status:E,statusText:m}=l;throw new rc(m||"fetch, bad network response",E,l)}return u.loading.first=c,u.total=ec(l.headers)||u.total,g&&bt(t.highWaterMark)?this.loadProgressively(l,u,e,t.highWaterMark,g):i?l.arrayBuffer():e.responseType==="json"?l.json():l.text()}).then(l=>{const{response:c}=this;self.clearTimeout(this.requestTimeout),u.loading.end=Math.max(self.performance.now(),u.loading.first);const E=l[r];E&&(u.loaded=u.total=E);const m={url:c.url,data:l,code:c.status};g&&!bt(t.highWaterMark)&&g(u,e,l,c),n.onSuccess(m,u,e,c)}).catch(l=>{if(self.clearTimeout(this.requestTimeout),u.aborted)return;const c=l&&l.code||0,E=l?l.message:null;n.onError({code:c,text:E},e,l?l.details:null,u)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,u=0,_){const g=new xs,i=e.body.getReader(),r=()=>i.read().then(d=>{if(d.done)return g.dataLength&&_(t,n,g.flush(),e),Promise.resolve(new ArrayBuffer(0));const o=d.value,l=o.length;return t.loaded+=l,l<u||g.dataLength?(g.push(o),g.dataLength>=u&&_(t,n,g.flush(),e)):_(t,n,o,e),r()}).catch(()=>Promise.reject());return r()}}function Zf(b,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(rr({},b.headers))};return b.rangeEnd&&t.headers.set("Range","bytes="+b.rangeStart+"-"+String(b.rangeEnd-1)),t}function qf(b){const e=Jf.exec(b);if(e)return parseInt(e[2])-parseInt(e[1])+1}function ec(b){const e=b.get("Content-Range");if(e){const n=qf(e);if(bt(n))return n}const t=b.get("Content-Length");if(t)return parseInt(t)}function tc(b,e){return new self.Request(b.url,e)}class rc extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const nc=/\s/,ic={newCue(b,e,t,n){const u=[];let _,g,i,r,d;const o=self.VTTCue||self.TextTrackCue;for(let c=0;c<n.rows.length;c++)if(_=n.rows[c],i=!0,r=0,d="",!_.isEmpty()){var l;for(let f=0;f<_.chars.length;f++)nc.test(_.chars[f].uchar)&&i?r++:(d+=_.chars[f].uchar,i=!1);_.cueStartTime=e,e===t&&(t+=1e-4),r>=16?r--:r++;const E=ks(d.trim()),m=zi(e,t,E);b!=null&&(l=b.cues)!=null&&l.getCueById(m)||(g=new o(e,t,E),g.id=m,g.line=c+1,g.align="left",g.position=10+Math.min(80,Math.floor(r*8/32)*10),u.push(g))}return b&&u.length&&(u.sort((c,E)=>c.line==="auto"||E.line==="auto"?0:c.line>8&&E.line>8?E.line-c.line:c.line-E.line),u.forEach(c=>ds(b,c))),u}},ac={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},sc=dr(dr({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Hs,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ff,bufferController:pf,capLevelController:$i,errorController:tu,fpsController:Hf,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:qa,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:ac},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},oc()),{},{subtitleStreamController:mf,subtitleTrackController:_f,timelineController:Wf,audioStreamController:df,audioTrackController:hf,emeController:nn,cmcdController:kr,contentSteeringController:$f});function oc(){return{cueHandler:ic,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function lc(b,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=bi(b),n=["manifest","level","frag"],u=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(_=>{const g=`${_==="level"?"playlist":_}LoadPolicy`,i=e[g]===void 0,r=[];u.forEach(d=>{const o=`${_}Loading${d}`,l=e[o];if(l!==void 0&&i){r.push(o);const c=t[g].default;switch(e[g]={default:c},d){case"TimeOut":c.maxLoadTimeMs=l,c.maxTimeToFirstByteMs=l;break;case"MaxRetry":c.errorRetry.maxNumRetry=l,c.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":c.errorRetry.retryDelayMs=l,c.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":c.errorRetry.maxRetryDelayMs=l,c.timeoutRetry.maxRetryDelayMs=l;break}}}),r.length&&je.warn(`hls.js config: "${r.join('", "')}" setting(s) are deprecated, use "${g}": ${JSON.stringify(e[g])}`)}),dr(dr({},t),e)}function bi(b){return b&&typeof b=="object"?Array.isArray(b)?b.map(bi):Object.keys(b).reduce((e,t)=>(e[t]=bi(b[t]),e),{}):b}function uc(b){const e=b.loader;e!==$a&&e!==Hs?(je.log("[config]: Custom loader detected, cannot enable progressive streaming"),b.progressive=!1):Qf()&&(b.loader=$a,b.progressive=!0,b.enableSoftwareAES=!0,je.log("[config]: Progressive streaming enabled, using FetchLoader"))}class Fr{static get version(){return"1.4.0"}static isSupported(){return Tu()}static get Events(){return Ee}static get ErrorTypes(){return Nt}static get ErrorDetails(){return st}static get DefaultConfig(){return Fr.defaultConfig?Fr.defaultConfig:sc}static set DefaultConfig(e){Fr.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new _n,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,Yo(e.debug||!1,"Hls instance");const t=this.config=lc(Fr.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&uc(t);const{abrController:n,bufferController:u,capLevelController:_,errorController:g,fpsController:i}=t,r=new g(this),d=this.abrController=new n(this),o=this.bufferController=new u(this),l=this.capLevelController=new _(this),c=new i(this),E=new wl(this),m=new Wl(this),f=t.contentSteeringController,T=f?new f(this):null,L=this.levelController=new nu(this,T),P=new iu(this),O=new su(this.config),M=this.streamController=new lf(this,P,O);l.setStreamController(M),c.setStreamController(M);const S=[E,L,M];T&&S.splice(1,0,T),this.networkControllers=S;const p=[d,o,l,c,m,P];this.audioTrackController=this.createController(t.audioTrackController,S);const h=t.audioStreamController;h&&S.push(new h(this,P,O)),this.subtitleTrackController=this.createController(t.subtitleTrackController,S);const C=t.subtitleStreamController;C&&S.push(new C(this,P,O)),this.createController(t.timelineController,p),O.emeController=this.emeController=this.createController(t.emeController,p),this.cmcdController=this.createController(t.cmcdController,p),this.latencyController=this.createController(jl,p),this.coreComponents=p,S.push(r);const v=r.onErrorOut;typeof v=="function"&&this.on(Ee.ERROR,v,r)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,u){this._emitter.off(e,t,n,u)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){je.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),this.trigger(Ee.ERROR,{type:Nt.OTHER_ERROR,details:st.INTERNAL_EXCEPTION,fatal:!1,event:e,error:n})}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){je.log("destroy"),this.trigger(Ee.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){je.log("attachMedia"),this._media=e,this.trigger(Ee.MEDIA_ATTACHING,{media:e})}detachMedia(){je.log("detachMedia"),this.trigger(Ee.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,n=this.url,u=this.url=hn.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});je.log(`loadSource:${u}`),t&&n&&n!==u&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(Ee.MANIFEST_LOADING,{url:e})}startLoad(e=-1){je.log(`startLoad(${e})`),this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){je.log("stopLoad"),this.networkControllers.forEach(e=>{e.stopLoad()})}swapAudioCodec(){je.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){je.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e,t=0){this.levelController.removeLevel(e,t)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){je.log(`set currentLevel:${e}`),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){je.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){je.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){je.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){return this.levelController.startLevel}set startLevel(e){je.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(je.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Ci.indexOf(e)>-1&&(this._maxHdcpLevel=e)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let u=0;u<n;u++)if(e[u].maxBitrate>=t)return u;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let u;if(t===-1&&e&&e.length?u=e.length-1:u=t,n)for(let _=u;_--;){const g=e[_].attrs["HDCP-LEVEL"];if(g&&g<=n)return _}return u}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Fr.defaultConfig=void 0;var xi={},fc={get exports(){return xi},set exports(b){xi=b}};(function(b,e){(function(n,u){b.exports=u()})(self,()=>(()=>{var t={"./externals/base64.js":(g,i)=>{var r={};r.encode=function(o){for(var l=[],c=0;c<o.length;++c){var E=o.charCodeAt(c);E<128?l.push(E):E<2048?(l.push(192|E>>6),l.push(128|63&E)):E<65536?(l.push(224|E>>12),l.push(128|63&E>>6),l.push(128|63&E)):(l.push(240|E>>18),l.push(128|63&E>>12),l.push(128|63&E>>6),l.push(128|63&E))}return l},r.decode=function(o){for(var l=[],c=0;c<o.length;){var E=o[c++];E<128||(E<224?(E=(31&E)<<6,E|=63&o[c++]):E<240?(E=(15&E)<<12,E|=(63&o[c++])<<6,E|=63&o[c++]):(E=(7&E)<<18,E|=(63&o[c++])<<12,E|=(63&o[c++])<<6,E|=63&o[c++])),l.push(String.fromCharCode(E))}return l.join("")};var d={};(function(o){var l=function(T){for(var L=0,P=[],O=0|T.length/3;0<O--;){var M=(T[L]<<16)+(T[L+1]<<8)+T[L+2];L+=3,P.push(o.charAt(63&M>>18)),P.push(o.charAt(63&M>>12)),P.push(o.charAt(63&M>>6)),P.push(o.charAt(63&M))}if(T.length-L==2){var M=(T[L]<<16)+(T[L+1]<<8);P.push(o.charAt(63&M>>18)),P.push(o.charAt(63&M>>12)),P.push(o.charAt(63&M>>6)),P.push("=")}else if(T.length-L==1){var M=T[L]<<16;P.push(o.charAt(63&M>>18)),P.push(o.charAt(63&M>>12)),P.push("==")}return P.join("")},c=function(){for(var f=[],T=0;T<o.length;++T)f[o.charCodeAt(T)]=T;return f["=".charCodeAt(0)]=0,f}(),E=function(T){for(var L=0,P=[],O=0|T.length/4;0<O--;){var M=(c[T.charCodeAt(L)]<<18)+(c[T.charCodeAt(L+1)]<<12)+(c[T.charCodeAt(L+2)]<<6)+c[T.charCodeAt(L+3)];P.push(255&M>>16),P.push(255&M>>8),P.push(255&M),L+=4}return P&&(T.charAt(L-2)=="="?(P.pop(),P.pop()):T.charAt(L-1)=="="&&P.pop()),P},m={};m.encode=function(f){for(var T=[],L=0;L<f.length;++L)T.push(f.charCodeAt(L));return T},m.decode=function(f){for(var T=0;T<s.length;++T)a[T]=String.fromCharCode(a[T]);return a.join("")},d.decodeArray=function(f){var T=E(f);return new Uint8Array(T)},d.encodeASCII=function(f){var T=m.encode(f);return l(T)},d.decodeASCII=function(f){var T=E(f);return m.decode(T)},d.encode=function(f){var T=r.encode(f);return l(T)},d.decode=function(f){var T=E(f);return r.decode(T)}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),i.decode=d.decode,i.decodeArray=d.decodeArray,i.encode=d.encode,i.encodeASCII=d.encodeASCII},"./externals/cea608-parser.js":(g,i)=>{(function(r){var d={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o=function(A){var x=A;return d.hasOwnProperty(A)&&(x=d[A]),String.fromCharCode(x)},l=15,c=32,E={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},m={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},T={25:2,26:4,29:6,30:8,31:10,27:13,28:15},L=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],P={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(A){this.time=A},log:function(A,x){var F=this.verboseFilter[A];this.verboseLevel>=F&&console.log(this.time+" ["+A+"] "+x)}},O=function(A){for(var x=[],F=0;F<A.length;F++)x.push(A[F].toString(16));return x},M=function(A,x,F,k,W){this.foreground=A||"white",this.underline=x||!1,this.italics=F||!1,this.background=k||"black",this.flash=W||!1};M.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(A){for(var x=["foreground","underline","italics","background","flash"],F=0;F<x.length;F++){var k=x[F];A.hasOwnProperty(k)&&(this[k]=A[k])}},isDefault:function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},equals:function(A){return this.foreground===A.foreground&&this.underline===A.underline&&this.italics===A.italics&&this.background===A.background&&this.flash===A.flash},copy:function(A){this.foreground=A.foreground,this.underline=A.underline,this.italics=A.italics,this.background=A.background,this.flash=A.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var S=function(A,x,F,k,W,V){this.uchar=A||" ",this.penState=new M(x,F,k,W,V)};S.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(A,x){this.uchar=A,this.penState.copy(x)},setPenState:function(A){this.penState.copy(A)},equals:function(A){return this.uchar===A.uchar&&this.penState.equals(A.penState)},copy:function(A){this.uchar=A.uchar,this.penState.copy(A.penState)},isEmpty:function(){return this.uchar===" "&&this.penState.isDefault()}};var p=function(){this.chars=[];for(var A=0;A<c;A++)this.chars.push(new S);this.pos=0,this.currPenState=new M};p.prototype={equals:function(A){for(var x=!0,F=0;F<c;F++)if(!this.chars[F].equals(A.chars[F])){x=!1;break}return x},copy:function(A){for(var x=0;x<c;x++)this.chars[x].copy(A.chars[x])},isEmpty:function(){for(var A=!0,x=0;x<c;x++)if(!this.chars[x].isEmpty()){A=!1;break}return A},setCursor:function(A){this.pos!==A&&(this.pos=A),this.pos<0?(P.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>c&&(P.log("ERROR","Too large cursor position "+this.pos),this.pos=c)},moveCursor:function(A){var x=this.pos+A;if(A>1)for(var F=this.pos+1;F<x+1;F++)this.chars[F].setPenState(this.currPenState);this.setCursor(x)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(A){A>=144&&this.backSpace();var x=o(A);if(this.pos>=c){P.log("ERROR","Cannot insert "+A.toString(16)+" ("+x+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(x,this.currPenState),this.moveCursor(1)},clearFromPos:function(A){var x;for(x=A;x<c;x++)this.chars[x].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var A=[],x=!0,F=0;F<c;F++){var k=this.chars[F].uchar;k!==" "&&(x=!1),A.push(k)}return x?"":A.join("")},setPenStyles:function(A){this.currPenState.setStyles(A);var x=this.chars[this.pos];x.setPenState(this.currPenState)}};var h=function(){this.rows=[];for(var A=0;A<l;A++)this.rows.push(new p);this.currRow=l-1,this.nrRollUpRows=null,this.reset()};h.prototype={reset:function(){for(var A=0;A<l;A++)this.rows[A].clear();this.currRow=l-1},equals:function(A){for(var x=!0,F=0;F<l;F++)if(!this.rows[F].equals(A.rows[F])){x=!1;break}return x},copy:function(A){for(var x=0;x<l;x++)this.rows[x].copy(A.rows[x])},isEmpty:function(){for(var A=!0,x=0;x<l;x++)if(!this.rows[x].isEmpty()){A=!1;break}return A},backSpace:function(){var A=this.rows[this.currRow];A.backSpace()},clearToEndOfRow:function(){var A=this.rows[this.currRow];A.clearToEndOfRow()},insertChar:function(A){var x=this.rows[this.currRow];x.insertChar(A)},setPen:function(A){var x=this.rows[this.currRow];x.setPenStyles(A)},moveCursor:function(A){var x=this.rows[this.currRow];x.moveCursor(A)},setCursor:function(A){P.log("INFO","setCursor: "+A);var x=this.rows[this.currRow];x.setCursor(A)},setPAC:function(A){P.log("INFO","pacData = "+JSON.stringify(A));var x=A.row-1;this.nrRollUpRows&&x<this.nrRollUpRows-1&&(x=this.nrRollUpRows-1),this.currRow=x;var F=this.rows[this.currRow];if(A.indent!==null){var k=A.indent,W=Math.max(k-1,0);F.setCursor(A.indent),A.color=F.chars[W].penState.foreground}var V={foreground:A.color,underline:A.underline,italics:A.italics,background:"black",flash:!1};this.setPen(V)},setBkgData:function(A){P.log("INFO","bkgData = "+JSON.stringify(A)),this.backSpace(),this.setPen(A),this.insertChar(32)},setRollUpRows:function(A){this.nrRollUpRows=A},rollUp:function(){if(this.nrRollUpRows===null){P.log("DEBUG","roll_up but nrRollUpRows not set yet");return}P.log("TEXT",this.getDisplayText());var A=this.currRow+1-this.nrRollUpRows,x=this.rows.splice(A,1)[0];x.clear(),this.rows.splice(this.currRow,0,x),P.log("INFO","Rolling up")},getDisplayText:function(A){A=A||!1;for(var x=[],F="",k=-1,W=0;W<l;W++){var V=this.rows[W].getTextString();V&&(k=W+1,A?x.push("Row "+k+': "'+V+'"'):x.push(V.trim()))}return x.length>0&&(A?F="["+x.join(" | ")+"]":F=x.join(`
`)),F},getTextAndFormat:function(){return this.rows}};var C=function(A,x){this.chNr=A,this.outputFilter=x,this.mode=null,this.verbose=0,this.displayedMemory=new h,this.nonDisplayedMemory=new h,this.lastOutputScreen=new h,this.currRollUpRow=this.displayedMemory.rows[l-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};C.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[l-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(A){this.outputFilter=A},setPAC:function(A){this.writeScreen.setPAC(A)},setBkgData:function(A){this.writeScreen.setBkgData(A)},setMode:function(A){A!==this.mode&&(this.mode=A,P.log("INFO","MODE="+A),this.mode=="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=A)},insertChars:function(A){for(var x=0;x<A.length;x++)this.writeScreen.insertChar(A[x]);var F=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";P.log("INFO",F+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(P.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){P.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){P.log("INFO","BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){P.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(A){P.log("INFO","RU("+A+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(A)},cc_FON:function(){P.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){P.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){P.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){P.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){P.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){P.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){P.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(P.log("INFO","EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var A=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=A,this.writeScreen=this.nonDisplayedMemory,P.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(A){P.log("INFO","TO("+A+") - Tab Offset"),this.writeScreen.moveCursor(A)},cc_MIDROW:function(A){var x={flash:!1};if(x.underline=A%2===1,x.italics=A>=46,x.italics)x.foreground="white";else{var F=Math.floor(A/2)-16,k=["white","green","blue","cyan","red","yellow","magenta"];x.foreground=k[F]}P.log("INFO","MIDROW: "+JSON.stringify(x)),this.writeScreen.setPen(x)},outputDataUpdate:function(){var A=P.time;A!==null&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(A,this.displayedMemory),this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=A:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,A,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:A),this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(A){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,A,this.displayedMemory),this.cueStartTime=A))}};var v=function(A,x,F){this.field=A||1,this.outputs=[x,F],this.channels=[new C(1,x),new C(2,F)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};v.prototype={getHandler:function(A){return this.channels[A].getHandler()},setHandler:function(A,x){this.channels[A].setHandler(x)},addData:function(A,x){var F,k,W,V=!1;this.lastTime=A,P.setTime(A);for(var Q=0;Q<x.length;Q+=2){if(k=x[Q]&127,W=x[Q+1]&127,k>=16&&k<=31&&k===this.lastCmdA&&W===this.lastCmdB){this.lastCmdA=null,this.lastCmdB=null,P.log("DEBUG","Repeated command ("+O([k,W])+") is dropped");continue}if(k===0&&W===0){this.dataCounters.padding+=2;continue}else P.log("DATA","["+O([x[Q],x[Q+1]])+"] -> ("+O([k,W])+")");if(F=this.parseCmd(k,W),F||(F=this.parseMidrow(k,W)),F||(F=this.parsePAC(k,W)),F||(F=this.parseBackgroundAttributes(k,W)),!F&&(V=this.parseChars(k,W),V))if(this.currChNr&&this.currChNr>=0){var $=this.channels[this.currChNr-1];$.insertChars(V)}else P.log("WARNING","No channel found yet. TEXT-MODE?");F?this.dataCounters.cmd+=2:V?this.dataCounters.char+=2:(this.dataCounters.other+=2,P.log("WARNING","Couldn't parse cleaned data "+O([k,W])+" orig: "+O([x[Q],x[Q+1]])))}},parseCmd:function(A,x){var F=null,k=(A===20||A===21||A===28||A===29)&&32<=x&&x<=47,W=(A===23||A===31)&&33<=x&&x<=35;if(!(k||W))return!1;A===20||A===21||A===23?F=1:F=2;var V=this.channels[F-1];return A===20||A===21||A===28||A===29?x===32?V.cc_RCL():x===33?V.cc_BS():x===34?V.cc_AOF():x===35?V.cc_AON():x===36?V.cc_DER():x===37?V.cc_RU(2):x===38?V.cc_RU(3):x===39?V.cc_RU(4):x===40?V.cc_FON():x===41?V.cc_RDC():x===42?V.cc_TR():x===43?V.cc_RTD():x===44?V.cc_EDM():x===45?V.cc_CR():x===46?V.cc_ENM():x===47&&V.cc_EOC():V.cc_TO(x-32),this.lastCmdA=A,this.lastCmdB=x,this.currChNr=F,!0},parseMidrow:function(A,x){var F=null;if((A===17||A===25)&&32<=x&&x<=47){if(A===17?F=1:F=2,F!==this.currChNr)return P.log("ERROR","Mismatch channel in midrow parsing"),!1;var k=this.channels[F-1];return k.insertChars([32]),k.cc_MIDROW(x),P.log("DEBUG","MIDROW ("+O([A,x])+")"),this.lastCmdA=A,this.lastCmdB=x,!0}return!1},parsePAC:function(A,x){var F=null,k=null,W=(17<=A&&A<=23||25<=A&&A<=31)&&64<=x&&x<=127,V=(A===16||A===24)&&64<=x&&x<=95;if(!(W||V))return!1;F=A<=23?1:2,64<=x&&x<=95?k=F===1?E[A]:f[A]:k=F===1?m[A]:T[A];var Q=this.interpretPAC(k,x),$=this.channels[F-1];return $.setPAC(Q),this.lastCmdA=A,this.lastCmdB=x,this.currChNr=F,!0},interpretPAC:function(A,x){var F=x,k={color:null,italics:!1,indent:null,underline:!1,row:A};return x>95?F=x-96:F=x-64,k.underline=(F&1)===1,F<=13?k.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(F/2)]:F<=15?(k.italics=!0,k.color="white"):k.indent=Math.floor((F-16)/2)*4,k},parseChars:function(A,x){var F=null,k=null,W=null;if(A>=25?(F=2,W=A-8):(F=1,W=A),17<=W&&W<=19){var V=x;W===17?V=x+80:W===18?V=x+112:V=x+144,P.log("INFO","Special char '"+o(V)+"' in channel "+F),k=[V],this.lastCmdA=A,this.lastCmdB=x}else 32<=A&&A<=127&&(k=x===0?[A]:[A,x],this.lastCmdA=null,this.lastCmdB=null);if(k){var Q=O(k);P.log("DEBUG","Char codes =  "+Q.join(","))}return k},parseBackgroundAttributes:function(A,x){var F,k,W,V,Q=(A===16||A===24)&&32<=x&&x<=47,$=(A===23||A===31)&&45<=x&&x<=47;return Q||$?(F={},A===16||A===24?(k=Math.floor((x-32)/2),F.background=L[k],x%2===1&&(F.background=F.background+"_semi")):x===45?F.background="transparent":(F.foreground="black",x===47&&(F.underline=!0)),W=A<24?1:2,V=this.channels[W-1],V.setBkgData(F),this.lastCmdA=A,this.lastCmdB=x,!0):!1},reset:function(){for(var A=0;A<this.channels.length;A++)this.channels[A]&&this.channels[A].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(A){for(var x=0;x<this.channels.length;x++)this.channels[x]&&this.channels[x].cueSplitAtTime(A)}};var I=function(A,x,F){for(var k=0,W=x,V=0,Q=[],$=function(ne,ae,ce,X){if(ne!==4||ae<8)return null;var oe=ce.getUint8(X),ge=ce.getUint16(X+1),_e=ce.getUint32(X+3),he=ce.getUint8(X+7);return oe==181&&ge==49&&_e==1195456820&&he==3};W<x+F;){if(k=A.getUint32(W),V=A.getUint8(W+4)&31,V===6)for(var K=W+5,Y=-1;K<W+4+k-1;){Y=0;for(var re=255;re===255;)re=A.getUint8(K),Y+=re,K++;var ie=0;for(re=255;re===255;)re=A.getUint8(K),ie+=re,K++;$(Y,ie,A,K)&&Q.push([K,ie]),K+=ie}W+=k+4}return Q},D=function(A,x){var F=x[0],k=[[],[]];F+=8;var W=A.getUint8(F)&31;F+=2;for(var V=0;V<W;V++){var Q=A.getUint8(F),$=Q&4,K=Q&3;F++;var Y=A.getUint8(F);F++;var re=A.getUint8(F);F++,$&&(Y&127)+(re&127)!==0&&(K===0?(k[0].push(Y),k[0].push(re)):K===1&&(k[1].push(Y),k[1].push(re)))}return k};r.logger=P,r.PenState=M,r.CaptionScreen=h,r.Cea608Parser=v,r.findCea608Nalus=I,r.extractCea608DataFromRange=D})(i)},"./externals/xml2json.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>o});function d(l){var c="1.2.0";l=l||{},E();function E(){l.escapeMode===void 0&&(l.escapeMode=!0),l.attributePrefix===void 0&&(l.attributePrefix="_"),l.arrayAccessForm=l.arrayAccessForm||"none",l.emptyNodeForm=l.emptyNodeForm||"text",l.enableToStringFunc===void 0&&(l.enableToStringFunc=!0),l.arrayAccessFormPaths=l.arrayAccessFormPaths||[],l.skipEmptyTextNodesForObj===void 0&&(l.skipEmptyTextNodesForObj=!0),l.stripWhitespaces===void 0&&(l.stripWhitespaces=!0),l.datetimeAccessFormPaths=l.datetimeAccessFormPaths||[],l.useDoubleQuotes===void 0&&(l.useDoubleQuotes=!1),l.xmlElementsFilter=l.xmlElementsFilter||[],l.jsonPropertiesFilter=l.jsonPropertiesFilter||[],l.keepCData===void 0&&(l.keepCData=!1),l.ignoreRoot===void 0&&(l.ignoreRoot=!1)}var m={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};function f($){var K=$.localName;return K==null&&(K=$.baseName),(K==null||K=="")&&(K=$.nodeName),K}function T($){return $.prefix}function L($){return typeof $=="string"?$.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):$}function P($,K,Y,re){for(var ie=0;ie<$.length;ie++){var ee=$[ie];if(typeof ee=="string"){if(ee==re)break}else if(ee instanceof RegExp){if(ee.test(re))break}else if(typeof ee=="function"&&ee(K,Y,re))break}return ie!=$.length}function O($,K,Y){switch(l.arrayAccessForm){case"property":$[K]instanceof Array?$[K+"_asArray"]=$[K]:$[K+"_asArray"]=[$[K]];break}!($[K]instanceof Array)&&l.arrayAccessFormPaths.length>0&&P(l.arrayAccessFormPaths,$,K,Y)&&($[K]=[$[K]])}function M($){var K=$.split(/[-T:+Z]/g),Y=new Date(K[0],K[1]-1,K[2]),re=K[5].split(".");if(Y.setHours(K[3],K[4],re[0]),re.length>1&&Y.setMilliseconds(re[1]),K[6]&&K[7]){var ie=K[6]*60+Number(K[7]),ee=/\d\d-\d\d:\d\d$/.test($)?"-":"+";ie=0+(ee=="-"?-1*ie:ie),Y.setMinutes(Y.getMinutes()-ie-Y.getTimezoneOffset())}else $.indexOf("Z",$.length-1)!==-1&&(Y=new Date(Date.UTC(Y.getFullYear(),Y.getMonth(),Y.getDate(),Y.getHours(),Y.getMinutes(),Y.getSeconds(),Y.getMilliseconds())));return Y}function S($,K,Y){if(l.datetimeAccessFormPaths.length>0){var re=Y.split(".#")[0];return P(l.datetimeAccessFormPaths,$,K,re)?M($):$}else return $}function p($,K,Y,re){return K==m.ELEMENT_NODE&&l.xmlElementsFilter.length>0?P(l.xmlElementsFilter,$,Y,re):!0}function h($,K){if($.nodeType==m.DOCUMENT_NODE){for(var Y=new Object,re=$.childNodes,ie=0;ie<re.length;ie++){var ee=re[ie];if(ee.nodeType==m.ELEMENT_NODE)if(l.ignoreRoot)Y=h(ee);else{Y={};var ne=f(ee);Y[ne]=h(ee)}}return Y}else if($.nodeType==m.ELEMENT_NODE){var Y=new Object;Y.__cnt=0;for(var ae=[],re=$.childNodes,ie=0;ie<re.length;ie++){var ee=re[ie],ne=f(ee);if(ee.nodeType!=m.COMMENT_NODE){var ce=K+"."+ne;if(p(Y,ee.nodeType,ne,ce))if(Y.__cnt++,Y[ne]==null){var X=h(ee,ce);if(ne!="#text"||/[^\s]/.test(X)){var oe={};oe[ne]=X,ae.push(oe)}Y[ne]=X,O(Y,ne,ce)}else{Y[ne]!=null&&(Y[ne]instanceof Array||(Y[ne]=[Y[ne]],O(Y,ne,ce)));var X=h(ee,ce);if(ne!="#text"||/[^\s]/.test(X)){var oe={};oe[ne]=X,ae.push(oe)}Y[ne][Y[ne].length]=X}}}Y.__children=ae;for(var ge=f($),_e=0;_e<$.attributes.length;_e++){var he=$.attributes[_e];Y.__cnt++;for(var se=he.value,Z=0,q=l.matchers.length;Z<q;Z++){var le=l.matchers[Z];le.test(he,ge)&&(se=le.converter(he.value))}Y[l.attributePrefix+he.name]=se}var te=T($);return te!=null&&te!=""&&(Y.__cnt++,Y.__prefix=te),Y["#text"]!=null&&(Y.__text=Y["#text"],Y.__text instanceof Array&&(Y.__text=Y.__text.join(`
`)),l.stripWhitespaces&&(Y.__text=Y.__text.trim()),delete Y["#text"],l.arrayAccessForm=="property"&&delete Y["#text_asArray"],Y.__text=S(Y.__text,ne,K+"."+ne)),Y["#cdata-section"]!=null&&(Y.__cdata=Y["#cdata-section"],delete Y["#cdata-section"],l.arrayAccessForm=="property"&&delete Y["#cdata-section_asArray"]),Y.__cnt==0&&l.emptyNodeForm=="text"?Y="":Y.__cnt==1&&Y.__text!=null?Y=Y.__text:Y.__cnt==1&&Y.__cdata!=null&&!l.keepCData?Y=Y.__cdata:Y.__cnt>1&&Y.__text!=null&&l.skipEmptyTextNodesForObj&&(l.stripWhitespaces&&Y.__text==""||Y.__text.trim()=="")&&delete Y.__text,delete Y.__cnt,l.enableToStringFunc&&(Y.__text!=null||Y.__cdata!=null)&&(Y.toString=function(){return(this.__text!=null?this.__text:"")+(this.__cdata!=null?this.__cdata:"")}),Y}else if($.nodeType==m.TEXT_NODE||$.nodeType==m.CDATA_SECTION_NODE)return $.nodeValue}function C($,K,Y,re){var ie="<"+($!=null&&$.__prefix!=null?$.__prefix+":":"")+K;if(Y!=null)for(var ee=0;ee<Y.length;ee++){var ne=Y[ee],ae=$[ne];l.escapeMode&&(ae=L(ae)),ie+=" "+ne.substr(l.attributePrefix.length)+"=",l.useDoubleQuotes?ie+='"'+ae+'"':ie+="'"+ae+"'"}return re?ie+="/>":ie+=">",ie}function v($,K){return"</"+($.__prefix!=null?$.__prefix+":":"")+K+">"}function I($,K){return $.indexOf(K,$.length-K.length)!==-1}function D($,K){return!!(l.arrayAccessForm=="property"&&I(K.toString(),"_asArray")||K.toString().indexOf(l.attributePrefix)==0||K.toString().indexOf("__")==0||$[K]instanceof Function)}function y($){var K=0;if($ instanceof Object)for(var Y in $)D($,Y)||K++;return K}function A($,K,Y){return l.jsonPropertiesFilter.length==0||Y==""||P(l.jsonPropertiesFilter,$,K,Y)}function x($){var K=[];if($ instanceof Object)for(var Y in $)Y.toString().indexOf("__")==-1&&Y.toString().indexOf(l.attributePrefix)==0&&K.push(Y);return K}function F($){var K="";return $.__cdata!=null&&(K+="<![CDATA["+$.__cdata+"]]>"),$.__text!=null&&(l.escapeMode?K+=L($.__text):K+=$.__text),K}function k($){var K="";return $ instanceof Object?K+=F($):$!=null&&(l.escapeMode?K+=L($):K+=$),K}function W($,K){return $===""?K:$+"."+K}function V($,K,Y,re){var ie="";if($.length==0)ie+=C($,K,Y,!0);else for(var ee=0;ee<$.length;ee++)ie+=C($[ee],K,x($[ee]),!1),ie+=Q($[ee],W(re,K)),ie+=v($[ee],K);return ie}function Q($,K){var Y="",re=y($);if(re>0){for(var ie in $)if(!(D($,ie)||K!=""&&!A($,ie,W(K,ie)))){var ee=$[ie],ne=x(ee);if(ee==null||ee==null)Y+=C(ee,ie,ne,!0);else if(ee instanceof Object)if(ee instanceof Array)Y+=V(ee,ie,ne,K);else if(ee instanceof Date)Y+=C(ee,ie,ne,!1),Y+=ee.toISOString(),Y+=v(ee,ie);else{var ae=y(ee);ae>0||ee.__text!=null||ee.__cdata!=null?(Y+=C(ee,ie,ne,!1),Y+=Q(ee,W(K,ie)),Y+=v(ee,ie)):Y+=C(ee,ie,ne,!0)}else Y+=C(ee,ie,ne,!1),Y+=k(ee),Y+=v(ee,ie)}}return Y+=k($),Y}this.parseXmlString=function($){if($===void 0)return null;var K;if(window.DOMParser){var Y=new window.DOMParser;try{K=Y.parseFromString($,"text/xml"),K.getElementsByTagNameNS("*","parsererror").length>0&&(K=null)}catch{K=null}}else $.indexOf("<?")==0&&($=$.substr($.indexOf("?>")+2)),K=new ActiveXObject("Microsoft.XMLDOM"),K.async="false",K.loadXML($);return K},this.asArray=function($){return $===void 0||$==null?[]:$ instanceof Array?$:[$]},this.toXmlDateTime=function($){return $ instanceof Date?$.toISOString():typeof $=="number"?new Date($).toISOString():null},this.asDateTime=function($){return typeof $=="string"?M($):$},this.xml2json=function($){return h($)},this.xml_str2json=function($){var K=this.parseXmlString($);return K!=null?this.xml2json(K):null},this.json2xml_str=function($){return Q($,"")},this.json2xml=function($){var K=this.json2xml_str($);return this.parseXmlString(K)},this.getVersion=function(){return c}}const o=d},"./index_mediaplayerOnly.js":(g,i,r)=>{r.r(i),r.d(i,{Debug:()=>l.default,FactoryMaker:()=>o.default,MediaPlayer:()=>d.default,default:()=>f});var d=r("./src/streaming/MediaPlayer.js"),o=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),c=r("./src/core/Version.js");r("./node_modules/es6-promise/auto.js");var E=typeof window<"u"&&window||r.g,m=E.dashjs;m||(m=E.dashjs={}),m.MediaPlayer=d.default,m.FactoryMaker=o.default,m.Debug=l.default,m.Version=(0,c.getVersionString)();const f=m},"./src/core/Debug.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>M});var d=r("./src/core/EventBus.js"),o=r("./src/core/events/Events.js"),l=r("./src/core/FactoryMaker.js"),c=0,E=1,m=2,f=3,T=4,L=5;function P(S){S=S||{};var p=this.context,h=(0,d.default)(p).getInstance(),C=S.settings,v=[],I,D,y,A;function x(){D=!0,y=!0,A=new Date().getTime(),typeof window<"u"&&window.console&&(v[E]=F(window.console.error),v[m]=F(window.console.error),v[f]=F(window.console.warn),v[T]=F(window.console.info),v[L]=F(window.console.debug))}function F(ee){return ee&&ee.bind?ee.bind(window.console):window.console.log.bind(window.console)}function k(ee){return{fatal:Q.bind(ee),error:$.bind(ee),warn:K.bind(ee),info:Y.bind(ee),debug:re.bind(ee)}}function W(ee){D=ee}function V(ee){y=ee}function Q(){for(var ee=arguments.length,ne=new Array(ee),ae=0;ae<ee;ae++)ne[ae]=arguments[ae];ie.apply(void 0,[E,this].concat(ne))}function $(){for(var ee=arguments.length,ne=new Array(ee),ae=0;ae<ee;ae++)ne[ae]=arguments[ae];ie.apply(void 0,[m,this].concat(ne))}function K(){for(var ee=arguments.length,ne=new Array(ee),ae=0;ae<ee;ae++)ne[ae]=arguments[ae];ie.apply(void 0,[f,this].concat(ne))}function Y(){for(var ee=arguments.length,ne=new Array(ee),ae=0;ae<ee;ae++)ne[ae]=arguments[ae];ie.apply(void 0,[T,this].concat(ne))}function re(){for(var ee=arguments.length,ne=new Array(ee),ae=0;ae<ee;ae++)ne[ae]=arguments[ae];ie.apply(void 0,[L,this].concat(ne))}function ie(ee,ne){var ae="",ce=null;D&&(ce=new Date().getTime(),ae+="["+(ce-A)+"]"),y&&ne&&ne.getClassName&&(ae+="["+ne.getClassName()+"]",ne.getType&&(ae+="["+ne.getType()+"]")),ae.length>0&&(ae+=" ");for(var X=arguments.length,oe=new Array(X>2?X-2:0),ge=2;ge<X;ge++)oe[ge-2]=arguments[ge];Array.apply(null,oe).forEach(function(_e){ae+=_e+" "}),v[ee]&&C&&C.get().debug.logLevel>=ee&&v[ee](ae),C&&C.get().debug.dispatchEvent&&h.trigger(o.default.LOG,{message:ae,level:ee})}return I={getLogger:k,setLogTimestampVisible:W,setCalleeNameVisible:V},x(),I}P.__dashjs_factory_name="Debug";var O=l.default.getSingletonFactory(P);O.LOG_LEVEL_NONE=c,O.LOG_LEVEL_FATAL=E,O.LOG_LEVEL_ERROR=m,O.LOG_LEVEL_WARNING=f,O.LOG_LEVEL_INFO=T,O.LOG_LEVEL_DEBUG=L,l.default.updateSingletonFactory(P.__dashjs_factory_name,O);const M=O},"./src/core/EventBus.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>f});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/MediaPlayerEvents.js"),l=0,c=5e3;function E(){var T={};function L(h,C,v){var I=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(!h)throw new Error("event type cannot be null or undefined");if(!C||typeof C!="function")throw new Error("listener must be a function: "+C);var D=I.priority||l;if(!(M(h,C,v)>=0)){T[h]=T[h]||[];var y={callback:C,scope:v,priority:D};v&&v.getStreamId&&(y.streamId=v.getStreamId()),v&&v.getType&&(y.mediaType=v.getType()),I&&I.mode&&(y.mode=I.mode);var A=T[h].some(function(x,F){if(x&&D>x.priority)return T[h].splice(F,0,y),!0});A||T[h].push(y)}}function P(h,C,v){if(!(!h||!C||!T[h])){var I=M(h,C,v);I<0||(T[h][I]=null)}}function O(h){var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!(!h||!T[h])){if(C=C||{},C.hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");C.type=h,v.streamId&&(C.streamId=v.streamId),v.mediaType&&(C.mediaType=v.mediaType),T[h].filter(function(I){return!(!I||v.streamId&&I.streamId&&I.streamId!==v.streamId||v.mediaType&&I.mediaType&&I.mediaType!==v.mediaType||v.mode&&I.mode&&I.mode!==v.mode||!I.mode&&v.mode&&v.mode===o.default.EVENT_MODE_ON_RECEIVE)}).forEach(function(I){return I&&I.callback.call(I.scope,C)})}}function M(h,C,v){var I=-1;return T[h]&&T[h].some(function(D,y){if(D&&D.callback===C&&(!v||v===D.scope))return I=y,!0}),I}function S(){T={}}var p={on:L,off:P,trigger:O,reset:S};return p}E.__dashjs_factory_name="EventBus";var m=d.default.getSingletonFactory(E);m.EVENT_PRIORITY_LOW=l,m.EVENT_PRIORITY_HIGH=c,d.default.updateSingletonFactory(E.__dashjs_factory_name,m);const f=m},"./src/core/FactoryMaker.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>o});var d=function(){var l,c=[],E={},m={};function f(y,A,x,F){!F[y]&&A&&(F[y]={instance:A,override:x})}function T(y,A){for(var x in c){var F=c[x];if(F.context===y&&F.name===A)return F.instance}return null}function L(y,A,x){for(var F in c){var k=c[F];if(k.context===y&&k.name===A){c[F].instance=x;return}}c.push({name:A,context:y,instance:x})}function P(y){c=c.filter(function(A){return A.context!==y})}function O(y,A){return A[y]}function M(y,A,x){y in x&&(x[y]=A)}function S(y,A){M(y,A,m)}function p(y){return O(y,m)}function h(y){var A=O(y.__dashjs_factory_name,m);return A||(A=function(F){return F===void 0&&(F={}),{create:function(){return D(y,F,arguments)}}},m[y.__dashjs_factory_name]=A),A}function C(y,A){M(y,A,E)}function v(y){return O(y,E)}function I(y){var A=O(y.__dashjs_factory_name,E);return A||(A=function(F){var k;return F===void 0&&(F={}),{getInstance:function(){return k||(k=T(F,y.__dashjs_factory_name)),k||(k=D(y,F,arguments),c.push({name:y.__dashjs_factory_name,context:F,instance:k})),k}}},E[y.__dashjs_factory_name]=A),A}function D(y,A,x){var F,k=y.__dashjs_factory_name,W=A[k];if(W){var V=W.instance;if(W.override){F=y.apply({context:A},x),V=V.apply({context:A,factory:l,parent:F},x);for(var Q in V)F.hasOwnProperty(Q)&&(F[Q]=V[Q])}else return V.apply({context:A,factory:l},x)}else F=y.apply({context:A},x);return F.getClassName=function(){return k},F}return l={extend:f,getSingletonInstance:T,setSingletonInstance:L,deleteSingletonInstances:P,getSingletonFactory:I,getSingletonFactoryByName:v,updateSingletonFactory:C,getClassFactory:h,getClassFactoryByName:p,updateClassFactory:S},l}();const o=d},"./src/core/Settings.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>M});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Utils.js"),l=r("./src/core/Debug.js"),c=r("./src/streaming/constants/Constants.js"),E=r("./src/streaming/vo/metrics/HTTPRequest.js"),m=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js");function T(S){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?T=function(h){return typeof h}:T=function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},T(S)}function L(S,p,h){return p in S?Object.defineProperty(S,p,{value:h,enumerable:!0,configurable:!0,writable:!0}):S[p]=h,S}function P(){var S,p,h,C=this.context,v=(0,m.default)(C).getInstance(),I={"streaming.delay.liveDelay":f.default.SETTING_UPDATED_LIVE_DELAY,"streaming.delay.liveDelayFragmentCount":f.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,"streaming.liveCatchup.enabled":f.default.SETTING_UPDATED_CATCHUP_ENABLED,"streaming.liveCatchup.playbackRate.min":f.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,"streaming.liveCatchup.playbackRate.max":f.default.SETTING_UPDATED_PLAYBACK_RATE_MAX},D={debug:{logLevel:l.default.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{abandonLoadTimeout:1e4,wallclockTimeUpdateInterval:100,manifestUpdateRetryInterval:100,cacheInitSegments:!1,applyServiceDescription:!0,applyProducerReferenceTime:!0,applyContentSteering:!0,eventControllerRefreshDelay:100,enableManifestDurationMismatchFix:!0,enableManifestTimescaleMismatchFix:!1,capabilities:{filterUnsupportedEssentialProperties:!0,useMediaCapabilitiesApi:!1},timeShiftBuffer:{calcFromSegmentTimeline:!1,fallbackToSegmentTimeline:!0},metrics:{maxListDepth:100},delay:{liveDelayFragmentCount:NaN,liveDelay:NaN,useSuggestedPresentationDelay:!0},protection:{keepProtectionMediaKeys:!1,ignoreEmeEncryptedEvent:!1,detectPlayreadyMessageFormat:!0},buffer:{enableSeekDecorrelationFix:!1,fastSwitchEnabled:!0,flushBufferAtTrackSwitch:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,initialBufferLevel:NaN,stableBufferTime:12,longFormContentDurationThreshold:600,stallThreshold:.3,useAppendWindow:!0,setStallState:!0,avoidCurrentTimeRangePruning:!1,useChangeTypeForTrackSwitch:!0},gaps:{jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,threshold:.3,enableSeekFix:!0,enableStallFix:!1,stallSeek:.1},utcSynchronization:{enabled:!0,useManifestDateHeaderTimeSource:!0,backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"https://time.akamai.com/?iso&ms"}},scheduling:{defaultTimeout:500,lowLatencyTimeout:0,scheduleWhilePaused:!0},text:{defaultEnabled:!0,extendSegmentedCues:!0,webvtt:{customRenderingEnabled:!1}},liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN},playbackBufferMin:.5,enabled:null,mode:c.default.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},cacheLoadThresholds:{video:50,audio:5},trackSwitchMode:{audio:c.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:c.default.TRACK_SWITCH_MODE_NEVER_REPLACE},selectionModeForInitialTrack:c.default.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY,fragmentRequestTimeout:2e4,manifestRequestTimeout:1e4,retryIntervals:(S={},L(S,E.HTTPRequest.MPD_TYPE,500),L(S,E.HTTPRequest.XLINK_EXPANSION_TYPE,500),L(S,E.HTTPRequest.MEDIA_SEGMENT_TYPE,1e3),L(S,E.HTTPRequest.INIT_SEGMENT_TYPE,1e3),L(S,E.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),L(S,E.HTTPRequest.INDEX_SEGMENT_TYPE,1e3),L(S,E.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE,1e3),L(S,E.HTTPRequest.LICENSE,1e3),L(S,E.HTTPRequest.OTHER_TYPE,1e3),L(S,"lowLatencyReductionFactor",10),S),retryAttempts:(p={},L(p,E.HTTPRequest.MPD_TYPE,3),L(p,E.HTTPRequest.XLINK_EXPANSION_TYPE,1),L(p,E.HTTPRequest.MEDIA_SEGMENT_TYPE,3),L(p,E.HTTPRequest.INIT_SEGMENT_TYPE,3),L(p,E.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),L(p,E.HTTPRequest.INDEX_SEGMENT_TYPE,3),L(p,E.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE,3),L(p,E.HTTPRequest.LICENSE,3),L(p,E.HTTPRequest.OTHER_TYPE,3),L(p,"lowLatencyMultiplyFactor",5),p),abr:{movingAverageMethod:c.default.MOVING_AVERAGE_SLIDING_WINDOW,ABRStrategy:c.default.ABR_STRATEGY_DYNAMIC,additionalAbrRules:{insufficientBufferRule:!0,switchHistoryRule:!0,droppedFramesRule:!0,abandonRequestsRule:!0},bandwidthSafetyFactor:.9,useDefaultABRRules:!0,useDeadTimeLatency:!0,limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},maxRepresentationRatio:{audio:1,video:1},initialBitrate:{audio:-1,video:-1},initialRepresentationRatio:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0},fetchThroughputCalculationMode:c.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING},cmcd:{enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:c.default.CMCD_MODE_QUERY,enabledKeys:["br","d","ot","tb","bl","dl","mtp","nor","nrr","su","bs","rtp","cid","pr","sf","sid","st","v"]},cmsd:{enabled:!1,abr:{applyMb:!1,etpWeightRatio:0}}},errors:{recoverAttempts:{mediaErrorDecode:5}}},y=o.default.clone(D);function A(W,V,Q){for(var $ in W)W.hasOwnProperty($)&&(V.hasOwnProperty($)?T(W[$])==="object"&&!(W[$]instanceof Array)&&W[$]!==null?A(W[$],V[$],Q.slice()+$+"."):(V[$]=o.default.clone(W[$]),I[Q+$]&&v.trigger(I[Q+$])):console.error("Settings parameter "+Q+$+" is not supported"))}function x(){return y}function F(W){T(W)==="object"&&A(W,y,"")}function k(){y=o.default.clone(D)}return h={get:x,update:F,reset:k},h}P.__dashjs_factory_name="Settings";var O=d.default.getSingletonFactory(P);const M=O},"./src/core/Utils.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>L});var d=r("./node_modules/path-browserify/index.js"),o=r.n(d),l=r("./node_modules/ua-parser-js/src/ua-parser.js");function c(P){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?c=function(M){return typeof M}:c=function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(P)}function E(P,O){if(!(P instanceof O))throw new TypeError("Cannot call a class as a function")}function m(P,O){for(var M=0;M<O.length;M++){var S=O[M];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(P,S.key,S)}}function f(P,O,M){return O&&m(P.prototype,O),M&&m(P,M),P}var T=function(){function P(){E(this,P)}return f(P,null,[{key:"mixin",value:function(M,S,p){var h,C={};if(M)for(var v in S)S.hasOwnProperty(v)&&(h=S[v],(!(v in M)||M[v]!==h&&(!(v in C)||C[v]!==h))&&(c(M[v])==="object"&&M[v]!==null?M[v]=P.mixin(M[v],h,p):M[v]=p(h)));return M}},{key:"clone",value:function(M){if(!M||c(M)!=="object")return M;var S;if(M instanceof Array){S=[];for(var p=0,h=M.length;p<h;++p)p in M&&S.push(P.clone(M[p]))}else S={};return P.mixin(S,M,P.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(M,S){try{if(!S||S.length===0)return M;var p=new URL(M);return S.forEach(function(h){h.key&&h.value&&p.searchParams.set(h.key,h.value)}),p.href}catch{return M}}},{key:"parseHttpHeaders",value:function(M){var S={};if(!M)return S;for(var p=M.trim().split(`\r
`),h=0,C=p.length;h<C;h++){var v=p[h],I=v.indexOf(": ");I>0&&(S[v.substring(0,I)]=v.substring(I+2))}return S}},{key:"generateUuid",value:function(){var M=new Date().getTime(),S="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(p){var h=(M+Math.random()*16)%16|0;return M=Math.floor(M/16),(p=="x"?h:h&3|8).toString(16)});return S}},{key:"generateHashCode",value:function(M){var S=0;if(M.length===0)return S;for(var p=0;p<M.length;p++){var h=M.charCodeAt(p);S=(S<<5)-S+h,S|=0}return S}},{key:"getRelativeUrl",value:function(M,S){try{var p=new URL(M),h=new URL(S);if(p.protocol=h.protocol,p.origin!==h.origin)return S;var C=o().relative(p.pathname.substr(0,p.pathname.lastIndexOf("/")),h.pathname.substr(0,h.pathname.lastIndexOf("/"))),v=C.length===0?1:0;return C+=h.pathname.substr(h.pathname.lastIndexOf("/")+v,h.pathname.length-1),h.pathname.length<C.length?h.pathname:C}catch{return S}}},{key:"parseUserAgent",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;try{var S=M===null&&typeof navigator<"u"?navigator.userAgent.toLowerCase():"";return(0,l.UAParser)(S)}catch{return{}}}}]),P}();const L=T},"./src/core/Version.js":(g,i,r)=>{r.r(i),r.d(i,{getVersionString:()=>o});var d="4.6.0";function o(){return d}},"./src/core/errors/Errors.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/core/errors/ErrorsBase.js");function o(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(C){return typeof C}:o=function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},o(p)}function l(p,h){if(!(p instanceof h))throw new TypeError("Cannot call a class as a function")}function c(p,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(h&&h.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),h&&E(p,h)}function E(p,h){return E=Object.setPrototypeOf||function(v,I){return v.__proto__=I,v},E(p,h)}function m(p){var h=L();return function(){var v=P(p),I;if(h){var D=P(this).constructor;I=Reflect.construct(v,arguments,D)}else I=v.apply(this,arguments);return f(this,I)}}function f(p,h){return h&&(o(h)==="object"||typeof h=="function")?h:T(p)}function T(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(p){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},P(p)}var O=function(p){c(C,p);var h=m(C);function C(){var v;return l(this,C),v=h.call(this),v.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,v.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,v.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,v.SEGMENT_BASE_LOADER_ERROR_CODE=15,v.TIME_SYNC_FAILED_ERROR_CODE=16,v.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,v.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,v.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,v.APPEND_ERROR_CODE=20,v.REMOVE_ERROR_CODE=21,v.DATA_UPDATE_FAILED_ERROR_CODE=22,v.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,v.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,v.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,v.DOWNLOAD_ERROR_ID_SIDX_CODE=26,v.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,v.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,v.DOWNLOAD_ERROR_ID_XLINK_CODE=29,v.MANIFEST_ERROR_ID_PARSE_CODE=31,v.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,v.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,v.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,v.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,v.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",v.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",v.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",v.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",v.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",v.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segment ranges from sidx",v.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize client and server time",v.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",v.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",v.APPEND_ERROR_MESSAGE="chunk is not defined",v.REMOVE_ERROR_MESSAGE="Removing data from the SourceBuffer",v.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",v.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",v.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",v.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",v.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : ",v}return C}(d.default),M=new O;const S=M},"./src/core/errors/ErrorsBase.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});function d(m,f){if(!(m instanceof f))throw new TypeError("Cannot call a class as a function")}function o(m,f){for(var T=0;T<f.length;T++){var L=f[T];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(m,L.key,L)}}function l(m,f,T){return f&&o(m.prototype,f),T&&o(m,T),m}var c=function(){function m(){d(this,m)}return l(m,[{key:"extend",value:function(T,L){if(T){var P=L?L.override:!1,O=L?L.publicOnly:!1;for(var M in T)!T.hasOwnProperty(M)||this[M]&&!P||O&&T[M].indexOf("public_")===-1||(this[M]=T[M])}}}]),m}();const E=c},"./src/core/events/CoreEvents.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>M});var d=r("./src/core/events/EventsBase.js");function o(S){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(h){return typeof h}:o=function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},o(S)}function l(S,p){if(!(S instanceof p))throw new TypeError("Cannot call a class as a function")}function c(S,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(p&&p.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),p&&E(S,p)}function E(S,p){return E=Object.setPrototypeOf||function(C,v){return C.__proto__=v,C},E(S,p)}function m(S){var p=L();return function(){var C=P(S),v;if(p){var I=P(this).constructor;v=Reflect.construct(C,arguments,I)}else v=C.apply(this,arguments);return f(this,v)}}function f(S,p){return p&&(o(p)==="object"||typeof p=="function")?p:T(S)}function T(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(S){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(h){return h.__proto__||Object.getPrototypeOf(h)},P(S)}var O=function(S){c(h,S);var p=m(h);function h(){var C;return l(this,h),C=p.call(this),C.ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",C.BUFFERING_COMPLETED="bufferingCompleted",C.BUFFER_CLEARED="bufferCleared",C.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",C.BUFFER_REPLACEMENT_STARTED="bufferReplacementStarted",C.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",C.CMSD_STATIC_HEADER="cmsdStaticHeader",C.CURRENT_TRACK_CHANGED="currentTrackChanged",C.DATA_UPDATE_COMPLETED="dataUpdateCompleted",C.INBAND_EVENTS="inbandEvents",C.INITIAL_STREAM_SWITCH="initialStreamSwitch",C.INIT_FRAGMENT_LOADED="initFragmentLoaded",C.INIT_FRAGMENT_NEEDED="initFragmentNeeded",C.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",C.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",C.LOADING_COMPLETED="loadingCompleted",C.LOADING_PROGRESS="loadingProgress",C.LOADING_DATA_PROGRESS="loadingDataProgress",C.LOADING_ABANDONED="loadingAborted",C.MANIFEST_UPDATED="manifestUpdated",C.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",C.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",C.QUOTA_EXCEEDED="quotaExceeded",C.SEGMENT_LOCATION_BLACKLIST_ADD="segmentLocationBlacklistAdd",C.SEGMENT_LOCATION_BLACKLIST_CHANGED="segmentLocationBlacklistChanged",C.SERVICE_LOCATION_BLACKLIST_ADD="serviceLocationBlacklistAdd",C.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",C.SET_FRAGMENTED_TEXT_AFTER_DISABLED="setFragmentedTextAfterDisabled",C.SET_NON_FRAGMENTED_TEXT="setNonFragmentedText",C.SOURCE_BUFFER_ERROR="sourceBufferError",C.STREAMS_COMPOSED="streamsComposed",C.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",C.STREAM_REQUESTING_COMPLETED="streamRequestingCompleted",C.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",C.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",C.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",C.URL_RESOLUTION_FAILED="urlResolutionFailed",C.VIDEO_CHUNK_RECEIVED="videoChunkReceived",C.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",C.XLINK_ELEMENT_LOADED="xlinkElementLoaded",C.XLINK_READY="xlinkReady",C.SEEK_TARGET="seekTarget",C.SETTING_UPDATED_LIVE_DELAY="settingUpdatedLiveDelay",C.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT="settingUpdatedLiveDelayFragmentCount",C.SETTING_UPDATED_CATCHUP_ENABLED="settingUpdatedCatchupEnabled",C.SETTING_UPDATED_PLAYBACK_RATE_MIN="settingUpdatedPlaybackRateMin",C.SETTING_UPDATED_PLAYBACK_RATE_MAX="settingUpdatedPlaybackRateMax",C}return h}(d.default);const M=O},"./src/core/events/Events.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/core/events/CoreEvents.js");function o(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(C){return typeof C}:o=function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},o(p)}function l(p,h){if(!(p instanceof h))throw new TypeError("Cannot call a class as a function")}function c(p,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(h&&h.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),h&&E(p,h)}function E(p,h){return E=Object.setPrototypeOf||function(v,I){return v.__proto__=I,v},E(p,h)}function m(p){var h=L();return function(){var v=P(p),I;if(h){var D=P(this).constructor;I=Reflect.construct(v,arguments,D)}else I=v.apply(this,arguments);return f(this,I)}}function f(p,h){return h&&(o(h)==="object"||typeof h=="function")?h:T(p)}function T(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(p){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},P(p)}var O=function(p){c(C,p);var h=m(C);function C(){return l(this,C),h.apply(this,arguments)}return C}(d.default),M=new O;const S=M},"./src/core/events/EventsBase.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});function d(m,f){if(!(m instanceof f))throw new TypeError("Cannot call a class as a function")}function o(m,f){for(var T=0;T<f.length;T++){var L=f[T];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(m,L.key,L)}}function l(m,f,T){return f&&o(m.prototype,f),T&&o(m,T),m}var c=function(){function m(){d(this,m)}return l(m,[{key:"extend",value:function(T,L){if(T){var P=L?L.override:!1,O=L?L.publicOnly:!1;for(var M in T)!T.hasOwnProperty(M)||this[M]&&!P||O&&T[M].indexOf("public_")===-1||(this[M]=T[M])}}}]),m}();const E=c},"./src/dash/DashAdapter.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/dash/constants/DashConstants.js"),o=r("./src/dash/vo/RepresentationInfo.js"),l=r("./src/dash/vo/MediaInfo.js"),c=r("./src/dash/vo/StreamInfo.js"),E=r("./src/dash/vo/ManifestInfo.js"),m=r("./src/dash/vo/Event.js"),f=r("./src/core/FactoryMaker.js"),T=r("./src/dash/models/DashManifestModel.js"),L=r("./src/dash/models/PatchManifestModel.js"),P=r("./node_modules/bcp-47-normalize/index.js"),O=r.n(P);function M(){var p,h,C,v,I,D,y,A=this.context,x="urn:dvb:dash:profile:dvb-dash:2014";function F(){h=(0,T.default)(A).getInstance(),C=(0,L.default)(A).getInstance(),Ye()}function k(Te){Te&&(Te.constants&&(D=Te.constants),Te.cea608parser&&(y=Te.cea608parser),Te.errHandler&&h.setConfig({errHandler:Te.errHandler}),Te.BASE64&&h.setConfig({BASE64:Te.BASE64}))}function W(Te){if(Te){var de=new o.default,Re=Te.adaptation.period.mpd.manifest.Period_asArray[Te.adaptation.period.index].AdaptationSet_asArray[Te.adaptation.index],xe=h.getRepresentationFor(Te.index,Re);return de.id=Te.id,de.quality=Te.index,de.bandwidth=h.getBandwidth(xe),de.fragmentDuration=Te.segmentDuration||(Te.segments&&Te.segments.length>0?Te.segments[0].duration:NaN),de.MSETimeOffset=Te.MSETimeOffset,de.mediaInfo=at(Te.adaptation),de}else return null}function V(Te,de){if(v.length===0||!Te)return null;var Re=it(Te,v);if(!Re)return null;var xe=h.getAdaptationsForPeriod(Re),Ne=$(Te.index,de,Te);if(!Ne)return null;var Xe=h.getIndexForAdaptation(Ne,v[0].mpd.manifest,Te.index);return at(xe[Xe])}function Q(Te){return h.getRolesForAdaptation(Te).filter(function(de){return de.value===d.default.MAIN})[0]}function $(Te,de,Re){var xe=h.getAdaptationsForType(v[0].mpd.manifest,Te,de);if(!xe||xe.length===0)return null;if(xe.length>1&&Re){var Ne=re(Re,de);if(I[Re.id]&&I[Re.id][de]){for(var Xe=0,nt=xe.length;Xe<nt;Xe++)if(K(I[Re.id][de],Ne[Xe]))return xe[Xe]}for(var et=0,dt=xe.length;et<dt;et++)if(Q(xe[et]))return xe[et]}return xe[0]}function K(Te,de){if(!Te||!de)return!1;var Re=Te.id===de.id,xe=Te.codec===de.codec,Ne=Te.viewpoint===de.viewpoint,Xe=Te.lang===de.lang,nt=Te.roles.toString()===de.roles.toString(),et=Te.accessibility.toString()===de.accessibility.toString(),dt=Te.audioChannelConfiguration.toString()===de.audioChannelConfiguration.toString();return Re&&xe&&Ne&&Xe&&nt&&et&&dt}function Y(Te,de,Re,xe,Ne,Xe){var nt=[],et,dt,Tt,Ct,De,Ue;if(!xe||xe.length===0)return[];var Ze=h.getAdaptationsForPeriod(de);for(Ct=0,Ue=xe.length;Ct<Ue;Ct++)if(et=xe[Ct],Tt=h.getIndexForAdaptation(et,Te,Re.index),dt=at(Ze[Tt]),Xe){var mt=dt.accessibility.length;for(De=0;De<mt;De++)if(dt){var ft=dt.accessibility[De];if(ft.indexOf("cea-608:")===0){var pt=ft.substring(8),Mt=pt.split(";");if(Mt[0].substring(0,2)==="CC")for(De=0;De<Mt.length;De++)dt||(dt=at.call(this,Ze[Tt])),Ce(dt,Mt[De].substring(0,3),Mt[De].substring(4)),nt.push(dt),dt=null;else for(De=0;De<Mt.length;De++)dt||(dt=at.call(this,Ze[Tt])),Ce(dt,"CC"+(De+1),Mt[De]),nt.push(dt),dt=null}else ft.indexOf("cea-608")===0&&(Ce(dt,D.CC1,"eng"),nt.push(dt),dt=null)}}else Ne===D.IMAGE?(We(dt),nt.push(dt),dt=null):dt&&nt.push(dt);return nt}function re(Te,de,Re){var xe=v,Ne=Re,Xe=[];if(Ne)ot(),xe=R(Ne);else if(v.length>0)Ne=v[0].mpd.manifest;else return Xe;var nt=it(Te,xe),et=h.getAdaptationsForType(Ne,Te?Te.index:null,de);return Xe=Y(Ne,nt,Te,et,de),de===D.TEXT&&(et=h.getAdaptationsForType(Ne,Te?Te.index:null,D.VIDEO),Xe=Xe.concat(Y(Ne,nt,Te,et,de,!0))),Xe}function ie(Te){if(!Te)return null;ot(),v=R(Te)}function ee(Te,de){var Re=[],xe=v;if(Te&&(ot(),xe=R(Te)),xe.length>0){(!de||de>xe.length)&&(de=xe.length);for(var Ne=0;Ne<de;Ne++)Re.push(Ge(xe[Ne]))}return Re}function ne(Te,de){var Re,xe,Ne=it(Te,v);return Re=de?de.id:null,v.length>0&&Ne&&(xe=Re?h.getAdaptationForId(Re,v[0].mpd.manifest,Ne.index):h.getAdaptationForIndex(de?de.index:null,v[0].mpd.manifest,Ne.index)),xe}function ae(Te,de){var Re,xe,Ne=it(Te,v);return Re=de?de.id:null,v.length>0&&Ne&&(xe=Re?h.getAdaptationForId(Re,v[0].mpd.manifest,Ne.index):h.getAdaptationForIndex(de?de.index:null,v[0].mpd.manifest,Ne.index)),xe?h.getProducerReferenceTimesForAdaptation(xe):[]}function ce(Te){try{return h.getEssentialPropertiesForRepresentation(Te)}catch{return[]}}function X(Te){return h.getRealPeriodForIndex(Te,v[0].mpd.manifest)}function oe(Te){var de,Re=qe(Te);return de=h.getRepresentationsForAdaptation(Re),de}function ge(Te,de,Re,xe){try{if(!Te||!de||isNaN(Re)||!xe)return null;var Ne=Te.scheme_id_uri,Xe=Te.value;if(!de[Ne+"/"+Xe])return null;var nt=new m.default,et=Te.timescale||1,dt=xe.adaptation.period.start,Tt=de[Ne+"/"+Xe],Ct=isNaN(xe.presentationTimeOffset)?isNaN(Tt.presentationTimeOffset)?0:Tt.presentationTimeOffset:xe.presentationTimeOffset,De=Te.presentation_time_delta/et,Ue;Te.version===0?Ue=dt+Re-Ct+De:Ue=dt-Ct+De;var Ze=Te.event_duration/et,mt=Te.id,ft=Te.message_data;return nt.eventStream=Tt,nt.eventStream.value=Xe,nt.eventStream.timescale=et,nt.duration=Ze,nt.id=mt,nt.calculatedPresentationTime=Ue,nt.messageData=ft,nt.presentationTimeDelta=De,nt}catch{return null}}function _e(Te,de,Re){var xe=[];if(v.length>0){var Ne=v[0].mpd.manifest;if(Te instanceof c.default){var Xe=it(Te,v);xe=h.getEventsForPeriod(Xe)}else if(Te instanceof l.default){var nt=it(Re,v);xe=h.getEventStreamForAdaptationSet(Ne,qe(Te),nt)}else if(Te instanceof o.default){var et=it(Re,v);xe=h.getEventStreamForRepresentation(Ne,de,et)}}return xe}function he(Te,de,Re){I[Te]=I[Te]||{},I[Te][de]=I[Te][de]||{},I[Te][de]=Re}function se(Te){return h.getIsText(Te)}function Z(){var Te=Me();return h.getUTCTimingSources(Te)}function q(){var Te=v.length>0?v[0].mpd:null;return h.getSuggestedPresentationDelay(Te)}function le(Te){var de=w(Te);return h.getAvailabilityStartTime(de)}function te(Te){var de=Me(Te);return h.getIsDynamic(de)}function N(Te){var de=Me(Te);return h.getDuration(de)}function R(Te){var de=w(Te);return h.getRegularPeriods(de)}function w(Te){var de=Me(Te);return h.getMpd(de)}function j(Te){return h.getContentSteering(Te)}function H(Te){return h.getLocation(Te)}function U(Te){var de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return h.getManifestUpdatePeriod(Te,de)}function B(Te){return h.getPublishTime(Te)}function G(Te){var de=h.getPatchLocation(Te),Re=h.getPublishTime(Te);if(!de||!Re)return null;if(de.hasOwnProperty("ttl")&&Re){var xe=parseFloat(de.ttl)*1e3;if(Re.getTime()+xe<=new Date().getTime())return null}return de.__text}function z(Te){return h.hasProfile(Te,x)}function fe(Te){return C.getIsPatch(Te)}function ue(Te){return h.getBaseURLsFromElement(Te)}function J(){return h.getRepresentationSortFunction()}function ve(Te,de,Re){return h.getCodec(Te,de,Re)}function me(Te,de){var Re,xe=ct(de);return Re=Pt(xe,Te),Re?Re.bandwidth:null}function Ae(Te,de){var Re=ct(de);return ht(Re,Te)}function be(Te,de){var Re=ct(de);return $e(Re,Te)}function Be(Te){if(!Te||v.length===0)return null;var de=v.filter(function(Re){return Re.id===Te});return de&&de.length>0?de[0]:null}function ke(Te,de){return h.getIsTypeOf(Te,de)}function Ye(){v=[],I={}}function Oe(Te,de){var Re=h.getId(Te),xe=C.getMpdId(de),Ne=h.getPublishTime(Te),Xe=C.getPublishTime(de),nt=C.getOriginalPublishTime(de);return!!(Re&&xe&&Re==xe&&Ne&&nt&&Ne.getTime()==nt.getTime()&&Xe&&Ne.getTime()<Xe.getTime())}function Se(Te,de){C.getPatchOperations(de).forEach(function(Re){var xe=Re.getMpdTarget(Te);if(xe!==null){var Ne=xe.name,Xe=xe.target,nt=xe.leaf;if(Re.xpath.findsAttribute()){switch(Re.action){case"add":case"replace":Xe[Ne]=Re.value;break;case"remove":delete Xe[Ne];break}return}var et=(Xe[Ne+"_asArray"]||[]).indexOf(nt),dt=Re.position==="prepend"||Re.position==="before";if((Re.action==="remove"||Re.action==="replace")&&(delete Xe[Ne],et!=-1)){var Tt=Xe[Ne+"_asArray"];Tt.splice(et,1),Tt.length>1?Xe[Ne]=Tt:Tt.length==1?Xe[Ne]=Tt[0]:delete Xe[Ne+"_asArray"]}(Re.action==="add"||Re.action==="replace")&&Object.keys(Re.value).forEach(function(Ct){var De=Re.value[Ct],Ue=Xe[Ct+"_asArray"]||[];if(Ue.length===0&&Xe[Ct]&&Ue.push(Xe[Ct]),Ue.length===0)Ue=De;else{var Ze=Ue.length;Ct==Ne&&et!=-1?Ze=et+(dt?0:1)+(Re.action=="replace"?-1:0):Ze=dt?0:Ue.length,Ue.splice.apply(Ue,[Ze,0].concat(De))}Xe[Ct+"_asArray"]=Ue,Xe[Ct]=Ue.length==1?Ue[0]:Ue})}})}function Me(Te){return Te||(v.length>0?v[0].mpd.manifest:null)}function qe(Te){try{var de=it(Te.streamInfo,v),Re=h.getAdaptationsForPeriod(de);return!Te||!Te.streamInfo||Te.streamInfo.id===void 0||!Re?null:Re[Te.index]}catch{return null}}function it(Te,de){for(var Re=de.length,xe=0;xe<Re;xe++){var Ne=de[xe];if(Te&&Te.id===Ne.id)return Ne}return null}function at(Te){if(!Te)return null;var de=new l.default,Re=Te.period.mpd.manifest.Period_asArray[Te.period.index].AdaptationSet_asArray[Te.index],xe;if(de.id=Te.id,de.index=Te.index,de.type=Te.type,de.streamInfo=Ge(Te.period),de.representationCount=h.getRepresentationCount(Re),de.labels=h.getLabelsForAdaptation(Re),de.lang=h.getLanguageForAdaptation(Re),xe=h.getViewpointForAdaptation(Re),de.viewpoint=xe?xe.value:void 0,de.accessibility=h.getAccessibilityForAdaptation(Re).map(function(nt){var et=nt.value,dt=et;return nt.schemeIdUri&&nt.schemeIdUri.search("cea-608")>=0&&typeof y<"u"&&(et?dt="cea-608:"+et:dt="cea-608",de.embeddedCaptions=!0),dt}),de.audioChannelConfiguration=h.getAudioChannelConfigurationForAdaptation(Re).map(function(nt){return nt.value}),de.audioChannelConfiguration.length===0&&Array.isArray(Re.Representation_asArray)&&Re.Representation_asArray.length>0&&(de.audioChannelConfiguration=h.getAudioChannelConfigurationForRepresentation(Re.Representation_asArray[0]).map(function(nt){return nt.value})),de.roles=h.getRolesForAdaptation(Re).map(function(nt){return nt.value}),de.codec=h.getCodec(Re),de.mimeType=h.getMimeType(Re),de.contentProtection=h.getContentProtectionData(Re),de.bitrateList=h.getBitrateListForAdaptation(Re),de.selectionPriority=h.getSelectionPriority(Re),de.contentProtection){var Ne=de.contentProtection.map(function(nt){return h.getKID(nt)}).filter(function(nt){return nt!==null});if(Ne.length){var Xe=Ne[0];de.contentProtection.forEach(function(nt){nt.keyId=Xe})}}return de.isText=h.getIsText(Re),de.supplementalProperties=h.getSupplementalProperties(Re),de.isFragmented=h.getIsFragmented(Re),de.isEmbedded=!1,de}function Ce(Te,de,Re){Te.id=de,Te.index=100+parseInt(de.substring(2,3)),Te.type=D.TEXT,Te.codec="cea-608-in-SEI",Te.isEmbedded=!0,Te.isFragmented=!1,Te.lang=O()(Re),Te.roles=["caption"]}function We(Te){Te.type=D.IMAGE}function Ge(Te){var de=new c.default,Re=1;return de.id=Te.id,de.index=Te.index,de.start=Te.start,de.duration=Te.duration,de.manifestInfo=tt(Te.mpd),de.isLast=Te.mpd.manifest.Period_asArray.length===1||Math.abs(de.start+de.duration-de.manifestInfo.duration)<Re,de}function tt(Te){var de=new E.default;return de.dvrWindowSize=Te.timeShiftBufferDepth,de.loadedTime=Te.manifest.loadedTime,de.availableFrom=Te.availabilityStartTime,de.minBufferTime=Te.manifest.minBufferTime,de.maxFragmentDuration=Te.maxSegmentDuration,de.duration=h.getDuration(Te.manifest),de.isDynamic=h.getIsDynamic(Te.manifest),de.serviceDescriptions=h.getServiceDescriptions(Te.manifest),de.protocol=Te.manifest.protocol,de}function ot(){if(!D)throw new Error("setConfig function has to be called previously")}function ct(Te){return v.length>0?v[0].mpd.manifest.Period_asArray[Te]:null}function ht(Te,de){var Re=Pt(Te,de,!0);return Re!==null?Re:-1}function Pt(Te,de,Re){var xe,Ne,Xe,nt,et,dt;if(Te){for(Ne=Te.AdaptationSet_asArray,et=0;et<Ne.length;et=et+1)for(xe=Ne[et],nt=xe.Representation_asArray,dt=0;dt<nt.length;dt=dt+1)if(Xe=nt[dt],de===Xe.id)return Re?dt:Xe}return null}function $e(Te,de){var Re,xe,Ne,Xe;if(!Te||!de)return-1;for(xe=Te.AdaptationSet_asArray,Xe=0;Xe<xe.length;Xe=Xe+1)if(Re=xe[Xe],Ne=Re.Representation_asArray,h.getIsTypeOf(Re,de))return Ne.length;return-1}return p={getBandwidthForRepresentation:me,getIndexForRepresentation:Ae,getMaxIndexForBufferType:be,convertRepresentationToRepresentationInfo:W,getStreamsInfo:ee,getMediaInfoForType:V,getAllMediaInfoForType:re,getAdaptationForType:$,getRealAdaptation:ne,getProducerReferenceTimes:ae,getRealPeriodByIndex:X,getEssentialPropertiesForRepresentation:ce,getVoRepresentations:oe,getEventsFor:_e,getEvent:ge,getMpd:w,setConfig:k,updatePeriods:ie,getIsTextTrack:se,getUTCTimingSources:Z,getSuggestedPresentationDelay:q,getAvailabilityStartTime:le,getIsTypeOf:ke,getIsDynamic:te,getDuration:N,getRegularPeriods:R,getContentSteering:j,getLocation:H,getPatchLocation:G,getManifestUpdatePeriod:U,getPublishTime:B,getIsDVB:z,getIsPatch:fe,getBaseURLsFromElement:ue,getRepresentationSortFunction:J,getCodec:ve,getPeriodById:Be,setCurrentMediaInfo:he,isPatchValid:Oe,applyPatchToManifest:Se,areMediaInfosEqual:K,reset:Ye},F(),p}M.__dashjs_factory_name="DashAdapter";const S=f.default.getSingletonFactory(M)},"./src/dash/DashHandler.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>P});var d=r("./src/streaming/vo/FragmentRequest.js"),o=r("./src/streaming/vo/metrics/HTTPRequest.js"),l=r("./src/core/FactoryMaker.js"),c=r("./src/streaming/MediaPlayerEvents.js"),E=r("./src/dash/utils/SegmentsUtils.js"),m=r("./src/dash/constants/DashConstants.js"),f=.5,T=.001;function L(O){O=O||{};var M=O.eventBus,S=O.debug,p=O.urlUtils,h=O.type,C=O.streamInfo,v=O.segmentsController,I=O.timelineConverter,D=O.baseURLController,y,A,x,F,k;function W(){A=S.getLogger(y),Y(),M.on(c.default.DYNAMIC_TO_STATIC,se,y)}function V(Z){F=Z,k=!1,v.initialize(Z)}function Q(){return C.id}function $(){return h}function K(){return C}function Y(){x=null}function re(){Y(),M.off(c.default.DYNAMIC_TO_STATIC,se,y)}function ie(Z,q,le){var te=D.resolve(le.path),N,R;return!te||q===te.url||!p.isRelative(q)?N=q:(N=te.url,R=te.serviceLocation,q&&(N=p.resolve(q,N))),p.isRelative(N)?!1:(Z.url=N,Z.serviceLocation=R,!0)}function ee(Z,q){return q?ne(Z,q,$()):null}function ne(Z,q,le){var te=new d.default,N=q.adaptation.period,R=N.start;if(te.mediaType=le,te.type=o.HTTPRequest.INIT_SEGMENT_TYPE,te.range=q.range,te.availabilityStartTime=I.calcAvailabilityStartTimeFromPresentationTime(R,q,F),te.availabilityEndTime=I.calcAvailabilityEndTimeFromPresentationTime(R+N.duration,q,F),te.quality=q.index,te.mediaInfo=Z,te.representationId=q.id,ie(te,q.initialization,q))return te.url=(0,E.replaceTokenForTemplate)(te.url,"Bandwidth",q.bandwidth),te}function ae(Z,q){if(q==null)return null;var le=new d.default,te=q.representation,N=te.adaptation.period.mpd.manifest.Period_asArray[te.adaptation.period.index].AdaptationSet_asArray[te.adaptation.index].Representation_asArray[te.index].bandwidth,R=q.media;if(R=(0,E.replaceTokenForTemplate)(R,"Number",q.replacementNumber),R=(0,E.replaceTokenForTemplate)(R,"Time",q.replacementTime),R=(0,E.replaceTokenForTemplate)(R,"Bandwidth",N),R=(0,E.replaceIDForTemplate)(R,te.id),R=(0,E.unescapeDollarsInTemplate)(R),le.mediaType=$(),le.type=o.HTTPRequest.MEDIA_SEGMENT_TYPE,le.range=q.mediaRange,le.startTime=q.presentationStartTime,le.mediaStartTime=q.mediaStartTime,le.duration=q.duration,le.timescale=te.timescale,le.availabilityStartTime=q.availabilityStartTime,le.availabilityEndTime=q.availabilityEndTime,le.availabilityTimeComplete=te.availabilityTimeComplete,le.wallStartTime=q.wallStartTime,le.quality=te.index,le.index=q.index,le.mediaInfo=Z,le.adaptationIndex=te.adaptation.index,le.representationId=te.id,ie(le,R,te))return le}function ce(Z,q){if(!Z||!x)return!1;if(k)return!0;if(!isFinite(Z.adaptation.period.duration)||x.presentationStartTime+x.duration>q)return!1;if(Z.mediaFinishedInformation&&!isNaN(Z.mediaFinishedInformation.numberOfSegments)&&!isNaN(x.index)&&x.index>=Z.mediaFinishedInformation.numberOfSegments-1){if(!F||Z.segmentInfoType===m.default.SEGMENT_TEMPLATE)return!0;if(F&&Z.segmentInfoType===m.default.SEGMENT_LIST&&Z.adaptation.period.nextPeriodId)return!0}return!!(F&&Z.adaptation.period.nextPeriodId&&Z.segmentInfoType===m.default.SEGMENT_TIMELINE&&Z.mediaFinishedInformation&&!isNaN(Z.mediaFinishedInformation.mediaTimeOfLastSignaledSegment)&&x&&!isNaN(x.mediaStartTime)&&!isNaN(x.duration)&&x.mediaStartTime+x.duration>=Z.mediaFinishedInformation.mediaTimeOfLastSignaledSegment-.05)}function X(Z,q,le){var te=null;if(!q||!q.segmentInfoType)return te;var N=v.getSegmentByTime(q,le);return N&&(x=N,A.debug("Index for time "+le+" is "+N.index),te=ae(Z,N)),te}function oe(Z,q){var le=null,te=x?x.index+1:0,N=v.getSegmentByIndex(q,te,x?x.mediaStartTime:-1);return N?(le=ae(Z,N),le):null}function ge(Z,q){var le=null;if(!q||!q.segmentInfoType)return null;var te=x?x.index+1:0,N=v.getSegmentByIndex(q,te,x?x.mediaStartTime:-1);if(N)le=ae(Z,N),x=N;else{if(F&&!k)return A.debug($()+" No segment found at index: "+te+". Wait for next loop"),null;k=!0}return le}function _e(Z,q,le,te){try{if(isNaN(Z)||!q||!le)return NaN;if(Z<0&&(Z=0),isNaN(te)&&(te=f),X(q,le,Z))return Z;if(le.adaptation.period.start+le.adaptation.period.duration<Z)return NaN;for(var N=isFinite(le.adaptation.period.duration)?le.adaptation.period.start+le.adaptation.period.duration:Z+30,R=Math.min(Z+te,N),w=NaN,j=null;R<=N;){var H=null;if(R<=N&&(H=X(q,le,R)),H){w=R,j=H;break}R+=te}if(j){var U=j.startTime+j.duration;return Z>j.startTime&&U-Z>te?Z:!isNaN(j.startTime)&&Z<j.startTime&&w>j.startTime?j.startTime+T:Math.min(U-te,w)}return w}catch{return NaN}}function he(){return x?x.index:-1}function se(){A.debug("Dynamic stream complete"),k=!0}return y={initialize:V,getStreamId:Q,getType:$,getStreamInfo:K,getInitRequest:ee,getSegmentRequestForTime:X,getCurrentIndex:he,getNextSegmentRequest:ge,isLastSegmentRequested:ce,reset:re,getNextSegmentRequestIdempotent:oe,getValidTimeAheadOfTargetTime:_e},W(),y}L.__dashjs_factory_name="DashHandler";const P=l.default.getClassFactory(L)},"./src/dash/DashMetrics.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>P});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/streaming/vo/metrics/HTTPRequest.js"),l=r("./src/core/FactoryMaker.js"),c=r("./src/streaming/constants/MetricsConstants.js"),E=r("./src/dash/utils/Round10.js"),m=r("./src/streaming/models/MetricsModel.js"),f=r("./src/core/Utils.js"),T=r("./src/streaming/vo/metrics/PlayList.js");function L(O){O=O||{};var M=this.context,S,p,h,C,v=O.metricsModel;function I(){v=v||(0,m.default)(M).getInstance({settings:O.settings}),D()}function D(){p=!0,h=null,C=null}function y(H){var U=v.getMetricsFor(H,!0);return Y(U,c.default.TRACK_SWITCH)}function A(H,U,B,G,z){v.addRepresentationSwitch(H,U,B,G,z)}function x(H){var U=v.getMetricsFor(H,!0);return Y(U,c.default.BUFFER_STATE)}function F(H){var U=v.getMetricsFor(H,!0),B=Y(U,c.default.BUFFER_LEVEL);return B?E.default.round10(B.level/1e3,-3):0}function k(H,U,B){v.addBufferLevel(H,U,B)}function W(H,U,B){v.addBufferState(H,U,B)}function V(){v.clearAllCurrentMetrics()}function Q(H){var U=v.getMetricsFor(H,!0);if(!U)return null;var B=U.HttpList,G=null,z;if(!B||B.length<=0)return null;for(z=B.length-1;z>=0;){if(B[z].responsecode){G=B[z];break}z--}return G}function $(H){var U=v.getMetricsFor(H,!0);return U?U.HttpList?U.HttpList:[]:[]}function K(H,U,B){v.addRequestsQueue(H,U,B)}function Y(H,U){if(!H)return null;var B=H[U];return!B||B.length===0?null:B[B.length-1]}function re(){var H=v.getMetricsFor(d.default.VIDEO,!0);return Y(H,c.default.DROPPED_FRAMES)}function ie(H){v.addDroppedFrames(d.default.VIDEO,H)}function ee(H){var U=v.getMetricsFor(H,!0);return Y(U,c.default.SCHEDULING_INFO)}function ne(H,U){v.addSchedulingInfo(H.mediaType,new Date,H.type,H.startTime,H.availabilityStartTime,H.duration,H.quality,H.range,U)}function ae(){var H=v.getMetricsFor(d.default.STREAM);return Y(H,c.default.MANIFEST_UPDATE)}function ce(H){var U=this.getCurrentManifestUpdate();v.updateManifestUpdateInfo(U,H)}function X(H){if(H){var U=this.getCurrentManifestUpdate();v.addManifestUpdateStreamInfo(U,H.id,H.index,H.start,H.duration)}}function oe(H){v.addManifestUpdate(d.default.STREAM,H.type,H.requestStartDate,H.requestEndDate)}function ge(H,U,B,G,z,fe){v.addHttpRequest(H.mediaType,null,H.type,H.url,H.quality,U,H.serviceLocation||null,H.range||null,H.requestStartDate,H.firstByteDate,H.requestEndDate,B,H.duration,G,z,H.fileLoaderType,fe)}function _e(H,U){if(H){var B=this.getCurrentManifestUpdate();v.addManifestUpdateRepresentationInfo(B,H.id,H.index,H.streamIndex,U,H.presentationTimeOffset,H.startNumber,H.fragmentInfoType)}}function he(H){var U=H?v.getMetricsFor(H,!0):v.getMetricsFor(d.default.VIDEO,!0)||v.getMetricsFor(d.default.AUDIO,!0);return Y(U,c.default.DVR_INFO)}function se(H,U,B,G){v.addDVRInfo(H,U,B,G)}function Z(H){if(!H)return null;var U={},B,G,z;for(B=$(d.default.STREAM),z=B.length-1;z>=0;z--)if(G=B[z],G.type===o.HTTPRequest.MPD_TYPE){U=f.default.parseHttpHeaders(G._responseHeaders);break}var fe=U[H.toLowerCase()];return fe===void 0?null:fe}function q(H,U){if(!U)return null;var B={},G=Q(H);G&&(B=f.default.parseHttpHeaders(G._responseHeaders));var z=B[U.toLowerCase()];return z===void 0?null:z}function le(){C&&(v.addPlayList(C),C=null)}function te(H,U){C=new T.PlayList,C.start=new Date,C.mstart=H,C.starttype=U}function N(H,U,B){p===!0&&(p=!1,h=new T.PlayListTrace,h.representationid=H,h.start=new Date,h.mstart=U,h.playbackspeed=B!==null?B.toString():null)}function R(H){if(h)for(var U in h)h[U]=H[U]}function w(H,U){if(p===!1&&C&&h&&h.start){var B=h.start,G=H.getTime()-B.getTime();h.duration=G,h.stopreason=U,C.trace.push(h),p=!0}}function j(H){v.addDVBErrors(H)}return S={getCurrentRepresentationSwitch:y,getCurrentBufferState:x,getCurrentBufferLevel:F,getCurrentHttpRequest:Q,getHttpRequests:$,getCurrentDroppedFrames:re,getCurrentSchedulingInfo:ee,getCurrentDVRInfo:he,getCurrentManifestUpdate:ae,getLatestFragmentRequestHeaderValueByID:q,getLatestMPDRequestHeaderValueByID:Z,addRepresentationSwitch:A,addDVRInfo:se,updateManifestUpdateInfo:ce,addManifestUpdateStreamInfo:X,addManifestUpdateRepresentationInfo:_e,addManifestUpdate:oe,addHttpRequest:ge,addSchedulingInfo:ne,addRequestsQueue:K,addBufferLevel:k,addBufferState:W,addDroppedFrames:ie,addPlayList:le,addDVBErrors:j,createPlaylistMetrics:te,createPlaylistTraceMetrics:N,updatePlayListTraceMetrics:R,pushPlayListTraceMetrics:w,clearAllCurrentMetrics:V},I(),S}L.__dashjs_factory_name="DashMetrics";const P=l.default.getSingletonFactory(L)},"./src/dash/SegmentBaseLoader.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>f});var d=r("./src/dash/vo/Segment.js"),o=r("./src/streaming/vo/DashJSError.js"),l=r("./src/core/FactoryMaker.js"),c=r("./src/streaming/vo/FragmentRequest.js"),E=r("./src/streaming/net/URLLoader.js");function m(){var T=this.context,L,P,O,M,S,p,h,C,v,I,D,y,A;function x(){C=(0,E.default)(T).create({errHandler:O,dashMetrics:p,mediaPlayerModel:h,requestModifier:S,boxParser:M,errors:v,urlUtils:y,constants:I,dashConstants:D})}function F(ie){ie.baseURLController&&(A=ie.baseURLController),ie.dashMetrics&&(p=ie.dashMetrics),ie.mediaPlayerModel&&(h=ie.mediaPlayerModel),ie.errHandler&&(O=ie.errHandler),ie.boxParser&&(M=ie.boxParser),ie.debug&&(P=ie.debug.getLogger(L)),ie.requestModifier&&(S=ie.requestModifier),ie.errors&&(v=ie.errors),ie.urlUtils&&(y=ie.urlUtils),ie.constants&&(I=ie.constants),ie.dashConstants&&(D=ie.dashConstants)}function k(ie,ee){return new Promise(function(ne){W(ie,ee,ne)})}function W(ie,ee,ne,ae){var ce=null,X=ie?A.resolve(ie.path):null,oe=ae||{init:!0,url:X?X.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:ee};P.debug("Start searching for initialization.");var ge=re(oe),_e=function(Z){if(oe.bytesLoaded=oe.range.end,ce=M.findInitRange(Z),ce)ie.range=ce,ne(ie);else return oe.range.end=oe.bytesLoaded+oe.bytesToLoad,W(ie,ee,ne,oe)},he=function(){ne(ie)};C.load({request:ge,success:_e,error:he}),P.debug("Perform init search: "+oe.url)}function V(ie,ee,ne){return new Promise(function(ae){Q(ie,ee,ne,ae)})}function Q(ie,ee,ne,ae,ce,X){if(ne&&(ne.start===void 0||ne.end===void 0)){var oe=ne?ne.toString().split("-"):null;ne=oe?{start:parseFloat(oe[0]),end:parseFloat(oe[1])}:null}ce=ce||$;var ge=null,_e=null,he=!!ne,se=ie?A.resolve(ie.path):null,Z={init:!1,url:se?se.url:void 0,range:he?ne:{start:0,end:1500},searching:!he,bytesLoaded:X?X.bytesLoaded:0,bytesToLoad:1500,mediaType:ee},q=re(Z),le=function(R){var w=Z.bytesToLoad,j=R.byteLength;if(Z.bytesLoaded=Z.range.end-Z.range.start,ge=M.parse(R),_e=ge.getBox("sidx"),!_e||!_e.isComplete){if(_e)Z.range.start=_e.offset||Z.range.start,Z.range.end=Z.range.start+(_e.size||w);else if(j<Z.bytesLoaded){ce(null,ie,ae);return}else{var H=ge.getLastBox();H&&H.size?(Z.range.start=H.offset+H.size,Z.range.end=Z.range.start+w):Z.range.end+=w}Q(ie,ee,Z.range,ae,null,Z)}else{var U=_e.references,B,G;if(U!=null&&U.length>0&&(B=U[0].reference_type===1),B){P.debug("Initiate multiple SIDX load."),Z.range.end=Z.range.start+_e.size;var z,fe,ue,J,ve,me=[],Ae=0,be=(_e.offset||Z.range.start)+_e.size,Be=function(Ye){Ye?(me=me.concat(Ye),Ae++,Ae>=fe&&(me.sort(function(Oe,Se){return Oe.startTime-Se.startTime<0?-1:0}),ce(me,ie,ae))):ce(null,ie,ae)};for(z=0,fe=U.length;z<fe;z++)ue=be,J=be+U[z].referenced_size-1,be=be+U[z].referenced_size,ve={start:ue,end:J},Q(ie,ee,ve,ae,Be,Z)}else P.debug("Parsing segments from SIDX. representation "+ee+" - id: "+ie.id+" for range : "+Z.range.start+" - "+Z.range.end),G=Y(_e,Z),ce(G,ie,ae)}},te=function(){ce(null,ie,ae)};C.load({request:q,success:le,error:te}),P.debug("Perform SIDX load for type ".concat(ee," : ").concat(Z.url," with range ").concat(Z.range.start," - ").concat(Z.range.end))}function $(ie,ee,ne){ne({segments:ie,representation:ee,error:ie?void 0:new o.default(v.SEGMENT_BASE_LOADER_ERROR_CODE,v.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function K(){C&&(C.abort(),C=null)}function Y(ie,ee){for(var ne=ie.references,ae=ne.length,ce=ie.timescale,X=ie.earliest_presentation_time,oe=ee.range.start+ie.offset+ie.first_offset+ie.size,ge=[],_e,he,se,Z,q=0;q<ae;q++)se=ne[q].subsegment_duration,Z=ne[q].referenced_size,_e=new d.default,_e.duration=se,_e.startTime=X,_e.timescale=ce,he=oe+Z-1,_e.mediaRange=oe+"-"+he,ge.push(_e),X+=se,oe+=Z;return ge}function re(ie){if(ie.url){var ee=new c.default;return ee.setInfo(ie),ee}}return L={setConfig:F,initialize:x,loadInitialization:k,loadSegments:V,reset:K},L}m.__dashjs_factory_name="SegmentBaseLoader";const f=l.default.getSingletonFactory(m)},"./src/dash/WebmSegmentBaseLoader.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>L});var d=r("./src/streaming/utils/EBMLParser.js"),o=r("./src/streaming/constants/Constants.js"),l=r("./src/core/FactoryMaker.js"),c=r("./src/dash/vo/Segment.js"),E=r("./src/streaming/vo/FragmentRequest.js"),m=r("./src/streaming/net/URLLoader.js"),f=r("./src/streaming/vo/DashJSError.js");function T(){var P=this.context,O,M,S,p,h,C,v,I,D,y;function A(){S={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}}}function x(){I=(0,m.default)(P).create({errHandler:p,dashMetrics:C,mediaPlayerModel:v,requestModifier:h,errors:D})}function F(re){if(!re.baseURLController||!re.dashMetrics||!re.mediaPlayerModel||!re.errHandler)throw new Error(o.default.MISSING_CONFIG_ERROR);y=re.baseURLController,C=re.dashMetrics,v=re.mediaPlayerModel,p=re.errHandler,D=re.errors,M=re.debug.getLogger(O),h=re.requestModifier}function k(re){var ie=[],ee=(0,d.default)(P).create({data:re}),ne,ae;for(ee.consumeTagAndSize(S.Segment.Cues);ee.moreData()&&ee.consumeTagAndSize(S.Segment.Cues.CuePoint,!0);){for(ne={},ne.CueTime=ee.parseTag(S.Segment.Cues.CuePoint.CueTime),ne.CueTracks=[];ee.moreData()&&ee.consumeTag(S.Segment.Cues.CuePoint.CueTrackPositions,!0);){var ce=ee.getMatroskaCodedNum(),X=ee.getPos();if(ae={},ae.Track=ee.parseTag(S.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),ae.Track===0)throw new Error("Cue track cannot be 0");ae.ClusterPosition=ee.parseTag(S.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),ne.CueTracks.push(ae),ee.setPos(X+ce)}if(ne.CueTracks.length===0)throw new Error("Mandatory cuetrack not found");ie.push(ne)}if(ie.length===0)throw new Error("mandatory cuepoint not found");return ie}function W(re,ie,ee,ne){var ae,ce,X,oe,ge,_e,he,se;for(ce=k(re),X=[],ge=0,_e=ce.length;ge<_e;ge+=1)oe=new c.default,ae=0,ge<ce.length-1?ae=ce[ge+1].CueTime-ce[ge].CueTime:ae=ne-ce[ge].CueTime,oe.duration=ae,oe.startTime=ce[ge].CueTime,oe.timescale=1e3,he=ce[ge].CueTracks[0].ClusterPosition+ie,ge<ce.length-1?se=ce[ge+1].CueTracks[0].ClusterPosition+ie-1:se=ee-1,oe.mediaRange=he+"-"+se,X.push(oe);return M.debug("Parsed cues: "+X.length+" cues."),X}function V(re,ie,ee,ne){if(!re||re.byteLength===0){ne(null);return}var ae=(0,d.default)(P).create({data:re}),ce,X,oe,ge,_e=ee?ee.split("-"):null,he=null,se={url:ie,range:{start:_e?parseFloat(_e[0]):null,end:_e?parseFloat(_e[1]):null},request:he};for(M.debug("Parse EBML header: "+se.url),ae.skipOverElement(S.EBML),ae.consumeTag(S.Segment),oe=ae.getMatroskaCodedNum(),oe+=ae.getPos(),ge=ae.getPos();ae.moreData()&&!ae.consumeTagAndSize(S.Segment.Info,!0);)if(!(ae.skipOverElement(S.Segment.SeekHead,!0)||ae.skipOverElement(S.Segment.Tracks,!0)||ae.skipOverElement(S.Segment.Cues,!0)||ae.skipOverElement(S.Void,!0)))throw new Error("no valid top level element found");for(;ce===void 0;){var Z=ae.getMatroskaCodedNum(!0),q=ae.getMatroskaCodedNum();switch(Z){case S.Segment.Info.Duration.tag:ce=ae[S.Segment.Info.Duration.parse](q);break;default:ae.setPos(ae.getPos()+q);break}}he=K(se);var le=function(R){X=W(R,ge,oe,ce),ne(X)},te=function(){M.error("Download Error: Cues "+se.url),ne(null)};I.load({request:he,success:le,error:te}),M.debug("Perform cues load: "+se.url+" bytes="+se.range.start+"-"+se.range.end)}function Q(re,ie){return new Promise(function(ee){var ne=null,ae=re?y.resolve(re.path):null,ce=re?re.range.split("-"):null,X={range:{start:ce?parseFloat(ce[0]):null,end:ce?parseFloat(ce[1]):null},request:ne,url:ae?ae.url:void 0,init:!0,mediaType:ie};M.info("Start loading initialization."),ne=K(X);var oe=function(){ee(re)},ge=function(){ee(re)};I.load({request:ne,success:oe,error:ge}),M.debug("Perform init load: "+X.url)})}function $(re,ie,ee){return new Promise(function(ne){var ae=null,ce=re?y.resolve(re.path):null,X=ce?ce.url:void 0,oe=8192,ge={bytesLoaded:0,bytesToLoad:oe,range:{start:0,end:oe},request:ae,url:X,init:!1,mediaType:ie};ae=K(ge),M.debug("Parsing ebml header");var _e=function(Z){V(Z,X,ee,function(q){ne({segments:q,representation:re,error:q?void 0:new f.default(D.SEGMENT_BASE_LOADER_ERROR_CODE,D.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})})},he=function(){ne({representation:re,error:new f.default(D.SEGMENT_BASE_LOADER_ERROR_CODE,D.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})};I.load({request:ae,success:_e,error:he})})}function K(re){var ie=new E.default;return ie.setInfo(re),ie}function Y(){I&&(I.abort(),I=null)}return O={setConfig:F,initialize:x,loadInitialization:Q,loadSegments:$,reset:Y},A(),O}T.__dashjs_factory_name="WebmSegmentBaseLoader";const L=l.default.getSingletonFactory(T)},"./src/dash/constants/DashConstants.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});function d(f,T){if(!(f instanceof T))throw new TypeError("Cannot call a class as a function")}function o(f,T){for(var L=0;L<T.length;L++){var P=T[L];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(f,P.key,P)}}function l(f,T,L){return T&&o(f.prototype,T),L&&o(f,L),f}var c=function(){function f(){d(this,f),this.init()}return l(f,[{key:"init",value:function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.INBAND_EVENT_STREAM="InbandEventStream",this.PRODUCER_REFERENCE_TIME="ProducerReferenceTime",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.ROLE_ASARRAY="Role_asArray",this.REPRESENTATION_ASARRAY="Representation_asArray",this.PRODUCERREFERENCETIME_ASARRAY="ProducerReferenceTime_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.STATIC="static",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SERVICE_DESCRIPTION="ServiceDescription",this.SERVICE_DESCRIPTION_SCOPE="Scope",this.SERVICE_DESCRIPTION_LATENCY="Latency",this.SERVICE_DESCRIPTION_PLAYBACK_RATE="PlaybackRate",this.SERVICE_DESCRIPTION_OPERATING_QUALITY="OperatingQuality",this.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH="OperatingBandwidth",this.PATCH_LOCATION="PatchLocation",this.PUBLISH_TIME="publishTime",this.ORIGINAL_PUBLISH_TIME="originalPublishTime",this.ORIGINAL_MPD_ID="mpdId",this.WALL_CLOCK_TIME="wallClockTime",this.PRESENTATION_TIME="presentationTime",this.LABEL="Label",this.GROUP_LABEL="GroupLabel",this.CONTENT_STEERING="ContentSteering",this.CONTENT_STEERING_AS_ARRAY="ContentSteering_asArray",this.DEFAULT_SERVICE_LOCATION="defaultServiceLocation",this.QUERY_BEFORE_START="queryBeforeStart",this.PROXY_SERVER_URL="proxyServerURL",this.CONTENT_STEERING_RESPONSE={VERSION:"VERSION",TTL:"TTL",RELOAD_URI:"RELOAD-URI",SERVICE_LOCATION_PRIORITY:"SERVICE-LOCATION-PRIORITY"}}}]),f}(),E=new c;const m=E},"./src/dash/controllers/ContentSteeringController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>h});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js"),l=r("./src/streaming/net/URLLoader.js"),c=r("./src/core/errors/Errors.js"),E=r("./src/dash/vo/ContentSteeringRequest.js"),m=r("./src/dash/vo/ContentSteeringResponse.js"),f=r("./src/dash/constants/DashConstants.js"),T=r("./src/streaming/MediaPlayerEvents.js"),L=r("./src/core/events/Events.js"),P=r("./src/streaming/constants/Constants.js"),O=r("./src/core/Utils.js"),M=r("./src/streaming/utils/URLUtils.js"),S={THROUGHPUT:"_DASH_throughput",PATHWAY:"_DASH_pathway",URL:"url"};function p(){var C=this.context,v=(0,M.default)(C).getInstance(),I,D,y,A,x,F,k,W,V,Q,$,K,Y,re,ie;function ee(){D=(0,o.default)(C).getInstance().getLogger(I),R()}function ne(w){w&&(w.adapter&&(ie=w.adapter),w.errHandler&&(W=w.errHandler),w.dashMetrics&&(V=w.dashMetrics),w.mediaPlayerModel&&(Q=w.mediaPlayerModel),w.requestModifier&&(K=w.requestModifier),w.manifestModel&&($=w.manifestModel),w.abrController&&(Y=w.abrController),w.eventBus&&(re=w.eventBus))}function ae(){k=(0,l.default)(C).create({errHandler:W,dashMetrics:V,mediaPlayerModel:Q,requestModifier:K,errors:c.default}),re.on(T.default.PERIOD_SWITCH_COMPLETED,ce,I),re.on(L.default.FRAGMENT_LOADING_STARTED,X,I)}function ce(w){w&&w.toStreamInfo&&(A=w.toStreamInfo)}function X(w){w&&w.request&&w.request.serviceLocation&&(x=w.request.serviceLocation)}function oe(){var w=$.getValue();return ie.getContentSteering(w)}function ge(){var w=oe();return w&&w.queryBeforeStart}function _e(){return new Promise(function(w){try{var j=oe();if(!j||!j.serverUrl){w();return}var H=he(j),U=new E.default(H);k.load({request:U,success:function(G){se(G),re.trigger(T.default.CONTENT_STEERING_REQUEST_COMPLETED,{currentSteeringResponseData:y,url:H}),w()},error:function(G){le(G),w(G)}})}catch(B){w(B)}})}function he(w){var j=w.proxyServerUrl?w.proxyServerUrl:w.serverUrl;y&&y.reloadUri&&(v.isRelative(y.reloadUri)?j=v.resolve(y.reloadUri,w.serverUrl):j=y.reloadUri);var H=[];if(A){var U=ie.getIsDynamic(),B=ie.getAllMediaInfoForType(A,P.default.VIDEO).length>0?P.default.VIDEO:P.default.AUDIO,G=Y.getThroughputHistory(),z=G?G.getAverageThroughput(B,U):NaN;isNaN(z)||H.push({key:S.THROUGHPUT,value:z*1e3})}return x&&H.push({key:S.PATHWAY,value:x}),w.proxyServerUrl&&w.proxyServerUrl===j&&w.serverUrl&&H.push({key:S.URL,value:encodeURI(w.serverUrl)}),j=O.default.addAditionalQueryParameterToUrl(j,H),j}function se(w){!w||!w[f.default.CONTENT_STEERING_RESPONSE.VERSION]||parseInt(w[f.default.CONTENT_STEERING_RESPONSE.VERSION])!==1||(y=new m.default,y.version=w[f.default.CONTENT_STEERING_RESPONSE.VERSION],w[f.default.CONTENT_STEERING_RESPONSE.TTL]&&!isNaN(w[f.default.CONTENT_STEERING_RESPONSE.TTL])&&(y.ttl=w[f.default.CONTENT_STEERING_RESPONSE.TTL]),w[f.default.CONTENT_STEERING_RESPONSE.RELOAD_URI]&&(y.reloadUri=w[f.default.CONTENT_STEERING_RESPONSE.RELOAD_URI]),w[f.default.CONTENT_STEERING_RESPONSE.SERVICE_LOCATION_PRIORITY]&&(y.serviceLocationPriority=w[f.default.CONTENT_STEERING_RESPONSE.SERVICE_LOCATION_PRIORITY]),Z())}function Z(){y&&y.ttl&&!isNaN(y.ttl)&&(F&&clearTimeout(F),F=setTimeout(function(){_e()},y.ttl*1e3))}function q(){F&&clearTimeout(F),F=null}function le(w){D.warn("Error fetching data from content steering server",w),Z()}function te(){return y}function N(){R(),re.off(T.default.PERIOD_SWITCH_COMPLETED,ce,I),re.off(L.default.FRAGMENT_LOADING_STARTED,X,I)}function R(){y=null,A=null,x=null,q()}return I={reset:N,setConfig:ne,loadSteeringData:_e,getCurrentSteeringResponseData:te,shouldQueryBeforeStart:ge,getSteeringDataFromManifest:oe,stopSteeringRequestTimer:q,initialize:ae},ee(),I}p.__dashjs_factory_name="ContentSteeringController";const h=d.default.getSingletonFactory(p)},"./src/dash/controllers/RepresentationController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/MediaPlayerEvents.js"),c=r("./src/dash/utils/SegmentsUtils.js");function E(f){f=f||{};var T=f.eventBus,L=f.events,P=f.abrController,O=f.dashMetrics,M=f.playbackController,S=f.timelineConverter,p=f.type,h=f.streamInfo,C=f.dashConstants,v=f.segmentsController,I=f.isDynamic,D,y,A,x,F;function k(){re(),T.on(l.default.MANIFEST_VALIDITY_CHANGED,te,D)}function W(){return h.id}function V(){return p}function Q(){if(!P||!O||!M||!S)throw new Error(d.default.MISSING_CONFIG_ERROR)}function $(){return y}function K(){return A}function Y(){return F}function re(){y=null,A=!0,x=[]}function ie(){T.off(l.default.MANIFEST_VALIDITY_CHANGED,te,D),re()}function ee(N,R,w,j,H){Q(),A=!0,x=R;var U=ge(H);if(le(U),y=N,w!==d.default.VIDEO&&w!==d.default.AUDIO&&(w!==d.default.TEXT||!j))return se(),Promise.resolve();for(var B=[],G=0,z=x.length;G<z;G++){var fe=x[G];B.push(ne(fe))}return Promise.all(B)}function ne(N){return new Promise(function(R,w){var j=N.hasInitialization(),H=N.hasSegments(),U=[];U.push(v.updateInitData(N,j)),U.push(v.updateSegmentData(N,H)),Promise.all(U).then(function(B){B[0]&&!B[0].error&&(N=ce(N,B[0])),B[1]&&!B[1].error&&(N=X(N,B[1])),ae(N),Z(N),R()}).catch(function(B){w(B)})})}function ae(N){N.mediaFinishedInformation=v.getMediaFinishedInformation(N)}function ce(N,R){return!R||R.error||!R.representation?N:R.representation}function X(N,R){if(!(!R||R.error)){var w=R.segments,j=[],H=0,U,B,G,z;for(U=0,B=w?w.length:0;U<B;U++)G=w[U],z=(0,c.getTimeBasedSegment)(S,I,N,G.startTime,G.duration,G.timescale,G.media,G.mediaRange,H),z&&(j.push(z),z=null,H++);return j.length>0&&(N.segments=j),N}}function oe(){Q();var N=new Date,R=Y(),w=M.getTime()*1e3;R&&O.addRepresentationSwitch(R.adaptation.type,N,w,R.id),T.trigger(l.default.REPRESENTATION_SWITCH,{mediaType:p,streamId:h.id,currentRepresentation:R,numberOfRepresentations:x.length},{streamId:h.id,mediaType:p})}function ge(N){return N==null||N>=x.length?null:x[N]}function _e(N){return x.indexOf(N)}function he(){for(var N=0,R=x.length;N<R;N++){var w=x[N].segmentInfoType;if(!x[N].hasInitialization()||(w===C.SEGMENT_BASE||w===C.BASE_URL)&&!x[N].segments)return!1}return!0}function se(N){A=!1,T.trigger(L.DATA_UPDATE_COMPLETED,{data:y,currentRepresentation:F,error:N},{streamId:h.id,mediaType:p})}function Z(N){if(K()){var R=O.getCurrentManifestUpdate(),w=!1,j,H;if(R){for(var U=0;U<R.representationInfo.length;U++)if(j=R.representationInfo[U],j.index===N.index&&j.mediaType===V()){w=!0;break}w||O.addManifestUpdateRepresentationInfo(N,V())}if(he()){P.setPlaybackQuality(p,h,_e(F));var B=O.getCurrentDVRInfo(p);B&&O.updateManifestUpdateInfo({latency:B.range.end-M.getTime()}),H=O.getCurrentRepresentationSwitch(Y().adaptation.type),H||oe(),se()}}}function q(N){var R=ge(N);le(R),oe()}function le(N){F=N}function te(N){if(N.newDuration){var R=Y();if(R&&R.adaptation.period){var w=R.adaptation.period;w.duration=N.newDuration}}}return D={getStreamId:W,getType:V,getData:$,isUpdating:K,updateData:ee,getCurrentRepresentation:Y,getRepresentationForQuality:ge,prepareQualityChange:q,reset:ie},k(),D}E.__dashjs_factory_name="RepresentationController";const m=o.default.getClassFactory(E)},"./src/dash/controllers/SegmentBaseController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/core/FactoryMaker.js"),o=r("./src/dash/SegmentBaseLoader.js"),l=r("./src/dash/WebmSegmentBaseLoader.js");function c(f){f=f||{};var T=this.context,L=f.eventBus,P=f.events,O=f.dashMetrics,M=f.mediaPlayerModel,S=f.errHandler,p=f.baseURLController,h=f.debug,C=f.boxParser,v=f.requestModifier,I=f.errors,D,y,A;function x(){y=(0,o.default)(T).getInstance(),A=(0,l.default)(T).getInstance(),y.setConfig({baseURLController:p,dashMetrics:O,mediaPlayerModel:M,errHandler:S,eventBus:L,events:P,errors:I,debug:h,boxParser:C,requestModifier:v}),A.setConfig({baseURLController:p,dashMetrics:O,mediaPlayerModel:M,errHandler:S,eventBus:L,events:P,errors:I,debug:h,requestModifier:v})}function F($){var K=$?$.split("/")[1]:"";return K.toLowerCase()==="webm"}function k(){y.initialize(),A.initialize()}function W($){return F($.representation.mimeType)?A.loadInitialization($.representation,$.mediaType):y.loadInitialization($.representation,$.mediaType)}function V($){return F($.mimeType)?A.loadSegments($.representation,$.mediaType,$.representation?$.representation.indexRange:null):y.loadSegments($.representation,$.mediaType,$.representation?$.representation.indexRange:null)}function Q(){y.reset(),A.reset()}return D={initialize:k,getSegmentBaseInitSegment:W,getSegmentList:V,reset:Q},x(),D}c.__dashjs_factory_name="SegmentBaseController";var E=d.default.getSingletonFactory(c);const m=E},"./src/dash/controllers/SegmentsController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>T});var d=r("./src/core/FactoryMaker.js"),o=r("./src/dash/utils/TimelineSegmentsGetter.js"),l=r("./src/dash/utils/TemplateSegmentsGetter.js"),c=r("./src/dash/utils/ListSegmentsGetter.js"),E=r("./src/dash/utils/SegmentBaseGetter.js");function m(L){L=L||{};var P=this.context,O=L.dashConstants,M=L.type,S=L.segmentBaseController,p,h;function C(){h={}}function v(k){h[O.SEGMENT_TIMELINE]=(0,o.default)(P).create(L,k),h[O.SEGMENT_TEMPLATE]=(0,l.default)(P).create(L,k),h[O.SEGMENT_LIST]=(0,c.default)(P).create(L,k),h[O.SEGMENT_BASE]=(0,E.default)(P).create(L,k)}function I(k,W){return W?Promise.resolve():S.getSegmentBaseInitSegment({representation:k,mediaType:M})}function D(k,W){return W?Promise.resolve():S.getSegmentList({mimeType:k.mimeType,representation:k,mediaType:M})}function y(k){return k?k.segments?h[O.SEGMENT_BASE]:h[k.segmentInfoType]:null}function A(k,W,V){var Q=y(k);return Q?Q.getSegmentByIndex(k,W,V):null}function x(k,W){var V=y(k);return V?V.getSegmentByTime(k,W):null}function F(k){var W=y(k);return W?W.getMediaFinishedInformation(k):{numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN}}return p={initialize:v,updateInitData:I,updateSegmentData:D,getSegmentByIndex:A,getSegmentByTime:x,getMediaFinishedInformation:F},C(),p}m.__dashjs_factory_name="SegmentsController";var f=d.default.getClassFactory(m);const T=f},"./src/dash/controllers/ServiceDescriptionController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>T});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js"),l=r("./src/streaming/constants/Constants.js"),c=r("./src/dash/constants/DashConstants.js"),E=[l.default.SERVICE_DESCRIPTION_DVB_LL_SCHEME],m={VIDEO:"video",AUDIO:"audio",ANY:"any",ALL:"all"};function f(){var L=this.context,P,O,M,S,p;function h(){S=(0,o.default)(L).getInstance().getLogger(P),I()}function C(Y){Y&&Y.adapter&&(p=Y.adapter)}function v(){I()}function I(){O={liveDelay:NaN,liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN}},minBitrate:{},maxBitrate:{},initialBitrate:{}},M=[]}function D(){return O}function y(Y){if(!(!Y||!Y.serviceDescriptions)){var re=Y.serviceDescriptions.filter(function(ne){return E.includes(ne.schemeIdUri)}),ie=Y.serviceDescriptions.filter(function(ne){return ne.schemeIdUri==null}),ee=re.length>0?re[re.length-1]:ie[ie.length-1];ee&&(ee.latency&&ee.latency.target>0&&A(ee),ee.playbackRate&&k(ee),ee.operatingQuality,ee.operatingBandwidth&&W(ee))}}function A(Y){var re;if(Y.schemeIdUri===l.default.SERVICE_DESCRIPTION_DVB_LL_SCHEME?re=F(Y):re=x(Y),M.length>0){var ie=K(re),ee=ie.to,ne=ie.id;O.liveDelay=re.liveDelay-ee,O.liveCatchup.maxDrift=re.maxDrift,S.debug(`
                Found latency properties coming from service description. Applied time offset of `.concat(ee," from ProducerReferenceTime element with id ").concat(ne,`.
                Live Delay: `).concat(re.liveDelay-ee,", Live catchup max drift: ").concat(re.maxDrift,`
            `))}else O.liveDelay=re.liveDelay,O.liveCatchup.maxDrift=re.maxDrift,S.debug("Found latency properties coming from service description: Live Delay: ".concat(re.liveDelay,", Live catchup max drift: ").concat(re.maxDrift))}function x(Y){var re=Y.latency.target/1e3,ie=!isNaN(Y.latency.max)&&Y.latency.max>Y.latency.target?(Y.latency.max-Y.latency.target+500)/1e3:NaN,ee=Y.latency.referenceId||NaN;return{liveDelay:re,maxDrift:ie,referenceId:ee}}function F(Y){var re=Y.latency.target/1e3,ie=!isNaN(Y.latency.max)&&Y.latency.max>Y.latency.target?(Y.latency.max-Y.latency.target+500)/1e3:NaN,ee=Y.latency.referenceId||NaN;return{liveDelay:re,maxDrift:ie,referenceId:ee}}function k(Y){var re=Y.playbackRate.min?Math.round((Y.playbackRate.min-1)*1e3)/1e3:NaN,ie=Y.playbackRate.max?Math.round((Y.playbackRate.max-1)*1e3)/1e3:NaN;O.liveCatchup.playbackRate.min=re,O.liveCatchup.playbackRate.max=ie,S.debug("Found latency properties coming from service description: Live catchup min playback rate: ".concat(re)),S.debug("Found latency properties coming from service description: Live catchup max playback rate: ".concat(ie))}function W(Y){if(!(!Y||!Y.operatingBandwidth||!Y.operatingBandwidth.mediaType||Y.operatingBandwidth.mediaType===m.ALL)){var re={};re.minBandwidth=Y.operatingBandwidth.min,re.maxBandwidth=Y.operatingBandwidth.max,re.targetBandwidth=Y.operatingBandwidth.target;var ie=[];Y.operatingBandwidth.mediaType===m.VIDEO||Y.operatingBandwidth.mediaType===m.AUDIO?ie.push(Y.operatingBandwidth.mediaType):Y.operatingBandwidth.mediaType===m.ANY&&(ie.push(m.AUDIO),ie.push(m.VIDEO)),ie.forEach(function(ee){isNaN(re.minBandwidth)||V("minBitrate",ee,re.minBandwidth),isNaN(re.maxBandwidth)||V("maxBitrate",ee,re.maxBandwidth),isNaN(re.targetBandwidth)||V("initialBitrate",ee,re.targetBandwidth)})}}function V(Y,re,ie){try{O[Y][re]=ie/1e3}catch(ee){S.error(ee)}}function Q(){return M}function $(Y){try{var re=[];if(Y&&Y.length>0){var ie=[l.default.VIDEO,l.default.AUDIO,l.default.TEXT],ee=p.getAvailabilityStartTime()/1e3;Y.forEach(function(ne){var ae=ie.reduce(function(ce,X){return ce=ce.concat(p.getAllMediaInfoForType(ne,X)),ce},[]).reduce(function(ce,X){var oe=p.getProducerReferenceTimes(ne,X);return oe.forEach(function(ge){var _e=p.getVoRepresentations(X);if(_e&&_e.length>0&&_e[0].adaptation&&_e[0].segmentInfoType===c.default.SEGMENT_TEMPLATE){var he=_e[0],se=new Date(ge[c.default.WALL_CLOCK_TIME]),Z=se.getTime()/1e3,q=Z-(ge[c.default.PRESENTATION_TIME]/he[c.default.TIMESCALE]-he[c.default.PRESENTATION_TIME_OFFSET]+ne.start),le=ee-q;ce.push({id:ge[c.default.ID],to:le})}}),ce},[]);re=re.concat(ae)})}M=re}catch(ne){S.error(ne),M=[]}}function K(Y){var re=0,ie,ee=M.filter(function(ne){return ne.id===Y.referenceId});return ee.length===0?(re=M.length>0?M[0].to:0,ie=M[0].id||NaN):(re=ee[0].to||0,ie=ee[0].id||NaN),{to:re,id:ie}}return P={getServiceDescriptionSettings:D,getProducerReferenceTimeOffsets:Q,calculateProducerReferenceTimeOffsets:$,applyServiceDescription:y,reset:v,setConfig:C},h(),P}f.__dashjs_factory_name="ServiceDescriptionController";const T=d.default.getSingletonFactory(f)},"./src/dash/models/DashManifestModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>$});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/dash/constants/DashConstants.js"),l=r("./src/dash/vo/Representation.js"),c=r("./src/dash/vo/AdaptationSet.js"),E=r("./src/dash/vo/Period.js"),m=r("./src/dash/vo/Mpd.js"),f=r("./src/dash/vo/UTCTiming.js"),T=r("./src/dash/vo/Event.js"),L=r("./src/dash/vo/BaseURL.js"),P=r("./src/dash/vo/EventStream.js"),O=r("./src/dash/vo/ProducerReferenceTime.js"),M=r("./src/dash/vo/ContentSteering.js"),S=r("./src/streaming/utils/ObjectUtils.js"),p=r("./src/streaming/utils/URLUtils.js"),h=r("./src/core/FactoryMaker.js"),C=r("./src/core/Debug.js"),v=r("./src/streaming/vo/DashJSError.js"),I=r("./src/core/errors/Errors.js"),D=r("./src/streaming/thumbnail/ThumbnailTracks.js");function y(K,Y){var re;if(typeof Symbol>"u"||K[Symbol.iterator]==null){if(Array.isArray(K)||(re=F(K))||Y&&K&&typeof K.length=="number"){re&&(K=re);var ie=0,ee=function(){};return{s:ee,n:function(){return ie>=K.length?{done:!0}:{done:!1,value:K[ie++]}},e:function(oe){throw oe},f:ee}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ne=!0,ae=!1,ce;return{s:function(){re=K[Symbol.iterator]()},n:function(){var oe=re.next();return ne=oe.done,oe},e:function(oe){ae=!0,ce=oe},f:function(){try{!ne&&re.return!=null&&re.return()}finally{if(ae)throw ce}}}}function A(K){return W(K)||k(K)||F(K)||x()}function x(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F(K,Y){if(K){if(typeof K=="string")return V(K,Y);var re=Object.prototype.toString.call(K).slice(8,-1);if(re==="Object"&&K.constructor&&(re=K.constructor.name),re==="Map"||re==="Set")return Array.from(K);if(re==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(re))return V(K,Y)}}function k(K){if(typeof Symbol<"u"&&Symbol.iterator in Object(K))return Array.from(K)}function W(K){if(Array.isArray(K))return V(K)}function V(K,Y){(Y==null||Y>K.length)&&(Y=K.length);for(var re=0,ie=new Array(Y);re<Y;re++)ie[re]=K[re];return ie}function Q(){var K,Y,re,ie,ee=this.context,ne=(0,p.default)(ee).getInstance(),ae=Number.isInteger||function(pe){return typeof pe=="number"&&isFinite(pe)&&Math.floor(pe)===pe};function ce(){Y=(0,C.default)(ee).getInstance().getLogger(K)}function X(pe,Ve){if(!pe)throw new Error("adaptation is not defined");if(!Ve)throw new Error("type is not defined");if(pe.Representation_asArray&&pe.Representation_asArray.length){var ut=tt(pe.Representation_asArray[0]);if(ut&&ut.length>0&&D.THUMBNAILS_SCHEME_ID_URIS.indexOf(ut[0].schemeIdUri)>=0)return Ve===d.default.IMAGE}if(pe.ContentComponent_asArray&&pe.ContentComponent_asArray.length>0){if(pe.ContentComponent_asArray.length>1)return Ve===d.default.MUXED;if(pe.ContentComponent_asArray[0].contentType===Ve)return!0}var Ie=Ve===d.default.TEXT?new RegExp("(ttml|vtt|wvtt|stpp)"):new RegExp(Ve);if(pe.Representation_asArray&&pe.Representation_asArray.length){var we=pe.Representation_asArray[0].codecs;if(Ie.test(we))return!0}if(pe.hasOwnProperty(o.default.MIME_TYPE))return Ie.test(pe.mimeType);if(pe.Representation_asArray){for(var ze,Et=0;Et<pe.Representation_asArray.length;Et++)if(ze=pe.Representation_asArray[Et],ze.hasOwnProperty(o.default.MIME_TYPE))return Ie.test(ze.mimeType)}return!1}function oe(pe){if(!pe)throw new Error("adaptation is not defined");if(pe.hasOwnProperty(o.default.SEGMENT_TEMPLATE)||pe.hasOwnProperty(o.default.SEGMENT_TIMELINE)||pe.hasOwnProperty(o.default.SEGMENT_LIST)||pe.hasOwnProperty(o.default.SEGMENT_BASE))return!0;if(pe.Representation_asArray&&pe.Representation_asArray.length>0){var Ve=pe.Representation_asArray[0];if(Ve.hasOwnProperty(o.default.SEGMENT_TEMPLATE)||Ve.hasOwnProperty(o.default.SEGMENT_TIMELINE)||Ve.hasOwnProperty(o.default.SEGMENT_LIST)||Ve.hasOwnProperty(o.default.SEGMENT_BASE))return!0}return!1}function ge(pe){return X(pe,d.default.AUDIO)}function _e(pe){return X(pe,d.default.VIDEO)}function he(pe){return X(pe,d.default.TEXT)}function se(pe){return X(pe,d.default.MUXED)}function Z(pe){return X(pe,d.default.IMAGE)}function q(pe){var Ve=pe&&pe.hasOwnProperty(o.default.PRODUCERREFERENCETIME_ASARRAY)?pe[o.default.PRODUCERREFERENCETIME_ASARRAY]:[],ut=pe&&pe.hasOwnProperty(o.default.REPRESENTATION_ASARRAY)?pe[o.default.REPRESENTATION_ASARRAY]:[];ut.forEach(function(we){we.hasOwnProperty(o.default.PRODUCERREFERENCETIME_ASARRAY)&&Ve.push.apply(Ve,A(we[o.default.PRODUCERREFERENCETIME_ASARRAY]))});var Ie=[];return Ve.forEach(function(we){var ze=new O.default;if(we.hasOwnProperty(o.default.ID))ze[o.default.ID]=we[o.default.ID];else return;if(we.hasOwnProperty(o.default.WALL_CLOCK_TIME))ze[o.default.WALL_CLOCK_TIME]=we[o.default.WALL_CLOCK_TIME];else return;if(we.hasOwnProperty(o.default.PRESENTATION_TIME))ze[o.default.PRESENTATION_TIME]=we[o.default.PRESENTATION_TIME];else return;Ie.push(ze)}),Ie}function le(pe){var Ve="";return pe&&pe.hasOwnProperty(o.default.LANG)&&(Ve=pe.lang),Ve}function te(pe){return pe&&pe.hasOwnProperty(o.default.VIEWPOINT)?pe.Viewpoint:null}function N(pe){return pe&&pe.hasOwnProperty(o.default.ROLE_ASARRAY)?pe.Role_asArray:[]}function R(pe){return pe&&pe.hasOwnProperty(o.default.ACCESSIBILITY_ASARRAY)?pe.Accessibility_asArray:[]}function w(pe){return pe&&pe.hasOwnProperty(o.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?pe.AudioChannelConfiguration_asArray:[]}function j(pe){return pe&&pe.hasOwnProperty(o.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?pe.AudioChannelConfiguration_asArray:[]}function H(){return function(pe,Ve){return pe.bandwidth-Ve.bandwidth}}function U(pe){return pe&&Array.isArray(pe.Representation_asArray)&&pe.Representation_asArray.sort(H()),pe}function B(pe,Ve){return pe&&pe.Period_asArray&&ae(Ve)?pe.Period_asArray[Ve]?pe.Period_asArray[Ve].AdaptationSet_asArray:[]:[]}function G(pe){return pe&&pe.Period_asArray?pe.Period_asArray:[]}function z(pe,Ve){var ut=G(Ve);return ut.length>0&&ae(pe)?ut[pe]:null}function fe(pe,Ve,ut){var Ie=B(Ve,ut),we,ze;for(we=0,ze=Ie.length;we<ze;we++)if(Ie[we].hasOwnProperty(o.default.ID)&&Ie[we].id===pe)return Ie[we];return null}function ue(pe,Ve,ut){var Ie=B(Ve,ut);return Ie.length>0&&ae(pe)?Ie[pe]:null}function J(pe,Ve,ut){if(!pe)return-1;for(var Ie=B(Ve,ut),we=0;we<Ie.length;we++){var ze=(0,S.default)(ee).getInstance();if(ze.areEqual(Ie[we],pe))return we}return-1}function ve(pe,Ve,ut){var Ie=B(pe,Ve),we,ze,Et=[];for(we=0,ze=Ie.length;we<ze;we++)X(Ie[we],ut)&&Et.push(U(Ie[we]));return Et}function me(pe,Ve,ut){var Ie=null;if(pe&&pe.Representation_asArray&&pe.Representation_asArray.length>0){var we=ae(Ve)&&Ve>=0&&Ve<pe.Representation_asArray.length?pe.Representation_asArray[Ve]:pe.Representation_asArray[0];we&&(Ie=we.mimeType+';codecs="'+we.codecs+'"',ut&&we.width!==void 0&&(Ie+=';width="'+we.width+'";height="'+we.height+'"'))}return Ie&&(Ie=Ie.replace(/\sprofiles=[^;]*/g,"")),Ie}function Ae(pe){return pe&&pe.Representation_asArray&&pe.Representation_asArray.length>0?pe.Representation_asArray[0].mimeType:null}function be(pe){return!pe||!pe.hasOwnProperty(o.default.CENC_DEFAULT_KID)?null:pe[o.default.CENC_DEFAULT_KID]}function Be(pe){if(!pe||!Array.isArray(pe.Label_asArray))return[];for(var Ve=[],ut=0;ut<pe.Label_asArray.length;ut++)Ve.push({lang:pe.Label_asArray[ut].lang,text:pe.Label_asArray[ut].__text||pe.Label_asArray[ut]});return Ve}function ke(pe){return!pe||!pe.hasOwnProperty(o.default.CONTENTPROTECTION_ASARRAY)||pe.ContentProtection_asArray.length===0?null:pe.ContentProtection_asArray}function Ye(pe){var Ve=!1;return pe&&pe.hasOwnProperty("type")&&(Ve=pe.type===o.default.DYNAMIC),Ve}function Oe(pe){return pe&&pe[o.default.ID]||null}function Se(pe,Ve){var ut=!1;return pe&&pe.profiles&&pe.profiles.length>0&&(ut=pe.profiles.indexOf(Ve)!==-1),ut}function Me(pe){var Ve;return pe&&pe.hasOwnProperty(o.default.MEDIA_PRESENTATION_DURATION)?Ve=pe.mediaPresentationDuration:pe&&pe.type=="dynamic"?Ve=Number.POSITIVE_INFINITY:Ve=Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,Ve}function qe(pe){return pe&&pe.bandwidth?pe.bandwidth:NaN}function it(pe){var Ve=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,ut=NaN;return pe&&pe.hasOwnProperty(o.default.MINIMUM_UPDATE_PERIOD)&&(ut=pe.minimumUpdatePeriod),isNaN(ut)?ut:Math.max(ut-Ve,1)}function at(pe){return pe&&pe.hasOwnProperty(o.default.PUBLISH_TIME)?new Date(pe[o.default.PUBLISH_TIME]):null}function Ce(pe){return pe&&Array.isArray(pe.Representation_asArray)?pe.Representation_asArray.length:0}function We(pe){var Ve=U(pe),ut=Ve&&Array.isArray(Ve.Representation_asArray)?Ve.Representation_asArray:[];return ut.map(function(Ie){return{bandwidth:Ie.bandwidth,width:Ie.width||0,height:Ie.height||0,scanType:Ie.scanType||null,id:Ie.id||null}})}function Ge(pe){try{var Ve=pe&&typeof pe.selectionPriority<"u"?parseInt(pe.selectionPriority):1;return isNaN(Ve)?1:Ve}catch{return 1}}function tt(pe){return!pe||!pe.EssentialProperty_asArray||!pe.EssentialProperty_asArray.length?null:pe.EssentialProperty_asArray.map(function(Ve){return{schemeIdUri:Ve.schemeIdUri,value:Ve.value}})}function ot(pe,Ve){return Ve&&Ve.Representation_asArray&&Ve.Representation_asArray.length>0&&ae(pe)?Ve.Representation_asArray[pe]:null}function ct(pe){if(pe&&pe.period&&ae(pe.period.index)){var Ve=pe.period.mpd.manifest.Period_asArray[pe.period.index];if(Ve&&Ve.AdaptationSet_asArray&&ae(pe.index))return U(Ve.AdaptationSet_asArray[pe.index])}}function ht(pe){var Ve=[],ut=ct(pe),Ie,we;if(ut&&ut.Representation_asArray){if(pe&&pe.period&&ae(pe.period.index)){var ze=De(pe.period.mpd.manifest);ze&&(we=ze[0])}for(var Et=0,xt=ut.Representation_asArray.length;Et<xt;++Et){var Dt=ut.Representation_asArray[Et],Rt=new l.default;if(Rt.index=Et,Rt.adaptation=pe,Dt.hasOwnProperty(o.default.ID)&&(Rt.id=Dt.id),Dt.hasOwnProperty(o.default.CODECS)&&(Rt.codecs=Dt.codecs),Dt.hasOwnProperty(o.default.MIME_TYPE)&&(Rt.mimeType=Dt[o.default.MIME_TYPE]),Dt.hasOwnProperty(o.default.CODEC_PRIVATE_DATA)&&(Rt.codecPrivateData=Dt.codecPrivateData),Dt.hasOwnProperty(o.default.BANDWITH)&&(Rt.bandwidth=Dt.bandwidth),Dt.hasOwnProperty(o.default.WIDTH)&&(Rt.width=Dt.width),Dt.hasOwnProperty(o.default.HEIGHT)&&(Rt.height=Dt.height),Dt.hasOwnProperty(o.default.SCAN_TYPE)&&(Rt.scanType=Dt.scanType),Dt.hasOwnProperty(o.default.MAX_PLAYOUT_RATE)&&(Rt.maxPlayoutRate=Dt.maxPlayoutRate),Dt.hasOwnProperty(o.default.SEGMENT_BASE)?(Ie=Dt.SegmentBase,Rt.segmentInfoType=o.default.SEGMENT_BASE):Dt.hasOwnProperty(o.default.SEGMENT_LIST)?(Ie=Dt.SegmentList,Ie.hasOwnProperty(o.default.SEGMENT_TIMELINE)?Rt.segmentInfoType=o.default.SEGMENT_TIMELINE:Rt.segmentInfoType=o.default.SEGMENT_LIST):Dt.hasOwnProperty(o.default.SEGMENT_TEMPLATE)?(Ie=Dt.SegmentTemplate,Ie.hasOwnProperty(o.default.SEGMENT_TIMELINE)?Rt.segmentInfoType=o.default.SEGMENT_TIMELINE:Rt.segmentInfoType=o.default.SEGMENT_TEMPLATE,Ie.hasOwnProperty(o.default.INITIALIZATION_MINUS)&&(Rt.initialization=Ie.initialization.split("$Bandwidth$").join(Dt.bandwidth).split("$RepresentationID$").join(Dt.id))):Rt.segmentInfoType=o.default.BASE_URL,Rt.essentialProperties=tt(Dt),Ie){if(Ie.hasOwnProperty(o.default.INITIALIZATION)){var Qt=Ie.Initialization;Qt.hasOwnProperty(o.default.SOURCE_URL)&&(Rt.initialization=Qt.sourceURL),Qt.hasOwnProperty(o.default.RANGE)&&(Rt.range=Qt.range)}else he(ut)&&oe(ut)&&ut.mimeType&&ut.mimeType.indexOf("application/mp4")===-1&&(Rt.range=0);Ie.hasOwnProperty(o.default.TIMESCALE)&&(Rt.timescale=Ie.timescale),Ie.hasOwnProperty(o.default.DURATION)?Rt.segmentDuration=Ie.duration/Rt.timescale:Dt.hasOwnProperty(o.default.SEGMENT_TEMPLATE)&&(Ie=Dt.SegmentTemplate,Ie.hasOwnProperty(o.default.SEGMENT_TIMELINE)&&(Rt.segmentDuration=Pt(Ie.SegmentTimeline)/Rt.timescale)),Ie.hasOwnProperty(o.default.MEDIA)&&(Rt.media=Ie.media),Ie.hasOwnProperty(o.default.START_NUMBER)&&(Rt.startNumber=Ie.startNumber),Ie.hasOwnProperty(o.default.INDEX_RANGE)&&(Rt.indexRange=Ie.indexRange),Ie.hasOwnProperty(o.default.PRESENTATION_TIME_OFFSET)&&(Rt.presentationTimeOffset=Ie.presentationTimeOffset/Rt.timescale),Ie.hasOwnProperty(o.default.AVAILABILITY_TIME_OFFSET)?Rt.availabilityTimeOffset=Ie.availabilityTimeOffset:we&&we.availabilityTimeOffset!==void 0&&(Rt.availabilityTimeOffset=we.availabilityTimeOffset),Ie.hasOwnProperty(o.default.AVAILABILITY_TIME_COMPLETE)?Rt.availabilityTimeComplete=Ie.availabilityTimeComplete!=="false":we&&we.availabilityTimeComplete!==void 0&&(Rt.availabilityTimeComplete=we.availabilityTimeComplete)}Rt.MSETimeOffset=$e(Rt),Rt.path=[pe.period.index,pe.index,Et],Ve.push(Rt)}}return Ve}function Pt(pe){if(!pe||!pe.S_asArray)return NaN;var Ve=pe.S_asArray[0],ut=pe.S_asArray[1];return Ve.hasOwnProperty("d")?Ve.d:ut.t-Ve.t}function $e(pe){var Ve=pe.presentationTimeOffset,ut=pe.adaptation.period.start;return ut-Ve}function Te(pe){var Ve=pe&&ae(pe.index)?pe.mpd.manifest.Period_asArray[pe.index]:null,ut=[],Ie,we,ze;if(Ve&&Ve.AdaptationSet_asArray)for(ze=0;ze<Ve.AdaptationSet_asArray.length;ze++)we=Ve.AdaptationSet_asArray[ze],Ie=new c.default,we.hasOwnProperty(o.default.ID)&&(Ie.id=we.id),Ie.index=ze,Ie.period=pe,se(we)?Ie.type=d.default.MUXED:ge(we)?Ie.type=d.default.AUDIO:_e(we)?Ie.type=d.default.VIDEO:he(we)?Ie.type=d.default.TEXT:Z(we)?Ie.type=d.default.IMAGE:Y.warn("Unknown Adaptation stream type"),ut.push(Ie);return ut}function de(pe){var Ve=pe?Ye(pe.manifest):!1,ut=[],Ie=null,we=null,ze=null,Et=null,xt,Dt;for(Dt=0,xt=pe&&pe.manifest&&pe.manifest.Period_asArray?pe.manifest.Period_asArray.length:0;Dt<xt;Dt++)we=pe.manifest.Period_asArray[Dt],we.hasOwnProperty(o.default.START)?(Et=new E.default,Et.start=we.start):Ie!==null&&Ie.hasOwnProperty(o.default.DURATION)&&ze!==null?(Et=new E.default,Et.start=parseFloat((ze.start+ze.duration).toFixed(5))):Dt===0&&!Ve&&(Et=new E.default,Et.start=0),ze!==null&&isNaN(ze.duration)&&(Et!==null?ze.duration=parseFloat((Et.start-ze.start).toFixed(5)):Y.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),Et!==null&&(Et.id=Re(we,Dt),Et.index=Dt,Et.mpd=pe,we.hasOwnProperty(o.default.DURATION)&&(Et.duration=we.duration),ze&&(ze.nextPeriodId=Et.id),ut.push(Et),Ie=we,ze=Et),we=null,Et=null;return ut.length===0||ze!==null&&isNaN(ze.duration)&&(ze.duration=parseFloat((Xe(ze)-ze.start).toFixed(5))),ut}function Re(pe,Ve){if(!pe)throw new Error("Period cannot be null or undefined");var ut=E.default.DEFAULT_ID+"_"+Ve;return pe.hasOwnProperty(o.default.ID)&&pe.id.length>0&&pe.id!=="__proto__"&&(ut=pe.id),ut}function xe(pe){var Ve=new m.default;return pe&&(Ve.manifest=pe,pe.hasOwnProperty(o.default.AVAILABILITY_START_TIME)?Ve.availabilityStartTime=new Date(pe.availabilityStartTime.getTime()):pe.loadedTime&&(Ve.availabilityStartTime=new Date(pe.loadedTime.getTime())),pe.hasOwnProperty(o.default.AVAILABILITY_END_TIME)&&(Ve.availabilityEndTime=new Date(pe.availabilityEndTime.getTime())),pe.hasOwnProperty(o.default.MINIMUM_UPDATE_PERIOD)&&(Ve.minimumUpdatePeriod=pe.minimumUpdatePeriod),pe.hasOwnProperty(o.default.MEDIA_PRESENTATION_DURATION)&&(Ve.mediaPresentationDuration=pe.mediaPresentationDuration),pe.hasOwnProperty(o.default.SUGGESTED_PRESENTATION_DELAY)&&(Ve.suggestedPresentationDelay=pe.suggestedPresentationDelay),pe.hasOwnProperty(o.default.TIMESHIFT_BUFFER_DEPTH)&&(Ve.timeShiftBufferDepth=pe.timeShiftBufferDepth),pe.hasOwnProperty(o.default.MAX_SEGMENT_DURATION)&&(Ve.maxSegmentDuration=pe.maxSegmentDuration),pe.hasOwnProperty(o.default.PUBLISH_TIME)&&(Ve.publishTime=new Date(pe.publishTime))),Ve}function Ne(){if(!re||!re.hasOwnProperty("error"))throw new Error(d.default.MISSING_CONFIG_ERROR)}function Xe(pe){Ne();var Ve=Ye(pe.mpd.manifest),ut;return pe.mpd.manifest.mediaPresentationDuration?ut=pe.mpd.manifest.mediaPresentationDuration:pe.duration?ut=pe.duration:Ve?ut=Number.POSITIVE_INFINITY:re.error(new v.default(I.default.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",pe)),ut}function nt(pe){var Ve=pe&&pe.mpd&&pe.mpd.manifest?pe.mpd.manifest:null,ut=Ve?Ve.Period_asArray:null,Ie=ut&&pe&&ae(pe.index)?ut[pe.index].EventStream_asArray:null,we=[],ze,Et;if(Ie)for(ze=0;ze<Ie.length;ze++){var xt=new P.default;if(xt.period=pe,xt.timescale=1,Ie[ze].hasOwnProperty(d.default.SCHEME_ID_URI))xt.schemeIdUri=Ie[ze][d.default.SCHEME_ID_URI];else throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(Ie[ze].hasOwnProperty(o.default.TIMESCALE)&&(xt.timescale=Ie[ze][o.default.TIMESCALE]),Ie[ze].hasOwnProperty(o.default.VALUE)&&(xt.value=Ie[ze][o.default.VALUE]),Ie[ze].hasOwnProperty(o.default.PRESENTATION_TIME_OFFSET)&&(xt.presentationTimeOffset=Ie[ze][o.default.PRESENTATION_TIME_OFFSET]),Et=0;Ie[ze].Event_asArray&&Et<Ie[ze].Event_asArray.length;Et++){var Dt=Ie[ze].Event_asArray[Et],Rt=new T.default;Rt.presentationTime=0,Rt.eventStream=xt,Dt.hasOwnProperty(o.default.PRESENTATION_TIME)&&(Rt.presentationTime=Dt.presentationTime);var Qt=xt.presentationTimeOffset?xt.presentationTimeOffset/xt.timescale:0;Rt.calculatedPresentationTime=Rt.presentationTime/xt.timescale+pe.start-Qt,Dt.hasOwnProperty(o.default.DURATION)&&(Rt.duration=Dt.duration/xt.timescale),Dt.hasOwnProperty(o.default.ID)?Rt.id=Dt.id:Rt.id=null,Dt.Signal&&Dt.Signal.Binary?Rt.messageData=ie.decodeArray(Dt.Signal.Binary.toString()):Rt.messageData=Dt.messageData||Dt.__cdata||Dt.__text,we.push(Rt)}}return we}function et(pe,Ve,ut){var Ie=[],we;if(!pe)return Ie;for(we=0;we<pe.length;we++){var ze=new P.default;if(ze.timescale=1,ze.representation=Ve,pe[we].hasOwnProperty(d.default.SCHEME_ID_URI))ze.schemeIdUri=pe[we].schemeIdUri;else throw new Error("Invalid EventStream. SchemeIdUri has to be set");pe[we].hasOwnProperty(o.default.TIMESCALE)&&(ze.timescale=pe[we].timescale),pe[we].hasOwnProperty(o.default.VALUE)&&(ze.value=pe[we].value),Ie.push(ze),ze.period=ut}return Ie}function dt(pe,Ve,ut){var Ie,we,ze;return pe&&pe.Period_asArray&&Ve&&Ve.period&&ae(Ve.period.index)&&(we=pe.Period_asArray[Ve.period.index],we&&we.AdaptationSet_asArray&&ae(Ve.index)&&(ze=we.AdaptationSet_asArray[Ve.index],ze&&(Ie=ze.InbandEventStream_asArray))),et(Ie,null,ut)}function Tt(pe,Ve,ut){var Ie,we,ze,Et;return pe&&pe.Period_asArray&&Ve&&Ve.adaptation&&Ve.adaptation.period&&ae(Ve.adaptation.period.index)&&(we=pe.Period_asArray[Ve.adaptation.period.index],we&&we.AdaptationSet_asArray&&ae(Ve.adaptation.index)&&(ze=we.AdaptationSet_asArray[Ve.adaptation.index],ze&&ze.Representation_asArray&&ae(Ve.index)&&(Et=ze.Representation_asArray[Ve.index],Et&&(Ie=Et.InbandEventStream_asArray)))),et(Ie,Ve,ut)}function Ct(pe){var Ve=Ye(pe),ut=pe?pe.hasOwnProperty(o.default.AVAILABILITY_START_TIME):!1,Ie=pe?pe.UTCTiming_asArray:null,we=[];return(Ve||ut)&&Ie&&Ie.forEach(function(ze){var Et=new f.default;if(ze.hasOwnProperty(d.default.SCHEME_ID_URI))Et.schemeIdUri=ze.schemeIdUri;else return;if(ze.hasOwnProperty(o.default.VALUE))Et.value=ze.value.toString();else return;we.push(Et)}),we}function De(pe){var Ve=[],ut=pe.BaseURL_asArray||[pe.baseUri],Ie=!1;return ut.some(function(we){if(we){var ze=new L.default,Et=we.__text||we;return ne.isRelative(Et)&&(Ie=!0,pe.baseUri&&(Et=ne.resolve(Et,pe.baseUri))),ze.url=Et,we.hasOwnProperty(o.default.SERVICE_LOCATION)&&we.serviceLocation.length?ze.serviceLocation=we.serviceLocation:ze.serviceLocation=Et,we.hasOwnProperty(o.default.DVB_PRIORITY)&&(ze.dvb_priority=we[o.default.DVB_PRIORITY]),we.hasOwnProperty(o.default.DVB_WEIGHT)&&(ze.dvb_weight=we[o.default.DVB_WEIGHT]),we.hasOwnProperty(o.default.AVAILABILITY_TIME_OFFSET)&&(ze.availabilityTimeOffset=we[o.default.AVAILABILITY_TIME_OFFSET]),we.hasOwnProperty(o.default.AVAILABILITY_TIME_COMPLETE)&&(ze.availabilityTimeComplete=we[o.default.AVAILABILITY_TIME_COMPLETE]!=="false"),Ve.push(ze),Ie}}),Ve}function Ue(pe){if(pe&&pe.hasOwnProperty(o.default.CONTENT_STEERING_AS_ARRAY)){var Ve=pe[o.default.CONTENT_STEERING_AS_ARRAY][0],ut=new M.default;return ut.serverUrl=Ve.__text,Ve.hasOwnProperty(o.default.DEFAULT_SERVICE_LOCATION)&&(ut.defaultServiceLocation=Ve[o.default.DEFAULT_SERVICE_LOCATION]),Ve.hasOwnProperty(o.default.QUERY_BEFORE_START)&&(ut.queryBeforeStart=Ve[o.default.QUERY_BEFORE_START].toLowerCase()==="true"),Ve.hasOwnProperty(o.default.PROXY_SERVER_URL)&&(ut.proxyServerUrl=Ve[o.default.PROXY_SERVER_URL]),ut}}function Ze(pe){if(pe&&pe.hasOwnProperty(d.default.LOCATION))return pe.Location=pe.Location_asArray[0],pe.Location}function mt(pe){if(pe&&pe.hasOwnProperty(o.default.PATCH_LOCATION))return pe.PatchLocation=pe.PatchLocation_asArray[0],pe.PatchLocation}function ft(pe){return pe&&pe.hasOwnProperty(o.default.SUGGESTED_PRESENTATION_DELAY)?pe.suggestedPresentationDelay:null}function pt(pe){return pe&&pe.hasOwnProperty(o.default.AVAILABILITY_START_TIME)&&pe.availabilityStartTime!==null?pe.availabilityStartTime.getTime():null}function Mt(pe){var Ve=[];if(pe&&pe.hasOwnProperty(o.default.SERVICE_DESCRIPTION)){var ut=y(pe.ServiceDescription_asArray),Ie;try{for(ut.s();!(Ie=ut.n()).done;){var we=Ie.value,ze=null,Et=null,xt=null,Dt=null,Rt=null,Qt=null;for(var Wt in we)we.hasOwnProperty(Wt)&&(Wt===o.default.ID?ze=we[Wt]:Wt===o.default.SERVICE_DESCRIPTION_SCOPE?Et=we[Wt].schemeIdUri:Wt===o.default.SERVICE_DESCRIPTION_LATENCY?xt={target:parseInt(we[Wt].target),max:parseInt(we[Wt].max),min:parseInt(we[Wt].min),referenceId:parseInt(we[Wt].referenceId)}:Wt===o.default.SERVICE_DESCRIPTION_PLAYBACK_RATE?Dt={max:parseFloat(we[Wt].max),min:parseFloat(we[Wt].min)}:Wt===o.default.SERVICE_DESCRIPTION_OPERATING_QUALITY?Rt={mediaType:we[Wt].mediaType,max:parseInt(we[Wt].max),min:parseInt(we[Wt].min),target:parseInt(we[Wt].target),type:we[Wt].type,maxQualityDifference:parseInt(we[Wt].maxQualityDifference)}:Wt===o.default.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH&&(Qt={mediaType:we[Wt].mediaType,max:parseInt(we[Wt].max),min:parseInt(we[Wt].min),target:parseInt(we[Wt].target)}));Ve.push({id:ze,schemeIdUri:Et,latency:xt,playbackRate:Dt,operatingQuality:Rt,operatingBandwidth:Qt})}}catch(Je){ut.e(Je)}finally{ut.f()}}return Ve}function Kt(pe){var Ve={};if(pe&&pe.hasOwnProperty(o.default.SUPPLEMENTAL_PROPERTY)){var ut=y(pe.SupplementalProperty_asArray),Ie;try{for(ut.s();!(Ie=ut.n()).done;){var we=Ie.value;we.hasOwnProperty(d.default.SCHEME_ID_URI)&&we.hasOwnProperty(o.default.VALUE)&&(Ve[we[d.default.SCHEME_ID_URI]]=we[o.default.VALUE])}}catch(ze){ut.e(ze)}finally{ut.f()}}return Ve}function jt(pe){pe&&(pe.errHandler&&(re=pe.errHandler),pe.BASE64&&(ie=pe.BASE64))}return K={getIsTypeOf:X,getIsText:he,getIsFragmented:oe,getProducerReferenceTimesForAdaptation:q,getLanguageForAdaptation:le,getViewpointForAdaptation:te,getRolesForAdaptation:N,getAccessibilityForAdaptation:R,getAudioChannelConfigurationForAdaptation:w,getAudioChannelConfigurationForRepresentation:j,getAdaptationForIndex:ue,getIndexForAdaptation:J,getAdaptationForId:fe,getAdaptationsForType:ve,getRealPeriods:G,getRealPeriodForIndex:z,getCodec:me,getSelectionPriority:Ge,getMimeType:Ae,getKID:be,getLabelsForAdaptation:Be,getContentProtectionData:ke,getIsDynamic:Ye,getId:Oe,hasProfile:Se,getDuration:Me,getBandwidth:qe,getManifestUpdatePeriod:it,getPublishTime:at,getRepresentationCount:Ce,getBitrateListForAdaptation:We,getRepresentationFor:ot,getRepresentationsForAdaptation:ht,getAdaptationsForPeriod:Te,getRegularPeriods:de,getMpd:xe,getEventsForPeriod:nt,getEssentialPropertiesForRepresentation:tt,getEventStreamForAdaptationSet:dt,getEventStreamForRepresentation:Tt,getUTCTimingSources:Ct,getBaseURLsFromElement:De,getRepresentationSortFunction:H,getContentSteering:Ue,getLocation:Ze,getPatchLocation:mt,getSuggestedPresentationDelay:ft,getAvailabilityStartTime:pt,getServiceDescriptions:Mt,getSupplementalProperties:Kt,setConfig:jt},ce(),K}Q.__dashjs_factory_name="DashManifestModel";const $=h.default.getSingletonFactory(Q)},"./src/dash/models/PatchManifestModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>f});var d=r("./src/dash/constants/DashConstants.js"),o=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js"),c=r("./src/dash/vo/SimpleXPath.js"),E=r("./src/dash/vo/PatchOperation.js");function m(){var T,L,P=this.context;function O(){L=(0,l.default)(P).getInstance().getLogger(T)}function M(v){return v&&v.hasOwnProperty(d.default.ORIGINAL_MPD_ID)||!1}function S(v){return v&&v.hasOwnProperty(d.default.PUBLISH_TIME)?new Date(v[d.default.PUBLISH_TIME]):null}function p(v){return v&&v.hasOwnProperty(d.default.ORIGINAL_PUBLISH_TIME)?new Date(v[d.default.ORIGINAL_PUBLISH_TIME]):null}function h(v){return v&&v[d.default.ORIGINAL_MPD_ID]||null}function C(v){return v?(v.__children||[]).map(function(I){var D=Object.keys(I)[0];if(D!=="add"&&D!=="remove"&&D!=="replace")return L.warn("Ignoring node of invalid action: ".concat(D)),null;var y=I[D],A=y.sel;if(D==="add"&&y.type){if(!y.type.startsWith("@"))return L.warn("Ignoring add action for prefixed namespace declaration: ".concat(y.type,"=").concat(y.__text)),null;A="".concat(A,"/").concat(y.type)}var x=new c.default(A);if(!x.isValid())return L.warn("Ignoring action with invalid selector: ".concat(D," - ").concat(A)),null;var F=null;x.findsAttribute()?F=y.__text||"":D!=="remove"&&(F=y.__children.reduce(function(W,V){var Q=Object.keys(V)[0];return Q!=="#text"&&(W[Q]=W[Q]||[],W[Q].push(V[Q])),W},{}));var k=new E.default(D,x,F);return D==="add"&&(k.position=y.pos),k}).filter(function(I){return!!I}):[]}return T={getIsPatch:M,getPublishTime:S,getOriginalPublishTime:p,getMpdId:h,getPatchOperations:C},O(),T}m.__dashjs_factory_name="PatchManifestModel";const f=o.default.getSingletonFactory(m)},"./src/dash/parser/DashParser.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>M});var d=r("./src/core/FactoryMaker.js"),o=r("./src/dash/parser/objectiron.js"),l=r("./externals/xml2json.js"),c=r("./src/dash/parser/matchers/StringMatcher.js"),E=r("./src/dash/parser/matchers/DurationMatcher.js"),m=r("./src/dash/parser/matchers/DateTimeMatcher.js"),f=r("./src/dash/parser/matchers/NumericMatcher.js"),T=r("./src/dash/parser/matchers/LangMatcher.js"),L=r("./src/dash/parser/maps/RepresentationBaseValuesMap.js"),P=r("./src/dash/parser/maps/SegmentValuesMap.js");function O(S){S=S||{};var p=this.context,h=S.debug,C,v,I,D,y;function A(){v=h.getLogger(C),I=[new E.default,new m.default,new f.default,new T.default,new c.default],D=new l.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!0,ignoreRoot:!1,matchers:I}),y=(0,o.default)(p).create({adaptationset:new L.default,period:new P.default})}function x(){return I}function F(){return y}function k(W){var V,Q=window.performance.now();if(V=D.xml_str2json(W),!V)throw new Error("parsing the manifest failed");var $=window.performance.now();V.Patch?(V=V.Patch,V.add_asArray&&V.add_asArray.forEach(function(Y){return y.run(Y)}),V.replace_asArray&&V.replace_asArray.forEach(function(Y){return y.run(Y)})):(V=V.MPD,y.run(V));var K=window.performance.now();return v.info("Parsing complete: ( xml2json: "+($-Q).toPrecision(3)+"ms, objectiron: "+(K-$).toPrecision(3)+"ms, total: "+((K-Q)/1e3).toPrecision(3)+"s)"),V.protocol="DASH",V}return C={parse:k,getMatchers:x,getIron:F},A(),C}O.__dashjs_factory_name="DashParser";const M=d.default.getClassFactory(O)},"./src/dash/parser/maps/CommonProperty.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});function d(m,f){if(!(m instanceof f))throw new TypeError("Cannot call a class as a function")}function o(m,f){for(var T=0;T<f.length;T++){var L=f[T];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(m,L.key,L)}}function l(m,f,T){return f&&o(m.prototype,f),T&&o(m,T),m}var c=function(){function m(f){d(this,m);var T=function(P){return P&&P.length&&P.charAt(0)===P.charAt(0).toUpperCase()};this._name=f,this._merge=T(f)}return l(m,[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}]),m}();const E=c},"./src/dash/parser/maps/MapNode.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/dash/parser/maps/CommonProperty.js");function o(f,T){if(!(f instanceof T))throw new TypeError("Cannot call a class as a function")}function l(f,T){for(var L=0;L<T.length;L++){var P=T[L];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(f,P.key,P)}}function c(f,T,L){return T&&l(f.prototype,T),L&&l(f,L),f}var E=function(){function f(T,L,P){var O=this;o(this,f),this._name=T||"",this._properties=[],this._children=P||[],Array.isArray(L)&&L.forEach(function(M){O._properties.push(new d.default(M))})}return c(f,[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}]),f}();const m=E},"./src/dash/parser/maps/RepresentationBaseValuesMap.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/dash/parser/maps/MapNode.js"),o=r("./src/dash/constants/DashConstants.js");function l(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(C){return typeof C}:l=function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},l(p)}function c(p,h){if(!(p instanceof h))throw new TypeError("Cannot call a class as a function")}function E(p,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(h&&h.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),h&&m(p,h)}function m(p,h){return m=Object.setPrototypeOf||function(v,I){return v.__proto__=I,v},m(p,h)}function f(p){var h=P();return function(){var v=O(p),I;if(h){var D=O(this).constructor;I=Reflect.construct(v,arguments,D)}else I=v.apply(this,arguments);return T(this,I)}}function T(p,h){return h&&(l(h)==="object"||typeof h=="function")?h:L(p)}function L(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function O(p){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},O(p)}var M=function(p){E(C,p);var h=f(C);function C(){c(this,C);var v=[o.default.PROFILES,o.default.WIDTH,o.default.HEIGHT,o.default.SAR,o.default.FRAMERATE,o.default.AUDIO_SAMPLING_RATE,o.default.MIME_TYPE,o.default.SEGMENT_PROFILES,o.default.CODECS,o.default.MAXIMUM_SAP_PERIOD,o.default.START_WITH_SAP,o.default.MAX_PLAYOUT_RATE,o.default.CODING_DEPENDENCY,o.default.SCAN_TYPE,o.default.FRAME_PACKING,o.default.AUDIO_CHANNEL_CONFIGURATION,o.default.CONTENT_PROTECTION,o.default.ESSENTIAL_PROPERTY,o.default.SUPPLEMENTAL_PROPERTY,o.default.INBAND_EVENT_STREAM];return h.call(this,o.default.ADAPTATION_SET,v,[new d.default(o.default.REPRESENTATION,v,[new d.default(o.default.SUB_REPRESENTATION,v)])])}return C}(d.default);const S=M},"./src/dash/parser/maps/SegmentValuesMap.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/dash/parser/maps/MapNode.js"),o=r("./src/dash/constants/DashConstants.js");function l(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(C){return typeof C}:l=function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},l(p)}function c(p,h){if(!(p instanceof h))throw new TypeError("Cannot call a class as a function")}function E(p,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(h&&h.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),h&&m(p,h)}function m(p,h){return m=Object.setPrototypeOf||function(v,I){return v.__proto__=I,v},m(p,h)}function f(p){var h=P();return function(){var v=O(p),I;if(h){var D=O(this).constructor;I=Reflect.construct(v,arguments,D)}else I=v.apply(this,arguments);return T(this,I)}}function T(p,h){return h&&(l(h)==="object"||typeof h=="function")?h:L(p)}function L(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function O(p){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},O(p)}var M=function(p){E(C,p);var h=f(C);function C(){c(this,C);var v=[o.default.SEGMENT_BASE,o.default.SEGMENT_TEMPLATE,o.default.SEGMENT_LIST];return h.call(this,o.default.PERIOD,v,[new d.default(o.default.ADAPTATION_SET,v,[new d.default(o.default.REPRESENTATION,v)])])}return C}(d.default);const S=M},"./src/dash/parser/matchers/BaseMatcher.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});function d(m,f){if(!(m instanceof f))throw new TypeError("Cannot call a class as a function")}function o(m,f){for(var T=0;T<f.length;T++){var L=f[T];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(m,L.key,L)}}function l(m,f,T){return f&&o(m.prototype,f),T&&o(m,T),m}var c=function(){function m(f,T){d(this,m),this._test=f,this._converter=T}return l(m,[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}]),m}();const E=c},"./src/dash/parser/matchers/DateTimeMatcher.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>C});var d=r("./src/dash/parser/matchers/BaseMatcher.js");function o(v){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(D){return typeof D}:o=function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},o(v)}function l(v,I){if(!(v instanceof I))throw new TypeError("Cannot call a class as a function")}function c(v,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function");v.prototype=Object.create(I&&I.prototype,{constructor:{value:v,writable:!0,configurable:!0}}),I&&E(v,I)}function E(v,I){return E=Object.setPrototypeOf||function(y,A){return y.__proto__=A,y},E(v,I)}function m(v){var I=L();return function(){var y=P(v),A;if(I){var x=P(this).constructor;A=Reflect.construct(y,arguments,x)}else A=y.apply(this,arguments);return f(this,A)}}function f(v,I){return I&&(o(I)==="object"||typeof I=="function")?I:T(v)}function T(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(v){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(D){return D.__proto__||Object.getPrototypeOf(D)},P(v)}var O=60,M=60,S=1e3,p=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,h=function(v){c(D,v);var I=m(D);function D(){return l(this,D),I.call(this,function(y){return p.test(y.value)},function(y){var A=p.exec(y),x;if(x=Date.UTC(parseInt(A[1],10),parseInt(A[2],10)-1,parseInt(A[3],10),parseInt(A[4],10),parseInt(A[5],10),A[6]&&parseInt(A[6],10)||0,A[7]&&parseFloat(A[7])*S||0),A[9]&&A[10]){var F=parseInt(A[9],10)*M+parseInt(A[10],10);x+=(A[8]==="+"?-1:1)*F*O*S}return new Date(x)})}return D}(d.default);const C=h},"./src/dash/parser/matchers/DurationMatcher.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>y});var d=r("./src/dash/parser/matchers/BaseMatcher.js"),o=r("./src/streaming/constants/Constants.js"),l=r("./src/dash/constants/DashConstants.js");function c(A){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?c=function(F){return typeof F}:c=function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},c(A)}function E(A,x){if(!(A instanceof x))throw new TypeError("Cannot call a class as a function")}function m(A,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(x&&x.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),x&&f(A,x)}function f(A,x){return f=Object.setPrototypeOf||function(k,W){return k.__proto__=W,k},f(A,x)}function T(A){var x=O();return function(){var k=M(A),W;if(x){var V=M(this).constructor;W=Reflect.construct(k,arguments,V)}else W=k.apply(this,arguments);return L(this,W)}}function L(A,x){return x&&(c(x)==="object"||typeof x=="function")?x:P(A)}function P(A){if(A===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function M(A){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},M(A)}var S=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,p=365*24*60*60,h=30*24*60*60,C=24*60*60,v=60*60,I=60,D=function(A){m(F,A);var x=T(F);function F(){return E(this,F),x.call(this,function(k){for(var W=[l.default.MIN_BUFFER_TIME,l.default.MEDIA_PRESENTATION_DURATION,l.default.MINIMUM_UPDATE_PERIOD,l.default.TIMESHIFT_BUFFER_DEPTH,l.default.MAX_SEGMENT_DURATION,l.default.MAX_SUBSEGMENT_DURATION,l.default.SUGGESTED_PRESENTATION_DELAY,l.default.START,o.default.START_TIME,l.default.DURATION],V=W.length,Q=0;Q<V;Q++)if(k.nodeName===W[Q])return S.test(k.value);return!1},function(k){var W=S.exec(k),V=parseFloat(W[3]||0)*p+parseFloat(W[5]||0)*h+parseFloat(W[7]||0)*C+parseFloat(W[9]||0)*v+parseFloat(W[11]||0)*I+parseFloat(W[13]||0);return W[1]!==void 0&&(V=-V),V})}return F}(d.default);const y=D},"./src/dash/parser/matchers/LangMatcher.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>C});var d=r("./src/dash/parser/matchers/BaseMatcher.js"),o=r("./src/dash/constants/DashConstants.js"),l=r("./node_modules/bcp-47-normalize/index.js"),c=r.n(l);function E(v){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?E=function(D){return typeof D}:E=function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},E(v)}function m(v,I,D){return I in v?Object.defineProperty(v,I,{value:D,enumerable:!0,configurable:!0,writable:!0}):v[I]=D,v}function f(v,I){if(!(v instanceof I))throw new TypeError("Cannot call a class as a function")}function T(v,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function");v.prototype=Object.create(I&&I.prototype,{constructor:{value:v,writable:!0,configurable:!0}}),I&&L(v,I)}function L(v,I){return L=Object.setPrototypeOf||function(y,A){return y.__proto__=A,y},L(v,I)}function P(v){var I=S();return function(){var y=p(v),A;if(I){var x=p(this).constructor;A=Reflect.construct(y,arguments,x)}else A=y.apply(this,arguments);return O(this,A)}}function O(v,I){return I&&(E(I)==="object"||typeof I=="function")?I:M(v)}function M(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}function S(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function p(v){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(D){return D.__proto__||Object.getPrototypeOf(D)},p(v)}var h=function(v){T(D,v);var I=P(D);function D(){return f(this,D),I.call(this,function(y,A){var x,F=(x={},m(x,o.default.ADAPTATION_SET,[o.default.LANG]),m(x,o.default.REPRESENTATION,[o.default.LANG]),m(x,o.default.CONTENT_COMPONENT,[o.default.LANG]),m(x,o.default.LABEL,[o.default.LANG]),m(x,o.default.GROUP_LABEL,[o.default.LANG]),x);if(F.hasOwnProperty(A)){var k=F[A];return k!==void 0?k.indexOf(y.name)>=0:!1}return!1},function(y){var A=c()(y);return A!==void 0?A:String(y)})}return D}(d.default);const C=h},"./src/dash/parser/matchers/NumericMatcher.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/dash/parser/matchers/BaseMatcher.js");function o(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(C){return typeof C}:o=function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},o(p)}function l(p,h){if(!(p instanceof h))throw new TypeError("Cannot call a class as a function")}function c(p,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(h&&h.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),h&&E(p,h)}function E(p,h){return E=Object.setPrototypeOf||function(v,I){return v.__proto__=I,v},E(p,h)}function m(p){var h=L();return function(){var v=P(p),I;if(h){var D=P(this).constructor;I=Reflect.construct(v,arguments,D)}else I=v.apply(this,arguments);return f(this,I)}}function f(p,h){return h&&(o(h)==="object"||typeof h=="function")?h:T(p)}function T(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(p){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},P(p)}var O=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,M=function(p){c(C,p);var h=m(C);function C(){return l(this,C),h.call(this,function(v){return O.test(v.value)},function(v){return parseFloat(v)})}return C}(d.default);const S=M},"./src/dash/parser/matchers/StringMatcher.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>p});var d=r("./src/dash/parser/matchers/BaseMatcher.js"),o=r("./src/dash/constants/DashConstants.js");function l(h){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(v){return typeof v}:l=function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},l(h)}function c(h,C,v){return C in h?Object.defineProperty(h,C,{value:v,enumerable:!0,configurable:!0,writable:!0}):h[C]=v,h}function E(h,C){if(!(h instanceof C))throw new TypeError("Cannot call a class as a function")}function m(h,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(C&&C.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),C&&f(h,C)}function f(h,C){return f=Object.setPrototypeOf||function(I,D){return I.__proto__=D,I},f(h,C)}function T(h){var C=O();return function(){var I=M(h),D;if(C){var y=M(this).constructor;D=Reflect.construct(I,arguments,y)}else D=I.apply(this,arguments);return L(this,D)}}function L(h,C){return C&&(l(C)==="object"||typeof C=="function")?C:P(h)}function P(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function M(h){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(v){return v.__proto__||Object.getPrototypeOf(v)},M(h)}var S=function(h){m(v,h);var C=T(v);function v(){return E(this,v),C.call(this,function(I,D){var y,A=(y={},c(y,o.default.MPD,[o.default.ID,o.default.PROFILES]),c(y,o.default.PERIOD,[o.default.ID]),c(y,o.default.BASE_URL,[o.default.SERVICE_LOCATION,o.default.BYTE_RANGE]),c(y,o.default.SEGMENT_BASE,[o.default.INDEX_RANGE]),c(y,o.default.INITIALIZATION,[o.default.RANGE]),c(y,o.default.REPRESENTATION_INDEX,[o.default.RANGE]),c(y,o.default.SEGMENT_LIST,[o.default.INDEX_RANGE]),c(y,o.default.BITSTREAM_SWITCHING,[o.default.RANGE]),c(y,o.default.SEGMENT_URL,[o.default.MEDIA_RANGE,o.default.INDEX_RANGE]),c(y,o.default.SEGMENT_TEMPLATE,[o.default.INDEX_RANGE,o.default.MEDIA,o.default.INDEX,o.default.INITIALIZATION_MINUS,o.default.BITSTREAM_SWITCHING_MINUS]),c(y,o.default.ASSET_IDENTIFIER,[o.default.VALUE,o.default.ID]),c(y,o.default.EVENT_STREAM,[o.default.VALUE]),c(y,o.default.ADAPTATION_SET,[o.default.PROFILES,o.default.MIME_TYPE,o.default.SEGMENT_PROFILES,o.default.CODECS,o.default.CONTENT_TYPE]),c(y,o.default.FRAME_PACKING,[o.default.VALUE,o.default.ID]),c(y,o.default.AUDIO_CHANNEL_CONFIGURATION,[o.default.VALUE,o.default.ID]),c(y,o.default.CONTENT_PROTECTION,[o.default.VALUE,o.default.ID]),c(y,o.default.ESSENTIAL_PROPERTY,[o.default.VALUE,o.default.ID]),c(y,o.default.SUPPLEMENTAL_PROPERTY,[o.default.VALUE,o.default.ID]),c(y,o.default.INBAND_EVENT_STREAM,[o.default.VALUE,o.default.ID]),c(y,o.default.ACCESSIBILITY,[o.default.VALUE,o.default.ID]),c(y,o.default.ROLE,[o.default.VALUE,o.default.ID]),c(y,o.default.RATING,[o.default.VALUE,o.default.ID]),c(y,o.default.VIEWPOINT,[o.default.VALUE,o.default.ID]),c(y,o.default.CONTENT_COMPONENT,[o.default.CONTENT_TYPE]),c(y,o.default.REPRESENTATION,[o.default.ID,o.default.DEPENDENCY_ID,o.default.MEDIA_STREAM_STRUCTURE_ID]),c(y,o.default.SUBSET,[o.default.ID]),c(y,o.default.METRICS,[o.default.METRICS_MINUS]),c(y,o.default.REPORTING,[o.default.VALUE,o.default.ID]),y);if(A.hasOwnProperty(D)){var x=A[D];return x!==void 0?x.indexOf(I.name)>=0:!1}return!1},function(I){return String(I)})}return v}(d.default);const p=S},"./src/dash/parser/objectiron.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/FactoryMaker.js");function o(m){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(T){return typeof T}:o=function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},o(m)}function l(m){function f(O,M){for(var S in O)M.hasOwnProperty(S)||(M[S]=O[S])}function T(O,M,S){for(var p=0,h=O.length;p<h;++p){var C=O[p];if(M[C.name])if(S[C.name]){if(C.merge){var v=M[C.name],I=S[C.name];o(v)==="object"&&o(I)==="object"?f(v,I):S[C.name]=v+I}}else S[C.name]=M[C.name]}}function L(O,M){for(var S=0,p=O.children.length;S<p;++S){var h=O.children[S],C=M[h.name+"_asArray"];if(C)for(var v=0,I=C.length;v<I;++v){var D=C[v];T(O.properties,M,D),L(h,D)}}}function P(O){if(O===null||o(O)!=="object")return O;if(O.Period_asArray&&"period"in m)for(var M=m.period,S=O.Period_asArray,p=0,h=S.length;p<h;++p){var C=S[p];if(L(M,C),"adaptationset"in m){var v=C.AdaptationSet_asArray;if(v)for(var I=m.adaptationset,D=0,y=v.length;D<y;++D)L(I,v[D])}}return O}return{run:P}}l.__dashjs_factory_name="ObjectIron";var c=d.default.getClassFactory(l);const E=c},"./src/dash/utils/ListSegmentsGetter.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/constants/Constants.js"),l=r("./src/dash/utils/SegmentsUtils.js");function c(f,T){f=f||{};var L=f.timelineConverter,P;function O(){if(!L||!L.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(o.default.MISSING_CONFIG_ERROR)}function M(h){var C={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!h)return C;var v=h.adaptation.period.mpd.manifest.Period_asArray[h.adaptation.period.index].AdaptationSet_asArray[h.adaptation.index].Representation_asArray[h.index].SegmentList,I=h&&!isNaN(h.startNumber)?h.startNumber:1,D=Math.max(I-1,0);return C.numberOfSegments=D+v.SegmentURL_asArray.length,C}function S(h,C){if(O(),!h)return null;var v=h.adaptation.period.mpd.manifest.Period_asArray[h.adaptation.period.index].AdaptationSet_asArray[h.adaptation.index].Representation_asArray[h.index].SegmentList,I=v.SegmentURL_asArray.length,D=h&&!isNaN(h.startNumber)?h.startNumber:1,y=Math.max(D-1,0),A=Math.max(C-y,0),x=null;if(A<I){var F=v.SegmentURL_asArray[A];x=(0,l.getIndexBasedSegment)(L,T,h,C),x&&(x.replacementTime=(D+C-1)*h.segmentDuration,x.media=F.media?F.media:"",x.mediaRange=F.mediaRange,x.indexRange=F.indexRange)}return x}function p(h,C){if(O(),!h)return null;var v=h.segmentDuration;if(isNaN(v))return null;var I=L.calcPeriodRelativeTimeFromMpdRelativeTime(h,C),D=Math.floor(I/v);return S(h,D)}return P={getSegmentByIndex:S,getSegmentByTime:p,getMediaFinishedInformation:M},P}c.__dashjs_factory_name="ListSegmentsGetter";var E=d.default.getClassFactory(c);const m=E},"./src/dash/utils/Round10.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});function d(m,f){if(!(m instanceof f))throw new TypeError("Cannot call a class as a function")}function o(m,f){for(var T=0;T<f.length;T++){var L=f[T];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(m,L.key,L)}}function l(m,f,T){return f&&o(m.prototype,f),T&&o(m,T),m}var c=function(){function m(){d(this,m)}return l(m,null,[{key:"round10",value:function(T,L){return E("round",T,L)}}]),m}();function E(m,f,T){return typeof T>"u"||+T==0?Math[m](f):(f=+f,T=+T,f===null||isNaN(f)||!(typeof T=="number"&&T%1===0)?NaN:(f=f.toString().split("e"),f=Math[m](+(f[0]+"e"+(f[1]?+f[1]-T:-T))),f=f.toString().split("e"),+(f[0]+"e"+(f[1]?+f[1]+T:T))))}},"./src/dash/utils/SegmentBaseGetter.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/constants/Constants.js");function l(m){m=m||{};var f=m.timelineConverter,T;function L(){if(!f||!f.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(o.default.MISSING_CONFIG_ERROR)}function P(p){var h={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};return!p||!p.segments||(h.numberOfSegments=p.segments.length),h}function O(p,h){if(L(),!p)return null;var C=p.segments?p.segments.length:-1,v;if(h<C&&(v=p.segments[h],v&&v.index===h))return v;for(var I=0;I<C;I++)if(v=p.segments[I],v&&v.index===h)return v;return null}function M(p,h){L();var C=S(p,h);return O(p,C)}function S(p,h){if(!p)return-1;var C=p.segments,v=C?C.length:null,I=-1,D,y,A,x,F;if(C&&v>0){for(F=0;F<v;F++)if(y=C[F],A=y.presentationStartTime,x=y.duration,D=x/2,h+D>=A&&h-D<A+x){I=y.index;break}}return I}return T={getSegmentByIndex:O,getSegmentByTime:M,getMediaFinishedInformation:P},T}l.__dashjs_factory_name="SegmentBaseGetter";var c=d.default.getClassFactory(l);const E=c},"./src/dash/utils/SegmentsUtils.js":(g,i,r)=>{r.r(i),r.d(i,{getIndexBasedSegment:()=>L,getTimeBasedSegment:()=>P,replaceIDForTemplate:()=>E,replaceTokenForTemplate:()=>m,unescapeDollarsInTemplate:()=>c});var d=r("./src/dash/vo/Segment.js");function o(O,M){for(;O.length<M;)O="0"+O;return O}function l(O,M){return O.representation.startNumber+M}function c(O){return O&&O.split("$$").join("$")}function E(O,M){if(!M||!O||O.indexOf("$RepresentationID$")===-1)return O;var S=M.toString();return O.split("$RepresentationID$").join(S)}function m(O,M,S){var p="%0",h,C,v,I,D,y,A=M.length,x=p.length;if(!O)return O;for(;;){if(h=O.indexOf("$"+M),h<0||(C=O.indexOf("$",h+A),C<0))return O;if(v=O.indexOf(p,h+A),v>h&&v<C)switch(I=O.charAt(C-1),D=parseInt(O.substring(v+x,C-1),10),I){case"d":case"i":case"u":y=o(S.toString(),D);break;case"x":y=o(S.toString(16),D);break;case"X":y=o(S.toString(16),D).toUpperCase();break;case"o":y=o(S.toString(8),D);break;default:return O}else y=S;O=O.substring(0,h)+y+O.substring(C+1)}}function f(O,M,S,p,h,C,v,I){var D=new d.default;return D.representation=O,D.duration=M,D.presentationStartTime=S,D.mediaStartTime=p,D.availabilityStartTime=h.calcAvailabilityStartTimeFromPresentationTime(C,O,v),D.availabilityEndTime=h.calcAvailabilityEndTimeFromPresentationTime(C+M,O,v),D.wallStartTime=h.calcWallTimeForSegment(D,v),D.replacementNumber=l(D,I),D.index=I,D}function T(O,M,S,p){var h=M.adaptation.period;if(isFinite(h.duration)&&h.start+h.duration<=S.presentationStartTime)return!1;if(p){if(M.availabilityTimeOffset==="INF")return!0;var C=O.getClientReferenceTime();return S.availabilityStartTime.getTime()<=C&&(!isFinite(S.availabilityEndTime)||S.availabilityEndTime.getTime()>=C)}return!0}function L(O,M,S,p){var h,C,v;h=S.segmentDuration,isNaN(h)&&(h=S.adaptation.period.duration),C=parseFloat((S.adaptation.period.start+p*h).toFixed(5)),v=parseFloat((C+h).toFixed(5));var I=O.calcMediaTimeFromPresentationTime(C,S),D=f(S,h,C,I,O,v,M,p);return T(O,S,D,M)?D:null}function P(O,M,S,p,h,C,v,I,D,y){var A=p/C,x=h/C,F,k,W;return F=O.calcPresentationTimeFromMediaTime(A,S),k=F+x,W=f(S,x,F,A,O,k,M,D),T(O,S,W,M)?(W.replacementTime=y||p,v=m(v,"Number",W.replacementNumber),v=m(v,"Time",W.replacementTime),W.media=v,W.mediaRange=I,W):null}},"./src/dash/utils/TemplateSegmentsGetter.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/constants/Constants.js"),l=r("./src/dash/utils/SegmentsUtils.js");function c(f,T){f=f||{};var L=f.timelineConverter,P;function O(){if(!L||!L.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(o.default.MISSING_CONFIG_ERROR)}function M(h){var C={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!h)return C;var v=h.segmentDuration;return isNaN(v)?C.numberOfSegments=1:C.numberOfSegments=Math.ceil(h.adaptation.period.duration/v),C}function S(h,C){if(O(),!h)return null;var v=h.adaptation.period.mpd.manifest.Period_asArray[h.adaptation.period.index].AdaptationSet_asArray[h.adaptation.index].Representation_asArray[h.index].SegmentTemplate;C=Math.max(C,0);var I=(0,l.getIndexBasedSegment)(L,T,h,C);if(I){I.replacementTime=Math.round((C-1)*h.segmentDuration*h.timescale,10);var D=v.media;D=(0,l.replaceTokenForTemplate)(D,"Number",I.replacementNumber),D=(0,l.replaceTokenForTemplate)(D,"Time",I.replacementTime),I.media=D}return I}function p(h,C){if(O(),!h)return null;var v=h.segmentDuration;if(isNaN(v))return null;var I=L.calcPeriodRelativeTimeFromMpdRelativeTime(h,C),D=Math.floor(I/v);return S(h,D)}return P={getSegmentByIndex:S,getSegmentByTime:p,getMediaFinishedInformation:M},P}c.__dashjs_factory_name="TemplateSegmentsGetter";var E=d.default.getClassFactory(c);const m=E},"./src/dash/utils/TimelineConverter.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>O});var d=r("./src/core/EventBus.js"),o=r("./src/core/events/Events.js"),l=r("./src/core/FactoryMaker.js"),c=r("./src/dash/constants/DashConstants.js"),E=r("./src/dash/models/DashManifestModel.js"),m=r("./src/core/Settings.js"),f=r("./src/streaming/constants/Constants.js"),T=r("./src/streaming/MediaPlayerEvents.js"),L=r("./src/streaming/constants/ConformanceViolationConstants.js");function P(){var M=this.context,S=(0,d.default)(M).getInstance(),p=(0,m.default)(M).getInstance(),h,C,v,I;function D(){C=(0,E.default)(M).getInstance(),he()}function y(){_e(),S.on(o.default.UPDATE_TIME_SYNC_OFFSET,ge,this)}function A(){return I}function x(se){I=se}function F(){return Date.now()-v*1e3+I*1e3}function k(se,Z,q,le){var te,N=Z.adaptation.period.mpd,R=N.availabilityStartTime;if(le)q&&N.timeShiftBufferDepth!==Number.POSITIVE_INFINITY?te=new Date(R.getTime()+(se+N.timeShiftBufferDepth)*1e3):te=N.availabilityEndTime;else if(q){var w=Z.availabilityTimeOffset;te=new Date(R.getTime()+(se-w)*1e3)}else te=R;return te}function W(se,Z,q){return k(se,Z,q)}function V(se,Z,q){return k(se,Z,q,!0)}function Q(se,Z){return(se.getTime()-Z.mpd.availabilityStartTime.getTime()+I*1e3)/1e3}function $(se,Z){var q=Z.adaptation.period.start,le=Z.presentationTimeOffset;return se+(q-le)}function K(se,Z){var q=Z.adaptation.period.start,le=Z.presentationTimeOffset;return se-q+le}function Y(se,Z){var q,le,te;return Z&&(q=se.representation.adaptation.period.mpd.suggestedPresentationDelay,le=se.presentationStartTime+q,te=new Date(se.availabilityStartTime.getTime()+le*1e3)),te}function re(se,Z){if(!Z)return ie(se);if(p.get().streaming.timeShiftBuffer.calcFromSegmentTimeline){var q=ne(se);return ae(q.now,q.range),q.range}return ee(se)}function ie(se){var Z={start:NaN,end:NaN},q=0,le=NaN;return se.forEach(function(te){var N=te.getStreamInfo();q+=N.duration,(isNaN(le)||N.start<le)&&(le=N.start)}),Z.start=le,Z.end=le+q,Z}function ee(se){var Z={start:NaN,end:NaN};if(!se||se.length===0)return Z;var q=se[0].getAdapter().getRegularPeriods()[0],le=Q(new Date,q),te=q.mpd.timeShiftBufferDepth,N=isNaN(te)?0:le-te;if(Z.start=ce(se,N),Z.end=!isNaN(Z.start)&&le<Z.start?le:ce(se,le,!0),!isNaN(te)&&Z.end<le-te&&(Z.end=NaN),p.get().streaming.timeShiftBuffer.fallbackToSegmentTimeline){var R=ne(se);if(R.range.end<Z.start)return S.trigger(T.default.CONFORMANCE_VIOLATION,{level:L.default.LEVELS.WARNING,event:L.default.EVENTS.INVALID_DVR_WINDOW}),ae(R.now,R.range),R.range}return Z}function ne(se){var Z={start:NaN,end:NaN},q=se[0].getAdapter().getRegularPeriods()[0],le=Q(new Date,q);if(!se||se.length===0)return{range:Z,now:le};se.forEach(function(N){var R=N.getAdapter(),w=R.getMediaInfoForType(N.getStreamInfo(),f.default.VIDEO)||R.getMediaInfoForType(N.getStreamInfo(),f.default.AUDIO),j=R.getVoRepresentations(w),H=j[0],U={start:NaN,end:NaN};if(H)if(H.segmentInfoType===c.default.SEGMENT_TIMELINE)U=X(H);else{var B=H.adaptation.period;U.start=B.start,U.end=Math.max(le,B.start+B.duration)}!isNaN(U.start)&&(isNaN(Z.start)||Z.start>U.start)&&(Z.start=U.start),!isNaN(U.end)&&(isNaN(Z.end)||Z.end<U.end)&&(Z.end=U.end)}),Z.end=Math.min(le,Z.end);var te=ce(se,Z.end,!0);return Z.end=isNaN(te)?Z.end:te,Z.start=q&&q.mpd&&q.mpd.timeShiftBufferDepth&&!isNaN(q.mpd.timeShiftBufferDepth)&&!isNaN(Z.end)?Math.max(Z.end-q.mpd.timeShiftBufferDepth,Z.start):Z.start,Z.start=ce(se,Z.start),{range:Z,now:le}}function ae(se,Z){v=se-Z.end}function ce(se,Z){var q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;try{for(var le=0,te=!1,N=NaN;!te&&le<se.length;){var R=se[le].getStreamInfo();R.start<=Z&&(!isFinite(R.duration)||R.start+R.duration>=Z)?(N=Z,te=!0):!q&&R.start>Z&&(isNaN(N)||R.start<N)?N=R.start:q&&R.start+R.duration<Z&&(isNaN(N)||R.start+R.duration>N)&&(N=R.start+R.duration),le+=1}return N}catch{return Z}}function X(se){var Z=se.adaptation.period.mpd.manifest.Period_asArray[se.adaptation.period.index].AdaptationSet_asArray[se.adaptation.index],q=C.getRepresentationFor(se.index,Z),le=q.SegmentTemplate.SegmentTimeline,te=q.SegmentTemplate.timescale,N=le.S_asArray,R={start:0,end:0},w=0,j,H,U,B;for(R.start=$(N[0].t/te,se),U=0,B=N.length;U<B;U++)j=N[U],H=0,j.hasOwnProperty("r")&&(H=j.r),w+=j.d*(1+H);return R.end=$((N[0].t+w)/te,se),R}function oe(se,Z){var q=se.adaptation.period.start;return Z-q}function ge(se){se.offset!==void 0&&!isNaN(se.offset)&&x(se.offset/1e3)}function _e(){I=0,v=0}function he(){S.off(o.default.UPDATE_TIME_SYNC_OFFSET,ge,this),_e()}return h={initialize:y,getClientTimeOffset:A,setClientTimeOffset:x,getClientReferenceTime:F,calcAvailabilityStartTimeFromPresentationTime:W,calcAvailabilityEndTimeFromPresentationTime:V,calcPresentationTimeFromWallTime:Q,calcPresentationTimeFromMediaTime:$,calcPeriodRelativeTimeFromMpdRelativeTime:oe,calcMediaTimeFromPresentationTime:K,calcWallTimeForSegment:Y,calcTimeShiftBufferWindow:re,reset:he},D(),h}P.__dashjs_factory_name="TimelineConverter";const O=l.default.getSingletonFactory(P)},"./src/dash/utils/TimelineSegmentsGetter.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/constants/Constants.js"),l=r("./src/dash/utils/SegmentsUtils.js");function c(f,T){f=f||{};var L=f.timelineConverter,P=f.dashMetrics,O;function M(){if(!L)throw new Error(o.default.MISSING_CONFIG_ERROR)}function S(D){if(!D)return 0;var y=D.adaptation.period.mpd.manifest.Period_asArray[D.adaptation.period.index].AdaptationSet_asArray[D.adaptation.index].Representation_asArray[D.index].SegmentTemplate||D.adaptation.period.mpd.manifest.Period_asArray[D.adaptation.period.index].AdaptationSet_asArray[D.adaptation.index].Representation_asArray[D.index].SegmentList,A=y.SegmentTimeline,x=0,F=0,k=0,W,V,Q,$,K,Y,re;for(re=D.timescale,W=A.S_asArray,$=W.length,Q=0;Q<$;Q++){if(V=W[Q],Y=0,V.hasOwnProperty("r")&&(Y=V.r),V.hasOwnProperty("t")&&(x=V.t,F=x/re),Y<0){var ie=W[Q+1];Y=h(D,ie,V,re,F)}for(K=0;K<=Y;K++)k++,x+=V.d,F=x/re}return{numberOfSegments:k,mediaTimeOfLastSignaledSegment:F}}function p(D,y){var A=D.adaptation.period.mpd.manifest.Period_asArray[D.adaptation.period.index].AdaptationSet_asArray[D.adaptation.index].Representation_asArray[D.index].SegmentTemplate||D.adaptation.period.mpd.manifest.Period_asArray[D.adaptation.period.index].AdaptationSet_asArray[D.adaptation.index].Representation_asArray[D.index].SegmentList,x=A.SegmentTimeline,F=A.SegmentURL_asArray,k=0,W=-1,V,Q,$,K,Y,re,ie;ie=D.timescale,V=x.S_asArray;var ee=!1;for($=0,K=V.length;$<K&&!ee;$++){if(Q=V[$],re=0,Q.hasOwnProperty("r")&&(re=Q.r),Q.hasOwnProperty("t")&&(k=Q.t),re<0){var ne=V[$+1];re=h(D,ne,Q,ie,k/ie)}for(Y=0;Y<=re&&!ee;Y++)W++,ee=y(k,A,F,Q,ie,W,$),ee&&(D.segmentDuration=Q.d/ie),k+=Q.d}}function h(D,y,A,x,F){var k;if(y&&y.hasOwnProperty("t"))k=y.t/x;else try{var W=0;if(!isNaN(D.adaptation.period.start)&&!isNaN(D.adaptation.period.duration)&&isFinite(D.adaptation.period.duration))W=D.adaptation.period.start+D.adaptation.period.duration;else{var V=P.getCurrentDVRInfo();W=isNaN(V.end)?0:V.end}k=L.calcMediaTimeFromPresentationTime(W,D),D.segmentDuration=A.d/x}catch{k=0}return Math.max(Math.ceil((k-F)/(A.d/x))-1,0)}function C(D,y,A){if(M(),!D)return null;var x=null,F=!1;return p(D,function(k,W,V,Q,$,K,Y){if(F||A<0){var re=W.media,ie=Q.mediaRange;return V&&(re=V[Y].media||"",ie=V[Y].mediaRange),x=(0,l.getTimeBasedSegment)(L,T,D,k,Q.d,$,re,ie,K,Q.tManifest),!0}else k>=A*$-Q.d*.5&&(F=!0);return!1}),x}function v(D,y){if(M(),!D)return null;y===void 0&&(y=null);var A=null,x=L.calcMediaTimeFromPresentationTime(y,D);return p(D,function(F,k,W,V,Q,$,K){var Y=I(x*Q);if(Y<F+V.d&&Y>=F){var re=k.media,ie=V.mediaRange;return W&&(re=W[K].media||"",ie=W[K].mediaRange),A=(0,l.getTimeBasedSegment)(L,T,D,F,V.d,Q,re,ie,$,V.tManifest),!0}return!1}),A}function I(D){return parseFloat(D.toPrecision(15))}return O={getSegmentByIndex:C,getSegmentByTime:v,getMediaFinishedInformation:S},O}c.__dashjs_factory_name="TimelineSegmentsGetter";var E=d.default.getClassFactory(c);const m=E},"./src/dash/vo/AdaptationSet.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.period=null,this.index=-1,this.type=null};const l=o},"./src/dash/vo/BaseURL.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});function d(m,f){if(!(m instanceof f))throw new TypeError("Cannot call a class as a function")}var o=1,l=1,c=function m(f,T,L,P){d(this,m),this.url=f||"",this.serviceLocation=T||f||"",this.dvb_priority=L||o,this.dvb_weight=P||l,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0};c.DEFAULT_DVB_PRIORITY=o,c.DEFAULT_DVB_WEIGHT=l;const E=c},"./src/dash/vo/ContentSteering.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.defaultServiceLocation=null,this.queryBeforeStart=!1,this.proxyServerUrl=null,this.serverUrl=null};const l=o},"./src/dash/vo/ContentSteeringRequest.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/streaming/vo/metrics/HTTPRequest.js");function o(E,m){if(!(E instanceof m))throw new TypeError("Cannot call a class as a function")}var l=function E(m){o(this,E),this.url=m||null,this.type=d.HTTPRequest.CONTENT_STEERING_TYPE,this.responseType="json"};const c=l},"./src/dash/vo/ContentSteeringResponse.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.version=null,this.ttl=300,this.reloadUri=null,this.serviceLocationPriority=[]};const l=o},"./src/dash/vo/Event.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN};const l=o},"./src/dash/vo/EventStream.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0};const l=o},"./src/dash/vo/ManifestInfo.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.dvrWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null};const l=o},"./src/dash/vo/MediaInfo.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.labels=null,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.KID=null,this.bitrateList=null,this.isFragmented=null,this.isEmbedded=null,this.selectionPriority=1,this.supplementalProperties={}};const l=o},"./src/dash/vo/Mpd.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.publishTime=null,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN};const l=o},"./src/dash/vo/PatchOperation.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});function d(m,f){if(!(m instanceof f))throw new TypeError("Cannot call a class as a function")}function o(m,f){for(var T=0;T<f.length;T++){var L=f[T];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(m,L.key,L)}}function l(m,f,T){return f&&o(m.prototype,f),T&&o(m,T),m}var c=function(){function m(f,T,L){d(this,m),this.action=f,this.xpath=T,this.value=L,this.position=null}return l(m,[{key:"getMpdTarget",value:function(T){var L=this.action==="remove"||this.action==="replace"||this.position==="before"||this.position==="after";return this.xpath.getMpdTarget(T,L)}}]),m}();const E=c},"./src/dash/vo/Period.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null,this.nextPeriodId=null};o.DEFAULT_ID="defaultId";const l=o},"./src/dash/vo/ProducerReferenceTime.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.id=null,this.inband=!1,this.type="encoder",this.applicationScheme=null,this.wallClockTime=null,this.presentationTime=NaN,this.UTCTiming=null};const l=o},"./src/dash/vo/Representation.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/dash/constants/DashConstants.js");function o(f,T){if(!(f instanceof T))throw new TypeError("Cannot call a class as a function")}function l(f,T){for(var L=0;L<T.length;L++){var P=T[L];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(f,P.key,P)}}function c(f,T,L){return T&&l(f.prototype,T),L&&l(f,L),f}var E=function(){function f(){o(this,f),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.mimeType=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.mediaFinishedInformation={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN},this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}return c(f,[{key:"hasInitialization",value:function(){return this.initialization!==null||this.range!==null}},{key:"hasSegments",value:function(){return this.segmentInfoType!==d.default.BASE_URL&&this.segmentInfoType!==d.default.SEGMENT_BASE&&!this.indexRange}}]),f}();const m=E},"./src/dash/vo/RepresentationInfo.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.id=null,this.quality=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null};const l=o},"./src/dash/vo/Segment.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.wallStartTime=NaN,this.representation=null};const l=o},"./src/dash/vo/SimpleXPath.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});function d(m,f){if(!(m instanceof f))throw new TypeError("Cannot call a class as a function")}function o(m,f){for(var T=0;T<f.length;T++){var L=f[T];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(m,L.key,L)}}function l(m,f,T){return f&&o(m.prototype,f),T&&o(m,T),m}var c=function(){function m(f){var T=this;d(this,m),this.valid=f[0]=="/",this.path=f.split("/").filter(function(L){return L.length!==0}).map(function(L){var P={name:L},O=L.indexOf("[");if(O!=-1){P.name=L.substring(0,O);var M=L.substring(O+1,L.length-1);T.valid=T.valid&&M.indexOf("[")==-1;var S=M.indexOf("=");S!=-1?(P.attribute={name:M.substring(1,S),value:M.substring(S+1)},["'",'"'].indexOf(P.attribute.value[0])!=-1&&(P.attribute.value=P.attribute.value.substring(1,P.attribute.value.length-1))):P.position=parseInt(M,10)-1}return P})}return l(m,[{key:"isValid",value:function(){return this.valid}},{key:"findsElement",value:function(){return!this.findsAttribute()}},{key:"findsAttribute",value:function(){return this.path[this.path.length-1].name.startsWith("@")}},{key:"getMpdTarget",value:function(T,L){for(var P=null,O=T,M=1,S="MPD";M<this.path.length&&O!==null;){P=O;var p=this.path[M];if(S=p.name,M!==this.path.length-1||!S.startsWith("@")){var h=P[S+"_asArray"]||[];h.length===0&&P[S]&&h.push(P[S]),p.position?O=h[p.position]||null:p.attribute?function(){var C=p.attribute;O=h.filter(function(v){return v[C.name]==C.value})[0]||null}():O=h[0]||null}M++}return O===null?null:S.startsWith("@")?{name:S.substring(1),leaf:O,target:O}:{name:S,leaf:O,target:L?P:O}}}]),m}();const E=c},"./src/dash/vo/StreamInfo.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0};const l=o},"./src/dash/vo/UTCTiming.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.schemeIdUri="",this.value=""};const l=o},"./src/streaming/FragmentLoader.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>f});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/streaming/net/URLLoader.js"),l=r("./src/streaming/vo/HeadRequest.js"),c=r("./src/streaming/vo/DashJSError.js"),E=r("./src/core/FactoryMaker.js");function m(T){T=T||{};var L=this.context,P=T.eventBus,O=T.events,M=T.urlUtils,S=T.errors,p=T.streamId,h,C;function v(){C=(0,o.default)(L).create({errHandler:T.errHandler,errors:S,dashMetrics:T.dashMetrics,mediaPlayerModel:T.mediaPlayerModel,requestModifier:T.requestModifier,urlUtils:M,constants:d.default,boxParser:T.boxParser,dashConstants:T.dashConstants,requestTimeout:T.settings.get().streaming.fragmentRequestTimeout})}function I(x){var F=function(V){P.trigger(O.CHECK_FOR_EXISTENCE_COMPLETED,{request:x,exists:V})};if(x){var k=new l.default(x.url);C.load({request:k,success:function(){F(!0)},error:function(){F(!1)}})}else F(!1)}function D(x){var F=function(W,V){P.trigger(O.LOADING_COMPLETED,{request:x,response:W||null,error:V||null,sender:h})};x?C.load({request:x,progress:function(W){P.trigger(O.LOADING_PROGRESS,{request:x,stream:W.stream,streamId:p}),W.data&&P.trigger(O.LOADING_DATA_PROGRESS,{request:x,response:W.data||null,error:null,sender:h})},success:function(W){F(W)},error:function(W,V,Q){F(void 0,new c.default(S.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,Q,V))},abort:function(W){W&&P.trigger(O.LOADING_ABANDONED,{mediaType:W.mediaType,request:W,sender:h})}}):F(void 0,new c.default(S.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,S.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))}function y(){C&&C.abort()}function A(){C&&(C.abort(),C=null)}return h={checkForExistence:I,load:D,abort:y,reset:A},v(),h}m.__dashjs_factory_name="FragmentLoader";const f=E.default.getClassFactory(m)},"./src/streaming/ManifestLoader.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>C});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/dash/constants/DashConstants.js"),l=r("./src/streaming/controllers/XlinkController.js"),c=r("./src/streaming/net/URLLoader.js"),E=r("./src/streaming/utils/URLUtils.js"),m=r("./src/streaming/vo/TextRequest.js"),f=r("./src/streaming/vo/DashJSError.js"),T=r("./src/streaming/vo/metrics/HTTPRequest.js"),L=r("./src/core/EventBus.js"),P=r("./src/core/events/Events.js"),O=r("./src/core/errors/Errors.js"),M=r("./src/core/FactoryMaker.js"),S=r("./src/dash/parser/DashParser.js");function p(v){v=v||{};var I=this.context,D=v.debug,y=v.settings,A=(0,L.default)(I).getInstance(),x=(0,E.default)(I).getInstance(),F,k,W,V,Q,$=v.mssHandler,K=v.errHandler;function Y(){k=D.getLogger(F),A.on(P.default.XLINK_READY,re,F),W=(0,c.default)(I).create({errHandler:v.errHandler,dashMetrics:v.dashMetrics,mediaPlayerModel:v.mediaPlayerModel,requestModifier:v.requestModifier,urlUtils:x,constants:d.default,dashConstants:o.default,errors:O.default,requestTimeout:v.settings.get().streaming.manifestRequestTimeout}),V=(0,l.default)(I).create({errHandler:K,dashMetrics:v.dashMetrics,mediaPlayerModel:v.mediaPlayerModel,requestModifier:v.requestModifier,settings:v.settings}),Q=null}function re(ae){A.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:ae.manifest})}function ie(ae){var ce=null;return ae.indexOf("SmoothStreamingMedia")>-1?($&&(ce=$.createMssParser(),$.registerEvents()),ce):ae.indexOf("MPD")>-1||ae.indexOf("Patch")>-1?(0,S.default)(I).create({debug:D}):ce}function ee(ae){var ce=new m.default(ae,T.HTTPRequest.MPD_TYPE);W.load({request:ce,success:function(oe,ge,_e){if(V){var he,se,Z;if(_e&&_e!==ae?(se=x.parseBaseUrl(_e),he=_e):(x.isRelative(ae)&&(ae=x.resolve(ae,window.location.href)),se=x.parseBaseUrl(ae)),ge=="No Content"){A.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:null});return}if(Q===null&&(Q=ie(oe)),Q===null){A.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new f.default(O.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,O.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(ae))});return}V.setMatchers(Q.getMatchers()),V.setIron(Q.getIron());try{Z=Q.parse(oe)}catch{A.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new f.default(O.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,O.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(ae))});return}if(Z){if(Z.url=he||ae,Z.originalUrl||(Z.originalUrl=Z.url),Z.hasOwnProperty(d.default.LOCATION)&&(se=x.parseBaseUrl(Z.Location_asArray[0]),k.debug("BaseURI set by Location to: "+se)),y&&y.get().streaming.enableManifestDurationMismatchFix&&Z.mediaPresentationDuration&&Z.Period_asArray.length>1){var q=Z.Period_asArray.reduce(function(le,te){return le+te.duration},0);!isNaN(q)&&Z.mediaPresentationDuration>q&&(k.warn("Media presentation duration greater than duration of all periods. Setting duration to total period duration"),Z.mediaPresentationDuration=q)}Z.baseUri=se,Z.loadedTime=new Date,V.resolveManifestOnLoad(Z),A.trigger(P.default.ORIGINAL_MANIFEST_LOADED,{originalManifest:oe})}else A.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new f.default(O.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,O.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(ae))})}},error:function(oe,ge,_e){A.trigger(P.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new f.default(O.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,O.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+"".concat(ae,", ").concat(_e))})}})}function ne(){A.off(P.default.XLINK_READY,re,F),$&&$.reset(),V&&(V.reset(),V=null),W&&(W.abort(),W=null)}return F={load:ee,reset:ne},Y(),F}p.__dashjs_factory_name="ManifestLoader";var h=M.default.getClassFactory(p);const C=h},"./src/streaming/ManifestUpdater.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>P});var d=r("./src/core/EventBus.js"),o=r("./src/core/events/Events.js"),l=r("./src/streaming/MediaPlayerEvents.js"),c=r("./src/core/FactoryMaker.js"),E=r("./src/core/Debug.js"),m=r("./src/core/errors/Errors.js"),f=r("./src/dash/constants/DashConstants.js"),T=r("./src/streaming/utils/URLUtils.js");function L(){var O=this.context,M=(0,d.default)(O).getInstance(),S=(0,T.default)(O).getInstance(),p,h,C,v,I,D,y,A,x,F,k,W;function V(){h=(0,E.default)(O).getInstance().getLogger(p)}function Q(se){se&&(se.manifestModel&&(x=se.manifestModel),se.adapter&&(F=se.adapter),se.manifestLoader&&(A=se.manifestLoader),se.errHandler&&(k=se.errHandler),se.settings&&(W=se.settings))}function $(){Y(),M.on(o.default.STREAMS_COMPOSED,_e,this),M.on(l.default.PLAYBACK_STARTED,oe,this),M.on(l.default.PLAYBACK_PAUSED,ge,this),M.on(o.default.INTERNAL_MANIFEST_LOADED,X,this)}function K(se){ae(se)}function Y(){C=NaN,y=!1,I=!0,D=!1,ie()}function re(){M.off(l.default.PLAYBACK_STARTED,oe,this),M.off(l.default.PLAYBACK_PAUSED,ge,this),M.off(o.default.STREAMS_COMPOSED,_e,this),M.off(o.default.INTERNAL_MANIFEST_LOADED,X,this),Y()}function ie(){v!==null&&(clearTimeout(v),v=null)}function ee(se){ie(),!D&&(isNaN(se)&&!isNaN(C)&&(se=C*1e3),isNaN(se)||(h.debug("Refresh manifest in "+se+" milliseconds."),v=setTimeout(ce,se)))}function ne(){var se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;y=!0;var Z=x.getValue(),q=Z.url,le=F.getPatchLocation(Z),te=F.getLocation(Z);le&&!se?q=le:te&&(q=te),S.isRelative(q)&&(q=S.resolve(q,Z.url)),A.load(q)}function ae(se){if(!se)se=x.getValue(),se.loadedTime=new Date;else if(F.getIsPatch(se)){var Z=se;se=x.getValue();var q=F.isPatchValid(se,Z),le=q;if(q){var te=F.getPublishTime(se);le=F.applyPatchToManifest(se,Z);var N=F.getPublishTime(se);le=te.getTime()!=N.getTime()}if(!le){h.debug("Patch provided is invalid, performing full manifest refresh"),ne(!0);return}se.loadedTime=new Date}if(x.getValue()&&x.getValue().type===f.default.DYNAMIC&&se.type===f.default.STATIC){M.trigger(o.default.DYNAMIC_TO_STATIC),y=!1,D=!0;return}x.setValue(se);var R=new Date,w=(R.getTime()-se.loadedTime.getTime())/1e3;C=F.getManifestUpdatePeriod(se,w),C*1e3>2147483647&&(C=2147483647e-3),M.trigger(o.default.MANIFEST_UPDATED,{manifest:se}),h.info("Manifest has been refreshed at "+R+"["+R.getTime()/1e3+"] "),I||ee()}function ce(){if(!I){if(y){ee(W.get().streaming.manifestUpdateRetryInterval);return}ne()}}function X(se){se.error?se.error.code===m.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&k.error(se.error):ae(se.manifest)}function oe(){I=!1,ee()}function ge(){I=!W.get().streaming.scheduling.scheduleWhilePaused,I&&ie()}function _e(){y=!1}function he(){return y}return p={initialize:$,setManifest:K,refreshManifest:ne,getIsUpdating:he,setConfig:Q,reset:re},V(),p}L.__dashjs_factory_name="ManifestUpdater";const P=c.default.getClassFactory(L)},"./src/streaming/MediaPlayer.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>U});var d=r("./externals/cea608-parser.js"),o=r.n(d),l=r("./src/streaming/constants/Constants.js"),c=r("./src/dash/constants/DashConstants.js"),E=r("./src/streaming/constants/MetricsConstants.js"),m=r("./src/streaming/controllers/PlaybackController.js"),f=r("./src/streaming/controllers/StreamController.js"),T=r("./src/streaming/controllers/GapController.js"),L=r("./src/streaming/controllers/CatchupController.js"),P=r("./src/dash/controllers/ServiceDescriptionController.js"),O=r("./src/dash/controllers/ContentSteeringController.js"),M=r("./src/streaming/controllers/MediaController.js"),S=r("./src/streaming/controllers/BaseURLController.js"),p=r("./src/streaming/ManifestLoader.js"),h=r("./src/streaming/utils/ErrorHandler.js"),C=r("./src/streaming/utils/Capabilities.js"),v=r("./src/streaming/utils/CapabilitiesFilter.js"),I=r("./src/streaming/utils/RequestModifier.js"),D=r("./src/streaming/models/URIFragmentModel.js"),y=r("./src/streaming/models/ManifestModel.js"),A=r("./src/streaming/models/MediaPlayerModel.js"),x=r("./src/streaming/controllers/AbrController.js"),F=r("./src/streaming/net/SchemeLoaderFactory.js"),k=r("./src/streaming/models/VideoModel.js"),W=r("./src/streaming/models/CmcdModel.js"),V=r("./src/streaming/models/CmsdModel.js"),Q=r("./src/streaming/utils/DOMStorage.js"),$=r("./src/core/Debug.js"),K=r("./src/core/errors/Errors.js"),Y=r("./src/core/EventBus.js"),re=r("./src/core/events/Events.js"),ie=r("./src/streaming/MediaPlayerEvents.js"),ee=r("./src/core/FactoryMaker.js"),ne=r("./src/core/Settings.js"),ae=r("./src/core/Version.js"),ce=r("./src/dash/controllers/SegmentBaseController.js"),X=r("./src/dash/DashAdapter.js"),oe=r("./src/dash/DashMetrics.js"),ge=r("./src/dash/utils/TimelineConverter.js"),_e=r("./src/streaming/vo/metrics/HTTPRequest.js"),he=r("./externals/base64.js"),se=r("./node_modules/codem-isoboxer/dist/iso_boxer.js"),Z=r("./src/streaming/vo/DashJSError.js"),q=r("./src/streaming/utils/SupervisorTools.js"),le=r("./src/streaming/ManifestUpdater.js"),te=r("./src/streaming/utils/URLUtils.js"),N=r("./src/streaming/utils/BoxParser.js"),R=r("./src/streaming/text/TextController.js"),w=r("./src/streaming/models/CustomParametersModel.js");function j(){var B="You must first call initialize() and set a source before calling this method",G="You must first call initialize() and set a valid source and view before calling this method",z="You must first call attachView() to set the video element before calling this method",fe="You must first call attachSource() with a valid source before calling this method",ue="MediaPlayer not initialized!",J=this.context,ve=(0,Y.default)(J).getInstance(),me=(0,ne.default)(J).getInstance(),Ae=(0,$.default)(J).getInstance({settings:me}),be,Be,ke,Ye,Oe,Se,Me,qe,it,at,Ce,We,Ge,tt,ot,ct,ht,Pt,$e,Te,de,Re,xe,Ne,Xe,nt,et,dt,Tt,Ct,De,Ue,Ze,mt,ft,pt,Mt,Kt;function jt(){Be=Ae.getLogger(be),Oe=!1,Me=!1,Se=!1,qe=!0,Ge=null,ct=null,Ye=null,ht=null,Kt=null,re.default.extend(ie.default),Pt=(0,A.default)(J).getInstance(),$e=(0,w.default)(J).getInstance(),ft=(0,k.default)(J).getInstance(),pt=(0,D.default)(J).getInstance()}function pe(Fe){Fe&&(Fe.capabilities&&(Re=Fe.capabilities),Fe.capabilitiesFilter&&(xe=Fe.capabilitiesFilter),Fe.streamController&&(Ne=Fe.streamController),Fe.textController&&(Xe=Fe.textController),Fe.gapController&&(nt=Fe.gapController),Fe.playbackController&&(et=Fe.playbackController),Fe.serviceDescriptionController&&(dt=Fe.serviceDescriptionController),Fe.contentSteeringController&&(Tt=Fe.contentSteeringController),Fe.catchupController&&(Ct=Fe.catchupController),Fe.mediaPlayerModel&&(Pt=Fe.mediaPlayerModel),Fe.customParametersModel&&($e=Fe.customParametersModel),Fe.abrController&&(it=Fe.abrController),Fe.schemeLoaderFactory&&(at=Fe.schemeLoaderFactory),Fe.mediaController&&(We=Fe.mediaController),Fe.settings&&(me=Fe.settings))}function Ve(Fe,_t,Lt){var $t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:NaN;if(Re||(Re=(0,C.default)(J).getInstance(),Re.setConfig({settings:me})),Te||(Te=(0,h.default)(J).getInstance()),!Re.supportsMediaSource()){Te.error(new Z.default(K.default.CAPABILITY_MEDIASOURCE_ERROR_CODE,K.default.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE));return}Oe||(Oe=!0,Ce=(0,ge.default)(J).getInstance(),it||(it=(0,x.default)(J).getInstance(),it.setConfig({settings:me})),at||(at=(0,F.default)(J).getInstance()),et||(et=(0,m.default)(J).getInstance()),We||(We=(0,M.default)(J).getInstance()),Ne||(Ne=(0,f.default)(J).getInstance()),nt||(nt=(0,T.default)(J).getInstance()),Ct||(Ct=(0,L.default)(J).getInstance()),dt||(dt=(0,P.default)(J).getInstance()),Tt||(Tt=(0,O.default)(J).getInstance()),xe||(xe=(0,v.default)(J).getInstance()),ht=(0,X.default)(J).getInstance(),Ue=(0,y.default)(J).getInstance(),Ze=(0,W.default)(J).getInstance(),mt=(0,V.default)(J).getInstance(),De=(0,oe.default)(J).getInstance({settings:me}),Mt=(0,Q.default)(J).getInstance({settings:me}),ht.setConfig({constants:l.default,cea608parser:o(),errHandler:Te,BASE64:he}),de||(de=(0,S.default)(J).create()),de.setConfig({adapter:ht}),dt.setConfig({adapter:ht}),Kt||(Kt=(0,ce.default)(J).getInstance({dashMetrics:De,mediaPlayerModel:Pt,errHandler:Te,baseURLController:de,events:re.default,eventBus:ve,debug:Ae,boxParser:(0,N.default)(J).getInstance(),requestModifier:(0,I.default)(J).getInstance(),errors:K.default})),We.setConfig({domStorage:Mt,settings:me,customParametersModel:$e}),Pt.setConfig({playbackController:et,serviceDescriptionController:dt}),Tt.setConfig({adapter:ht,errHandler:Te,dashMetrics:De,mediaPlayerModel:Pt,manifestModel:Ue,abrController:it,eventBus:ve,requestModifier:(0,I.default)(J).getInstance()}),Gr(),Mr(Lt!==void 0?Lt:!0),Ji()),Fe&&Hr(Fe),_t&&Vn(_t,$t),Be.info("[dash.js "+xt()+"] MediaPlayer has been initialized")}function ut(){Vn(null),Hr(null),Ye=null,Ge&&(Ge.reset(),Ge=null),tt&&(tt.reset(),tt=null),$e&&$e.reset(),me.reset(),ct&&(ct.reset(),ct=null)}function Ie(){ut(),ee.default.deleteSingletonInstances(J)}function we(){return!!ke&&!!ft.getElement()}function ze(Fe,_t,Lt,$t){ve.on(Fe,_t,Lt,$t)}function Et(Fe,_t,Lt){ve.off(Fe,_t,Lt)}function xt(){return(0,ae.getVersionString)()}function Dt(){return Ae}function Rt(){if(ft.getElement()||Se)return!1;if(ke)$n();else throw fe}function Qt(){if(!Me)throw G;(!qe||Je()&&Me)&&et.play(!0)}function Wt(){if(!Me)throw G;et.pause()}function Je(){if(!Me)throw G;return et.isPaused()}function At(Fe){if(!Me)throw G;if((0,q.checkParameterType)(Fe,"number"),isNaN(Fe))throw l.default.BAD_ARGUMENT_ERROR;Fe<0&&(Fe=0);var _t=et.getIsDynamic()?yr(Fe):Fe,Lt=sr();!et.getIsDynamic()&&Lt.duration&&(_t=Math.min(Lt.duration,_t)),et.seek(_t,!1,!1,!0)}function yt(){!Me||!Ke()||et.seekToOriginalLive()}function Pe(){if(!Me)throw G;return et.isSeeking()}function Ke(){if(!Me)throw G;return et.getIsDynamic()}function ye(){if(!Me)throw G;return et.getLowLatencyModeEnabled()}function He(Fe){sr().playbackRate=Fe}function lt(){return sr().playbackRate}function St(Fe){(0,q.checkParameterType)(Fe,"boolean"),sr().muted=Fe}function It(){return sr().muted}function kt(Fe){if(typeof Fe!="number"||isNaN(Fe)||Fe<0||Fe>1)throw l.default.BAD_ARGUMENT_ERROR;sr().volume=Fe}function Gt(){return sr().volume}function Bt(Fe){var _t=[l.default.VIDEO,l.default.AUDIO,l.default.TEXT];if(Fe)if(_t.indexOf(Fe)!==-1){var $t=Ft().getCurrentBufferLevel(Fe);return $t||NaN}else return Be.warn("getBufferLength requested for invalid type"),NaN;else{var Lt=_t.map(function(er){return Xi(er).length>0?Ft().getCurrentBufferLevel(er):Number.MAX_VALUE}).reduce(function(er,on){return Math.min(er,on)});return Lt===Number.MAX_VALUE?NaN:Lt}}function nr(){var Fe=Ne&&Ne.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO,_t=De.getCurrentDVRInfo(Fe);return _t?_t.manifestInfo.dvrWindowSize:0}function yr(Fe){var _t=Ne&&Ne.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO,Lt=De.getCurrentDVRInfo(_t);if(!Lt)return 0;var $t=et.getOriginalLiveDelay(),er=Lt.range.start+Fe;return er>Lt.range.end-$t&&(er=Lt.range.end-$t),er}function Pr(){if(!Me)throw G;return et.getOriginalLiveDelay()}function gr(Fe){if(!Me)throw G;var _t=sr().currentTime;if(Fe!==void 0)_t=Ne.getTimeRelativeToStreamId(_t,Fe);else if(et.getIsDynamic()){var Lt=Ne&&Ne.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO,$t=De.getCurrentDVRInfo(Lt);_t=$t===null||_t===0?0:Math.max(0,_t-$t.range.start)}return _t}function Kr(){if(!Me)throw G;var Fe=sr().duration;if(et.getIsDynamic()){var _t=Ne&&Ne.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO,Lt=De.getCurrentDVRInfo(_t);Fe=Lt?Lt.range.end-Lt.range.start:0}return Fe}function Qr(){if(!Me)throw G;return gr()<0?NaN:Zi(gr())}function an(){if(!Me)throw G;return Zi(Kr())}function Ar(Fe){if(!Se)throw B;return it.getTopBitrateInfoFor(Fe)}function Wr(Fe){if(!Se)throw B;if(Fe===l.default.IMAGE){var _t=An();if(!_t)return-1;var Lt=_t.getThumbnailController();return Lt?Lt.getCurrentTrackIndex():-1}return it.getQualityFor(Fe)}function jr(Fe,_t){var Lt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!Se)throw B;if(Fe===l.default.IMAGE){var $t=An();if(!$t)return;var er=$t.getThumbnailController();er&&er.setTrackByIndex(_t)}it.setPlaybackQuality(Fe,Ne.getActiveStreamInfo(),_t,{forceReplace:Lt})}function vn(){it.setElementSize(),it.setWindowResizeEventCalled(!0)}function Mr(Fe){(0,q.checkParameterType)(Fe,"boolean"),qe=Fe}function Wn(){return qe}function jn(){if(!Oe)throw ue;return Me?et.getCurrentLiveLatency():NaN}function sn(Fe,_t,Lt){$e.addAbrCustomRule(Fe,_t,Lt)}function pn(Fe){$e.removeAbrCustomRule(Fe)}function Gn(){$e.removeAllAbrCustomRule()}function Hn(){return $e.getAbrCustomRules()}function Tn(Fe,_t){$e.addUTCTimingSource(Fe,_t)}function Jr(Fe,_t){$e.removeUTCTimingSource(Fe,_t)}function yn(){$e.clearDefaultUTCTimingSources()}function Gr(){$e.restoreDefaultUTCTimingSources()}function Le(Fe){var _t=it.getThroughputHistory(),Lt=et.getIsDynamic();return _t?_t.getAverageThroughput(Fe,Lt):0}function rt(Fe,_t){$e.setXHRWithCredentialsForType(Fe,_t)}function vt(Fe){return $e.getXHRWithCredentialsForType(Fe)}function Ot(){return Ji()}function Ft(){return De}function Ht(Fe){var _t=Ne.getActiveStreamInfo();return!_t||!Xe?!1:Xe.enableText(_t.id,Fe)}function Vt(Fe){var _t=Ne.getActiveStreamInfo();return!_t||!Xe?!1:Xe.enableForcedTextStreaming(Fe)}function hr(){var Fe=Ne.getActiveStreamInfo();return!Fe||!Xe?!1:Xe.isTextEnabled(Fe)}function tr(Fe){if(!Me)throw G;var _t=Ne.getActiveStreamInfo();!_t||!Xe||Xe.setTextTrack(_t.id,Fe)}function Sr(){var Fe=NaN,_t=Ne.getActiveStreamInfo();if(!(!_t||!Xe))return Fe=Xe.getCurrentTrackIdx(_t.id),Fe}function sr(){if(!ft.getElement())throw z;return ft.getElement()}function Hr(Fe){if(!Oe)throw ue;ft.setElement(Fe),Fe&&(zn(),Po(),Mo(),Ne&&Ne.switchToVideoElement()),Me&&Qi(),$n()}function Ys(){return ft?ft.getTTMLRenderingDiv():null}function zs(Fe){if(!ft.getElement())throw z;ft.setTTMLRenderingDiv(Fe)}function $s(Fe){if(!ft.getElement())throw z;ft.setVttRenderingDiv(Fe)}function Xs(Fe){if(!Se)throw B;var _t=An();return _t?_t.getBitrateListFor(Fe):[]}function Qs(Fe){if(!Se)throw B;return ht.getStreamsInfo(Fe)}function Xi(Fe){if(!Se)throw B;var _t=Ne.getActiveStreamInfo();return _t?We.getTracksFor(Fe,_t.id):[]}function Js(Fe,_t,Lt){if(!Se)throw B;return Lt=Lt||ht.getStreamsInfo(_t,1)[0],Lt?ht.getAllMediaInfoForType(Lt,Fe,_t):[]}function Zs(Fe){if(!Se)throw B;var _t=Ne.getActiveStreamInfo();return We.getCurrentTrackFor(Fe,_t.id)}function qs(Fe,_t){if(!Oe)throw ue;We.setInitialSettings(Fe,_t)}function eo(Fe){if(!Oe)throw ue;return We.getInitialSettings(Fe)}function to(Fe){if(!Se)throw B;We.setTrack(Fe)}function ro(Fe){$e.registerCustomCapabilitiesFilter(Fe)}function no(Fe){$e.unregisterCustomCapabilitiesFilter(Fe)}function io(Fe){$e.setCustomInitialTrackSelectionFunction(Fe)}function ao(){$e.resetCustomInitialTrackSelectionFunction(null)}function so(Fe){$e.registerLicenseRequestFilter(Fe)}function oo(Fe){$e.registerLicenseResponseFilter(Fe)}function lo(Fe){$e.unregisterLicenseRequestFilter(Fe)}function uo(Fe){$e.unregisterLicenseResponseFilter(Fe)}function fo(){return zn()}function co(Fe){Ge=Fe}function ho(Fe){Ye=Fe,Ne&&Ne.setProtectionData(Ye)}function go(Fe,_t){if(typeof _t=="function"){if(Fe<0){_t(null);return}var Lt=et.getIsDynamic()?yr(Fe):Fe,$t=Ne.getStreamForTime(Lt);if($t===null){_t(null);return}var er=$t.getThumbnailController();if(!er){_t(null);return}return er.provide(Lt,_t)}}function mo(Fe,_t){var Lt=Yn(),$t=this,er=function on(Zr){Zr.error?_t(null,Zr.error):_t(Zr.manifest),ve.off(re.default.INTERNAL_MANIFEST_LOADED,on,$t),Lt.reset()};ve.on(re.default.INTERNAL_MANIFEST_LOADED,er,$t),pt.initialize(Fe),Lt.load(Fe)}function Eo(){if(!ke)throw fe;return ke}function _o(Fe){ke=Fe,Ne.load(ke)}function Vn(Fe){var _t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:NaN;if(!Oe)throw ue;typeof Fe=="string"&&pt.initialize(Fe),_t==null&&(_t=NaN),isNaN(_t)||(_t=Math.max(0,_t)),ke=Fe,(Se||Me)&&Qi(),we()&&$n(_t)}function vo(){return me.get()}function po(Fe){me.update(Fe)}function To(){me.reset()}function yo(Fe,_t,Lt){var $t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,er=new Date(Fe*1e3),on=er.toLocaleDateString(_t),Zr=er.toLocaleTimeString(_t,{hour12:Lt});return $t?Zr+" "+on:Zr}function Ao(Fe){Fe=Math.max(Fe,0);var _t=Math.floor(Fe/3600),Lt=Math.floor(Fe%3600/60),$t=Math.floor(Fe%3600%60);return(_t===0?"":_t<10?"0"+_t.toString()+":":_t.toString()+":")+(Lt<10?"0"+Lt.toString():Lt.toString())+":"+($t<10?"0"+$t.toString():$t.toString())}function So(Fe,_t,Lt){ee.default.extend(Fe,_t,Lt,J)}function An(){if(!Se)throw B;var Fe=Ne.getActiveStreamInfo();return Fe?Ne.getStreamById(Fe.id):null}function Ro(){return ht}function Do(){if(Tt)return Tt.loadSteeringData()}function Io(){if(Tt)return Tt.getCurrentSteeringResponseData()}function Qi(){Me=!1,Se=!1,ht.reset(),Ne.reset(),nt.reset(),Ct.reset(),et.reset(),dt.reset(),Tt.reset(),it.reset(),We.reset(),Kt.reset(),Ge&&(me.get().streaming.protection.keepProtectionMediaKeys?Ge.stop():(Ge.reset(),Ge=null,zn())),Xe.reset(),Ze.reset(),mt.reset()}function Co(){var Fe=Yn();Ne||(Ne=(0,f.default)(J).getInstance()),Xe||(Xe=(0,R.default)(J).create({errHandler:Te,manifestModel:Ue,adapter:ht,mediaController:We,videoModel:ft,settings:me})),xe.setConfig({capabilities:Re,customParametersModel:$e,adapter:ht,settings:me,manifestModel:Ue,errHandler:Te}),Ne.setConfig({capabilities:Re,capabilitiesFilter:xe,manifestLoader:Fe,manifestModel:Ue,mediaPlayerModel:Pt,customParametersModel:$e,protectionController:Ge,textController:Xe,adapter:ht,dashMetrics:De,errHandler:Te,timelineConverter:Ce,videoModel:ft,playbackController:et,serviceDescriptionController:dt,contentSteeringController:Tt,abrController:it,mediaController:We,settings:me,baseURLController:de,uriFragmentModel:pt,segmentBaseController:Kt}),nt.setConfig({settings:me,playbackController:et,streamController:Ne,videoModel:ft,timelineConverter:Ce,adapter:ht}),et.setConfig({streamController:Ne,serviceDescriptionController:dt,dashMetrics:De,adapter:ht,videoModel:ft,timelineConverter:Ce,settings:me}),Ct.setConfig({streamController:Ne,playbackController:et,mediaPlayerModel:Pt,videoModel:ft,settings:me}),it.setConfig({streamController:Ne,domStorage:Mt,mediaPlayerModel:Pt,customParametersModel:$e,cmsdModel:mt,dashMetrics:De,adapter:ht,videoModel:ft,settings:me}),Ze.setConfig({abrController:it,dashMetrics:De,playbackController:et}),mt.setConfig({}),it.initialize(),Ne.initialize(qe,Ye),Xe.initialize(),nt.initialize(),Ct.initialize(),Ze.initialize(),mt.initialize(),Tt.initialize(),Kt.initialize()}function Yn(){return(0,p.default)(J).create({debug:Ae,errHandler:Te,dashMetrics:De,mediaPlayerModel:Pt,requestModifier:(0,I.default)(J).getInstance(),mssHandler:ot,settings:me})}function zn(){if(Ge)return Ge;var Fe=dashjs.Protection;if(typeof Fe=="function"){var _t=Fe(J).create();return re.default.extend(Fe.events),ie.default.extend(Fe.events,{publicOnly:!0}),K.default.extend(Fe.errors),Re||(Re=(0,C.default)(J).getInstance()),Ge=_t.createProtectionSystem({debug:Ae,errHandler:Te,videoModel:ft,customParametersModel:$e,capabilities:Re,eventBus:ve,events:re.default,BASE64:he,constants:l.default,cmcdModel:Ze,settings:me}),Ge}return null}function Po(){if(!tt){var Fe=dashjs.MetricsReporting;if(typeof Fe=="function"){var _t=Fe(J).create();tt=_t.createMetricsReporting({debug:Ae,eventBus:ve,mediaElement:sr(),adapter:ht,dashMetrics:De,mediaPlayerModel:Pt,events:re.default,constants:l.default,metricsConstants:E.default})}}}function Mo(){if(!ot){var Fe=dashjs.MssHandler;typeof Fe=="function"&&(K.default.extend(Fe.errors),ot=Fe(J).create({eventBus:ve,mediaPlayerModel:Pt,dashMetrics:De,manifestModel:Ue,playbackController:et,streamController:Ne,protectionController:Ge,baseURLController:de,errHandler:Te,events:re.default,constants:l.default,debug:Ae,initSegmentType:_e.HTTPRequest.INIT_SEGMENT_TYPE,BASE64:he,ISOBoxer:se,settings:me}))}}function Ji(){if(!Oe)throw ue;if(ct)return ct;var Fe=dashjs.OfflineController;if(typeof Fe=="function"){re.default.extend(Fe.events),ie.default.extend(Fe.events,{publicOnly:!0}),K.default.extend(Fe.errors);var _t=Yn(),Lt=(0,le.default)(J).create();return Lt.setConfig({manifestModel:Ue,adapter:ht,manifestLoader:_t,errHandler:Te}),ct=Fe(J).create({debug:Ae,manifestUpdater:Lt,baseURLController:de,manifestLoader:_t,manifestModel:Ue,mediaPlayerModel:Pt,abrController:it,playbackController:et,adapter:ht,errHandler:Te,dashMetrics:De,timelineConverter:Ce,segmentBaseController:Kt,schemeLoaderFactory:at,eventBus:ve,events:re.default,errors:K.default,constants:l.default,settings:me,dashConstants:c.default,urlUtils:(0,te.default)(J).getInstance()}),ct}return null}function Zi(Fe){var _t=Ne&&Ne.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO,Lt=De.getCurrentDVRInfo(_t),$t,er;return Lt?($t=Lt.manifestInfo.availableFrom.getTime()/1e3,er=Fe+($t+Lt.range.start),er):0}function $n(){var Fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:NaN;ct&&ct.resetRecords(),!Se&&ke&&(Se=!0,Be.info("Streaming Initialized"),Co(),typeof ke=="string"?Ne.load(ke,Fe):Ne.loadWithManifest(ke,Fe)),!Me&&we()&&(Me=!0,Be.info("Playback Initialized"))}return be={initialize:Ve,setConfig:pe,on:ze,off:Et,extend:So,attachView:Hr,attachSource:Vn,isReady:we,preload:Rt,play:Qt,isPaused:Je,pause:Wt,isSeeking:Pe,isDynamic:Ke,getLowLatencyModeEnabled:ye,seek:At,seekToOriginalLive:yt,setPlaybackRate:He,getPlaybackRate:lt,setMute:St,isMuted:It,setVolume:kt,getVolume:Gt,time:gr,duration:Kr,timeAsUTC:Qr,durationAsUTC:an,getActiveStream:An,getDVRWindowSize:nr,getDVRSeekOffset:yr,getTargetLiveDelay:Pr,convertToTimeCode:Ao,formatUTC:yo,getVersion:xt,getDebug:Dt,getBufferLength:Bt,getTTMLRenderingDiv:Ys,getVideoElement:sr,getSource:Eo,updateSource:_o,getCurrentLiveLatency:jn,getTopBitrateInfoFor:Ar,setAutoPlay:Mr,getAutoPlay:Wn,getDashMetrics:Ft,getQualityFor:Wr,setQualityFor:jr,updatePortalSize:vn,enableText:Ht,enableForcedTextStreaming:Vt,isTextEnabled:hr,setTextTrack:tr,getBitrateInfoListFor:Xs,getStreamsFromManifest:Qs,getTracksFor:Xi,getTracksForTypeFromManifest:Js,getCurrentTrackFor:Zs,setInitialMediaSettingsFor:qs,getInitialMediaSettingsFor:eo,setCurrentTrack:to,addABRCustomRule:sn,removeABRCustomRule:pn,removeAllABRCustomRule:Gn,getABRCustomRules:Hn,getAverageThroughput:Le,retrieveManifest:mo,addUTCTimingSource:Tn,removeUTCTimingSource:Jr,clearDefaultUTCTimingSources:yn,restoreDefaultUTCTimingSources:Gr,setXHRWithCredentialsForType:rt,getXHRWithCredentialsForType:vt,getProtectionController:fo,attachProtectionController:co,setProtectionData:ho,registerLicenseRequestFilter:so,registerLicenseResponseFilter:oo,unregisterLicenseRequestFilter:lo,unregisterLicenseResponseFilter:uo,registerCustomCapabilitiesFilter:ro,unregisterCustomCapabilitiesFilter:no,setCustomInitialTrackSelectionFunction:io,resetCustomInitialTrackSelectionFunction:ao,attachTTMLRenderingDiv:zs,attachVttRenderingDiv:$s,getCurrentTextTrackIndex:Sr,provideThumbnail:go,getDashAdapter:Ro,getOfflineController:Ot,triggerSteeringRequest:Do,getCurrentSteeringResponseData:Io,getSettings:vo,updateSettings:po,resetSettings:To,reset:ut,destroy:Ie},jt(),be}j.__dashjs_factory_name="MediaPlayer";var H=ee.default.getClassFactory(j);H.events=ie.default,H.errors=K.default,ee.default.updateClassFactory(j.__dashjs_factory_name,H);const U=H},"./src/streaming/MediaPlayerEvents.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/core/events/EventsBase.js");function o(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(C){return typeof C}:o=function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},o(p)}function l(p,h){if(!(p instanceof h))throw new TypeError("Cannot call a class as a function")}function c(p,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(h&&h.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),h&&E(p,h)}function E(p,h){return E=Object.setPrototypeOf||function(v,I){return v.__proto__=I,v},E(p,h)}function m(p){var h=L();return function(){var v=P(p),I;if(h){var D=P(this).constructor;I=Reflect.construct(v,arguments,D)}else I=v.apply(this,arguments);return f(this,I)}}function f(p,h){return h&&(o(h)==="object"||typeof h=="function")?h:T(p)}function T(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(p){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},P(p)}var O=function(p){c(C,p);var h=m(C);function C(){var v;return l(this,C),v=h.call(this),v.AST_IN_FUTURE="astInFuture",v.BUFFER_EMPTY="bufferStalled",v.BUFFER_LOADED="bufferLoaded",v.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",v.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",v.DYNAMIC_TO_STATIC="dynamicToStatic",v.ERROR="error",v.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",v.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",v.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",v.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",v.LOG="log",v.MANIFEST_LOADED="manifestLoaded",v.METRICS_CHANGED="metricsChanged",v.METRIC_CHANGED="metricChanged",v.METRIC_ADDED="metricAdded",v.METRIC_UPDATED="metricUpdated",v.PERIOD_SWITCH_STARTED="periodSwitchStarted",v.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",v.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",v.QUALITY_CHANGE_RENDERED="qualityChangeRendered",v.TRACK_CHANGE_RENDERED="trackChangeRendered",v.STREAM_INITIALIZING="streamInitializing",v.STREAM_UPDATED="streamUpdated",v.STREAM_ACTIVATED="streamActivated",v.STREAM_DEACTIVATED="streamDeactivated",v.STREAM_INITIALIZED="streamInitialized",v.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",v.TEXT_TRACKS_ADDED="allTextTracksAdded",v.TEXT_TRACK_ADDED="textTrackAdded",v.TTML_PARSED="ttmlParsed",v.TTML_TO_PARSE="ttmlToParse",v.CAPTION_RENDERED="captionRendered",v.CAPTION_CONTAINER_RESIZE="captionContainerResize",v.CAN_PLAY="canPlay",v.CAN_PLAY_THROUGH="canPlayThrough",v.PLAYBACK_ENDED="playbackEnded",v.PLAYBACK_ERROR="playbackError",v.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",v.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",v.PLAYBACK_LOADED_DATA="playbackLoadedData",v.PLAYBACK_PAUSED="playbackPaused",v.PLAYBACK_PLAYING="playbackPlaying",v.PLAYBACK_PROGRESS="playbackProgress",v.PLAYBACK_RATE_CHANGED="playbackRateChanged",v.PLAYBACK_SEEKED="playbackSeeked",v.PLAYBACK_SEEKING="playbackSeeking",v.PLAYBACK_STALLED="playbackStalled",v.PLAYBACK_STARTED="playbackStarted",v.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",v.PLAYBACK_VOLUME_CHANGED="playbackVolumeChanged",v.PLAYBACK_WAITING="playbackWaiting",v.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",v.EVENT_MODE_ON_START="eventModeOnStart",v.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",v.CONFORMANCE_VIOLATION="conformanceViolation",v.REPRESENTATION_SWITCH="representationSwitch",v.ADAPTATION_SET_REMOVED_NO_CAPABILITIES="adaptationSetRemovedNoCapabilities",v.CONTENT_STEERING_REQUEST_COMPLETED="contentSteeringRequestCompleted",v}return C}(d.default),M=new O;const S=M},"./src/streaming/MediaPlayerFactory.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>T});var d=r("./src/streaming/MediaPlayer.js");function o(){var L="application/dash+xml",P;function O(p,h,C){if(!p||!/^VIDEO$/i.test(p.nodeName))return null;if(p._dashjs_player)return p._dashjs_player;var v,I=p.id||p.name||"video element";if(h=h||[].slice.call(p.querySelectorAll("source")).filter(function(D){return D.type==L})[0],!h&&p.src)h=document.createElement("source"),h.src=p.src;else if(!h&&!p.src)return null;return C=C||{},v=(0,d.default)(C).create(),v.initialize(p,h.src,p.autoplay),P||(P=v.getDebug().getLogger()),P.debug("Converted "+I+" to dash.js player and added content: "+h.src),p._dashjs_player=v,v}function M(p,h){var C=[];p=p||"[data-dashjs-player]",h=h||document;for(var v=h.querySelectorAll(p),I=0;I<v.length;I++){var D=O(v[I],null);C.push(D)}for(var y=h.querySelectorAll('source[type="'+L+'"]'),A=0;A<y.length;A++){var x=S(y[A]),F=O(x,null);C.push(F)}return C}function S(p){return/^VIDEO$/i.test(p.nodeName)?p:S(p.parentNode)}return{create:O,createAll:M}}var l=o(),c;function E(){window.removeEventListener("load",E),l.createAll()}function m(){window.dashjs&&(window.clearInterval(c),l.createAll())}var f=typeof window<"u"&&window&&window.dashjs&&window.dashjs.skipAutoCreate;!f&&typeof window<"u"&&window&&window.addEventListener&&(window.document.readyState==="complete"?window.dashjs?l.createAll():c=window.setInterval(m,500):window.addEventListener("load",E));const T=l},"./src/streaming/PreBufferSink.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/Debug.js"),o=r("./src/core/FactoryMaker.js");function l(m){var f=this.context,T,L,P,O=[],M=m;function S(){L=(0,d.default)(f).getInstance().getLogger(T)}function p(){O=[],P=null,M=null}function h(k){return k.segmentType!=="InitializationSegment"?(O.push(k),O.sort(function(W,V){return W.start-V.start}),P=null):P=k,L.debug("PreBufferSink appended chunk s: "+k.start+"; e: "+k.end),M&&M({chunk:k}),Promise.resolve()}function C(k,W){return O=O.filter(function(V){return!((isNaN(W)||V.start<W)&&(isNaN(k)||V.end>k))}),Promise.resolve()}function v(){return Promise.resolve()}function I(){for(var k=[],W=0;W<O.length;W++){var V=O[W];k.length===0||V.start>k[k.length-1].end?k.push({start:V.start,end:V.end}):k[k.length-1].end=V.end}var Q={start:function(K){return k[K].start},end:function(K){return k[K].end}};return Object.defineProperty(Q,"length",{get:function(){return k.length}}),Q}function D(){return Promise.resolve()}function y(){return this}function A(k,W){var V=x(k,W);return P&&(V.push(P),P=null),C(k,W),V}function x(k,W){return O.filter(function(V){return(isNaN(W)||V.start<W)&&(isNaN(k)||V.end>k)})}function F(k){k()}return T={getAllBufferRanges:I,append:h,remove:C,abort:v,discharge:A,reset:p,updateTimestampOffset:D,waitForUpdateEnd:F,getBuffer:y},S(),T}l.__dashjs_factory_name="PreBufferSink";var c=o.default.getClassFactory(l);const E=c},"./src/streaming/SourceBufferSink.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>p});var d=r("./src/core/Debug.js"),o=r("./src/streaming/vo/DashJSError.js"),l=r("./src/core/FactoryMaker.js"),c=r("./src/core/errors/Errors.js"),E=r("./src/core/Settings.js"),m=r("./src/streaming/constants/Constants.js"),f=r("./src/streaming/vo/metrics/HTTPRequest.js"),T=r("./src/core/events/Events.js"),L=.1,P=.01,O=50;function M(h){var C=this.context,v=(0,E.default)(C).getInstance(),I=h.textController,D=h.eventBus,y,A,x,F,k,W,V=[],Q=[],$=!1,K=h.mediaSource,Y=null;function re(){x=(0,d.default)(C).getInstance().getLogger(y)}function ie(z,fe,ue){k=z,A=k.type;var J=k.codec;ne(ue),X();var ve=[];return ve.push(te()),ve.push(_e(k.streamInfo)),ve.push(ee(J)),fe&&fe.MSETimeOffset!==void 0&&ve.push(he(fe.MSETimeOffset)),Promise.all(ve)}function ee(z){return new Promise(function(fe){G(function(){F.changeType&&F.changeType(z),fe()})})}function ne(z){F=z.getBuffer()}function ae(z,fe,ue){k=fe,A=k.type;var J=k.codec;try{if(J.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))return ce(z);F=K.addSourceBuffer(J),X();var ve=[];return ve.push(_e(k.streamInfo)),ue&&ue.MSETimeOffset!==void 0&&ve.push(he(ue.MSETimeOffset)),Promise.all(ve)}catch(me){return k.type==m.default.TEXT&&!k.isFragmented||J.indexOf('codecs="stpp')!==-1||J.indexOf('codecs="vtt')!==-1?ce(z):Promise.reject(me)}}function ce(z){return F=I.getTextSourceBuffer(z),Promise.resolve()}function X(){if(typeof F.addEventListener=="function")try{F.addEventListener("updateend",H,!1),F.addEventListener("error",U,!1),F.addEventListener("abort",U,!1)}catch{W=setInterval(H,O)}else W=setInterval(H,O)}function oe(){return A}function ge(){try{typeof F.removeEventListener=="function"&&(F.removeEventListener("updateend",H,!1),F.removeEventListener("error",U,!1),F.removeEventListener("abort",U,!1)),clearInterval(W)}catch(z){x.error(z)}}function _e(z){return new Promise(function(fe){if(!F||!v.get().streaming.buffer.useAppendWindow){fe();return}G(function(){try{if(!F){fe();return}var ue=K.duration,J=0;z&&!isNaN(z.start)&&!isNaN(z.duration)&&isFinite(z.duration)&&(ue=z.start+z.duration),z&&!isNaN(z.start)&&(J=z.start),(F.appendWindowEnd!==ue||F.appendWindowStart!==J)&&(F.appendWindowStart=0,F.appendWindowEnd=ue+P,F.appendWindowStart=Math.max(J-L,0),x.debug("Updated append window for ".concat(k.type,". Set start to ").concat(F.appendWindowStart," and end to ").concat(F.appendWindowEnd))),fe()}catch{x.warn("Failed to set append window"),fe()}})})}function he(z){return new Promise(function(fe){if(!F){fe();return}G(function(){try{F.timestampOffset!==z&&!isNaN(z)&&(F.timestampOffset=z,x.debug("Set MSE timestamp offset to ".concat(z))),fe()}catch{fe()}})})}function se(){if(F){try{V=[],ge(),$=!1,Q=[],(!F.getClassName||F.getClassName()!=="TextSourceBuffer")&&(x.debug("Removing sourcebuffer from media source"),K.removeSourceBuffer(F))}catch{}F=null}Y=null}function Z(){return F}function q(){try{return F.buffered}catch(z){return x.error("getAllBufferRanges exception: "+z.message),null}}function le(z){var fe=this,ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return new Promise(function(J,ve){if(!z){ve({chunk:z,error:new o.default(c.default.APPEND_ERROR_CODE,c.default.APPEND_ERROR_MESSAGE)});return}Q.push({data:z,promise:{resolve:J,reject:ve},request:ue}),G(R.bind(fe))})}function te(){return new Promise(function(z){G(function(){var fe=F.appendWindowStart,ue=F.appendWindowEnd;F&&(F.abort(),F.appendWindowStart=fe,F.appendWindowEnd=ue),z()})})}function N(z){return new Promise(function(fe,ue){var J=z.start,ve=z.end;if(!(J>=0&&ve>J)){fe();return}G(function(){try{F.remove(J,ve),G(function(){fe({from:J,to:ve,unintended:!1}),z.resolve&&z.resolve()})}catch(me){ue({from:J,to:ve,unintended:!1,error:new o.default(c.default.REMOVE_ERROR_CODE,c.default.REMOVE_ERROR_MESSAGE)}),z.reject&&z.reject(me)}})})}function R(){if(!$&&Q.length>0){$=!0;var z=Q[0];Q.splice(0,1);var fe=function(){$=!1,Q.length>0&&R.call(this),z&&z.data&&z.data.segmentType&&z.data.segmentType!==f.HTTPRequest.INIT_SEGMENT_TYPE&&delete z.data.bytes,z.promise.resolve({chunk:z.data})};try{Y=z.request,z.data.bytes.byteLength===0?fe.call(this):(F.appendBuffer?F.appendBuffer(z.data.bytes):F.append(z.data.bytes,z.data),G(fe.bind(this)))}catch(ue){x.fatal('SourceBuffer append failed "'+ue+'"'),Q.length>0?R():$=!1,delete z.data.bytes,z.promise.reject({chunk:z.data,error:new o.default(ue.code,ue.message)})}}}function w(){return new Promise(function(z){try{Q=[],K.readyState==="open"?G(function(){try{F&&F.abort(),z()}catch{z()}}):(F&&F.setTextTrack&&K.readyState==="ended"&&F.abort(),z())}catch{z()}})}function j(){if(V.length>0&&!F.updating){var z=V.shift();z(),j()}}function H(){F.updating||j()}function U(z){var fe=z.target||{};B(T.default.SOURCE_BUFFER_ERROR,{error:fe,lastRequestAppended:Y})}function B(z,fe){var ue=fe||{};D.trigger(z,ue,{streamId:k.streamInfo.id,mediaType:A})}function G(z){V.push(z),F.updating||j()}return y={getType:oe,getAllBufferRanges:q,getBuffer:Z,append:le,remove:N,abort:w,reset:se,updateTimestampOffset:he,initializeForStreamSwitch:ie,initializeForFirstUse:ae,updateAppendWindow:_e,changeType:ee},re(),y}M.__dashjs_factory_name="SourceBufferSink";var S=l.default.getClassFactory(M);const p=S},"./src/streaming/Stream.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>v});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/dash/constants/DashConstants.js"),l=r("./src/streaming/StreamProcessor.js"),c=r("./src/streaming/controllers/FragmentController.js"),E=r("./src/streaming/thumbnail/ThumbnailController.js"),m=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js"),T=r("./src/core/Debug.js"),L=r("./src/core/errors/Errors.js"),P=r("./src/core/FactoryMaker.js"),O=r("./src/streaming/vo/DashJSError.js"),M=r("./src/streaming/utils/BoxParser.js"),S=r("./src/streaming/utils/URLUtils.js"),p=r("./src/streaming/controllers/BlacklistController.js"),h=[d.default.VIDEO,d.default.AUDIO,d.default.TEXT,d.default.MUXED,d.default.IMAGE];function C(I){I=I||{};var D=this.context,y=(0,m.default)(D).getInstance(),A=(0,S.default)(D).getInstance(),x=I.manifestModel,F=I.mediaPlayerModel,k=I.dashMetrics,W=I.manifestUpdater,V=I.adapter,Q=I.timelineConverter,$=I.capabilities,K=I.errHandler,Y=I.abrController,re=I.playbackController,ie=I.eventController,ee=I.mediaController,ne=I.protectionController,ae=I.textController,ce=I.videoModel,X=I.streamInfo,oe=I.settings,ge,_e,he,se,Z,q,le,te,N,R,w,j,H,U,B,G,z,fe;function ue(){try{G=(0,T.default)(D).getInstance(),_e=G.getLogger(ge),ct(),B=(0,M.default)(D).getInstance(),H=(0,p.default)(D).create({updateEventName:f.default.SEGMENT_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:f.default.SEGMENT_LOCATION_BLACKLIST_ADD}),w=(0,c.default)(D).create({streamInfo:X,mediaPlayerModel:F,dashMetrics:k,errHandler:K,settings:oe,boxParser:B,dashConstants:o.default,urlUtils:A})}catch(Je){throw Je}}function J(){ve(),Ae(),ae.initializeForStream(X),y.trigger(f.default.STREAM_UPDATED,{streamInfo:X})}function ve(){y.on(f.default.BUFFERING_COMPLETED,ft,ge),y.on(f.default.DATA_UPDATE_COMPLETED,pt,ge),y.on(f.default.INBAND_EVENTS,Mt,ge)}function me(){y.off(f.default.DATA_UPDATE_COMPLETED,pt,ge),y.off(f.default.BUFFERING_COMPLETED,ft,ge),y.off(f.default.INBAND_EVENTS,Mt,ge)}function Ae(){ne&&(y.on(f.default.KEY_ERROR,Tt,ge),y.on(f.default.SERVER_CERTIFICATE_UPDATED,Tt,ge),y.on(f.default.LICENSE_REQUEST_COMPLETE,Tt,ge),y.on(f.default.KEY_SYSTEM_SELECTED,Tt,ge),y.on(f.default.KEY_SESSION_CREATED,Tt,ge),y.on(f.default.KEY_STATUSES_CHANGED,Tt,ge))}function be(){ne&&(y.off(f.default.KEY_ERROR,Tt,ge),y.off(f.default.SERVER_CERTIFICATE_UPDATED,Tt,ge),y.off(f.default.LICENSE_REQUEST_COMPLETE,Tt,ge),y.off(f.default.KEY_SYSTEM_SELECTED,Tt,ge),y.off(f.default.KEY_SESSION_CREATED,Tt,ge),y.off(f.default.KEY_STATUSES_CHANGED,Tt,ge))}function Be(){return X?X.id:null}function ke(Je,At){return new Promise(function(yt,Pe){if(Z){yt(At);return}if(Rt()){Z=!0,y.trigger(f.default.STREAM_ACTIVATED,{streamInfo:X}),yt(At);return}Oe(Je,At).then(function(Ke){Z=!0,y.trigger(f.default.STREAM_ACTIVATED,{streamInfo:X}),yt(Ke)}).catch(function(Ke){Pe(Ke)})})}function Ye(Je,At){return new Promise(function(yt,Pe){if(Rt()){Pe();return}_e.info("[startPreloading] Preloading next stream with id ".concat(Re())),Dt(!0),Se(Je,At).then(function(){for(var Ke=0;Ke<he.length&&he[Ke];Ke++)he[Ke].setExplicitBufferingTime(de()),he[Ke].getScheduleController().startScheduleTimer();yt()}).catch(function(){Dt(!1),Pe()})})}function Oe(Je,At){return Se(Je,At)}function Se(Je,At){return new Promise(function(yt,Pe){et(),R=!0,Ue();var Ke=ce.getElement();h.forEach(function(ye){!(ye===d.default.TEXT&&!Je)&&(ye!==d.default.VIDEO||!Ke||Ke&&/^VIDEO$/i.test(Ke.nodeName))&&qe(ye,Je)}),Ce(At).then(function(ye){if(R=!1,he.length===0){var He="No streams to play.";K.error(new O.default(L.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,He,x.getValue())),_e.fatal(He)}else Ze();Je&&ae.createTracks(X),yt(ye)}).catch(function(ye){Pe(ye)})})}function Me(Je){return new Promise(function(At,yt){qe(d.default.TEXT,Je),We().then(function(){ae.createTracks(X),At()}).catch(function(Pe){yt(Pe)})})}function qe(Je,At){var yt=V.getAllMediaInfoForType(X,Je),Pe=[],Ke=null,ye;if(!yt||yt.length===0){_e.info("No "+Je+" data.");return}Je===d.default.VIDEO&&(le=!0),Je===d.default.AUDIO&&(te=!0);for(var He=0,lt=yt.length;He<lt;He++)Ke=yt[He],Je===d.default.TEXT&&Ke.isEmbedded&&(ae.addEmbeddedTrack(X,Ke),Pe.push(Ke)),it(Ke)&&ee.addTrack(Ke);if(Pe.length>0&&(ee.setInitialMediaSettingsForType(Je,X),ae.addMediaInfosToBuffer(X,Je,Pe)),yt=yt.filter(function(It){return!It.isEmbedded}),yt.length!==0){if(Je===d.default.IMAGE){j=(0,E.default)(D).create({streamInfo:X,adapter:V,baseURLController:I.baseURLController,timelineConverter:I.timelineConverter,debug:G,eventBus:y,events:f.default,dashConstants:o.default,dashMetrics:I.dashMetrics,segmentBaseController:I.segmentBaseController}),j.initialize();return}y.trigger(f.default.STREAM_INITIALIZING,{streamInfo:X,mediaInfo:Ke}),ee.setInitialMediaSettingsForType(Je,X);var St=at(yt,At);ye=ee.getCurrentTrackFor(Je,X.id),ye&&(Y.updateTopQualityIndex(ye),St.selectMediaInfo(Je!==d.default.TEXT||!ye.isEmbedded?ye:yt[0]))}}function it(Je){var At=Je?Je.type:null,yt;return At===d.default.MUXED?(yt="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",_e.fatal(yt),K.error(new O.default(L.default.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,yt,x.getValue())),!1):At===d.default.TEXT||At===d.default.IMAGE?!0:Je.contentProtection&&!$.supportsEncryptedMedia()?(K.error(new O.default(L.default.CAPABILITY_MEDIAKEYS_ERROR_CODE,L.default.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE)),!1):!0}function at(Je,At){var yt=Je&&Je.length>0?Je[0]:null,Pe=w.getModel(yt?yt.type:null),Ke=yt?yt.type:null,ye=yt?yt.mimeType:null,He=yt?yt.isFragmented:null,lt=(0,l.default)(D).create({streamInfo:X,type:Ke,mimeType:ye,timelineConverter:Q,adapter:V,manifestModel:x,mediaPlayerModel:F,fragmentModel:Pe,dashMetrics:I.dashMetrics,baseURLController:I.baseURLController,segmentBaseController:I.segmentBaseController,abrController:Y,playbackController:re,mediaController:ee,textController:ae,errHandler:K,settings:oe,boxParser:B,segmentBlacklistController:H});lt.initialize(At,le,He),he.push(lt);for(var St=0;St<Je.length;St++)lt.addMediaInfo(Je[St]);return Ke===d.default.TEXT&&ae.addMediaInfosToBuffer(X,Ke,Je,Pe),lt}function Ce(Je){return new Promise(function(At){var yt={},Pe=he.map(function(Ke){return Ke.createBufferSinks(Je)});Promise.all(Pe).then(function(Ke){Ke.forEach(function(ye){ye&&(yt[ye.getType()]=ye)}),At(yt)}).catch(function(){At(yt)})})}function We(){var Je=jt(d.default.TEXT);return Je?Je.createBufferSinks():Promise.resolve()}function Ge(Je){for(var At=he?he.length:0,yt=!1,Pe=0;Pe<At;Pe++){var Ke=he[Pe].getFragmentModel();Ke.abortRequests(),Ke.resetInitialSettings(),he[Pe].reset(yt,Je)}ae&&ae.deactivateStream(X),he=[],Z=!1,q=!1,Dt(!1),Te(!1),y.trigger(f.default.STREAM_DEACTIVATED,{streamInfo:X})}function tt(){return Z}function ot(Je){return new Promise(function(At,yt){for(var Pe=[],Ke=0;Ke<he.length;)it(he[Ke].getMediaInfo())?(Pe.push(he[Ke].setMediaSource(Je)),Ke++):(he[Ke].reset(),he.splice(Ke,1));Promise.all(Pe).then(function(){for(var ye=0;ye<he.length;ye++)he[ye].dischargePreBuffer();if(he.length===0){var He="No streams to play.";K.error(new O.default(L.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,He+"nostreams",x.getValue())),_e.fatal(He)}At()}).catch(function(ye){_e.error(ye),yt(ye)})})}function ct(Je){Ge(Je),se=!1,le=!1,te=!1,N={},R=!1,z=!1,fe=[]}function ht(Je){w&&(w.reset(),w=null),Y&&X&&Y.clearDataForStream(X.id),H&&(H.reset(),H=null),ct(Je),X=null,me(),be()}function Pt(){return X?X.duration:NaN}function $e(){return z}function Te(Je){z=Je}function de(){return X?X.start:NaN}function Re(){return X?X.id:null}function xe(){return X}function Ne(){return te}function Xe(){return le}function nt(){return j}function et(){if(!ce||!Y)throw new Error(d.default.MISSING_CONFIG_ERROR)}function dt(Je){if(et(),Je===d.default.IMAGE)return j?j.getBitrateList():[];var At=mt(Je);return Y.getBitrateList(At)}function Tt(Je){Je.error&&(K.error(Je.error),_e.fatal(Je.error.message))}function Ct(Je){if(!(!Z||!X)){q=!1;var At=Je.newMediaInfo,yt=x.getValue();V.setCurrentMediaInfo(X.id,At.type,At);var Pe=Kt(At);if(Pe){var Ke=re.getTime();_e.info("Stream -  Process track changed at current time "+Ke),yt.refreshManifestOnSwitchTrack?(fe.push(Je),W.getIsUpdating()||(_e.debug("Stream -  Refreshing manifest for switch track"),W.refreshManifest())):Pe.selectMediaInfo(At).then(function(){(At.type===d.default.VIDEO||At.type===d.default.AUDIO)&&Y.updateTopQualityIndex(At),Pe.prepareTrackSwitch()})}}}function De(Je){var At=jt(Je.mediaType);At&&At.prepareQualityChange(Je)}function Ue(){if(ie){var Je=V.getEventsFor(X);Je&&Je.length>0&&ie.addInlineEvents(Je,X.id)}}function Ze(){for(var Je=he.length,At=!!N.audio||!!N.video,yt=At?new O.default(L.default.DATA_UPDATE_FAILED_ERROR_CODE,L.default.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,Pe=0;Pe<Je;Pe++)if(he[Pe].isUpdating()||R)return;if(ne){ne.clearMediaInfoArray();for(var Ke=0;Ke<Je&&he[Ke];Ke++){var ye=he[Ke].getType(),He=he[Ke].getMediaInfo();if(ye===d.default.AUDIO||ye===d.default.VIDEO||ye===d.default.TEXT&&He.isFragmented){var lt=he[Ke].getMediaInfo();lt&&ne.initializeForMedia(lt)}}ne.handleKeySystemFromManifest()}yt?K.error(yt):se||(se=!0,ce.waitForReadyState(d.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,function(){y.trigger(f.default.STREAM_INITIALIZED,{streamInfo:X})}))}function mt(Je){for(var At=null,yt=0;yt<he.length;yt++)if(At=he[yt],At.getType()===Je)return At.getMediaInfo();return null}function ft(){var Je=pe(),At=Je.length;if(At===0){_e.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined");return}for(var yt=0;yt<At;yt++)if(!Je[yt].isBufferingCompleted()&&(Je[yt].getType()===d.default.AUDIO||Je[yt].getType()===d.default.VIDEO)){_e.debug("onBufferingCompleted - One streamProcessor has finished but",Je[yt].getType(),"one is not buffering completed");return}_e.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),q=!0,y.trigger(f.default.STREAM_BUFFERING_COMPLETED,{streamInfo:X},{streamInfo:X})}function pt(Je){N[Je.mediaType]=Je.error,Ze()}function Mt(Je){ie&&ie.addInbandEvents(Je.events,X.id)}function Kt(Je){return!Je||!Je.type?null:jt(Je.type)}function jt(Je){if(!Je)return null;var At=pe();return At.filter(function(yt){return yt.getType()===Je})[0]}function pe(){for(var Je=[],At,yt,Pe=0;Pe<he.length;Pe++)yt=he[Pe],At=yt.getType(),(At===d.default.AUDIO||At===d.default.VIDEO||At===d.default.TEXT)&&Je.push(yt);return Je}function Ve(){for(var Je=he.length,At=0;At<Je&&he[At];At++)he[At].getScheduleController().startScheduleTimer()}function ut(Je){return new Promise(function(At){R=!0,X=Je,ie&&Ue();for(var yt=[],Pe=0,Ke=he.length;Pe<Ke;Pe++){var ye=he[Pe],He=ye.getMediaInfo();yt.push(ye.updateStreamInfo(X));var lt=V.getAllMediaInfoForType(X,ye.getType());if(lt=lt.filter(function(kt){return!kt.isEmbedded}),lt){ye.clearMediaInfoArray();for(var St=0;St<lt.length;St++){var It=lt[St];ye.addMediaInfo(lt[St]),V.areMediaInfosEqual(He,It)&&(Y.updateTopQualityIndex(It),yt.push(ye.selectMediaInfo(It)))}}}Promise.all(yt).then(function(){for(yt=[];fe.length>0;){var kt=fe.pop(),Gt=kt.newMediaInfo,Bt=Kt(kt.oldMediaInfo);if(!Bt)return;yt.push(Bt.prepareTrackSwitch()),Bt.selectMediaInfo(Gt)}return Promise.all(yt)}).then(function(){R=!1,Ze(),y.trigger(f.default.STREAM_UPDATED,{streamInfo:X}),At()})})}function Ie(Je){var At=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return xt(Je,d.default.VIDEO,At)&&xt(Je,d.default.AUDIO,At)}function we(Je){return Je?ze(d.default.VIDEO,Je)&&ze(d.default.AUDIO,Je):!0}function ze(Je,At){var yt=xe(),Pe=At.getStreamInfo();if(!Pe||!yt)return!0;var Ke=V.getAdaptationForType(Pe.index,Je,Pe),ye=V.getAdaptationForType(yt.index,Je,yt);return!Ke||!ye?!Ke&&!ye:!(!Et(ye)&&Et(Ke))}function Et(Je){return Je?!!(Je.ContentProtection||Je.Representation&&Je.Representation.length>0&&Je.Representation[0].ContentProtection):!1}function xt(Je,At){var yt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!Je||!Je.hasOwnProperty("getStreamInfo"))return!1;var Pe=Je.getStreamInfo(),Ke=yt?yt.getStreamInfo():xe();if(!Pe||!Ke)return!1;var ye=V.getAdaptationForType(Pe.index,At,Pe),He=V.getAdaptationForType(Ke.index,At,Ke);if(!ye||!He)return!ye&&!He;var lt=ye&&He&&ye.mimeType===He.mimeType,St=He.Representation_asArray.map(function(Bt){return Bt.codecs}),It=ye.Representation_asArray.map(function(Bt){return Bt.codecs}),kt=It.some(function(Bt){return St.indexOf(Bt)>-1}),Gt=It.some(function(Bt){return St.some(function(nr){return $.codecRootCompatibleWithCodec(nr,Bt)})});return kt||Gt&&lt}function Dt(Je){U=Je}function Rt(){return U}function Qt(){return q}function Wt(){return V}return ge={initialize:J,getStreamId:Be,activate:ke,deactivate:Ge,getIsActive:tt,getDuration:Pt,getStartTime:de,getId:Re,getStreamInfo:xe,getHasAudioTrack:Ne,getHasVideoTrack:Xe,startPreloading:Ye,initializeForTextWithMediaSource:Me,getThumbnailController:nt,getBitrateListFor:dt,updateData:ut,reset:ht,getProcessors:pe,setMediaSource:ot,isMediaCodecCompatible:Ie,isProtectionCompatible:we,getPreloaded:Rt,getIsEndedEventSignaled:$e,setIsEndedEventSignaled:Te,getAdapter:Wt,getHasFinishedBuffering:Qt,setPreloaded:Dt,startScheduleControllers:Ve,prepareTrackChange:Ct,prepareQualityChange:De},ue(),ge}C.__dashjs_factory_name="Stream";const v=P.default.getClassFactory(C)},"./src/streaming/StreamProcessor.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>k});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/dash/constants/DashConstants.js"),l=r("./src/streaming/constants/MetricsConstants.js"),c=r("./src/streaming/models/FragmentModel.js"),E=r("./src/streaming/controllers/BufferController.js"),m=r("./src/streaming/text/NotFragmentedTextBufferController.js"),f=r("./src/streaming/controllers/ScheduleController.js"),T=r("./src/dash/controllers/RepresentationController.js"),L=r("./src/core/FactoryMaker.js"),P=r("./src/streaming/utils/SupervisorTools.js"),O=r("./src/core/EventBus.js"),M=r("./src/core/events/Events.js"),S=r("./src/dash/DashHandler.js"),p=r("./src/core/errors/Errors.js"),h=r("./src/streaming/vo/DashJSError.js"),C=r("./src/core/Debug.js"),v=r("./src/streaming/utils/RequestModifier.js"),I=r("./src/streaming/utils/URLUtils.js"),D=r("./src/streaming/utils/BoxParser.js"),y=r("./src/streaming/vo/metrics/PlayList.js"),A=r("./src/dash/controllers/SegmentsController.js"),x=r("./src/streaming/vo/metrics/HTTPRequest.js");function F(W){W=W||{};var V=this.context,Q=(0,O.default)(V).getInstance(),$=W.streamInfo,K=W.type,Y=W.errHandler,re=W.mimeType,ie=W.timelineConverter,ee=W.adapter,ne=W.manifestModel,ae=W.mediaPlayerModel,ce=W.fragmentModel,X=W.abrController,oe=W.playbackController,ge=W.mediaController,_e=W.textController,he=W.dashMetrics,se=W.settings,Z=W.boxParser,q=W.segmentBlacklistController,le,te,N,R,w,j,H,U,B,G,z,fe,ue;function J(){te=(0,C.default)(V).getInstance().getLogger(le),Be(),Q.on(M.default.DATA_UPDATE_COMPLETED,tt,le,{priority:O.default.EVENT_PRIORITY_HIGH}),Q.on(M.default.INIT_FRAGMENT_NEEDED,Me,le),Q.on(M.default.MEDIA_FRAGMENT_NEEDED,qe,le),Q.on(M.default.INIT_FRAGMENT_LOADED,Et,le),Q.on(M.default.MEDIA_FRAGMENT_LOADED,xt,le),Q.on(M.default.BUFFER_LEVEL_STATE_CHANGED,ot,le),Q.on(M.default.BUFFER_CLEARED,ct,le),Q.on(M.default.SEEK_TARGET,yt,le),Q.on(M.default.FRAGMENT_LOADING_ABANDONED,Re,le),Q.on(M.default.FRAGMENT_LOADING_COMPLETED,xe,le),Q.on(M.default.QUOTA_EXCEEDED,et,le),Q.on(M.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Xe,le),Q.on(M.default.SET_NON_FRAGMENTED_TEXT,nt,le),Q.on(M.default.SOURCE_BUFFER_ERROR,ht,le)}function ve(ye,He,lt){fe=(0,A.default)(V).create({events:M.default,eventBus:Q,streamInfo:$,timelineConverter:ie,dashConstants:o.default,segmentBaseController:W.segmentBaseController,type:K}),z=(0,S.default)(V).create({streamInfo:$,type:K,timelineConverter:ie,dashMetrics:he,mediaPlayerModel:ae,baseURLController:W.baseURLController,errHandler:Y,segmentsController:fe,settings:se,boxParser:Z,events:M.default,eventBus:Q,errors:p.default,debug:(0,C.default)(V).getInstance(),requestModifier:(0,v.default)(V).getInstance(),dashConstants:o.default,constants:d.default,urlUtils:(0,I.default)(V).getInstance()}),N=$.manifestInfo.isDynamic,z.initialize(N),X.registerStreamType(K,le),U=(0,T.default)(V).create({streamInfo:$,type:K,abrController:X,dashMetrics:he,playbackController:oe,timelineConverter:ie,dashConstants:o.default,events:M.default,eventBus:Q,errors:p.default,isDynamic:N,segmentsController:fe}),j=At(K,lt),j&&j.initialize(ye),H=(0,f.default)(V).create({streamInfo:$,type:K,mimeType:re,adapter:ee,dashMetrics:he,mediaPlayerModel:ae,fragmentModel:ce,abrController:X,playbackController:oe,textController:_e,mediaController:ge,bufferController:j,settings:se}),H.initialize(He),ue=0,B=!1}function me(){return $.id}function Ae(){return K}function be(){return ee.getIsTextTrack(U.getData())}function Be(){w=[],R=null,ue=0,B=!1,G=!1}function ke(ye,He){z&&z.reset(),j&&(j.reset(ye,He),j=null),H&&(H.reset(),H=null),U&&(U.reset(),U=null),fe&&(fe=null),X&&X.unRegisterStreamType(me(),K),Q.off(M.default.DATA_UPDATE_COMPLETED,tt,le),Q.off(M.default.INIT_FRAGMENT_NEEDED,Me,le),Q.off(M.default.MEDIA_FRAGMENT_NEEDED,qe,le),Q.off(M.default.INIT_FRAGMENT_LOADED,Et,le),Q.off(M.default.MEDIA_FRAGMENT_LOADED,xt,le),Q.off(M.default.BUFFER_LEVEL_STATE_CHANGED,ot,le),Q.off(M.default.BUFFER_CLEARED,ct,le),Q.off(M.default.SEEK_TARGET,yt,le),Q.off(M.default.FRAGMENT_LOADING_ABANDONED,Re,le),Q.off(M.default.FRAGMENT_LOADING_COMPLETED,xe,le),Q.off(M.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Xe,le),Q.off(M.default.SET_NON_FRAGMENTED_TEXT,nt,le),Q.off(M.default.QUOTA_EXCEEDED,et,le),Q.off(M.default.SOURCE_BUFFER_ERROR,ht,le),Be(),K=null,$=null}function Ye(){return U?U.isUpdating():!1}function Oe(ye){return new Promise(function(He){var lt=j.hasBufferAtTime(ye.seekTime);if(lt){j.pruneBuffer(),He();return}H.clearScheduleTimer(),ce.abortRequests(),j.prepareForPlaybackSeek().then(function(){var St=j.getAllRangesWithSafetyFactor(ye.seekTime);return j.clearBuffers(St)}).then(function(){var St=j.getContinuousBufferTimeForTargetTime(ye.seekTime);if(!isNaN(St)&&!isNaN($.duration)&&isFinite($.duration)&&St>=$.start+$.duration)j.setIsBufferingCompleted(!0),He();else{var It=isNaN(St)?ye.seekTime:St;Pe(It),j.setSeekTarget(It);var kt=[];kt.push(j.updateAppendWindow());var Gt=ut();kt.push(j.updateBufferTimestampOffset(Gt)),Promise.all(kt).then(function(){H.setInitSegmentRequired(!0),H.setCheckPlaybackQuality(!1),H.startScheduleTimer(),He()})}}).catch(function(St){te.error(St)})})}function Se(){return new Promise(function(ye,He){try{H.clearScheduleTimer(),ce.abortRequests(),j.prepareForPlaybackSeek().then(function(){return j.pruneAllSafely()}).then(function(){ye()})}catch(lt){He(lt)}})}function Me(ye){var He=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(ye.sender){if(oe.getIsManifestUpdateInProgress()){Ge();return}if(!(be()&&!_e.isTextEnabled())&&j&&ye.representationId&&!j.appendInitSegmentFromCache(ye.representationId)){var lt=U.getCurrentRepresentation();if(lt.range===0){qe();return}var St=z?z.getInitRequest(R,lt):null;St?ce.executeRequest(St):He&&(H.setInitSegmentRequired(!0),Ge())}}}function qe(ye){var He=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(oe.getIsManifestUpdateInProgress()||j.getIsPruningInProgress()){Ge();return}var lt=We();lt?(B=!1,it(lt)):at(He)}function it(ye){isNaN(ye.startTime+ye.duration)||(ue=ye.startTime+ye.duration),ye.delayLoadingTime=new Date().getTime()+H.getTimeToLoadDelay(),H.setTimeToLoadDelay(0),Ce(ye)?(te.warn("Fragment request url ".concat(ye.url," for stream id ").concat($.id," and media type ").concat(K," is on the ignore list and will be skipped")),Ge()):(te.debug("Next fragment request url for stream id ".concat($.id," and media type ").concat(K," is ").concat(ye.url)),ce.executeRequest(ye))}function at(ye){var He=U.getCurrentRepresentation();if(se.get().streaming.gaps.enableSeekFix&&(B||oe.getTime()===0)){var lt;if(N?N&&He.segmentInfoType===o.default.SEGMENT_TIMELINE&&(lt=z.getValidTimeAheadOfTargetTime(ue,R,He,se.get().streaming.gaps.threshold)):lt=z.getValidTimeAheadOfTargetTime(ue,R,He,se.get().streaming.gaps.threshold),!isNaN(lt)&&lt!==ue){oe.isSeeking()||oe.getTime()===0?(te.warn("Adjusting playback time ".concat(lt," because of gap in the manifest. Seeking by ").concat(lt-ue)),oe.seek(lt,!1,!1)):(te.warn("Adjusting buffering time ".concat(lt," because of gap in the manifest. Adjusting time by ").concat(lt-ue)),Pe(lt),ye&&Ge());return}}var St=z.isLastSegmentRequested(He,ue);if(St){var It=z.getCurrentIndex();te.debug("Segment requesting for stream ".concat($.id," has finished")),Q.trigger(M.default.STREAM_REQUESTING_COMPLETED,{segmentIndex:It},{streamId:$.id,mediaType:K}),j.segmentRequestingCompleted(It),H.clearScheduleTimer();return}ye&&Ge()}function Ce(ye){var He=ye.url;return ye.range&&(He=He.concat("_",ye.range)),q.contains(He)}function We(){var ye=ut(),He;if(isNaN(ue)||Ae()===d.default.TEXT&&!_e.isTextEnabled())return null;if(z){var lt=U&&ye?U.getRepresentationForQuality(ye.quality):null;B?He=z.getSegmentRequestForTime(R,lt,ue):He=z.getNextSegmentRequest(R,lt)}return He}function Ge(){H.startScheduleTimer(oe.getLowLatencyModeEnabled()?se.get().streaming.scheduling.lowLatencyTimeout:se.get().streaming.scheduling.defaultTimeout)}function tt(ye){ye.error||(H.setCurrentRepresentation(ee.convertRepresentationToRepresentationInfo(ye.currentRepresentation)),j.getIsBufferingCompleted()||j.updateBufferTimestampOffset(ye.currentRepresentation))}function ot(ye){he.addBufferState(K,ye.state,H.getBufferTarget()),ye.state===l.default.BUFFER_EMPTY&&!oe.isSeeking()&&(te.info("Buffer is empty! Stalling!"),he.pushPlayListTraceMetrics(new Date,y.PlayListTrace.REBUFFERING_REASON))}function ct(ye){ce.syncExecutedRequestsWithBufferedRange(j.getBuffer().getAllBufferRanges(),$.duration),ye.quotaExceeded&&ye.from>oe.getTime()&&Pe(ye.from),ye.hasEnoughSpaceToAppend&&ye.quotaExceeded&&H.startScheduleTimer()}function ht(ye){if(!(!ye||!ye.lastRequestAppended||!ye.lastRequestAppended.url)){var He=ye.lastRequestAppended.url;ye.lastRequestAppended.range&&(He=He.concat("_",ye.lastRequestAppended.range)),te.warn("Blacklisting segment with url ".concat(He)),q.add(He)}}function Pt(ye){te.debug("Preparing quality switch for type ".concat(K));var He=ye.newQuality;G=!0,H.clearScheduleTimer();var lt=ut(He);H.setCurrentRepresentation(lt),U.prepareQualityChange(He),ce.abortRequests(),j.updateBufferTimestampOffset(lt).then(function(){ye.reason&&ye.reason.forceReplace?$e():se.get().streaming.buffer.fastSwitchEnabled?Te(lt):de(),he.pushPlayListTraceMetrics(new Date,y.PlayListTrace.REPRESENTATION_SWITCH_STOP_REASON),he.createPlaylistTraceMetrics(lt.id,oe.getTime()*1e3,oe.getPlaybackRate())})}function $e(){Q.trigger(M.default.BUFFER_REPLACEMENT_STARTED,{mediaType:K,streamId:$.id},{mediaType:K,streamId:$.id}),j.prepareForReplacementQualitySwitch().then(function(){Wt(),G=!1}).catch(function(){Wt(),G=!1})}function Te(ye){var He=oe.getTime(),lt=1.5*(isNaN(ye.fragmentDuration)?1:ye.fragmentDuration),St=ce.getRequests({state:c.default.FRAGMENT_MODEL_EXECUTED,time:He+lt,threshold:0})[0];if(St&&!be()){var It=j.getBufferLevel(),kt=X.getAbandonmentStateFor($.id,K);if(St.quality<ye.quality&&It>=lt&&kt!==l.default.ABANDON_LOAD){var Gt=He+lt;Pe(Gt),H.setCheckPlaybackQuality(!1),H.startScheduleTimer()}else de()}else H.startScheduleTimer();G=!1}function de(){Je(),G=!1}function Re(ye){te.info("onFragmentLoadingAbandoned request: "+ye.request.url+" has been aborted"),!oe.isSeeking()&&!H.getSwitchStrack()&&!G&&(te.info("onFragmentLoadingAbandoned request: "+ye.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),ye.request&&ye.request.isInitializationRequest()?H.setInitSegmentRequired(!0):Pe(ye.request.startTime+ye.request.duration/2),H.startScheduleTimer(0))}function xe(ye){te.info("OnFragmentLoadingCompleted for stream id "+$.id+" and media type "+K+" - Url:",ye.request?ye.request.url:"undefined",ye.request.range?", Range:"+ye.request.range:""),be()&&H.startScheduleTimer(0),ye.error&&ye.request.serviceLocation&&Ne(ye)}function Ne(ye){te.info("Fragment loading completed with an error"),!(!ye||!ye.request||!ye.request.type)&&(ye.request.type===x.HTTPRequest.INIT_SEGMENT_TYPE?Me({representationId:ye.request.representationId,sender:{}},!1):ye.request.type===x.HTTPRequest.MEDIA_SEGMENT_TYPE&&(Pe(ye.request.startTime+ye.request.duration/2),qe({},!1)))}function Xe(){Pe(oe.getTime()),Ve().startScheduleTimer()}function nt(ye){var He=ye.currentTrackInfo;if(He){var lt=w.find(function(St){return St.index===He.index&&St.lang===He.lang});lt&&ft(lt).then(function(){j.setIsBufferingCompleted(!1),Pe(oe.getTime()),H.setInitSegmentRequired(!0),H.startScheduleTimer()})}}function et(ye){Pe(ye.quotaExceededTime),H.clearScheduleTimer()}function dt(){return U}function Tt(){return j?j.getBuffer():null}function Ct(){return j}function De(){j.dischargePreBuffer()}function Ue(){return ce}function Ze(ye){return $=ye,Ie()?Promise.resolve():j.updateAppendWindow()}function mt(){return $}function ft(ye){ye!==R&&(!ye||!R||ye.type===R.type)&&(R=ye);var He=ee.getRealAdaptation($,R),lt=ee.getVoRepresentations(R);if(U){var St=U.getData(),It=X.getMaxAllowedIndexFor(K,$.id),kt=X.getMinAllowedIndexFor(K,$.id),Gt,Bt,nr=null;return(St===null||St.id!==He.id)&&K!==d.default.TEXT?(Bt=X.getThroughputHistory().getAverageThroughput(K,N),nr=Bt||X.getInitialBitrateFor(K,$.id),Gt=X.getQualityForBitrate(R,nr,$.id)):Gt=X.getQualityFor(K,$.id),kt!==void 0&&Gt<kt&&(Gt=kt),Gt>It&&(Gt=It),U.updateData(He,lt,K,R.isFragmented,Gt)}else return Promise.resolve()}function pt(ye){w.indexOf(ye)===-1&&w.push(ye)}function Mt(){w=[]}function Kt(){return R}function jt(){return j.getMediaSource()}function pe(ye){return j.setMediaSource(ye,R)}function Ve(){return H}function ut(ye){var He;return ye!==void 0?((0,P.checkInteger)(ye),He=U?U.getRepresentationForQuality(ye):null):He=U?U.getCurrentRepresentation():null,ee.convertRepresentationToRepresentationInfo(He)}function Ie(){return j?j.getIsBufferingCompleted():!1}function we(){return j?j.getBufferLevel():0}function ze(){var ye=ut(),He=U&&ye?U.getRepresentationForQuality(ye.quality):null;return z.getNextSegmentRequestIdempotent(R,He)}function Et(ye){if(se.get().streaming.enableManifestTimescaleMismatchFix){var He=ye.chunk,lt=He.bytes,St=He.quality,It=ut(St),kt=U&&It?U.getRepresentationForQuality(It.quality):null;if(It&&kt){var Gt=Z.getMediaTimescaleFromMoov(lt);kt.timescale=Gt}}}function xt(ye){var He=ye.chunk,lt=He.bytes,St=He.quality,It=ut(St),kt=U&&It?U.getRepresentationForQuality(It.quality):null;if(It&&kt){var Gt=ee.getEventsFor(It.mediaInfo,null,$),Bt=ee.getEventsFor(It,kt,$);if(Gt&&Gt.length>0||Bt&&Bt.length>0){var nr=ce.getRequests({state:c.default.FRAGMENT_MODEL_EXECUTED,quality:St,index:He.index})[0],yr=Dt(lt,nr,Gt,Bt);Q.trigger(M.default.INBAND_EVENTS,{events:yr},{streamId:$.id})}}}function Dt(ye,He,lt,St){try{for(var It={},kt=[],Gt=lt.concat(St),Bt=0,nr=Gt.length;Bt<nr;Bt++)It[Gt[Bt].schemeIdUri+"/"+Gt[Bt].value]=Gt[Bt];var yr=(0,D.default)(V).getInstance().parse(ye),Pr=yr.getBoxes("emsg");if(!Pr||Pr.length===0)return kt;for(var gr=yr.getBox("sidx"),Kr=gr&&!isNaN(gr.earliest_presentation_time)&&!isNaN(gr.timescale)?gr.earliest_presentation_time/gr.timescale:He&&!isNaN(He.mediaStartTime)?He.mediaStartTime:0,Qr=Math.max(Kr,0),an=U.getCurrentRepresentation(),Ar=0,Wr=Pr.length;Ar<Wr;Ar++){var jr=ee.getEvent(Pr[Ar],It,Qr,an);jr&&kt.push(jr)}return kt}catch{return[]}}function Rt(ye){var He=Tt();return He?Promise.resolve(He):j?j.createBufferSink(R,ye):Promise.resolve(null)}function Qt(){return new Promise(function(ye){te.debug("Preparing track switch for type ".concat(K));var He=K===d.default.TEXT||se.get().streaming.trackSwitchMode[K]===d.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&oe.getTimeToStreamEnd($)>se.get().streaming.buffer.stallThreshold;if(j.getIsBufferingCompleted()&&!He){j.prepareForNonReplacementTrackSwitch(R.codec).then(function(){Q.trigger(M.default.BUFFERING_COMPLETED,{},{streamId:$.id,mediaType:K})}).catch(function(){Q.trigger(M.default.BUFFERING_COMPLETED,{},{streamId:$.id,mediaType:K})}),ye();return}H.clearScheduleTimer(),H.setSwitchTrack(!0),He?(Q.trigger(M.default.BUFFER_REPLACEMENT_STARTED,{mediaType:K,streamId:$.id},{mediaType:K,streamId:$.id}),ce.abortRequests(),j.prepareForReplacementTrackSwitch(R.codec).then(function(){var lt=ut();return j.updateBufferTimestampOffset(lt)}).then(function(){Wt(),ye()}).catch(function(){Wt(),ye()})):j.prepareForNonReplacementTrackSwitch(R.codec).then(function(){Je(),ye()}).catch(function(){Je(),ye()})})}function Wt(){var ye=oe.getTime();se.get().streaming.buffer.flushBufferAtTrackSwitch&&oe.seek(ye+.001,!1,!0),Pe(ye),j.setSeekTarget(ye),H.startScheduleTimer()}function Je(){var ye=oe.getTime(),He=j.getContinuousBufferTimeForTargetTime(ye),lt=isNaN(He)?ye:He;Pe(lt),H.startScheduleTimer()}function At(ye,He){var lt=null;return ye?(ye===d.default.TEXT&&!He?lt=(0,m.default)(V).create({streamInfo:$,type:ye,mimeType:re,fragmentModel:ce,textController:_e,errHandler:Y,settings:se}):lt=(0,E.default)(V).create({streamInfo:$,type:ye,mediaPlayerModel:ae,manifestModel:ne,fragmentModel:ce,errHandler:Y,mediaController:ge,representationController:U,adapter:ee,textController:_e,abrController:X,playbackController:oe,settings:se}),lt):(Y.error(new h.default(p.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,p.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null)}function yt(ye){ye&&!isNaN(ye.time)&&(Pe(ye.time),j.setSeekTarget(ye.time))}function Pe(ye){ue=ye,B=!0}function Ke(ye,He){he.pushPlayListTraceMetrics(ye,He)}return le={initialize:ve,getStreamId:me,getType:Ae,isUpdating:Ye,getBufferController:Ct,dischargePreBuffer:De,getFragmentModel:Ue,getScheduleController:Ve,getRepresentationController:dt,getRepresentationInfo:ut,getBufferLevel:we,isBufferingCompleted:Ie,createBufferSinks:Rt,updateStreamInfo:Ze,getStreamInfo:mt,selectMediaInfo:ft,clearMediaInfoArray:Mt,addMediaInfo:pt,prepareTrackSwitch:Qt,prepareQualityChange:Pt,getMediaInfo:Kt,getMediaSource:jt,setMediaSource:pe,getBuffer:Tt,setExplicitBufferingTime:Pe,finalisePlayList:Ke,probeNextRequest:ze,prepareInnerPeriodPlaybackSeeking:Oe,prepareOuterPeriodPlaybackSeeking:Se,reset:ke},J(),le}F.__dashjs_factory_name="StreamProcessor";const k=L.default.getClassFactory(F)},"./src/streaming/XlinkLoader.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>P});var d=r("./src/streaming/vo/DashJSError.js"),o=r("./src/streaming/net/URLLoader.js"),l=r("./src/streaming/vo/metrics/HTTPRequest.js"),c=r("./src/streaming/vo/TextRequest.js"),E=r("./src/core/EventBus.js"),m=r("./src/core/events/Events.js"),f=r("./src/core/FactoryMaker.js"),T=r("./src/core/errors/Errors.js");function L(O){O=O||{};var M="urn:mpeg:dash:resolve-to-zero:2013",S=this.context,p=(0,E.default)(S).getInstance(),h=(0,o.default)(S).create({errHandler:O.errHandler,dashMetrics:O.dashMetrics,mediaPlayerModel:O.mediaPlayerModel,requestModifier:O.requestModifier,errors:T.default}),C;function v(D,y,A){var x=function(W,V){y.resolved=!0,y.resolvedContent=W||null,p.trigger(m.default.XLINK_ELEMENT_LOADED,{element:y,resolveObject:A,error:W||V?null:new d.default(T.default.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,T.default.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+D)})};if(D===M)x(null,!0);else{var F=new c.default(D,l.HTTPRequest.XLINK_EXPANSION_TYPE);h.load({request:F,success:function(W){x(W)},error:function(){x(null)}})}}function I(){h&&(h.abort(),h=null)}return C={load:v,reset:I},C}L.__dashjs_factory_name="XlinkLoader";const P=f.default.getClassFactory(L)},"./src/streaming/constants/ConformanceViolationConstants.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>d});const d={LEVELS:{SUGGESTION:"Suggestion",WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'},INVALID_DVR_WINDOW:{key:"INVALID_DVR_WINDOW",message:"No valid segment found when applying a specification compliant DVR window calculation. Using SegmentTimeline entries as a fallback."}}}},"./src/streaming/constants/Constants.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});function d(f,T){if(!(f instanceof T))throw new TypeError("Cannot call a class as a function")}function o(f,T){for(var L=0;L<T.length;L++){var P=T[L];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(f,P.key,P)}}function l(f,T,L){return T&&o(f.prototype,T),L&&o(f,L),f}var c=function(){function f(){d(this,f),this.init()}return l(f,[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.CONTENT_STEERING="contentSteering",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY="highestSelectionPriority",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},this.FILE_LOADER_TYPES={FETCH:"fetch_loader",XHR:"xhr_loader"}}}]),f}(),E=new c;const m=E},"./src/streaming/constants/MetricsConstants.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});function d(f,T){if(!(f instanceof T))throw new TypeError("Cannot call a class as a function")}function o(f,T){for(var L=0;L<T.length;L++){var P=T[L];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(f,P.key,P)}}function l(f,T,L){return T&&o(f.prototype,T),L&&o(f,L),f}var c=function(){function f(){d(this,f),this.init()}return l(f,[{key:"init",value:function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_LOADED="bufferLoaded",this.ABANDON_LOAD="abandonload",this.ALLOW_LOAD="allowload",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors",this.HTTP_REQUEST_DVB_REPORTING_TYPE="DVBReporting"}}]),f}(),E=new c;const m=E},"./src/streaming/constants/ProtectionConstants.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});function d(f,T){if(!(f instanceof T))throw new TypeError("Cannot call a class as a function")}function o(f,T){for(var L=0;L<T.length;L++){var P=T[L];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(f,P.key,P)}}function l(f,T,L){return T&&o(f.prototype,T),L&&o(f,L),f}var c=function(){function f(){d(this,f),this.init()}return l(f,[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready",this.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING="com.microsoft.playready.recommendation",this.INITIALIZATION_DATA_TYPE_CENC="cenc",this.INITIALIZATION_DATA_TYPE_KEYIDS="keyids",this.INITIALIZATION_DATA_TYPE_WEBM="webm"}}]),f}(),E=new c;const m=E},"./src/streaming/controllers/AbrController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>F});var d=r("./src/streaming/rules/abr/ABRRulesCollection.js"),o=r("./src/streaming/constants/Constants.js"),l=r("./src/streaming/constants/MetricsConstants.js"),c=r("./src/streaming/vo/BitrateInfo.js"),E=r("./src/streaming/models/FragmentModel.js"),m=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js"),T=r("./src/core/FactoryMaker.js"),L=r("./src/streaming/rules/RulesContext.js"),P=r("./src/streaming/rules/SwitchRequest.js"),O=r("./src/streaming/rules/SwitchRequestHistory.js"),M=r("./src/streaming/rules/DroppedFramesHistory.js"),S=r("./src/streaming/rules/ThroughputHistory.js"),p=r("./src/core/Debug.js"),h=r("./src/streaming/vo/metrics/HTTPRequest.js"),C=r("./src/streaming/utils/SupervisorTools.js"),v=r("./src/streaming/MediaPlayerEvents.js"),I=1e3,D=100,y=0;function A(){var k=this.context,W=(0,p.default)(k).getInstance(),V=(0,m.default)(k).getInstance(),Q,$,K,Y,re,ie,ee,ne,ae,ce,X,oe,ge,_e,he,se,Z,q,le,te,N,R,w,j,H,U,B;function G(){$=W.getLogger(Q),ve()}function z(){N=(0,M.default)(k).create(),R=(0,S.default)(k).create({settings:B}),K=(0,d.default)(k).create({dashMetrics:U,customParametersModel:se,mediaPlayerModel:he,settings:B}),K.initialize(),V.on(v.default.QUALITY_CHANGE_RENDERED,ke,Q),V.on(v.default.METRIC_ADDED,Ye,Q),V.on(f.default.LOADING_PROGRESS,Be,Q)}function fe(De,Ue){var Ze=Ue.getStreamInfo().id;ee[Ze]||(ee[Ze]={}),te[Ze]||(te[Ze]={}),ne[Ze]||(ne[Ze]={}),te[Ze][De]=(0,O.default)(k).create(),ee[Ze][De]=Ue,ne[Ze][De]={},ne[Ze][De].state=l.default.ALLOW_LOAD,ue(De),De===o.default.VIDEO&&Tt()}function ue(De){var Ue=B.get().streaming.abr.ABRStrategy;Ue===o.default.ABR_STRATEGY_L2A?(w[De]=!1,H[De]=!1,j[De]=!0):Ue===o.default.ABR_STRATEGY_LoLP?(w[De]=!1,H[De]=!0,j[De]=!1):Ue===o.default.ABR_STRATEGY_BOLA?(w[De]=!0,H[De]=!1,j[De]=!1):Ue===o.default.ABR_STRATEGY_THROUGHPUT?(w[De]=!1,H[De]=!1,j[De]=!1):Ue===o.default.ABR_STRATEGY_DYNAMIC&&(w[De]=w&&w[De]?w[De]:!1,H[De]=!1,j[De]=!1)}function J(De,Ue){try{ee[De]&&ee[De][Ue]&&delete ee[De][Ue],te[De]&&te[De][Ue]&&delete te[De][Ue],ne[De]&&ne[De][Ue]&&delete ne[De][Ue]}catch{}}function ve(){re={},ie={},ne={},ee={},te={},w={},j={},H={},ce===void 0&&(ce=!1),N&&N.reset(),le=void 0,N=void 0,R=void 0,clearTimeout(ae),ae=null}function me(){ve(),V.off(f.default.LOADING_PROGRESS,Be,Q),V.off(v.default.QUALITY_CHANGE_RENDERED,ke,Q),V.off(v.default.METRIC_ADDED,Ye,Q),K&&K.reset()}function Ae(De){De&&(De.streamController&&(Y=De.streamController),De.domStorage&&(q=De.domStorage),De.mediaPlayerModel&&(he=De.mediaPlayerModel),De.customParametersModel&&(se=De.customParametersModel),De.cmsdModel&&(Z=De.cmsdModel),De.dashMetrics&&(U=De.dashMetrics),De.adapter&&(ge=De.adapter),De.videoModel&&(_e=De.videoModel),De.settings&&(B=De.settings))}function be(){if(!q||!q.hasOwnProperty("getSavedBitrateSettings"))throw new Error(o.default.MISSING_CONFIG_ERROR)}function Be(De){var Ue=De.request.mediaType,Ze=De.streamId;if(!(!Ue||!Ze||!ee[Ze]||!B.get().streaming.abr.autoSwitchBitrate[Ue])){var mt=ee[Ze][Ue];if(mt){var ft=(0,L.default)(k).create({abrController:Q,streamProcessor:mt,currentRequest:De.request,useBufferOccupancyABR:w[Ue],useL2AABR:j[Ue],useLoLPABR:H[Ue],videoModel:_e}),pt=K.shouldAbandonFragment(ft,Ze);if(pt.quality>P.default.NO_CHANGE){var Mt=mt.getFragmentModel(),Kt=Mt.getRequests({state:E.default.FRAGMENT_MODEL_LOADING,index:De.request.index})[0];Kt&&(ne[Ze][Ue].state=l.default.ABANDON_LOAD,te[Ze][Ue].reset(),te[Ze][Ue].push({oldValue:ct(Ue,Ze),newValue:pt.quality,confidence:1,reason:pt.reason}),ht(Ue,Y.getActiveStreamInfo(),pt.quality,pt.reason),clearTimeout(ae),ae=setTimeout(function(){ne[Ze][Ue].state=l.default.ALLOW_LOAD,ae=null},B.get().streaming.abandonLoadTimeout))}}}}function ke(De){De.mediaType===o.default.VIDEO&&(le!==void 0&&N.push(De.streamId,le,_e.getPlaybackQuality()),le=De.newQuality)}function Ye(De){De.metric===l.default.HTTP_REQUEST&&De.value&&De.value.type===h.HTTPRequest.MEDIA_SEGMENT_TYPE&&(De.mediaType===o.default.AUDIO||De.mediaType===o.default.VIDEO)&&R.push(De.mediaType,De.value,B.get().streaming.abr.useDeadTimeLatency),De.metric===l.default.BUFFER_LEVEL&&(De.mediaType===o.default.AUDIO||De.mediaType===o.default.VIDEO)&&xe(De.mediaType,.001*De.value.level)}function Oe(De,Ue){try{var Ze;return re[Ue]=re[Ue]||{},re[Ue].hasOwnProperty(De)||(re[Ue][De]=0),Ze=it(De,Ue),Ze=Ce(Ze,De,Ue),Ze=We(Ze,De,Ue),B.get().streaming.cmsd.enabled&&B.get().streaming.cmsd.abr.applyMb&&(Ze=at(Ze,De,Ue)),Ze}catch{return}}function Se(De,Ue){try{return qe(De,Ue)}catch{return}}function Me(De,Ue){try{var Ze=he.getAbrBitrateParameter("maxBitrate",De);return Ze>-1?de(ee[Ue][De].getMediaInfo(),Ze,Ue):void 0}catch{return}}function qe(De,Ue){try{var Ze=he.getAbrBitrateParameter("minBitrate",De);if(Ze>-1){var mt=ee[Ue][De].getMediaInfo(),ft=Re(mt),pt=de(mt,Ze,Ue);return ft[pt]&&pt<ft.length-1&&ft[pt].bitrate<Ze*1e3&&pt++,pt}else return}catch{return}}function it(De,Ue){var Ze=re[Ue][De],mt=Ze;if(!ee[Ue]||!ee[Ue][De])return mt;var ft=Se(De,Ue);ft!==void 0&&(mt=Math.max(Ze,ft));var pt=Me(De,Ue);return pt!==void 0&&(mt=Math.min(mt,pt)),mt}function at(De,Ue,Ze){if(Ue!=="video")return De;var mt=Z.getMaxBitrate(Ue);if(mt<0)return De;var ft=Te(Ze,"audio",ct("audio",Ze));mt-=ft?ft.bitrate/1e3:0;var pt=de(ee[Ze][Ue].getMediaInfo(),mt,Ze);return $.debug("Stream ID: "+Ze+" ["+Ue+"] Apply max bit rate from CMSD: "+mt),Math.min(De,pt)}function Ce(De,Ue,Ze){var mt=re[Ze][Ue],ft=B.get().streaming.abr.maxRepresentationRatio[Ue];return isNaN(ft)||ft>=1||ft<0?De:Math.min(De,Math.round(mt*ft))}function We(De,Ue,Ze){if(Ue!==o.default.VIDEO||!B.get().streaming.abr.limitBitrateByPortal||!ee[Ze]||!ee[Ze][Ue])return De;ce||Tt();var mt=ee[Ze][Ue].getStreamInfo(),ft=ge.getAdaptationForType(mt.index,Ue,mt).Representation_asArray,pt=De;if(X>0&&oe>0){for(;pt>0&&ft[pt]&&X<ft[pt].width&&X-ft[pt-1].width<ft[pt].width-X;)pt=pt-1;for(;pt<ft.length-1&&ft[pt].width===ft[pt+1].width;)pt=pt+1}return pt}function Ge(De){var Ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(Ue||(Ue=Y.getActiveStreamInfo().id),De&&ee&&ee[Ue]&&ee[Ue][De]){var Ze=Oe(De,Ue),mt=Re(ee[Ue][De].getMediaInfo());return mt[Ze]?mt[Ze]:null}return null}function tt(De,Ue){if(be(),De===o.default.TEXT)return NaN;var Ze=q.getSavedBitrateSettings(De),mt=he.getAbrBitrateParameter("initialBitrate",De),ft=B.get().streaming.abr.initialRepresentationRatio[De];if(mt===-1)if(ft>-1){var pt=ee[Ue][De].getStreamInfo(),Mt=ge.getAdaptationForType(pt.index,De,pt).Representation_asArray;if(Array.isArray(Mt)){var Kt=Math.max(Math.round(Mt.length*ft)-1,0);mt=Mt[Kt].bandwidth/1e3}else mt=0}else isNaN(Ze)?mt=De===o.default.VIDEO?I:D:mt=Ze;return mt}function ot(De,Ue){try{if(!De||!ee||!ee[Ue]||!ee[Ue][De])return!1;if(N){var Ze=_e.getPlaybackQuality();Ze&&N.push(Ue,le,Ze)}if(!B.get().streaming.abr.autoSwitchBitrate[De])return!1;var mt=ct(De,Ue),ft=(0,L.default)(k).create({abrController:Q,switchHistory:te[Ue][De],droppedFramesHistory:N,streamProcessor:ee[Ue][De],currentValue:mt,useBufferOccupancyABR:w[De],useL2AABR:j[De],useLoLPABR:H[De],videoModel:_e}),pt=Se(De,Ue),Mt=Oe(De,Ue),Kt=K.getMaxQuality(ft),jt=Kt.quality;return pt!==void 0&&(jt>P.default.NO_CHANGE?jt:mt)<pt&&(jt=pt),jt>Mt&&(jt=Mt),te[Ue][De].push({oldValue:mt,newValue:jt}),jt>P.default.NO_CHANGE&&jt!==mt&&(ne[Ue][De].state===l.default.ALLOW_LOAD||jt<mt)?($e(De,mt,jt,Mt,Kt.reason,Ue),!0):!1}catch{return!1}}function ct(De){var Ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;try{if(Ue||(Ue=Y.getActiveStreamInfo().id),De&&ee[Ue]&&ee[Ue][De]){var Ze;if(Ue)return ie[Ue]=ie[Ue]||{},ie[Ue].hasOwnProperty(De)||(ie[Ue][De]=y),Ze=ie[Ue][De],Ze}return y}catch{return y}}function ht(De,Ue,Ze){var mt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!(!Ue||!Ue.id||!De)){var ft=Ue.id,pt=ct(De,ft);(0,C.checkInteger)(Ze);var Mt=Oe(De,ft);Ze!==pt&&Ze>=0&&Ze<=Mt&&$e(De,pt,Ze,Mt,mt,ft)}}function Pt(De,Ue){return ne[De]&&ne[De][Ue]?ne[De][Ue].state:null}function $e(De,Ue,Ze,mt,ft,pt){if(De&&ee[pt]&&ee[pt][De]){var Mt=ee[pt][De].getStreamInfo(),Kt=Mt&&Mt.manifestInfo&&Mt.manifestInfo.isDynamic,jt=U.getCurrentBufferLevel(De);$.info("Stream ID: "+pt+" ["+De+"] switch from "+Ue+" to "+Ze+"/"+mt+" (buffer: "+jt+") "+(ft?JSON.stringify(ft):".")),ie[pt]=ie[pt]||{},ie[pt][De]=Ze;var pe=Te(pt,De,Ze);V.trigger(f.default.QUALITY_CHANGE_REQUESTED,{oldQuality:Ue,newQuality:Ze,reason:ft,streamInfo:Mt,bitrateInfo:pe,maxIdx:mt,mediaType:De},{streamId:Mt.id,mediaType:De});var Ve=R.getAverageThroughput(De,Kt);isNaN(Ve)||q.setSavedBitrateSettings(De,Ve)}}function Te(De,Ue,Ze){if(Ue&&ee&&ee[De]&&ee[De][Ue]){var mt=Re(ee[De][Ue].getMediaInfo());return mt[Ze]?mt[Ze]:null}return null}function de(De,Ue,Ze){var mt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,ft=De&&De.type?ee[Ze][De.type].getRepresentationInfo():null;if(B.get().streaming.abr.useDeadTimeLatency&&mt&&ft&&ft.fragmentDuration){mt=mt/1e3;var pt=ft.fragmentDuration;if(mt>pt)return 0;var Mt=mt/pt;Ue=Ue*(1-Mt)}for(var Kt=Re(De),jt=Kt.length-1;jt>=0;jt--){var pe=Kt[jt];if(Ue*1e3>=pe.bitrate)return jt}return y}function Re(De){var Ue=[];if(!De||!De.bitrateList)return Ue;for(var Ze=De.bitrateList,mt=De.type,ft,pt=0,Mt=Ze.length;pt<Mt;pt++)ft=new c.default,ft.mediaType=mt,ft.qualityIndex=pt,ft.bitrate=Ze[pt].bandwidth,ft.width=Ze[pt].width,ft.height=Ze[pt].height,ft.scanType=Ze[pt].scanType,Ue.push(ft);return Ue}function xe(De,Ue){var Ze=B.get().streaming.abr.ABRStrategy;Ze===o.default.ABR_STRATEGY_DYNAMIC&&Ne(De,Ue)}function Ne(De,Ue){try{var Ze=he.getStableBufferTime(),mt=Ze,ft=.5*Ze,pt=w[De],Mt=Ue>(pt?ft:mt);w[De]=Mt,Mt!==pt&&(Mt?$.info("["+De+"] switching from throughput to buffer occupancy ABR rule (buffer: "+Ue.toFixed(3)+")."):$.info("["+De+"] switching from buffer occupancy to throughput ABR rule (buffer: "+Ue.toFixed(3)+")."))}catch(Kt){$.error(Kt)}}function Xe(){return R}function nt(De){var Ue=De.type,Ze=De.streamInfo.id,mt=De.representationCount-1;return re[Ze]=re[Ze]||{},re[Ze][Ue]=mt,mt}function et(De){var Ue=De?De.id:null,Ze=ct(o.default.AUDIO,Ue),mt=ct(o.default.VIDEO,Ue),ft=Ze===Oe(o.default.AUDIO,Ue)&&mt===Oe(o.default.VIDEO,Ue);return ft}function dt(De){ce=De}function Tt(){if(_e){var De=B.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio"),Ue=De?window.devicePixelRatio:1;X=_e.getClientWidth()*Ue,oe=_e.getClientHeight()*Ue}}function Ct(De){N&&N.clearForStream(De),ee[De]&&delete ee[De],te[De]&&delete te[De],ne[De]&&delete ne[De]}return Q={initialize:z,isPlayingAtTopQuality:et,updateTopQualityIndex:nt,clearDataForStream:Ct,getThroughputHistory:Xe,getBitrateList:Re,getQualityForBitrate:de,getTopBitrateInfoFor:Ge,getMinAllowedIndexFor:Se,getMaxAllowedIndexFor:Oe,getInitialBitrateFor:tt,getQualityFor:ct,getAbandonmentStateFor:Pt,setPlaybackQuality:ht,checkPlaybackQuality:ot,setElementSize:Tt,setWindowResizeEventCalled:dt,registerStreamType:fe,unRegisterStreamType:J,setConfig:Ae,reset:me},G(),Q}A.__dashjs_factory_name="AbrController";var x=T.default.getSingletonFactory(A);x.QUALITY_DEFAULT=y,T.default.updateSingletonFactory(A.__dashjs_factory_name,x);const F=x},"./src/streaming/controllers/BaseURLController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>L});var d=r("./src/streaming/models/BaseURLTreeModel.js"),o=r("./src/streaming/utils/BaseURLSelector.js"),l=r("./src/streaming/utils/URLUtils.js"),c=r("./src/dash/vo/BaseURL.js"),E=r("./src/core/FactoryMaker.js"),m=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js");function T(){var P,O,M=this.context,S=(0,m.default)(M).getInstance(),p=(0,l.default)(M).getInstance(),h,C;function v(k){h.invalidateSelectedIndexes(k.entry)}function I(){h=(0,d.default)(M).create(),C=(0,o.default)(M).create(),S.on(f.default.SERVICE_LOCATION_BLACKLIST_CHANGED,v,P)}function D(k){k.baseURLTreeModel&&(h=k.baseURLTreeModel),k.baseURLSelector&&(C=k.baseURLSelector),k.adapter&&(O=k.adapter)}function y(k){h.update(k),C.chooseSelector(O.getIsDVB(k))}function A(k){var W=h.getForPath(k),V=W.reduce(function(Q,$){var K=C.select($);if(K)p.isRelative(K.url)?Q.url=p.resolve(K.url,Q.url):(Q.url=K.url,Q.serviceLocation=K.serviceLocation),Q.availabilityTimeOffset=K.availabilityTimeOffset,Q.availabilityTimeComplete=K.availabilityTimeComplete;else return new c.default;return Q},new c.default);if(!p.isRelative(V.url))return V}function x(){h.reset(),C.reset()}function F(k){h.setConfig({adapter:O}),y(k)}return P={reset:x,initialize:F,resolve:A,setConfig:D},I(),P}T.__dashjs_factory_name="BaseURLController";const L=E.default.getClassFactory(T)},"./src/streaming/controllers/BlacklistController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/EventBus.js");function l(E){E=E||{};var m,f=[],T=(0,o.default)(this.context).getInstance(),L=E.updateEventName,P=E.addBlacklistEventName;function O(C){return!f.length||!C||!C.length?!1:f.indexOf(C)!==-1}function M(C){f.indexOf(C)===-1&&(f.push(C),T.trigger(L,{entry:C}))}function S(C){M(C.entry)}function p(){P&&T.on(P,S,m)}function h(){f=[]}return m={add:M,contains:O,reset:h},p(),m}l.__dashjs_factory_name="BlackListController";const c=d.default.getClassFactory(l)},"./src/streaming/controllers/BufferController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>y});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/streaming/constants/MetricsConstants.js"),l=r("./src/streaming/models/FragmentModel.js"),c=r("./src/streaming/SourceBufferSink.js"),E=r("./src/streaming/PreBufferSink.js"),m=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js"),T=r("./src/core/FactoryMaker.js"),L=r("./src/core/Debug.js"),P=r("./src/streaming/utils/InitCache.js"),O=r("./src/streaming/vo/DashJSError.js"),M=r("./src/core/errors/Errors.js"),S=r("./src/streaming/vo/metrics/HTTPRequest.js"),p=r("./src/streaming/MediaPlayerEvents.js"),h=.5,C=.01,v=22,I="BufferController";function D(A){A=A||{};var x=this.context,F=(0,m.default)(x).getInstance(),k=A.errHandler,W=A.fragmentModel,V=A.representationController,Q=A.adapter,$=A.textController,K=A.abrController,Y=A.playbackController,re=A.streamInfo,ie=A.type,ee=A.settings,ne,ae,ce,X,oe,ge,_e,he,se,Z,q,le,te,N,R,w,j,H,U,B;function G(){ae=(0,L.default)(x).getInstance().getLogger(ne),j=(0,P.default)(x).getInstance(),At()}function z(Pe){ve(Pe),F.on(f.default.INIT_FRAGMENT_LOADED,Oe,ne),F.on(f.default.MEDIA_FRAGMENT_LOADED,Me,ne),F.on(f.default.WALLCLOCK_TIME_UPDATED,pe,ne),F.on(p.default.PLAYBACK_PLAYING,xe,ne),F.on(p.default.PLAYBACK_PROGRESS,de,ne),F.on(p.default.PLAYBACK_TIME_UPDATED,de,ne),F.on(p.default.PLAYBACK_RATE_CHANGED,Ve,ne),F.on(p.default.PLAYBACK_STALLED,Re,ne)}function fe(){return re.id}function ue(){return ie}function J(){return I}function ve(Pe){var Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return new Promise(function(ye,He){ge=Pe,se&&Ke&&typeof se.discharge=="function"?(Z=se,Ae(Ke).then(function(){ye()}).catch(function(lt){He(lt)})):ye()})}function me(Pe){return Q.convertRepresentationToRepresentationInfo(V.getRepresentationForQuality(Pe))}function Ae(Pe){var Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return new Promise(function(ye,He){if(!j||!Pe){ye(null);return}ge?Be(Pe,Ke).then(function(lt){ye(lt)}).catch(function(lt){He(lt)}):be().then(function(lt){ye(lt)}).catch(function(lt){He(lt)})})}function be(){var Pe=this;return new Promise(function(Ke,ye){var He=K.getQualityFor(ie,re.id);se=(0,E.default)(x).create(at.bind(Pe)),Mt(me(He)).then(function(){Ke(se)}).catch(function(){ye()})})}function Be(Pe,Ke){return new Promise(function(ye,He){var lt=K.getQualityFor(ie,re.id);se=(0,c.default)(x).create({mediaSource:ge,textController:$,eventBus:F}),ke(Pe,Ke,lt).then(function(){return Mt(me(lt))}).then(function(){ye(se)}).catch(function(St){ae.fatal("Caught error on create SourceBuffer: "+St),k.error(new O.default(M.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,M.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+ie)),He(St)})})}function ke(Pe,Ke,ye){var He=me(ye);return Ke&&Ke[ie]&&(ie===d.default.VIDEO||ie===d.default.AUDIO)?se.initializeForStreamSwitch(Pe,He,Ke[ie]):se.initializeForFirstUse(re,Pe,He)}function Ye(){if(se&&Z&&typeof Z.discharge=="function"){var Pe=Z.getAllBufferRanges();if(Pe.length>0){for(var Ke="Beginning "+ie+"PreBuffer discharge, adding buffer for:",ye=0;ye<Pe.length;ye++)Ke+=" start: "+Pe.start(ye)+", end: "+Pe.end(ye)+";";ae.debug(Ke)}else ae.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");q=[];for(var He=Z.discharge(),lt=null,St=0;St<He.length;St++){var It=He[St];if(It.segmentType!==S.HTTPRequest.INIT_SEGMENT_TYPE){var kt=j.extract(It.streamId,It.representationId);kt&&lt!==kt&&(q.push(kt),se.append(kt),lt=kt)}q.push(It),se.append(It)}Z.reset(),Z=null}}function Oe(Pe){ee.get().streaming.cacheInitSegments&&(ae.info("Init fragment finished loading saving to",ie+"'s init cache"),j.save(Pe.chunk)),ae.debug("Append Init fragment",ie," with representationId:",Pe.chunk.representationId," and quality:",Pe.chunk.quality,", data size:",Pe.chunk.bytes.byteLength),qe(Pe.chunk)}function Se(Pe){var Ke=j.extract(re.id,Pe);return Ke?(ae.info("Append Init fragment",ie," with representationId:",Ke.representationId," and quality:",Ke.quality,", data size:",Ke.bytes.byteLength),qe(Ke),!0):!1}function Me(Pe){qe(Pe.chunk,Pe.request)}function qe(Pe){var Ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;se.append(Pe,Ke).then(function(ye){at(ye)}).catch(function(ye){at(ye)}),Pe.mediaInfo.type===d.default.VIDEO&&Je(f.default.VIDEO_CHUNK_RECEIVED,{chunk:Pe})}function it(Pe){if(Pe&&Pe.length>0)for(var Ke=0,ye=Pe.length;Ke<ye;Ke++)ae.debug("Buffered range: "+Pe.start(Ke)+" - "+Pe.end(Ke)+", currentTime = ",Y.getTime())}function at(Pe){if(Pe.error){Pe.error.code===v&&We(),(Pe.error.code===v||!Qt())&&(ae.warn("Clearing playback buffer to overcome quota exceed situation"),Je(f.default.QUOTA_EXCEEDED,{criticalBufferLevel:oe,quotaExceededTime:Pe.chunk.start}),Ze(Ue()));return}if(se&&(et(),w=!1,te=Pe.chunk,!(!te||!te.endFragment))){te&&!isNaN(te.index)&&(_e=Math.max(te.index,_e),dt());var Ke=se.getAllBufferRanges();te.segmentType===S.HTTPRequest.MEDIA_SEGMENT_TYPE&&(it(Ke),de(),Ce());var ye=!1;q&&(q.indexOf(te)>0&&(ye=!0),q=null),te&&!ye&&Je(f.default.BYTES_APPENDED_END_FRAGMENT,{quality:te.quality,startTime:te.start,index:te.index,bufferedRanges:Ke,segmentType:te.segmentType,mediaType:ie})}}function Ce(){if(!isNaN(B)){if(ie!==d.default.AUDIO&&ie!==d.default.VIDEO){B=NaN;return}var Pe=Y.getTime(),Ke=Xe(Pe,0),ye=Xe(B,0);if(Ke&&ye&&Ke.start===ye.start){B=NaN;return}var He=V.getCurrentRepresentation().segmentDuration,lt=Xe(B,He);lt&&(ee.get().streaming.buffer.enableSeekDecorrelationFix&&Math.abs(Pe-B)>He?B<=lt.end&&Y.seek(Math.max(B,lt.start),!1,!0):Pe<lt.start&&Y.seek(lt.start,!1,!0))}}function We(){if(w=!0,oe=Dt()*.8,ae.warn("Quota exceeded, Critical Buffer: "+oe),oe>0){var Pe=Math.max(.2*oe,1),Ke=oe-Pe,ye=Math.min(ee.get().streaming.buffer.bufferTimeAtTopQuality,Ke*.9),He=Math.min(ee.get().streaming.buffer.bufferTimeAtTopQualityLongForm,Ke*.9),lt={streaming:{buffer:{bufferToKeep:parseFloat(Pe.toFixed(5)),bufferTimeAtTopQuality:parseFloat(ye.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(He.toFixed(5))}}};ee.update(lt)}}function Ge(){return ce&&Et(!1),se.abort()}function tt(Pe){return new Promise(function(Ke,ye){se.abort().then(function(){return Kt()}).then(function(){return ee.get().streaming.buffer.useChangeTypeForTrackSwitch?se.changeType(Pe):Promise.resolve()}).then(function(){return ht()}).then(function(){Et(!1),Ke()}).catch(function(He){ye(He)})})}function ot(){return new Promise(function(Pe,Ke){se.abort().then(function(){return Kt()}).then(function(){return ht()}).then(function(){Et(!1),Pe()}).catch(function(ye){Ke(ye)})})}function ct(Pe){return new Promise(function(Ke,ye){Kt().then(function(){return ee.get().streaming.buffer.useChangeTypeForTrackSwitch?se.changeType(Pe):Promise.resolve()}).then(function(){Ke()}).catch(function(He){ye(He)})})}function ht(){return new Promise(function(Pe,Ke){var ye=Pt();if(!ye||ye.length===0){de(),Pe();return}Ze(ye).then(function(){Pe()}).catch(function(He){Ke(He)})})}function Pt(Pe){var Ke=[],ye=se.getAllBufferRanges();if(!ye||ye.length===0)return Ke;if(!Pe&&Pe!==0||isNaN(Pe))Ke.push({start:ye.start(0),end:ye.end(ye.length-1)+h});else{var He=$e(Pe,ye),lt=Te(Pe,ye);He&&Ke.push(He),lt&&Ke.push(lt)}return Ke}function $e(Pe,Ke){var ye=ee.get().streaming.buffer.bufferToKeep,He=Ke.start(0),lt=Pe-He;if(lt>ye){var St=Math.max(0,Pe-ye),It=W.getRequests({state:l.default.FRAGMENT_MODEL_EXECUTED,time:Pe,threshold:C})[0];if(It&&(St=Math.min(It.startTime,St)),St>0)return{start:He,end:St}}return null}function Te(Pe,Ke){var ye=Ke.end(Ke.length-1)+h,He=Rt(Pe),lt=re.manifestInfo.duration>=ee.get().streaming.buffer.longFormContentDurationThreshold,St=lt?ee.get().streaming.buffer.bufferTimeAtTopQualityLongForm:ee.get().streaming.buffer.bufferTimeAtTopQuality,It=isNaN(He)?Pe:Math.min(He,Pe+St);if(It>=Ke.end(Ke.length-1))return null;var kt=W.getRequests({state:l.default.FRAGMENT_MODEL_EXECUTED,time:Pe,threshold:C})[0];kt&&(It=Math.max(kt.startTime+kt.duration,It));var Gt=ee.get().streaming.buffer.avoidCurrentTimeRangePruning;if(Gt){for(var Bt=0;Bt<Ke.length;Bt++)if(Ke.start(Bt)<=Pe&&Pe<=Ke.end(Bt)&&Ke.start(Bt)<=It&&It<=Ke.end(Bt)){var nr=It;Bt+1<Ke.length?It=Ke.start(Bt+1):It=Ke.end(Bt)+1,ae.debug("Buffered range ["+Ke.start(Bt)+", "+Ke.end(Bt)+"] overlaps with targetTime "+Pe+" and range to be pruned ["+nr+", "+ye+"], using ["+It+", "+ye+"] instead"+(It<ye?"":" (no actual pruning)"));break}}return It<Ke.end(Ke.length-1)?{start:It,end:ye}:null}function de(){(!U||ie===d.default.TEXT&&$.isTextEnabled())&&et()}function Re(){Tt()}function xe(){Tt(),B=NaN}function Ne(Pe){try{var Ke=se.getAllBufferRanges();if(!Ke||Ke.length===0)return!1;for(var ye=0;ye<Ke.length;){var He=Ke.start(ye),lt=Ke.end(ye);if(Pe>=He&&Pe<=lt)return!0;ye+=1}return!1}catch(St){return ae.error(St),!1}}function Xe(Pe,Ke){var ye=se.getAllBufferRanges(),He=0,lt=0,St=null,It=null,kt=0,Gt,Bt,nr=isNaN(Ke)?.15:Ke;if(ye!=null){for(Bt=0,Gt=ye.length;Bt<Gt;Bt++)if(He=ye.start(Bt),lt=ye.end(Bt),St===null)kt=Math.abs(He-Pe),(Pe>=He&&Pe<lt||kt<=nr)&&(St=He,It=lt);else if(kt=He-It,kt<=nr)It=lt;else break;if(St!==null)return{start:St,end:It}}return null}function nt(Pe,Ke){var ye,He;return ee.get().streaming.gaps.jumpGaps&&(Ke=ee.get().streaming.gaps.smallGapLimit),ye=Xe(Pe,Ke),ye===null?He=0:He=ye.end-Pe,He}function et(){if(Y){var Pe=ee.get().streaming.gaps.jumpGaps&&!isNaN(ee.get().streaming.gaps.smallGapLimit)?ee.get().streaming.gaps.smallGapLimit:NaN;X=Math.max(nt(Y.getTime()||0,Pe),0),Je(f.default.BUFFER_LEVEL_UPDATED,{mediaType:ie,bufferLevel:X}),Tt()}}function dt(){var Pe=_e>=he-1,Ke=Y.getTimeToStreamEnd(re)-X<1e-5;(Pe||Ke)&&!ce&&(Et(!0),ae.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED for stream id ".concat(re.id," and type ").concat(ie)))}function Tt(){ie!==d.default.AUDIO&&ie!==d.default.VIDEO||((!Y.getLowLatencyModeEnabled()&&X<ee.get().streaming.buffer.stallThreshold||X===0)&&!ce?Ct(o.default.BUFFER_EMPTY):(ce||X>=ee.get().streaming.buffer.stallThreshold||Y.getLowLatencyModeEnabled()&&X>0)&&Ct(o.default.BUFFER_LOADED))}function Ct(Pe){le===Pe||Pe===o.default.BUFFER_EMPTY&&Y.getTime()===0||ie===d.default.TEXT&&!$.isTextEnabled()||(le=Pe,Je(f.default.BUFFER_LEVEL_STATE_CHANGED,{state:Pe}),Je(Pe===o.default.BUFFER_LOADED?f.default.BUFFER_LOADED:f.default.BUFFER_EMPTY),ae.debug(Pe===o.default.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function De(){!se||ie===d.default.TEXT||ce||Ze(Ue())}function Ue(){var Pe=[],Ke=se.getAllBufferRanges();if(!Ke||Ke.length===0)return Pe;var ye=Y.getTime(),He=Math.max(0,ye-ee.get().streaming.buffer.bufferToKeep),lt=W.getRequests({state:l.default.FRAGMENT_MODEL_EXECUTED,time:ye,threshold:C})[0];if(lt)He=Math.min(lt.startTime,He);else if(ye===0&&Y.getIsDynamic())return[];if(Ke.start(0)<=He){for(var St={start:0,end:He},It=0;It<Ke.length&&Ke.end(It)<=He;It++)St.end=Ke.end(It);St.start<St.end&&Pe.push(St)}return Pe}function Ze(Pe){return new Promise(function(Ke,ye){if(!Pe||!se||Pe.length===0){Ke();return}var He=[];Pe.forEach(function(lt){He.push(mt(lt))}),R||ft(),Promise.all(He).then(function(){Ke()}).catch(function(lt){ye(lt)})})}function mt(Pe){return new Promise(function(Ke,ye){Pe.resolve=Ke,Pe.reject=ye,H.push(Pe)})}function ft(){try{if(H.length===0||!se){ae.debug("Nothing to prune, halt pruning"),H=[],R=!1;return}var Pe=se.getBuffer();if(!Pe||!Pe.buffered||Pe.buffered.length===0){ae.debug("SourceBuffer is empty (or does not exist), halt pruning"),H=[],R=!1;return}var Ke=H.shift();ae.debug("".concat(ie,": Removing buffer from: ").concat(Ke.start," to ").concat(Ke.end)),R=!0;var ye=Y.getTime();ye<Ke.end&&Et(!1),se.remove(Ke).then(function(He){pt(He)}).catch(function(He){pt(He)})}catch{R=!1}}function pt(Pe){ae.debug("onRemoved buffer from:",Pe.from,"to",Pe.to);var Ke=se.getAllBufferRanges();it(Ke),H.length===0&&(R=!1,et()),Pe.unintended&&(ae.warn("Detected unintended removal from:",Pe.from,"to",Pe.to,"setting streamprocessor time to",Pe.from),Je(f.default.SEEK_TARGET,{time:Pe.from})),R?ft():(U?U=!1:et(),Je(f.default.BUFFER_CLEARED,{from:Pe.from,to:Pe.to,unintended:Pe.unintended,hasEnoughSpaceToAppend:Qt(),quotaExceeded:w}))}function Mt(Pe){return new Promise(function(Ke){if(!Pe||Pe.MSETimeOffset===void 0||!se||!se.updateTimestampOffset){Ke();return}se.updateTimestampOffset(Pe.MSETimeOffset).then(function(){Ke()}).catch(function(){Ke()})})}function Kt(){return se&&!ce?se.updateAppendWindow(re):Promise.resolve()}function jt(Pe){isNaN(Pe)||(he=Pe,dt())}function pe(){N++;var Pe=N*(ee.get().streaming.wallclockTimeUpdateInterval/1e3);Pe>=ee.get().streaming.buffer.bufferPruningInterval&&(N=0,De())}function Ve(){Tt()}function ut(){return se}function Ie(){return X}function we(){return ge}function ze(){return ce}function Et(Pe){ce!==Pe&&(ce=Pe,ce?Je(f.default.BUFFERING_COMPLETED):he=Number.POSITIVE_INFINITY)}function xt(){return R}function Dt(){try{var Pe=se.getAllBufferRanges(),Ke=0,ye,He;if(!Pe)return Ke;for(He=0,ye=Pe.length;He<ye;He++)Ke+=Pe.end(He)-Pe.start(He);return Ke}catch{return 0}}function Rt(Pe){try{var Ke=Pe,ye=se.getAllBufferRanges();if(!ye||ye.length===0)return NaN;for(var He=0;Ke===Pe&&He<ye.length;){var lt=ye.start(He),St=ye.end(He);Ke>=lt&&Ke<=St&&(Ke=St),He+=1}return Ke===Pe?NaN:Ke}catch{}}function Qt(){var Pe=Dt();return isNaN(Pe)||Pe<oe}function Wt(Pe){B=Pe}function Je(Pe,Ke){var ye=Ke||{};F.trigger(Pe,ye,{streamId:re.id,mediaType:ie})}function At(Pe,Ke){if(oe=Number.POSITIVE_INFINITY,le=void 0,he=Number.POSITIVE_INFINITY,_e=0,te=null,ce=!1,R=!1,w=!1,X=0,N=0,H=[],B=NaN,se){var ye=se;se=null,!Pe&&!Ke&&ye.abort().then(function(){ye.reset(Ke),ye=null})}U=!1}function yt(Pe,Ke){F.off(f.default.INIT_FRAGMENT_LOADED,Oe,this),F.off(f.default.MEDIA_FRAGMENT_LOADED,Me,this),F.off(f.default.WALLCLOCK_TIME_UPDATED,pe,this),F.off(p.default.PLAYBACK_PLAYING,xe,this),F.off(p.default.PLAYBACK_PROGRESS,de,this),F.off(p.default.PLAYBACK_TIME_UPDATED,de,this),F.off(p.default.PLAYBACK_RATE_CHANGED,Ve,this),F.off(p.default.PLAYBACK_STALLED,Re,this),At(Pe,Ke)}return ne={initialize:z,getStreamId:fe,getType:ue,getBufferControllerType:J,createBufferSink:Ae,dischargePreBuffer:Ye,getBuffer:ut,getBufferLevel:Ie,getRangeAt:Xe,hasBufferAtTime:Ne,pruneBuffer:De,setMediaSource:ve,getMediaSource:we,appendInitSegmentFromCache:Se,getIsBufferingCompleted:ze,setIsBufferingCompleted:Et,getIsPruningInProgress:xt,reset:yt,prepareForPlaybackSeek:Ge,prepareForReplacementTrackSwitch:tt,prepareForNonReplacementTrackSwitch:ct,prepareForReplacementQualitySwitch:ot,updateAppendWindow:Kt,getAllRangesWithSafetyFactor:Pt,getContinuousBufferTimeForTargetTime:Rt,clearBuffers:Ze,pruneAllSafely:ht,updateBufferTimestampOffset:Mt,setSeekTarget:Wt,segmentRequestingCompleted:jt},G(),ne}D.__dashjs_factory_name=I;const y=T.default.getClassFactory(D)},"./src/streaming/controllers/CatchupController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>P});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js"),l=r("./src/core/EventBus.js"),c=r("./src/streaming/constants/Constants.js"),E=r("./src/streaming/MediaPlayerEvents.js"),m=r("./src/core/events/Events.js"),f=r("./src/streaming/constants/MetricsConstants.js"),T=r("./src/core/Utils.js");function L(){var O=this.context,M=(0,l.default)(O).getInstance(),S,p,h,C,v,I,D,y,A,x;function F(){W(),Z()}function k(q){q&&(q.settings&&(v=q.settings),q.videoModel&&(C=q.videoModel),q.streamController&&(I=q.streamController),q.playbackController&&(D=q.playbackController),q.mediaPlayerModel&&(y=q.mediaPlayerModel))}function W(){M.on(E.default.BUFFER_LEVEL_UPDATED,re,S),M.on(E.default.BUFFER_LEVEL_STATE_CHANGED,ie,S),M.on(E.default.PLAYBACK_PROGRESS,ne,S),M.on(E.default.PLAYBACK_TIME_UPDATED,ne,S),M.on(E.default.PLAYBACK_SEEKED,Y,S),M.on(m.default.SETTING_UPDATED_CATCHUP_ENABLED,ee,S),M.on(m.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,Z,S),M.on(m.default.SETTING_UPDATED_PLAYBACK_RATE_MAX,Z,S),M.on(E.default.STREAM_INITIALIZED,Z,S)}function V(){M.off(E.default.BUFFER_LEVEL_UPDATED,re,S),M.off(E.default.BUFFER_LEVEL_STATE_CHANGED,ie,S),M.off(E.default.PLAYBACK_PROGRESS,ne,S),M.off(E.default.PLAYBACK_TIME_UPDATED,ne,S),M.off(E.default.PLAYBACK_SEEKED,ne,S),M.off(m.default.SETTING_UPDATED_CATCHUP_ENABLED,ee,S),M.off(m.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,Z,S),M.off(m.default.SETTING_UPDATED_PLAYBACK_RATE_MAX,Z,S),M.off(E.default.STREAM_INITIALIZED,Z,S)}function Q(){x=(0,o.default)(O).getInstance().getLogger(S),K()}function $(){V(),K(),C.setPlaybackRate(1,!0)}function K(){p=!1;var q=T.default.parseUserAgent();h=q&&q.browser&&q.browser.name&&q.browser.name.toLowerCase()==="safari"}function Y(){p=!1}function re(q){if(!(q.streamId!==I.getActiveStreamInfo().id||!A)){var le=D.getLiveDelay(),te=D.getBufferLevel();te>le/2&&(A=!1)}}function ie(q){q.streamId===I.getActiveStreamInfo().id&&(A=q.state===f.default.BUFFER_EMPTY)}function ee(){y.getCatchupModeEnabled()||C.setPlaybackRate(1)}function ne(){D.getIsDynamic()&&y.getCatchupModeEnabled()&&(y.getCatchupPlaybackRates().max>0||y.getCatchupPlaybackRates().min<0)&&!D.isPaused()&&!D.isSeeking()&&X()&&ae()}function ae(){if(!p&&C){var q,le=C.getPlaybackRate(),te=y.getCatchupPlaybackRates(),N=D.getBufferLevel(),R=ce(),w=y.getCatchupMaxDrift();if(!isNaN(w)&&w>0&&R>w)x.info("[CatchupController]: Low Latency catchup mechanism. Latency too high, doing a seek to live point"),p=!0,D.seekToCurrentLive(!0,!1);else{var j=D.getCurrentLiveLatency(),H=D.getLiveDelay();if(oe()===c.default.LIVE_CATCHUP_MODE_LOLP){var U=v.get().streaming.liveCatchup.playbackBufferMin;q=se(te,j,H,U,N)}else q=he(te,j,H,N);var B=h?.25:.02/(.5/te.max);q&&Math.abs(le-q)>=B&&(x.debug("[CatchupController]: Setting playback rate to ".concat(q)),C.setPlaybackRate(q))}}}function ce(){var q=D.getCurrentLiveLatency(),le=D.getLiveDelay();return q-le}function X(){try{if(!D.getTime()>0||p)return!1;var q=oe();if(q===c.default.LIVE_CATCHUP_MODE_LOLP){var le=D.getBufferLevel(),te=v.get().streaming.liveCatchup.playbackBufferMin;return _e(le,te)}else return ge()}catch{return!1}}function oe(){var q=v.get().streaming.liveCatchup.playbackBufferMin;return v.get().streaming.liveCatchup.mode===c.default.LIVE_CATCHUP_MODE_LOLP&&q!==null&&!isNaN(q)?c.default.LIVE_CATCHUP_MODE_LOLP:c.default.LIVE_CATCHUP_MODE_DEFAULT}function ge(){try{var q=Math.abs(ce());return q>0}catch{return!1}}function _e(q,le){try{var te=Math.abs(ce());return te>0||q<le}catch{return!1}}function he(q,le,te,N){if(A)return 1;var R=le-te,w=R<0?Math.abs(q.min):q.max,j=R*5,H=w*2/(1+Math.pow(Math.E,-j)),U=1-w+H;return D.getPlaybackStalled()&&N<=te/2&&R>0&&(U=1),U}function se(q,le,te,N,R){var w;if(R<N){var j=Math.abs(q.min),H=R-N,U=H*5,B=j*2/(1+Math.pow(Math.E,-U));w=1-j+B,x.debug("[LoL+ playback control_buffer-based] bufferLevel: "+R+", newRate: "+w)}else{var G=q.max,z=.02;if(Math.abs(le-te)<=z*te)w=1;else{var fe=le-te,ue=fe*5,J=G*2/(1+Math.pow(Math.E,-ue));w=1-G+J}x.debug("[LoL+ playback control_latency-based] latency: "+le+", newRate: "+w)}return w}function Z(){y.getCatchupPlaybackRates(!0)}return S={reset:$,setConfig:k,initialize:F},Q(),S}L.__dashjs_factory_name="CatchupController";const P=d.default.getSingletonFactory(L)},"./src/streaming/controllers/EventController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>f});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js"),l=r("./src/core/EventBus.js"),c=r("./src/streaming/MediaPlayerEvents.js"),E=r("./src/streaming/net/XHRLoader.js");function m(){var T="urn:mpeg:dash:event:2012",L=1,P="urn:mpeg:dash:event:callback:2015",O=1,M=300,S={DISCARDED:"discarded",UPDATED:"updated",ADDED:"added"},p=this.context,h=(0,l.default)(p).getInstance(),C,v,I,D,y,A,x,F,k,W,V;function Q(){v=(0,o.default)(p).getInstance().getLogger(C),K()}function $(){if(!x||!F)throw new Error("setConfig function has to be called previously")}function K(){V=!1,I={},D={},y=null,W=!1,A=Date.now()/1e3}function Y(){try{y!==null&&V&&(clearInterval(y),y=null,V=!1,ge())}catch(U){throw U}}function re(){try{$(),v.debug("Start Event Controller");var U=k.get().streaming.eventControllerRefreshDelay;!V&&!isNaN(U)&&(V=!0,y=setInterval(ie,U))}catch(B){throw B}}function ie(){try{if(!W){W=!0;var U=F.getTime(),B=U-A;B=A>0?Math.max(0,B):0,ee(D,B,U),ee(I,B,U),ne(D),ne(I),A=U,W=!1}}catch(G){W=!1,v.error(G)}}function ee(U,B,G){try{var z=function(ue){if(ue!==void 0){var J=isNaN(ue.duration)?0:ue.duration;ue.calculatedPresentationTime<=G&&ue.calculatedPresentationTime+B+J>=G?q(ue,c.default.EVENT_MODE_ON_START):(se(G,J+B,ue.calculatedPresentationTime)||Z(ue))&&(v.debug("Removing event ".concat(ue.id," from period ").concat(ue.eventStream.period.id," as it is expired or invalid")),le(U,ue))}};he(U,z)}catch(fe){v.error(fe)}}function ne(U){try{for(var B in U)U.hasOwnProperty(B)&&Object.keys(U[B]).length===0&&delete U[B]}catch(G){v.error(G)}}function ae(U,B){try{if($(),I[B]||(I[B]={}),U)for(var G=0;G<U.length;G++){var z=U[G],fe=F.getTime(),ue=isNaN(z.duration)?0:z.duration;if(!se(fe,ue,z.calculatedPresentationTime)){var J=X(z,I[B],!0);J===S.ADDED?(v.debug("Added inline event with id ".concat(z.id," from period ").concat(B)),q(z,c.default.EVENT_MODE_ON_RECEIVE)):J===S.UPDATED&&v.debug("Updated inline event with id ".concat(z.id," from period ").concat(B))}}}catch(ve){throw ve}}function ce(U,B){try{$(),D[B]||(D[B]={});for(var G=0;G<U.length;G++){var z=U[G],fe=F.getTime(),ue=isNaN(z.duration)?0:z.duration;if(!se(fe,ue,z.calculatedPresentationTime)){var J=X(z,D[B],!1);J===S.ADDED?(z.eventStream.schemeIdUri===T&&oe(z),v.debug("Added inband event with id ".concat(z.id," from period ").concat(B)),q(z,c.default.EVENT_MODE_ON_RECEIVE)):v.debug("Inband event with scheme_id_uri ".concat(z.eventStream.schemeIdUri,", value ").concat(z.eventStream.value,", period id ").concat(B," and event id ").concat(z.id," was ignored because it has been added before."))}}ie()}catch(ve){throw ve}}function X(U,B){var G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,z=U.eventStream.schemeIdUri,fe=U.eventStream.value,ue=U.id,J=S.DISCARDED;B[z]||(B[z]=[]);var ve=B[z].findIndex(function(Ae){return(!fe||Ae.eventStream.value&&Ae.eventStream.value===fe)&&Ae.id===ue});if(ve===-1)B[z].push(U),U.triggeredReceivedEvent=!1,U.triggeredStartEvent=!1,J=S.ADDED;else if(G){var me=B[z][ve];U.triggeredReceivedEvent=me.triggeredReceivedEvent,U.triggeredStartEvent=me.triggeredStartEvent,B[z][ve]=U,J=S.UPDATED}return J}function oe(U){try{if(U.eventStream.value==L){var B=U.calculatedPresentationTime,G;U.calculatedPresentationTime==4294967295?G=NaN:G=U.calculatedPresentationTime+U.duration,h.trigger(c.default.MANIFEST_VALIDITY_CHANGED,{id:U.id,validUntil:B,newDuration:G,newManifestValidAfter:NaN},{mode:c.default.EVENT_MODE_ON_START})}}catch(z){v.error(z)}}function ge(){try{_e(D),_e(I)}catch(U){v.error(U)}}function _e(U){try{var B=F.getTime(),G=function(fe){var ue=fe.eventStream&&fe.eventStream.period&&!isNaN(fe.eventStream.period.duration)?fe.eventStream.period.duration:NaN,J=fe.eventStream&&fe.eventStream.period&&!isNaN(fe.eventStream.period.start)?fe.eventStream.period.start:NaN;if(!(isNaN(ue)||isNaN(J))){var ve=fe.calculatedPresentationTime;Math.abs(ve-B)<M&&q(fe,c.default.EVENT_MODE_ON_START)}};he(U,G)}catch(z){v.error(z)}}function he(U,B){try{if(U)for(var G=Object.keys(U),z=0;z<G.length;z++)for(var fe=U[G[z]],ue=Object.keys(fe),J=0;J<ue.length;J++){var ve=fe[ue[J]];ve.forEach(function(me){me!==void 0&&B(me)})}}catch(me){v.error(me)}}function se(U,B,G){try{return U-B>G}catch(z){return v.error(z),!1}}function Z(U){try{var B=U.eventStream.period.start+U.eventStream.period.duration;return U.calculatedPresentationTime>B}catch(G){return v.error(G),!1}}function q(U,B){try{var G=F.getTime(),z=U.id;if(B===c.default.EVENT_MODE_ON_RECEIVE&&!U.triggeredReceivedEvent){v.debug("Received event ".concat(z)),U.triggeredReceivedEvent=!0,h.trigger(U.eventStream.schemeIdUri,{event:U},{mode:B});return}U.triggeredStartEvent||(U.eventStream.schemeIdUri===T&&U.eventStream.value==L?(U.duration!==0||U.presentationTimeDelta!==0)&&(v.debug("Starting manifest refresh event ".concat(z," at ").concat(G)),te()):U.eventStream.schemeIdUri===P&&U.eventStream.value==O?(v.debug("Starting callback event ".concat(z," at ").concat(G)),N(U.messageData)):(v.debug("Starting event ".concat(z," from period ").concat(U.eventStream.period.id," at ").concat(G)),h.trigger(U.eventStream.schemeIdUri,{event:U},{mode:B})),U.triggeredStartEvent=!0)}catch(fe){v.error(fe)}}function le(U,B){try{var G=B.eventStream.schemeIdUri,z=B.eventStream.period.id,fe=B.eventStream.value,ue=B.id;U[z][G]=U[z][G].filter(function(J){return fe&&J.eventStream.value&&J.eventStream.value!==fe||J.id!==ue}),U[z][G].length===0&&delete U[z][G]}catch(J){v.error(J)}}function te(){try{$(),x.refreshManifest()}catch(U){v.error(U)}}function N(U){try{var B=(0,E.default)(p).create({});B.load({method:"get",url:U,request:{responseType:"arraybuffer"}})}catch(G){v.error(G)}}function R(U){try{if(!U)return;U.manifestUpdater&&(x=U.manifestUpdater),U.playbackController&&(F=U.playbackController),U.settings&&(k=U.settings)}catch(B){throw B}}function w(){return I}function j(){return D}function H(){Y(),K()}return C={addInlineEvents:ae,addInbandEvents:ce,getInbandEvents:j,getInlineEvents:w,start:re,setConfig:R,reset:H},Q(),C}m.__dashjs_factory_name="EventController";const f=d.default.getSingletonFactory(m)},"./src/streaming/controllers/FragmentController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>p});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/streaming/vo/DataChunk.js"),l=r("./src/streaming/models/FragmentModel.js"),c=r("./src/streaming/FragmentLoader.js"),E=r("./src/streaming/utils/RequestModifier.js"),m=r("./src/core/EventBus.js"),f=r("./src/core/events/Events.js"),T=r("./src/streaming/MediaPlayerEvents.js"),L=r("./src/core/errors/Errors.js"),P=r("./src/core/FactoryMaker.js"),O=r("./src/core/Debug.js"),M=r("./src/streaming/utils/SegmentResponseModifier.js");function S(h){h=h||{};var C=this.context,v=(0,m.default)(C).getInstance(),I=h.errHandler,D=h.mediaPlayerModel,y=h.dashMetrics,A=(0,O.default)(C).getInstance(),x=(0,M.default)(C).getInstance(),F=h.streamInfo,k,W,V;function Q(){W=A.getLogger(k),Y(),v.on(T.default.FRAGMENT_LOADING_COMPLETED,ee,k),v.on(T.default.FRAGMENT_LOADING_PROGRESS,ee,k)}function $(){return F.id}function K(ne){var ae=V[ne];return ae||(ae=(0,l.default)(C).create({streamInfo:F,type:ne,dashMetrics:y,fragmentLoader:(0,c.default)(C).create({dashMetrics:y,mediaPlayerModel:D,errHandler:I,requestModifier:(0,E.default)(C).getInstance(),settings:h.settings,boxParser:h.boxParser,eventBus:v,events:f.default,errors:L.default,dashConstants:h.dashConstants,urlUtils:h.urlUtils,streamId:$()}),debug:A,eventBus:v,events:f.default}),V[ne]=ae),ae}function Y(){for(var ne in V)V[ne].reset();V={}}function re(){v.off(T.default.FRAGMENT_LOADING_COMPLETED,ee,this),v.off(T.default.FRAGMENT_LOADING_PROGRESS,ee,this),Y()}function ie(ne,ae,ce,X){var oe=new o.default;return oe.streamId=ce,oe.mediaInfo=ae.mediaInfo,oe.segmentType=ae.type,oe.start=ae.startTime,oe.duration=ae.duration,oe.end=oe.start+oe.duration,oe.bytes=ne,oe.index=ae.index,oe.quality=ae.quality,oe.representationId=ae.representationId,oe.endFragment=X,oe}function ee(ne){if(ne.sender){var ae=ne.request,ce=ne.response,X=ae.isInitializationRequest(),oe=ae.mediaInfo.streamInfo;if(ne.error&&(ae.mediaType===d.default.AUDIO||ae.mediaType===d.default.VIDEO||ae.mediaType===d.default.TEXT&&ae.mediaInfo.isFragmented)&&v.trigger(f.default.SERVICE_LOCATION_BLACKLIST_ADD,{entry:ne.request.serviceLocation}),!ce||!oe){W.warn("No "+ae.mediaType+" bytes to push or stream is inactive.");return}var ge=ie(ce,ae,F.id,ne.type!==f.default.FRAGMENT_LOADING_PROGRESS);x.modifyResponseAsync(ge).then(function(_e){v.trigger(X?f.default.INIT_FRAGMENT_LOADED:f.default.MEDIA_FRAGMENT_LOADED,{chunk:_e,request:ae},{streamId:oe.id,mediaType:ae.mediaType})}).catch(function(_e){W.error(_e),v.trigger(X?f.default.INIT_FRAGMENT_LOADED:f.default.MEDIA_FRAGMENT_LOADED,{chunk:ge,request:ae},{streamId:oe.id,mediaType:ae.mediaType})})}}return k={getStreamId:$,getModel:K,reset:re},Q(),k}S.__dashjs_factory_name="FragmentController";const p=P.default.getClassFactory(S)},"./src/streaming/controllers/GapController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>P});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js"),l=r("./src/core/events/Events.js"),c=r("./src/core/EventBus.js"),E=r("./src/streaming/constants/Constants.js"),m=100,f=10,T=.1;function L(){var O=this.context,M=(0,c.default)(O).getInstance(),S,p,h,C,v,I,D,y,A,x,F,k;function W(){Y()}function V(){k=(0,o.default)(O).getInstance().getLogger(S),Q()}function Q(){se(),re(),$()}function $(){v=null,I=NaN,C=0,x=null,F={}}function K(q){q&&(q.settings&&(h=q.settings),q.playbackController&&(D=q.playbackController),q.streamController&&(y=q.streamController),q.videoModel&&(A=q.videoModel))}function Y(){M.on(l.default.WALLCLOCK_TIME_UPDATED,ce,this),M.on(l.default.INITIAL_STREAM_SWITCH,ae,this),M.on(l.default.PLAYBACK_SEEKING,ie,this),M.on(l.default.BUFFER_REPLACEMENT_STARTED,ee,S),M.on(l.default.TRACK_CHANGE_RENDERED,ne,S)}function re(){M.off(l.default.WALLCLOCK_TIME_UPDATED,ce,this),M.off(l.default.INITIAL_STREAM_SWITCH,ae,this),M.off(l.default.PLAYBACK_SEEKING,ie,this),M.off(l.default.BUFFER_REPLACEMENT_STARTED,ee,S),M.off(l.default.TRACK_CHANGE_RENDERED,ne,S)}function ie(){x&&(clearTimeout(x),x=null)}function ee(q){try{if(q.streamId!==y.getActiveStreamInfo().id||q.mediaType!==E.default.VIDEO&&q.mediaType!==E.default.AUDIO)return;q.streamId===y.getActiveStreamInfo().id&&(F[q.mediaType]=!0)}catch(le){k.error(le)}}function ne(q){!q||!q.mediaType||(F[q.mediaType]=!1)}function ae(){v||he()}function ce(){if(X(h.get().streaming.gaps.enableSeekFix)&&(C++,C>=f)){var q=D.getTime();p===q?Z(q,!0):(p=q,I=NaN),C=0}}function X(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!y.getActiveStream())return!1;var le=Object.keys(F).some(function(N){return F[N]}),te=q?oe():!1;return!le&&h.get().streaming.gaps.jumpGaps&&y.getActiveStreamProcessors().length>0&&(!D.isSeeking()||te)&&!D.isPaused()&&!y.getIsStreamSwitchInProgress()&&!y.getHasMediaOrInitialisationError()}function oe(){var q=y.getActiveStream(),le=parseFloat((q.getStartTime()+q.getDuration()).toFixed(5));return D.getTime()+h.get().streaming.gaps.threshold>=le}function ge(q,le){try{if(!q||q.length<=1&&le>0)return NaN;for(var te=NaN,N=0;isNaN(te)&&N<q.length;){var R=N>0?q.end(N-1):0;le<q.start(N)&&R-le<h.get().streaming.gaps.threshold&&(te=N),N+=1}return te}catch{return null}}function _e(q,le){for(var te=0,N=q.length;te<N;te++)if(le>=q.start(te)&&le<=q.end(te))return!0;return!1}function he(){try{v||(k.debug("Starting the gap controller"),v=setInterval(function(){if(X()){var q=D.getTime();Z(q)}},m))}catch{}}function se(){k.debug("Stopping the gap controller"),v&&(clearInterval(v),v=null)}function Z(q){var le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,te=h.get().streaming.gaps.enableStallFix,N=h.get().streaming.gaps.stallSeek,R=h.get().streaming.gaps.smallGapLimit,w=h.get().streaming.gaps.jumpLargeGaps,j=A.getBufferRange(),H,U=NaN,B=!1;if(H=ge(j,q),!isNaN(H)){var G=j.start(H),z=G-q;z>0&&(z<=R||w)&&(U=G)}var fe=D.getTimeToStreamEnd();if(isNaN(U)&&le&&isFinite(fe)&&!isNaN(fe)&&fe<R&&(U=parseFloat(D.getStreamEndTime().toFixed(5)),B=!0),te&&isNaN(U)&&le&&isNaN(H)&&_e(j,q)&&(N===0?(k.warn("Toggle play pause to break stall"),A.pause(),A.play()):(k.warn("Jumping ".concat(N,"s to break stall")),U=q+N)),U>0&&I!==U&&U>q&&!x){var ue=U-q;if(B){var J=y.getStreamForTime(U),ve=J&&!!J.getPreloaded();k.warn("Jumping to end of stream because of gap from ".concat(q," to ").concat(U,". Gap duration: ").concat(ue)),D.seek(U,!0,ve)}else{var me=D.getIsDynamic(),Ae=H>0?j.end(H-1):q,be=me?Math.max(0,ue-T)*1e3:0;x=window.setTimeout(function(){D.seek(U,!0,!0),k.warn("Jumping gap occuring in period ".concat(y.getActiveStream().getStreamId()," starting at ").concat(Ae," and ending at ").concat(U,". Jumping by: ").concat(U-Ae)),x=null},be)}I=U}}return S={reset:Q,setConfig:K,initialize:W},V(),S}L.__dashjs_factory_name="GapController";const P=d.default.getSingletonFactory(L)},"./src/streaming/controllers/MediaController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>O});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/core/events/Events.js"),l=r("./src/core/EventBus.js"),c=r("./src/core/FactoryMaker.js"),E=r("./src/core/Debug.js"),m=r("./node_modules/bcp-47-normalize/index.js"),f=r.n(m),T=r("./node_modules/bcp-47-match/index.js");function L(){var M=this.context,S=(0,l.default)(M).getInstance(),p,h,C,v,I,D,y,A;function x(){h=(0,E.default)(M).getInstance().getLogger(p),ae()}function F(ue,J){var ve=D[ue]||Y(ue),me=W(ue,J.id),Ae=[];ve||(ve=A.getSavedMediaSettings(ue),K(ue,ve)),!(!me||me.length===0)&&(ve&&(Ae=Array.from(me),Ae=X(Ae,oe,ve),Ae=X(Ae,ge,ve),Ae=X(Ae,_e,ve),ue===d.default.AUDIO&&D[ue]||(Ae=X(Ae,he,ve)),Ae=X(Ae,se,ve),Ae=X(Ae,Z,ve)),Ae.length===0?$(j(ue,me),!0):Ae.length>1?$(j(ue,Ae,!!D[ue])):$(Ae[0]))}function k(ue){if(ue){var J=ue.type;if(ie(J)){var ve=ue.streamInfo.id;C[ve]||(C[ve]=fe());for(var me=C[ve][J].list,Ae=0,be=me.length;Ae<be;++Ae)if(ee(me[Ae],ue))return;me.push(ue)}}}function W(ue,J){return ue?!C[J]||!C[J][ue]?[]:C[J][ue].list:[]}function V(ue,J){return!ue||!C[J]||!C[J][ue]?null:C[J][ue].current}function Q(ue){if(!ue)return!1;var J=ue.type,ve=ue.streamInfo.id;return C[ve]&&C[ve][J]&&ee(C[ve][J].current,ue)}function $(ue){var J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!ue||!ue.streamInfo)){var ve=ue.type,me=ue.streamInfo,Ae=me.id,be=V(ve,Ae);if(!(!C[Ae]||!C[Ae][ve])&&(C[Ae][ve].current=ue,C[Ae][ve].current&&(ve!==d.default.TEXT&&!ee(ue,be)||ve===d.default.TEXT&&ue.isFragmented)&&S.trigger(o.default.CURRENT_TRACK_CHANGED,{oldMediaInfo:be,newMediaInfo:ue,switchMode:v.get().streaming.trackSwitchMode[ve]},{streamId:Ae}),!J)){var Be=ce(ue);if(!Be||!C[Ae][ve].storeLastSettings)return;Be.roles&&(Be.role=Be.roles[0],delete Be.roles),Be.accessibility&&(Be.accessibility=Be.accessibility[0]),Be.audioChannelConfiguration&&(Be.audioChannelConfiguration=Be.audioChannelConfiguration[0]),D[ve]=Be,A.setSavedMediaSettings(ve,Be)}}}function K(ue,J){!ue||!J||(I[ue]=J)}function Y(ue){return ue?I[ue]:null}function re(){A.setSavedMediaSettings(d.default.TEXT,null)}function ie(ue){return ue===d.default.AUDIO||ue===d.default.VIDEO||ue===d.default.TEXT||ue===d.default.IMAGE}function ee(ue,J){if(!ue&&!J)return!0;if(!ue||!J)return!1;var ve=ue.id===J.id,me=ue.viewpoint===J.viewpoint,Ae=ue.lang===J.lang,be=ue.codec===J.codec,Be=ue.roles.toString()===J.roles.toString(),ke=ue.accessibility.toString()===J.accessibility.toString(),Ye=ue.audioChannelConfiguration.toString()===J.audioChannelConfiguration.toString();return ve&&be&&me&&Ae&&Be&&ke&&Ye}function ne(ue){ue&&(ue.domStorage&&(A=ue.domStorage),ue.settings&&(v=ue.settings),ue.customParametersModel&&(y=ue.customParametersModel))}function ae(){C={},D={},le()}function ce(ue){var J={lang:ue.lang,viewpoint:ue.viewpoint,roles:ue.roles,accessibility:ue.accessibility,audioChannelConfiguration:ue.audioChannelConfiguration},ve=J.lang||J.viewpoint||J.role&&J.role.length>0||J.accessibility&&J.accessibility.length>0||J.audioChannelConfiguration&&J.audioChannelConfiguration.length>0;return ve?J:null}function X(ue,J,ve){var me=[];return ue.forEach(function(Ae){J(ve,Ae)&&me.push(Ae)}),me.length!==0?me:ue}function oe(ue,J){return!ue.lang||ue.lang instanceof RegExp?J.lang.match(ue.lang):J.lang!==""?(0,T.extendedFilter)(J.lang,f()(ue.lang)).length>0:!1}function ge(ue,J){return ue.index===void 0||ue.index===null||J.index===ue.index}function _e(ue,J){return!ue.viewpoint||ue.viewpoint===J.viewpoint}function he(ue,J){var ve=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,me=!ue.role||!!J.roles.filter(function(Ae){return Ae===ue.role})[0];return me||J.type===d.default.AUDIO&&ve}function se(ue,J){var ve;return ue.accessibility?ve=!!J.accessibility.filter(function(me){return me===ue.accessibility})[0]:ve=!J.accessibility.length,ve}function Z(ue,J){var ve=!ue.audioChannelConfiguration||!!J.audioChannelConfiguration.filter(function(me){return me===ue.audioChannelConfiguration})[0];return ve}function q(ue,J){var ve=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;try{var me=!1;if(!ue.lang)me=!0;else if(ue.lang instanceof RegExp)me=J.lang.match(ue.lang);else if(J.lang!==""){var Ae=f()(ue.lang);Ae&&(me=(0,T.extendedFilter)(J.lang,Ae).length>0)}var be=ue.index===void 0||ue.index===null||J.index===ue.index,Be=!ue.viewpoint||ue.viewpoint===J.viewpoint,ke=!ue.role||!!J.roles.filter(function(Se){return Se===ue.role})[0],Ye=!ue.accessibility||!!J.accessibility.filter(function(Se){return Se===ue.accessibility})[0],Oe=!ue.audioChannelConfiguration||!!J.audioChannelConfiguration.filter(function(Se){return Se===ue.audioChannelConfiguration})[0];return me&&be&&Be&&(ke||J.type===d.default.AUDIO&&ve)&&Ye&&Oe}catch{return!1}}function le(){I={audio:null,video:null,text:null}}function te(ue){var J=0,ve=[];return ue.forEach(function(me){isNaN(me.selectionPriority)||(me.selectionPriority>J?(J=me.selectionPriority,ve=[me]):me.selectionPriority===J&&ve.push(me))}),ve}function N(ue){var J=0,ve=[],me;return ue.forEach(function(Ae){me=Math.max.apply(Math,Ae.bitrateList.map(function(be){return be.bandwidth})),me>J?(J=me,ve=[Ae]):me===J&&ve.push(Ae)}),ve}function R(ue){var J=1/0,ve=[],me;return ue.forEach(function(Ae){var be=Ae.bitrateList.reduce(function(Be,ke){var Ye=Math.max(1,ke.width*ke.height),Oe=ke.bandwidth/Ye;return Be+Oe},0);me=be/Ae.bitrateList.length,me<J?(J=me,ve=[Ae]):me===J&&ve.push(Ae)}),ve}function w(ue){var J=0,ve=[],me;return ue.forEach(function(Ae){me=Ae.representationCount,me>J?(J=me,ve=[Ae]):me===J&&ve.push(Ae)}),ve}function j(ue,J){if(ue===d.default.TEXT)return J[0];var ve=v.get().streaming.selectionModeForInitialTrack,me,Ae=y.getCustomInitialTrackSelectionFunction();if(Ae&&typeof Ae=="function")me=Ae(J);else switch(ve){case d.default.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY:me=H(J);break;case d.default.TRACK_SELECTION_MODE_HIGHEST_BITRATE:me=U(J);break;case d.default.TRACK_SELECTION_MODE_FIRST_TRACK:me=B(J);break;case d.default.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:me=G(J);break;case d.default.TRACK_SELECTION_MODE_WIDEST_RANGE:me=z(J);break;default:h.warn("Track selection mode ".concat(ve," is not supported. Falling back to TRACK_SELECTION_MODE_FIRST_TRACK")),me=B(J);break}return me.length>0?me[0]:J[0]}function H(ue){var J=te(ue);return J.length>1&&(J=N(J)),J.length>1&&(J=w(J)),J}function U(ue){var J=N(ue);return J.length>1&&(J=w(J)),J}function B(ue){return ue[0]}function G(ue){var J=R(ue);return J.length>1&&(J=N(J)),J}function z(ue){var J=w(ue);return J.length>1&&(J=N(ue)),J}function fe(){return{audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},image:{list:[],storeLastSettings:!0,current:null}}}return p={setInitialMediaSettingsForType:F,addTrack:k,getTracksFor:W,getCurrentTrackFor:V,isCurrentTrack:Q,setTrack:$,selectInitialTrack:j,setInitialSettings:K,getInitialSettings:Y,getTracksWithHighestBitrate:N,getTracksWithHighestEfficiency:R,getTracksWithWidestRange:w,isTracksEqual:ee,matchSettings:q,matchSettingsLang:oe,matchSettingsIndex:ge,matchSettingsViewPoint:_e,matchSettingsRole:he,matchSettingsAccessibility:se,matchSettingsAudioChannelConfig:Z,saveTextSettingsDisabled:re,setConfig:ne,reset:ae},x(),p}L.__dashjs_factory_name="MediaController";var P=c.default.getSingletonFactory(L);c.default.updateSingletonFactory(L.__dashjs_factory_name,P);const O=P},"./src/streaming/controllers/MediaSourceController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js");function l(){var E,m,f,T=this.context;function L(){f=(0,o.default)(T).getInstance().getLogger(E)}function P(){var v="WebKitMediaSource"in window,I="MediaSource"in window;return I?m=new MediaSource:v&&(m=new WebKitMediaSource),m}function O(v){var I=window.URL.createObjectURL(m);return v.setSource(I),I}function M(v){v.setSource(null)}function S(v){!m||m.readyState!=="open"||v===null&&isNaN(v)||m.duration!==v&&(C(m)?setTimeout(S.bind(null,v),50):(f.info("Set MediaSource duration:"+v),m.duration=v))}function p(v,I){m&&typeof m.setLiveSeekableRange=="function"&&typeof m.clearLiveSeekableRange=="function"&&m.readyState==="open"&&v>=0&&v<I&&(m.clearLiveSeekableRange(),m.setLiveSeekableRange(v,I))}function h(v){if(!(!v||v.readyState!=="open")){for(var I=v.sourceBuffers,D=0;D<I.length;D++)if(I[D].updating||I[D].buffered.length===0)return;f.info("call to mediaSource endOfStream"),v.endOfStream()}}function C(v){for(var I=v.sourceBuffers,D=0;D<I.length;D++)if(I[D].updating)return!0;return!1}return E={createMediaSource:P,attachMediaSource:O,detachMediaSource:M,setDuration:S,setSeekable:p,signalEndOfStream:h},L(),E}l.__dashjs_factory_name="MediaSourceController";const c=d.default.getSingletonFactory(l)},"./src/streaming/controllers/PlaybackController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>P});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),c=r("./src/core/FactoryMaker.js"),E=r("./src/core/Debug.js"),m=r("./src/streaming/MediaPlayerEvents.js"),f=r("./src/streaming/constants/MetricsConstants.js"),T=500;function L(){var O=this.context,M=(0,o.default)(O).getInstance(),S,p,h,C,v,I,D,y,A,x,F,k,W,V,Q,$,K,Y,re,ie,ee,ne,ae,ce;function X(){p=(0,E.default)(O).getInstance().getLogger(S),oe()}function oe(){le(),V=!1,x=0,F=0,$=0,ne=!1,K=!0,Y=!1,ae=!1,re=NaN,D&&(M.off(l.default.DATA_UPDATE_COMPLETED,at,S),M.off(l.default.LOADING_PROGRESS,Ze,S),M.off(l.default.MANIFEST_UPDATED,Kt,S),M.off(l.default.STREAMS_COMPOSED,jt,S),M.off(m.default.PLAYBACK_ENDED,et,S),M.off(m.default.STREAM_INITIALIZING,ft,S),M.off(m.default.REPRESENTATION_SWITCH,pt,S),M.off(m.default.BUFFER_LEVEL_STATE_CHANGED,Ge,S),it(),ut()),A=null,D=null,k=null,W=null}function ge(Ie,we){k=Ie,we!==!0&&_e()}function _e(){Ve(),W=k.manifestInfo.isDynamic,ee=!1,ie=!1,M.on(l.default.DATA_UPDATE_COMPLETED,at,S),M.on(l.default.LOADING_PROGRESS,Ze,S),M.on(l.default.MANIFEST_UPDATED,Kt,S),M.on(l.default.STREAMS_COMPOSED,jt,S),M.on(m.default.PLAYBACK_ENDED,et,S,{priority:o.default.EVENT_PRIORITY_HIGH}),M.on(m.default.STREAM_INITIALIZING,ft,S),M.on(m.default.REPRESENTATION_SWITCH,pt,S),M.on(m.default.BUFFER_LEVEL_STATE_CHANGED,Ge,S),V&&(V=!1,q())}function he(){return ee}function se(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return parseFloat((Z(Ie)-H()).toFixed(5))}function Z(Ie){var we=Ie||k;return we.start+we.duration}function q(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;k&&D&&D.getElement()?(Ie&&W&&j(H()),D.play()):V=!0}function le(){k&&D&&D.pause()}function te(Ie){var we=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,Et=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!(!k||!D)){var xt=isNaN(re)?D.getTime():re;Ie!==xt&&(ie=ze===!0,ie||(re=Ie),p.info("Requesting seek to time: "+Ie+(ie?" (internal)":"")),W&&Et&&j(Ie),D.setCurrentTime(Ie,we))}}function N(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,we=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,Et=w();if(Et!==0){x=F;var xt=Et-x;te(xt,Ie,we,ze)}}function R(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,we=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,ze=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,Et=w();if(Et!==0){var xt=Et-x;te(xt,Ie,we,ze)}}function w(){if(!(!k||!D||!W)){var Ie=h&&h.hasVideoTrack()?d.default.VIDEO:d.default.AUDIO,we=v.getCurrentDVRInfo(Ie);return we&&we.range?we.range.end:0}}function j(Ie){var we=new Date(y.getClientReferenceTime()),ze=I.getRegularPeriods()[0],Et=y.calcPresentationTimeFromWallTime(we,ze);x=Et-Ie}function H(){return k&&D?D.getTime():null}function U(){return k&&D?D.isPaused():null}function B(){return k&&D?D.isSeeking():null}function G(){return k&&D?D.isStalled():null}function z(){return k&&D?D.getPlaybackRate():null}function fe(){return k&&D?D.getPlayedRanges():null}function ue(){return k&&D?D.getEnded():null}function J(){return W}function ve(){return h}function me(){return ne}function Ae(){return $}function be(){return x}function Be(){return F}function ke(){if(!W||isNaN($))return NaN;var Ie=H();if(isNaN(Ie)||Ie===0)return 0;var we=new Date().getTime()+y.getClientTimeOffset()*1e3;return Math.max(((we-$-Ie*1e3)/1e3).toFixed(3),0)}function Ye(Ie,we){var ze,Et,xt,Dt=4,Rt=4,Qt=!isNaN(Ie)&&isFinite(Ie)?Ie:NaN,Wt=I.getSuggestedPresentationDelay(),Je=C.getServiceDescriptionSettings();return isNaN(ce.get().streaming.delay.liveDelay)?ce.get().streaming.delay.liveDelayFragmentCount!==null&&!isNaN(ce.get().streaming.delay.liveDelayFragmentCount)&&!isNaN(Qt)?ze=Qt*ce.get().streaming.delay.liveDelayFragmentCount:Je&&!isNaN(Je.liveDelay)&&Je.liveDelay>0?ze=Je.liveDelay:ce.get().streaming.delay.useSuggestedPresentationDelay===!0&&Wt!==null&&!isNaN(Wt)&&Wt>0?ze=Wt:isNaN(Qt)?ze=we&&!isNaN(we.minBufferTime)?we.minBufferTime*Dt:k.manifestInfo.minBufferTime*Dt:ze=Qt*Rt:ze=ce.get().streaming.delay.liveDelay,xt=I.getAvailabilityStartTime(),xt!==null&&($=xt),we&&we.dvrWindowSize>0?Et=Math.min(ze,we.dvrWindowSize):Et=ze,x=Et,F=Et,Et}function Oe(Ie){Ie&&(Ie.streamController&&(h=Ie.streamController),Ie.serviceDescriptionController&&(C=Ie.serviceDescriptionController),Ie.dashMetrics&&(v=Ie.dashMetrics),Ie.adapter&&(I=Ie.adapter),Ie.videoModel&&(D=Ie.videoModel),Ie.timelineConverter&&(y=Ie.timelineConverter),Ie.settings&&(ce=Ie.settings))}function Se(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(!(U()||!W||D.getReadyState()===0||B()||ne)){Ie||(Ie=h.hasVideoTrack()?d.default.VIDEO:d.default.AUDIO);var we=H(),ze=Me(we,Ie),Et=!isNaN(ze)&&ze!==we;Et&&!B()&&(G()||ee||D.getReadyState()===1)&&(p.debug("UpdateCurrentTime: Seek to actual time: ".concat(ze," from currentTime: ").concat(we)),te(ze,!1,!1))}}function Me(Ie,we){var ze=v.getCurrentDVRInfo(we),Et=ze?ze.range:null,xt;return Et?(Ie>Et.end?xt=Math.max(Et.end-x,Et.start):Ie>0&&Ie+.25<Et.start&&Math.abs(Ie-Et.start)<31536e4?Y?xt=Math.max(Et.end-x,Et.start):xt=Et.start:xt=Ie,xt):NaN}function qe(){A===null&&(A=setInterval(function(){Tt()},ce.get().streaming.wallclockTimeUpdateInterval))}function it(){clearInterval(A),A=null}function at(Ie){var we=I.convertRepresentationToRepresentationInfo(Ie.currentRepresentation),ze=we?we.mediaInfo.streamInfo:null;ze===null||k.id!==ze.id||(k=ze)}function Ce(){M.trigger(l.default.CAN_PLAY)}function We(){M.trigger(l.default.CAN_PLAY_THROUGH)}function Ge(Ie){Ie.streamId===h.getActiveStreamInfo().id&&(ee=Ie.state===f.default.BUFFER_EMPTY,ce.get().streaming.buffer.setStallState&&D.setStallState(Ie.mediaType,Ie.state===f.default.BUFFER_EMPTY))}function tt(){p.info("Native video element event: play"),Se(),qe(),M.trigger(l.default.PLAYBACK_STARTED,{startTime:H()})}function ot(){p.info("Native video element event: waiting"),M.trigger(l.default.PLAYBACK_WAITING,{playingTime:H()})}function ct(){p.info("Native video element event: playing"),ie=!1,M.trigger(l.default.PLAYBACK_PLAYING,{playingTime:H()})}function ht(){p.info("Native video element event: pause"),M.trigger(l.default.PLAYBACK_PAUSED,{ended:ue()})}function Pt(){if(!ie){var Ie=H();!isNaN(re)&&re!==Ie&&(Ie=re),re=NaN,p.info("Seeking to: "+Ie),qe(),M.trigger(l.default.PLAYBACK_SEEKING,{seekTime:Ie,streamId:k.id})}}function $e(){p.info("Native video element event: seeked"),ie=!1,M.trigger(l.default.PLAYBACK_SEEKED)}function Te(){k&&M.trigger(l.default.PLAYBACK_TIME_UPDATED,{timeToEnd:se(),time:H(),streamId:k.id})}function de(){M.trigger(l.default.PLAYBACK_PROGRESS,{streamId:k.id})}function Re(){var Ie=z();p.info("Native video element event: ratechange: ",Ie),M.trigger(l.default.PLAYBACK_RATE_CHANGED,{playbackRate:Ie})}function xe(){p.info("Native video element event: loadedmetadata"),M.trigger(l.default.PLAYBACK_METADATA_LOADED),qe()}function Ne(){p.info("Native video element event: loadeddata"),M.trigger(l.default.PLAYBACK_LOADED_DATA)}function Xe(){p.info("Native video element event: ended"),le(),it();var Ie=h?h.getActiveStreamInfo():null;Ie&&M.trigger(l.default.PLAYBACK_ENDED,{isLast:Ie.isLast})}function nt(){M.trigger(l.default.PLAYBACK_VOLUME_CHANGED)}function et(Ie){if(A&&Ie.isLast){p.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");var we=Ie.seekTime?Ie.seekTime:Z();D.setCurrentTime(we),le(),it()}}function dt(Ie){var we=Ie.target||Ie.srcElement;M.trigger(l.default.PLAYBACK_ERROR,{error:we.error})}function Tt(){M.trigger(l.default.WALLCLOCK_TIME_UPDATED,{isDynamic:W,time:new Date}),J()&&(h.addDVRMetric(),U()?Ct():Se())}function Ct(){var Ie=Date.now();(!Q||Ie>Q+T)&&(Q=Ie,Te())}function De(){var Ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,we=null;return h.getActiveStreamProcessors().forEach(function(ze){if(!Ie||Ie.length===0||Ie.indexOf(ze.getType())===-1){var Et=ze.getBufferLevel();we===null?we=Et:we=Math.min(we,Et)}}),we}function Ue(){return Y}function Ze(Ie){if(Ie.stream===!1&&Y&&!isNaN(Ie.request.duration)){var we=1.2*Ie.request.duration;we>x&&(p.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",we.toFixed(2)),x=we,F=we)}}function mt(Ie){M.trigger(l.default.PLAYBACK_STALLED,{e:Ie})}function ft(Ie){pe(Ie.mediaInfo)}function pt(Ie){var we=h.getActiveStreamInfo();!Ie||!we||!Ie.currentRepresentation||!Ie.streamId||Ie.streamId!==we.id||!Ie.mediaType||Ie.mediaType!==d.default.VIDEO&&Ie.mediaType!==d.default.AUDIO||(K=Ie.currentRepresentation.availabilityTimeComplete,Y=!K,Y&&!ae&&(ae=!0))}function Mt(){return ae}function Kt(){ne=!0}function jt(){ne=!1}function pe(Ie){Ie&&Ie.supplementalProperties&&Ie.supplementalProperties[d.default.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME]==="true"&&(p.debug("Low Latency critical SupplementalProperty set: Enabling low Latency"),Y=!0)}function Ve(){D.addEventListener("canplay",Ce),D.addEventListener("canplaythrough",We),D.addEventListener("play",tt),D.addEventListener("waiting",ot),D.addEventListener("playing",ct),D.addEventListener("pause",ht),D.addEventListener("error",dt),D.addEventListener("seeking",Pt),D.addEventListener("seeked",$e),D.addEventListener("timeupdate",Te),D.addEventListener("progress",de),D.addEventListener("ratechange",Re),D.addEventListener("loadedmetadata",xe),D.addEventListener("loadeddata",Ne),D.addEventListener("stalled",mt),D.addEventListener("ended",Xe),D.addEventListener("volumechange",nt)}function ut(){D.removeEventListener("canplay",Ce),D.removeEventListener("canplaythrough",We),D.removeEventListener("play",tt),D.removeEventListener("waiting",ot),D.removeEventListener("playing",ct),D.removeEventListener("pause",ht),D.removeEventListener("error",dt),D.removeEventListener("seeking",Pt),D.removeEventListener("seeked",$e),D.removeEventListener("timeupdate",Te),D.removeEventListener("progress",de),D.removeEventListener("ratechange",Re),D.removeEventListener("loadedmetadata",xe),D.removeEventListener("loadeddata",Ne),D.removeEventListener("stalled",mt),D.removeEventListener("ended",Xe),D.removeEventListener("volumechange",nt)}return S={initialize:ge,setConfig:Oe,getTimeToStreamEnd:se,getBufferLevel:De,getPlaybackStalled:he,getTime:H,getLowLatencyModeEnabled:Ue,getInitialCatchupModeActivated:Mt,getIsManifestUpdateInProgress:me,getPlaybackRate:z,getPlayedRanges:fe,getEnded:ue,getIsDynamic:J,getStreamController:ve,computeAndSetLiveDelay:Ye,getLiveDelay:be,getOriginalLiveDelay:Be,getCurrentLiveLatency:ke,play:q,isPaused:U,isStalled:G,pause:le,isSeeking:B,getStreamEndTime:Z,seek:te,seekToOriginalLive:N,seekToCurrentLive:R,reset:oe,updateCurrentTime:Se,getAvailabilityStartTime:Ae},X(),S}L.__dashjs_factory_name="PlaybackController";const P=c.default.getSingletonFactory(L)},"./src/streaming/controllers/ScheduleController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>P});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/streaming/models/FragmentModel.js"),l=r("./src/core/EventBus.js"),c=r("./src/core/events/Events.js"),E=r("./src/core/FactoryMaker.js"),m=r("./src/core/Debug.js"),f=r("./src/streaming/constants/MetricsConstants.js"),T=r("./src/streaming/MediaPlayerEvents.js");function L(O){O=O||{};var M=this.context,S=(0,l.default)(M).getInstance(),p=O.dashMetrics,h=O.mediaPlayerModel,C=O.fragmentModel,v=O.abrController,I=O.playbackController,D=O.textController,y=O.type,A=O.bufferController,x=O.settings,F,k,W,V,Q,$,K,Y,re,ie,ee,ne,ae;function ce(){W=(0,m.default)(M).getInstance().getLogger(F),Ye(),k=O.streamInfo}function X(Me){K=Me,S.on(c.default.BYTES_APPENDED_END_FRAGMENT,ue,F),S.on(c.default.URL_RESOLUTION_FAILED,J,F),S.on(T.default.PLAYBACK_STARTED,ve,F),S.on(T.default.PLAYBACK_RATE_CHANGED,me,F),S.on(T.default.PLAYBACK_TIME_UPDATED,z,F)}function oe(){return y}function ge(){return k.id}function _e(Me){V=Me}function he(Me){if(!A.getIsBufferingCompleted()){se();var qe=isNaN(Me)?0:Me;$=setTimeout(q,qe)}}function se(){$&&(clearTimeout($),$=null)}function Z(){var Me=k.id,qe=v.getMaxAllowedIndexFor(y,Me);return isNaN(re)||re!=qe?(W.info("Top quality "+y+" index has changed from "+re+" to "+qe),re=qe,!0):!1}function q(){try{if(te()){se();return}if(N()){var Me=!1;ae&&(Me=v.checkPlaybackQuality(y,k.id)),Me||le()}else he(I.getLowLatencyModeEnabled()?x.get().streaming.scheduling.lowLatencyTimeout:x.get().streaming.scheduling.defaultTimeout)}catch{he(I.getLowLatencyModeEnabled()?x.get().streaming.scheduling.lowLatencyTimeout:x.get().streaming.scheduling.defaultTimeout)}}function le(){ne||V.quality!==ie||ee?(ee?(W.debug("Switch track for "+y+", representation id = "+V.id),ee=!1):W.debug("Quality has changed, get init request for representationid = "+V.id),S.trigger(c.default.INIT_FRAGMENT_NEEDED,{representationId:V.id,sender:F},{streamId:k.id,mediaType:y}),ae=!1,ne=!1):(W.debug("Media segment needed for ".concat(y," and stream id ").concat(k.id)),S.trigger(c.default.MEDIA_FRAGMENT_NEEDED,{},{streamId:k.id,mediaType:y}),ae=!0)}function te(){try{return y===d.default.TEXT&&!D.isTextEnabled()||I.isPaused()&&(!I.getStreamController().getInitialPlayback()||!I.getStreamController().getAutoPlay())&&!x.get().streaming.scheduling.scheduleWhilePaused}catch{return!1}}function N(){try{return V&&(isNaN(ie)||ee||Z()||R())}catch{return!1}}function R(){if(!y||!V)return!0;var Me=p.getCurrentBufferLevel(y);return Me<w()}function w(){var Me=NaN;return!y||!V||(y===d.default.TEXT?Me=j():y===d.default.AUDIO&&K?Me=H():Me=U()),Me}function j(){try{if(D.isTextEnabled())if(isNaN(V.fragmentDuration)){var Me=p.getCurrentSchedulingInfo(f.default.SCHEDULING_INFO);return Me?Me.duration:0}else return V.fragmentDuration;else return 0}catch{return 0}}function H(){try{var Me=p.getCurrentBufferLevel(d.default.VIDEO);return isNaN(V.fragmentDuration)?Me+1:Math.max(Me+1,V.fragmentDuration)}catch{return 0}}function U(){try{var Me=V.mediaInfo.streamInfo;if(v.isPlayingAtTopQuality(Me)){var qe=Me.manifestInfo.duration>=x.get().streaming.buffer.longFormContentDurationThreshold;return qe?x.get().streaming.buffer.bufferTimeAtTopQualityLongForm:x.get().streaming.buffer.bufferTimeAtTopQuality}else return h.getStableBufferTime()}catch{return h.getStableBufferTime()}}function B(Me){ee=Me}function G(){return ee}function z(){fe(!0)}function fe(Me){if(I&&C){var qe=C.getRequests({state:o.default.FRAGMENT_MODEL_EXECUTED,time:I.getTime(),threshold:0})[0];qe&&I.getTime()>=qe.startTime&&((!Y.mediaInfo||qe.mediaInfo.type===Y.mediaInfo.type&&qe.mediaInfo.id!==Y.mediaInfo.id)&&Me&&S.trigger(c.default.TRACK_CHANGE_RENDERED,{mediaType:y,oldMediaInfo:Y.mediaInfo,newMediaInfo:qe.mediaInfo,streamId:k.id}),(qe.quality!==Y.quality||qe.adaptationIndex!==Y.adaptationIndex)&&Me&&(W.debug("Quality change rendered for streamId ".concat(k.id," and type ").concat(y)),S.trigger(c.default.QUALITY_CHANGE_RENDERED,{mediaType:y,oldQuality:Y.quality,newQuality:qe.quality,streamId:k.id})),Y={mediaInfo:qe.mediaInfo,quality:qe.quality,adaptationIndex:qe.adaptationIndex})}}function ue(Me){W.debug("Appended bytes for ".concat(Me.mediaType," and stream id ").concat(k.id)),(isNaN(Me.index)||isNaN(ie))&&(ie=Me.quality,W.info("["+y+"] lastInitializedRepresentationInfo changed to "+Me.quality)),he(0)}function J(){C.abortRequests(),se()}function ve(){x.get().streaming.scheduling.scheduleWhilePaused||he()}function me(Me){p.updatePlayListTraceMetrics({playbackspeed:Me.playbackRate.toString()})}function Ae(Me){Q=Me}function be(){return Q}function Be(Me){ae=Me}function ke(Me){ne=Me}function Ye(){ae=!0,Q=0,ie=NaN,Y={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},re=NaN,ee=!1,ne=!1}function Oe(){S.off(c.default.BYTES_APPENDED_END_FRAGMENT,ue,F),S.off(c.default.URL_RESOLUTION_FAILED,J,F),S.off(T.default.PLAYBACK_STARTED,ve,F),S.off(T.default.PLAYBACK_RATE_CHANGED,me,F),S.off(T.default.PLAYBACK_TIME_UPDATED,z,F),se(),fe(!1),Ye(),k=null}function Se(){return I}return F={initialize:X,getType:oe,getStreamId:ge,setCurrentRepresentation:_e,setTimeToLoadDelay:Ae,getTimeToLoadDelay:be,setSwitchTrack:B,getSwitchStrack:G,startScheduleTimer:he,clearScheduleTimer:se,reset:Oe,getBufferTarget:w,getPlaybackController:Se,setCheckPlaybackQuality:Be,setInitSegmentRequired:ke},ce(),F}L.__dashjs_factory_name="ScheduleController";const P=E.default.getClassFactory(L)},"./src/streaming/controllers/StreamController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>Q});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/streaming/constants/MetricsConstants.js"),l=r("./src/streaming/Stream.js"),c=r("./src/streaming/ManifestUpdater.js"),E=r("./src/core/EventBus.js"),m=r("./src/core/events/Events.js"),f=r("./src/core/FactoryMaker.js"),T=r("./src/streaming/vo/metrics/PlayList.js"),L=r("./src/core/Debug.js"),P=r("./src/streaming/utils/InitCache.js"),O=r("./src/streaming/MediaPlayerEvents.js"),M=r("./src/streaming/controllers/TimeSyncController.js"),S=r("./src/streaming/controllers/MediaSourceController.js"),p=r("./src/streaming/vo/DashJSError.js"),h=r("./src/core/errors/Errors.js"),C=r("./src/streaming/controllers/EventController.js"),v=r("./src/streaming/constants/ConformanceViolationConstants.js");function I($){return x($)||A($)||y($)||D()}function D(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function y($,K){if($){if(typeof $=="string")return F($,K);var Y=Object.prototype.toString.call($).slice(8,-1);if(Y==="Object"&&$.constructor&&(Y=$.constructor.name),Y==="Map"||Y==="Set")return Array.from($);if(Y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Y))return F($,K)}}function A($){if(typeof Symbol<"u"&&Symbol.iterator in Object($))return Array.from($)}function x($){if(Array.isArray($))return F($)}function F($,K){(K==null||K>$.length)&&(K=$.length);for(var Y=0,re=new Array(K);Y<K;Y++)re[Y]=$[Y];return re}var k=200,W=2;function V(){var $=this.context,K=(0,E.default)($).getInstance(),Y,re,ie,ee,ne,ae,ce,X,oe,ge,_e,he,se,Z,q,le,te,N,R,w,j,H,U,B,G,z,fe,ue,J,ve,me,Ae,be,Be,ke,Ye,Oe,Se,Me,qe,it,at,Ce,We,Ge,tt,ot,ct;function ht(){re=(0,L.default)($).getInstance().getLogger(Y),_e=(0,M.default)($).getInstance(),ge=(0,S.default)($).getInstance(),R=(0,P.default)($).getInstance(),Tn()}function Pt(Le,rt){de(),fe=Le,z=rt,j.initialize(),ne=(0,c.default)($).create(),ne.setConfig({manifestModel:ce,adapter:X,manifestLoader:ae,errHandler:w,settings:We}),ne.initialize(),N=(0,C.default)($).getInstance(),N.setConfig({manifestUpdater:ne,playbackController:be,settings:We}),N.start(),_e.setConfig({dashMetrics:oe,baseURLController:se,errHandler:w,settings:We}),_e.initialize(),B&&(K.trigger(m.default.PROTECTION_CREATED,{controller:B}),B.setMediaElement(Ae.getElement()),z&&B.setProtectionData(z)),$e()}function $e(){K.on(O.default.PLAYBACK_TIME_UPDATED,Et,Y),K.on(O.default.PLAYBACK_SEEKING,Ze,Y),K.on(O.default.PLAYBACK_ERROR,jr,Y),K.on(O.default.PLAYBACK_STARTED,xt,Y),K.on(O.default.PLAYBACK_PAUSED,Dt,Y),K.on(O.default.PLAYBACK_ENDED,Pe,Y),K.on(O.default.METRIC_ADDED,yn,Y),K.on(O.default.MANIFEST_VALIDITY_CHANGED,pn,Y),K.on(O.default.BUFFER_LEVEL_UPDATED,Ie,Y),K.on(O.default.QUALITY_CHANGE_REQUESTED,we,Y),m.default.KEY_SESSION_UPDATED&&K.on(m.default.KEY_SESSION_UPDATED,nt,Y),K.on(m.default.MANIFEST_UPDATED,gr,Y),K.on(m.default.STREAM_BUFFERING_COMPLETED,Rt,Y),K.on(m.default.TIME_SYNCHRONIZATION_COMPLETED,Xe,Y),K.on(m.default.CURRENT_TRACK_CHANGED,Kt,Y),K.on(m.default.SETTING_UPDATED_LIVE_DELAY,ze,Y),K.on(m.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,ze,Y)}function Te(){K.off(O.default.PLAYBACK_TIME_UPDATED,Et,Y),K.off(O.default.PLAYBACK_SEEKING,Ze,Y),K.off(O.default.PLAYBACK_ERROR,jr,Y),K.off(O.default.PLAYBACK_STARTED,xt,Y),K.off(O.default.PLAYBACK_PAUSED,Dt,Y),K.off(O.default.PLAYBACK_ENDED,Pe,Y),K.off(O.default.METRIC_ADDED,yn,Y),K.off(O.default.MANIFEST_VALIDITY_CHANGED,pn,Y),K.off(O.default.BUFFER_LEVEL_UPDATED,Ie,Y),K.off(O.default.QUALITY_CHANGE_REQUESTED,we,Y),m.default.KEY_SESSION_UPDATED&&K.off(m.default.KEY_SESSION_UPDATED,nt,Y),K.off(m.default.MANIFEST_UPDATED,gr,Y),K.off(m.default.STREAM_BUFFERING_COMPLETED,Rt,Y),K.off(m.default.TIME_SYNCHRONIZATION_COMPLETED,Xe,Y),K.off(m.default.CURRENT_TRACK_CHANGED,Kt,Y),K.off(m.default.SETTING_UPDATED_LIVE_DELAY,ze,Y),K.off(m.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,ze,Y)}function de(){if(!ae||!ae.hasOwnProperty("load")||!j||!j.hasOwnProperty("initialize")||!j.hasOwnProperty("reset")||!j.hasOwnProperty("getClientTimeOffset")||!ce||!w||!oe||!be)throw new Error(d.default.MISSING_CONFIG_ERROR)}function Re(){if(!ne||!ne.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}function xe(Le){var rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:NaN;de(),ot=rt,ae.load(Le)}function Ne(Le){var rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:NaN;Re(),ot=rt,ne.setManifest(Le)}function Xe(){et()}function nt(){Ge=!0}function et(){try{var Le=X.getStreamsInfo();if(!U&&Le.length===0)throw new Error("There are no periods in the MPD");U&&Le.length>0&&oe.updateManifestUpdateInfo({currentTime:be.getTime(),buffered:Ae.getBufferRange(),presentationStartTime:Le[0].start,clientTimeOffset:j.getClientTimeOffset()}),H.length>0&&yr(Le);for(var rt=[],vt=0,Ot=Le.length;vt<Ot;vt++){var Ft=Le[vt];rt.push(dt(Ft)),oe.addManifestUpdateStreamInfo(Ft)}Promise.all(rt).then(function(){return We.get().streaming.applyContentSteering&&!U&&he.shouldQueryBeforeStart()?he.loadSteeringData():Promise.resolve()}).then(function(){U||Tt(Le),K.trigger(m.default.STREAMS_COMPOSED),Qt()}).catch(function(Ht){throw Ht})}catch(Ht){w.error(new p.default(h.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,Ht.message+" nostreamscomposed",ce.getValue())),ve=!0,Jr()}}function dt(Le){var rt=sn(Le.id);return rt?rt.updateData(Le):(rt=(0,l.default)($).create({manifestModel:ce,mediaPlayerModel:ke,dashMetrics:oe,manifestUpdater:ne,adapter:X,timelineConverter:j,capabilities:ie,capabilitiesFilter:ee,errHandler:w,baseURLController:se,segmentBaseController:Z,textController:G,abrController:le,playbackController:be,eventController:N,mediaController:te,protectionController:B,videoModel:Ae,streamInfo:Le,settings:We}),H.push(rt),rt.initialize(),Promise.resolve())}function Tt(Le){ut();var rt=oe.getCurrentDVRInfo().range;if(rt.end<rt.start){tt&&clearTimeout(tt);var vt=Math.min(((rt.end-rt.start)*-1+W)*1e3,2147483647);re.debug("Waiting for ".concat(vt," ms before playback can start")),K.trigger(m.default.AST_IN_FUTURE,{delay:vt}),tt=setTimeout(function(){Tt(Le)},vt);return}We.get().streaming.applyProducerReferenceTime&&Be.calculateProducerReferenceTimeOffsets(Le);var Ot=Le[0].manifestInfo;if(We.get().streaming.applyServiceDescription&&Be.applyServiceDescription(Ot),X.getIsDynamic()){var Ft=Pr(Le,Ot);be.computeAndSetLiveDelay(Ft,Ot)}var Ht=kt(),Vt=Ve(Ht),hr=Vt!==null?Vt:H[0];K.trigger(m.default.INITIAL_STREAM_SWITCH,{startTime:Ht}),Ct(hr,null,Ht),Wt()}function Ct(Le,rt,vt){try{if(ue||!Le||rt===Le&&Le.getIsActive())return;ue=!0,K.trigger(m.default.PERIOD_SWITCH_STARTED,{fromStreamInfo:rt?rt.getStreamInfo():null,toStreamInfo:Le.getStreamInfo()});var Ot=!1;U=Le,rt&&(Ot=jt(Le,rt),rt.deactivate(Ot)),vt=isNaN(vt)?!Ot&&rt?Le.getStreamInfo().start:NaN:vt,re.info("Switch to stream ".concat(Le.getId(),". Seektime is ").concat(vt,", current playback time is ").concat(be.getTime(),". Seamless period switch is set to ").concat(Ot)),at=at.filter(function(Ft){return Ft.getId()!==U.getId()}),be.initialize(Mr(),!!rt),Ae.getElement()?De(vt,Ot,!1):Ue(vt,Ot)}catch{ue=!1}}function De(Le,rt){var vt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,Ot;function Ft(){if(!(!me||me.readyState!=="open")){re.debug("MediaSource is open!"),window.URL.revokeObjectURL(Ot),me.removeEventListener("sourceopen",Ft),me.removeEventListener("webkitsourceopen",Ft),He();var Vt=oe.getCurrentDVRInfo();ge.setSeekable(Vt.range.start,Vt.range.end),vt?U.setMediaSource(me).then(function(){U.initializeForTextWithMediaSource(me)}):Ue(Le,rt)}}function Ht(){me.addEventListener("sourceopen",Ft,!1),me.addEventListener("webkitsourceopen",Ft,!1),Ot=ge.attachMediaSource(Ae),re.debug("MediaSource attached to element.  Waiting on open...")}me?rt?Ue(Le,rt):(ge.detachMediaSource(Ae),Ht()):(me=ge.createMediaSource(),Ht())}function Ue(Le,rt){U.activate(me,rt?it:void 0,Le).then(function(vt){if(vt){var Ot=Object.keys(vt);Ot.length>0&&vt[Ot[0]].getBuffer().changeType&&(Ce=!0),it=vt}isNaN(Le)||(K.trigger(m.default.SEEK_TARGET,{time:Le},{streamId:U.getId()}),be.seek(Le,!1,!0),U.startScheduleControllers()),ue=!1,K.trigger(m.default.PERIOD_SWITCH_COMPLETED,{toStreamInfo:Mr()})})}function Ze(Le){var rt=Le.seekTime,vt=Ve(rt);!vt||vt===U?(mt(),pt(Le)):vt&&vt!==U&&(mt(vt),Mt(Le,vt)),Wr(T.PlayList.SEEK_START_REASON)}function mt(){var Le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;ft()}function ft(){at&&at.length>0&&(at.forEach(function(Le){Le.deactivate(!0)}),at=[])}function pt(Le){var rt=U.getProcessors();rt.forEach(function(vt){return vt.prepareInnerPeriodPlaybackSeeking(Le)}),Ar(T.PlayListTrace.USER_REQUEST_STOP_REASON)}function Mt(Le,rt){var vt=Le&&!isNaN(Le.seekTime)?Le.seekTime:NaN,Ot=U.getProcessors(),Ft=Ot.map(function(Ht){return Ht.prepareOuterPeriodPlaybackSeeking(Le)});Promise.all(Ft).then(function(){Ct(rt,U,vt)}).catch(function(Ht){w.error(Ht)})}function Kt(Le){Le.newMediaInfo.streamInfo.id===U.getId()&&(ft(),U.prepareTrackChange(Le))}function jt(Le,rt){try{return We.get().streaming.buffer.reuseExistingSourceBuffers&&(rt.isProtectionCompatible(Le)||Ge)&&(Ce||rt.isMediaCodecCompatible(Le,rt))}catch{return!1}}function pe(Le){var rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(me&&!Le.getPreloaded()){var vt=jt(Le,rt);vt&&Le.startPreloading(me,it).then(function(){at.push(Le)})}}function Ve(Le){if(isNaN(Le))return null;for(var rt=H.length,vt=0;vt<rt;vt++){var Ot=H[vt],Ft=parseFloat((Ot.getStartTime()+Ot.getDuration()).toFixed(5));if(Le<Ft)return Ot}return null}function ut(){try{var Le=X.getIsDynamic(),rt=X.getStreamsInfo(),vt=rt[0].manifestInfo,Ot=be.getTime(),Ft=j.calcTimeShiftBufferWindow(H,Le),Ht=yt();if(typeof Ft.start>"u"||typeof Ft.end>"u")return;!Ht||Ht.length===0?oe.addDVRInfo(d.default.VIDEO,Ot,vt,Ft):Ht.forEach(function(Vt){oe.addDVRInfo(Vt.getType(),Ot,vt,Ft)})}catch{}}function Ie(Le){if(Se&&fe){var rt=ke.getInitialBufferLevel(),vt=[d.default.TEXT];(isNaN(rt)||rt<=be.getBufferLevel(vt)||X.getIsDynamic()&&rt>be.getLiveDelay())&&(Se=!1,Wr(T.PlayList.INITIAL_PLAYOUT_START_REASON),be.play())}Le&&Le.mediaType&&oe.addBufferLevel(Le.mediaType,new Date,Le.bufferLevel*1e3)}function we(Le){Le.streamInfo.id===U.getId()&&Le.reason&&Le.reason.forceReplace&&ft();var rt=sn(Le.streamInfo.id);rt.prepareQualityChange(Le)}function ze(){if(X.getIsDynamic()&&be.getOriginalLiveDelay()!==0&&U){var Le=X.getStreamsInfo();if(Le.length>0){var rt=Le[0].manifestInfo,vt=Pr(Le,rt);be.computeAndSetLiveDelay(vt,rt)}}}function Et(){if(Kr()){var Le=Ae.getPlaybackQuality();Le&&oe.addDroppedFrames(Le)}}function xt(){re.debug("[onPlaybackStarted]"),!Se&&Oe&&Wr(T.PlayList.RESUME_FROM_PAUSE_START_REASON),Se&&(Se=!1),Me&&(Me=!1,We.get().streaming.applyContentSteering&&!he.shouldQueryBeforeStart()&&he.loadSteeringData()),Oe=!1}function Dt(Le){re.debug("[onPlaybackPaused]"),Le.ended||(Oe=!0,Ar(T.PlayListTrace.USER_REQUEST_STOP_REASON))}function Rt(Le){re.debug("Stream with id ".concat(Le.streamInfo.id," finished buffering"));var rt=Le.streamInfo.isLast;me&&rt?(re.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),ge.signalEndOfStream(me)):Qt()}function Qt(){if(!(!U||!U.getHasFinishedBuffering()))for(var Le=ye(U),rt=0;rt<Le.length;){var vt=Le[rt],Ot=rt===0?U:Le[rt-1];!vt.getPreloaded()&&Ot.getHasFinishedBuffering()&&me&&pe(vt,Ot),rt+=1}}function Wt(){qe||(qe=setInterval(function(){!ue&&be.getTimeToStreamEnd()<=0&&!be.isSeeking()&&K.trigger(m.default.PLAYBACK_ENDED,{isLast:Mr().isLast})},k))}function Je(){qe&&(clearInterval(qe),qe=null)}function At(Le,rt){for(var vt=null,Ot=0,Ft=0,Ht=null,Vt=0;Vt<H.length;Vt++){if(vt=H[Vt],Ft=vt.getStartTime(),Ht=vt.getDuration(),Number.isFinite(Ft)&&(Ot=Ft),vt.getId()===rt)return Le-Ot;Number.isFinite(Ht)&&(Ot+=Ht)}return null}function yt(){return U?U.getProcessors():[]}function Pe(Le){if(U&&!U.getIsEndedEventSignaled()){U.setIsEndedEventSignaled(!0);var rt=Ke();rt?(re.debug("StreamController onEnded, found next stream with id ".concat(rt.getStreamInfo().id,". Switching from ").concat(U.getStreamInfo().id," to ").concat(rt.getStreamInfo().id)),Ct(rt,U,NaN)):(re.debug("StreamController no next stream found"),U.setIsEndedEventSignaled(!1)),Ar(rt?T.PlayListTrace.END_OF_PERIOD_STOP_REASON:T.PlayListTrace.END_OF_CONTENT_STOP_REASON)}Le&&Le.isLast&&(Je(),he.stopSteeringRequestTimer())}function Ke(){var Le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,rt=Le||U||null;if(!rt)return null;for(var vt=rt.getStreamInfo(),Ot=vt.start,Ft=0,Ht=-1,Vt=NaN;Ft<H.length;){var hr=H[Ft],tr=hr.getStreamInfo(),Sr=tr.start-Ot;Sr>0&&(isNaN(Vt)||Sr<Vt)&&vt.id!==tr.id&&(Vt=Sr,Ht=Ft),Ft+=1}return Ht>=0?H[Ht]:null}function ye(){var Le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;try{var rt=Le||U||null;if(rt){var vt=rt.getStreamInfo();return H.filter(function(Ot){var Ft=Ot.getStreamInfo();return Ft.start>vt.start&&vt.id!==Ft.id})}}catch{return[]}}function He(Le){var rt=Le||Mr().manifestInfo.duration;ge.setDuration(rt)}function lt(){return U}function St(){return Se}function It(){return fe}function kt(){var Le,rt=X.getIsDynamic();if(rt){var vt=oe.getCurrentDVRInfo(),Ot=vt&&vt.range?vt.range.end:0;Le=Ot-be.getOriginalLiveDelay();var Ft=vt?vt.range:null;if(Ft){if(!isNaN(ot)||ot.toString().indexOf("posix:")!==-1){re.info("Start time provided by the app: ".concat(ot));var Ht=Bt(!0,ot);isNaN(Ht)||(Le=Math.min(Le,Ht))}else{var Vt=Gt(!0);isNaN(Vt)||(re.info("Start time from URI parameters: ".concat(Vt)),Le=Math.min(Le,Vt))}var hr=We.get().streaming.timeShiftBuffer.calcFromSegmentTimeline?.1:0;Le=Math.max(Le,Ft.start+hr)}}else{var tr=Gr(),Sr=tr[0].getStreamInfo();if(Le=Sr.start,isNaN(ot)){var Hr=Gt(!1);isNaN(Hr)||(re.info("Start time from URI parameters: ".concat(Hr)),Le=Math.max(Le,Hr))}else{re.info("Start time provided by the app: ".concat(ot));var sr=Bt(!1,ot);isNaN(sr)||(Le=Math.max(Le,sr))}}return Le}function Gt(Le){var rt=q.getURIFragmentData();if(!rt||!rt.t)return NaN;var vt=Gr()[0],Ot=vt.getStreamInfo().start;return rt.t=rt.t.split(",")[0],nr(Le,rt.t,Ot)}function Bt(Le,rt){var vt=0;if(!Le){var Ot=Gr()[0];vt=Ot.getStreamInfo().start}return nr(Le,rt,vt)}function nr(Le,rt,vt){var Ot=X.getRegularPeriods()[0],Ft=rt.toString(),Ht=Ft.indexOf("posix:")!==-1?Ft.substring(6)==="now"?Date.now()/1e3:parseFloat(Ft.substring(6)):NaN,Vt=Le&&!isNaN(Ht)?j.calcPresentationTimeFromWallTime(new Date(Ht*1e3),Ot):parseFloat(Ft)+vt;return Vt}function yr(Le){if(Le.length===0){re.warn("No periods included in the current manifest. Skipping the filtering of outdated stream objects.");return}H=H.filter(function(rt){var vt=Le.filter(function(Ft){return Ft.id===rt.getId()}).length>0,Ot=vt||rt.getId()===U.getId();return Ot||(re.debug("Removing stream ".concat(rt.getId())),rt.reset(!0)),Ot})}function Pr(Le,rt){try{var vt=NaN;if(rt&&!isNaN(rt.maxFragmentDuration)&&isFinite(rt.maxFragmentDuration))return rt.maxFragmentDuration;if(Le&&Le.length===1){var Ot=Le[0],Ft=[d.default.VIDEO,d.default.AUDIO,d.default.TEXT],Ht=Ft.reduce(function(Vt,hr){var tr=X.getMediaInfoForType(Ot,hr);return tr&&tr.isFragmented!==!1&&Vt.push(tr),Vt},[]).reduce(function(Vt,hr){var tr=X.getVoRepresentations(hr);return tr&&tr.length>0&&tr.forEach(function(Sr){Sr&&Vt.push(Sr)}),Vt},[]).reduce(function(Vt,hr){var tr=X.convertRepresentationToRepresentationInfo(hr);return tr&&tr.fragmentDuration&&!isNaN(tr.fragmentDuration)&&Vt.push(tr.fragmentDuration),Vt},[]);vt=Math.max.apply(Math,I(Ht))}return isFinite(vt)?vt:NaN}catch{return NaN}}function gr(Le){if(Le.error)ve=!0,Jr();else{re.info("Manifest updated... updating data system wide.");var rt=Le.manifest;X.updatePeriods(rt);var vt=X.getUTCTimingSources();X.getIsDynamic()&&(!vt||vt.length===0)&&K.trigger(O.default.CONFORMANCE_VIOLATION,{level:v.default.LEVELS.WARNING,event:v.default.EVENTS.NO_UTC_TIMING_ELEMENT});var Ot=X.getIsDynamic()?vt.concat(Ye.getUTCTimingSources()):vt;ee.filterUnsupportedFeatures(rt).then(function(){se.initialize(rt),_e.attemptSync(Ot,X.getIsDynamic())})}}function Kr(){return U?U.getHasVideoTrack():!1}function Qr(){return U?U.getHasAudioTrack():!1}function an(Le){U&&(be.initialize(Mr()),De(Le,!1,!0))}function Ar(Le,rt){rt=rt||new Date,yt().forEach(function(vt){vt.finalisePlayList(rt,Le)}),oe.addPlayList()}function Wr(Le){oe.createPlaylistMetrics(be.getTime()*1e3,Le)}function jr(Le){if(Le.error){var rt="";switch(Le.error.code){case 1:rt="MEDIA_ERR_ABORTED";break;case 2:rt="MEDIA_ERR_NETWORK";break;case 3:rt="MEDIA_ERR_DECODE",ct.counts.mediaErrorDecode+=1;break;case 4:rt="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:rt="MEDIA_ERR_ENCRYPTED";break;default:rt="UNKNOWN";break}if(rt==="MEDIA_ERR_DECODE"&&We.get().errors.recoverAttempts.mediaErrorDecode>=ct.counts.mediaErrorDecode){vn();return}J=!0,Le.error.message&&(rt+=" ("+Le.error.message+")"),Le.error.msExtendedCode&&(rt+=" (0x"+(Le.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),re.fatal("Video Element Error: "+rt),Le.error&&re.fatal(Le.error),w.error(new p.default(Le.error.code,rt)),Jr()}}function vn(){re.warn("A MEDIA_ERR_DECODE occured: Resetting the MediaSource");var Le=be.getTime();U.deactivate(!1),re.warn("MediaSource has been resetted. Resuming playback from time ".concat(Le)),De(Le,!1,!1)}function Mr(){return U?U.getStreamInfo():null}function Wn(){return ue}function jn(){return J||ve}function sn(Le){for(var rt=0,vt=H.length;rt<vt;rt++)if(H[rt].getId()===Le)return H[rt];return null}function pn(Le){isNaN(Le.newDuration)||He(Le.newDuration)}function Gn(Le){Le&&(Le.capabilities&&(ie=Le.capabilities),Le.capabilitiesFilter&&(ee=Le.capabilitiesFilter),Le.manifestLoader&&(ae=Le.manifestLoader),Le.manifestModel&&(ce=Le.manifestModel),Le.mediaPlayerModel&&(ke=Le.mediaPlayerModel),Le.customParametersModel&&(Ye=Le.customParametersModel),Le.protectionController&&(B=Le.protectionController),Le.adapter&&(X=Le.adapter),Le.dashMetrics&&(oe=Le.dashMetrics),Le.errHandler&&(w=Le.errHandler),Le.timelineConverter&&(j=Le.timelineConverter),Le.videoModel&&(Ae=Le.videoModel),Le.playbackController&&(be=Le.playbackController),Le.serviceDescriptionController&&(Be=Le.serviceDescriptionController),Le.contentSteeringController&&(he=Le.contentSteeringController),Le.textController&&(G=Le.textController),Le.abrController&&(le=Le.abrController),Le.mediaController&&(te=Le.mediaController),Le.settings&&(We=Le.settings),Le.baseURLController&&(se=Le.baseURLController),Le.uriFragmentModel&&(q=Le.uriFragmentModel),Le.segmentBaseController&&(Z=Le.segmentBaseController))}function Hn(Le){z=Le,B&&B.setProtectionData(z)}function Tn(){H=[],ot=NaN,B=null,ue=!1,U=null,J=!1,ve=!1,Se=!0,Me=!0,Oe=!1,fe=!0,qe=null,Ge=!1,Ce=!1,at=[],tt=null,ct={counts:{mediaErrorDecode:0}}}function Jr(){de(),_e.reset(),Ar(J||ve?T.PlayListTrace.FAILURE_STOP_REASON:T.PlayListTrace.USER_REQUEST_STOP_REASON);for(var Le=0,rt=H?H.length:0;Le<rt;Le++){var vt=H[Le];vt.reset(J)}Te(),se.reset(),ne.reset(),N.reset(),oe.clearAllCurrentMetrics(),ce.setValue(null),ae.reset(),j.reset(),R.reset(),me&&(ge.detachMediaSource(Ae),me=null),Ae=null,B&&(B=null,z=null,ce.getValue()&&K.trigger(m.default.PROTECTION_DESTROYED,{data:ce.getValue().url})),Je(),K.trigger(m.default.STREAM_TEARDOWN_COMPLETE),Tn()}function yn(Le){if(Le.metric===o.default.DVR_INFO){var rt=Qr()?d.default.AUDIO:d.default.VIDEO;Le.mediaType===rt&&ge.setSeekable(Le.value.range.start,Le.value.range.end)}}function Gr(){return H}return Y={initialize:Pt,getActiveStreamInfo:Mr,addDVRMetric:ut,hasVideoTrack:Kr,hasAudioTrack:Qr,getStreamById:sn,getStreamForTime:Ve,getTimeRelativeToStreamId:At,load:xe,loadWithManifest:Ne,getActiveStreamProcessors:yt,setConfig:Gn,setProtectionData:Hn,getIsStreamSwitchInProgress:Wn,switchToVideoElement:an,getHasMediaOrInitialisationError:jn,getStreams:Gr,getActiveStream:lt,getInitialPlayback:St,getAutoPlay:It,reset:Jr},ht(),Y}V.__dashjs_factory_name="StreamController";const Q=f.default.getSingletonFactory(V)},"./src/streaming/controllers/TimeSyncController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>D});var d=r("./src/streaming/vo/DashJSError.js"),o=r("./src/streaming/vo/metrics/HTTPRequest.js"),l=r("./src/core/EventBus.js"),c=r("./src/core/events/Events.js"),E=r("./src/core/errors/Errors.js"),m=r("./src/core/FactoryMaker.js"),f=r("./src/core/Debug.js"),T=r("./src/streaming/utils/URLUtils.js"),L=5e3,P=100,O=2,M=2,S=30,p=30,h=600,C=2;function v(){var y=this.context,A=(0,l.default)(y).getInstance(),x=(0,T.default)(y).getInstance(),F,k,W,V,Q,$,K,Y,re,ie,ee,ne,ae,ce,X,oe;function ge(){k=(0,f.default)(y).getInstance().getLogger(F),A.on(c.default.ATTEMPT_BACKGROUND_SYNC,q,F)}function _e(ke){ke&&(ke.dashMetrics&&(K=ke.dashMetrics),ke.baseURLController&&(oe=ke.baseURLController),ke.errHandler&&(X=ke.errHandler),ke.settings&&(Q=ke.settings))}function he(){Y=[],re=[],ie=null,ee=null,ae=null,ne=NaN,W=!1,V=!1,ce=Q.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function se(){he(),$={"urn:mpeg:dash:utc:http-head:2014":ue,"urn:mpeg:dash:utc:http-xsdate:2014":fe.bind(null,H),"urn:mpeg:dash:utc:http-iso:2014":fe.bind(null,U),"urn:mpeg:dash:utc:direct:2014":z,"urn:mpeg:dash:utc:http-head:2012":ue,"urn:mpeg:dash:utc:http-xsdate:2012":fe.bind(null,H),"urn:mpeg:dash:utc:http-iso:2012":fe.bind(null,U),"urn:mpeg:dash:utc:direct:2012":z,"urn:mpeg:dash:utc:http-ntp:2014":G,"urn:mpeg:dash:utc:ntp:2014":G,"urn:mpeg:dash:utc:sntp:2014":G}}function Z(ke,Ye){if(re=ke,!W){if(!R(Ye)){A.trigger(c.default.TIME_SYNCHRONIZATION_COMPLETED);return}W=!0,te()}}function q(){if(!(!Q.get().streaming.utcSynchronization.enabled||W||V||!ae||!ae.value||!ae.schemeIdUri||isNaN(ne)||isNaN(Q.get().streaming.utcSynchronization.backgroundAttempts))&&!(ee&&(Date.now()-ee)/1e3<p)){Y=[],V=!0;var ke=isNaN(Q.get().streaming.utcSynchronization.backgroundAttempts)?M:Q.get().streaming.utcSynchronization.backgroundAttempts;le(ke)}}function le(ke){try{if(ke<=0){Ae();return}var Ye=Date.now();$[ae.schemeIdUri](ae.value,function(Oe){var Se=Date.now(),Me=N(Ye,Se,Oe);Y.push(Me),le(ke-1)},function(){Ae()})}catch{Ae()}}function te(){var ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,Ye=ke||0;if(!re||re.length===0||Ye>=re.length){w();return}var Oe=re[Ye];if(Oe)if($.hasOwnProperty(Oe.schemeIdUri)){var Se=new Date().getTime();$[Oe.schemeIdUri](Oe.value,function(Me){var qe=new Date().getTime(),it=N(Se,qe,Me);ae=Oe,w(it)},function(){te(Ye+1)})}else te(Ye+1);else w()}function N(ke,Ye,Oe){var Se=Ye-(Ye-ke)/2;return Oe-Se}function R(ke){try{if(!ke||!Q.get().streaming.utcSynchronization.enabled)return!1;var Ye=isNaN(ce)?S:ce;return!ie||!Ye||isNaN(Ye)?!0:(Date.now()-ie)/1e3>=Ye}catch{return!0}}function w(){var ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:NaN,Ye=isNaN(ke);Ye&&Q.get().streaming.utcSynchronization.useManifestDateHeaderTimeSource?J():ve(Ye,ke)}function j(ke){var Ye=60,Oe=60,Se=1e3,Me=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/,qe,it,at=Me.exec(ke);return qe=Date.UTC(parseInt(at[1],10),parseInt(at[2],10)-1,parseInt(at[3],10),parseInt(at[4],10),parseInt(at[5],10),at[6]&&(parseInt(at[6],10)||0),at[7]&&parseFloat(at[7])*Se||0),at[9]&&at[10]&&(it=parseInt(at[9],10)*Oe+parseInt(at[10],10),qe+=(at[8]==="+"?-1:1)*it*Ye*Se),new Date(qe).getTime()}function H(ke){var Ye=Date.parse(ke);return isNaN(Ye)&&(Ye=j(ke)),Ye}function U(ke){return Date.parse(ke)}function B(ke){return Date.parse(ke)}function G(ke,Ye,Oe){Oe()}function z(ke,Ye,Oe){var Se=H(ke);if(!isNaN(Se)){Ye(Se);return}Oe()}function fe(ke,Ye,Oe,Se,Me){var qe,it,at=!1,Ce=new XMLHttpRequest,We=Me?o.HTTPRequest.HEAD:o.HTTPRequest.GET,Ge=Ye.match(/\S+/g);if(Ye=Ge.shift(),qe=function(){at||(at=!0,Ge.length?fe(ke,Ge.join(" "),Oe,Se,Me):Se())},it=function(){var ct,ht;Ce.status===200&&(ct=Me?Ce.getResponseHeader("Date"):Ce.response,ht=ke(ct),isNaN(ht)||(Oe(ht),at=!0))},x.isRelative(Ye)){var tt=oe.resolve();tt&&(Ye=x.resolve(Ye,tt.url))}Ce.open(We,Ye),Ce.timeout=L,Ce.onload=it,Ce.onloadend=qe,Ce.send()}function ue(ke,Ye,Oe){fe(B,ke,Ye,Oe,!0)}function J(){var ke=K.getLatestMPDRequestHeaderValueByID("Date"),Ye=ke!==null?new Date(ke).getTime():Number.NaN;if(isNaN(Ye))ve(!0);else{var Oe=Ye-Date.now();ve(!1,Oe)}}function ve(ke,Ye){if(!isNaN(ne)&&!isNaN(Ye)&&!ke&&me(Ye),!ke&&!isNaN(Ye)){ie=Date.now(),W=!1;var Oe=isNaN(ne);ne=Ye,Oe&&q(),k.debug("Completed UTC sync. Setting client - server offset to ".concat(Ye))}ke&&(ae=null,W=!1,X.error(new d.default(E.default.TIME_SYNC_FAILED_ERROR_CODE,E.default.TIME_SYNC_FAILED_ERROR_MESSAGE))),A.trigger(c.default.UPDATE_TIME_SYNC_OFFSET,{offset:Ye}),A.trigger(c.default.TIME_SYNCHRONIZATION_COMPLETED)}function me(ke){try{var Ye=be(ke),Oe=isNaN(ce)?S:ce,Se=isNaN(Q.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?O:Q.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,Me=isNaN(Q.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?h:Q.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,qe=isNaN(Q.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?C:Q.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts,it;Ye?(it=Math.min(Oe*Se,Me),k.debug("Increasing timeBetweenSyncAttempts to ".concat(it))):(it=Math.max(Oe/Se,qe),k.debug("Decreasing timeBetweenSyncAttempts to ".concat(it))),ce=it}catch{}}function Ae(){if(!(!Y||Y.length===0)){var ke=Y.reduce(function(Ye,Oe){return Ye+Oe},0)/Y.length;be(ke)?k.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(k.debug("Completed background UTC sync. Setting client - server offset to ".concat(ke)),ne=ke,A.trigger(c.default.UPDATE_TIME_SYNC_OFFSET,{offset:ne})),V=!1,ee=Date.now()}}function be(ke){try{if(isNaN(ne))return!0;var Ye=Q.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(Q.get().streaming.utcSynchronization.maximumAllowedDrift)?Q.get().streaming.utcSynchronization.maximumAllowedDrift:P,Oe=ne-Ye,Se=ne+Ye;return ke>=Oe&&ke<=Se}catch{return!0}}function Be(){he(),A.off(c.default.ATTEMPT_BACKGROUND_SYNC,q,F)}return F={initialize:se,attemptSync:Z,setConfig:_e,reset:Be},ge(),F}v.__dashjs_factory_name="TimeSyncController";var I=m.default.getSingletonFactory(v);I.HTTP_TIMEOUT_MS=L,m.default.updateSingletonFactory(v.__dashjs_factory_name,I);const D=I},"./src/streaming/controllers/XlinkController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>M});var d=r("./src/streaming/XlinkLoader.js"),o=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),c=r("./src/core/FactoryMaker.js"),E=r("./externals/xml2json.js"),m=r("./src/streaming/utils/URLUtils.js"),f=r("./src/dash/constants/DashConstants.js"),T="onLoad",L="onActuate",P="urn:mpeg:dash:resolve-to-zero:2013";function O(S){S=S||{};var p=this.context,h=(0,o.default)(p).getInstance(),C=(0,m.default)(p).getInstance(),v,I,D,y,A,x;function F(){h.on(l.default.XLINK_ELEMENT_LOADED,K,v),x=(0,d.default)(p).create({errHandler:S.errHandler,dashMetrics:S.dashMetrics,mediaPlayerModel:S.mediaPlayerModel,requestModifier:S.requestModifier,settings:S.settings})}function k(ce){ce&&(I=ce)}function W(ce){ce&&(D=ce)}function V(ce){var X;A=new E.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:I}),y=ce,y.Period_asArray?(X=re(y.Period_asArray,y,f.default.PERIOD,T),$(X,f.default.PERIOD,T)):h.trigger(l.default.XLINK_READY,{manifest:y})}function Q(){h.off(l.default.XLINK_ELEMENT_LOADED,K,v),x&&(x.reset(),x=null)}function $(ce,X,oe){var ge={},_e,he;ge.elements=ce,ge.type=X,ge.resolveType=oe,ge.elements.length===0&&Y(ge);for(var se=0;se<ge.elements.length;se++)_e=ge.elements[se],C.isHTTPURL(_e.url)?he=_e.url:he=_e.originalContent.BaseURL+_e.url,x.load(he,_e,ge)}function K(ce){var X,oe,ge="<response>",_e="</response>",he="";if(X=ce.element,oe=ce.resolveObject,X.resolvedContent){var se=0;X.resolvedContent.indexOf("<?xml")===0&&(se=X.resolvedContent.indexOf("?>")+2),he=X.resolvedContent.substr(0,se)+ge+X.resolvedContent.substr(se)+_e,X.resolvedContent=A.xml_str2json(he)}ne(oe)&&Y(oe)}function Y(ce){var X=[],oe,ge;if(ie(ce),ce.resolveType===L&&h.trigger(l.default.XLINK_READY,{manifest:y}),ce.resolveType===T)switch(ce.type){case f.default.PERIOD:for(oe=0;oe<y[f.default.PERIOD+"_asArray"].length;oe++)ge=y[f.default.PERIOD+"_asArray"][oe],ge.hasOwnProperty(f.default.ADAPTATION_SET+"_asArray")&&(X=X.concat(re(ge[f.default.ADAPTATION_SET+"_asArray"],ge,f.default.ADAPTATION_SET,T))),ge.hasOwnProperty(f.default.EVENT_STREAM+"_asArray")&&(X=X.concat(re(ge[f.default.EVENT_STREAM+"_asArray"],ge,f.default.EVENT_STREAM,T)));$(X,f.default.ADAPTATION_SET,T);break;case f.default.ADAPTATION_SET:h.trigger(l.default.XLINK_READY,{manifest:y});break}}function re(ce,X,oe,ge){var _e=[],he,se,Z;for(se=ce.length-1;se>=0;se--)he=ce[se],he.hasOwnProperty("xlink:href")&&he["xlink:href"]===P&&ce.splice(se,1);for(se=0;se<ce.length;se++)he=ce[se],he.hasOwnProperty("xlink:href")&&he.hasOwnProperty("xlink:actuate")&&he["xlink:actuate"]===ge&&(Z=ee(he["xlink:href"],X,oe,se,ge,he),_e.push(Z));return _e}function ie(ce){var X=[],oe,ge,_e,he,se,Z;for(he=ce.elements.length-1;he>=0;he--){if(oe=ce.elements[he],ge=oe.type+"_asArray",!oe.resolvedContent||ae())delete oe.originalContent["xlink:actuate"],delete oe.originalContent["xlink:href"],X.push(oe.originalContent);else if(oe.resolvedContent)for(se=0;se<oe.resolvedContent[ge].length;se++)_e=oe.resolvedContent[ge][se],X.push(_e);for(oe.parentElement[ge].splice(oe.index,1),Z=0;Z<X.length;Z++)oe.parentElement[ge].splice(oe.index+Z,0,X[Z]);X=[]}ce.elements.length>0&&D.run(y)}function ee(ce,X,oe,ge,_e,he){return{url:ce,parentElement:X,type:oe,index:ge,resolveType:_e,originalContent:he,resolvedContent:null,resolved:!1}}function ne(ce){var X,oe;for(X=0;X<ce.elements.length;X++)if(oe=ce.elements[X],oe.resolved===!1)return!1;return!0}function ae(){return!1}return v={resolveManifestOnLoad:V,setMatchers:k,setIron:W,reset:Q},F(),v}O.__dashjs_factory_name="XlinkController";const M=c.default.getClassFactory(O)},"./src/streaming/metrics/MetricsReporting.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>T});var d=r("./src/streaming/metrics/utils/DVBErrorsTranslator.js"),o=r("./src/streaming/metrics/MetricsReportingEvents.js"),l=r("./src/streaming/metrics/controllers/MetricsCollectionController.js"),c=r("./src/streaming/metrics/metrics/MetricsHandlerFactory.js"),E=r("./src/streaming/metrics/reporting/ReportingFactory.js");function m(){var L=this.context,P,O;function M(h){return O=(0,d.default)(L).getInstance({eventBus:h.eventBus,dashMetrics:h.dashMetrics,metricsConstants:h.metricsConstants,events:h.events}),O.initialise(),(0,l.default)(L).create(h)}function S(){return(0,E.default)(L).getInstance()}function p(){return(0,c.default)(L).getInstance()}return P={createMetricsReporting:M,getReportingFactory:S,getMetricsHandlerFactory:p},P}m.__dashjs_factory_name="MetricsReporting";var f=dashjs.FactoryMaker.getClassFactory(m);f.events=o.default,dashjs.FactoryMaker.updateClassFactory(m.__dashjs_factory_name,f);const T=f},"./src/streaming/metrics/MetricsReportingEvents.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/core/events/EventsBase.js");function o(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(C){return typeof C}:o=function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},o(p)}function l(p,h){if(!(p instanceof h))throw new TypeError("Cannot call a class as a function")}function c(p,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(h&&h.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),h&&E(p,h)}function E(p,h){return E=Object.setPrototypeOf||function(v,I){return v.__proto__=I,v},E(p,h)}function m(p){var h=L();return function(){var v=P(p),I;if(h){var D=P(this).constructor;I=Reflect.construct(v,arguments,D)}else I=v.apply(this,arguments);return f(this,I)}}function f(p,h){return h&&(o(h)==="object"||typeof h=="function")?h:T(p)}function T(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(p){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},P(p)}var O=function(p){c(C,p);var h=m(C);function C(){var v;return l(this,C),v=h.call(this),v.METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",v.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",v.CMCD_DATA_GENERATED="cmcdDataGenerated",v}return C}(d.default),M=new O;const S=M},"./src/streaming/metrics/controllers/MetricsCollectionController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/streaming/metrics/controllers/MetricsController.js"),o=r("./src/streaming/metrics/utils/ManifestParsing.js"),l=r("./src/streaming/metrics/MetricsReportingEvents.js");function c(m){m=m||{};var f,T={},L=this.context,P=m.eventBus,O=m.events;function M(C){if(!C.error){var v=Object.keys(T),I=(0,o.default)(L).getInstance({adapter:m.adapter,constants:m.constants}).getMetrics(C.manifest);I.forEach(function(D){var y=JSON.stringify(D);if(T.hasOwnProperty(y))v.splice(y,1);else try{var A=(0,d.default)(L).create(m);A.initialize(D),T[y]=A}catch{}}),v.forEach(function(D){T[D].reset(),delete T[D]}),P.trigger(l.default.METRICS_INITIALISATION_COMPLETE)}}function S(){Object.keys(T).forEach(function(C){T[C].reset()}),T={}}function p(){P.on(O.MANIFEST_UPDATED,M,f),P.on(O.STREAM_TEARDOWN_COMPLETE,S,f)}function h(){P.off(O.MANIFEST_UPDATED,M,f),P.off(O.STREAM_TEARDOWN_COMPLETE,S,f)}return f={reset:h},p(),f}c.__dashjs_factory_name="MetricsCollectionController";const E=dashjs.FactoryMaker.getClassFactory(c)},"./src/streaming/metrics/controllers/MetricsController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/streaming/metrics/controllers/RangeController.js"),o=r("./src/streaming/metrics/controllers/ReportingController.js"),l=r("./src/streaming/metrics/controllers/MetricsHandlersController.js");function c(m){m=m||{};var f,T,L,P,O=this.context;function M(p){try{L=(0,d.default)(O).create({mediaElement:m.mediaElement}),L.initialize(p.Range),T=(0,o.default)(O).create({debug:m.debug,metricsConstants:m.metricsConstants,mediaPlayerModel:m.mediaPlayerModel}),T.initialize(p.Reporting,L),f=(0,l.default)(O).create({debug:m.debug,eventBus:m.eventBus,metricsConstants:m.metricsConstants,events:m.events}),f.initialize(p.metrics,T)}catch(h){throw S(),h}}function S(){f&&f.reset(),T&&T.reset(),L&&L.reset()}return P={initialize:M,reset:S},P}c.__dashjs_factory_name="MetricsController";const E=dashjs.FactoryMaker.getClassFactory(c)},"./src/streaming/metrics/controllers/MetricsHandlersController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/streaming/metrics/metrics/MetricsHandlerFactory.js");function o(c){c=c||{};var E=[],m,f=this.context,T=c.eventBus,L=c.events,P=(0,d.default)(f).getInstance({debug:c.debug,eventBus:c.eventBus,metricsConstants:c.metricsConstants});function O(p){E.forEach(function(h){h.handleNewMetric(p.metric,p.value,p.mediaType)})}function M(p,h){p.split(",").forEach(function(C,v,I){var D;if(C.indexOf("(")!==-1&&C.indexOf(")")===-1){var y=I[v+1];y&&y.indexOf("(")===-1&&y.indexOf(")")!==-1&&(C+=","+y,delete I[v+1])}D=P.create(C,h),D&&E.push(D)}),T.on(L.METRIC_ADDED,O,m),T.on(L.METRIC_UPDATED,O,m)}function S(){T.off(L.METRIC_ADDED,O,m),T.off(L.METRIC_UPDATED,O,m),E.forEach(function(p){return p.reset()}),E=[]}return m={initialize:M,reset:S},m}o.__dashjs_factory_name="MetricsHandlersController";const l=dashjs.FactoryMaker.getClassFactory(o)},"./src/streaming/metrics/controllers/RangeController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/streaming/utils/CustomTimeRanges.js");function o(c){c=c||{};var E=!1,m=this.context,f,T,L=c.mediaElement;function P(p){p&&p.length&&(p.forEach(function(h){var C=h.starttime,v=C+h.duration;T.add(C,v)}),E=!!p[0]._useWallClockTime)}function O(){T.clear()}function M(){T=(0,d.default)(m).create()}function S(){var p=T.length,h;if(!p)return!0;h=E?new Date().getTime()/1e3:L.currentTime;for(var C=0;C<p;C+=1){var v=T.start(C),I=T.end(C);if(v<=h&&h<I)return!0}return!1}return f={initialize:P,reset:O,isEnabled:S},M(),f}o.__dashjs_factory_name="RangeController";const l=dashjs.FactoryMaker.getClassFactory(o)},"./src/streaming/metrics/controllers/ReportingController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/streaming/metrics/reporting/ReportingFactory.js");function o(c){var E=[],m,f=(0,d.default)(this.context).getInstance(c);function T(O,M){O.some(function(S){var p=f.create(S,M);if(p)return E.push(p),!0})}function L(){E.forEach(function(O){return O.reset()}),E=[]}function P(O,M){E.forEach(function(S){return S.report(O,M)})}return m={initialize:T,reset:L,report:P},m}o.__dashjs_factory_name="ReportingController";const l=dashjs.FactoryMaker.getClassFactory(o)},"./src/streaming/metrics/metrics/MetricsHandlerFactory.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/streaming/metrics/metrics/handlers/BufferLevelHandler.js"),o=r("./src/streaming/metrics/metrics/handlers/DVBErrorsHandler.js"),l=r("./src/streaming/metrics/metrics/handlers/HttpListHandler.js"),c=r("./src/streaming/metrics/metrics/handlers/GenericMetricHandler.js");function E(f){f=f||{};var T,L=f.debug?f.debug.getLogger(T):{},P=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,O=this.context,M={BufferLevel:d.default,DVBErrors:o.default,HttpList:l.default,PlayList:c.default,RepSwitchList:c.default,TcpList:c.default};function S(C,v){var I=C.match(P),D;if(I){try{D=M[I[1]](O).create({eventBus:f.eventBus,metricsConstants:f.metricsConstants}),D.initialize(I[1],v,I[3],I[5])}catch(y){D=null,L.error("MetricsHandlerFactory: Could not create handler for type ".concat(I[1]," with args ").concat(I[3],", ").concat(I[5]," (").concat(y.message,")"))}return D}}function p(C,v){M[C]=v}function h(C){delete M[C]}return T={create:S,register:p,unregister:h},T}E.__dashjs_factory_name="MetricsHandlerFactory";const m=dashjs.FactoryMaker.getSingletonFactory(E)},"./src/streaming/metrics/metrics/handlers/BufferLevelHandler.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/streaming/metrics/utils/HandlerHelpers.js");function o(c){c=c||{};var E,m,f,T,L,P,O=this.context,M=(0,d.default)(O).getInstance(),S=[],p=c.metricsConstants;function h(){try{return Object.keys(S).map(function(y){return S[y]}).reduce(function(y,A){return y.level<A.level?y:A})}catch{return}}function C(){var y=h();y&&P!==y.t&&(P=y.t,m.report(T,y))}function v(y,A,x){A&&(f=M.validateN(x),m=A,T=M.reconstructFullMetricName(y,x),L=setInterval(C,f))}function I(){clearInterval(L),L=null,f=0,m=null,P=null}function D(y,A,x){y===p.BUFFER_LEVEL&&(S[x]=A)}return E={initialize:v,reset:I,handleNewMetric:D},E}o.__dashjs_factory_name="BufferLevelHandler";const l=dashjs.FactoryMaker.getClassFactory(o)},"./src/streaming/metrics/metrics/handlers/DVBErrorsHandler.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/streaming/metrics/MetricsReportingEvents.js");function o(c){c=c||{};var E,m,f=c.eventBus,T=c.metricsConstants;function L(){f.off(d.default.METRICS_INITIALISATION_COMPLETE,L,this),f.trigger(d.default.BECAME_REPORTING_PLAYER)}function P(S,p){p&&(m=p,f.on(d.default.METRICS_INITIALISATION_COMPLETE,L,this))}function O(){m=null}function M(S,p){S===T.DVB_ERRORS&&m&&m.report(S,p)}return E={initialize:P,reset:O,handleNewMetric:M},E}const l=dashjs.FactoryMaker.getClassFactory(o)},"./src/streaming/metrics/metrics/handlers/GenericMetricHandler.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>o});function d(){var l,c,E;function m(L,P){c=L,E=P}function f(){E=null,c=void 0}function T(L,P){L===c&&E&&E.report(c,P)}return l={initialize:m,reset:f,handleNewMetric:T},l}d.__dashjs_factory_name="GenericMetricHandler";const o=dashjs.FactoryMaker.getClassFactory(d)},"./src/streaming/metrics/metrics/handlers/HttpListHandler.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/streaming/metrics/utils/HandlerHelpers.js");function o(c){c=c||{};var E,m,f,T,L,P,O=[],M=(0,d.default)(this.context).getInstance(),S=c.metricsConstants;function p(){var I=O;I.length&&m&&m.report(L,I),O=[]}function h(I,D,y,A){D&&(f=M.validateN(y),m=D,A&&A.length&&(T=A),L=M.reconstructFullMetricName(I,y,A),P=setInterval(p,f))}function C(){clearInterval(P),P=null,f=null,T=null,O=[],m=null}function v(I,D){I===S.HTTP_REQUEST&&(!T||T===D.type)&&O.push(D)}return E={initialize:h,reset:C,handleNewMetric:v},E}o.__dashjs_factory_name="HttpListHandler";const l=dashjs.FactoryMaker.getClassFactory(o)},"./src/streaming/metrics/reporting/ReportingFactory.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/streaming/metrics/reporting/reporters/DVBReporting.js");function o(c){c=c||{};var E={"urn:dvb:dash:reporting:2014":d.default},m=this.context,f,T=c.debug?c.debug.getLogger(f):{},L=c.metricsConstants,P=c.mediaPlayerModel||{};function O(p,h){var C;try{C=E[p.schemeIdUri](m).create({metricsConstants:L,mediaPlayerModel:P}),C.initialize(p,h)}catch(v){C=null,T.error("ReportingFactory: could not create Reporting with schemeIdUri ".concat(p.schemeIdUri," (").concat(v.message,")"))}return C}function M(p,h){E[p]=h}function S(p){delete E[p]}return f={create:O,register:M,unregister:S},f}o.__dashjs_factory_name="ReportingFactory";const l=dashjs.FactoryMaker.getSingletonFactory(o)},"./src/streaming/metrics/reporting/reporters/DVBReporting.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/streaming/metrics/utils/MetricSerialiser.js"),o=r("./src/streaming/metrics/utils/RNG.js"),l=r("./src/streaming/models/CustomParametersModel.js");function c(m){m=m||{};var f,T=this.context,L,P,O,M,S,p,h,C=[],v=m.metricsConstants;function I(){L=(0,d.default)(T).getInstance(),O=(0,o.default)(T).getInstance(),P=(0,l.default)(T).getInstance(),x()}function D(k,W,V){var Q=new XMLHttpRequest;Q.withCredentials=P.getXHRWithCredentialsForType(v.HTTP_REQUEST_DVB_REPORTING_TYPE);var $=function(){var Y=C.indexOf(Q);Y!==-1&&(C.splice(Y,1),Q.status>=200&&Q.status<300?W&&W():V&&V())};C.push(Q);try{Q.open("GET",k),Q.onloadend=$,Q.onerror=$,Q.send()}catch{Q.onerror()}}function y(k,W){Array.isArray(W)||(W=[W]),S&&h.isEnabled()&&W.forEach(function(V){var Q=L.serialise(V);k!==v.DVB_ERRORS&&(Q="metricname=".concat(k,"&").concat(Q)),Q="".concat(p,"?").concat(Q),D(Q,null,function(){S=!1})})}function A(k,W){var V;if(h=W,p=k.dvb_reportingUrl,!p)throw new Error("required parameter missing (dvb:reportingUrl)");M||(V=k.dvb_probability,V&&(V===1e3||V/1e3>=O.random())&&(S=!0),M=!0)}function x(){M=!1,S=!1,p=null,h=null}function F(){x()}return f={report:y,initialize:A,reset:F},I(),f}c.__dashjs_factory_name="DVBReporting";const E=dashjs.FactoryMaker.getClassFactory(c)},"./src/streaming/metrics/utils/DVBErrorsTranslator.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/streaming/metrics/vo/DVBErrors.js"),o=r("./src/streaming/metrics/MetricsReportingEvents.js");function l(E){E=E||{};var m,f,T=E.eventBus,L=E.dashMetrics,P=E.metricsConstants,O=E.events;function M(A){var x=new d.default;if(f){for(var F in A)A.hasOwnProperty(F)&&(x[F]=A[F]);x.mpdurl||(x.mpdurl=f.originalUrl||f.url),x.terror||(x.terror=new Date),L.addDVBErrors(x)}}function S(A){A.error||(f=A.manifest)}function p(A){M({errorcode:d.default.BASE_URL_CHANGED,servicelocation:A.entry})}function h(){M({errorcode:d.default.BECAME_REPORTER})}function C(A){(A.responsecode===0||A.responsecode==null||A.responsecode>=400||A.responsecode<100||A.responsecode>=600)&&M({errorcode:A.responsecode||d.default.CONNECTION_ERROR,url:A.url,terror:A.tresponse,servicelocation:A._serviceLocation})}function v(A){switch(A.metric){case P.HTTP_REQUEST:C(A.value);break}}function I(A){var x=A.error?A.error.code:0,F;switch(x){case MediaError.MEDIA_ERR_NETWORK:F=d.default.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:F=d.default.CORRUPT_MEDIA_OTHER;break;default:return}M({errorcode:F})}function D(){T.on(O.MANIFEST_UPDATED,S,m),T.on(O.SERVICE_LOCATION_BLACKLIST_CHANGED,p,m),T.on(O.METRIC_ADDED,v,m),T.on(O.METRIC_UPDATED,v,m),T.on(O.PLAYBACK_ERROR,I,m),T.on(o.default.BECAME_REPORTING_PLAYER,h,m)}function y(){T.off(O.MANIFEST_UPDATED,S,m),T.off(O.SERVICE_LOCATION_BLACKLIST_CHANGED,p,m),T.off(O.METRIC_ADDED,v,m),T.off(O.METRIC_UPDATED,v,m),T.off(O.PLAYBACK_ERROR,I,m),T.off(o.default.BECAME_REPORTING_PLAYER,h,m)}return m={initialise:D,reset:y},m}l.__dashjs_factory_name="DVBErrorsTranslator";const c=dashjs.FactoryMaker.getSingletonFactory(l)},"./src/streaming/metrics/utils/HandlerHelpers.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>o});function d(){return{reconstructFullMetricName:function(c,E,m){var f=c;return E&&(f+="("+E,m&&m.length&&(f+=","+m),f+=")"),f},validateN:function(c){if(!c)throw new Error("missing n");if(isNaN(c))throw new Error("n is NaN");if(c<0)throw new Error("n must be positive");return c}}}d.__dashjs_factory_name="HandlerHelpers";const o=dashjs.FactoryMaker.getSingletonFactory(d)},"./src/streaming/metrics/utils/ManifestParsing.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/streaming/metrics/vo/Metrics.js"),o=r("./src/streaming/metrics/vo/Range.js"),l=r("./src/streaming/metrics/vo/Reporting.js");function c(m){m=m||{};var f,T=m.adapter,L=m.constants;function P(M,S,p){var h,C,v=0;return S?v=T.getAvailabilityStartTime(M)/1e3:(h=T.getRegularPeriods(M),h.length&&(v=h[0].start)),C=v,p&&p.hasOwnProperty(L.START_TIME)&&(C+=p.starttime),C}function O(M){var S=[];return M&&M.Metrics_asArray&&M.Metrics_asArray.forEach(function(p){var h=new d.default,C=T.getIsDynamic(M);if(p.hasOwnProperty("metrics"))h.metrics=p.metrics;else return;if(p.Range_asArray&&p.Range_asArray.forEach(function(v){var I=new o.default;I.starttime=P(M,C,v),v.hasOwnProperty("duration")?I.duration=v.duration:I.duration=T.getDuration(M),I._useWallClockTime=C,h.Range.push(I)}),p.Reporting_asArray)p.Reporting_asArray.forEach(function(v){var I=new l.default;if(v.hasOwnProperty(L.SCHEME_ID_URI))I.schemeIdUri=v.schemeIdUri;else return;v.hasOwnProperty("value")&&(I.value=v.value),v.hasOwnProperty(L.DVB_REPORTING_URL)&&(I.dvb_reportingUrl=v[L.DVB_REPORTING_URL]),v.hasOwnProperty(L.DVB_PROBABILITY)&&(I.dvb_probability=v[L.DVB_PROBABILITY]),h.Reporting.push(I)});else return;S.push(h)}),S}return f={getMetrics:O},f}c.__dashjs_factory_name="ManifestParsing";const E=dashjs.FactoryMaker.getSingletonFactory(c)},"./src/streaming/metrics/utils/MetricSerialiser.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>o});function d(){function l(c){var E=[],m=[],f,T;for(f in c)if(c.hasOwnProperty(f)&&f.indexOf("_")!==0){if(T=c[f],T==null&&(T=""),Array.isArray(T)){if(!T.length)continue;m=[],T.forEach(function(L){var P=Object.prototype.toString.call(L).slice(8,-1)!=="Object";m.push(P?L:l(L))}),T=m.map(encodeURIComponent).join(",")}else typeof T=="string"?T=encodeURIComponent(T):T instanceof Date?T=T.toISOString():typeof T=="number"&&(T=Math.round(T));E.push(f+"="+T)}return E.join("&")}return{serialise:l}}d.__dashjs_factory_name="MetricSerialiser";const o=dashjs.FactoryMaker.getSingletonFactory(d)},"./src/streaming/metrics/utils/RNG.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>o});function d(){var l=window.crypto||window.msCrypto,c=Uint32Array,E=Math.pow(2,c.BYTES_PER_ELEMENT*8)-1,m=10,f,T,L;function P(){l&&(f||(f=new c(m)),l.getRandomValues(f),T=0)}function O(M,S){var p;return M||(M=0),S||(S=1),l?(T===f.length&&P(),p=f[T]/E,T+=1):p=Math.random(),p*(S-M)+M}return L={random:O},P(),L}d.__dashjs_factory_name="RNG";const o=dashjs.FactoryMaker.getSingletonFactory(d)},"./src/streaming/metrics/vo/DVBErrors.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};o.SSL_CONNECTION_FAILED_PREFIX="SSL",o.DNS_RESOLUTION_FAILED="C00",o.HOST_UNREACHABLE="C01",o.CONNECTION_REFUSED="C02",o.CONNECTION_ERROR="C03",o.CORRUPT_MEDIA_ISOBMFF="M00",o.CORRUPT_MEDIA_OTHER="M01",o.BASE_URL_CHANGED="F00",o.BECAME_REPORTER="S00";const l=o},"./src/streaming/metrics/vo/Metrics.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.metrics="",this.Range=[],this.Reporting=[]};const l=o},"./src/streaming/metrics/vo/Range.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1};const l=o},"./src/streaming/metrics/vo/Reporting.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});function d(E,m){if(!(E instanceof m))throw new TypeError("Cannot call a class as a function")}var o=1e3,l=function E(){d(this,E),this.schemeIdUri="",this.value="",this.dvb_reportingUrl="",this.dvb_probability=o};const c=l},"./src/streaming/models/BaseURLTreeModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>f});var d=r("./src/streaming/utils/ObjectUtils.js"),o=r("./src/core/FactoryMaker.js");function l(T,L){if(!(T instanceof L))throw new TypeError("Cannot call a class as a function")}var c=NaN,E=function T(L,P){l(this,T),this.data={baseUrls:L||null,selectedIdx:P||c},this.children=[]};function m(){var T,L,P,O=this.context,M=(0,d.default)(O).getInstance();function S(){A()}function p(F){F.adapter&&(P=F.adapter)}function h(){if(!P||!P.hasOwnProperty("getBaseURLsFromElement")||!P.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}function C(F,k,W){var V=P.getBaseURLsFromElement(W);F[k]?M.areEqual(V,F[k].data.baseUrls)||(F[k].data.baseUrls=V,F[k].data.selectedIdx=c):F[k]=new E(V)}function v(F){h();var k=P.getBaseURLsFromElement(F);M.areEqual(k,L.data.baseUrls)||(L.data.baseUrls=k,L.data.selectedIdx=c),F&&F.Period_asArray&&F.Period_asArray.forEach(function(W,V){C(L.children,V,W),W.AdaptationSet_asArray&&W.AdaptationSet_asArray.forEach(function(Q,$){C(L.children[V].children,$,Q),Q.Representation_asArray&&Q.Representation_asArray.sort(P.getRepresentationSortFunction()).forEach(function(K,Y){C(L.children[V].children[$].children,Y,K)})})})}function I(F,k){var W=k||L;F(W.data),W.children&&W.children.forEach(function(V){return I(F,V)})}function D(F){I(function(k){isNaN(k.selectedIdx)||F===k.baseUrls[k.selectedIdx].serviceLocation&&(k.selectedIdx=c)})}function y(F){v(F)}function A(){L=new E}function x(F){var k=L,W=[k.data];return F&&F.forEach(function(V){k=k.children[V],k&&W.push(k.data)}),W.filter(function(V){return V.baseUrls.length})}return T={reset:A,update:y,getForPath:x,invalidateSelectedIndexes:D,setConfig:p},S(),T}m.__dashjs_factory_name="BaseURLTreeModel";const f=o.default.getClassFactory(m)},"./src/streaming/models/CmcdModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>y});var d=r("./src/core/EventBus.js"),o=r("./src/streaming/MediaPlayerEvents.js"),l=r("./src/streaming/metrics/MetricsReportingEvents.js"),c=r("./src/core/FactoryMaker.js"),E=r("./src/core/Settings.js"),m=r("./src/streaming/constants/Constants.js"),f=r("./src/streaming/vo/metrics/HTTPRequest.js"),T=r("./src/dash/models/DashManifestModel.js"),L=r("./src/core/Utils.js");function P(A,x){var F;if(typeof Symbol>"u"||A[Symbol.iterator]==null){if(Array.isArray(A)||(F=O(A))||x&&A&&typeof A.length=="number"){F&&(A=F);var k=0,W=function(){};return{s:W,n:function(){return k>=A.length?{done:!0}:{done:!1,value:A[k++]}},e:function(Y){throw Y},f:W}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var V=!0,Q=!1,$;return{s:function(){F=A[Symbol.iterator]()},n:function(){var Y=F.next();return V=Y.done,Y},e:function(Y){Q=!0,$=Y},f:function(){try{!V&&F.return!=null&&F.return()}finally{if(Q)throw $}}}}function O(A,x){if(A){if(typeof A=="string")return M(A,x);var F=Object.prototype.toString.call(A).slice(8,-1);if(F==="Object"&&A.constructor&&(F=A.constructor.name),F==="Map"||F==="Set")return Array.from(A);if(F==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(F))return M(A,x)}}function M(A,x){(x==null||x>A.length)&&(x=A.length);for(var F=0,k=new Array(x);F<x;F++)k[F]=A[F];return k}var S="CMCD",p=1,h={MANIFEST:"m",AUDIO:"a",VIDEO:"v",INIT:"i",CAPTION:"c",ISOBMFF_TEXT_TRACK:"tt",ENCRYPTION_KEY:"k",OTHER:"o"},C={DASH:"d",MSS:"s"},v={VOD:"v",LIVE:"l"},I=5;function D(){var A,x,F,k,W,V,Q,$,K,Y,re=this.context,ie=(0,d.default)(re).getInstance(),ee=(0,E.default)(re).getInstance();function ne(){A=(0,T.default)(re).getInstance(),X()}function ae(){ie.on(o.default.PLAYBACK_RATE_CHANGED,ve,x),ie.on(o.default.MANIFEST_LOADED,me,x),ie.on(o.default.BUFFER_LEVEL_STATE_CHANGED,Ae,x),ie.on(o.default.PLAYBACK_SEEKED,be,x),ie.on(o.default.PERIOD_SWITCH_COMPLETED,oe,x)}function ce(Se){Se&&(Se.abrController&&(k=Se.abrController),Se.dashMetrics&&(W=Se.dashMetrics),Se.playbackController&&(V=Se.playbackController))}function X(){F={pr:1,nor:null,st:null,sf:null,sid:"".concat(L.default.generateUuid()),cid:null},K={},$={},Y={},ge()}function oe(){ge()}function ge(){if(V){var Se=V.getStreamController();if(Se&&typeof Se.getActiveStream=="function"){var Me=Se.getActiveStream();Me&&(Q=Me.getProcessors())}}}function _e(Se){try{if(ee.get().streaming.cmcd&&ee.get().streaming.cmcd.enabled){var Me=le(Se),qe=he(Me),it=Be(qe);return ie.trigger(l.default.CMCD_DATA_GENERATED,{url:Se.url,mediaType:Se.mediaType,cmcdData:Me,cmcdString:it}),{key:S,value:it}}return null}catch{return null}}function he(Se){try{var Me=ee.get().streaming.cmcd.enabledKeys;return Object.keys(Se).filter(function(qe){return Me.includes(qe)}).reduce(function(qe,it){return qe[it]=Se[it],qe},{})}catch{return Se}}function se(Se,Me){var qe={},it=P(Me),at;try{for(it.s();!(at=it.n()).done;){var Ce=at.value;Se[Ce]&&(qe[Ce]=Se[Ce])}}catch(We){it.e(We)}finally{it.f()}return qe}function Z(Se){try{if(ee.get().streaming.cmcd&&ee.get().streaming.cmcd.enabled){var Me=le(Se),qe=se(Me,q(["br","d","ot","tb"])),it=se(Me,q(["bl","dl","mtp","nor","nrr","su"])),at=se(Me,q(["bs","rtp"])),Ce=se(Me,q(["cid","pr","sf","sid","st","v"])),We={"CMCD-Object":Be(qe),"CMCD-Request":Be(it),"CMCD-Status":Be(at),"CMCD-Session":Be(Ce)};return ie.trigger(l.default.CMCD_DATA_GENERATED,{url:Se.url,mediaType:Se.mediaType,cmcdData:Me,headers:We}),We}return null}catch{return null}}function q(Se){var Me=ee.get().streaming.cmcd.enabledKeys;return Se.filter(function(qe){return Me.includes(qe)})}function le(Se){try{var Me=null;return Se.type===f.HTTPRequest.MPD_TYPE?N(Se):Se.type===f.HTTPRequest.MEDIA_SEGMENT_TYPE?(w(Se.mediaType),R(Se)):Se.type===f.HTTPRequest.INIT_SEGMENT_TYPE?j(Se):Se.type===f.HTTPRequest.OTHER_TYPE||Se.type===f.HTTPRequest.XLINK_EXPANSION_TYPE?H(Se):Se.type===f.HTTPRequest.LICENSE?te(Se):Me}catch{return null}}function te(Se){var Me=U();return Me.ot=h.ENCRYPTION_KEY,Me}function N(){var Se=U();return Se.ot=h.MANIFEST,Se}function R(Se){var Me=U(),qe=B(Se),it=z(Se),at=fe(Se.mediaType),Ce=ue(Se.mediaType),We=J(Se.mediaType),Ge=G(Se.mediaType),tt=F.pr,ot=ke(Se.mediaType),ct;Se.mediaType===m.default.VIDEO&&(ct=h.VIDEO),Se.mediaType===m.default.AUDIO&&(ct=h.AUDIO),Se.mediaType===m.default.TEXT&&(Se.mediaInfo.mimeType==="application/mp4"?ct=h.ISOBMFF_TEXT_TRACK:ct=h.CAPTION);var ht=ee.get().streaming.cmcd.rtp;return ht||(ht=Ye(Se)),Me.rtp=ht,ot&&(Se.url!==ot.url?Me.nor=encodeURIComponent(L.default.getRelativeUrl(Se.url,ot.url)):ot.range&&(Me.nrr=ot.range)),qe&&(Me.br=qe),ct&&(Me.ot=ct),isNaN(it)||(Me.d=it),isNaN(at)||(Me.mtp=at),isNaN(Ce)||(Me.dl=Ce),isNaN(We)||(Me.bl=We),isNaN(Ge)||(Me.tb=Ge),!isNaN(tt)&&tt!==1&&(Me.pr=tt),K[Se.mediaType]&&(Me.bs=!0,K[Se.mediaType]=!1),($[Se.mediaType]||!Y[Se.mediaType])&&(Me.su=!0,$[Se.mediaType]=!1,Y[Se.mediaType]=!0),Me}function w(Se){Y.hasOwnProperty(Se)||(Y[Se]=!1),$.hasOwnProperty(Se)||($[Se]=!1),K.hasOwnProperty(Se)||(K[Se]=!1)}function j(){var Se=U();return Se.ot=h.INIT,Se.su=!0,Se}function H(){var Se=U();return Se.ot=h.OTHER,Se}function U(){var Se={},Me=ee.get().streaming.cmcd.cid?ee.get().streaming.cmcd.cid:F.cid;return Se.v=p,Se.sid=ee.get().streaming.cmcd.sid?ee.get().streaming.cmcd.sid:F.sid,Se.sid="".concat(Se.sid),Me&&(Se.cid="".concat(Me)),!isNaN(F.pr)&&F.pr!==1&&F.pr!==null&&(Se.pr=F.pr),F.st&&(Se.st=F.st),F.sf&&(Se.sf=F.sf),Se}function B(Se){try{var Me=Se.quality,qe=Se.mediaInfo.bitrateList;return parseInt(qe[Me].bandwidth/1e3)}catch{return null}}function G(Se){try{var Me=k.getTopBitrateInfoFor(Se);return Math.round(Me.bitrate/1e3)}catch{return null}}function z(Se){try{return isNaN(Se.duration)?null:Math.round(Se.duration*1e3)}catch{return null}}function fe(Se){try{return parseInt(k.getThroughputHistory().getSafeAverageThroughput(Se)/100)*100}catch{return null}}function ue(Se){try{var Me=F.pr,qe=W.getCurrentBufferLevel(Se);return!isNaN(Me)&&!isNaN(qe)?parseInt(qe/Me*10)*100:null}catch{return null}}function J(Se){try{var Me=W.getCurrentBufferLevel(Se);return isNaN(Me)?null:parseInt(Me*10)*100}catch{return null}}function ve(Se){try{F.pr=Se.playbackRate}catch{}}function me(Se){try{var Me=A.getIsDynamic(Se.data),qe=Me?v.LIVE:v.VOD,it=Se.protocol&&Se.protocol==="MSS"?C.MSS:C.DASH;F.st="".concat(qe),F.sf="".concat(it)}catch{}}function Ae(Se){try{Se.state&&Se.mediaType&&Se.state===o.default.BUFFER_EMPTY&&(K[Se.mediaType]||(K[Se.mediaType]=!0),$[Se.mediaType]||($[Se.mediaType]=!0))}catch{}}function be(){for(var Se in K)K.hasOwnProperty(Se)&&(K[Se]=!0);for(var Me in $)$.hasOwnProperty(Me)&&($[Me]=!0)}function Be(Se){try{if(!Se)return null;var Me=Object.keys(Se).sort(function(at,Ce){return at.localeCompare(Ce)}),qe=Me.length,it=Me.reduce(function(at,Ce,We){return Ce==="v"&&Se[Ce]===1||(typeof Se[Ce]=="string"&&Ce!=="ot"&&Ce!=="sf"&&Ce!=="st"?at+="".concat(Ce,"=").concat(JSON.stringify(Se[Ce])):at+="".concat(Ce,"=").concat(Se[Ce]),We<qe-1&&(at+=",")),at},"");return it=it.replace(/=true/g,""),it=it.replace(/,\s*$/,""),it}catch{return null}}function ke(Se){if(!(!Q||Q.length===0)){var Me=P(Q),qe;try{for(Me.s();!(qe=Me.n()).done;){var it=qe.value;if(it.getType()===Se)return it.probeNextRequest()}}catch(at){Me.e(at)}finally{Me.f()}}}function Ye(Se){var Me=V.getPlaybackRate();Me||(Me=1);var qe=Se.quality,it=Se.mediaType,at=Se.mediaInfo,Ce=Se.duration,We=J(it);We===0&&(We=500);var Ge=at.bitrateList[qe].bandwidth,tt=Ge*Ce/1e3,ot=We/Me/1e3,ct=tt/ot,ht=ee.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(ee.get().streaming.cmcd.rtpSafetyFactor)?ee.get().streaming.cmcd.rtpSafetyFactor:I,Pt=ct*ht,$e=(parseInt(Pt/100)+1)*100;return $e}function Oe(){ie.off(o.default.PLAYBACK_RATE_CHANGED,ve,this),ie.off(o.default.MANIFEST_LOADED,me,this),ie.off(o.default.BUFFER_LEVEL_STATE_CHANGED,Ae,x),ie.off(o.default.PLAYBACK_SEEKED,be,x),X()}return x={getQueryParameter:_e,getHeaderParameters:Z,setConfig:ce,reset:Oe,initialize:ae},ne(),x}D.__dashjs_factory_name="CmcdModel";const y=c.default.getSingletonFactory(D)},"./src/streaming/models/CmsdModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>W});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),c=r("./src/core/Debug.js");function E(V){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?E=function($){return typeof $}:E=function($){return $&&typeof Symbol=="function"&&$.constructor===Symbol&&$!==Symbol.prototype?"symbol":typeof $},E(V)}function m(V,Q){m=function(ne,ae){return new re(ne,void 0,ae)};var $=T(RegExp),K=RegExp.prototype,Y=new WeakMap;function re(ee,ne,ae){var ce=$.call(this,ee,ne);return Y.set(ce,ae||Y.get(ee)),ce}f(re,$),re.prototype.exec=function(ee){var ne=K.exec.call(this,ee);return ne&&(ne.groups=ie(ne,this)),ne},re.prototype[Symbol.replace]=function(ee,ne){if(typeof ne=="string"){var ae=Y.get(this);return K[Symbol.replace].call(this,ee,ne.replace(/\$<([^>]+)>/g,function(X,oe){return"$"+ae[oe]}))}else if(typeof ne=="function"){var ce=this;return K[Symbol.replace].call(this,ee,function(){var X=[];return X.push.apply(X,arguments),E(X[X.length-1])!=="object"&&X.push(ie(X,ce)),ne.apply(this,X)})}else return K[Symbol.replace].call(this,ee,ne)};function ie(ee,ne){var ae=Y.get(ne);return Object.keys(ae).reduce(function(ce,X){return ce[X]=ee[ae[X]],ce},Object.create(null))}return m.apply(this,arguments)}function f(V,Q){if(typeof Q!="function"&&Q!==null)throw new TypeError("Super expression must either be null or a function");V.prototype=Object.create(Q&&Q.prototype,{constructor:{value:V,writable:!0,configurable:!0}}),Q&&M(V,Q)}function T(V){var Q=typeof Map=="function"?new Map:void 0;return T=function(K){if(K===null||!O(K))return K;if(typeof K!="function")throw new TypeError("Super expression must either be null or a function");if(typeof Q<"u"){if(Q.has(K))return Q.get(K);Q.set(K,Y)}function Y(){return L(K,arguments,S(this).constructor)}return Y.prototype=Object.create(K.prototype,{constructor:{value:Y,enumerable:!1,writable:!0,configurable:!0}}),M(Y,K)},T(V)}function L(V,Q,$){return P()?L=Reflect.construct:L=function(Y,re,ie){var ee=[null];ee.push.apply(ee,re);var ne=Function.bind.apply(Y,ee),ae=new ne;return ie&&M(ae,ie.prototype),ae},L.apply(null,arguments)}function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function O(V){return Function.toString.call(V).indexOf("[native code]")!==-1}function M(V,Q){return M=Object.setPrototypeOf||function(K,Y){return K.__proto__=Y,K},M(V,Q)}function S(V){return S=Object.setPrototypeOf?Object.getPrototypeOf:function($){return $.__proto__||Object.getPrototypeOf($)},S(V)}var p="static",h="dynamic",C="cmsd-",v=C+p,I=C+h,D={AVAILABILITY_TIME:"at",DURESS:"du",ENCODED_BITRATE:"br",ESTIMATED_THROUGHPUT:"etp",HELD_TIME:"ht",INTERMEDIARY_IDENTIFIER:"n",MAX_SUGGESTED_BITRATE:"mb",NEXT_OBJECT_RESPONSE:"nor",NEXT_RANGE_RESPONSE:"nrr",OBJECT_DURATION:"d",OBJECT_TYPE:"ot",RESPONSE_DELAY:"rd",ROUND_TRIP_TIME:"rtt",STARTUP:"su",STREAM_TYPE:"st",STREAMING_FORMAT:"sf",VERSION:"v"},y={MANIFEST:"m",AUDIO:"a",VIDEO:"v",INIT:"i",CAPTION:"c",ISOBMFF_TEXT_TRACK:"tt",ENCRYPTION_KEY:"k",OTHER:"o",STREAM:"stream"},A=[D.MAX_SUGGESTED_BITRATE,D.STREAM_TYPE,D.STREAMING_FORMAT,D.VERSION],x={video:y.VIDEO,audio:y.AUDIO,text:y.ISOBMFF_TEXT_TRACK,stream:y.STREAM},F=/^[-0-9]/;function k(){var V=this.context,Q=(0,o.default)(V).getInstance(),$,K,Y,re;function ie(){K=(0,c.default)(V).getInstance().getLogger($),ae()}function ee(){}function ne(){}function ae(){Y={},re={}}function ce(R){R&&Object.keys(R).forEach(function(w){A.includes(w)||delete R[w]})}function X(R){return R?R.toLowerCase()==="false"?!1:F.test(R)?parseInt(R,10):R.replace(/["]+/g,""):!0}function oe(R){try{for(var w={},j=R.split(","),H=0;H<j.length;H++){var U=j[H].split("="),B=U[0],G=X(U[1]);w[B]=G}return w}catch(z){K.error("Failed to parse CMSD-Static response header value:",z)}}function ge(R){try{for(var w={},j=R.split(","),H=j[j.length-1],U=H.split(";"),B=1;B<U.length;B++){var G=U[B].split("="),z=G[0],fe=X(G[1]);w[z]=fe}return w}catch(ue){return K.error("Failed to parse CMSD-Dynamic response header value:",ue),[]}}function _e(R){return x[R]||y.OTHER}function he(R,w,j){var H=R===p?Y:re,U=H[w]||{},B=H[y.STREAM]||{},G=U[j]||B[j];return G}function se(R,w){for(var j=null,H=null,U=R.split(`\r
`),B=U.length-1;B>=0;B--){var G=U[B],z=G.match(m(/^((?:(?!:)[\s\S])*):[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(.*)$/,{key:1,value:2}));if(z&&z.groups){var fe=z.groups.key.toLowerCase(),ue=z.groups.value;switch(fe){case v:j=oe(ue),Q.trigger(l.default.CMSD_STATIC_HEADER,j);break;case I:H||(H=ge(ue));break}}}var J=y.STREAM;return j&&j[D.OBJECT_TYPE]?J=j[D.OBJECT_TYPE]:w&&(J=_e(w)),ce(Y[J]),ce(re[J]),j&&(Y[J]=Object.assign(Y[J]||{},j)),H&&(re[J]=Object.assign(re[J]||{},H)),{static:j,dynamic:H}}function Z(R){var w=_e(R),j=he(h,w,D.MAX_SUGGESTED_BITRATE);return j||-1}function q(R){var w=_e(R),j=he(h,w,D.ESTIMATED_THROUGHPUT);return j||null}function le(R){var w=_e(R),j=he(h,w,D.RESPONSE_DELAY);return j||null}function te(R){var w=_e(R),j=he(h,w,D.ROUND_TRIP_TIME);return j||null}function N(){ae()}return $={setConfig:ne,initialize:ee,reset:N,parseResponseHeaders:se,getMaxBitrate:Z,getEstimatedThroughput:q,getResponseDelay:le,getRoundTripTime:te},ie(),$}k.__dashjs_factory_name="CmsdModel";const W=d.default.getSingletonFactory(k)},"./src/streaming/models/CustomParametersModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>L});var d=r("./src/dash/vo/UTCTiming.js"),o=r("./src/core/FactoryMaker.js"),l=r("./src/core/Settings.js"),c=r("./src/streaming/utils/SupervisorTools.js"),E=r("./src/streaming/rules/abr/ABRRulesCollection.js"),m=r("./src/streaming/constants/Constants.js"),f=!1;function T(){var P,O,M,S,p,h,C,v,I=this.context,D=(0,l.default)(I).getInstance();function y(){M={default:f},A()}function A(){S=[],p=[],h=[],v=[],C=null,O=[]}function x(){A()}function F(){}function k(w){C=w}function W(){C=null}function V(){return C}function Q(){return S}function $(){return p}function K(w){S.push(w)}function Y(w){p.push(w)}function re(w){ce(S,w)}function ie(w){ce(p,w)}function ee(){return h}function ne(w){h.push(w)}function ae(w){ce(h,w)}function ce(w,j){var H=-1;w.some(function(U,B){if(U===j)return H=B,!0}),!(H<0)&&w.splice(H,1)}function X(w){var j;for(j=0;j<v.length;j++)if(v[j].rulename===w)return j;return-1}function oe(w,j,H){if(typeof w!="string"||w!==E.default.ABANDON_FRAGMENT_RULES&&w!==E.default.QUALITY_SWITCH_RULES||typeof j!="string")throw m.default.BAD_ARGUMENT_ERROR;var U=X(j);U===-1?v.push({type:w,rulename:j,rule:H}):(v[U].type=w,v[U].rule=H)}function ge(w){if(w){var j=X(w);j!==-1&&v.splice(j,1)}else v=[]}function _e(){v=[]}function he(){return v}function se(w,j){q(w,j);var H=new d.default;H.schemeIdUri=w,H.value=j,O.push(H)}function Z(){return O}function q(w,j){(0,c.checkParameterType)(w,"string"),(0,c.checkParameterType)(j,"string"),O.forEach(function(H,U){H.schemeIdUri===w&&H.value===j&&O.splice(U,1)})}function le(){O=[]}function te(){var w=D.get().streaming.utcSynchronization.defaultTimingSource;se(w.scheme,w.value)}function N(w,j){w?M[w]=!!j:Object.keys(M).forEach(function(H){N(H,j)})}function R(w){var j=M[w];return j===void 0?M.default:j}return P={getCustomInitialTrackSelectionFunction:V,setCustomInitialTrackSelectionFunction:k,resetCustomInitialTrackSelectionFunction:W,getLicenseResponseFilters:$,getLicenseRequestFilters:Q,getCustomCapabilitiesFilters:ee,registerCustomCapabilitiesFilter:ne,registerLicenseResponseFilter:Y,registerLicenseRequestFilter:K,unregisterCustomCapabilitiesFilter:ae,unregisterLicenseResponseFilter:ie,unregisterLicenseRequestFilter:re,addAbrCustomRule:oe,removeAllAbrCustomRule:_e,removeAbrCustomRule:ge,getAbrCustomRules:he,addUTCTimingSource:se,removeUTCTimingSource:q,getUTCTimingSources:Z,clearDefaultUTCTimingSources:le,restoreDefaultUTCTimingSources:te,setXHRWithCredentialsForType:N,getXHRWithCredentialsForType:R,setConfig:F,reset:x},y(),P}T.__dashjs_factory_name="CustomParametersModel";const L=o.default.getSingletonFactory(T)},"./src/streaming/models/FragmentModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>L});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/vo/FragmentRequest.js"),l="loading",c="executed",E="canceled",m="failed";function f(P){P=P||{};var O=P.eventBus,M=P.events,S=P.dashMetrics,p=P.fragmentLoader,h=P.debug,C=P.streamInfo,v=P.type,I,D,y,A;function x(){D=h.getLogger(I),Z(),O.on(M.LOADING_COMPLETED,_e,I),O.on(M.LOADING_DATA_PROGRESS,he,I),O.on(M.LOADING_ABANDONED,se,I)}function F(){return C.id}function k(){return v}function W(te){var N=function(U,B){return U.action===o.default.ACTION_COMPLETE&&U.action===B.action},R=function(U,B){return!isNaN(U.index)&&U.startTime===B.startTime&&U.adaptationIndex===B.adaptationIndex&&U.type===B.type},w=function(U,B){return isNaN(U.index)&&isNaN(B.index)&&U.quality===B.quality},j=function(U){var B=!1;return U.some(function(G){if(R(te,G)||w(te,G)||N(te,G))return B=!0,B}),B};return te?j(y):!1}function V(te){var N=!1,R=0,w;if(N=W(te),!N)for(R=0;R<A.length;R++)w=A[R],te.url===w.url&&te.startTime===w.startTime&&(N=!0);return N}function Q(te){var N=te?te.state instanceof Array?te.state:[te.state]:[],R=[];return N.forEach(function(w){var j=oe(w);R=R.concat(X(j,te))}),R}function $(te){return isNaN(te.duration)?.25:Math.min(te.duration/8,.5)}function K(te){y=y.filter(function(N){var R=$(N);return isNaN(N.startTime)||(te!==void 0?N.startTime>=te-R:!1)})}function Y(te){y=y.filter(function(N){return isNaN(N.startTime)||(te!==void 0?N.startTime<te:!1)})}function re(te,N){N<=te+.5||(y=y.filter(function(R){var w=$(R);return isNaN(R.startTime)||R.startTime>=N-w||isNaN(R.duration)||R.startTime+R.duration<=te+w}))}function ie(te,N){if(!te||te.length===0){K();return}for(var R=0,w=0,j=te.length;w<j;w++)re(R,te.start(w)),R=te.end(w);N>0&&re(R,N)}function ee(){D.debug("abort requests"),p.abort(),A=[]}function ne(te){switch(te.action){case o.default.ACTION_DOWNLOAD:ge(te,l),A.push(te),ae(te);break;default:D.warn("Unknown request action.")}}function ae(te){O.trigger(M.FRAGMENT_LOADING_STARTED,{request:te},{streamId:C.id,mediaType:v}),p.load(te)}function ce(te,N,R){for(var w=te.length-1,j=w;j>=0;j--){var H=te[j],U=H.startTime,B=U+H.duration;if(R=isNaN(R)?$(H):R,!isNaN(U)&&!isNaN(B)&&N+R>=U&&N-R<B||isNaN(U)&&isNaN(N))return H}return null}function X(te,N){return N.hasOwnProperty("time")?[ce(te,N.time,N.threshold)]:te.filter(function(R){for(var w in N)if(w!=="state"&&N.hasOwnProperty(w)&&R[w]!=N[w])return!1;return!0})}function oe(te){var N;switch(te){case l:N=A;break;case c:N=y;break;default:N=[]}return N}function ge(te,N){S.addSchedulingInfo(te,N),S.addRequestsQueue(te.mediaType,A,y)}function _e(te){te.sender===p&&(A.splice(A.indexOf(te.request),1),te.response&&!te.error&&y.push(te.request),ge(te.request,te.error?m:c),O.trigger(M.FRAGMENT_LOADING_COMPLETED,{request:te.request,response:te.response,error:te.error,sender:this},{streamId:C.id,mediaType:v}))}function he(te){te.sender===p&&O.trigger(M.FRAGMENT_LOADING_PROGRESS,{request:te.request,response:te.response,error:te.error,sender:this},{streamId:C.id,mediaType:v})}function se(te){te.sender===p&&O.trigger(M.FRAGMENT_LOADING_ABANDONED,{request:te.request},{streamId:C.id,mediaType:v})}function Z(){y=[],A=[]}function q(){O.off(M.LOADING_COMPLETED,_e,this),O.off(M.LOADING_DATA_PROGRESS,he,this),O.off(M.LOADING_ABANDONED,se,this),p&&p.reset(),Z()}function le(te){y.push(te)}return I={getStreamId:F,getType:k,getRequests:Q,isFragmentLoaded:W,isFragmentLoadedOrPending:V,removeExecutedRequestsBeforeTime:K,removeExecutedRequestsAfterTime:Y,syncExecutedRequestsWithBufferedRange:ie,abortRequests:ee,executeRequest:ne,reset:q,resetInitialSettings:Z,addExecutedRequest:le},x(),I}f.__dashjs_factory_name="FragmentModel";var T=d.default.getClassFactory(f);T.FRAGMENT_MODEL_LOADING=l,T.FRAGMENT_MODEL_EXECUTED=c,T.FRAGMENT_MODEL_CANCELED=E,T.FRAGMENT_MODEL_FAILED=m,d.default.updateClassFactory(f.__dashjs_factory_name,T);const L=T},"./src/streaming/models/LowLatencyThroughputModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/core/Debug.js"),o=r("./src/core/FactoryMaker.js");function l(){var E=10,m=.8,f=.6,T=1.05,L=250,P=this.context,O,M,S={};function p(){M=(0,d.default)(P).getInstance().getLogger(O)}function h(y){for(var A={},x=0,F=0,k=0,W=0,V=y.length,Q=0;Q<V;++Q)x+=y[Q].chunkDownloadTimeRelativeMS,F+=y[Q].bufferLevel,k+=y[Q].chunkDownloadTimeRelativeMS*y[Q].bufferLevel,W+=y[Q].chunkDownloadTimeRelativeMS*y[Q].chunkDownloadTimeRelativeMS;return A.m=(k-x*F/V)/(W-x*x/V),A.b=F/V-A.m*x/V,function($){return A.m*$+A.b}}function C(y){var A=!0,x,F=y.reduce(function(k,W){return k+W.bufferLevelAtSegmentEnd},0)/y.length;return y.forEach(function(k){Math.abs(k.bufferLevelAtSegmentEnd/k.bufferLevelAtSegmentStart)<.95&&(A=!1),k.bufferLevelAtSegmentEnd/F<.8&&(A=!1),x?x>k.bitrate&&(A=!1):x=k.bitrate}),A}function v(y){var A=S[y.mediaType].slice(-1).pop(),x=S[y.mediaType].slice(-3),F=A.chunkMeasurements.slice(-1).pop().chunkDownloadTimeRelativeMS;A.bufferLevelAtSegmentStart=A.getEstimatedBufferLevel(F/2),A.bufferLevelAtSegmentEnd=A.getEstimatedBufferLevel(F);var k=C(x),W=k?f:m;if(A.isBufferStable&&A.segDurationMS*T<A.fetchDownloadDurationMS)return A.fetchDownloadDurationMS;if(!k||A.segDurationMS<A.fetchDownloadDurationMS||A.adjustedAvailabilityStartTimeMS<=A.requestTimeMS+A.throughputCapacityDelayMS-A.segDurationMS)return A.fetchDownloadDurationMS*m;for(var V=A.requestTimeMS+A.throughputCapacityDelayMS-A.adjustedAvailabilityStartTimeMS,Q=0,$=0,K=0,Y=0;Y<A.chunkMeasurements.length;Y++){var re=A.chunkMeasurements[Y];if(V<$+re.chunkDownloadDurationMS)break;$+=re.chunkDownloadDurationMS,Q+=re.chunkBytes,K++}if(V<0&&M.warn("request time was before adjusted availibitly start time"),Q&&$&&K>A.chunkMeasurements.length*.2){var ie=Q/$,ee=A.segmentBytes/ie;return A.fetchDownloadDurationMS<ee?A.fetchDownloadDurationMS*W:ee*W}var ne=A.bitrate;return A.bitrateList.some(function(ae){if(ae.bandwidth>A.bitrate)return ne=ae.bandwidth,!0}),ne===A.bitrate?A.fetchDownloadDurationMS*W:W*A.segmentBytes*8*1e3/ne}function I(y,A){var x=S[y.mediaType]&&S[y.mediaType].slice(-3);return!x||x.length<3||!C(x)?0:A/4>L?L:A/4}function D(y,A,x,F,k){y&&y.mediaType&&!S[y.mediaType]&&(S[y.mediaType]=[]);var W=y.mediaInfo.bitrateList.find(function(V){return V.id===y.representationId});S[y.mediaType].push({index:y.index,repId:y.representationId,mediaType:y.mediaType,requestTimeMS:F,adjustedAvailabilityStartTimeMS:y.availabilityStartTime.getTime(),segDurationMS:y.duration*1e3,chunksDurationMS:x.reduce(function(V,Q){return V+Q.chunkDownloadDurationMS},0),segmentBytes:x.reduce(function(V,Q){return V+Q.chunkBytes},0),bitrate:W&&W.bandwidth,bitrateList:y.mediaInfo.bitrateList,chunkMeasurements:x,fetchDownloadDurationMS:A,throughputCapacityDelayMS:k,getEstimatedBufferLevel:h(x.slice(1))}),S[y.mediaType].length>E&&S[y.mediaType].shift()}return O={setup:p,addMeasurement:D,getThroughputCapacityDelayMS:I,getEstimatedDownloadDurationMS:v},p(),O}l.__dashjs_factory_name="LowLatencyThroughputModel";const c=o.default.getSingletonFactory(l)},"./src/streaming/models/ManifestModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/EventBus.js"),o=r("./src/core/events/Events.js"),l=r("./src/core/FactoryMaker.js");function c(){var m=this.context,f=(0,d.default)(m).getInstance(),T,L;function P(){return L}function O(M){L=M,M&&f.trigger(o.default.MANIFEST_LOADED,{data:M})}return T={getValue:P,setValue:O},T}c.__dashjs_factory_name="ManifestModel";const E=l.default.getSingletonFactory(c)},"./src/streaming/models/MediaPlayerModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>p});var d=r("./src/core/Debug.js"),o=r("./src/core/FactoryMaker.js"),l=r("./src/core/Settings.js"),c=12,E=20,m=10,f=5,T=12,L=-.5,P=.5,O=-.5,M=1;function S(){var h,C,v,I,D=this.context,y=(0,l.default)(D).getInstance();function A(){C=(0,d.default)(D).getInstance().getLogger(h)}function x(ne){ne.playbackController&&(v=ne.playbackController),ne.serviceDescriptionController&&(I=ne.serviceDescriptionController)}function F(ne,ae){return isNaN(ne)?0:ne>0?(ae&&C.warn("Supplied minimum playback rate is a positive value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):ne<O?(ae&&C.warn("Supplied minimum playback rate is out of range and will be limited to ".concat(O,": ").concat(O*100,"% playback speed.")),O):ne}function k(ne,ae){return isNaN(ne)?0:ne<0?(ae&&C.warn("Supplied maximum playback rate is a negative value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):ne>M?(ae&&C.warn("Supplied maximum playback rate is out of range and will be limited to ".concat(M,": ").concat((1+M)*100,"% playback speed.")),M):ne}function W(){if(!isNaN(y.get().streaming.liveCatchup.maxDrift)&&y.get().streaming.liveCatchup.maxDrift>0)return y.get().streaming.liveCatchup.maxDrift;var ne=I.getServiceDescriptionSettings();return ne&&ne.liveCatchup&&!isNaN(ne.liveCatchup.maxDrift)&&ne.liveCatchup.maxDrift>0?ne.liveCatchup.maxDrift:T}function V(ne){var ae=y.get().streaming.liveCatchup.playbackRate;if(!isNaN(ae.min)||!isNaN(ae.max))return{min:F(ae.min,ne),max:k(ae.max,ne)};var ce=I.getServiceDescriptionSettings();if(ce&&ce.liveCatchup&&(!isNaN(ce.liveCatchup.playbackRate.min)||!isNaN(ce.liveCatchup.playbackRate.max))){var X=ce.liveCatchup.playbackRate;return{min:F(X.min,ne),max:k(X.max,ne)}}return{min:L,max:P}}function Q(){return y.get().streaming.liveCatchup.enabled!==null?y.get().streaming.liveCatchup.enabled:v.getInitialCatchupModeActivated()}function $(ne,ae){try{var ce=y.get().streaming.abr[ne][ae];if(!isNaN(ce)&&ce!==-1)return ce;var X=I.getServiceDescriptionSettings();return X&&X[ne]&&!isNaN(X[ne][ae])?X[ne][ae]:-1}catch{return-1}}function K(){var ne=y.get().streaming.buffer.initialBufferLevel;return isNaN(ne)||ne<0?0:Math.min(Y(),ne)}function Y(){var ne=y.get().streaming.buffer.stableBufferTime>0?y.get().streaming.buffer.stableBufferTime:y.get().streaming.buffer.fastSwitchEnabled?E:c,ae=v.getLiveDelay();return!isNaN(ae)&&ae>0?Math.min(ne,ae):ne}function re(ne){var ae=isNaN(y.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?f:y.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return v.getLowLatencyModeEnabled()?y.get().streaming.retryAttempts[ne]*ae:y.get().streaming.retryAttempts[ne]}function ie(ne){var ae=isNaN(y.get().streaming.retryIntervals.lowLatencyReductionFactor)?m:y.get().streaming.retryIntervals.lowLatencyReductionFactor;return v.getLowLatencyModeEnabled()?y.get().streaming.retryIntervals[ne]/ae:y.get().streaming.retryIntervals[ne]}function ee(){}return h={getCatchupMaxDrift:W,getCatchupModeEnabled:Q,getStableBufferTime:Y,getInitialBufferLevel:K,getRetryAttemptsForType:re,getRetryIntervalsForType:ie,getCatchupPlaybackRates:V,getAbrBitrateParameter:$,setConfig:x,reset:ee},A(),h}S.__dashjs_factory_name="MediaPlayerModel";const p=o.default.getSingletonFactory(S)},"./src/streaming/models/MetricsModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>v});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/streaming/constants/MetricsConstants.js"),l=r("./src/streaming/vo/MetricsList.js"),c=r("./src/streaming/vo/metrics/HTTPRequest.js"),E=r("./src/streaming/vo/metrics/RepresentationSwitch.js"),m=r("./src/streaming/vo/metrics/BufferLevel.js"),f=r("./src/streaming/vo/metrics/BufferState.js"),T=r("./src/streaming/vo/metrics/DVRInfo.js"),L=r("./src/streaming/vo/metrics/DroppedFrames.js"),P=r("./src/streaming/vo/metrics/ManifestUpdate.js"),O=r("./src/streaming/vo/metrics/SchedulingInfo.js"),M=r("./src/core/EventBus.js"),S=r("./src/streaming/vo/metrics/RequestsQueue.js"),p=r("./src/core/events/Events.js"),h=r("./src/core/FactoryMaker.js");function C(I){I=I||{};var D=I.settings,y=this.context,A=(0,M.default)(y).getInstance(),x,F;function k(){F={}}function W(){A.trigger(p.default.METRICS_CHANGED)}function V(w){A.trigger(p.default.METRIC_CHANGED,{mediaType:w}),W()}function Q(w,j,H){A.trigger(p.default.METRIC_UPDATED,{mediaType:w,metric:j,value:H}),V(w)}function $(w,j,H){A.trigger(p.default.METRIC_ADDED,{mediaType:w,metric:j,value:H}),V(w)}function K(w){delete F[w],V(w)}function Y(){F={},W()}function re(w,j){var H=null;return w&&(F.hasOwnProperty(w)?H=F[w]:j||(H=new l.default,F[w]=H)),H}function ie(w,j,H){var U=re(w);U!==null&&(U[j].push(H),U[j].length>D.get().streaming.metrics.maxListDepth&&U[j].shift())}function ee(w,j,H,U){var B=new c.HTTPRequestTrace;return B.s=j,B.d=H,B.b=U,w.trace.push(B),w.interval||(w.interval=0),w.interval+=H,B}function ne(w,j,H,U,B,G,z,fe,ue,J,ve,me,Ae,be,Be,ke,Ye){var Oe=new c.HTTPRequest;G&&G!==U&&(ne(w,null,H,U,B,null,null,fe,ue,null,null,null,Ae,null,null,ke,Ye),Oe.actualurl=G),Oe.tcpid=j,Oe.type=H,Oe.url=U,Oe.range=fe,Oe.trequest=ue,Oe.tresponse=J,Oe.responsecode=me,Oe.cmsd=Ye,Oe._tfinish=ve,Oe._stream=w,Oe._mediaduration=Ae,Oe._quality=B,Oe._responseHeaders=be,Oe._serviceLocation=z,Oe._fileLoaderType=ke,Be?Be.forEach(function(Se){ee(Oe,Se.s,Se.d,Se.b)}):(delete Oe.interval,delete Oe.trace),ce(w,o.default.HTTP_REQUEST,Oe)}function ae(w,j,H,U,B){var G=new E.default;G.t=j,G.mt=H,G.to=U,B?G.lto=B:delete G.lto,ce(w,o.default.TRACK_SWITCH,G)}function ce(w,j,H){ie(w,j,H),$(w,j,H)}function X(w,j,H){var U=new m.default;U.t=j,U.level=H,ce(w,o.default.BUFFER_LEVEL,U)}function oe(w,j,H){var U=new f.default;U.target=H,U.state=j,ce(w,o.default.BUFFER_STATE,U)}function ge(w,j,H,U){var B=new T.default;B.time=j,B.range=U,B.manifestInfo=H,ce(w,o.default.DVR_INFO,B)}function _e(w,j){var H=new L.default,U=re(w).DroppedFrames;j&&(H.time=j.creationTime,H.droppedFrames=j.droppedVideoFrames,!(U.length>0&&U[U.length-1]==H)&&ce(w,o.default.DROPPED_FRAMES,H))}function he(w,j,H,U,B,G,z,fe,ue){var J=new O.default;J.mediaType=w,J.t=j,J.type=H,J.startTime=U,J.availabilityStartTime=B,J.duration=G,J.quality=z,J.range=fe,J.state=ue,ce(w,o.default.SCHEDULING_INFO,J)}function se(w,j,H){var U=new S.default;U.loadingRequests=j,U.executedRequests=H,re(w).RequestsQueue=U,$(w,o.default.REQUESTS_QUEUE,U)}function Z(w,j,H,U,B,G,z,fe,ue,J){var ve=new P.ManifestUpdate;ve.mediaType=w,ve.type=j,ve.requestTime=H,ve.fetchTime=U,ve.availabilityStartTime=B,ve.presentationStartTime=G,ve.clientTimeOffset=z,ve.currentTime=fe,ve.buffered=ue,ve.latency=J,ie(d.default.STREAM,o.default.MANIFEST_UPDATE,ve),$(w,o.default.MANIFEST_UPDATE,ve)}function q(w,j){if(w){for(var H in j)w[H]=j[H];Q(w.mediaType,o.default.MANIFEST_UPDATE,w)}}function le(w,j,H,U,B){if(w){var G=new P.ManifestUpdateStreamInfo;G.id=j,G.index=H,G.start=U,G.duration=B,w.streamInfo.push(G),Q(w.mediaType,o.default.MANIFEST_UPDATE_STREAM_INFO,w)}}function te(w,j,H,U,B,G,z,fe){if(w&&w.representationInfo){var ue=new P.ManifestUpdateRepresentationInfo;ue.id=j,ue.index=H,ue.streamIndex=U,ue.mediaType=B,ue.startNumber=z,ue.fragmentInfoType=fe,ue.presentationTimeOffset=G,w.representationInfo.push(ue),Q(w.mediaType,o.default.MANIFEST_UPDATE_TRACK_INFO,w)}}function N(w){w.trace&&Array.isArray(w.trace)?w.trace.forEach(function(j){j.hasOwnProperty("subreplevel")&&!j.subreplevel&&delete j.subreplevel}):delete w.trace,ce(d.default.STREAM,o.default.PLAY_LIST,w)}function R(w){ce(d.default.STREAM,o.default.DVB_ERRORS,w)}return x={clearCurrentMetricsForType:K,clearAllCurrentMetrics:Y,getMetricsFor:re,addHttpRequest:ne,addRepresentationSwitch:ae,addBufferLevel:X,addBufferState:oe,addDVRInfo:ge,addDroppedFrames:_e,addSchedulingInfo:he,addRequestsQueue:se,addManifestUpdate:Z,updateManifestUpdateInfo:q,addManifestUpdateStreamInfo:le,addManifestUpdateRepresentationInfo:te,addPlayList:N,addDVBErrors:R},k(),x}C.__dashjs_factory_name="MetricsModel";const v=h.default.getSingletonFactory(C)},"./src/streaming/models/URIFragmentModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/streaming/vo/URIFragmentData.js"),o=r("./src/core/FactoryMaker.js");function l(){var E,m;function f(L){if(m=new d.default,!L)return null;var P=L.indexOf("#");if(P!==-1)for(var O=L.substr(P+1).split("&"),M=0,S=O.length;M<S;++M){var p=O[M],h=p.indexOf("=");if(h!==-1){var C=p.substring(0,h);m.hasOwnProperty(C)&&(m[C]=p.substr(h+1))}}}function T(){return m}return E={initialize:f,getURIFragmentData:T},E}l.__dashjs_factory_name="URIFragmentModel";const c=o.default.getSingletonFactory(l)},"./src/streaming/models/VideoModel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>T});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),c=r("./src/core/Debug.js"),E=r("./src/streaming/constants/Constants.js"),m=new Map([[E.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,"loadedmetadata"],[E.default.VIDEO_ELEMENT_READY_STATES.HAVE_CURRENT_DATA,"loadeddata"],[E.default.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,"canplay"],[E.default.VIDEO_ELEMENT_READY_STATES.HAVE_ENOUGH_DATA,"canplaythrough"]]);function f(){var L,P,O,M,S,p,h="element is not video or audio DOM type!",C=this.context,v=(0,o.default)(C).getInstance(),I=[];function D(){P=(0,c.default)(C).getInstance().getLogger(L),M=NaN}function y(){v.on(l.default.PLAYBACK_PLAYING,ge,this)}function A(){v.off(l.default.PLAYBACK_PLAYING,ge,this)}function x(){O&&(O.playbackRate=1,O.removeEventListener("canplay",x))}function F(Oe){var Se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;O&&(!Se&&O.readyState<=2&&Oe>0?O.addEventListener("canplay",x):O.playbackRate=Oe)}function k(Oe,Se){O&&(M=Oe,ke(E.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,function(){if(O.currentTime===M){M=NaN;return}try{M=Se?W(M):M,O.currentTime=M,M=NaN}catch(Me){O.readyState===0&&Me.code===Me.INVALID_STATE_ERR&&setTimeout(function(){O.currentTime=M,M=NaN},400)}}))}function W(Oe){var Se=U(),Me=Oe,qe=9999999999;if(Se)for(var it=0;it<Se.length;it++){var at=Se.start(it),Ce=Se.end(it),We=Math.abs(at-Oe),Ge=Math.abs(Ce-Oe);if(Oe>=at&&Oe<=Ce)return Oe;We<qe&&(qe=We,Me=at),Ge<qe&&(qe=Ge,Me=Ce)}return Me}function V(){return O}function Q(Oe){if(Oe==null||Oe&&/^(VIDEO|AUDIO)$/i.test(Oe.nodeName))O=Oe,O&&(O.preload="auto");else throw h}function $(Oe){O&&(Oe?O.src=Oe:(O.removeAttribute("src"),O.load()))}function K(){return O?O.src:null}function Y(){return S}function re(){return p}function ie(Oe){S=Oe,S.style.position="absolute",S.style.display="flex",S.style.overflow="hidden",S.style.pointerEvents="none",S.style.top=0,S.style.left=0}function ee(Oe){p=Oe}function ne(Oe,Se){oe(Oe,Se)}function ae(){return I.length>0}function ce(Oe){Oe===null||!O||O.seeking||I.indexOf(Oe)!==-1||I.push(Oe)}function X(Oe){var Se=I.indexOf(Oe);Oe!==null&&Se!==-1&&I.splice(Se,1)}function oe(Oe,Se){Se?ce(Oe):X(Oe)}function ge(){if(O&&ae()&&O.playbackRate===0){var Oe=document.createEvent("Event");Oe.initEvent("waiting",!0,!1),O.dispatchEvent(Oe)}}function _e(){if(!O)return null;var Oe="webkitDroppedFrameCount"in O&&"webkitDecodedFrameCount"in O,Se="getVideoPlaybackQuality"in O,Me=null;return Se?Me=O.getVideoPlaybackQuality():Oe&&(Me={droppedVideoFrames:O.webkitDroppedFrameCount,totalVideoFrames:O.webkitDroppedFrameCount+O.webkitDecodedFrameCount,creationTime:new Date}),Me}function he(){if(O){O.autoplay=!0;var Oe=O.play();Oe&&Oe.catch&&typeof Promise<"u"&&Oe.catch(function(Se){Se.name==="NotAllowedError"&&v.trigger(l.default.PLAYBACK_NOT_ALLOWED),P.warn("Caught pending play exception - continuing (".concat(Se,")"))})}}function se(){return O?O.paused:null}function Z(){O&&(O.pause(),O.autoplay=!1)}function q(){return O?O.seeking||!isNaN(M):null}function le(){return O?isNaN(M)?O.currentTime:M:null}function te(){return O?O.playbackRate:null}function N(){return O?O.played:null}function R(){return O?O.ended:null}function w(Oe,Se){O&&O.addEventListener(Oe,Se)}function j(Oe,Se){O&&O.removeEventListener(Oe,Se)}function H(){return O?O.readyState:NaN}function U(){return O?O.buffered:null}function B(){return O?O.clientWidth:NaN}function G(){return O?O.clientHeight:NaN}function z(){return O?O.videoWidth:NaN}function fe(){return O?O.videoHeight:NaN}function ue(){var Oe=O.parentNode.host||O.parentNode;return Oe?O.getBoundingClientRect().top-Oe.getBoundingClientRect().top:NaN}function J(){var Oe=O.parentNode.host||O.parentNode;return Oe?O.getBoundingClientRect().left-Oe.getBoundingClientRect().left:NaN}function ve(){return O?O.textTracks:[]}function me(Oe,Se,Me,qe,it){if(O){for(var at=0;at<O.textTracks.length;at++)if(O.textTracks[at].kind===Oe&&(!Se||O.textTracks[at].label==Se)&&O.textTracks[at].language===Me&&O.textTracks[at].isTTML===qe&&O.textTracks[at].isEmbedded===it)return O.textTracks[at]}return null}function Ae(Oe,Se,Me,qe,it){if(!O)return null;var at=me(Oe,Se,Me,qe,it);return at||(at=O.addTextTrack(Oe,Se,Me),at.isEmbedded=it,at.isTTML=qe),at}function be(Oe){O&&(O.appendChild(Oe),Oe.isTTML!==void 0&&(O.textTracks[O.textTracks.length-1].isTTML=Oe.isTTML,O.textTracks[O.textTracks.length-1].isEmbedded=Oe.isEmbedded))}function Be(Oe){O&&O.removeChild(Oe)}function ke(Oe,Se){if(Oe===E.default.VIDEO_ELEMENT_READY_STATES.HAVE_NOTHING||H()>=Oe)Se();else{var Me=m.get(Oe);Ye(Me,Se)}}function Ye(Oe,Se){var Me=function qe(){j(Oe,qe),Se(Oe)};w(Oe,Me)}return L={initialize:y,setCurrentTime:k,play:he,isPaused:se,pause:Z,isStalled:ae,isSeeking:q,getTime:le,getPlaybackRate:te,setPlaybackRate:F,getPlayedRanges:N,getEnded:R,setStallState:ne,getElement:V,setElement:Q,setSource:$,getSource:K,getTTMLRenderingDiv:Y,setTTMLRenderingDiv:ie,getVttRenderingDiv:re,setVttRenderingDiv:ee,getPlaybackQuality:_e,addEventListener:w,removeEventListener:j,getReadyState:H,getBufferRange:U,getClientWidth:B,getClientHeight:G,getTextTracks:ve,getTextTrack:me,addTextTrack:Ae,appendChild:be,removeChild:Be,getVideoWidth:z,getVideoHeight:fe,getVideoRelativeOffsetTop:ue,getVideoRelativeOffsetLeft:J,waitForReadyState:ke,reset:A},D(),L}f.__dashjs_factory_name="VideoModel";const T=d.default.getSingletonFactory(f)},"./src/streaming/net/FetchLoader.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>p});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Settings.js"),l=r("./src/streaming/constants/Constants.js"),c=r("./src/streaming/utils/RequestModifier.js");function E(h,C){return T(h)||f(h,C)||P(h,C)||m()}function m(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f(h,C){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(h)))){var v=[],I=!0,D=!1,y=void 0;try{for(var A=h[Symbol.iterator](),x;!(I=(x=A.next()).done)&&(v.push(x.value),!(C&&v.length===C));I=!0);}catch(F){D=!0,y=F}finally{try{!I&&A.return!=null&&A.return()}finally{if(D)throw y}}return v}}function T(h){if(Array.isArray(h))return h}function L(h,C){var v;if(typeof Symbol>"u"||h[Symbol.iterator]==null){if(Array.isArray(h)||(v=P(h))||C&&h&&typeof h.length=="number"){v&&(h=v);var I=0,D=function(){};return{s:D,n:function(){return I>=h.length?{done:!0}:{done:!1,value:h[I++]}},e:function(k){throw k},f:D}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y=!0,A=!1,x;return{s:function(){v=h[Symbol.iterator]()},n:function(){var k=v.next();return y=k.done,k},e:function(k){A=!0,x=k},f:function(){try{!y&&v.return!=null&&v.return()}finally{if(A)throw x}}}}function P(h,C){if(h){if(typeof h=="string")return O(h,C);var v=Object.prototype.toString.call(h).slice(8,-1);if(v==="Object"&&h.constructor&&(v=h.constructor.name),v==="Map"||v==="Set")return Array.from(h);if(v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v))return O(h,C)}}function O(h,C){(C==null||C>h.length)&&(C=h.length);for(var v=0,I=new Array(C);v<C;v++)I[v]=h[v];return I}function M(h){h=h||{};var C=this.context,v=h.requestModifier,I=h.lowLatencyThroughputModel,D=h.boxParser,y=(0,o.default)(C).getInstance(),A,x;function F(re){x=re.dashMetrics}function k(re){v&&v.modifyRequest?(0,c.modifyRequest)(re,v).then(function(){return W(re)}):W(re)}function W(re){var ie=new Date,ee=re.request,ne=new Headers;if(ee.range&&ne.append("Range","bytes="+ee.range),re.headers)for(var ae in re.headers){var ce=re.headers[ae];ce&&ne.append(ae,ce)}ee.requestStartDate||(ee.requestStartDate=ie),v&&v.modifyRequestHeader&&v.modifyRequestHeader({setRequestHeader:function(Z,q){ne.append(Z,q)}},{url:re.url});var X;typeof window.AbortController=="function"&&(X=new AbortController,re.abortController=X,X.signal.onabort=re.onabort);var oe={method:re.method,headers:ne,credentials:re.withCredentials?"include":void 0,signal:X?X.signal:void 0},ge=y.get().streaming.abr.fetchThroughputCalculationMode,_e=Date.now(),he=0;new Promise(function(se){if(ge===l.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&I&&(he=I.getThroughputCapacityDelayMS(ee,x.getCurrentBufferLevel(ee.mediaType)*1e3),he))return setTimeout(se,he);se()}).then(function(){var se=Date.now();fetch(re.url,oe).then(function(Z){re.response||(re.response={}),re.response.status=Z.status,re.response.statusText=Z.statusText,re.response.responseURL=Z.url,Z.ok||re.onerror();var q="",le=L(Z.headers.keys()),te;try{for(le.s();!(te=le.n()).done;){var N=te.value;q+=N+": "+Z.headers.get(N)+`\r
`}}catch(Ye){le.e(Ye)}finally{le.f()}if(re.response.responseHeaders=q,!Z.body)return Z.arrayBuffer().then(function(Ye){re.response.response=Ye;var Oe={loaded:Ye.byteLength,total:Ye.byteLength,stream:!1};re.progress(Oe),re.onload(),re.onend()});var R=parseInt(Z.headers.get("Content-Length"),10),w=0,j=!1,H=new Uint8Array,U=0;if(ge===l.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&I){var B=function(Oe){var Se=Oe.getReader(),Me=[];Se.read().then(function qe(it){var at=it.value,Ce=it.done;if(z=Date.now(),at&&at.length){var We=z-G,Ge=at.length;Me.push({chunkDownloadTimeRelativeMS:z-se,chunkDownloadDurationMS:We,chunkBytes:Ge,kbps:Math.round(8*Ge/(We/1e3)),bufferLevel:x.getCurrentBufferLevel(ee.mediaType)})}if(Ce){var tt=z-se,ot=Me.reduce(function(ct,ht){return ct+ht.chunkBytes},0);I.addMeasurement(ee,tt,Me,_e,he,q),re.progress({loaded:ot,total:ot,lengthComputable:!0,time:I.getEstimatedDownloadDurationMS(ee),stream:!0});return}return G=Date.now(),Se.read().then(qe)})},G=se,z=0,fe=Z.body.tee(),ue=E(fe,2),J=ue[0],ve=ue[1];B(J),re.reader=ve.getReader()}else re.reader=Z.body.getReader();var me=[],Ae=[],be=[],Be=!0,ke=function Ye(Oe){var Se=Oe.value,Me=Oe.done;if(Me){if(H){if(ge!==l.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST){var qe=null,it=null;ge===l.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING?(qe=Y(Ae,be),qe&&(it=w*8/qe)):ge===l.default.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA&&(it=K(me,w)),re.progress({loaded:w,total:isNaN(R)?w:R,lengthComputable:!0,time:it,stream:!0})}re.response.response=H.buffer}re.onload(),re.onend();return}if(Se&&Se.length>0){if(H=Q(H,Se),w+=Se.length,me.push({ts:Date.now(),bytes:Se.length}),ge===l.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&Be){var at=D.findLastTopIsoBoxCompleted(["moof"],H,U);at.found&&(Be=!1,Ae.push({ts:performance.now(),bytes:Se.length}))}var Ce=D.findLastTopIsoBoxCompleted(["moov","mdat"],H,U);if(Ce.found){var We=Ce.lastCompletedOffset+Ce.size;ge===l.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&!Be&&(Be=!0,be.push({ts:performance.now(),bytes:H.length}));var Ge;We===H.length?(Ge=H,H=new Uint8Array):(Ge=new Uint8Array(H.subarray(0,We)),H=H.subarray(We)),re.progress({data:Ge.buffer,lengthComputable:!1,noTrace:!0}),U=0}else U=Ce.lastCompletedOffset,j||(re.progress({lengthComputable:!1,noTrace:!0}),j=!0)}V(re,Ye)};V(re,ke)}).catch(function(Z){re.onerror&&re.onerror(Z)})})}function V(re,ie){re.reader.read().then(ie).catch(function(ee){re.onerror&&re.response.status===200&&re.onerror(ee)})}function Q(re,ie){if(re.length===0)return ie;var ee=new Uint8Array(re.length+ie.length);return ee.set(re),ee.set(ie,re.length),ee}function $(re){if(re.abortController)re.abortController.abort();else if(re.reader)try{re.reader.cancel(),re.onabort()}catch{}}function K(re,ie){try{if(re=re.filter(function(ae){return ae.bytes>ie/4/re.length}),re.length>1){var ee=0,ne=(re[re.length-1].ts-re[0].ts)/re.length;return re.forEach(function(ae,ce){var X=re[ce+1];if(X){var oe=X.ts-ae.ts;ee+=oe<ne?oe:0}}),ee}return null}catch{return null}}function Y(re,ie){try{var ee,ne;ee=re.filter(function(se,Z){return Z<re.length-1}),ne=ie.filter(function(se,Z){return Z<ie.length-1});var ae=[];if(ee.length>1){for(var ce=0,X=0,oe=0;oe<ee.length;oe++)if(ee[oe]&&ne[oe]){var ge=ne[oe].ts-ee[oe].ts;if(ge>1)ae.push(8*ne[oe].bytes/ge);else{X===0&&(X=ee[oe].ts);var _e=ne[oe].ts-X;_e>1?(ae.push(8*ce/_e),ce=0,X=0):ce+=ne[oe].bytes}}if(ae.length>0){var he=ae.reduce(function(se,Z){return se+Z},0);return he/ae.length}}return null}catch{return null}}return A={load:k,abort:$,calculateDownloadedTime:K,setup:F},A}M.__dashjs_factory_name="FetchLoader";var S=d.default.getClassFactory(M);const p=S},"./src/streaming/net/HTTPLoader.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>D});var d=r("./src/streaming/net/XHRLoader.js"),o=r("./src/streaming/net/FetchLoader.js"),l=r("./src/streaming/vo/metrics/HTTPRequest.js"),c=r("./src/core/FactoryMaker.js"),E=r("./src/streaming/vo/DashJSError.js"),m=r("./src/streaming/models/CmcdModel.js"),f=r("./src/streaming/models/CmsdModel.js"),T=r("./src/core/Utils.js"),L=r("./src/core/Debug.js"),P=r("./src/core/EventBus.js"),O=r("./src/core/events/Events.js"),M=r("./src/core/Settings.js"),S=r("./src/streaming/constants/Constants.js"),p=r("./src/streaming/models/LowLatencyThroughputModel.js"),h=r("./src/streaming/models/CustomParametersModel.js");function C(y,A,x){return A in y?Object.defineProperty(y,A,{value:x,enumerable:!0,configurable:!0,writable:!0}):y[A]=x,y}function v(y){y=y||{};var A=this.context,x=y.errHandler,F=y.dashMetrics,k=y.mediaPlayerModel,W=y.requestModifier,V=y.boxParser,Q=y.errors,$=y.requestTimeout||0,K=(0,P.default)(A).getInstance(),Y=(0,M.default)(A).getInstance(),re,ie,ee,ne,ae,ce,X,oe,ge,_e;function he(){var te;_e=(0,L.default)(A).getInstance().getLogger(re),ie=[],ee=[],ne=[],ce=(0,m.default)(A).getInstance(),X=(0,f.default)(A).getInstance(),ge=(0,p.default)(A).getInstance(),oe=(0,h.default)(A).getInstance(),ae=(te={},C(te,l.HTTPRequest.MPD_TYPE,Q.DOWNLOAD_ERROR_ID_MANIFEST_CODE),C(te,l.HTTPRequest.XLINK_EXPANSION_TYPE,Q.DOWNLOAD_ERROR_ID_XLINK_CODE),C(te,l.HTTPRequest.INIT_SEGMENT_TYPE,Q.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),C(te,l.HTTPRequest.MEDIA_SEGMENT_TYPE,Q.DOWNLOAD_ERROR_ID_CONTENT_CODE),C(te,l.HTTPRequest.INDEX_SEGMENT_TYPE,Q.DOWNLOAD_ERROR_ID_CONTENT_CODE),C(te,l.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,Q.DOWNLOAD_ERROR_ID_CONTENT_CODE),C(te,l.HTTPRequest.OTHER_TYPE,Q.DOWNLOAD_ERROR_ID_CONTENT_CODE),te)}function se(te,N){var R=te.request,w=[],j=!0,H=!0,U=new Date,B=U,G=0,z=null,fe;if(!W||!F||!x)throw new Error("config object is not correct or missing");var ue=function(We){if(H=!1,R.requestStartDate=U,R.requestEndDate=new Date,R.firstByteDate=R.firstByteDate||U,R.fileLoaderType=z,!R.checkExistenceOnly){var Ge=fe.response?fe.response.responseURL:null,tt=fe.response?fe.response.status:null,ot=fe.response&&fe.response.getAllResponseHeaders?fe.response.getAllResponseHeaders():fe.response?fe.response.responseHeaders:null,ct=Y.get().streaming.cmsd&&Y.get().streaming.cmsd.enabled?X.parseResponseHeaders(ot,R.mediaType):null;F.addHttpRequest(R,Ge,tt,ot,We?w:null,ct),R.type===l.HTTPRequest.MPD_TYPE&&F.addManifestUpdate(R)}},J=function(){if(ie.indexOf(fe)!==-1&&(ie.splice(ie.indexOf(fe),1),H))if(ue(!1),N>0){try{if(Y.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&R.type===l.HTTPRequest.MEDIA_SEGMENT_TYPE){var We=k.getRetryAttemptsForType(l.HTTPRequest.MEDIA_SEGMENT_TYPE);We===N&&K.trigger(O.default.ATTEMPT_BACKGROUND_SYNC)}}catch{}N--;var Ge={config:te};ne.push(Ge),Ge.timeout=setTimeout(function(){ne.indexOf(Ge)!==-1&&(ne.splice(ne.indexOf(Ge),1),se(te,N))},k.getRetryIntervalsForType(R.type))}else{if(R.type===l.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;x.error(new E.default(ae[R.type],R.url+" is not available",{request:R,response:fe.response})),te.error&&te.error(R,"error",fe.response.statusText),te.complete&&te.complete(R,fe.response.statusText)}},ve=function(We){var Ge=new Date;j&&(j=!1,(!We.lengthComputable||We.lengthComputable&&We.total!==We.loaded)&&(R.firstByteDate=Ge)),We.lengthComputable&&(R.bytesLoaded=We.loaded,R.bytesTotal=We.total),We.noTrace||(w.push({s:B,d:We.time?We.time:Ge.getTime()-B.getTime(),b:[We.loaded?We.loaded-G:0]}),B=Ge,G=We.loaded),te.progress&&We&&te.progress(We)},me=function(){fe.response.status>=200&&fe.response.status<=299&&(ue(!0),te.success&&te.success(fe.response.response,fe.response.statusText,fe.response.responseURL),te.complete&&te.complete(R,fe.response.statusText))},Ae=function(){te.abort&&te.abort(R)},be=function(We){var Ge;if(We.lengthComputable){var tt=We.loaded/We.total*100;Ge="Request timeout: loaded: "+We.loaded+", out of: "+We.total+" : "+tt.toFixed(3)+"% Completed"}else Ge="Request timeout: non-computable download size";_e.warn(Ge)},Be;R.hasOwnProperty("availabilityTimeComplete")&&R.availabilityTimeComplete===!1&&window.fetch&&R.responseType==="arraybuffer"&&R.type===l.HTTPRequest.MEDIA_SEGMENT_TYPE?(Be=(0,o.default)(A).create({requestModifier:W,lowLatencyThroughputModel:ge,boxParser:V}),Be.setup({dashMetrics:F}),z=S.default.FILE_LOADER_TYPES.FETCH):(Be=(0,d.default)(A).create({requestModifier:W}),z=S.default.FILE_LOADER_TYPES.XHR);var ke=null,Ye=W.modifyRequestURL?W.modifyRequestURL(R.url):R.url;if(Y.get().streaming.cmcd&&Y.get().streaming.cmcd.enabled){var Oe=Y.get().streaming.cmcd.mode;if(Oe===S.default.CMCD_MODE_QUERY){var Se=Z(R);Ye=T.default.addAditionalQueryParameterToUrl(Ye,Se)}else Oe===S.default.CMCD_MODE_HEADER&&(ke=ce.getHeaderParameters(R))}R.url=Ye;var Me=R.checkExistenceOnly?l.HTTPRequest.HEAD:l.HTTPRequest.GET,qe=oe.getXHRWithCredentialsForType(R.type);fe={url:Ye,method:Me,withCredentials:qe,request:R,onload:me,onend:J,onerror:J,progress:ve,onabort:Ae,ontimeout:be,loader:Be,timeout:$,headers:ke};var it=new Date().getTime();if(isNaN(R.delayLoadingTime)||it>=R.delayLoadingTime)ie.push(fe),Be.load(fe);else{var at={httpRequest:fe};ee.push(at),at.delayTimeout=setTimeout(function(){if(ee.indexOf(at)!==-1){ee.splice(ee.indexOf(at),1);try{U=new Date,B=U,ie.push(at.httpRequest),Be.load(at.httpRequest)}catch{at.httpRequest.onerror()}}},R.delayLoadingTime-it)}}function Z(te){try{var N=[],R=ce.getQueryParameter(te);return R&&N.push(R),N}catch{return[]}}function q(te){te.request?se(te,k.getRetryAttemptsForType(te.request.type)):te.error&&te.error(te.request,"error")}function le(){ne.forEach(function(te){clearTimeout(te.timeout),te.config.request&&te.config.abort&&te.config.abort(te.config.request)}),ne=[],ee.forEach(function(te){return clearTimeout(te.delayTimeout)}),ee=[],ie.forEach(function(te){te.request.type!==l.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE&&(te.onloadend=te.onerror=te.onprogress=void 0,te.loader.abort(te))}),ie=[]}return re={load:q,abort:le},he(),re}v.__dashjs_factory_name="HTTPLoader";var I=c.default.getClassFactory(v);const D=I},"./src/streaming/net/SchemeLoaderFactory.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/net/HTTPLoader.js");function l(){var m,f;function T(p,h){f[p]=h}function L(p){f[p]&&delete f[p]}function P(){f={}}function O(p){for(var h in f)if(f.hasOwnProperty(h)&&p.startsWith(h))return f[h];return o.default}function M(){P()}function S(){M()}return S(),m={getLoader:O,registerLoader:T,unregisterLoader:L,unregisterAllLoader:P,reset:M},m}l.__dashjs_factory_name="SchemeLoaderFactory";var c=d.default.getSingletonFactory(l);const E=c},"./src/streaming/net/URLLoader.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/net/SchemeLoaderFactory.js");function l(m){m=m||{};var f=this.context,T,L,P;L=(0,o.default)(f).getInstance();function O(S){if(!P){var p=L.getLoader(S&&S.request?S.request.url:null);P=p(f).create({errHandler:m.errHandler,mediaPlayerModel:m.mediaPlayerModel,requestModifier:m.requestModifier,dashMetrics:m.dashMetrics,boxParser:m.boxParser?m.boxParser:null,constants:m.constants?m.constants:null,dashConstants:m.dashConstants?m.dashConstants:null,urlUtils:m.urlUtils?m.urlUtils:null,requestTimeout:isNaN(m.requestTimeout)?0:m.requestTimeout,errors:m.errors})}P.load(S)}function M(){P&&P.abort()}return T={load:O,abort:M},T}l.__dashjs_factory_name="URLLoader";var c=d.default.getClassFactory(l);const E=c},"./src/streaming/net/XHRLoader.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/utils/RequestModifier.js");function l(m){m=m||{};var f=m.requestModifier,T;function L(M){f&&f.modifyRequest?(0,o.modifyRequest)(M,f).then(function(){return P(M)}):P(M)}function P(M){var S=new Date,p=M.request,h=new XMLHttpRequest;if(h.open(M.method,M.url,!0),p.responseType&&(h.responseType=p.responseType),p.range&&h.setRequestHeader("Range","bytes="+p.range),p.requestStartDate||(p.requestStartDate=S),f&&f.modifyRequestHeader&&(h=f.modifyRequestHeader(h,{url:M.url})),M.headers)for(var C in M.headers){var v=M.headers[C];v&&h.setRequestHeader(C,v)}h.withCredentials=M.withCredentials,h.onload=M.onload,h.onloadend=M.onend,h.onerror=M.onerror,h.onprogress=M.progress,h.onabort=M.onabort,h.ontimeout=M.ontimeout,h.timeout=M.timeout,h.send(),M.response=h}function O(M){var S=M.response;S.onloadend=S.onerror=S.onprogress=void 0,S.abort()}return T={load:L,abort:O},T}l.__dashjs_factory_name="XHRLoader";var c=d.default.getClassFactory(l);const E=c},"./src/streaming/protection/CommonEncryption.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});function d(f,T){if(!(f instanceof T))throw new TypeError("Cannot call a class as a function")}function o(f,T){for(var L=0;L<T.length;L++){var P=T[L];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(f,P.key,P)}}function l(f,T,L){return T&&o(f.prototype,T),L&&o(f,L),f}var c={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]},E=function(){function f(){d(this,f)}return l(f,null,[{key:"findCencContentProtection",value:function(L){for(var P=null,O=0;O<L.length;++O){var M=L[O];M.schemeIdUri.toLowerCase()==="urn:mpeg:dash:mp4protection:2011"&&(M.value.toLowerCase()==="cenc"||M.value.toLowerCase()==="cbcs")&&(P=M)}return P}},{key:"getPSSHData",value:function(L){var P=8,O=new DataView(L),M=O.getUint8(P);return P+=20,M>0&&(P+=4+16*O.getUint32(P)),P+=4,L.slice(P)}},{key:"getPSSHForKeySystem",value:function(L,P){var O=f.parsePSSHList(P);return L&&O.hasOwnProperty(L.uuid.toLowerCase())?O[L.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(L,P){return"pssh"in L?(L.pssh.__text=L.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),P.decodeArray(L.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(L){if(L==null)return[];for(var P=new DataView(L.buffer||L),O=!1,M={},S=0;!O;){var p=void 0,h=void 0,C=void 0,v=void 0,I=S;if(S>=P.buffer.byteLength)break;if(p=P.getUint32(S),h=S+p,S+=4,P.getUint32(S)!==1886614376){S=h;continue}if(S+=4,C=P.getUint8(S),C!==0&&C!==1){S=h;continue}S++,S+=3,v="";var D=void 0,y=void 0;for(D=0;D<4;D++)y=P.getUint8(S+D).toString(16),v+=y.length===1?"0"+y:y;for(S+=4,v+="-",D=0;D<2;D++)y=P.getUint8(S+D).toString(16),v+=y.length===1?"0"+y:y;for(S+=2,v+="-",D=0;D<2;D++)y=P.getUint8(S+D).toString(16),v+=y.length===1?"0"+y:y;for(S+=2,v+="-",D=0;D<2;D++)y=P.getUint8(S+D).toString(16),v+=y.length===1?"0"+y:y;for(S+=2,v+="-",D=0;D<6;D++)y=P.getUint8(S+D).toString(16),v+=y.length===1?"0"+y:y;S+=6,v=v.toLowerCase(),S+=4,M[v]=P.buffer.slice(I,h),S=h}return M}},{key:"getLicenseServerUrlFromMediaInfo",value:function(L,P){try{if(!L||L.length===0)return null;for(var O=0,M=null;O<L.length&&!M;){var S=L[O];if(S&&S.contentProtection&&S.contentProtection.length>0){var p=S.contentProtection.filter(function(A){return A.schemeIdUri&&A.schemeIdUri===P});if(p&&p.length>0)for(var h=0;h<p.length&&!M;){for(var C=p[h],v=0;v<c.attributes.length&&!M;){for(var I=0,D=c.attributes[v];I<c.prefixes.length&&!M;){var y=c.prefixes[I];C[D]&&C[D].__prefix&&C[D].__prefix===y&&C[D].__text&&(M=C[D].__text),I+=1}v+=1}h+=1}}O+=1}return M}catch{return null}}}]),f}();const m=E},"./src/streaming/protection/Protection.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>M});var d=r("./src/streaming/protection/controllers/ProtectionController.js"),o=r("./src/streaming/protection/controllers/ProtectionKeyController.js"),l=r("./src/streaming/protection/ProtectionEvents.js"),c=r("./src/streaming/protection/errors/ProtectionErrors.js"),E=r("./src/streaming/protection/models/ProtectionModel_21Jan2015.js"),m=r("./src/streaming/protection/models/ProtectionModel_3Feb2014.js"),f=r("./src/streaming/protection/models/ProtectionModel_01b.js"),T=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],L=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function P(){var S,p=this.context;function h(I){var D=null,y=(0,o.default)(p).getInstance();y.setConfig({debug:I.debug,BASE64:I.BASE64,settings:I.settings}),y.initialize();var A=C(I);return!D&&A&&(D=(0,d.default)(p).create({protectionModel:A,protectionKeyController:y,eventBus:I.eventBus,debug:I.debug,events:I.events,BASE64:I.BASE64,constants:I.constants,cmcdModel:I.cmcdModel,customParametersModel:I.customParametersModel,settings:I.settings}),I.capabilities.setEncryptedMediaSupported(!0)),D}function C(I){var D=I.debug,y=D.getLogger(S),A=I.eventBus,x=I.errHandler,F=I.videoModel?I.videoModel.getElement():null;return(!F||F.onencrypted!==void 0)&&(!F||F.mediaKeys!==void 0)?(y.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),(0,E.default)(p).create({debug:D,eventBus:A,events:I.events})):v(F,L)?(y.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),(0,m.default)(p).create({debug:D,eventBus:A,events:I.events,api:v(F,L)})):v(F,T)?(y.info("EME detected on this user agent! (ProtectionModel_01b)"),(0,f.default)(p).create({debug:D,eventBus:A,errHandler:x,events:I.events,api:v(F,T)})):(y.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null)}function v(I,D){for(var y=0;y<D.length;y++){var A=D[y];if(typeof I[A[Object.keys(A)[0]]]=="function")return A}return null}return S={createProtectionSystem:h},S}P.__dashjs_factory_name="Protection";var O=dashjs.FactoryMaker.getClassFactory(P);O.events=l.default,O.errors=c.default,dashjs.FactoryMaker.updateClassFactory(P.__dashjs_factory_name,O);const M=O},"./src/streaming/protection/ProtectionEvents.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/core/events/EventsBase.js");function o(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(C){return typeof C}:o=function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},o(p)}function l(p,h){if(!(p instanceof h))throw new TypeError("Cannot call a class as a function")}function c(p,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(h&&h.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),h&&E(p,h)}function E(p,h){return E=Object.setPrototypeOf||function(v,I){return v.__proto__=I,v},E(p,h)}function m(p){var h=L();return function(){var v=P(p),I;if(h){var D=P(this).constructor;I=Reflect.construct(v,arguments,D)}else I=v.apply(this,arguments);return f(this,I)}}function f(p,h){return h&&(o(h)==="object"||typeof h=="function")?h:T(p)}function T(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(p){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},P(p)}var O=function(p){c(C,p);var h=m(C);function C(){var v;return l(this,C),v=h.call(this),v.INTERNAL_KEY_MESSAGE="internalKeyMessage",v.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",v.KEY_ADDED="public_keyAdded",v.KEY_ERROR="public_keyError",v.KEY_MESSAGE="public_keyMessage",v.KEY_SESSION_CLOSED="public_keySessionClosed",v.KEY_SESSION_CREATED="public_keySessionCreated",v.KEY_SESSION_REMOVED="public_keySessionRemoved",v.KEY_STATUSES_CHANGED="public_keyStatusesChanged",v.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",v.KEY_SYSTEM_SELECTED="public_keySystemSelected",v.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",v.LICENSE_REQUEST_SENDING="public_licenseRequestSending",v.NEED_KEY="needkey",v.PROTECTION_CREATED="public_protectioncreated",v.PROTECTION_DESTROYED="public_protectiondestroyed",v.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",v.TEARDOWN_COMPLETE="protectionTeardownComplete",v.VIDEO_ELEMENT_SELECTED="videoElementSelected",v.KEY_SESSION_UPDATED="public_keySessionUpdated",v}return C}(d.default),M=new O;const S=M},"./src/streaming/protection/controllers/ProtectionController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>D});var d=r("./src/streaming/protection/CommonEncryption.js"),o=r("./src/streaming/protection/vo/MediaCapability.js"),l=r("./src/streaming/protection/vo/KeySystemConfiguration.js"),c=r("./src/streaming/protection/errors/ProtectionErrors.js"),E=r("./src/streaming/vo/DashJSError.js"),m=r("./src/streaming/protection/vo/LicenseRequest.js"),f=r("./src/streaming/protection/vo/LicenseResponse.js"),T=r("./src/streaming/vo/metrics/HTTPRequest.js"),L=r("./src/core/Utils.js"),P=r("./src/streaming/constants/Constants.js"),O=r("./src/core/FactoryMaker.js");function M(y){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?M=function(x){return typeof x}:M=function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},M(y)}var S=5,p=500,h=3,C=1e3,v=8e3;function I(y){y=y||{};var A=y.protectionKeyController,x=y.protectionModel,F=y.eventBus,k=y.events,W=y.debug,V=y.BASE64,Q=y.constants,$=[],K=y.cmcdModel,Y=y.settings,re=y.customParametersModel,ie,ee,ne,ae,ce,X,oe,ge,_e,he,se;function Z(){ee=W.getLogger(ie),ne=[],ae=[],X="temporary",oe="",he=null,se=null,F.on(k.INTERNAL_KEY_MESSAGE,it,ie),F.on(k.INTERNAL_KEY_STATUS_CHANGED,qe,ie)}function q(){if(!F||!F.hasOwnProperty("on")||!A||!A.hasOwnProperty("getSupportedKeySystemsFromContentProtection"))throw new Error("Missing config parameter(s)")}function le(de){if(!de)throw new Error("mediaInfo can not be null or undefined");q(),ae.push(de)}function te(){if(!(!ae||ae.length===0)){var de=[];ae.forEach(function(Re){var xe=A.getSupportedKeySystemsFromContentProtection(Re.contentProtection,ce,X);xe.length>0&&(de.length===0&&(de=xe),ne.push(xe))}),de&&de.length>0&&R(de,!0)}}function N(de){ne.push(de),R(de,!1)}function R(de,Re){!ge&&!_e?w(de,Re):ge&&j()}function w(de,Re){if(!_e){_e=!0;var xe=[];de=de.sort(function(et,dt){var Tt=ce&&ce[et.ks.systemString]&&ce[et.ks.systemString].priority>=0?ce[et.ks.systemString].priority:de.length,Ct=ce&&ce[dt.ks.systemString]&&ce[dt.ks.systemString].priority>=0?ce[dt.ks.systemString].priority:de.length;return Tt-Ct});for(var Ne=0;Ne<de.length;Ne++){var Xe=Me(de[Ne]);xe.push({ks:de[Ne].ks,configs:[Xe],protData:de[Ne].protData})}var nt;x.requestKeySystemAccess(xe).then(function(et){nt=et.data;var dt=nt.mksa&&nt.mksa.selectedSystemString?nt.mksa.selectedSystemString:nt.keySystem.systemString;return ee.info("DRM: KeySystem Access Granted for system string ("+dt+")!  Selecting key system..."),x.selectKeySystem(nt)}).then(function(et){if(ge=et,_e=!1,!!x){F.trigger(k.KEY_SYSTEM_SELECTED,{data:nt});var dt=G(ge);dt&&dt.serverCertificate&&dt.serverCertificate.length>0&&x.setServerCertificate(V.decodeArray(dt.serverCertificate).buffer),j()}}).catch(function(et){ge=null,_e=!1,Re||F.trigger(k.KEY_SYSTEM_SELECTED,{data:null,error:new E.default(c.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,c.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+et.error)})})}}function j(){for(var de,Re=0;Re<ne.length;Re++)for(de=0;de<ne[Re].length;de++)if(ge===ne[Re][de].ks){var xe=ne[Re][de];H(xe);break}ne=[]}function H(de){if(A.isClearKey(ge)&&de.protData&&de.protData.hasOwnProperty("clearkeys")&&Object.keys(de.protData.clearkeys).length!==0){var Re={kids:Object.keys(de.protData.clearkeys)};de.initData=new TextEncoder().encode(JSON.stringify(Re))}de.sessionId?U(de):de.initData!==null&&B(de)}function U(de){q(),x.loadKeySession(de)}function B(de){var Re=d.default.getPSSHForKeySystem(ge,de?de.initData:null);if(Re){if(ue(de.keyId)||J(Re))return;try{de.initData=Re,x.createKeySession(de)}catch(xe){F.trigger(k.KEY_SESSION_CREATED,{data:null,error:new E.default(c.default.KEY_SESSION_CREATED_ERROR_CODE,c.default.KEY_SESSION_CREATED_ERROR_MESSAGE+xe.message)})}}else de&&de.initData?x.createKeySession(de):F.trigger(k.KEY_SESSION_CREATED,{data:null,error:new E.default(c.default.KEY_SESSION_CREATED_ERROR_CODE,c.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(ge?ge.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function G(de){if(de){var Re=de.systemString;if(ce)return Re in ce?ce[Re]:null}return null}function z(){ae=[]}function fe(de){return q(),A.getSupportedKeySystemsFromContentProtection(de,ce,X)}function ue(de){if(!de)return!1;try{for(var Re=x.getSessions(),xe=0;xe<Re.length;xe++)if(Re[xe].getKeyId()===de)return!0;return!1}catch{return!1}}function J(de){if(!de)return!1;try{for(var Re=x.getAllInitData(),xe=0;xe<Re.length;xe++)if(A.initDataEquals(de,Re[xe]))return ee.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch{return!1}}function ve(de){q(),x.removeKeySession(de)}function me(de){q(),x.closeKeySession(de)}function Ae(de){q(),x.setServerCertificate(de)}function be(de){q(),de?(x.setMediaElement(de),F.on(k.NEED_KEY,Pt,ie)):de===null&&(x.setMediaElement(de),F.off(k.NEED_KEY,Pt,ie))}function Be(de){X=de}function ke(de){oe=de}function Ye(de){ce=de,A.setProtectionData(de)}function Oe(){Ge(),x&&x.stop()}function Se(){F.off(k.INTERNAL_KEY_MESSAGE,it,ie),F.off(k.INTERNAL_KEY_STATUS_CHANGED,qe,ie),q(),Ge(),be(null),ge=null,_e=!1,x&&(x.reset(),x=null),$.forEach(function(de){return clearTimeout(de)}),$=[],ae=[],ne=[]}function Me(de){var Re=de.protData,xe=[],Ne=[],Xe=Re&&Re.audioRobustness&&Re.audioRobustness.length>0?Re.audioRobustness:oe,nt=Re&&Re.videoRobustness&&Re.videoRobustness.length>0?Re.videoRobustness:oe,et=de.sessionType,dt=Re&&Re.distinctiveIdentifier?Re.distinctiveIdentifier:"optional",Tt=Re&&Re.persistentState?Re.persistentState:et==="temporary"?"optional":"required";return ae.forEach(function(Ct){Ct.type===Q.AUDIO?xe.push(new o.default(Ct.codec,Xe)):Ct.type===Q.VIDEO&&Ne.push(new o.default(Ct.codec,nt))}),new l.default(xe,Ne,dt,Tt,[et])}function qe(de){de.error?F.trigger(k.KEY_STATUSES_CHANGED,{data:null,error:de.error}):ee.debug("DRM: key status = "+de.status)}function it(de){ee.debug("DRM: onKeyMessage");var Re=de.data;F.trigger(k.KEY_MESSAGE,{data:Re});var xe=Re.messageType?Re.messageType:"license-request",Ne=Re.message,Xe=Re.sessionToken,nt=G(ge),et=A.getLicenseServerModelInstance(ge,nt,xe),dt={sessionToken:Xe,messageType:xe};if(!Ne||Ne.byteLength===0){at(dt,new E.default(c.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,c.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE));return}if(!et){ee.debug("DRM: License server request not required for this message (type = "+de.data.messageType+").  Session ID = "+Xe.getSessionId()),at(dt);return}if(A.isClearKey(ge)){var Tt=A.processClearKeyLicenseRequest(ge,nt,Ne);if(Tt&&Tt.keyPairs&&Tt.keyPairs.length>0){ee.debug("DRM: ClearKey license request handled by application!"),at(dt),x.updateKeySession(Xe,Tt);return}}Ce(Re,et,nt)}function at(de,Re){F.trigger(k.LICENSE_REQUEST_COMPLETE,{data:de,error:Re})}function Ce(de,Re,xe){var Ne=de.sessionToken,Xe=de.messageType?de.messageType:"license-request",nt={sessionToken:Ne,messageType:Xe},et=ge?ge.systemString:null,dt=tt(xe,Xe,Ne,de,Re);if(!dt){at(nt,new E.default(c.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,c.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE));return}var Tt={},Ct=!1;xe&&ot(Tt,xe.httpRequestHeaders);var De=de.message,Ue=ge.getRequestHeadersFromMessage(De);ot(Tt,Ue),Object.keys(Tt).forEach(function(we){we.toLowerCase()==="authorization"&&(Ct=!0)}),xe&&typeof xe.withCredentials=="boolean"&&(Ct=xe.withCredentials);var Ze=function(ze){if(x)if(ze.status>=200&&ze.status<=299){var Et=L.default.parseHttpHeaders(ze.getAllResponseHeaders?ze.getAllResponseHeaders():null),xt=new f.default(ze.responseURL,Et,ze.response),Dt=re.getLicenseResponseFilters();ht(Dt,xt).then(function(){var Rt=Re.getLicenseMessage(xt.data,et,Xe);Rt!==null?(at(nt),x.updateKeySession(Ne,Rt)):ct(ze,nt,et,Xe,Re)})}else ct(ze,nt,et,Xe,Re)},mt=function(ze){at(nt,new E.default(c.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,c.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+et+' update, XHR aborted. status is "'+ze.statusText+'" ('+ze.status+"), readyState is "+ze.readyState))},ft=function(ze){at(nt,new E.default(c.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,c.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+et+' update, XHR error. status is "'+ze.statusText+'" ('+ze.status+"), readyState is "+ze.readyState))},pt=ge.getLicenseRequestFromMessage(De),Mt=Re.getHTTPMethod(Xe),Kt=Re.getResponseType(et,Xe),jt=xe&&!isNaN(xe.httpTimeout)?xe.httpTimeout:v,pe=Ne.getSessionId()||null,Ve=new m.default(dt,Mt,Kt,Tt,Ct,Xe,pe,pt),ut=isNaN(Y.get().streaming.retryAttempts[T.HTTPRequest.LICENSE])?h:Y.get().streaming.retryAttempts[T.HTTPRequest.LICENSE],Ie=re.getLicenseRequestFilters();ht(Ie,Ve).then(function(){We(Ve,ut,jt,Ze,mt,ft)})}function We(de,Re,xe,Ne,Xe,nt){var et=new XMLHttpRequest;if(Y.get().streaming.cmcd&&Y.get().streaming.cmcd.enabled){var dt=Y.get().streaming.cmcd.mode;if(dt===P.default.CMCD_MODE_QUERY){var Tt=K.getQueryParameter({url:de.url,type:T.HTTPRequest.LICENSE});Tt&&(de.url=L.default.addAditionalQueryParameterToUrl(de.url,[Tt]))}}et.open(de.method,de.url,!0),et.responseType=de.responseType,et.withCredentials=de.withCredentials,xe>0&&(et.timeout=xe);for(var Ct in de.headers)et.setRequestHeader(Ct,de.headers[Ct]);if(Y.get().streaming.cmcd&&Y.get().streaming.cmcd.enabled){var De=Y.get().streaming.cmcd.mode;if(De===P.default.CMCD_MODE_HEADER){var Ue=K.getHeaderParameters({url:de.url,type:T.HTTPRequest.LICENSE});if(Ue)for(var Ze in Ue){var mt=Ue[Ze];mt&&et.setRequestHeader(Ze,mt)}}}var ft=function(){Re--;var Mt=isNaN(Y.get().streaming.retryIntervals[T.HTTPRequest.LICENSE])?C:Y.get().streaming.retryIntervals[T.HTTPRequest.LICENSE];se=setTimeout(function(){We(de,Re,xe,Ne,Xe,nt)},Mt)};et.onload=function(){he=null,this.status>=200&&this.status<=299||Re<=0?Ne(this):(ee.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+Re),ft())},et.ontimeout=et.onerror=function(){he=null,Re<=0?nt(this):(ee.warn("License request network request failed . Retrying it... Pending retries: "+Re),ft())},et.onabort=function(){Xe(this)},F.trigger(k.LICENSE_REQUEST_SENDING,{url:de.url,headers:de.headers,payload:de.data,sessionId:de.sessionId}),he=et,et.send(de.data)}function Ge(){he&&(he.onloadend=he.onerror=he.onprogress=void 0,he.abort(),he=null),se&&(clearTimeout(se),se=null)}function tt(de,Re,xe,Ne,Xe){var nt=null,et=Ne.message;if(de&&de.serverURL){var dt=de.serverURL;typeof dt=="string"&&dt!==""?nt=dt:M(dt)==="object"&&dt.hasOwnProperty(Re)&&(nt=dt[Re])}else if(de&&de.laURL&&de.laURL!=="")nt=de.laURL;else if(nt=d.default.getLicenseServerUrlFromMediaInfo(ae,ge.schemeIdURI),!nt&&!A.isClearKey(ge)){var Tt=d.default.getPSSHData(xe.initData);nt=ge.getLicenseServerURLFromInitData(Tt),nt||(nt=Ne.laURL)}return nt=Xe.getServerURLFromMessage(nt,et,Re),nt}function ot(de,Re){if(Re)for(var xe in Re)de[xe]=Re[xe]}function ct(de,Re,xe,Ne,Xe){var nt="NONE",et=null;de.response&&(nt=Xe.getErrorResponse(de.response,xe,Ne),et={serverResponse:de.response||null,responseCode:de.status||null,responseText:de.statusText||null}),at(Re,new E.default(c.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,c.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+xe+' update, XHR complete. status is "'+de.statusText+'" ('+de.status+"), readyState is "+de.readyState+".  Response is "+nt,et))}function ht(de,Re){return de?de.reduce(function(xe,Ne){return xe.then(function(){return Ne(Re)})},Promise.resolve()):Promise.resolve()}function Pt(de,Re){if(!Y.get().streaming.protection.ignoreEmeEncryptedEvent){if(ee.debug("DRM: onNeedKey"),de.key.initDataType!=="cenc"){ee.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+de.key.initDataType);return}if(ae.length===0&&(ee.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),Re=typeof Re>"u"?1:Re+1,Re<S)){$.push(setTimeout(function(){Pt(de,Re)},p));return}var xe=de.key.initData;if(ArrayBuffer.isView(xe)&&(xe=xe.buffer),ge){var Ne=d.default.getPSSHForKeySystem(ge,xe);if(Ne&&J(Ne))return}ee.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(xe)));var Xe=A.getSupportedKeySystemsFromSegmentPssh(xe,ce,X);if(Xe.length===0){ee.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!");return}N(Xe)}}function $e(){return A?A.getKeySystems():[]}function Te(de){A&&A.setKeySystems(de)}return ie={initializeForMedia:le,clearMediaInfoArray:z,handleKeySystemFromManifest:te,createKeySession:B,loadKeySession:U,removeKeySession:ve,closeKeySession:me,setServerCertificate:Ae,setMediaElement:be,setSessionType:Be,setRobustnessLevel:ke,setProtectionData:Ye,getSupportedKeySystemsFromContentProtection:fe,getKeySystems:$e,setKeySystems:Te,stop:Oe,reset:Se},Z(),ie}I.__dashjs_factory_name="ProtectionController";const D=O.default.getClassFactory(I)},"./src/streaming/protection/controllers/ProtectionKeyController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>M});var d=r("./src/streaming/protection/CommonEncryption.js"),o=r("./src/streaming/protection/drm/KeySystemClearKey.js"),l=r("./src/streaming/protection/drm/KeySystemW3CClearKey.js"),c=r("./src/streaming/protection/drm/KeySystemWidevine.js"),E=r("./src/streaming/protection/drm/KeySystemPlayReady.js"),m=r("./src/streaming/protection/servers/DRMToday.js"),f=r("./src/streaming/protection/servers/PlayReady.js"),T=r("./src/streaming/protection/servers/Widevine.js"),L=r("./src/streaming/protection/servers/ClearKey.js"),P=r("./src/streaming/constants/ProtectionConstants.js");function O(){var S=this.context,p,h,C,v,I,D,y,A;function x(X){X&&(X.debug&&(h=X.debug,C=h.getLogger(p)),X.BASE64&&(I=X.BASE64),X.settings&&(D=X.settings))}function F(){v=[];var X;X=(0,E.default)(S).getInstance({BASE64:I,settings:D}),v.push(X),X=(0,c.default)(S).getInstance({BASE64:I}),v.push(X),X=(0,o.default)(S).getInstance({BASE64:I}),v.push(X),y=X,X=(0,l.default)(S).getInstance({BASE64:I,debug:h}),v.push(X),A=X}function k(){return v}function W(X){v=X}function V(X){for(var oe=0;oe<v.length;oe++)if(v[oe].systemString===X)return v[oe];return null}function Q(X){return X===y||X===A}function $(X,oe){if(X.byteLength===oe.byteLength){for(var ge=new Uint8Array(X),_e=new Uint8Array(oe),he=0;he<ge.length;he++)if(ge[he]!==_e[he])return!1;return!0}return!1}function K(X,oe,ge){var _e,he,se,Z,q=[];if(X){var le=d.default.findCencContentProtection(X);for(se=0;se<v.length;++se){he=v[se];var te=ne(he.systemString,oe);for(Z=0;Z<X.length;++Z)if(_e=X[Z],_e.schemeIdUri.toLowerCase()===he.schemeIdURI){var N=he.getInitData(_e,le);q.push({ks:v[se],keyId:_e.keyId,initData:N,protData:te,cdmData:he.getCDMData(te?te.cdmData:null),sessionId:ae(te,_e),sessionType:ce(te,ge)})}}}return q}function Y(X,oe,ge){for(var _e=[],he=d.default.parsePSSHList(X),se,Z,q=0;q<v.length;++q){se=v[q],Z=se.systemString;var le=ne(Z,oe);se.uuid in he&&_e.push({ks:se,initData:he[se.uuid],protData:le,cdmData:se.getCDMData(le?le.cdmData:null),sessionId:ae(le),sessionType:ce(le,ge)})}return _e}function re(X,oe,ge){if(ge==="license-release"||ge==="individualization-request")return null;var _e=null;return oe&&oe.hasOwnProperty("drmtoday")?_e=(0,m.default)(S).getInstance({BASE64:I}):X.systemString===P.default.WIDEVINE_KEYSTEM_STRING?_e=(0,T.default)(S).getInstance():X.systemString===P.default.PLAYREADY_KEYSTEM_STRING?_e=(0,f.default)(S).getInstance():X.systemString===P.default.CLEARKEY_KEYSTEM_STRING&&(_e=(0,L.default)(S).getInstance()),_e}function ie(X,oe,ge){try{return X.getClearKeysFromProtectionData(oe,ge)}catch{return C.error("Failed to retrieve clearkeys from ProtectionData"),null}}function ee(X){for(var oe=function(se){var Z=null;return X&&(Z=se in X?X[se]:null),Z},ge=0;ge<v.length;ge++){var _e=v[ge];_e.hasOwnProperty("init")&&_e.init(oe(_e.systemString))}}function ne(X,oe){return oe&&X in oe?oe[X]:null}function ae(X,oe){return X&&X.sessionId?X.sessionId:oe&&oe.sessionId?oe.sessionId:null}function ce(X,oe){return X&&X.sessionType?X.sessionType:oe}return p={initialize:F,setProtectionData:ee,isClearKey:Q,initDataEquals:$,getKeySystems:k,setKeySystems:W,getKeySystemBySystemString:V,getSupportedKeySystemsFromContentProtection:K,getSupportedKeySystemsFromSegmentPssh:Y,getLicenseServerModelInstance:re,processClearKeyLicenseRequest:ie,setConfig:x},p}O.__dashjs_factory_name="ProtectionKeyController";const M=dashjs.FactoryMaker.getSingletonFactory(O)},"./src/streaming/protection/drm/KeySystemClearKey.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>L});var d=r("./src/streaming/protection/vo/KeyPair.js"),o=r("./src/streaming/protection/vo/ClearKeyKeySet.js"),l=r("./src/streaming/protection/CommonEncryption.js"),c=r("./src/streaming/constants/ProtectionConstants.js"),E="e2719d58-a985-b3c9-781a-b030af78d30e",m=c.default.CLEARKEY_KEYSTEM_STRING,f="urn:uuid:"+E;function T(P){P=P||{};var O,M=P.BASE64;function S(y,A){var x=null;if(y){for(var F=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(A))),k=[],W=0;W<F.kids.length;W++){var V=F.kids[W],Q=y.clearkeys&&y.clearkeys.hasOwnProperty(V)?y.clearkeys[V]:null;if(!Q)throw new Error("DRM: ClearKey keyID ("+V+") is not known!");k.push(new d.default(V,Q))}x=new o.default(k)}return x}function p(y,A){try{var x=l.default.parseInitDataFromContentProtection(y,M);if(!x&&A){var F=h(A["cenc:default_KID"]),k={kids:[F]};x=new TextEncoder().encode(JSON.stringify(k))}return x}catch{return null}}function h(y){try{var A=y.replace(/-/g,"");return A=btoa(A.match(/\w{2}/g).map(function(x){return String.fromCharCode(parseInt(x,16))}).join("")),A.replace(/=/g,"").replace(/\//g,"_").replace(/\+/g,"-")}catch{return null}}function C(){return{"Content-Type":"application/json"}}function v(y){return JSON.stringify(JSON.parse(String.fromCharCode.apply(null,new Uint8Array(y))))}function I(){return null}function D(){return null}return O={uuid:E,schemeIdURI:f,systemString:m,getInitData:p,getRequestHeadersFromMessage:C,getLicenseRequestFromMessage:v,getLicenseServerURLFromInitData:I,getCDMData:D,getClearKeysFromProtectionData:S},O}T.__dashjs_factory_name="KeySystemClearKey";const L=dashjs.FactoryMaker.getSingletonFactory(T)},"./src/streaming/protection/drm/KeySystemPlayReady.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>T});var d=r("./src/streaming/protection/CommonEncryption.js"),o=r("./src/streaming/constants/ProtectionConstants.js"),l="9a04f079-9840-4286-ab92-e65be0885f95",c=o.default.PLAYREADY_KEYSTEM_STRING,E="urn:uuid:"+l,m='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>';function f(L){L=L||{};var P,O="utf-16",M=L.BASE64,S=L.settings;function p(){if(!M||!M.hasOwnProperty("decodeArray")||!M.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}function h(A){var x,F,k={},W=new DOMParser;if(S&&S.get().streaming.protection.detectPlayreadyMessageFormat&&O==="utf-16"&&A&&A.byteLength%2===1)return k["Content-Type"]="text/xml; charset=utf-8",k;var V=O==="utf-16"?new Uint16Array(A):new Uint8Array(A);x=String.fromCharCode.apply(null,V),F=W.parseFromString(x,"application/xml");for(var Q=F.getElementsByTagName("name"),$=F.getElementsByTagName("value"),K=0;K<Q.length;K++)k[Q[K].childNodes[0].nodeValue]=$[K].childNodes[0].nodeValue;return k.hasOwnProperty("Content")&&(k["Content-Type"]=k.Content,delete k.Content),k.hasOwnProperty("Content-Type")||(k["Content-Type"]="text/xml; charset=utf-8"),k}function C(A){var x=null,F=new DOMParser;if(S&&S.get().streaming.protection.detectPlayreadyMessageFormat&&O==="utf-16"&&A&&A.byteLength%2===1)return A;var k=O==="utf-16"?new Uint16Array(A):new Uint8Array(A);p();var W=String.fromCharCode.apply(null,k),V=F.parseFromString(W,"application/xml");if(V.getElementsByTagName("PlayReadyKeyMessage")[0]){var Q=V.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;Q&&(x=M.decode(Q))}else return A;return x}function v(A){if(A)for(var x=new DataView(A),F=x.getUint16(4,!0),k=6,W=new DOMParser,V=0;V<F;V++){var Q=x.getUint16(k,!0);k+=2;var $=x.getUint16(k,!0);if(k+=2,Q!==1){k+=$;continue}var K=A.slice(k,k+$),Y=String.fromCharCode.apply(null,new Uint16Array(K)),re=W.parseFromString(Y,"application/xml");if(re.getElementsByTagName("LA_URL")[0]){var ie=re.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(ie)return ie}if(re.getElementsByTagName("LUI_URL")[0]){var ee=re.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(ee)return ee}}return null}function I(A){var x=new Uint8Array([112,115,115,104,0,0,0,0]),F=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),k=0,W=null,V,Q,$,K,Y;if(p(),!A)return null;if("pssh"in A)return d.default.parseInitDataFromContentProtection(A,M);if("pro"in A)W=M.decodeArray(A.pro.__text);else if("prheader"in A)W=M.decodeArray(A.prheader.__text);else return null;return V=W.length,Q=4+x.length+F.length+4+V,$=new ArrayBuffer(Q),K=new Uint8Array($),Y=new DataView($),Y.setUint32(k,Q),k+=4,K.set(x,k),k+=x.length,K.set(F,k),k+=F.length,Y.setUint32(k,V),k+=4,K.set(W,k),k+=V,K.buffer}function D(A){if(A!=="utf-8"&&A!=="utf-16")throw new Error('Specified message format is not one of "utf-8" or "utf-16"');O=A}function y(A){var x,F,k,W;if(p(),!A)return null;for(x=[],W=0;W<A.length;++W)x.push(A.charCodeAt(W)),x.push(0);for(x=String.fromCharCode.apply(null,x),x=M.encode(x),F=m.replace("%CUSTOMDATA%",x),k=[],W=0;W<F.length;++W)k.push(F.charCodeAt(W)),k.push(0);return new Uint8Array(k).buffer}return P={uuid:l,schemeIdURI:E,systemString:c,getInitData:I,getRequestHeadersFromMessage:h,getLicenseRequestFromMessage:C,getLicenseServerURLFromInitData:v,getCDMData:y,setPlayReadyMessageFormat:D},P}f.__dashjs_factory_name="KeySystemPlayReady";const T=dashjs.FactoryMaker.getSingletonFactory(f)},"./src/streaming/protection/drm/KeySystemW3CClearKey.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>L});var d=r("./src/streaming/protection/vo/KeyPair.js"),o=r("./src/streaming/protection/vo/ClearKeyKeySet.js"),l=r("./src/streaming/protection/CommonEncryption.js"),c=r("./src/streaming/constants/ProtectionConstants.js"),E="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",m=c.default.CLEARKEY_KEYSTEM_STRING,f="urn:uuid:"+E;function T(P){var O,M=P.BASE64,S=P.debug.getLogger(O);function p(y,A){var x=null;if(y){for(var F=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(A))),k=[],W=0;W<F.kids.length;W++){var V=F.kids[W],Q=y.clearkeys&&y.clearkeys.hasOwnProperty(V)?y.clearkeys[V]:null;if(!Q)throw new Error("DRM: ClearKey keyID ("+V+") is not known!");k.push(new d.default(V,Q))}x=new o.default(k),S.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return x}function h(y){return l.default.parseInitDataFromContentProtection(y,M)}function C(){return null}function v(y){return new Uint8Array(y)}function I(){return null}function D(){return null}return O={uuid:E,schemeIdURI:f,systemString:m,getInitData:h,getRequestHeadersFromMessage:C,getLicenseRequestFromMessage:v,getLicenseServerURLFromInitData:I,getCDMData:D,getClearKeysFromProtectionData:p},O}T.__dashjs_factory_name="KeySystemW3CClearKey";const L=dashjs.FactoryMaker.getSingletonFactory(T)},"./src/streaming/protection/drm/KeySystemWidevine.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>f});var d=r("./src/streaming/protection/CommonEncryption.js"),o=r("./src/streaming/constants/ProtectionConstants.js"),l="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",c=o.default.WIDEVINE_KEYSTEM_STRING,E="urn:uuid:"+l;function m(T){T=T||{};var L,P=T.BASE64;function O(C){return d.default.parseInitDataFromContentProtection(C,P)}function M(){return null}function S(C){return new Uint8Array(C)}function p(){return null}function h(){return null}return L={uuid:l,schemeIdURI:E,systemString:c,getInitData:O,getRequestHeadersFromMessage:M,getLicenseRequestFromMessage:S,getLicenseServerURLFromInitData:p,getCDMData:h},L}m.__dashjs_factory_name="KeySystemWidevine";const f=dashjs.FactoryMaker.getSingletonFactory(m)},"./src/streaming/protection/errors/ProtectionErrors.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/core/errors/ErrorsBase.js");function o(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(C){return typeof C}:o=function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},o(p)}function l(p,h){if(!(p instanceof h))throw new TypeError("Cannot call a class as a function")}function c(p,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(h&&h.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),h&&E(p,h)}function E(p,h){return E=Object.setPrototypeOf||function(v,I){return v.__proto__=I,v},E(p,h)}function m(p){var h=L();return function(){var v=P(p),I;if(h){var D=P(this).constructor;I=Reflect.construct(v,arguments,D)}else I=v.apply(this,arguments);return f(this,I)}}function f(p,h){return h&&(o(h)==="object"||typeof h=="function")?h:T(p)}function T(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(p){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},P(p)}var O=function(p){c(C,p);var h=m(C);function C(){var v;return l(this,C),v=h.call(this),v.MEDIA_KEYERR_CODE=100,v.MEDIA_KEYERR_UNKNOWN_CODE=101,v.MEDIA_KEYERR_CLIENT_CODE=102,v.MEDIA_KEYERR_SERVICE_CODE=103,v.MEDIA_KEYERR_OUTPUT_CODE=104,v.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,v.MEDIA_KEYERR_DOMAIN_CODE=106,v.MEDIA_KEY_MESSAGE_ERROR_CODE=107,v.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,v.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,v.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,v.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,v.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,v.KEY_SESSION_CREATED_ERROR_CODE=113,v.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,v.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",v.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",v.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",v.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",v.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",v.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",v.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",v.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",v.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",v.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",v.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",v.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",v.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",v.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",v}return C}(d.default),M=new O;const S=M},"./src/streaming/protection/models/ProtectionModel_01b.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>L});var d=r("./src/streaming/protection/controllers/ProtectionKeyController.js"),o=r("./src/streaming/protection/vo/NeedKey.js"),l=r("./src/streaming/vo/DashJSError.js"),c=r("./src/streaming/protection/vo/KeyMessage.js"),E=r("./src/streaming/protection/vo/KeySystemConfiguration.js"),m=r("./src/streaming/protection/vo/KeySystemAccess.js"),f=r("./src/streaming/protection/errors/ProtectionErrors.js");function T(P){P=P||{};var O=this.context,M=P.eventBus,S=P.events,p=P.debug,h=P.api,C=P.errHandler,v,I,D,y,A,x,F,k,W;function V(){I=p.getLogger(v),D=null,y=null,x=[],F=[],A=(0,d.default)(O).getInstance(),W=ge()}function Q(){D&&he();for(var se=0;se<F.length;se++)ae(F[se]);M.trigger(S.TEARDOWN_COMPLETE)}function $(){for(var se=[],Z=0;Z<x.length;Z++)se.push(x[Z].initData);for(var q=0;q<F.length;q++)se.push(F[q].initData);return se}function K(){return F.concat(x)}function Y(se){return new Promise(function(Z,q){var le=D;le||(le=document.createElement("video"));for(var te=!1,N=0;N<se.length;N++)for(var R=se[N].ks.systemString,w=se[N].configs,j=null,H=null,U=0;U<w.length;U++){var B=w[U].videoCapabilities;if(B&&B.length!==0){H=[];for(var G=0;G<B.length;G++)le.canPlayType(B[G].contentType,R)!==""&&H.push(B[G])}if(!(!j&&!H||j&&j.length===0||H&&H.length===0)){te=!0;var z=new E.default(j,H),fe=A.getKeySystemBySystemString(R),ue=new m.default(fe,z);M.trigger(S.KEY_SYSTEM_ACCESS_COMPLETE,{data:ue}),Z({data:ue});break}}if(!te){var J="Key system access denied! -- No valid audio/video content configurations detected!";M.trigger(S.KEY_SYSTEM_ACCESS_COMPLETE,{error:J}),q({error:J})}})}function re(se){return y=se.keySystem,Promise.resolve(y)}function ie(se){if(D!==se){if(D){he();for(var Z=0;Z<F.length;Z++)ae(F[Z]);F=[]}D=se,D&&(D.addEventListener(h.keyerror,W),D.addEventListener(h.needkey,W),D.addEventListener(h.keymessage,W),D.addEventListener(h.keyadded,W),M.trigger(S.VIDEO_ELEMENT_SELECTED))}}function ee(se){if(!y)throw new Error("Can not create sessions until you have selected a key system");if(k||F.length===0){var Z={sessionId:null,keyId:se.keyId,initData:se.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return x.push(Z),D[h.generateKeyRequest](y.systemString,new Uint8Array(se.initData)),Z}else throw new Error("Multiple sessions not allowed!")}function ne(se,Z){var q=se.sessionId;if(!A.isClearKey(y))D[h.addKey](y.systemString,new Uint8Array(Z),new Uint8Array(se.initData),q);else for(var le=0;le<Z.keyPairs.length;le++)D[h.addKey](y.systemString,Z.keyPairs[le].key,Z.keyPairs[le].keyID,q);M.trigger(S.KEY_SESSION_UPDATED)}function ae(se){try{D[h.cancelKeyRequest](y.systemString,se.sessionId)}catch(Z){M.trigger(S.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+se.sessionId+") "+Z.message})}}function ce(){}function X(){}function oe(){}function ge(){return{handleEvent:function(Z){var q=null;switch(Z.type){case h.needkey:var le=ArrayBuffer.isView(Z.initData)?Z.initData.buffer:Z.initData;M.trigger(S.NEED_KEY,{key:new o.default(le,"cenc")});break;case h.keyerror:if(q=_e(F,Z.sessionId),q||(q=_e(x,Z.sessionId)),q){var te=f.default.MEDIA_KEYERR_CODE,N="";switch(Z.errorCode.code){case 1:te=f.default.MEDIA_KEYERR_UNKNOWN_CODE,N+="MEDIA_KEYERR_UNKNOWN - "+f.default.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:te=f.default.MEDIA_KEYERR_CLIENT_CODE,N+="MEDIA_KEYERR_CLIENT - "+f.default.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:te=f.default.MEDIA_KEYERR_SERVICE_CODE,N+="MEDIA_KEYERR_SERVICE - "+f.default.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:te=f.default.MEDIA_KEYERR_OUTPUT_CODE,N+="MEDIA_KEYERR_OUTPUT - "+f.default.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:te=f.default.MEDIA_KEYERR_HARDWARECHANGE_CODE,N+="MEDIA_KEYERR_HARDWARECHANGE - "+f.default.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:te=f.default.MEDIA_KEYERR_DOMAIN_CODE,N+="MEDIA_KEYERR_DOMAIN - "+f.default.MEDIA_KEYERR_DOMAIN_MESSAGE;break}N+="  System Code = "+Z.systemCode,M.trigger(S.KEY_ERROR,{error:new l.default(te,N,q)})}else I.error("No session token found for key error");break;case h.keyadded:q=_e(F,Z.sessionId),q||(q=_e(x,Z.sessionId)),q?(I.debug("DRM: Key added."),M.trigger(S.KEY_ADDED,{data:q})):I.debug("No session token found for key added");break;case h.keymessage:if(k=Z.sessionId!==null&&Z.sessionId!==void 0,k?(q=_e(F,Z.sessionId),!q&&x.length>0&&(q=x.shift(),F.push(q),q.sessionId=Z.sessionId,M.trigger(S.KEY_SESSION_CREATED,{data:q}))):x.length>0&&(q=x.shift(),F.push(q),x.length!==0&&C.error(new l.default(f.default.MEDIA_KEY_MESSAGE_ERROR_CODE,f.default.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),q){var R=ArrayBuffer.isView(Z.message)?Z.message.buffer:Z.message;q.keyMessage=R,M.trigger(S.INTERNAL_KEY_MESSAGE,{data:new c.default(q,R,Z.defaultURL)})}else I.warn("No session token found for key message");break}}}}function _e(se,Z){if(!Z||!se)return null;for(var q=se.length,le=0;le<q;le++)if(se[le].sessionId==Z)return se[le];return null}function he(){D.removeEventListener(h.keyerror,W),D.removeEventListener(h.needkey,W),D.removeEventListener(h.keymessage,W),D.removeEventListener(h.keyadded,W)}return v={getAllInitData:$,getSessions:K,requestKeySystemAccess:Y,selectKeySystem:re,setMediaElement:ie,createKeySession:ee,updateKeySession:ne,closeKeySession:ae,setServerCertificate:ce,loadKeySession:X,removeKeySession:oe,stop:Q,reset:Q},V(),v}T.__dashjs_factory_name="ProtectionModel_01b";const L=dashjs.FactoryMaker.getClassFactory(T)},"./src/streaming/protection/models/ProtectionModel_21Jan2015.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>P});var d=r("./src/streaming/protection/controllers/ProtectionKeyController.js"),o=r("./src/streaming/protection/vo/NeedKey.js"),l=r("./src/streaming/protection/errors/ProtectionErrors.js"),c=r("./src/streaming/vo/DashJSError.js"),E=r("./src/streaming/protection/vo/KeyMessage.js"),m=r("./src/streaming/protection/vo/KeySystemAccess.js"),f=r("./src/streaming/constants/ProtectionConstants.js"),T={};T[f.default.PLAYREADY_KEYSTEM_STRING]=[f.default.PLAYREADY_KEYSTEM_STRING,f.default.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING],T[f.default.WIDEVINE_KEYSTEM_STRING]=[f.default.WIDEVINE_KEYSTEM_STRING],T[f.default.CLEARKEY_KEYSTEM_STRING]=[f.default.CLEARKEY_KEYSTEM_STRING];function L(O){O=O||{};var M=this.context,S=O.eventBus,p=O.events,h=O.debug,C,v,I,D,y,A,x,F;function k(){v=h.getLogger(C),I=null,D=null,y=null,A=[],F=(0,d.default)(M).getInstance(),x=se()}function W(){var te=A.length,N;te!==0?function(){for(var R=function(H){Z(H),A.length===0&&(D?(D.removeEventListener("encrypted",x),D.setMediaKeys(null).then(function(){S.trigger(p.TEARDOWN_COMPLETE)})):S.trigger(p.TEARDOWN_COMPLETE))},w=0;w<te;w++)N=A[w],function(j){N.session.closed.then(function(){R(j)}),he(N).catch(function(){R(j)})}(N)}():S.trigger(p.TEARDOWN_COMPLETE)}function V(){for(var te,N=0;N<A.length;N++)te=A[N],te.getUsable()||he(te).catch(function(){Z(te)})}function Q(){for(var te=[],N=0;N<A.length;N++)A[N].initData&&te.push(A[N].initData);return te}function $(){return A}function K(te){return new Promise(function(N,R){Y(te,0,N,R)})}function Y(te,N,R,w){if(navigator.requestMediaKeySystemAccess===void 0||typeof navigator.requestMediaKeySystemAccess!="function"){var j="Insecure origins are not allowed";S.trigger(p.KEY_SYSTEM_ACCESS_COMPLETE,{error:j}),w({error:j});return}var H=te[N].protData&&te[N].protData.systemStringPriority?te[N].protData.systemStringPriority:null,U=te[N].configs,B=te[N].ks,G=B.systemString,z=H||(T[G]?T[G]:[G]);re(z,U).then(function(fe){var ue=typeof fe.getConfiguration=="function"?fe.getConfiguration():null,J=new m.default(B,ue);J.mksa=fe,S.trigger(p.KEY_SYSTEM_ACCESS_COMPLETE,{data:J}),R({data:J})}).catch(function(fe){if(N+1<te.length)Y(te,N+1,R,w);else{var ue="Key system access denied! ";S.trigger(p.KEY_SYSTEM_ACCESS_COMPLETE,{error:ue+fe.message}),w({error:ue+fe.message})}})}function re(te,N){return new Promise(function(R,w){ie(te,N,0,R,w)})}function ie(te,N,R,w,j){var H=te[R];v.debug("Requesting key system access for system string ".concat(H)),navigator.requestMediaKeySystemAccess(H,N).then(function(U){U.selectedSystemString=H,w(U)}).catch(function(U){R+1<te.length?ie(te,N,R+1,w,j):j(U)})}function ee(te){return new Promise(function(N,R){te.mksa.createMediaKeys().then(function(w){return I=te.keySystem,y=w,D?D.setMediaKeys(y):Promise.resolve()}).then(function(){N(I)}).catch(function(){R({error:"Error selecting keys system ("+te.keySystem.systemString+")! Could not create MediaKeys -- TODO"})})})}function ne(te){D!==te&&(D&&(D.removeEventListener("encrypted",x),D.setMediaKeys&&D.setMediaKeys(null)),D=te,D&&(D.addEventListener("encrypted",x),D.setMediaKeys&&y&&D.setMediaKeys(y)))}function ae(te){if(!I||!y)throw new Error("Can not set server certificate until you have selected a key system");y.setServerCertificate(te).then(function(){v.info("DRM: License server certificate successfully updated."),S.trigger(p.SERVER_CERTIFICATE_UPDATED)}).catch(function(N){S.trigger(p.SERVER_CERTIFICATE_UPDATED,{error:new c.default(l.default.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,l.default.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+N.name)})})}function ce(te){if(!I||!y)throw new Error("Can not create sessions until you have selected a key system");var N=y.createSession(te.sessionType),R=le(N,te),w=I.systemString===f.default.CLEARKEY_KEYSTEM_STRING&&(te.initData||te.protData&&te.protData.clearkeys)?f.default.INITIALIZATION_DATA_TYPE_KEYIDS:f.default.INITIALIZATION_DATA_TYPE_CENC;N.generateRequest(w,te.initData).then(function(){v.debug("DRM: Session created.  SessionID = "+R.getSessionId()),S.trigger(p.KEY_SESSION_CREATED,{data:R})}).catch(function(j){Z(R),S.trigger(p.KEY_SESSION_CREATED,{data:null,error:new c.default(l.default.KEY_SESSION_CREATED_ERROR_CODE,l.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+j.name)})})}function X(te,N){var R=te.session;F.isClearKey(I)&&(N=N.toJWK()),R.update(N).then(function(){S.trigger(p.KEY_SESSION_UPDATED)}).catch(function(w){S.trigger(p.KEY_ERROR,{error:new c.default(l.default.MEDIA_KEYERR_CODE,"Error sending update() message! "+w.name,te)})})}function oe(te){if(!I||!y)throw new Error("Can not load sessions until you have selected a key system");for(var N=te.sessionId,R=0;R<A.length;R++)if(N===A[R].sessionId){v.warn("DRM: Ignoring session ID because we have already seen it!");return}var w=y.createSession(te.sessionType),j=le(w,te);w.load(N).then(function(H){H?(v.debug("DRM: Session loaded.  SessionID = "+j.getSessionId()),S.trigger(p.KEY_SESSION_CREATED,{data:j})):(Z(j),S.trigger(p.KEY_SESSION_CREATED,{data:null,error:new c.default(l.default.KEY_SESSION_CREATED_ERROR_CODE,l.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+N+")")}))}).catch(function(H){Z(j),S.trigger(p.KEY_SESSION_CREATED,{data:null,error:new c.default(l.default.KEY_SESSION_CREATED_ERROR_CODE,l.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+N+")! "+H.name)})})}function ge(te){var N=te.session;N.remove().then(function(){v.debug("DRM: Session removed.  SessionID = "+te.getSessionId()),S.trigger(p.KEY_SESSION_REMOVED,{data:te.getSessionId()})},function(R){S.trigger(p.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+te.getSessionId()+"). "+R.name})})}function _e(te){he(te).catch(function(N){Z(te),S.trigger(p.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+te.getSessionId()+") "+N.name})})}function he(te){var N=te.session;return N.removeEventListener("keystatuseschange",te),N.removeEventListener("message",te),N.close()}function se(){return{handleEvent:function(N){switch(N.type){case"encrypted":if(N.initData){var R=ArrayBuffer.isView(N.initData)?N.initData.buffer:N.initData;S.trigger(p.NEED_KEY,{key:new o.default(R,N.initDataType)})}break}}}}function Z(te){for(var N=0;N<A.length;N++)if(A[N]===te){A.splice(N,1);break}}function q(te){var N,R;return te&&te.length>0&&(te[0]&&(typeof te[0]=="string"?N=te[0]:R=te[0]),te[1]&&(typeof te[1]=="string"?N=te[1]:R=te[1])),{status:N,keyId:R}}function le(te,N){var R={session:te,keyId:N.keyId,initData:N.initData,sessionId:N.sessionId,sessionType:N.sessionType,handleEvent:function(j){switch(j.type){case"keystatuseschange":S.trigger(p.KEY_STATUSES_CHANGED,{data:this}),j.target.keyStatuses.forEach(function(){var U=q(arguments);switch(U.status){case"expired":S.trigger(p.INTERNAL_KEY_STATUS_CHANGED,{error:new c.default(l.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,l.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)});break;default:S.trigger(p.INTERNAL_KEY_STATUS_CHANGED,U);break}});break;case"message":var H=ArrayBuffer.isView(j.message)?j.message.buffer:j.message;S.trigger(p.INTERNAL_KEY_MESSAGE,{data:new E.default(this,H,void 0,j.messageType)});break}},getKeyId:function(){return this.keyId},getSessionId:function(){return te.sessionId},getSessionType:function(){return this.sessionType},getExpirationTime:function(){return te.expiration},getKeyStatuses:function(){return te.keyStatuses},getUsable:function(){var j=!1;return te.keyStatuses.forEach(function(){var H=q(arguments);H.status==="usable"&&(j=!0)}),j}};return te.addEventListener("keystatuseschange",R),te.addEventListener("message",R),te.closed.then(function(){Z(R),v.debug("DRM: Session closed.  SessionID = "+R.getSessionId()),S.trigger(p.KEY_SESSION_CLOSED,{data:R.getSessionId()})}),A.push(R),R}return C={getAllInitData:Q,getSessions:$,requestKeySystemAccess:K,selectKeySystem:ee,setMediaElement:ne,setServerCertificate:ae,createKeySession:ce,updateKeySession:X,loadKeySession:oe,removeKeySession:ge,closeKeySession:_e,stop:V,reset:W},k(),C}L.__dashjs_factory_name="ProtectionModel_21Jan2015";const P=dashjs.FactoryMaker.getClassFactory(L)},"./src/streaming/protection/models/ProtectionModel_3Feb2014.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>L});var d=r("./src/streaming/protection/controllers/ProtectionKeyController.js"),o=r("./src/streaming/protection/vo/NeedKey.js"),l=r("./src/streaming/vo/DashJSError.js"),c=r("./src/streaming/protection/errors/ProtectionErrors.js"),E=r("./src/streaming/protection/vo/KeyMessage.js"),m=r("./src/streaming/protection/vo/KeySystemConfiguration.js"),f=r("./src/streaming/protection/vo/KeySystemAccess.js");function T(P){P=P||{};var O=this.context,M=P.eventBus,S=P.events,p=P.debug,h=P.api,C,v,I,D,y,A,x,F,k;function W(){v=p.getLogger(C),I=null,D=null,y=null,A=null,x=[],k=(0,d.default)(O).getInstance(),F=oe()}function V(){try{for(var he=0;he<x.length;he++)ne(x[he]);I&&I.removeEventListener(h.needkey,F),M.trigger(S.TEARDOWN_COMPLETE)}catch(se){M.trigger(S.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+se.message})}}function Q(){for(var he=[],se=0;se<x.length;se++)he.push(x[se].initData);return he}function $(){return x}function K(he){return new Promise(function(se,Z){for(var q=!1,le=0;le<he.length;le++)for(var te=he[le].ks.systemString,N=he[le].configs,R=null,w=null,j=0;j<N.length;j++){var H=N[j].audioCapabilities,U=N[j].videoCapabilities;if(H&&H.length!==0){R=[];for(var B=0;B<H.length;B++)window[h.MediaKeys].isTypeSupported(te,H[B].contentType)&&R.push(H[B])}if(U&&U.length!==0){w=[];for(var G=0;G<U.length;G++)window[h.MediaKeys].isTypeSupported(te,U[G].contentType)&&w.push(U[G])}if(!(!R&&!w||R&&R.length===0||w&&w.length===0)){q=!0;var z=new m.default(R,w),fe=k.getKeySystemBySystemString(te),ue=new f.default(fe,z);M.trigger(S.KEY_SYSTEM_ACCESS_COMPLETE,{data:ue}),se({data:ue});break}}if(!q){var J="Key system access denied! -- No valid audio/video content configurations detected!";M.trigger(S.KEY_SYSTEM_ACCESS_COMPLETE,{error:J}),Z({error:J})}})}function Y(he){return new Promise(function(se,Z){try{y=he.mediaKeys=new window[h.MediaKeys](he.keySystem.systemString),D=he.keySystem,A=he,I&&ge(),se(D)}catch{Z({error:"Error selecting keys system ("+D.systemString+")! Could not create MediaKeys -- TODO"})}})}function re(he){I!==he&&(I&&I.removeEventListener(h.needkey,F),I=he,I&&(I.addEventListener(h.needkey,F),y&&ge()))}function ie(he){if(!D||!y||!A)throw new Error("Can not create sessions until you have selected a key system");var se=null;if(A.ksConfiguration.videoCapabilities&&A.ksConfiguration.videoCapabilities.length>0&&(se=A.ksConfiguration.videoCapabilities[0]),se===null&&A.ksConfiguration.audioCapabilities&&A.ksConfiguration.audioCapabilities.length>0&&(se=A.ksConfiguration.audioCapabilities[0]),se===null)throw new Error("Can not create sessions for unknown content types.");var Z=se.contentType,q=y.createSession(Z,new Uint8Array(he.initData),he.cdmData?new Uint8Array(he.cdmData):null),le=_e(q,he);q.addEventListener(h.error,le),q.addEventListener(h.message,le),q.addEventListener(h.ready,le),q.addEventListener(h.close,le),x.push(le),v.debug("DRM: Session created.  SessionID = "+le.getSessionId()),M.trigger(S.KEY_SESSION_CREATED,{data:le})}function ee(he,se){var Z=he.session;k.isClearKey(D)?Z.update(new Uint8Array(se.toJWK())):Z.update(new Uint8Array(se)),M.trigger(S.KEY_SESSION_UPDATED)}function ne(he){var se=he.session;se.removeEventListener(h.error,he),se.removeEventListener(h.message,he),se.removeEventListener(h.ready,he),se.removeEventListener(h.close,he);for(var Z=0;Z<x.length;Z++)if(x[Z]===he){x.splice(Z,1);break}se[h.release]()}function ae(){}function ce(){}function X(){}function oe(){return{handleEvent:function(se){switch(se.type){case h.needkey:if(se.initData){var Z=ArrayBuffer.isView(se.initData)?se.initData.buffer:se.initData;M.trigger(S.NEED_KEY,{key:new o.default(Z,"cenc")})}break}}}}function ge(){var he=null,se=function(){I.removeEventListener("loadedmetadata",he),I[h.setMediaKeys](y),M.trigger(S.VIDEO_ELEMENT_SELECTED)};I.readyState>=1?se():(he=se.bind(this),I.addEventListener("loadedmetadata",he))}function _e(he,se){return{session:he,keyId:se.keyId,initData:se.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(q){switch(q.type){case h.error:var le="KeyError";M.trigger(S.KEY_ERROR,{error:new l.default(c.default.MEDIA_KEYERR_CODE,le,this)});break;case h.message:var te=ArrayBuffer.isView(q.message)?q.message.buffer:q.message;M.trigger(S.INTERNAL_KEY_MESSAGE,{data:new E.default(this,te,q.destinationURL)});break;case h.ready:v.debug("DRM: Key added."),M.trigger(S.KEY_ADDED);break;case h.close:v.debug("DRM: Session closed.  SessionID = "+this.getSessionId()),M.trigger(S.KEY_SESSION_CLOSED,{data:this.getSessionId()});break}}}}return C={getAllInitData:Q,getSessions:$,requestKeySystemAccess:K,selectKeySystem:Y,setMediaElement:re,createKeySession:ie,updateKeySession:ee,closeKeySession:ne,setServerCertificate:ae,loadKeySession:ce,removeKeySession:X,stop:V,reset:V},W(),C}T.__dashjs_factory_name="ProtectionModel_3Feb2014";const L=dashjs.FactoryMaker.getClassFactory(T)},"./src/streaming/protection/servers/ClearKey.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/streaming/protection/vo/KeyPair.js"),o=r("./src/streaming/protection/vo/ClearKeyKeySet.js");function l(){var E;function m(O){return O}function f(){return"POST"}function T(){return"json"}function L(O){if(!O.hasOwnProperty("keys"))return null;for(var M=[],S=0;S<O.keys.length;S++){var p=O.keys[S],h=p.kid.replace(/=/g,""),C=p.k.replace(/=/g,"");M.push(new d.default(h,C))}return new o.default(M)}function P(O){return String.fromCharCode.apply(null,new Uint8Array(O))}return E={getServerURLFromMessage:m,getHTTPMethod:f,getResponseType:T,getLicenseMessage:L,getErrorResponse:P},E}l.__dashjs_factory_name="ClearKey";const c=dashjs.FactoryMaker.getSingletonFactory(l)},"./src/streaming/protection/servers/DRMToday.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/streaming/constants/ProtectionConstants.js");function o(c){c=c||{};var E=c.BASE64,m={};m[d.default.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(h){return E.decodeArray(h.license)},getErrorResponse:function(h){return h}},m[d.default.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(h){return h},getErrorResponse:function(h){return String.fromCharCode.apply(null,new Uint8Array(h))}};var f;function T(){if(!E||!E.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}function L(p){return p}function P(){return"POST"}function O(p){return m[p].responseType}function M(p,h){return T(),m[h].getLicenseMessage(p)}function S(p,h){return m[h].getErrorResponse(p)}return f={getServerURLFromMessage:L,getHTTPMethod:P,getResponseType:O,getLicenseMessage:M,getErrorResponse:S},f}o.__dashjs_factory_name="DRMToday";const l=dashjs.FactoryMaker.getSingletonFactory(o)},"./src/streaming/protection/servers/PlayReady.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/core/FactoryMaker.js");function o(){var c,E="http://schemas.xmlsoap.org/soap/envelope/";function m(p){var h=String.fromCharCode.apply(null,new Uint8Array(p)),C=decodeURIComponent(escape(h));return C}function f(p){if(window.DOMParser){var h=m(p),C=new window.DOMParser,v=C.parseFromString(h,"text/xml"),I=v?v.getElementsByTagNameNS(E,"Envelope")[0]:null,D=I?I.getElementsByTagNameNS(E,"Body")[0]:null,y=D?D.getElementsByTagNameNS(E,"Fault")[0]:null;if(y)return null}return p}function T(p){var h="",C="",v="",I=-1,D=-1;if(window.DOMParser){var y=m(p),A=new window.DOMParser,x=A.parseFromString(y,"text/xml"),F=x?x.getElementsByTagNameNS(E,"Envelope")[0]:null,k=F?F.getElementsByTagNameNS(E,"Body")[0]:null,W=k?k.getElementsByTagNameNS(E,"Fault")[0]:null,V=W?W.getElementsByTagName("detail")[0]:null,Q=V?V.getElementsByTagName("Exception")[0]:null,$=null;if(W===null)return y;$=W.getElementsByTagName("faultstring")[0].firstChild,h=$?$.nodeValue:null,Q!==null&&($=Q.getElementsByTagName("StatusCode")[0],C=$?$.firstChild.nodeValue:null,$=Q.getElementsByTagName("Message")[0],v=$?$.firstChild.nodeValue:null,I=v?v.lastIndexOf("[")+1:-1,D=v?v.indexOf("]"):-1,v=v?v.substring(I,D):"")}var K="code: ".concat(C,", name: ").concat(h);return v&&(K+=", message: ".concat(v)),K}function L(p){return p}function P(){return"POST"}function O(){return"arraybuffer"}function M(p){return f.call(this,p)}function S(p){return T.call(this,p)}return c={getServerURLFromMessage:L,getHTTPMethod:P,getResponseType:O,getLicenseMessage:M,getErrorResponse:S},c}o.__dashjs_factory_name="PlayReady";const l=d.default.getSingletonFactory(o)},"./src/streaming/protection/servers/Widevine.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>o});function d(){var l;function c(L){return L}function E(){return"POST"}function m(){return"arraybuffer"}function f(L){return L}function T(L){return String.fromCharCode.apply(null,new Uint8Array(L))}return l={getServerURLFromMessage:c,getHTTPMethod:E,getResponseType:m,getLicenseMessage:f,getErrorResponse:T},l}d.__dashjs_factory_name="Widevine";const o=dashjs.FactoryMaker.getSingletonFactory(d)},"./src/streaming/protection/vo/ClearKeyKeySet.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});function d(m,f){if(!(m instanceof f))throw new TypeError("Cannot call a class as a function")}function o(m,f){for(var T=0;T<f.length;T++){var L=f[T];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(m,L.key,L)}}function l(m,f,T){return f&&o(m.prototype,f),T&&o(m,T),m}var c=function(){function m(f,T){if(d(this,m),T&&T!=="persistent"&&T!=="temporary")throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=f,this.type=T}return l(m,[{key:"toJWK",value:function(){var T,L=this.keyPairs.length,P={keys:[]};for(T=0;T<L;T++){var O={kty:"oct",alg:"A128KW",kid:this.keyPairs[T].keyID,k:this.keyPairs[T].key};P.keys.push(O)}this.type&&(P.type=this.type);var M=JSON.stringify(P),S=M.length,p=new ArrayBuffer(S),h=new Uint8Array(p);for(T=0;T<S;T++)h[T]=M.charCodeAt(T);return p}}]),m}();const E=c},"./src/streaming/protection/vo/KeyMessage.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(E,m,f,T){d(this,c),this.sessionToken=E,this.message=m,this.defaultURL=f,this.messageType=T||"license-request"};const l=o},"./src/streaming/protection/vo/KeyPair.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(E,m){d(this,c),this.keyID=E,this.key=m};const l=o},"./src/streaming/protection/vo/KeySystemAccess.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(E,m){d(this,c),this.keySystem=E,this.ksConfiguration=m};const l=o},"./src/streaming/protection/vo/KeySystemConfiguration.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(E,m,f,T,L){d(this,c),this.initDataTypes=["cenc"],E&&E.length&&(this.audioCapabilities=E),m&&m.length&&(this.videoCapabilities=m),this.distinctiveIdentifier=f,this.persistentState=T,this.sessionTypes=L};const l=o},"./src/streaming/protection/vo/LicenseRequest.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(E,m,f,T,L,P,O,M){d(this,c),this.url=E,this.method=m,this.responseType=f,this.headers=T,this.withCredentials=L,this.messageType=P,this.sessionId=O,this.data=M};const l=o},"./src/streaming/protection/vo/LicenseResponse.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(E,m,f){d(this,c),this.url=E,this.headers=m,this.data=f};const l=o},"./src/streaming/protection/vo/MediaCapability.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(E,m){d(this,c),this.contentType=E,this.robustness=m};const l=o},"./src/streaming/protection/vo/NeedKey.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(E,m){d(this,c),this.initData=E,this.initDataType=m};const l=o},"./src/streaming/rules/DroppedFramesHistory.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/core/FactoryMaker.js");function o(){var E={},m={},f={};function T(M,S,p){if(S){E[M]||(E[M]=[],m[M]=0,f[M]=0);var h=p&&p.droppedVideoFrames?p.droppedVideoFrames:0,C=p&&p.totalVideoFrames?p.totalVideoFrames:0,v=h-m[M];m[M]=h;var I=C-f[M];f[M]=C;var D=E[M];isNaN(S)||(D[S]?(D[S].droppedVideoFrames+=v,D[S].totalVideoFrames+=I):D[S]={droppedVideoFrames:v,totalVideoFrames:I})}}function L(M){return E[M]}function P(M){try{delete E[M],delete m[M],delete f[M]}catch{}}function O(){E={},m={},f={}}return{push:T,getFrameHistory:L,clearForStream:P,reset:O}}o.__dashjs_factory_name="DroppedFramesHistory";var l=d.default.getClassFactory(o);const c=l},"./src/streaming/rules/RulesContext.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/core/FactoryMaker.js");function o(c){c=c||{};var E,m=c.abrController,f=c.switchHistory,T=c.droppedFramesHistory,L=c.currentRequest,P=c.useBufferOccupancyABR,O=c.useL2AABR,M=c.useLoLPABR,S=c.streamProcessor?c.streamProcessor.getScheduleController():null,p=c.streamProcessor?c.streamProcessor.getRepresentationInfo():null,h=c.videoModel?c.videoModel:null;function C(){var K=I();return K?K.type:null}function v(){var K=I();return K?K.streamInfo:null}function I(){return p?p.mediaInfo:null}function D(){return p}function y(){return S}function A(){return m}function x(){return f}function F(){return h}function k(){return T}function W(){return L}function V(){return P}function Q(){return O}function $(){return M}return E={getMediaType:C,getMediaInfo:I,getDroppedFramesHistory:k,getCurrentRequest:W,getSwitchHistory:x,getStreamInfo:v,getScheduleController:y,getAbrController:A,getRepresentationInfo:D,useBufferOccupancyABR:V,useL2AABR:Q,useLoLPABR:$,getVideoModel:F},E}o.__dashjs_factory_name="RulesContext";const l=d.default.getClassFactory(o)},"./src/streaming/rules/SwitchRequest.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/core/FactoryMaker.js"),o=-1,l={DEFAULT:.5,STRONG:1,WEAK:0};function c(f,T,L){var P,O,M,S;function p(h){var C=l.DEFAULT;return(h===l.DEFAULT||h===l.STRONG||h===l.WEAK)&&(C=h),C}return O=f===void 0?o:f,M=p(L),S=T===void 0?null:T,P={quality:O,reason:S,priority:M},P}c.__dashjs_factory_name="SwitchRequest";var E=d.default.getClassFactory(c);E.NO_CHANGE=o,E.PRIORITY=l,d.default.updateClassFactory(c.__dashjs_factory_name,E);const m=E},"./src/streaming/rules/SwitchRequestHistory.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/rules/SwitchRequest.js"),l=8;function c(){var f=[],T=[];function L(M){M.newValue===o.default.NO_CHANGE&&(M.newValue=M.oldValue),f[M.oldValue]||(f[M.oldValue]={noDrops:0,drops:0,dropSize:0});var S=M.newValue-M.oldValue,p=S<0?1:0,h=p?-S:0,C=p?0:1;if(f[M.oldValue].drops+=p,f[M.oldValue].dropSize+=h,f[M.oldValue].noDrops+=C,T.push({idx:M.oldValue,noDrop:C,drop:p,dropSize:h}),T.length>l){var v=T.shift();f[v.idx].drops-=v.drop,f[v.idx].dropSize-=v.dropSize,f[v.idx].noDrops-=v.noDrop}}function P(){return f}function O(){f=[],T=[]}return{push:L,getSwitchRequests:P,reset:O}}c.__dashjs_factory_name="SwitchRequestHistory";var E=d.default.getClassFactory(c);const m=E},"./src/streaming/rules/ThroughputHistory.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/core/FactoryMaker.js");function l(E){E=E||{};var m=20,f=3,T=4,L=4,P=1.3,O=1.3,M=8,S=3,p=2,h=1,C=E.settings,v,I,D,y,A;function x(){A={throughputHalfLife:{fast:S,slow:M},latencyHalfLife:{fast:h,slow:p}},ae()}function F(X,oe,ge){if(X===d.default.VIDEO)return ge<C.get().streaming.cacheLoadThresholds[d.default.VIDEO];if(X===d.default.AUDIO)return ge<C.get().streaming.cacheLoadThresholds[d.default.AUDIO]}function k(X,oe,ge){if(!(!oe.trace||!oe.trace.length)){var _e=oe.tresponse.getTime()-oe.trequest.getTime()||1,he=oe._tfinish.getTime()-oe.tresponse.getTime()||1,se=oe.trace.reduce(function(N,R){return N+R.b[0]},0),Z=0,q=0;if(oe._fileLoaderType&&oe._fileLoaderType===d.default.FILE_LOADER_TYPES.FETCH?Z=oe.trace.reduce(function(N,R){return N+R.d},0):Z=ge?he:_e+he,Z!==0&&(q=Math.round(8*se/Z)),oe.cmsd){var le=oe.cmsd.dynamic&&oe.cmsd.dynamic.etp?oe.cmsd.dynamic.etp:null;if(le){var te=C.get().streaming.cmsd.abr.etpWeightRatio;te>0&&te<=1&&(q=q*(1-te)+le*te)}}if(ee(X),F(X,_e,he)){if(v[X].length>0&&!v[X].hasCachedEntries)return;v[X].hasCachedEntries=!0}else v[X]&&v[X].hasCachedEntries&&ne(X);v[X].push(q),v[X].length>m&&v[X].shift(),I[X].push(_e),I[X].length>m&&I[X].shift(),W(D[X],q,.001*he,A.throughputHalfLife),W(y[X],_e,1,A.latencyHalfLife)}}function W(X,oe,ge,_e){var he=Math.pow(.5,ge/_e.fast);X.fastEstimate=(1-he)*oe+he*X.fastEstimate;var se=Math.pow(.5,ge/_e.slow);X.slowEstimate=(1-se)*oe+se*X.slowEstimate,X.totalWeight+=ge}function V(X,oe,ge){var _e,he;if(X?(_e=v[oe],he=ge?f:T):(_e=I[oe],he=L),!_e)he=0;else if(he>=_e.length)he=_e.length;else if(X)for(var se=1;se<he;++se){var Z=_e[_e.length-se]/_e[_e.length-se-1];if((Z>=O||Z<=1/P)&&(he+=1,he===_e.length))break}return he}function Q(X,oe,ge){return C.get().streaming.abr.movingAverageMethod!==d.default.MOVING_AVERAGE_SLIDING_WINDOW?K(X,oe):$(X,oe,ge)}function $(X,oe,ge){var _e=V(X,oe,ge),he=X?v:I,se=he[oe];return _e===0||!se||se.length===0?NaN:(se=se.slice(-_e),se.reduce(function(Z,q){return Z+q})/se.length)}function K(X,oe){var ge=X?A.throughputHalfLife:A.latencyHalfLife,_e=X?D[oe]:y[oe];if(!_e||_e.totalWeight<=0)return NaN;var he=_e.fastEstimate/(1-Math.pow(.5,_e.totalWeight/ge.fast)),se=_e.slowEstimate/(1-Math.pow(.5,_e.totalWeight/ge.slow));return X?Math.min(he,se):Math.max(he,se)}function Y(X,oe){return Q(!0,X,oe)}function re(X,oe){var ge=Y(X,oe);return isNaN(ge)||(ge*=C.get().streaming.abr.bandwidthSafetyFactor),ge}function ie(X){return Q(!1,X)}function ee(X){v[X]=v[X]||[],I[X]=I[X]||[],D[X]=D[X]||{fastEstimate:0,slowEstimate:0,totalWeight:0},y[X]=y[X]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function ne(X){delete v[X],delete I[X],delete D[X],delete y[X],ee(X)}function ae(){v={},I={},D={},y={}}var ce={push:k,getAverageThroughput:Y,getSafeAverageThroughput:re,getAverageLatency:ie,reset:ae};return x(),ce}l.__dashjs_factory_name="ThroughputHistory";const c=o.default.getClassFactory(l)},"./src/streaming/rules/abr/ABRRulesCollection.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>C});var d=r("./src/streaming/rules/abr/ThroughputRule.js"),o=r("./src/streaming/rules/abr/InsufficientBufferRule.js"),l=r("./src/streaming/rules/abr/AbandonRequestsRule.js"),c=r("./src/streaming/rules/abr/DroppedFramesRule.js"),E=r("./src/streaming/rules/abr/SwitchHistoryRule.js"),m=r("./src/streaming/rules/abr/BolaRule.js"),f=r("./src/streaming/rules/abr/L2ARule.js"),T=r("./src/streaming/rules/abr/lolp/LoLpRule.js"),L=r("./src/core/FactoryMaker.js"),P=r("./src/streaming/rules/SwitchRequest.js"),O=r("./src/streaming/constants/Constants.js"),M="qualitySwitchRules",S="abandonFragmentRules";function p(v){v=v||{};var I=this.context,D=v.mediaPlayerModel,y=v.customParametersModel,A=v.dashMetrics,x=v.settings,F,k,W;function V(){k=[],W=[],x.get().streaming.abr.useDefaultABRRules&&(x.get().streaming.abr.ABRStrategy===O.default.ABR_STRATEGY_L2A?k.push((0,f.default)(I).create({dashMetrics:A,settings:x})):x.get().streaming.abr.ABRStrategy===O.default.ABR_STRATEGY_LoLP?k.push((0,T.default)(I).create({dashMetrics:A})):(k.push((0,m.default)(I).create({dashMetrics:A,mediaPlayerModel:D,settings:x})),k.push((0,d.default)(I).create({dashMetrics:A})),x.get().streaming.abr.additionalAbrRules.insufficientBufferRule&&k.push((0,o.default)(I).create({dashMetrics:A,settings:x})),x.get().streaming.abr.additionalAbrRules.switchHistoryRule&&k.push((0,E.default)(I).create()),x.get().streaming.abr.additionalAbrRules.droppedFramesRule&&k.push((0,c.default)(I).create()),x.get().streaming.abr.additionalAbrRules.abandonRequestsRule&&W.push((0,l.default)(I).create({dashMetrics:A,mediaPlayerModel:D,settings:x}))));var ee=y.getAbrCustomRules();ee.forEach(function(ne){ne.type===M&&k.push(ne.rule(I).create()),ne.type===S&&W.push(ne.rule(I).create())})}function Q(ee){return ee.filter(function(ne){return ne.quality>P.default.NO_CHANGE})}function $(ee){var ne={},ae=null,ce,X,oe,ge,_e;if(ee.length!==0){for(ne[P.default.PRIORITY.STRONG]={quality:P.default.NO_CHANGE,reason:null},ne[P.default.PRIORITY.WEAK]={quality:P.default.NO_CHANGE,reason:null},ne[P.default.PRIORITY.DEFAULT]={quality:P.default.NO_CHANGE,reason:null},ce=0,X=ee.length;ce<X;ce+=1)oe=ee[ce],oe.quality!==P.default.NO_CHANGE&&(ne[oe.priority].quality===P.default.NO_CHANGE||ne[oe.priority].quality>oe.quality)&&(ne[oe.priority].quality=oe.quality,ne[oe.priority].reason=oe.reason||null);return ne[P.default.PRIORITY.WEAK].quality!==P.default.NO_CHANGE&&(ae=ne[P.default.PRIORITY.WEAK]),ne[P.default.PRIORITY.DEFAULT].quality!==P.default.NO_CHANGE&&(ae=ne[P.default.PRIORITY.DEFAULT]),ne[P.default.PRIORITY.STRONG].quality!==P.default.NO_CHANGE&&(ae=ne[P.default.PRIORITY.STRONG]),ae&&(ge=ae.quality,_e=ae.reason),(0,P.default)(I).create(ge,_e)}}function K(ee){var ne=k.map(function(X){return X.getMaxIndex(ee)}),ae=Q(ne),ce=$(ae);return ce||(0,P.default)(I).create()}function Y(ee,ne){var ae=W.map(function(oe){return oe.shouldAbandon(ee,ne)}),ce=Q(ae),X=$(ce);return X||(0,P.default)(I).create()}function re(){[k,W].forEach(function(ee){ee&&ee.length&&ee.forEach(function(ne){return ne.reset&&ne.reset()})}),k=[],W=[]}function ie(){return k}return F={initialize:V,reset:re,getMaxQuality:K,getMinSwitchRequest:$,shouldAbandonFragment:Y,getQualitySwitchRules:ie},F}p.__dashjs_factory_name="ABRRulesCollection";var h=L.default.getClassFactory(p);h.QUALITY_SWITCH_RULES=M,h.ABANDON_FRAGMENT_RULES=S,L.default.updateSingletonFactory(p.__dashjs_factory_name,h);const C=h},"./src/streaming/rules/abr/AbandonRequestsRule.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/streaming/rules/SwitchRequest.js"),o=r("./src/core/FactoryMaker.js"),l=r("./src/core/Debug.js");function c(m){m=m||{};var f=1.8,T=500,L=5,P=this.context,O=m.mediaPlayerModel,M=m.dashMetrics,S=m.settings,p,h,C,v,I;function D(){h=(0,l.default)(P).getInstance().getLogger(p),F()}function y(k,W){C[k]=C[k]||{},C[k][W]=C[k][W]||{}}function A(k,W){I[k]=I[k]||[],I[k].push(W)}function x(k){var W=(0,d.default)(P).create(d.default.NO_CHANGE,{name:c.__dashjs_factory_name});if(!k||!k.hasOwnProperty("getMediaInfo")||!k.hasOwnProperty("getMediaType")||!k.hasOwnProperty("getCurrentRequest")||!k.hasOwnProperty("getRepresentationInfo")||!k.hasOwnProperty("getAbrController"))return W;var V=k.getMediaInfo(),Q=k.getMediaType(),$=k.getStreamInfo(),K=$?$.id:null,Y=k.getCurrentRequest();if(!isNaN(Y.index)){y(Q,Y.index);var re=O.getStableBufferTime(),ie=M.getCurrentBufferLevel(Q);if(ie>re)return W;var ee=C[Q][Y.index];if(ee===null||Y.firstByteDate===null||v.hasOwnProperty(ee.id))return W;if(ee.firstByteTime===void 0&&(I[Q]=[],ee.firstByteTime=Y.firstByteDate.getTime(),ee.segmentDuration=Y.duration,ee.bytesTotal=Y.bytesTotal,ee.id=Y.index),ee.bytesLoaded=Y.bytesLoaded,ee.elapsedTime=new Date().getTime()-ee.firstByteTime,ee.bytesLoaded>0&&ee.elapsedTime>0&&A(Q,Math.round(ee.bytesLoaded*8/ee.elapsedTime)),I[Q].length>=L&&ee.elapsedTime>T&&ee.bytesLoaded<ee.bytesTotal){var ne=I[Q].reduce(function(se,Z){return se+Z},0);if(ee.measuredBandwidthInKbps=Math.round(ne/I[Q].length),ee.estimatedTimeOfDownload=+(ee.bytesTotal*8/ee.measuredBandwidthInKbps/1e3).toFixed(2),ee.estimatedTimeOfDownload<ee.segmentDuration*f||k.getRepresentationInfo().quality===0)return W;if(!v.hasOwnProperty(ee.id)){var ae=k.getAbrController(),ce=ee.bytesTotal-ee.bytesLoaded,X=ae.getBitrateList(V),oe=ae.getQualityForBitrate(V,ee.measuredBandwidthInKbps*S.get().streaming.abr.bandwidthSafetyFactor,K),ge=ae.getMinAllowedIndexFor(Q,K),_e=ge!==void 0?Math.max(ge,oe):oe,he=ee.bytesTotal*X[_e].bitrate/X[ae.getQualityFor(Q,K)].bitrate;ce>he&&(W.quality=_e,W.reason.throughput=ee.measuredBandwidthInKbps,W.reason.fragmentID=ee.id,v[ee.id]=ee,h.debug("["+Q+"] frag id",ee.id," is asking to abandon and switch to quality to ",_e," measured bandwidth was",ee.measuredBandwidthInKbps),delete C[Q][ee.id])}}else ee.bytesLoaded===ee.bytesTotal&&delete C[Q][ee.id]}return W}function F(){C={},v={},I=[]}return p={shouldAbandon:x,reset:F},D(),p}c.__dashjs_factory_name="AbandonRequestsRule";const E=o.default.getClassFactory(c)},"./src/streaming/rules/abr/BolaRule.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>v});var d=r("./src/streaming/constants/MetricsConstants.js"),o=r("./src/streaming/rules/SwitchRequest.js"),l=r("./src/core/FactoryMaker.js"),c=r("./src/streaming/vo/metrics/HTTPRequest.js"),E=r("./src/core/EventBus.js"),m=r("./src/core/events/Events.js"),f=r("./src/core/Debug.js"),T=r("./src/streaming/MediaPlayerEvents.js"),L=r("./src/streaming/constants/Constants.js"),P=0,O=1,M=2,S=10,p=2,h=.99;function C(I){I=I||{};var D=this.context,y=I.dashMetrics,A=I.mediaPlayerModel,x=(0,E.default)(D).getInstance(),F,k,W;function V(){k=(0,f.default)(D).getInstance().getLogger(F),le(),x.on(T.default.BUFFER_EMPTY,X,F),x.on(T.default.PLAYBACK_SEEKING,oe,F),x.on(T.default.METRIC_ADDED,_e,F),x.on(T.default.QUALITY_CHANGE_REQUESTED,se,F),x.on(T.default.FRAGMENT_LOADING_ABANDONED,Z,F),x.on(m.default.MEDIA_FRAGMENT_LOADED,ge,F)}function Q(N){return N.map(function(R){return Math.log(R)})}function $(N,R,w){var j=w.reduce(function(G,z,fe){return z>w[G]?fe:G},0);if(j===0)return null;var H=Math.max(N,S+p*R.length),U=(w[j]-1)/(H/S-1),B=S/U;return{gp:U,Vp:B}}function K(N){var R={},w=N.getMediaInfo(),j=w.bitrateList.map(function(G){return G.bandwidth}),H=Q(j);H=H.map(function(G){return G-H[0]+1});var U=A.getStableBufferTime(),B=$(U,j,H);return B?(R.state=O,R.bitrates=j,R.utilities=H,R.stableBufferTime=U,R.Vp=B.Vp,R.gp=B.gp,R.lastQuality=0,Y(R)):R.state=P,R}function Y(N){N.placeholderBuffer=0,N.mostAdvancedSegmentStart=NaN,N.lastSegmentWasReplacement=!1,N.lastSegmentStart=NaN,N.lastSegmentDurationS=NaN,N.lastSegmentRequestTimeMs=NaN,N.lastSegmentFinishTimeMs=NaN}function re(N,R){var w=A.getStableBufferTime();if(N.stableBufferTime!==w){var j=$(w,N.bitrates,N.utilities);if(j.Vp!==N.Vp||j.gp!==N.gp){var H=y.getCurrentBufferLevel(R),U=H+N.placeholderBuffer;U-=S,U*=j.Vp/N.Vp,U+=S,N.stableBufferTime=w,N.Vp=j.Vp,N.gp=j.gp,N.placeholderBuffer=Math.max(0,U-H)}}}function ie(N){var R=N.getMediaType(),w=W[R];return w?w.state!==P&&re(w,R):(w=K(N),W[R]=w),w}function ee(N,R){for(var w=N.bitrates.length,j=NaN,H=NaN,U=0;U<w;++U){var B=(N.Vp*(N.utilities[U]+N.gp)-R)/N.bitrates[U];(isNaN(H)||B>=H)&&(H=B,j=U)}return j}function ne(N,R){return N.Vp*(N.utilities[R]+N.gp)}function ae(N,R){for(var w=N.bitrates[R],j=N.utilities[R],H=0,U=R-1;U>=0;--U)if(N.utilities[U]<N.utilities[R]){var B=N.bitrates[U],G=N.utilities[U],z=N.Vp*(N.gp+(w*G-B*j)/(w-B));H=Math.max(H,z)}return H}function ce(N,R){var w=Date.now();if(isNaN(N.lastSegmentFinishTimeMs)){if(!isNaN(N.lastCallTimeMs)){var H=.001*(w-N.lastCallTimeMs);N.placeholderBuffer+=Math.max(0,H)}}else{var j=.001*(w-N.lastSegmentFinishTimeMs);N.placeholderBuffer+=Math.max(0,j)}N.lastCallTimeMs=w,N.lastSegmentStart=NaN,N.lastSegmentRequestTimeMs=NaN,N.lastSegmentFinishTimeMs=NaN,re(N,R)}function X(N){var R=N.mediaType,w=R===L.default.AUDIO?[L.default.AUDIO]:W;for(var j in w)W.hasOwnProperty(j)&&W[j].state===M&&(W[j].placeholderBuffer=0)}function oe(){for(var N in W)if(W.hasOwnProperty(N)){var R=W[N];R.state!==P&&(R.state=O,Y(R))}}function ge(N){if(N&&N.chunk&&N.chunk.mediaInfo){var R=W[N.chunk.mediaInfo.type];if(R&&R.state!==P){var w=N.chunk.start;isNaN(R.mostAdvancedSegmentStart)||w>R.mostAdvancedSegmentStart?(R.mostAdvancedSegmentStart=w,R.lastSegmentWasReplacement=!1):R.lastSegmentWasReplacement=!0,R.lastSegmentStart=w,R.lastSegmentDurationS=N.chunk.duration,R.lastQuality=N.chunk.quality,he(R,N.chunk.mediaInfo.type)}}}function _e(N){if(N&&N.metric===d.default.HTTP_REQUEST&&N.value&&N.value.type===c.HTTPRequest.MEDIA_SEGMENT_TYPE&&N.value.trace&&N.value.trace.length){var R=W[N.mediaType];R&&R.state!==P&&(R.lastSegmentRequestTimeMs=N.value.trequest.getTime(),R.lastSegmentFinishTimeMs=N.value._tfinish.getTime(),he(R,N.mediaType))}}function he(N,R){if(!isNaN(N.lastSegmentStart)&&!isNaN(N.lastSegmentRequestTimeMs)&&!isNaN(N.placeholderBuffer)){if(N.placeholderBuffer*=h,!isNaN(N.lastSegmentFinishTimeMs)){var w=y.getCurrentBufferLevel(R),j=w+.001*(N.lastSegmentFinishTimeMs-N.lastSegmentRequestTimeMs),H=ne(N,N.lastQuality),U=Math.max(0,H-j);N.placeholderBuffer=Math.min(U,N.placeholderBuffer)}N.lastSegmentWasReplacement&&!isNaN(N.lastSegmentDurationS)&&(N.placeholderBuffer+=N.lastSegmentDurationS),N.lastSegmentStart=NaN,N.lastSegmentRequestTimeMs=NaN}}function se(N){if(N){var R=W[N.mediaType];R&&R.state!==P&&(R.abrQuality=N.newQuality)}}function Z(N){if(N){var R=W[N.mediaType];if(R&&R.state!==P){var w=y.getCurrentBufferLevel(N.mediaType),j;R.abrQuality>0?j=ae(R,R.abrQuality):j=S;var H=Math.max(0,j-w);R.placeholderBuffer=Math.min(R.placeholderBuffer,H)}}}function q(N){var R=(0,o.default)(D).create();if(!N||!N.hasOwnProperty("getMediaInfo")||!N.hasOwnProperty("getMediaType")||!N.hasOwnProperty("getScheduleController")||!N.hasOwnProperty("getStreamInfo")||!N.hasOwnProperty("getAbrController")||!N.hasOwnProperty("useBufferOccupancyABR"))return R;var w=N.getMediaInfo(),j=N.getMediaType(),H=N.getScheduleController(),U=N.getStreamInfo(),B=N.getAbrController(),G=B.getThroughputHistory(),z=U?U.id:null,fe=U&&U.manifestInfo&&U.manifestInfo.isDynamic,ue=N.useBufferOccupancyABR();if(R.reason=R.reason||{},!ue)return R;H.setTimeToLoadDelay(0);var J=ie(N);if(J.state===P)return R;var ve=y.getCurrentBufferLevel(j),me=G.getAverageThroughput(j,fe),Ae=G.getSafeAverageThroughput(j,fe),be=G.getAverageLatency(j),Be;if(R.reason.state=J.state,R.reason.throughput=me,R.reason.latency=be,isNaN(me))return R;switch(J.state){case O:Be=B.getQualityForBitrate(w,Ae,z,be),R.quality=Be,R.reason.throughput=Ae,J.placeholderBuffer=Math.max(0,ae(J,Be)-ve),J.lastQuality=Be,!isNaN(J.lastSegmentDurationS)&&ve>=J.lastSegmentDurationS&&(J.state=M);break;case M:ce(J,j),Be=ee(J,ve+J.placeholderBuffer);var ke=B.getQualityForBitrate(w,Ae,z,be);Be>J.lastQuality&&Be>ke&&(Be=Math.max(ke,J.lastQuality));var Ye=Math.max(0,ve+J.placeholderBuffer-ne(J,Be));Ye<=J.placeholderBuffer?(J.placeholderBuffer-=Ye,Ye=0):(Ye-=J.placeholderBuffer,J.placeholderBuffer=0,Be<B.getMaxAllowedIndexFor(j,z)?H.setTimeToLoadDelay(1e3*Ye):Ye=0),R.quality=Be,R.reason.throughput=me,R.reason.latency=be,R.reason.bufferLevel=ve,R.reason.placeholderBuffer=J.placeholderBuffer,R.reason.delay=Ye,J.lastQuality=Be;break;default:k.debug("BOLA ABR rule invoked in bad state."),R.quality=B.getQualityForBitrate(w,Ae,z,be),R.reason.state=J.state,R.reason.throughput=Ae,R.reason.latency=be,J.state=O,Y(J)}return R}function le(){W={}}function te(){le(),x.off(T.default.BUFFER_EMPTY,X,F),x.off(T.default.PLAYBACK_SEEKING,oe,F),x.off(T.default.METRIC_ADDED,_e,F),x.off(T.default.QUALITY_CHANGE_REQUESTED,se,F),x.off(T.default.FRAGMENT_LOADING_ABANDONED,Z,F),x.off(m.default.MEDIA_FRAGMENT_LOADED,ge,F)}return F={getMaxIndex:q,reset:te},V(),F}C.__dashjs_factory_name="BolaRule";const v=l.default.getClassFactory(C)},"./src/streaming/rules/abr/DroppedFramesRule.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/rules/SwitchRequest.js"),l=r("./src/core/Debug.js");function c(){var m=this.context,f,T,L=.15,P=375;function O(){T=(0,l.default)(m).getInstance().getLogger(f)}function M(S){var p=(0,o.default)(m).create();if(!S||!S.hasOwnProperty("getDroppedFramesHistory"))return p;var h=S.getDroppedFramesHistory(),C=S.getStreamInfo().id;if(h){var v=h.getFrameHistory(C);if(!v||v.length===0)return p;for(var I=0,D=0,y=o.default.NO_CHANGE,A=1;A<v.length;A++)if(v[A]&&(I=v[A].droppedVideoFrames,D=v[A].totalVideoFrames,D>P&&I/D>L)){y=A-1,T.debug("index: "+y+" Dropped Frames: "+I+" Total Frames: "+D);break}return(0,o.default)(m).create(y,{droppedFrames:I})}return p}return f={getMaxIndex:M},O(),f}c.__dashjs_factory_name="DroppedFramesRule";const E=d.default.getClassFactory(c)},"./src/streaming/rules/abr/InsufficientBufferRule.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>P});var d=r("./src/core/EventBus.js"),o=r("./src/core/events/Events.js"),l=r("./src/core/FactoryMaker.js"),c=r("./src/core/Debug.js"),E=r("./src/streaming/rules/SwitchRequest.js"),m=r("./src/streaming/constants/Constants.js"),f=r("./src/streaming/constants/MetricsConstants.js"),T=r("./src/streaming/MediaPlayerEvents.js");function L(O){O=O||{};var M=.5,S=2,p=this.context,h=(0,d.default)(p).getInstance(),C=O.dashMetrics,v,I,D;function y(){I=(0,c.default)(p).getInstance().getLogger(v),k(),h.on(T.default.PLAYBACK_SEEKING,W,v),h.on(o.default.BYTES_APPENDED_END_FRAGMENT,V,v)}function A(){if(!C||!C.hasOwnProperty("getCurrentBufferLevel")||!C.hasOwnProperty("getCurrentBufferState"))throw new Error(m.default.MISSING_CONFIG_ERROR)}function x($){var K=(0,E.default)(p).create();if(!$||!$.hasOwnProperty("getMediaType"))return K;A();var Y=$.getMediaType(),re=C.getCurrentBufferState(Y),ie=$.getRepresentationInfo(),ee=ie.fragmentDuration,ne=$.getStreamInfo(),ae=ne?ne.id:null,ce=$.getScheduleController(),X=ne&&ne.manifestInfo&&ne.manifestInfo.isDynamic,oe=ce.getPlaybackController(),ge=oe.getLowLatencyModeEnabled();if(F(ge,Y)||!ee)return K;if(re&&re.state===f.default.BUFFER_EMPTY)I.debug("["+Y+"] Switch to index 0; buffer is empty."),K.quality=0,K.reason="InsufficientBufferRule: Buffer is empty";else{var _e=$.getMediaInfo(),he=$.getAbrController(),se=he.getThroughputHistory(),Z=C.getCurrentBufferLevel(Y),q=se.getAverageThroughput(Y,X),le=se.getAverageLatency(Y),te=q*(Z/ee)*M;K.quality=he.getQualityForBitrate(_e,te,ae,le),K.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return K}function F($,K){return!$&&D[K].ignoreCount>0}function k(){D={},D[m.default.VIDEO]={ignoreCount:S},D[m.default.AUDIO]={ignoreCount:S}}function W(){k()}function V($){!isNaN($.startTime)&&($.mediaType===m.default.AUDIO||$.mediaType===m.default.VIDEO)&&D[$.mediaType].ignoreCount>0&&D[$.mediaType].ignoreCount--}function Q(){k(),h.off(T.default.PLAYBACK_SEEKING,W,v),h.off(o.default.BYTES_APPENDED_END_FRAGMENT,V,v)}return v={getMaxIndex:x,reset:Q},y(),v}L.__dashjs_factory_name="InsufficientBufferRule";const P=l.default.getClassFactory(L)},"./src/streaming/rules/abr/L2ARule.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/streaming/constants/MetricsConstants.js"),o=r("./src/streaming/rules/SwitchRequest.js"),l=r("./src/core/FactoryMaker.js"),c=r("./src/streaming/vo/metrics/HTTPRequest.js"),E=r("./src/core/EventBus.js"),m=r("./src/core/events/Events.js"),f=r("./src/core/Debug.js"),T=r("./src/streaming/constants/Constants.js"),L=0,P=1,O=2;function M(p){p=p||{};var h=this.context,C=p.dashMetrics,v=(0,E.default)(h).getInstance(),I,D,y,A;function x(){A=(0,f.default)(h).getInstance().getLogger(I),ae(),v.on(m.default.PLAYBACK_SEEKING,Q,I),v.on(m.default.MEDIA_FRAGMENT_LOADED,$,I),v.on(m.default.METRIC_ADDED,K,I),v.on(m.default.QUALITY_CHANGE_REQUESTED,re,I)}function F(X){var oe={},ge=X.getMediaInfo(),_e=ge.bitrateList.map(function(he){return he.bandwidth/1e3});return oe.state=P,oe.bitrates=_e,oe.lastQuality=0,k(ge),W(oe),oe}function k(X){!X||!X.type||(y[X.type]={},y[X.type].w=[],y[X.type].prev_w=[],y[X.type].Q=0,y[X.type].segment_request_start_s=0,y[X.type].segment_download_finish_s=0,y[X.type].B_target=1.5)}function W(X){X.placeholderBuffer=0,X.mostAdvancedSegmentStart=NaN,X.lastSegmentWasReplacement=!1,X.lastSegmentStart=NaN,X.lastSegmentDurationS=NaN,X.lastSegmentRequestTimeMs=NaN,X.lastSegmentFinishTimeMs=NaN}function V(X){var oe=X.getMediaType(),ge=D[oe];return ge||(ge=F(X),D[oe]=ge),ge}function Q(){for(var X in D)if(D.hasOwnProperty(X)){var oe=D[X];oe.state!==L&&(oe.state=P,W(oe))}}function $(X){if(X&&X.chunk&&X.chunk.mediaInfo){var oe=D[X.chunk.mediaInfo.type],ge=y[X.chunk.mediaInfo.type];if(oe&&oe.state!==L){var _e=X.chunk.start;isNaN(oe.mostAdvancedSegmentStart)||_e>oe.mostAdvancedSegmentStart?(oe.mostAdvancedSegmentStart=_e,oe.lastSegmentWasReplacement=!1):oe.lastSegmentWasReplacement=!0,oe.lastSegmentStart=_e,oe.lastSegmentDurationS=X.chunk.duration,oe.lastQuality=X.chunk.quality,Y(oe,ge)}}}function K(X){if(X&&X.metric===d.default.HTTP_REQUEST&&X.value&&X.value.type===c.HTTPRequest.MEDIA_SEGMENT_TYPE&&X.value.trace&&X.value.trace.length){var oe=D[X.mediaType],ge=y[X.mediaType];oe&&oe.state!==L&&(oe.lastSegmentRequestTimeMs=X.value.trequest.getTime(),oe.lastSegmentFinishTimeMs=X.value._tfinish.getTime(),Y(oe,ge))}}function Y(X,oe){!isNaN(X.lastSegmentStart)&&!isNaN(X.lastSegmentRequestTimeMs)&&(oe.segment_request_start_s=.001*X.lastSegmentRequestTimeMs,oe.segment_download_finish_s=.001*X.lastSegmentFinishTimeMs,X.lastSegmentStart=NaN,X.lastSegmentRequestTimeMs=NaN)}function re(X){if(X&&X.mediaType){var oe=D[X.mediaType];oe&&oe.state!==L&&(oe.abrQuality=X.newQuality)}}function ie(X,oe){if(X.length!==oe.length)return-1;for(var ge=0,_e=0;_e<X.length;_e++)ge=ge+X[_e]*oe[_e];return ge}function ee(X){for(var oe=X.length,ge=!1,_e=[],he=0;he<oe;++he)_e[he]=X[he];for(var se=X.sort(function(R,w){return w-R}),Z=0,q=0,le=[],te=0;te<oe-1;++te)if(Z=Z+se[te],q=(Z-1)/(te+1),q>=se[te+1]){ge=!0;break}ge||(q=(Z+se[oe-1]-1)/oe);for(var N=0;N<oe;++N)le[N]=Math.max(_e[N]-q,0);return le}function ne(X){var oe=(0,o.default)(h).create(),ge=4,_e=Math.pow(ge,.99),he=Math.max(Math.pow(ge,1),_e*Math.sqrt(ge)),se=X.getMediaInfo(),Z=X.getMediaType(),q=se.bitrateList.map(function(We){return We.bandwidth}),le=q.length,te=X.getScheduleController(),N=X.getStreamInfo(),R=X.getAbrController(),w=R.getThroughputHistory(),j=N&&N.manifestInfo&&N.manifestInfo.isDynamic,H=X.useL2AABR(),U=C.getCurrentBufferLevel(Z,!0),B=w.getSafeAverageThroughput(Z,j),G=w.getAverageThroughput(Z,j),z=2,fe=w.getAverageLatency(Z),ue=X.getVideoModel(),J,ve=ue.getPlaybackRate();if(!X||!X.hasOwnProperty("getMediaInfo")||!X.hasOwnProperty("getMediaType")||!X.hasOwnProperty("getScheduleController")||!X.hasOwnProperty("getStreamInfo")||!X.hasOwnProperty("getAbrController")||!X.hasOwnProperty("useL2AABR")||(oe.reason=oe.reason||{},!H||Z===T.default.AUDIO))return oe;te.setTimeToLoadDelay(0);var me=V(X);if(me.state===L)return oe;var Ae=y[Z];if(!Ae||(oe.reason.state=me.state,oe.reason.throughput=G,oe.reason.latency=fe,isNaN(G)))return oe;switch(me.state){case P:if(J=R.getQualityForBitrate(se,B,N.id,fe),oe.quality=J,oe.reason.throughput=B,me.lastQuality=J,!isNaN(me.lastSegmentDurationS)&&U>=Ae.B_target){me.state=O,Ae.Q=_e;for(var be=0;be<le;++be)be===me.lastQuality?Ae.prev_w[be]=1:Ae.prev_w[be]=0}break;case O:var Be=[],ke=C.getCurrentHttpRequest(Z).trace.reduce(function(We,Ge){return We+Ge.d},0),Ye=C.getCurrentHttpRequest(Z).trace.reduce(function(We,Ge){return We+Ge.b[0]},0),Oe=Math.round(8*Ye/ke);Oe<1&&(Oe=1);for(var Se=me.lastSegmentDurationS,Me=1,qe=0;qe<le;++qe)q[qe]=q[qe]/1e3,ve*q[qe]>Oe&&(Me=-1),Ae.w[qe]=Ae.prev_w[qe]+Me*(Se/(2*he))*((Ae.Q+_e)*(ve*q[qe]/Oe));Ae.w=ee(Ae.w);for(var it=0;it<le;++it)Be[it]=Ae.w[it]-Ae.prev_w[it],Ae.prev_w[it]=Ae.w[it];Ae.Q=Math.max(0,Ae.Q-Se+Se*ve*((ie(q,Ae.prev_w)+ie(q,Be))/Oe));for(var at=[],Ce=0;Ce<le;++Ce)at[Ce]=Math.abs(q[Ce]-ie(Ae.w,q));J=at.indexOf(Math.min.apply(Math,at)),J>me.lastQuality&&q[me.lastQuality+1]<=Oe&&(J=me.lastQuality+1),q[J]>=Oe&&(Ae.Q=z*Math.max(_e,Ae.Q)),oe.quality=J,oe.reason.throughput=G,oe.reason.latency=fe,oe.reason.bufferLevel=U,me.lastQuality=oe.quality;break;default:A.debug("L2A ABR rule invoked in bad state."),oe.quality=R.getQualityForBitrate(se,B,N.id,fe),oe.reason.state=me.state,oe.reason.throughput=B,oe.reason.latency=fe,me.state=P,W(me)}return oe}function ae(){D={},y={}}function ce(){ae(),v.off(m.default.PLAYBACK_SEEKING,Q,I),v.off(m.default.MEDIA_FRAGMENT_LOADED,$,I),v.off(m.default.METRIC_ADDED,K,I),v.off(m.default.QUALITY_CHANGE_REQUESTED,re,I)}return I={getMaxIndex:ne,reset:ce},x(),I}M.__dashjs_factory_name="L2ARule";const S=l.default.getClassFactory(M)},"./src/streaming/rules/abr/SwitchHistoryRule.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js"),l=r("./src/streaming/rules/SwitchRequest.js");function c(){var m=this.context,f,T,L=.075,P=6;function O(){T=(0,o.default)(m).getInstance().getLogger(f)}function M(S){for(var p=S?S.getSwitchHistory():null,h=p?p.getSwitchRequests():[],C=0,v=0,I=0,D=(0,l.default)(m).create(),y=0;y<h.length;y++)if(h[y]!==void 0&&(C+=h[y].drops,v+=h[y].noDrops,I+=h[y].dropSize,C+v>=P&&C/v>L)){D.quality=y>0&&h[y].drops>0?y-1:y,D.reason={index:D.quality,drops:C,noDrops:v,dropSize:I},T.debug("Switch history rule index: "+D.quality+" samples: "+(C+v)+" drops: "+C);break}return D}return f={getMaxIndex:M},O(),f}c.__dashjs_factory_name="SwitchHistoryRule";const E=d.default.getClassFactory(c)},"./src/streaming/rules/abr/ThroughputRule.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/rules/SwitchRequest.js"),l=r("./src/streaming/constants/Constants.js"),c=r("./src/streaming/constants/MetricsConstants.js");function E(f){f=f||{};var T=this.context,L=f.dashMetrics,P;function O(){if(!L||!L.hasOwnProperty("getCurrentBufferState"))throw new Error(l.default.MISSING_CONFIG_ERROR)}function M(p){var h=(0,o.default)(T).create();if(!p||!p.hasOwnProperty("getMediaInfo")||!p.hasOwnProperty("getMediaType")||!p.hasOwnProperty("useBufferOccupancyABR")||!p.hasOwnProperty("getAbrController")||!p.hasOwnProperty("getScheduleController"))return h;O();var C=p.getMediaInfo(),v=p.getMediaType(),I=L.getCurrentBufferState(v),D=p.getScheduleController(),y=p.getAbrController(),A=p.getStreamInfo(),x=A?A.id:null,F=A&&A.manifestInfo?A.manifestInfo.isDynamic:null,k=y.getThroughputHistory(),W=k.getSafeAverageThroughput(v,F),V=k.getAverageLatency(v),Q=p.useBufferOccupancyABR();return isNaN(W)||!I||Q||y.getAbandonmentStateFor(x,v)!==c.default.ABANDON_LOAD&&(I.state===c.default.BUFFER_LOADED||F)&&(h.quality=y.getQualityForBitrate(C,W,x,V),D.setTimeToLoadDelay(0),h.reason={throughput:W,latency:V}),h}function S(){}return P={getMaxIndex:M,reset:S},P}E.__dashjs_factory_name="ThroughputRule";const m=d.default.getClassFactory(E)},"./src/streaming/rules/abr/lolp/LearningAbrController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js"),l={MANUAL:"manual_weight_selection",RANDOM:"random_weight_selection",DYNAMIC:"dynamic_weight_selection"};function c(){var m=this.context,f,T,L,P,O,M,S,p,h;function C(){T=(0,o.default)(m).getInstance().getLogger(f),I()}function v(){I()}function I(){L=null,P=1,O=100,M=0,S=null,p=null,h=l.DYNAMIC}function D(){var ne=0;if(L)for(var ae=0;ae<L.length;ae++){var ce=L[ae];ce.state.throughput>ne&&(ne=ce.state.throughput)}return ne}function y(ne){var ae=ne.map(function(ce){return Math.pow(ce,2)}).reduce(function(ce,X){return ce+X});return Math.sqrt(ae)}function A(ne,ae,ce){var X=ne.map(function(ge,_e){return ce[_e]*Math.pow(ge-ae[_e],2)}).reduce(function(ge,_e){return ge+_e}),oe=X<0?-1:1;return oe*Math.sqrt(Math.abs(X))}function x(ne,ae){var ce=[ne.state.throughput,ne.state.latency,ne.state.rebuffer,ne.state.switch],X=[ae.state.throughput,ae.state.latency,ae.state.rebuffer,ae.state.switch];return A(ce,X,[1,1,1,1])}function F(ne,ae,ce){for(var X=0;X<ae.length;X++){var oe=ae[X],ge=.1,_e=x(oe,ne),he=Math.exp(-1*Math.pow(_e,2)/(2*Math.pow(ge,2)));k(oe,ce,he)}}function k(ne,ae,ce){var X=ne.state,oe=[.01,.01,.01,.01];X.throughput=X.throughput+(ae[0]-X.throughput)*oe[0]*ce,X.latency=X.latency+(ae[1]-X.latency)*oe[1]*ce,X.rebuffer=X.rebuffer+(ae[2]-X.rebuffer)*oe[2]*ce,X.switch=X.switch+(ae[3]-X.switch)*oe[3]*ce}function W(ne,ae){var ce=0,X=ne;if(L)for(var oe=0;oe<L.length;oe++){var ge=L[oe];ge.bitrate<ne.bitrate&&ge.bitrate>ce&&ae>ge.bitrate&&(ce=ge.bitrate,X=ge)}return X}function V(ne,ae,ce,X,oe,ge,_e){var he=ce,se=X,Z=ae,q=re(ne),le=ae/P;le>1&&(le=D()),ce=ce/O;var te=0,N=0,R=0,w=1e4;T.debug("getNextQuality called throughput:".concat(le," latency:").concat(ce," bufferSize:").concat(X," currentQualityIndex:").concat(ge," playbackRate:").concat(oe));var j=q[ge],H=j.bitrate*_e.getSegmentDuration()/Z,U=Math.max(0,H-se);if(se-H<_e.getMinBuffer())return T.debug("Buffer is low for bitrate= ".concat(j.bitrate," downloadTime=").concat(H," currentBuffer=").concat(se," rebuffer=").concat(U)),W(j,Z).qualityIndex;switch(h){case l.MANUAL:Q();break;case l.RANDOM:$(q);break;case l.DYNAMIC:K(_e,q,he,se,U,Z,oe);break;default:K(_e,q,he,se,U,Z,oe)}for(var B=null,G=null,z=null,fe=0;fe<q.length;fe++){var ue=q[fe],J=ue.state,ve=[J.throughput,J.latency,J.rebuffer,J.switch],me=S.slice(),Ae=_e.getNextBufferWithBitrate(ue.bitrate,se,Z),be=Ae<_e.getMinBuffer();be&&T.debug("Buffer is low for bitrate=".concat(ue.bitrate," downloadTime=").concat(H," currentBuffer=").concat(se," nextBuffer=").concat(Ae)),(ue.bitrate>ae-w||be)&&ue.bitrate!==M&&(me[0]=100);var Be=A(ve,[le,te,N,R],me);(B===null||Be<B)&&(B=Be,G=ue.qualityIndex,z=ue)}var ke=Math.abs(j.bitrate-z.bitrate)/P;return F(j,q,[le,ce,U,ke]),F(z,q,[le,te,N,ke]),G}function Q(){var ne=.4,ae=.4,ce=.4,X=.4;S=[ne,ae,ce,X]}function $(ne){S=Y(ne.length,4)}function K(ne,ae,ce,X,oe,ge,_e){S||(S=p[p.length-1]);var he=ne.findWeightVector(ae,ce,X,oe,ge,_e);he!==null&&he!==-1&&(S=he)}function Y(ne,ae){for(var ce=[],X=Math.sqrt(2/ne),oe=0;oe<ae;oe++)ce.push(Math.random()*X);return S=ce,S}function re(ne){if(!L){L=[];var ae=ne.bitrateList,ce=[];M=ae[0].bandwidth,ae.forEach(function(ge){ce.push(ge.bandwidth),ge.bandwidth<M&&(M=ge.bandwidth)}),P=y(ce);for(var X=0;X<ae.length;X++){var oe={qualityIndex:X,bitrate:ae[X].bandwidth,state:{throughput:ae[X].bandwidth/P,latency:0,rebuffer:0,switch:0}};L.push(oe)}p=ee(L)}return L}function ie(ne){for(var ae=[],ce=0;ce<ne;ce++){var X=[Math.random()*D(),Math.random(),Math.random(),Math.random()];ae.push(X)}return ae}function ee(ne){var ae=[],ce=ie(Math.pow(ne.length,2));ae.push(ce[0]);for(var X=[1,1,1,1],oe=1;oe<ne.length;oe++){for(var ge=null,_e=null,he=0;he<ce.length;he++){for(var se=ce[he],Z=null,q=0;q<ae.length;q++){var le=A(se,ae[q],X);(Z===null||le<Z)&&(Z=le)}(_e===null||Z>_e)&&(ge=se,_e=Z)}ae.push(ge)}for(var te=null,N=null,R=0;R<ae.length;R++){for(var w=0,j=0;j<ae.length;j++)R!==j&&(w+=A(ae[R],ae[j],X));(te===null||w>te)&&(te=w,N=R)}var H=[];for(H.push(ae[N]),ae.splice(N,1);ae.length>0;){for(var U=null,B=null,G=0;G<ae.length;G++){var z=A(H[0],ae[G],X);(U===null||z<U)&&(U=z,B=G)}H.push(ae[B]),ae.splice(B,1)}return H}return f={getNextQuality:V,reset:v},C(),f}c.__dashjs_factory_name="LearningAbrController";const E=d.default.getClassFactory(c)},"./src/streaming/rules/abr/lolp/LoLpQoEEvaluator.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/rules/abr/lolp/QoeInfo.js");function l(){var E,m,f,T,L;function P(){O()}function O(){m=null,f=null,T=null,L=null}function M(D,y,A){m=S("segment",D,y,A),f=D,T=y,L=A}function S(D,y,A,x){var F=new o.default;return F.type=D,y?F.weights.bitrateReward=y:F.weights.bitrateReward=1,F.weights.bitrateSwitchPenalty=1,A?F.weights.rebufferPenalty=A:F.weights.rebufferPenalty=1e3,F.weights.latencyPenalty=[],F.weights.latencyPenalty.push({threshold:1.1,penalty:x*.05}),F.weights.latencyPenalty.push({threshold:1e8,penalty:A*.1}),x?F.weights.playbackSpeedPenalty=x:F.weights.playbackSpeedPenalty=200,F}function p(D,y,A,x){m&&h(D,y,A,x,m)}function h(D,y,A,x,F){F.bitrateWSum+=F.weights.bitrateReward*D,F.lastBitrate&&(F.bitrateSwitchWSum+=F.weights.bitrateSwitchPenalty*Math.abs(D-F.lastBitrate)),F.lastBitrate=D,F.rebufferWSum+=F.weights.rebufferPenalty*y;for(var k=0;k<F.weights.latencyPenalty.length;k++){var W=F.weights.latencyPenalty[k];if(A<=W.threshold){F.latencyWSum+=W.penalty*A;break}}F.playbackSpeedWSum+=F.weights.playbackSpeedPenalty*Math.abs(1-x),F.totalQoe=F.bitrateWSum-F.bitrateSwitchWSum-F.rebufferWSum-F.latencyWSum-F.playbackSpeedWSum}function C(){return m}function v(D,y,A,x){var F=null;return f&&T&&L&&(F=S("segment",f,T,L)),F?(h(D,y,A,x,F),F.totalQoe):0}function I(){O()}return E={setupPerSegmentQoe:M,logSegmentMetrics:p,getPerSegmentQoe:C,calculateSingleUseQoe:v,reset:I},P(),E}l.__dashjs_factory_name="LoLpQoeEvaluator";const c=d.default.getClassFactory(l)},"./src/streaming/rules/abr/lolp/LoLpRule.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>M});var d=r("./src/core/Debug.js"),o=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/rules/abr/lolp/LearningAbrController.js"),c=r("./src/streaming/rules/abr/lolp/LoLpQoEEvaluator.js"),E=r("./src/streaming/rules/SwitchRequest.js"),m=r("./src/streaming/constants/MetricsConstants.js"),f=r("./src/streaming/rules/abr/lolp/LoLpWeightSelector.js"),T=r("./src/streaming/constants/Constants.js"),L=1.5,P=.3;function O(S){S=S||{};var p=S.dashMetrics,h=this.context,C,v,I,D;function y(){C=(0,d.default)(h).getInstance().getLogger(v),I=(0,l.default)(h).create(),D=(0,c.default)(h).create()}function A(k){try{var W=(0,E.default)(h).create(),V=k.getMediaInfo().type,Q=k.getAbrController(),$=k.getStreamInfo(),K=Q.getQualityFor(V,$.id),Y=k.getMediaInfo(),re=p.getCurrentBufferState(V),ie=k.getScheduleController(),ee=p.getCurrentBufferLevel(V,!0),ne=$&&$.manifestInfo?$.manifestInfo.isDynamic:null,ae=ie.getPlaybackController(),ce=ae.getCurrentLiveLatency();if(!k.useLoLPABR()||V===T.default.AUDIO)return W;ce||(ce=0);var X=ae.getPlaybackRate(),oe=Q.getThroughputHistory(),ge=oe.getSafeAverageThroughput(V,ne);if(C.debug("Throughput ".concat(Math.round(ge)," kbps")),isNaN(ge)||!re||Q.getAbandonmentStateFor($.id,V)===m.default.ABANDON_LOAD)return W;for(var _e=Y.bitrateList,he=k.getRepresentationInfo().fragmentDuration,se=_e[0].bandwidth/1e3,Z=_e[_e.length-1].bandwidth/1e3,q=0;q<_e.length;q++){var le=_e[q].bandwidth/1e3;le>Z?Z=le:le<se&&(se=le)}var te=_e[K].bandwidth,N=te/1e3,R=p.getCurrentHttpRequest(V,!0),w=(R.tresponse.getTime()-R.trequest.getTime())/1e3,j=w>he?w-he:0;D.setupPerSegmentQoe(he,Z,se),D.logSegmentMetrics(N,j,ce,X);var H=(0,f.default)(h).create({targetLatency:L,bufferMin:P,segmentDuration:he,qoeEvaluator:D});return W.quality=I.getNextQuality(Y,ge*1e3,ce,ee,X,K,H),W.reason={throughput:ge,latency:ce},W.priority=E.default.PRIORITY.STRONG,ie.setTimeToLoadDelay(0),W.quality!==K&&console.log("[TgcLearningRule]["+V+"] requesting switch to index: ",W.quality,"Average throughput",Math.round(ge),"kbps"),W}catch(U){throw U}}function x(){I.reset(),D.reset()}function F(){x()}return v={getMaxIndex:A,reset:F},y(),v}O.__dashjs_factory_name="LoLPRule";const M=o.default.getClassFactory(O)},"./src/streaming/rules/abr/lolp/LoLpWeightSelector.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/core/FactoryMaker.js");function o(c){var E=c.targetLatency,m=c.bufferMin,f=c.segmentDuration,T=c.qoeEvaluator,L,P,O,M,S;function p(){h()}function h(){P=[.2,.4,.6,.8,1],O=4,M=I(P,O),S=0}function C(F,k,W,V,Q,$){var K=null,Y=null,re=null,ie=Math.abs(k-S);return F.forEach(function(ee){M.forEach(function(ne){var ae={throughput:ne[0],latency:ne[1],buffer:ne[2],switch:ne[3]},ce=ee.bitrate*f/Q,X=x(W,ce),oe=Math.max(1e-5,ce-X),ge;ae.buffer===0?ge=10:ge=1/ae.buffer;var _e=ge*oe;ae.latency===0?ge=10:ge=1/ae.latency;var he=ge*ee.state.latency,se=T.calculateSingleUseQoe(ee.bitrate,_e,he,$);(K===null||se>K)&&v(k,X,ie)&&(K=se,Y=ne,re=ee.bitrate)})}),Y===null&&re===null&&(Y=-1),S=k,Y}function v(F,k,W){return F>E+W?!1:k>=m}function I(F,k){var W=F.map(function(Q){return[Q]}),V=function Q($,K,Y){if(Y===K)return $;for(var re=$.length,ie=0;ie<re;ie++)for(var ee=$.shift(),ne=0;ne<F.length;ne++)$.push(ee.concat(F[ne]));return Q($,K,Y+1)};return V(W,k,1)}function D(){return m}function y(){return f}function A(F,k,W){var V=F*f/W;return x(k,V)}function x(F,k){var W=y(),V;return k>W?V=F-W:V=F+W-k,V}return L={getMinBuffer:D,getSegmentDuration:y,getNextBufferWithBitrate:A,getNextBuffer:x,findWeightVector:C},p(),L}o.__dashjs_factory_name="LoLpWeightSelector";const l=d.default.getClassFactory(o)},"./src/streaming/rules/abr/lolp/QoeInfo.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0};const l=o},"./src/streaming/text/EmbeddedTextHtmlRender.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/core/FactoryMaker.js");function o(){var c=0,E;function m(S){for(var p="",h=0;h<S.length;++h){var C=S[h];p+=C.uchar}var v=p.length,I=p.replace(/^\s+/,"").length;return v-I}function f(S){return"left: "+S.x*3.125+"%; top: "+S.y1*6.66+"%; width: "+(100-S.x*3.125)+"%; height: "+Math.max(S.y2-1-S.y1,1)*6.66+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function T(S){return S==="red"?"rgb(255, 0, 0)":S==="green"?"rgb(0, 255, 0)":S==="blue"?"rgb(0, 0, 255)":S==="cyan"?"rgb(0, 255, 255)":S==="magenta"?"rgb(255, 0, 255)":S==="yellow"?"rgb(255, 255, 0)":S==="white"?"rgb(255, 255, 255)":S==="black"?"rgb(0, 0, 0)":S}function L(S,p){var h=S.videoHeight/15;return p?"font-size: "+h+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(p.foreground?T(p.foreground):"rgb(255, 255, 255)")+"; font-style: "+(p.italics?"italic":"normal")+"; text-decoration: "+(p.underline?"underline":"none")+"; white-space: pre; background-color: "+(p.background?T(p.background):"transparent")+";":"font-size: "+h+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function P(S){return S.replace(/^\s+/g,"")}function O(S){return S.replace(/\s+$/g,"")}function M(S,p,h,C){var v=null,I=null,D=!1,y=-1,A={start:p,end:h,spans:[]},x="style_cea608_white_black",F={},k={},W=[],V,Q;for(V=0;V<15;++V){var $=C.rows[V],K="",Y=null;if($.isEmpty()===!1){var re=m($.chars);v===null&&(v={x:re,y1:V,y2:V+1,p:[]}),re!==y&&D&&(v.p.push(A),A={start:p,end:h,spans:[]},v.y2=V,v.name="region_"+v.x+"_"+v.y1+"_"+v.y2,F.hasOwnProperty(v.name)===!1?(W.push(v),F[v.name]=v):(I=F[v.name],I.p.contat(v.p)),v={x:re,y1:V,y2:V+1,p:[]});for(var ie=0;ie<$.chars.length;++ie){var ee=$.chars[ie],ne=ee.penState;if(Y===null||!ne.equals(Y)){K.trim().length>0&&(A.spans.push({name:x,line:K,row:V}),K="");var ae="style_cea608_"+ne.foreground+"_"+ne.background;ne.underline&&(ae+="_underline"),ne.italics&&(ae+="_italics"),k.hasOwnProperty(ae)||(k[ae]=JSON.parse(JSON.stringify(ne))),Y=ne,x=ae}K+=ee.uchar}K.trim().length>0&&A.spans.push({name:x,line:K,row:V}),D=!0,y=re}else D=!1,y=-1,v&&(v.p.push(A),A={start:p,end:h,spans:[]},v.y2=V,v.name="region_"+v.x+"_"+v.y1+"_"+v.y2,F.hasOwnProperty(v.name)===!1?(W.push(v),F[v.name]=v):(I=F[v.name],I.p.contat(v.p)),v=null)}v&&(v.p.push(A),v.y2=V+1,v.name="region_"+v.x+"_"+v.y1+"_"+v.y2,F.hasOwnProperty(v.name)===!1?(W.push(v),F[v.name]=v):(I=F[v.name],I.p.contat(v.p)),v=null);var ce=[];for(V=0;V<W.length;++V){var X=W[V],oe="sub_cea608_"+c++,ge=document.createElement("div");ge.id=oe;var _e=f(X);ge.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+_e;var he=document.createElement("div");he.className="paragraph bodyStyle",he.style.cssText=L(S);var se=document.createElement("div");se.className="cueUniWrapper",se.style.cssText="unicode-bidi: normal; direction: ltr;";for(var Z=0;Z<X.p.length;++Z){var q=X.p[Z],le=0;for(Q=0;Q<q.spans.length;++Q){var te=q.spans[Q];if(te.line.length>0){if(Q!==0&&le!=te.row){var N=document.createElement("br");N.className="lineBreak",se.appendChild(N)}var R=!1;le===te.row&&(R=!0),le=te.row;var w=k[te.name],j=document.createElement("span");j.className="spanPadding "+te.name+" customSpanColor",j.style.cssText=L(S,w),Q!==0&&R?Q===q.spans.length-1?j.textContent=O(te.line):j.textContent=te.line:q.spans.length>1&&Q<q.spans.length-1&&te.row===q.spans[Q+1].row?j.textContent=P(te.line):j.textContent=te.line.trim(),se.appendChild(j)}}}he.appendChild(se),ge.appendChild(he);var H={bodyStyle:["%",90]};for(var U in k)k.hasOwnProperty(U)&&(H[U]=["%",90]);ce.push({type:"html",start:p,end:h,cueHTMLElement:ge,cueID:oe,cellResolution:[32,15],isFromCEA608:!0,fontSize:H,lineHeight:{},linePadding:{}})}return ce}return E={createHTMLCaptionsFromScreen:M},E}o.__dashjs_factory_name="EmbeddedTextHtmlRender";const l=d.default.getSingletonFactory(o)},"./src/streaming/text/NotFragmentedTextBufferController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>P});var d=r("./src/core/EventBus.js"),o=r("./src/core/events/Events.js"),l=r("./src/core/FactoryMaker.js"),c=r("./src/streaming/utils/InitCache.js"),E=r("./src/streaming/SourceBufferSink.js"),m=r("./src/streaming/vo/DashJSError.js"),f=r("./src/core/errors/Errors.js"),T="NotFragmentedTextBufferController";function L(O){O=O||{};var M=this.context,S=(0,d.default)(M).getInstance(),p=O.textController,h=O.errHandler,C=O.streamInfo,v=O.type,I,D,y,A,x,F;function k(){y=!1,A=null,D=!1,F=(0,c.default)(M).getInstance(),S.on(o.default.INIT_FRAGMENT_LOADED,_e,I)}function W(){return T}function V(z){re(z)}function Q(z){return new Promise(function(fe,ue){try{x=(0,E.default)(M).create({mediaSource:A,textController:p,eventBus:S}),x.initializeForFirstUse(C,z),y||(x.getBuffer()&&typeof x.getBuffer().initialize=="function"&&x.getBuffer().initialize(),y=!0),fe(x)}catch(J){h.error(new m.default(f.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,f.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+v)),ue(J)}})}function $(){return C.id}function K(){return v}function Y(){return x}function re(z){A=z}function ie(){return A}function ee(){return!1}function ne(){}function ae(){return 0}function ce(){return D}function X(z){D!==z&&(D=z,D&&G(o.default.BUFFERING_COMPLETED))}function oe(z){S.off(o.default.INIT_FRAGMENT_LOADED,_e,I),!z&&x&&(x.abort(),x.reset(),x=null)}function ge(z){return F.extract(C.id,z)!==null}function _e(z){!z.chunk.bytes||D||(F.save(z.chunk),x.append(z.chunk),X(!0))}function he(){return null}function se(){return!0}function Z(){return[]}function q(){return Number.POSITIVE_INFINITY}function le(){return Promise.resolve()}function te(){}function N(){return Promise.resolve()}function R(){return Promise.resolve()}function w(){return D=!1,Promise.resolve()}function j(){return Promise.resolve()}function H(){}function U(){}function B(){return Promise.resolve()}function G(z,fe){var ue=fe||{};S.trigger(z,ue,{streamId:C.id,mediaType:v})}return I={initialize:V,getStreamId:$,getType:K,getBufferControllerType:W,createBufferSink:Q,dischargePreBuffer:ne,getBuffer:Y,getBufferLevel:ae,getRangeAt:he,pruneBuffer:te,hasBufferAtTime:se,getAllRangesWithSafetyFactor:Z,getContinuousBufferTimeForTargetTime:q,setMediaSource:re,getMediaSource:ie,appendInitSegmentFromCache:ge,getIsBufferingCompleted:ce,setIsBufferingCompleted:X,getIsPruningInProgress:ee,reset:oe,clearBuffers:le,prepareForPlaybackSeek:R,prepareForReplacementTrackSwitch:w,setSeekTarget:H,updateAppendWindow:j,pruneAllSafely:B,updateBufferTimestampOffset:N,segmentRequestingCompleted:U},k(),I}L.__dashjs_factory_name=T;const P=l.default.getClassFactory(L)},"./src/streaming/text/TextController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/core/FactoryMaker.js"),l=r("./src/streaming/text/TextSourceBuffer.js"),c=r("./src/streaming/text/TextTracks.js"),E=r("./src/streaming/utils/VTTParser.js"),m=r("./src/streaming/utils/VttCustomRenderingParser.js"),f=r("./src/streaming/utils/TTMLParser.js"),T=r("./src/core/EventBus.js"),L=r("./src/core/events/Events.js"),P=r("./src/streaming/MediaPlayerEvents.js"),O=r("./src/streaming/utils/SupervisorTools.js");function M(p){var h=this.context,C=p.adapter,v=p.errHandler,I=p.manifestModel,D=p.mediaController,y=p.videoModel,A=p.settings,x,F,k,W,V,Q,$,K,Y,re,ie,ee;function ne(){re=!1,ie=!1,ee=!1,V=(0,E.default)(h).getInstance(),Q=(0,m.default)(h).getInstance(),$=(0,f.default)(h).getInstance(),K=(0,T.default)(h).getInstance(),B()}function ae(){K.on(L.default.TEXT_TRACKS_QUEUE_INITIALIZED,se,x),A.get().streaming.text.webvtt.customRenderingEnabled&&(K.on(L.default.PLAYBACK_TIME_UPDATED,Z,x),K.on(L.default.PLAYBACK_SEEKING,q,x))}function ce(z){var fe=z.id,ue=(0,c.default)(h).create({videoModel:y,settings:A,streamInfo:z});ue.initialize(),W[fe]=ue;var J=(0,l.default)(h).create({errHandler:v,adapter:C,manifestModel:I,mediaController:D,videoModel:y,textTracks:ue,vttParser:V,vttCustomRenderingParser:Q,ttmlParser:$,streamInfo:z,settings:A});J.initialize(),k[fe]=J,F[fe]={},F[fe].lastEnabledIndex=-1}function X(z){var fe=z.id;W[fe]&&W[fe].createTracks()}function oe(z,fe,ue){var J=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,ve=z.id;k[ve]&&k[ve].addMediaInfos(fe,ue,J)}function ge(z){var fe=z.id;if(k&&k[fe])return k[fe]}function _e(){return Y}function he(z,fe){var ue=z.id;k[ue]&&k[ue].addEmbeddedTrack(fe)}function se(z){var fe=z.tracks,ue=z.index,J=z.streamId,ve=A.get().streaming.text.defaultEnabled;if(ve===!1&&!te()||ee)R(J,-1);else{var me=D.getCurrentTrackFor(d.default.TEXT,J);if(me){var Ae={lang:me.lang,role:me.roles[0],index:me.index,codec:me.codec,accessibility:me.accessibility[0]};fe.some(function(be,Be){if(D.matchSettings(Ae,be))return R(J,Be),ue=Be,!0})}Y=!1}F[J].lastEnabledIndex=ue,K.trigger(P.default.TEXT_TRACKS_ADDED,{enabled:te(),index:ue,tracks:fe,streamId:J}),ie=!0}function Z(z){try{var fe=z.streamId;if(!W[fe]||isNaN(z.time))return;W[fe].manualCueProcessing(z.time)}catch{}}function q(z){try{var fe=z.streamId;if(!W[fe])return;W[fe].disableManualTracks()}catch{}}function le(z,fe){(0,O.checkParameterType)(fe,"boolean"),te()!==fe&&(fe&&R(z,F[z].lastEnabledIndex),fe||(F[z].lastEnabledIndex=H(z),ie?R(z,-1):ee=!0))}function te(){var z=!0;return Y&&!re&&(z=!1),z}function N(z){(0,O.checkParameterType)(z,"boolean"),re=z}function R(z,fe){Y=fe===-1,Y&&D&&D.saveTextSettingsDisabled();var ue=H(z);if(!(ue===fe||!W[z])){W[z].disableManualTracks(),W[z].setModeForTrackIdx(ue,d.default.TEXT_HIDDEN),W[z].setCurrentTrackIdx(fe),W[z].setModeForTrackIdx(fe,d.default.TEXT_SHOWING);var J=W[z].getCurrentTrackInfo();J&&J.isFragmented&&!J.isEmbedded?w(z,J,ue):J&&!J.isFragmented&&j(z,J),D.setTrack(J)}}function w(z,fe,ue){if(k[z])for(var J=k[z].getConfig(),ve=J.fragmentedTracks,me=0;me<ve.length;me++){var Ae=ve[me];if(fe.lang===Ae.lang&&(Ae.id?fe.id===Ae.id:fe.index===Ae.index)){var be=D.getCurrentTrackFor(d.default.TEXT,z);(Ae.id?be.id!==Ae.id:be.index!==Ae.index)?(W[z].deleteCuesFromTrackIdx(ue),k[z].setCurrentFragmentedTrackIdx(me)):ue===-1&&K.trigger(L.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,{},{streamId:z,mediaType:d.default.TEXT})}}}function j(z,fe){K.trigger(L.default.SET_NON_FRAGMENTED_TEXT,{currentTrackInfo:fe},{streamId:z,mediaType:d.default.TEXT})}function H(z){return W[z].getCurrentTrackIdx()}function U(z){if(z){var fe=z.id;k[fe]&&k[fe].resetMediaInfos(),W[fe]&&W[fe].deleteAllTextTracks()}}function B(){k={},W={},F={},Y=!0,ie=!1,ee=!1}function G(){B(),K.off(L.default.TEXT_TRACKS_QUEUE_INITIALIZED,se,x),A.get().streaming.text.webvtt.customRenderingEnabled&&(K.off(L.default.PLAYBACK_TIME_UPDATED,Z,x),K.off(L.default.PLAYBACK_SEEKING,q,x)),Object.keys(k).forEach(function(z){k[z].resetEmbedded(),k[z].reset()})}return x={deactivateStream:U,initialize:ae,initializeForStream:ce,createTracks:X,getTextSourceBuffer:ge,getAllTracksAreDisabled:_e,addEmbeddedTrack:he,enableText:le,isTextEnabled:te,setTextTrack:R,getCurrentTrackIdx:H,enableForcedTextStreaming:N,addMediaInfosToBuffer:oe,reset:G},ne(),x}M.__dashjs_factory_name="TextController";const S=o.default.getClassFactory(M)},"./src/streaming/text/TextSourceBuffer.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>v});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/streaming/vo/metrics/HTTPRequest.js"),l=r("./src/streaming/vo/TextTrackInfo.js"),c=r("./src/streaming/utils/BoxParser.js"),E=r("./src/streaming/utils/CustomTimeRanges.js"),m=r("./src/core/FactoryMaker.js"),f=r("./src/core/Debug.js"),T=r("./src/streaming/text/EmbeddedTextHtmlRender.js"),L=r("./node_modules/codem-isoboxer/dist/iso_boxer.js"),P=r("./externals/cea608-parser.js"),O=r.n(P),M=r("./src/core/EventBus.js"),S=r("./src/core/events/Events.js"),p=r("./src/streaming/vo/DashJSError.js"),h=r("./src/core/errors/Errors.js");function C(I){var D=I.errHandler,y=I.manifestModel,A=I.mediaController,x=I.videoModel,F=I.textTracks,k=I.vttParser,W=I.vttCustomRenderingParser,V=I.ttmlParser,Q=I.streamInfo,$=I.settings,K=this.context,Y=(0,M.default)(K).getInstance(),re=!1,ie,ee,ne,ae,ce,X,oe,ge,_e,he,se,Z,q,le,te,N;function R(){ee=(0,f.default)(K).getInstance().getLogger(ie),ne=(0,c.default)(K).getInstance(),H()}function w(){return Q.id}function j(){X=null,ge=NaN,_e=[],he=null,oe=!1}function H(){j(),ce=[],ae=null}function U(){re||J()}function B($e,Te,de){if(ce=ce.concat(Te),$e===d.default.TEXT&&Te[0].isFragmented&&!Te[0].isEmbedded){X=de,ie.buffered=(0,E.default)(K).create(),_e=A.getTracksFor(d.default.TEXT,Q.id).filter(function(Xe){return Xe.isFragmented});for(var Re=A.getCurrentTrackFor(d.default.TEXT,Q.id),xe=0;xe<_e.length;xe++)if(_e[xe]===Re){be(xe);break}}for(var Ne=0;Ne<Te.length;Ne++)G(Te[Ne])}function G($e){var Te=new l.default,de={subtitle:"subtitles",caption:"captions"};for(var Re in $e)Te[Re]=$e[Re];Te.labels=$e.labels,Te.defaultTrack=tt($e),Te.isFragmented=$e.isFragmented,Te.isEmbedded=!!$e.isEmbedded,Te.isTTML=Be($e),Te.kind=ke($e,de),F.addTextTrack(Te)}function z(){}function fe(){H(),ce=[],ne=null}function ue($e){var Te=$e.chunk;Te.mediaInfo.embeddedCaptions&&Ye(Te.bytes,Te)}function J(){Z=[],se=null,q=0,te=[],le=null,re=!0,N=(0,T.default)(K).getInstance(),Y.on(S.default.VIDEO_CHUNK_RECEIVED,ue,ie),Y.on(S.default.BUFFER_CLEARED,ht,ie)}function ve(){Y.off(S.default.VIDEO_CHUNK_RECEIVED,ue,ie),Y.off(S.default.BUFFER_CLEARED,ht,ie),F&&F.deleteAllTextTracks(),re=!1,Z=[],te=[null,null],le=null}function me($e){if(re&&$e)if($e.id===d.default.CC1||$e.id===d.default.CC3){for(var Te=0;Te<Z.length;Te++)if(Z[Te].id===$e.id)return;Z.push($e)}else ee.warn("Embedded track "+$e.id+" not supported!")}function Ae(){var $e={fragmentModel:X,fragmentedTracks:_e,videoModel:x};return $e}function be($e){se=$e}function Be($e){return $e.codec&&$e.codec.search(d.default.STPP)>=0||$e.mimeType&&$e.mimeType.search(d.default.TTML)>=0}function ke($e,Te){var de=$e.roles&&$e.roles.length>0?Te[$e.roles[0]]:Te.caption;return de=de===Te.caption||de===Te.subtitle?de:Te.caption,de}function Ye($e,Te){var de=Te.mediaInfo,Re=de.type,xe=de.mimeType,Ne=de.codec||xe;if(!Ne){ee.error("No text type defined");return}de.codec.indexOf("application/mp4")!==-1?Oe($e,Te,Ne):Re===d.default.VIDEO?it($e,Te):qe($e,Te,Ne)}function Oe($e,Te,de){var Re,xe;if(Te.segmentType==="InitializationSegment")oe=!0,ge=ne.getMediaTimescaleFromMoov($e);else{if(!oe)return;xe=ne.getSamplesInfo($e),Re=xe.sampleList,Re.length>0&&(he=Re[0].cts-Te.start*ge),de.search(d.default.STPP)>=0?Se($e,Re,de):Me($e,Re)}}function Se($e,Te,de){var Re,xe;for(ae=ae!==null?ae:ot(de),Re=0;Re<Te.length;Re++){var Ne=Te[Re],Xe=Ne.cts,nt=Ge(),et=nt+Xe/ge,dt=et+Ne.duration/ge;ie.buffered.add(et,dt);var Tt=new DataView($e,Ne.offset,Ne.subSizes[0]),Ct=L.Utils.dataViewToString(Tt,d.default.UTF8),De=[],Ue=Ne.offset+Ne.subSizes[0];for(xe=1;xe<Ne.subSizes.length;xe++){var Ze=new Uint8Array($e,Ue,Ne.subSizes[xe]),mt=String.fromCharCode.apply(null,Ze);De.push(mt),Ue+=Ne.subSizes[xe]}try{var ft=y.getValue(),pt=ft.ttmlTimeIsRelative?Xe/ge:0,Mt=ae.parse(Ct,pt,Xe/ge,(Xe+Ne.duration)/ge,De);F.addCaptions(se,nt,Mt)}catch(Kt){X.removeExecutedRequestsBeforeTime(),this.remove(),ee.error("TTML parser error: "+Kt.message)}}}function Me($e,Te){var de,Re,xe,Ne=[];for(de=0;de<Te.length;de++){var Xe=Te[de];Xe.cts-=he;var nt=Ge(),et=nt+Xe.cts/ge,dt=et+Xe.duration/ge;ie.buffered.add(et,dt);var Tt=$e.slice(Xe.offset,Xe.offset+Xe.size),Ct=L.parseBuffer(Tt);for(Re=0;Re<Ct.boxes.length;Re++){var De=Ct.boxes[Re];if(ee.debug("VTT box1: "+De.type),De.type!=="vtte"&&De.type==="vttc")for(ee.debug("VTT vttc boxes.length = "+De.boxes.length),xe=0;xe<De.boxes.length;xe++){var Ue=De.boxes[xe];if(ee.debug("VTT box2: "+Ue.type),Ue.type==="payl"){var Ze=Ue.cue_text;ee.debug("VTT cue_text = "+Ze);var mt=Xe.cts/ge,ft=(Xe.cts+Xe.duration)/ge;Ne.push({start:mt,end:ft,data:Ze,styles:{}}),ee.debug("VTT "+mt+"-"+ft+" : "+Ze)}}}}Ne.length>0&&F.addCaptions(se,0,Ne)}function qe($e,Te,de){var Re,xe,Ne=new DataView($e,0,$e.byteLength);xe=L.Utils.dataViewToString(Ne,d.default.UTF8);try{Re=ot(de).parse(xe,0),F.addCaptions(F.getCurrentTrackIdx(),0,Re),ie.buffered&&ie.buffered.add(Te.start,Te.end)}catch(Xe){D.error(new p.default(h.default.TIMED_TEXT_ERROR_ID_PARSE_CODE,h.default.TIMED_TEXT_ERROR_MESSAGE_PARSE+Xe.message,xe))}}function it($e,Te){var de,Re;if(Te.segmentType===o.HTTPRequest.INIT_SEGMENT_TYPE)q===0&&(q=ne.getMediaTimescaleFromMoov($e));else if(Te.segmentType===o.HTTPRequest.MEDIA_SEGMENT_TYPE){if(q===0){ee.warn("CEA-608: No timescale for embeddedTextTrack yet");return}Re=ne.getSamplesInfo($e);var xe=Re.lastSequenceNumber;if(!te[0]&&!te[1]&&at(),q){if(le!==null&&xe!==le+Re.numSequences)for(de=0;de<te.length;de++)te[de]&&te[de].reset();for(var Ne=We($e,Re.sampleList),Xe=0;Xe<te.length;Xe++){var nt=Ne.fields[Xe],et=te[Xe];if(et)for(de=0;de<nt.length;de++)et.addData(nt[de][0]/q,nt[de][1])}le=xe}}}function at(){for(var $e,Te=0;Te<Z.length;Te++){if($e=F.getTrackIdxForId(Z[Te].id),$e===-1){ee.warn("CEA-608: data before track is ready.");return}var de=Ce($e);te[Te]=new(O()).Cea608Parser(Te+1,{newCue:de},null)}}function Ce($e){function Te(de,Re,xe){var Ne;if(x.getTTMLRenderingDiv())Ne=N.createHTMLCaptionsFromScreen(x.getElement(),de,Re,xe);else{var Xe=xe.getDisplayText();Ne=[{start:de,end:Re,data:Xe,styles:{}}]}Ne&&F.addCaptions($e,0,Ne)}return Te}function We($e,Te){if(Te.length===0)return null;for(var de={splits:[],fields:[[],[]]},Re=new DataView($e),xe=0;xe<Te.length;xe++)for(var Ne=Te[xe],Xe=O().findCea608Nalus(Re,Ne.offset,Ne.size),nt=null,et=0,dt=0;dt<Xe.length;dt++)for(var Tt=O().extractCea608DataFromRange(Re,Xe[dt]),Ct=0;Ct<2;Ct++)if(Tt[Ct].length>0){Ne.cts!==nt?et=0:et+=1;var De=Ge();de.fields[Ct].push([Ne.cts+De*q,Tt[Ct],et]),nt=Ne.cts}return de.fields.forEach(function(Ze){Ze.sort(function(mt,ft){return mt[0]===ft[0]?mt[2]-ft[2]:mt[0]-ft[0]})}),de}function Ge(){return isNaN(ie.timestampOffset)?0:ie.timestampOffset}function tt($e){var Te=!1;return Z.length>1&&$e.isEmbedded?Te=$e.id&&$e.id===d.default.CC1:Z.length===1?$e.id&&typeof $e.id=="string"&&$e.id.substring(0,2)==="CC"&&(Te=!0):Z.length===0&&(Te=$e.index===ce[0].index),Te}function ot($e){var Te;return $e.search(d.default.VTT)>=0?Te=$.get().streaming.text.webvtt.customRenderingEnabled&&W?W:k:($e.search(d.default.TTML)>=0||$e.search(d.default.STPP)>=0)&&(Te=V),Te}function ct($e,Te){$e===void 0&&$e===Te&&($e=ie.buffered.start(0),Te=ie.buffered.end(ie.buffered.length-1)),ie.buffered.remove($e,Te),F.deleteCuesFromTrackIdx(se,$e,Te)}function ht($e){Z.forEach(function(Te){var de=F.getTrackIdxForId(Te.id);de>=0&&F.deleteCuesFromTrackIdx(de,$e.from,$e.to)})}function Pt(){ce=[]}return ie={initialize:U,addMediaInfos:B,resetMediaInfos:Pt,getStreamId:w,append:Ye,abort:z,addEmbeddedTrack:me,resetEmbedded:ve,getConfig:Ae,setCurrentFragmentedTrackIdx:be,remove:ct,reset:fe},R(),ie}C.__dashjs_factory_name="TextSourceBuffer";const v=m.default.getClassFactory(C)},"./src/streaming/text/TextTracks.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),c=r("./src/streaming/MediaPlayerEvents.js"),E=r("./src/core/FactoryMaker.js"),m=r("./src/core/Debug.js"),f=r("./node_modules/imsc/src/main/js/main.js");function T(p,h){var C;if(typeof Symbol>"u"||p[Symbol.iterator]==null){if(Array.isArray(p)||(C=L(p))||h&&p&&typeof p.length=="number"){C&&(p=C);var v=0,I=function(){};return{s:I,n:function(){return v>=p.length?{done:!0}:{done:!1,value:p[v++]}},e:function(F){throw F},f:I}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var D=!0,y=!1,A;return{s:function(){C=p[Symbol.iterator]()},n:function(){var F=C.next();return D=F.done,F},e:function(F){y=!0,A=F},f:function(){try{!D&&C.return!=null&&C.return()}finally{if(y)throw A}}}}function L(p,h){if(p){if(typeof p=="string")return P(p,h);var C=Object.prototype.toString.call(p).slice(8,-1);if(C==="Object"&&p.constructor&&(C=p.constructor.name),C==="Map"||C==="Set")return Array.from(p);if(C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C))return P(p,h)}}function P(p,h){(h==null||h>p.length)&&(h=p.length);for(var C=0,v=new Array(h);C<h;C++)v[C]=p[C];return v}var O=["text","images","embeddedImages","align","fontSize","id","isd","line","lineAlign","lineHeight","linePadding","position","positionAlign","region","size","snapToLines","vertical"];function M(p){var h=this.context,C=(0,o.default)(h).getInstance(),v=p.videoModel,I=p.streamInfo,D=p.settings,y,A,x,F,k,W,V,Q,$,K,Y,re,ie,ee,ne,ae,ce,X;function oe(){A=(0,m.default)(h).getInstance().getLogger(y)}function ge(){typeof window>"u"||typeof navigator>"u"||(x=window.VTTCue||window.TextTrackCue,F=[],k=[],W=-1,V=0,Q=0,$=0,K=0,Y=null,re=null,ie=null,ne=!1,ce=2147483647,ae=null,document.fullscreenElement!==void 0?ee="fullscreenElement":document.webkitIsFullScreen!==void 0?ee="webkitIsFullScreen":document.msFullscreenElement?ee="msFullscreenElement":document.mozFullScreen&&(ee="mozFullScreen"))}function _e(){return I.id}function he(Ce){var We=Ce.kind,Ge=Ce.id!==void 0?Ce.id:Ce.lang,tt=Ce.lang,ot=Ce.isTTML,ct=Ce.isEmbedded,ht=v.addTextTrack(We,Ge,tt,ot,ct);return ht}function se(Ce){F.push(Ce)}function Z(){F.sort(function(Pt,$e){return Pt.index-$e.index}),Y=v.getTTMLRenderingDiv(),re=v.getVttRenderingDiv();for(var Ce=-1,We=0;We<F.length;We++){var Ge=he(F[We]);k.push(Ge),F[We].defaultTrack&&(Ge.default=!0,Ce=We);var tt=fe(We);tt&&(tt.mode=d.default.TEXT_SHOWING,Y&&(F[We].isTTML||F[We].isEmbedded)?tt.renderingType="html":tt.renderingType="default"),j(We,0,F[We].captionData),C.trigger(c.default.TEXT_TRACK_ADDED)}if(ve.call(this,Ce),Ce>=0){var ot=function Pt(){var $e=fe(Ce);$e&&$e.renderingType==="html"&&le.call(this,$e,!0),C.off(c.default.PLAYBACK_METADATA_LOADED,Pt,this)};C.on(c.default.PLAYBACK_METADATA_LOADED,ot,this);for(var ct=0;ct<F.length;ct++){var ht=fe(ct);ht&&(ht.mode=ct===Ce?d.default.TEXT_SHOWING:d.default.TEXT_HIDDEN,ht.manualMode=ct===Ce?d.default.TEXT_SHOWING:d.default.TEXT_HIDDEN)}}C.trigger(l.default.TEXT_TRACKS_QUEUE_INITIALIZED,{index:W,tracks:F,streamId:I.id})}function q(Ce,We,Ge,tt,ot,ct){var ht=Ce/We,Pt=Ge/tt,$e=0,Te=0;ht>Pt?(Te=We,$e=Te/tt*Ge):($e=Ce,Te=$e/Ge*tt);var de=0,Re=0,xe=0,Ne=0,Xe=$e/Te;return Xe>ot?(Ne=Te,xe=Te*ot):(xe=$e,Ne=$e/ot),de=(Ce-xe)/2,Re=(We-Ne)/2,ct?{x:de+xe*.1,y:Re+Ne*.1,w:xe*.8,h:Ne*.8}:{x:de,y:Re,w:xe,h:Ne}}function le(Ce,We){var Ge=v.getClientWidth(),tt=v.getClientHeight(),ot=v.getVideoWidth(),ct=v.getVideoHeight(),ht=v.getVideoRelativeOffsetTop(),Pt=v.getVideoRelativeOffsetLeft();if(ot!==0&&ct!==0){var $e=ot/ct,Te=!1;Ce.isFromCEA608&&($e=1.1666666666666667,Te=!0);var de=q.call(this,Ge,tt,ot,ct,$e,Te),Re=de.w,xe=de.h,Ne=de.x,Xe=de.y;if(Re!=$||xe!=K||Ne!=V||Xe!=Q||We){if(V=Ne+Pt,Q=Xe+ht,$=Re,K=xe,Y){var nt=Y.style;nt&&(nt.left=V+"px",nt.top=Q+"px",nt.width=$+"px",nt.height=K+"px",nt.zIndex=ee&&document[ee]||ne?ce:null,C.trigger(c.default.CAPTION_CONTAINER_RESIZE))}var et=Ce.activeCues;if(et)for(var dt=et.length,Tt=0;Tt<dt;++Tt){var Ct=et[Tt];Ct.scaleCue(Ct)}}}}function te(Ce){var We=$,Ge=K,tt,ot,ct,ht,Pt;if(Ce.cellResolution){var $e=[We/Ce.cellResolution[0],Ge/Ce.cellResolution[1]];if(Ce.linePadding){for(tt in Ce.linePadding)if(Ce.linePadding.hasOwnProperty(tt)){var Te=Ce.linePadding[tt];ot=(Te*$e[0]).toString();for(var de=document.getElementsByClassName("spanPadding"),Re=0;Re<de.length;Re++)de[Re].style.cssText=de[Re].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+ot),de[Re].style.cssText=de[Re].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+ot)}}if(Ce.fontSize){for(tt in Ce.fontSize)if(Ce.fontSize.hasOwnProperty(tt)){Ce.fontSize[tt][0]==="%"?ct=Ce.fontSize[tt][1]/100:Ce.fontSize[tt][0]==="c"&&(ct=Ce.fontSize[tt][1]),ot=(ct*$e[1]).toString(),tt!=="defaultFontSize"?Pt=document.getElementsByClassName(tt):Pt=document.getElementsByClassName("paragraph");for(var xe=0;xe<Pt.length;xe++)Pt[xe].style.cssText=Pt[xe].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+ot)}if(Ce.lineHeight){for(tt in Ce.lineHeight)if(Ce.lineHeight.hasOwnProperty(tt)){Ce.lineHeight[tt][0]==="%"?ht=Ce.lineHeight[tt][1]/100:Ce.fontSize[tt][0]==="c"&&(ht=Ce.lineHeight[tt][1]),ot=(ht*$e[1]).toString(),Pt=document.getElementsByClassName(tt);for(var Ne=0;Ne<Pt.length;Ne++)Pt[Ne].style.cssText=Pt[Ne].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+ot)}}}}if(Ce.isd){var Xe=document.getElementById(Ce.cueID);Xe&&Y.removeChild(Xe),N(Ce)}}function N(Ce){if(Y){var We=document.createElement("div");Y.appendChild(We),ae=(0,f.renderHTML)(Ce.isd,We,function(Ge){var tt=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,ot=/^#(.*)$/;if(tt.test(Ge)){var ct=tt.exec(Ge),ht=parseInt(ct[4],10)-1,Pt=btoa(Ce.images[ht]),$e="data:image/png;base64,"+Pt;return $e}else if(ot.test(Ge)){var Te=ot.exec(Ge),de=Te[1],Re="data:image/png;base64,"+Ce.embeddedImages[de];return Re}else return null},Y.clientHeight,Y.clientWidth,!1,function(Ge){A.info("renderCaption :",Ge)},ae,!0),We.id=Ce.cueID,C.trigger(c.default.CAPTION_RENDERED,{captionDiv:We,currentTrackIdx:W})}}function R(Ce,We){if(!D.get().streaming.text.extendSegmentedCues||!We.cues||We.cues.length===0)return!1;var Ge=We.cues[We.cues.length-1];return Ge.endTime!==Ce.startTime||!w(Ge,Ce,O)?!1:(Ge.endTime=Ce.endTime,!0)}function w(Ce,We,Ge){for(var tt=0;tt<Ge.length;tt++){var ot=Ge[tt];if(JSON.stringify(Ce[ot])!==JSON.stringify(We[ot]))return!1}return!0}function j(Ce,We,Ge){var tt=fe(Ce);if(tt&&!(!Array.isArray(Ge)||Ge.length===0))for(var ot=0;ot<Ge.length;ot++){var ct=void 0,ht=Ge[ot];tt.cellResolution=ht.cellResolution,tt.isFromCEA608=ht.isFromCEA608,!isNaN(ht.start)&&!isNaN(ht.end)&&(ct=ht.type==="html"&&Y?H(ht,We,tt):ht.data?U(ht,We,tt):null);try{ct?Ae(tt,ct)||(D.get().streaming.text.webvtt.customRenderingEnabled?(tt.manualCueList||(tt.manualCueList=[]),tt.manualCueList.push(ct)):R(ct,tt)||tt.addCue(ct)):A.error("Impossible to display subtitles. You might have missed setting a TTML rendering div via player.attachTTMLRenderingDiv(TTMLRenderingDiv)")}catch(Pt){throw Be(tt),tt.addCue(ct),Pt}}}function H(Ce,We,Ge){var tt=this,ot=new x(Ce.start+We,Ce.end+We,"");return ot.cueHTMLElement=Ce.cueHTMLElement,ot.isd=Ce.isd,ot.images=Ce.images,ot.embeddedImages=Ce.embeddedImages,ot.cueID=Ce.cueID,ot.scaleCue=te.bind(tt),ot.cellResolution=Ce.cellResolution,ot.lineHeight=Ce.lineHeight,ot.linePadding=Ce.linePadding,ot.fontSize=Ce.fontSize,Y.style.left=V+"px",Y.style.top=Q+"px",Y.style.width=$+"px",Y.style.height=K+"px",ot.onenter=function(){Ge.mode===d.default.TEXT_SHOWING&&(this.isd?(N(this),A.debug("Cue enter id:"+this.cueID)):(Y.appendChild(this.cueHTMLElement),te.call(tt,this),C.trigger(c.default.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:W})))},ot.onexit=function(){if(Y)for(var ct=Y.childNodes,ht=0;ht<ct.length;++ht)ct[ht].id===this.cueID&&(A.debug("Cue exit id:"+ct[ht].id),Y.removeChild(ct[ht]),--ht)},ot}function U(Ce,We,Ge){var tt=new x(Ce.start-We,Ce.end-We,Ce.data);if(tt.cueID="".concat(tt.startTime,"_").concat(tt.endTime),tt.isActive=!1,Ce.styles)try{Ce.styles.align!==void 0&&"align"in tt&&(tt.align=Ce.styles.align),Ce.styles.line!==void 0&&"line"in tt&&(tt.line=Ce.styles.line),Ce.styles.position!==void 0&&"position"in tt&&(tt.position=Ce.styles.position),Ce.styles.size!==void 0&&"size"in tt&&(tt.size=Ce.styles.size)}catch(ot){A.error(ot)}return tt.onenter=function(){Ge.mode===d.default.TEXT_SHOWING&&C.trigger(c.default.CAPTION_RENDERED,{currentTrackIdx:W})},tt}function B(Ce){var We=z();if(We&&We.length>0){var Ge=We[0],tt=Ge.manualCueList;tt&&tt.length>0&&tt.forEach(function(ot){if(ot.startTime<=Ce&&ot.endTime>=Ce&&!ot.isActive)ot.isActive=!0,WebVTT.processCues(window,[ot],re,ot.cueID);else if(ot.isActive&&(ot.startTime>Ce||ot.endTime<Ce)&&(ot.isActive=!1,re))for(var ct=re.childNodes,ht=0;ht<ct.length;++ht)ct[ht].id===ot.cueID&&(re.removeChild(ct[ht]),--ht)})}}function G(){var Ce=z();if(Ce&&Ce.length>0){var We=Ce[0],Ge=We.manualCueList;Ge&&Ge.length>0&&Ge.forEach(function(tt){if(tt.isActive&&(tt.isActive=!1,re))for(var ot=re.childNodes,ct=0;ct<ot.length;++ct)ot[ct].id===tt.cueID&&(re.removeChild(ot[ct]),--ct)})}}function z(){var Ce=v.getTextTracks(),We=[],Ge=T(Ce),tt;try{for(Ge.s();!(tt=Ge.n()).done;){var ot=tt.value;ot.manualMode===d.default.TEXT_SHOWING&&We.push(ot)}}catch(ct){Ge.e(ct)}finally{Ge.f()}return We}function fe(Ce){return Ce>=0&&F[Ce]?v.getTextTrack(F[Ce].kind,F[Ce].id,F[Ce].lang,F[Ce].isTTML,F[Ce].isEmbedded):null}function ue(){return W}function J(Ce){for(var We=-1,Ge=0;Ge<F.length;Ge++)if(F[Ge].id===Ce){We=Ge;break}return We}function ve(Ce){var We=this;if(Ce!==W){W=Ce;var Ge=fe(W);me.call(this,Ge),ie&&(clearInterval(ie),ie=null),Ge&&Ge.renderingType==="html"&&(le.call(this,Ge,!0),window.ResizeObserver?(X=new window.ResizeObserver(function(){le.call(We,Ge,!0)}),X.observe(v.getElement())):ie=setInterval(le.bind(this,Ge),500))}}function me(Ce){qe.call(this),Ce?Ce.renderingType==="html"?Se.call(this):Me.call(this):Me.call(this)}function Ae(Ce,We){if(!Ce.cues)return!1;for(var Ge=0;Ge<Ce.cues.length;Ge++)if(Ce.cues[Ge].startTime===We.startTime&&Ce.cues[Ge].endTime===We.endTime)return!0;return!1}function be(Ce,We,Ge){var tt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return(isNaN(We)||(tt?Ce.startTime:Ce.endTime)>=We)&&(isNaN(Ge)||(tt?Ce.endTime:Ce.startTime)<=Ge)}function Be(Ce,We,Ge){var tt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;if(Ce.cues)for(var ot=Ce.cues,ct=ot.length-1,ht=ct;ht>=0;ht--)be(ot[ht],We,Ge,tt)&&(ot[ht].onexit&&ot[ht].onexit(),Ce.removeCue(ot[ht]))}function ke(Ce,We,Ge){var tt=fe(Ce);tt&&Be(tt,We,Ge)}function Ye(){for(var Ce=k?k.length:0,We=0;We<Ce;We++){var Ge=fe(We);Ge&&Be.call(this,Ge,I.start,I.start+I.duration,!1)}k=[],F=[],ie&&(clearInterval(ie),ie=null),X&&v&&(X.unobserve(v.getElement()),X=null),W=-1,qe.call(this)}function Oe(Ce){v.removeChild(k[Ce]),k.splice(Ce,1)}function Se(){var Ce=document.getElementById("native-cue-style");if(!Ce){Ce=document.createElement("style"),Ce.id="native-cue-style",document.head.appendChild(Ce);var We=Ce.sheet,Ge=v.getElement();try{Ge&&(Ge.id?We.insertRule("#"+Ge.id+"::cue {background: transparent}",0):Ge.classList.length!==0?We.insertRule("."+Ge.className+"::cue {background: transparent}",0):We.insertRule("video::cue {background: transparent}",0))}catch(tt){A.info(""+tt.message)}}}function Me(){var Ce=document.getElementById("native-cue-style");Ce&&document.head.removeChild(Ce)}function qe(){if(Y)for(;Y.firstChild;)Y.removeChild(Y.firstChild)}function it(Ce,We){var Ge=fe(Ce);Ge&&Ge.mode!==We&&(Ge.mode=We),Ge&&Ge.manualMode!==We&&(Ge.manualMode=We)}function at(){return F[W]}return y={initialize:ge,getStreamId:_e,addTextTrack:se,addCaptions:j,createTracks:Z,getCurrentTrackIdx:ue,setCurrentTrackIdx:ve,getTrackIdxForId:J,getCurrentTrackInfo:at,setModeForTrackIdx:it,deleteCuesFromTrackIdx:ke,deleteAllTextTracks:Ye,deleteTextTrack:Oe,manualCueProcessing:B,disableManualTracks:G},oe(),y}M.__dashjs_factory_name="TextTracks";const S=E.default.getClassFactory(M)},"./src/streaming/thumbnail/ThumbnailController.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>T});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/constants/Constants.js"),l=r("./src/streaming/vo/Thumbnail.js"),c=r("./src/streaming/thumbnail/ThumbnailTracks.js"),E=r("./src/streaming/vo/BitrateInfo.js"),m=r("./src/dash/utils/SegmentsUtils.js");function f(L){var P=this.context,O=L.streamInfo,M,S;function p(){x(),S=(0,c.default)(P).create({streamInfo:O,adapter:L.adapter,baseURLController:L.baseURLController,timelineConverter:L.timelineConverter,debug:L.debug,eventBus:L.eventBus,events:L.events,dashConstants:L.dashConstants,dashMetrics:L.dashMetrics,segmentBaseController:L.segmentBaseController})}function h(){S.addTracks();var F=S.getTracks();F&&F.length>0&&D(0)}function C(){return O.id}function v(F,k){if(typeof k=="function"){var W=S.getCurrentTrack(),V,Q;if(!W||W.segmentDuration<=0||F===void 0||F===null){k(null);return}Q=S.getThumbnailRequestForTime(F),Q&&(W.segmentDuration=Q.duration),V=F%W.segmentDuration;var $=Math.floor(V*W.tilesHor*W.tilesVert/W.segmentDuration),K=new l.default;if(K.width=Math.floor(W.widthPerTile),K.height=Math.floor(W.heightPerTile),K.x=Math.floor($%W.tilesHor)*W.widthPerTile,K.y=Math.floor($/W.tilesHor)*W.heightPerTile,"readThumbnail"in W)return W.readThumbnail(F,function(re){K.url=re,k(K)});if(Q)K.url=Q.url,W.segmentDuration=NaN;else{var Y=Math.floor(F/W.segmentDuration);K.url=I(W,Y)}k(K)}}function I(F,k){var W=k+F.startNumber,V=(0,m.replaceTokenForTemplate)(F.templateUrl,"Number",W);return V=(0,m.replaceTokenForTemplate)(V,"Time",(W-1)*F.segmentDuration*F.timescale),V=(0,m.replaceTokenForTemplate)(V,"Bandwidth",F.bandwidth),(0,m.unescapeDollarsInTemplate)(V)}function D(F){S.setTrackByIndex(F)}function y(){return S.getCurrentTrackIndex()}function A(){var F=S.getTracks(),k=0;return F.map(function(W){var V=new E.default;return V.mediaType=o.default.IMAGE,V.qualityIndex=k++,V.bitrate=W.bitrate,V.width=W.width,V.height=W.height,V})}function x(){S&&S.reset()}return M={getStreamId:C,initialize:h,provide:v,setTrackByIndex:D,getCurrentTrackIndex:y,getBitrateList:A,reset:x},p(),M}f.__dashjs_factory_name="ThumbnailController";const T=d.default.getClassFactory(f)},"./src/streaming/thumbnail/ThumbnailTracks.js":(g,i,r)=>{r.r(i),r.d(i,{THUMBNAILS_SCHEME_ID_URIS:()=>O,default:()=>S});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/dash/constants/DashConstants.js"),l=r("./src/core/FactoryMaker.js"),c=r("./src/streaming/vo/ThumbnailTrackInfo.js"),E=r("./src/streaming/utils/URLUtils.js"),m=r("./src/dash/utils/SegmentsUtils.js"),f=r("./src/streaming/utils/BoxParser.js"),T=r("./src/streaming/net/XHRLoader.js"),L=r("./src/dash/DashHandler.js"),P=r("./src/dash/controllers/SegmentsController.js"),O=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function M(p){var h=this.context,C=p.adapter,v=p.baseURLController,I=p.streamInfo,D=p.timelineConverter,y=p.debug,A=p.eventBus,x=p.events,F=p.dashConstants,k=(0,E.default)(h).getInstance(),W,V,Q,$,K,Y,re,ie;function ee(){q(),re=(0,T.default)(h).create({}),ie=(0,f.default)(h).getInstance(),Y=(0,P.default)(h).create({events:x,eventBus:A,streamInfo:I,timelineConverter:D,dashConstants:F,dashMetrics:p.dashMetrics,segmentBaseController:p.segmentBaseController,type:d.default.IMAGE}),Q=(0,L.default)(h).create({streamInfo:I,type:d.default.IMAGE,timelineConverter:D,segmentsController:Y,baseURLController:v,debug:y,eventBus:A,events:x,dashConstants:F,urlUtils:k}),Q.initialize(C?C.getIsDynamic():!1)}function ne(){if(!(!I||!C)&&(K=C.getMediaInfoForType(I,d.default.IMAGE),!!K)){var le=C.getVoRepresentations(K);le&&le.length>0&&le.forEach(function(te){(te.segmentInfoType===o.default.SEGMENT_TEMPLATE&&te.segmentDuration>0&&te.media||te.segmentInfoType===o.default.SEGMENT_TIMELINE)&&ae(te),te.segmentInfoType===o.default.SEGMENT_BASE&&ae(te,!0)}),V.length>0&&V.sort(function(te,N){return te.bitrate-N.bitrate})}}function ae(le,te){var N=new c.default;N.id=le.id,N.bitrate=le.bandwidth,N.width=le.width,N.height=le.height,N.tilesHor=1,N.tilesVert=1,le.essentialProperties&&le.essentialProperties.forEach(function(R){if(O.indexOf(R.schemeIdUri)>=0&&R.value){var w=R.value.split("x");w.length===2&&!isNaN(w[0])&&!isNaN(w[1])&&(N.tilesHor=parseInt(w[0],10),N.tilesVert=parseInt(w[1],10))}}),te?Y.updateSegmentData(le).then(function(R){ce(N,le,R)}):(N.startNumber=le.startNumber,N.segmentDuration=le.segmentDuration,N.timescale=le.timescale,N.templateUrl=oe(le)),N.tilesHor>0&&N.tilesVert>0&&(N.widthPerTile=N.width/N.tilesHor,N.heightPerTile=N.height/N.tilesVert,V.push(N))}function ce(le,te,N){var R=[],w=X(N,te);te.segments=w,le.segmentDuration=te.segments[0].duration,le.readThumbnail=function(j,H){var U=null;R.some(function(B){if(B.start<=j&&B.end>j)return U=B.url,!0}),U?H(U):te.segments.some(function(B){if(B.mediaStartTime<=j&&B.mediaStartTime+B.duration>j){var G=v.resolve(te.path);return re.load({method:"get",url:G.url,request:{range:B.mediaRange,responseType:"arraybuffer"},onload:function(fe){var ue=ie.getSamplesInfo(fe.target.response),J=new Blob([fe.target.response.slice(ue.sampleList[0].offset,ue.sampleList[0].offset+ue.sampleList[0].size)],{type:"image/jpeg"}),ve=window.URL.createObjectURL(J);R.push({start:B.mediaStartTime,end:B.mediaStartTime+B.duration,url:ve}),H&&H(ve)}}),!0}})}}function X(le,te){var N=[],R=0,w,j,H,U;for(w=0,j=le.segments.length;w<j;w++)H=le.segments[w],U=(0,m.getTimeBasedSegment)(D,C.getIsDynamic(),te,H.startTime,H.duration,H.timescale,H.media,H.mediaRange,R),U&&(N.push(U),U=null,R++);return N}function oe(le){var te=k.isRelative(le.media)?k.resolve(le.media,v.resolve(le.path).url):le.media;return te?(0,m.replaceIDForTemplate)(te,le.id):""}function ge(){return V}function _e(){return $}function he(){return $<0?null:V[$]}function se(le){!V||V.length===0||(le>=V.length&&(le=V.length-1),$=le)}function Z(le){for(var te,N=C.getVoRepresentations(K),R=0;R<N.length;R++)if(V[$].id===N[R].id){te=N[R];break}return Q.getSegmentRequestForTime(K,te,le)}function q(){V=[],$=-1,K=null}return W={getTracks:ge,addTracks:ne,reset:q,setTrackByIndex:se,getCurrentTrack:he,getCurrentTrackIndex:_e,getThumbnailRequestForTime:Z},ee(),W}M.__dashjs_factory_name="ThumbnailTracks";const S=l.default.getClassFactory(M)},"./src/streaming/utils/BaseURLSelector.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/core/errors/Errors.js"),o=r("./src/core/EventBus.js"),l=r("./src/core/events/Events.js"),c=r("./src/streaming/controllers/BlacklistController.js"),E=r("./src/streaming/utils/baseUrlResolution/DVBSelector.js"),m=r("./src/streaming/utils/baseUrlResolution/BasicSelector.js"),f=r("./src/core/FactoryMaker.js"),T=r("./src/streaming/vo/DashJSError.js"),L=r("./src/streaming/utils/SupervisorTools.js"),P=r("./src/streaming/utils/baseUrlResolution/ContentSteeringSelector.js"),O=r("./src/core/Settings.js");function M(){var p=this.context,h=(0,o.default)(p).getInstance(),C=(0,O.default)(p).getInstance(),v,I,D,y,A,x;function F(){I=(0,c.default)(p).create({updateEventName:l.default.SERVICE_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:l.default.SERVICE_LOCATION_BLACKLIST_ADD}),D=(0,m.default)(p).create({blacklistController:I}),y=(0,E.default)(p).create({blacklistController:I}),A=(0,P.default)(p).create(),A.setConfig({blacklistController:I}),x=D}function k($){$.selector&&(x=$.selector),$.contentSteeringSelector&&(A=$.contentSteeringSelector)}function W($){(0,L.checkParameterType)($,"boolean"),x=$?y:D}function V($){if($){if(C.get().streaming.applyContentSteering){var K=A.selectBaseUrlIndex($);!isNaN(K)&&K!==-1&&($.selectedIdx=K)}if(!isNaN($.selectedIdx))return $.baseUrls[$.selectedIdx];var Y=x.select($.baseUrls);if(!Y){h.trigger(l.default.URL_RESOLUTION_FAILED,{error:new T.default(d.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,d.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),x===D&&Q();return}return $.selectedIdx=$.baseUrls.indexOf(Y),Y}}function Q(){I.reset()}return v={chooseSelector:W,select:V,reset:Q,setConfig:k},F(),v}M.__dashjs_factory_name="BaseURLSelector";const S=f.default.getClassFactory(M)},"./src/streaming/utils/BoxParser.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>f});var d=r("./src/core/Debug.js"),o=r("./src/streaming/utils/IsoFile.js"),l=r("./src/core/FactoryMaker.js"),c=r("./node_modules/codem-isoboxer/dist/iso_boxer.js"),E=r("./src/streaming/vo/IsoBoxSearchInfo.js");function m(){var T,L,P=this.context;function O(){T=(0,d.default)(P).getInstance().getLogger(L)}function M(y){if(!y)return null;y.fileStart===void 0&&(y.fileStart=0);var A=c.parseBuffer(y),x=(0,o.default)(P).create();return x.setData(A),x}function S(y,A,x){if(x===void 0&&(x=0),!A||x+8>=A.byteLength)return new E.default(0,!1);for(var F=A instanceof ArrayBuffer?new Uint8Array(A):A,k,W=0;x<F.byteLength;){var V=C(F,x),Q=v(F,x+4);if(V===0)break;x+V<=F.byteLength&&(y.indexOf(Q)>=0?k=new E.default(x,!0,V):W=x+V),x+=V}return k||new E.default(W,!1)}function p(y){if(!y||y.byteLength===0)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var A=M(y),x=A.getBoxes("moof"),F=A.getBoxes("mfhd"),k,W,V,Q,$,K,Y,re,ie,ee,ne,ae,ce,X,oe,ge,_e;ge=A.getBoxes("moof").length,oe=F[F.length-1].sequence_number,V=0,K=[];var he=-1,se=-1;for(ne=0;ne<x.length;ne++){var Z=x[ne],q=Z.getChildBoxes("traf");for(ie=0;ie<q.length;ie++){var le=q[ie],te=le.getChildBox("tfhd"),N=le.getChildBox("tfdt");$=N.baseMediaDecodeTime;var R=le.getChildBoxes("trun"),w=le.getChildBoxes("subs");for(ee=0;ee<R.length;ee++){var j=R[ee];for(V=j.sample_count,X=(te.base_data_offset||0)+(j.data_offset||0),re=0;re<V;re++){Y=j.samples[re],k=Y.sample_duration!==void 0?Y.sample_duration:te.default_sample_duration,Q=Y.sample_size!==void 0?Y.sample_size:te.default_sample_size,W=Y.sample_composition_time_offset!==void 0?Y.sample_composition_time_offset:0;var H={dts:$,cts:$+W,duration:k,offset:Z.offset+X,size:Q,subSizes:[Q]};if(w)for(ae=0;ae<w.length;ae++){var U=w[ae];if(he<U.entry_count-1&&re>se&&(he++,se+=U.entries[he].sample_delta),re==se){H.subSizes=[];var B=U.entries[he];for(ce=0;ce<B.subsample_count;ce++)H.subSizes.push(B.subsamples[ce].subsample_size)}}K.push(H),X+=Q,$+=k}}_e=$-N.baseMediaDecodeTime}}return{sampleList:K,lastSequenceNumber:oe,totalDuration:_e,numSequences:ge}}function h(y){var A=M(y),x=A?A.getBox("mdhd"):void 0;return x?x.timescale:NaN}function C(y,A){return y[A+3]>>>0|y[A+2]<<8>>>0|y[A+1]<<16>>>0|y[A]<<24>>>0}function v(y,A){return String.fromCharCode(y[A++])+String.fromCharCode(y[A++])+String.fromCharCode(y[A++])+String.fromCharCode(y[A])}function I(y){var A=null,x,F,k=M(y);if(!k)return A;var W=k.getBox("ftyp"),V=k.getBox("moov");return T.debug("Searching for initialization."),V&&V.isComplete&&(x=W?W.offset:V.offset,F=V.offset+V.size-1,A=x+"-"+F,T.debug("Found the initialization.  Range: "+A)),A}function D(y,A,x){if(x===void 0&&(x=0),!A||x+8>=A.byteLength)return new E.default(0,!1);for(var F=A instanceof ArrayBuffer?new Uint8Array(A):A,k,W=0;x<F.byteLength;){var V=C(F,x),Q=v(F,x+4);if(V===0)break;x+V<=F.byteLength&&(y.indexOf(Q)>=0?k=new E.default(x,!0,V,Q):W=x+V),x+=V}return k||new E.default(W,!1)}return L={parse:M,findLastTopIsoBoxCompleted:S,getMediaTimescaleFromMoov:h,getSamplesInfo:p,findInitRange:I,parsePayload:D},O(),L}m.__dashjs_factory_name="BoxParser";const f=l.default.getSingletonFactory(m)},"./src/streaming/utils/Capabilities.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>f,supportsMediaSource:()=>E});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/thumbnail/ThumbnailTracks.js"),l=r("./src/streaming/constants/Constants.js"),c=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function E(){var T="WebKitMediaSource"in window,L="MediaSource"in window;return T||L}function m(){var T,L,P;function O(){P=!1}function M(A){A&&A.settings&&(L=A.settings)}function S(){return P}function p(A){P=A}function h(A,x){return x!==l.default.AUDIO&&x!==l.default.VIDEO?Promise.resolve(!0):C(A,x)?I(A,x):v(A)}function C(A,x){return L.get().streaming.capabilities.useMediaCapabilitiesApi&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo&&(A.codec&&x===l.default.AUDIO||x===l.default.VIDEO&&A.codec&&A.width&&A.height&&A.bitrate&&A.framerate)}function v(A){return new Promise(function(x){if(!A||!A.codec){x(!1);return}var F=A.codec;if(A.width&&A.height&&(F+=';width="'+A.width+'";height="'+A.height+'"'),"MediaSource"in window&&MediaSource.isTypeSupported(F)){x(!0);return}else if("WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(F)){x(!0);return}x(!1)})}function I(A,x){return new Promise(function(F){if(!A||!A.codec){F(!1);return}var k={type:"media-source"};k[x]={},k[x].contentType=A.codec,k[x].width=A.width,k[x].height=A.height,k[x].bitrate=parseInt(A.bitrate),k[x].framerate=parseFloat(A.framerate),navigator.mediaCapabilities.decodingInfo(k).then(function(W){F(W.supported)}).catch(function(){F(!1)})})}function D(A){try{return o.THUMBNAILS_SCHEME_ID_URIS.indexOf(A.schemeIdUri)!==-1}catch{return!0}}function y(A,x){for(var F=A.split(".")[0],k=x.indexOf(F)===0,W,V=0;V<c.length;V++)if(c[V].codec===F){W=c[V];break}return W?k||W.compatibleCodecs.some(function(Q){return x.indexOf(Q)===0}):k}return T={setConfig:M,supportsMediaSource:E,supportsEncryptedMedia:S,supportsCodec:h,setEncryptedMediaSupported:p,supportsEssentialProperty:D,codecRootCompatibleWithCodec:y},O(),T}m.__dashjs_factory_name="Capabilities";const f=d.default.getSingletonFactory(m)},"./src/streaming/utils/CapabilitiesFilter.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>f});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js"),l=r("./src/streaming/constants/Constants.js"),c=r("./src/core/EventBus.js"),E=r("./src/core/events/Events.js");function m(){var T=this.context,L=(0,c.default)(T).getInstance(),P,O,M,S,p,h;function C(){h=(0,o.default)(T).getInstance().getLogger(P)}function v(Q){Q&&(Q.adapter&&(O=Q.adapter),Q.capabilities&&(M=Q.capabilities),Q.settings&&(S=Q.settings),Q.customParametersModel&&(p=Q.customParametersModel))}function I(Q){return new Promise(function($){var K=[];K.push(D(l.default.VIDEO,Q)),K.push(D(l.default.AUDIO,Q)),Promise.all(K).then(function(){S.get().streaming.capabilities.filterUnsupportedEssentialProperties&&W(Q),V(Q),$()}).catch(function(){$()})})}function D(Q,$){if(!$||!$.Period_asArray||$.Period_asArray.length===0)return Promise.resolve();var K=[];return $.Period_asArray.forEach(function(Y){K.push(y(Y,Q))}),Promise.all(K)}function y(Q,$){return new Promise(function(K){if(!Q||!Q.AdaptationSet_asArray||Q.AdaptationSet_asArray.length===0){K();return}var Y=[];Q.AdaptationSet_asArray.forEach(function(re){O.getIsTypeOf(re,$)&&Y.push(A(re,$))}),Promise.all(Y).then(function(){Q.AdaptationSet_asArray=Q.AdaptationSet_asArray.filter(function(re){var ie=re.Representation_asArray&&re.Representation_asArray.length>0;return ie||(L.trigger(E.default.ADAPTATION_SET_REMOVED_NO_CAPABILITIES,{adaptationSet:re}),h.warn("AdaptationSet has been removed because of no supported Representation")),ie}),K()}).catch(function(){K()})})}function A(Q,$){return new Promise(function(K){if(!Q.Representation_asArray||Q.Representation_asArray.length===0){K();return}var Y=[],re=[];Q.Representation_asArray.forEach(function(ie,ee){var ne=O.getCodec(Q,ee,!1),ae=x($,ie,ne);re.push(ae),Y.push(M.supportsCodec(ae,$))}),Promise.all(Y).then(function(ie){Q.Representation_asArray=Q.Representation_asArray.filter(function(ee,ne){return ie[ne]||h.debug("[Stream] Codec ".concat(re[ne].codec," not supported ")),ie[ne]}),K()}).catch(function(){K()})})}function x(Q,$,K){switch(Q){case l.default.VIDEO:return F($,K);case l.default.AUDIO:return k($,K);default:return null}}function F(Q,$){var K=Q.width||null,Y=Q.height||null,re=Q.frameRate||null,ie=Q.bandwidth||null;return{codec:$,width:K,height:Y,framerate:re,bitrate:ie}}function k(Q,$){var K=Q.audioSamplingRate||null,Y=Q.bandwidth||null;return{codec:$,bitrate:Y,samplerate:K}}function W(Q){!Q||!Q.Period_asArray||Q.Period_asArray.length===0||Q.Period_asArray.forEach(function($){$.AdaptationSet_asArray=$.AdaptationSet_asArray.filter(function(K){return!K.Representation_asArray||K.Representation_asArray.length===0?!0:(K.Representation_asArray=K.Representation_asArray.filter(function(Y){var re=O.getEssentialPropertiesForRepresentation(Y);if(re&&re.length>0)for(var ie=0;ie<re.length;){if(!M.supportsEssentialProperty(re[ie]))return h.debug("[Stream] EssentialProperty not supported: "+re[ie].schemeIdUri),!1;ie+=1}return!0}),K.Representation_asArray&&K.Representation_asArray.length>0)})})}function V(Q){var $=p.getCustomCapabilitiesFilters();!$||$.length===0||!Q||!Q.Period_asArray||Q.Period_asArray.length===0||Q.Period_asArray.forEach(function(K){K.AdaptationSet_asArray=K.AdaptationSet_asArray.filter(function(Y){return!Y.Representation_asArray||Y.Representation_asArray.length===0?!0:(Y.Representation_asArray=Y.Representation_asArray.filter(function(re){return!$.some(function(ie){return!ie(re)})}),Y.Representation_asArray&&Y.Representation_asArray.length>0)})})}return P={setConfig:v,filterUnsupportedFeatures:I},C(),P}m.__dashjs_factory_name="CapabilitiesFilter";const f=d.default.getSingletonFactory(m)},"./src/streaming/utils/CustomTimeRanges.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/utils/SupervisorTools.js");function l(){var E=[],m=0;function f(S,p){var h=0;for(h=0;h<this.customTimeRangeArray.length&&S>this.customTimeRangeArray[h].start;h++);for(this.customTimeRangeArray.splice(h,0,{start:S,end:p}),h=0;h<this.customTimeRangeArray.length-1;h++)this.mergeRanges(h,h+1)&&h--;this.length=this.customTimeRangeArray.length}function T(){this.customTimeRangeArray=[],this.length=0}function L(S,p){for(var h=0;h<this.customTimeRangeArray.length;h++)if(S<=this.customTimeRangeArray[h].start&&p>=this.customTimeRangeArray[h].end)this.customTimeRangeArray.splice(h,1),h--;else if(S>this.customTimeRangeArray[h].start&&p<this.customTimeRangeArray[h].end){this.customTimeRangeArray.splice(h+1,0,{start:p,end:this.customTimeRangeArray[h].end}),this.customTimeRangeArray[h].end=S;break}else S>this.customTimeRangeArray[h].start&&S<this.customTimeRangeArray[h].end?this.customTimeRangeArray[h].end=S:p>this.customTimeRangeArray[h].start&&p<this.customTimeRangeArray[h].end&&(this.customTimeRangeArray[h].start=p);this.length=this.customTimeRangeArray.length}function P(S,p){var h=this.customTimeRangeArray[S],C=this.customTimeRangeArray[p];return h.start<=C.start&&C.start<=h.end&&h.end<=C.end?(h.end=C.end,this.customTimeRangeArray.splice(p,1),!0):C.start<=h.start&&h.start<=C.end&&C.end<=h.end?(h.start=C.start,this.customTimeRangeArray.splice(p,1),!0):C.start<=h.start&&h.start<=C.end&&h.end<=C.end?(this.customTimeRangeArray.splice(S,1),!0):h.start<=C.start&&C.start<=h.end&&C.end<=h.end?(this.customTimeRangeArray.splice(p,1),!0):!1}function O(S){return(0,o.checkInteger)(S),S>=this.customTimeRangeArray.length||S<0?NaN:this.customTimeRangeArray[S].start}function M(S){return(0,o.checkInteger)(S),S>=this.customTimeRangeArray.length||S<0?NaN:this.customTimeRangeArray[S].end}return{customTimeRangeArray:E,length:m,add:f,clear:T,remove:L,mergeRanges:P,start:O,end:M}}l.__dashjs_factory_name="CustomTimeRanges";const c=d.default.getClassFactory(l)},"./src/streaming/utils/DOMStorage.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js"),l=r("./src/streaming/constants/Constants.js"),c=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],E="dashjs_?_bitrate",m="dashjs_?_settings",f="localStorage",T="sessionStorage",L="lastBitrate",P="lastMediaSettings";function O(p){p=p||{};var h=this.context,C=p.settings,v,I,D;function y(){I=(0,o.default)(h).getInstance().getLogger(v),x()}function A(Y){if(D!==void 0)return D;D=!1;var re="1",ie="1",ee;try{typeof window<"u"&&(ee=window[Y])}catch(ne){return I.warn("DOMStorage access denied: "+ne.message),D}if(!ee||Y!==f&&Y!==T)return D;try{ee.setItem(re,ie),ee.removeItem(re),D=!0}catch(ne){I.warn("DOMStorage is supported, but cannot be used: "+ne.message)}return D}function x(){A(f)&&c.forEach(function(Y){var re=localStorage.getItem(Y.oldKey);if(re){localStorage.removeItem(Y.oldKey);try{localStorage.setItem(Y.newKey,re)}catch(ie){I.error(ie.message)}}})}function F(){var Y=6e5;return Math.round(new Date().getTime()/Y)*Y}function k(Y,re){return A(Y)&&C.get().streaming[re+"CachingInfo"].enabled}function W(){if(!C)throw new Error(l.default.MISSING_CONFIG_ERROR)}function V(Y){if(W(),!C.get().streaming.lastMediaSettingsCachingInfo.enabled)return null;var re=null;if(k(f,P)){var ie=m.replace(/\?/,Y);try{var ee=JSON.parse(localStorage.getItem(ie))||{},ne=new Date().getTime()-parseInt(ee.timestamp,10)>=C.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;re=ee.settings,ne&&(localStorage.removeItem(ie),re=null)}catch{return null}}return re}function Q(Y){if(W(),!C.get().streaming.lastBitrateCachingInfo.enabled)return NaN;var re=NaN;if(k(f,L)){var ie=E.replace(/\?/,Y);try{var ee=JSON.parse(localStorage.getItem(ie))||{},ne=new Date().getTime()-parseInt(ee.timestamp,10)>=C.get().streaming.lastBitrateCachingInfo.ttl||!1,ae=parseFloat(ee.bitrate);!isNaN(ae)&&!ne?(re=ae,I.debug("Last saved bitrate for "+Y+" was "+ae)):ne&&localStorage.removeItem(ie)}catch{return null}}return re}function $(Y,re){if(k(f,P)){var ie=m.replace(/\?/,Y);try{localStorage.setItem(ie,JSON.stringify({settings:re,timestamp:F()}))}catch(ee){I.error(ee.message)}}}function K(Y,re){if(k(f,L)&&re){var ie=E.replace(/\?/,Y);try{localStorage.setItem(ie,JSON.stringify({bitrate:re.toFixed(3),timestamp:F()}))}catch(ee){I.error(ee.message)}}}return v={getSavedBitrateSettings:Q,setSavedBitrateSettings:K,getSavedMediaSettings:V,setSavedMediaSettings:$},y(),v}O.__dashjs_factory_name="DOMStorage";var M=d.default.getSingletonFactory(O);const S=M},"./src/streaming/utils/DefaultURLUtils.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/core/FactoryMaker.js");function o(){var c,E=/^[a-z][a-z0-9+\-_.]*:/i,m=/^https?:\/\//i,f=/^https:\/\//i,T=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,L=function(k,W){try{return new window.URL(k,W).toString()}catch{return k}},P=function(k,W){var V=M;if(!W||!C(k))return k;v(k)&&(V=S),I(k)&&(V=h);var Q=V(W),$=Q.charAt(Q.length-1)!=="/"&&k.charAt(0)!=="/"?"/":"";return[Q,k].join($)};function O(){try{var F=new window.URL("x","http://y");c=L}catch{}finally{c=c||P}}function M(F){var k=F.indexOf("/"),W=F.lastIndexOf("/");return k!==-1?W===k+1?F:(F.indexOf("?")!==-1&&(F=F.substring(0,F.indexOf("?"))),F.substring(0,W+1)):""}function S(F){var k=F.match(T);return k?k[1]:""}function p(F){var k=/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(F);return k[2].substring(1)}function h(F){var k=F.match(E);return k?k[0]:""}function C(F){return!E.test(F)}function v(F){return C(F)&&F.charAt(0)==="/"}function I(F){return F.indexOf("//")===0}function D(F){return m.test(F)}function y(F){return f.test(F)}function A(F,k){return c(F,k)}O();var x={parseBaseUrl:M,parseOrigin:S,parseScheme:h,isRelative:C,isPathAbsolute:v,isSchemeRelative:I,isHTTPURL:D,isHTTPS:y,removeHostname:p,resolve:A};return x}o.__dashjs_factory_name="DefaultURLUtils";const l=d.default.getSingletonFactory(o)},"./src/streaming/utils/EBMLParser.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/core/FactoryMaker.js");function o(c){c=c||{};var E,m=new DataView(c.data),f=0;function T(){return f}function L(I){f=I}function P(I,D){var y=!0,A=0,x,F;if(D===void 0&&(D=!1),I.tag>16777215?(m.getUint32(f)!==I.tag&&(y=!1),A=4):I.tag>65535?(x=m.getUint16(f),F=m.getUint8(f+2),x*256+F!==I.tag&&(y=!1),A=3):I.tag>255?(m.getUint16(f)!==I.tag&&(y=!1),A=2):(m.getUint8(f)!==I.tag&&(y=!1),A=1),!y&&I.required&&!D)throw new Error("required tag not found");return y&&(f+=A),y}function O(I,D){var y=P(I,D);return y&&p(),y}function M(I){var D;return P(I),D=p(),E[I.parse](D)}function S(I,D){var y=P(I,D),A;return y&&(A=p(),f+=A),y}function p(I){var D=1,y=128,A=8,x=-1,F=0,k=m.getUint8(f),W=0;for(W=0;W<A;W+=1){if((k&y)===y){F=I===void 0?k&~y:k,x=W;break}y>>=1}for(W=0;W<x;W+=1,D+=1)F=F<<8|255&m.getUint8(f+D);return f+=D,F}function h(I){var D;switch(I){case 4:D=m.getFloat32(f),f+=4;break;case 8:D=m.getFloat64(f),f+=8;break}return D}function C(I){for(var D=0,y=0;y<I;y+=1)D<<=8,D|=m.getUint8(f+y)&255;return f+=I,D}function v(){return f<m.byteLength}return E={getPos:T,setPos:L,consumeTag:P,consumeTagAndSize:O,parseTag:M,skipOverElement:S,getMatroskaCodedNum:p,getMatroskaFloat:h,getMatroskaUint:C,moreData:v},E}o.__dashjs_factory_name="EBMLParser";const l=d.default.getClassFactory(o)},"./src/streaming/utils/ErrorHandler.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/EventBus.js"),o=r("./src/core/events/Events.js"),l=r("./src/core/FactoryMaker.js");function c(){var m,f=this.context,T=(0,d.default)(f).getInstance();function L(P){T.trigger(o.default.ERROR,{error:P})}return m={error:L},m}c.__dashjs_factory_name="ErrorHandler";const E=l.default.getSingletonFactory(c)},"./src/streaming/utils/InitCache.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/core/FactoryMaker.js");function o(){var c={};function E(L){var P=L.streamId,O=L.representationId;c[P]=c[P]||{},c[P][O]=L}function m(L,P){return c&&c[L]&&c[L][P]?c[L][P]:null}function f(){c={}}var T={save:E,extract:m,reset:f};return T}o.__dashjs_factory_name="InitCache";const l=d.default.getSingletonFactory(o)},"./src/streaming/utils/IsoFile.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/streaming/vo/IsoBox.js"),o=r("./src/core/FactoryMaker.js");function l(){var E,m;function f(M){return!M||!m||!m.boxes||m.boxes.length===0||typeof m.fetch!="function"?null:O(m.fetch(M))}function T(M){var S=[];if(!M||!m||typeof m.fetchAll!="function")return S;for(var p=m.fetchAll(M),h,C=0,v=p.length;C<v;C++)h=O(p[C]),h&&S.push(h);return S}function L(M){m=M}function P(){if(!m||!m.boxes||!m.boxes.length)return null;var M=m.boxes[m.boxes.length-1].type,S=T(M);return S.length>0?S[S.length-1]:null}function O(M){if(!M)return null;var S=new d.default(M);return M.hasOwnProperty("_incomplete")&&(S.isComplete=!M._incomplete),S}return E={getBox:f,getBoxes:T,setData:L,getLastBox:P},E}l.__dashjs_factory_name="IsoFile";const c=o.default.getClassFactory(l)},"./src/streaming/utils/ObjectUtils.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/FactoryMaker.js"),o=r("./node_modules/fast-deep-equal/index.js"),l=r.n(o);function c(){var m;function f(T,L){return l()(T,L)}return m={areEqual:f},m}c.__dashjs_factory_name="ObjectUtils";const E=d.default.getSingletonFactory(c)},"./src/streaming/utils/RequestModifier.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c,modifyRequest:()=>o});var d=r("./src/core/FactoryMaker.js");function o(E,m){var f={url:E.url,method:E.method,headers:Object.assign({},E.headers),credentials:E.withCredentials?"include":void 0};return Promise.resolve(m.modifyRequest(f)).then(function(){return Object.assign(E,f,{withCredentials:f.credentials==="include"})})}function l(){var E;function m(T){return T}function f(T,L){return L.url,T}return E={modifyRequest:null,modifyRequestURL:m,modifyRequestHeader:f},E}l.__dashjs_factory_name="RequestModifier";const c=d.default.getSingletonFactory(l)},"./src/streaming/utils/SegmentResponseModifier.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/core/FactoryMaker.js");function o(){var c;function E(m){return Promise.resolve(m)}return c={modifyResponseAsync:E},c}o.__dashjs_factory_name="SegmentResponseModifier";const l=d.default.getSingletonFactory(o)},"./src/streaming/utils/SupervisorTools.js":(g,i,r)=>{r.r(i),r.d(i,{checkInteger:()=>c,checkIsVideoOrAudioType:()=>m,checkParameterType:()=>l,checkRange:()=>E});var d=r("./src/streaming/constants/Constants.js");function o(f){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(L){return typeof L}:o=function(L){return L&&typeof Symbol=="function"&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L},o(f)}function l(f,T){if(o(f)!==T)throw d.default.BAD_ARGUMENT_ERROR}function c(f){var T=f!==null&&!isNaN(f)&&f%1===0;if(!T)throw d.default.BAD_ARGUMENT_ERROR+" : argument is not an integer"}function E(f,T,L){if(f<T||f>L)throw d.default.BAD_ARGUMENT_ERROR+" : argument out of range"}function m(f){if(typeof f!="string"||f!==d.default.AUDIO&&f!==d.default.VIDEO)throw d.default.BAD_ARGUMENT_ERROR}},"./src/streaming/utils/TTMLParser.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>L});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js"),l=r("./src/core/EventBus.js"),c=r("./src/core/events/Events.js"),E=r("./node_modules/imsc/src/main/js/main.js"),m=r("./src/streaming/MediaPlayerEvents.js"),f=r("./src/streaming/constants/ConformanceViolationConstants.js");function T(){var P=this.context,O=(0,l.default)(P).getInstance(),M,S,p=0;function h(){S=(0,o.default)(P).getInstance().getLogger(M)}function C(){var I="cue_TTML_"+p;return p++,I}function v(I,D,y,A,x){var F="",k=[],W,V,Q,$={},K={},Y="",re="",ie={onOpenTag:function(X,oe,ge){if(ge[" imagetype"]&&!ge[" imageType"]&&(O.trigger(m.default.CONFORMANCE_VIOLATION,{level:f.default.LEVELS.ERROR,event:f.default.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),ge[" imageType"]=ge[" imagetype"]),oe==="image"&&(X==="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"||X==="http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt")){if(!ge[" imageType"]||ge[" imageType"].value!=="PNG"){S.warn("smpte-tt imageType != PNG. Discarded");return}Y=ge["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){Y&&(K[Y]=re.trim()),re="",Y=""},onText:function(X){Y&&(re=re+X)}};if(!I)throw F="no ttml data to parse",new Error(F);$.data=I,O.trigger(c.default.TTML_TO_PARSE,$);var ee=(0,E.fromXML)($.data,function(ce){F=ce},ie);O.trigger(c.default.TTML_PARSED,{ttmlString:$.data,ttmlDoc:ee});var ne=ee.getMediaTimeEvents();for(Q=0;Q<ne.length;Q++){var ae=(0,E.generateISD)(ee,ne[Q],function(ce){F=ce});ae.contents.some(function(ce){return ce.contents.length})&&(W=ne[Q]+D<y?y:ne[Q]+D,V=ne[Q+1]+D>A?A:ne[Q+1]+D,W<V&&k.push({start:W,end:V,type:"html",cueID:C(),isd:ae,images:x,embeddedImages:K}))}if(F!=="")throw S.error(F),new Error(F);return k}return M={parse:v},h(),M}T.__dashjs_factory_name="TTMLParser";const L=d.default.getSingletonFactory(T)},"./src/streaming/utils/URLUtils.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/FactoryMaker.js"),o=r("./src/streaming/utils/DefaultURLUtils.js");function l(){var m,f,T=[],L=this.context;function P(k){var W;for(W=0;W<T.length;W++){var V=T[W].regex;if(V.test(k))return T[W].utils}return f}function O(){f=(0,o.default)(L).getInstance()}function M(k,W){T.push({regex:k,utils:W})}function S(k,W,V){var Q=P(V||W);return Q&&typeof Q[k]=="function"?Q[k](W,V):f[k](W,V)}function p(k){return S("parseBaseUrl",k)}function h(k){return S("parseOrigin",k)}function C(k){return S("removeHostname",k)}function v(k){return S("parseScheme",k)}function I(k){return S("isRelative",k)}function D(k){return S("isPathAbsolute",k)}function y(k){return S("isSchemeRelative",k)}function A(k){return S("isHTTPURL",k)}function x(k){return S("isHTTPS",k)}function F(k,W){return S("resolve",k,W)}return O(),m={registerUrlRegex:M,parseBaseUrl:p,parseOrigin:h,parseScheme:v,isRelative:I,isPathAbsolute:D,isSchemeRelative:y,isHTTPURL:A,isHTTPS:x,removeHostname:C,resolve:F},m}l.__dashjs_factory_name="URLUtils";var c=d.default.getSingletonFactory(l);const E=c},"./src/streaming/utils/VTTParser.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});var d=r("./src/core/FactoryMaker.js"),o=r("./src/core/Debug.js"),l="WEBVTT";function c(){var m=this.context,f,T,L,P,O,M;function S(){T=(0,o.default)(m).getInstance().getLogger(f),L=/(?:\r\n|\r|\n)/gm,P=/-->/,O=/(^[\s]+|[\s]+$)/g,M=/\s\b/g}function p(D){var y=[],A,x;if(!D)return y;D=D.split(L),A=D.length,x=-1;for(var F=0;F<A;F++){var k=D[F];if(k.length>0&&k!==l&&k.match(P)){var W=C(k),V=W.cuePoints,Q=W.styles,$=I(D,F+1),K=h(V[0].replace(O,"")),Y=h(V[1].replace(O,""));!isNaN(K)&&!isNaN(Y)&&K>=x&&Y>K?$!==""?(x=K,y.push({start:K,end:Y,data:$,styles:Q})):T.error("Skipping cue due to empty/malformed cue text"):T.error("Skipping cue due to incorrect cue timing")}}return y}function h(D){var y=D.split(":"),A=y.length-1;return D=parseInt(y[A-1],10)*60+parseFloat(y[A]),A===2&&(D+=parseInt(y[0],10)*3600),D}function C(D){var y=D.split(P),A=y[1].split(M);return A.shift(),y[1]=A[0],A.shift(),{cuePoints:y,styles:v(A)}}function v(D){var y={};return D.forEach(function(A){if(A.split(/:/).length>1){var x=A.split(/:/)[1];x&&x.search(/%/)!=-1&&(x=parseInt(x.replace(/%/,""),10)),(A.match(/align/)||A.match(/A/))&&(y.align=x),(A.match(/line/)||A.match(/L/))&&(y.line=x),(A.match(/position/)||A.match(/P/))&&(y.position=x),(A.match(/size/)||A.match(/S/))&&(y.size=x)}}),y}function I(D,y){for(var A=y,x="",F="",k;D[A]!==""&&A<D.length;)A++;if(k=A-y,k>1)for(var W=0;W<k;W++)if(F=D[y+W],!F.match(P))x+=F,W!==k-1&&(x+=`
`);else{x="";break}else F=D[y],F.match(P)||(x=F);return x}return f={parse:p},S(),f}c.__dashjs_factory_name="VTTParser";const E=d.default.getSingletonFactory(c)},"./src/streaming/utils/VttCustomRenderingParser.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/core/FactoryMaker.js");function o(){var c,E;function m(){try{window&&window.WebVTT&&window.WebVTT.Parser&&(E=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()))}catch{}}function f(T){var L=[];return E.oncue=function(P){P.start=P.startTime,P.end=P.endTime,P.data=P.text,P.styles={align:P.align,line:P.line,position:P.position,size:P.size},L.push(P)},E.parse(T),L}return c={parse:f},m(),c}o.__dashjs_factory_name="VttCustomRenderingParser";const l=d.default.getSingletonFactory(o)},"./src/streaming/utils/baseUrlResolution/BasicSelector.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/core/FactoryMaker.js");function o(c){c=c||{};var E,m=c.blacklistController;function f(T){var L=0,P;return T&&T.some(function(O,M){return L=M,!m.contains(O.serviceLocation)})&&(P=T[L]),P}return E={select:f},E}o.__dashjs_factory_name="BasicSelector";const l=d.default.getClassFactory(o)},"./src/streaming/utils/baseUrlResolution/ContentSteeringSelector.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/core/FactoryMaker.js"),o=r("./src/dash/controllers/ContentSteeringController.js");function l(){var E=this.context,m,f,T;function L(){f=(0,o.default)(E).getInstance()}function P(S){S.blacklistController&&(T=S.blacklistController),S.contentSteeringController&&(f=S.contentSteeringController)}function O(S){var p=NaN;if(isNaN(S.selectedIdx)){var h=f.getSteeringDataFromManifest();h&&h.defaultServiceLocation&&(p=M([h.defaultServiceLocation],S.baseUrls))}var C=f.getCurrentSteeringResponseData();return S.baseUrls&&S.baseUrls.length&&C&&C.serviceLocationPriority&&C.serviceLocationPriority.length&&(p=M(C.serviceLocationPriority,S.baseUrls)),p}function M(){for(var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],h=0,C=NaN,v=function(){var y=S[h],A=p.findIndex(function(x){return x.serviceLocation&&x.serviceLocation===y});if(A!==-1&&!T.contains(p[A].serviceLocation))return C=A,"break";h+=1};h<S.length;){var I=v();if(I==="break")break}return C}return m={selectBaseUrlIndex:O,setConfig:P},L(),m}l.__dashjs_factory_name="ContentSteeringSelector";const c=d.default.getClassFactory(l)},"./src/streaming/utils/baseUrlResolution/DVBSelector.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});var d=r("./src/core/FactoryMaker.js");function o(c){c=c||{};var E,m=c.blacklistController;function f(P){var O=[],M=function(h){return!(O.length&&h.dvb_priority&&O.indexOf(h.dvb_priority)!==-1)},S=function(h){return m.contains(h.serviceLocation)?(h.dvb_priority&&O.push(h.dvb_priority),!1):!0};return P.filter(S).filter(M)}function T(P){var O=function(D,y){var A=D.dvb_priority-y.dvb_priority;return isNaN(A)?0:A},M=function(D,y,A){return!y||A[0].dvb_priority&&D.dvb_priority&&A[0].dvb_priority===D.dvb_priority},S=0,p=[],h=0,C,v;if(v=P.sort(O).filter(M),v.length)return v.length>1&&(v.forEach(function(I){S+=I.dvb_weight,p.push(S)}),C=Math.floor(Math.random()*(S-1)),p.every(function(I,D){return h=D,!(C<I)})),v[h]}function L(P){return P&&T(f(P))}return E={select:L},E}o.__dashjs_factory_name="DVBSelector";const l=d.default.getClassFactory(o)},"./src/streaming/vo/BitrateInfo.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN};const l=o},"./src/streaming/vo/DashJSError.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(E,m,f){d(this,c),this.code=E||null,this.message=m||null,this.data=f||null};const l=o},"./src/streaming/vo/DataChunk.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null};const l=o},"./src/streaming/vo/FragmentRequest.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>m});var d=r("./src/streaming/vo/metrics/HTTPRequest.js");function o(f,T){if(!(f instanceof T))throw new TypeError("Cannot call a class as a function")}function l(f,T){for(var L=0;L<T.length;L++){var P=T[L];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(f,P.key,P)}}function c(f,T,L){return T&&l(f.prototype,T),L&&l(f,L),f}var E=function(){function f(T){o(this,f),this.action=f.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaStartTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=T||null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}return c(f,[{key:"isInitializationRequest",value:function(){return this.type&&this.type===d.HTTPRequest.INIT_SEGMENT_TYPE}},{key:"setInfo",value:function(L){this.type=L&&L.init?d.HTTPRequest.INIT_SEGMENT_TYPE:d.HTTPRequest.MEDIA_SEGMENT_TYPE,this.url=L&&L.url?L.url:null,this.range=L&&L.range?L.range.start+"-"+L.range.end:null,this.mediaType=L&&L.mediaType?L.mediaType:null}}]),f}();E.ACTION_DOWNLOAD="download",E.ACTION_COMPLETE="complete";const m=E},"./src/streaming/vo/HeadRequest.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>M});var d=r("./src/streaming/vo/FragmentRequest.js");function o(S){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(h){return typeof h}:o=function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},o(S)}function l(S,p){if(!(S instanceof p))throw new TypeError("Cannot call a class as a function")}function c(S,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(p&&p.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),p&&E(S,p)}function E(S,p){return E=Object.setPrototypeOf||function(C,v){return C.__proto__=v,C},E(S,p)}function m(S){var p=L();return function(){var C=P(S),v;if(p){var I=P(this).constructor;v=Reflect.construct(C,arguments,I)}else v=C.apply(this,arguments);return f(this,v)}}function f(S,p){return p&&(o(p)==="object"||typeof p=="function")?p:T(S)}function T(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(S){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(h){return h.__proto__||Object.getPrototypeOf(h)},P(S)}var O=function(S){c(h,S);var p=m(h);function h(C){var v;return l(this,h),v=p.call(this,C),v.checkForExistenceOnly=!0,v}return h}(d.default);const M=O},"./src/streaming/vo/IsoBox.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>E});function d(m,f){if(!(m instanceof f))throw new TypeError("Cannot call a class as a function")}function o(m,f){for(var T=0;T<f.length;T++){var L=f[T];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(m,L.key,L)}}function l(m,f,T){return f&&o(m.prototype,f),T&&o(m,T),m}var c=function(){function m(f){if(d(this,m),this.offset=f._offset,this.type=f.type,this.size=f.size,this.boxes=[],f.boxes)for(var T=0;T<f.boxes.length;T++)this.boxes.push(new m(f.boxes[T]));switch(this.isComplete=!0,f.type){case"sidx":if(this.timescale=f.timescale,this.earliest_presentation_time=f.earliest_presentation_time,this.first_offset=f.first_offset,this.references=f.references,f.references){this.references=[];for(var L=0;L<f.references.length;L++){var P={reference_type:f.references[L].reference_type,referenced_size:f.references[L].referenced_size,subsegment_duration:f.references[L].subsegment_duration};this.references.push(P)}}break;case"emsg":this.id=f.id,this.version=f.version===1?1:0,this.value=f.value,this.timescale=f.timescale,this.scheme_id_uri=f.scheme_id_uri,this.presentation_time_delta=f.version===1?f.presentation_time:f.presentation_time_delta,this.event_duration=f.event_duration,this.message_data=f.message_data;break;case"mdhd":this.timescale=f.timescale;break;case"mfhd":this.sequence_number=f.sequence_number;break;case"subs":this.entry_count=f.entry_count,this.entries=f.entries;break;case"tfhd":this.base_data_offset=f.base_data_offset,this.sample_description_index=f.sample_description_index,this.default_sample_duration=f.default_sample_duration,this.default_sample_size=f.default_sample_size,this.default_sample_flags=f.default_sample_flags,this.flags=f.flags;break;case"tfdt":this.version=f.version,this.baseMediaDecodeTime=f.baseMediaDecodeTime,this.flags=f.flags;break;case"trun":if(this.sample_count=f.sample_count,this.first_sample_flags=f.first_sample_flags,this.data_offset=f.data_offset,this.flags=f.flags,this.samples=f.samples,f.samples){this.samples=[];for(var O=0,M=f.samples.length;O<M;O++){var S={sample_size:f.samples[O].sample_size,sample_duration:f.samples[O].sample_duration,sample_composition_time_offset:f.samples[O].sample_composition_time_offset};this.samples.push(S)}}break}}return l(m,[{key:"getChildBox",value:function(T){for(var L=0;L<this.boxes.length;L++)if(this.boxes[L].type===T)return this.boxes[L]}},{key:"getChildBoxes",value:function(T){for(var L=[],P=0;P<this.boxes.length;P++)this.boxes[P].type===T&&L.push(this.boxes[P]);return L}}]),m}();const E=c},"./src/streaming/vo/IsoBoxSearchInfo.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(E,m,f){d(this,c),this.lastCompletedOffset=E,this.found=m,this.size=f};const l=o},"./src/streaming/vo/MetricsList.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]};const l=o},"./src/streaming/vo/TextRequest.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>S});var d=r("./src/streaming/constants/Constants.js"),o=r("./src/streaming/vo/FragmentRequest.js");function l(p){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(C){return typeof C}:l=function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},l(p)}function c(p,h){if(!(p instanceof h))throw new TypeError("Cannot call a class as a function")}function E(p,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(h&&h.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),h&&m(p,h)}function m(p,h){return m=Object.setPrototypeOf||function(v,I){return v.__proto__=I,v},m(p,h)}function f(p){var h=P();return function(){var v=O(p),I;if(h){var D=O(this).constructor;I=Reflect.construct(v,arguments,D)}else I=v.apply(this,arguments);return T(this,I)}}function T(p,h){return h&&(l(h)==="object"||typeof h=="function")?h:L(p)}function L(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function O(p){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},O(p)}var M=function(p){E(C,p);var h=f(C);function C(v,I){var D;return c(this,C),D=h.call(this),D.url=v||null,D.type=I||null,D.mediaType=d.default.STREAM,D.responseType="",D}return C}(o.default);const S=M},"./src/streaming/vo/TextTrackInfo.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>M});var d=r("./src/dash/vo/MediaInfo.js");function o(S){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?o=function(h){return typeof h}:o=function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},o(S)}function l(S,p){if(!(S instanceof p))throw new TypeError("Cannot call a class as a function")}function c(S,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(p&&p.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),p&&E(S,p)}function E(S,p){return E=Object.setPrototypeOf||function(C,v){return C.__proto__=v,C},E(S,p)}function m(S){var p=L();return function(){var C=P(S),v;if(p){var I=P(this).constructor;v=Reflect.construct(C,arguments,I)}else v=C.apply(this,arguments);return f(this,v)}}function f(S,p){return p&&(o(p)==="object"||typeof p=="function")?p:T(S)}function T(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(S){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(h){return h.__proto__||Object.getPrototypeOf(h)},P(S)}var O=function(S){c(h,S);var p=m(h);function h(){var C;return l(this,h),C=p.call(this),C.captionData=null,C.label=null,C.defaultTrack=!1,C.kind=null,C.isFragmented=!1,C.isEmbedded=!1,C.isTTML=null,C}return h}(d.default);const M=O},"./src/streaming/vo/Thumbnail.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null};const l=o},"./src/streaming/vo/ThumbnailTrackInfo.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""};const l=o},"./src/streaming/vo/URIFragmentData.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null};const l=o},"./src/streaming/vo/metrics/BufferLevel.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.t=null,this.level=null};const l=o},"./src/streaming/vo/metrics/BufferState.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>c});var d=r("./src/streaming/constants/MetricsConstants.js");function o(E,m){if(!(E instanceof m))throw new TypeError("Cannot call a class as a function")}var l=function E(){o(this,E),this.target=null,this.state=d.default.BUFFER_EMPTY};const c=l},"./src/streaming/vo/metrics/DVRInfo.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.time=null,this.range=null,this.manifestInfo=null};const l=o},"./src/streaming/vo/metrics/DroppedFrames.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.time=null,this.droppedFrames=null};const l=o},"./src/streaming/vo/metrics/HTTPRequest.js":(g,i,r)=>{r.r(i),r.d(i,{HTTPRequest:()=>o,HTTPRequestTrace:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this.cmsd=null,this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null,this._fileLoaderType=null},l=function c(){d(this,c),this.s=null,this.d=null,this.b=[]};o.GET="GET",o.HEAD="HEAD",o.MPD_TYPE="MPD",o.XLINK_EXPANSION_TYPE="XLinkExpansion",o.INIT_SEGMENT_TYPE="InitializationSegment",o.INDEX_SEGMENT_TYPE="IndexSegment",o.MEDIA_SEGMENT_TYPE="MediaSegment",o.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",o.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",o.DVB_REPORTING_TYPE="DVBReporting",o.LICENSE="license",o.CONTENT_STEERING_TYPE="ContentSteering",o.OTHER_TYPE="other"},"./src/streaming/vo/metrics/ManifestUpdate.js":(g,i,r)=>{r.r(i),r.d(i,{ManifestUpdate:()=>o,ManifestUpdateRepresentationInfo:()=>c,ManifestUpdateStreamInfo:()=>l});function d(E,m){if(!(E instanceof m))throw new TypeError("Cannot call a class as a function")}var o=function E(){d(this,E),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},l=function E(){d(this,E),this.id=null,this.index=null,this.start=null,this.duration=null},c=function E(){d(this,E),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null}},"./src/streaming/vo/metrics/PlayList.js":(g,i,r)=>{r.r(i),r.d(i,{PlayList:()=>o,PlayListTrace:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};o.INITIAL_PLAYOUT_START_REASON="initial_playout",o.SEEK_START_REASON="seek",o.RESUME_FROM_PAUSE_START_REASON="resume",o.METRICS_COLLECTION_START_REASON="metrics_collection_start";var l=function c(){d(this,c),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};l.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",l.REBUFFERING_REASON="rebuffering",l.USER_REQUEST_STOP_REASON="user_request",l.END_OF_PERIOD_STOP_REASON="end_of_period",l.END_OF_CONTENT_STOP_REASON="end_of_content",l.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",l.FAILURE_STOP_REASON="failure"},"./src/streaming/vo/metrics/RepresentationSwitch.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.t=null,this.mt=null,this.to=null,this.lto=null};const l=o},"./src/streaming/vo/metrics/RequestsQueue.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.loadingRequests=[],this.executedRequests=[]};const l=o},"./src/streaming/vo/metrics/SchedulingInfo.js":(g,i,r)=>{r.r(i),r.d(i,{default:()=>l});function d(c,E){if(!(c instanceof E))throw new TypeError("Cannot call a class as a function")}var o=function c(){d(this,c),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null};const l=o},"./node_modules/bcp-47-match/index.js":(g,i)=>{i.basicFilter=l(r,!0),i.extendedFilter=l(d,!0),i.lookup=l(o);function r(E,m){return m==="*"||E===m||E.indexOf(m+"-")>-1}function d(E,m){var f=E.split("-"),T=m.split("-"),L=0,P=0;if(T[P]!=="*"&&f[L]!==T[P])return!1;for(L++,P++;P<T.length;){if(T[P]==="*"){P++;continue}if(!f[L])return!1;if(f[L]===T[P]){L++,P++;continue}if(f[L].length===1)return!1;L++}return!0}function o(E,m){for(var f=m,T;;){if(f==="*"||E===f)return!0;if(T=f.lastIndexOf("-"),T<0)return!1;f.charAt(T-2)==="-"&&(T-=2),f=f.slice(0,T)}}function l(E,m){return f;function f(T,L){for(var P=c(T,"tag"),O=c(L??"*","range"),M=[],S=-1,p,h,C;++S<O.length;)if(p=O[S].toLowerCase(),!(!m&&p==="*")){for(h=-1,C=[];++h<P.length;)if(E(P[h].toLowerCase(),p)){if(!m)return P[h];M.push(P[h])}else C.push(P[h]);P=C}return m?M:void 0}}function c(E,m){var f=E&&typeof E=="string"?[E]:E;if(!f||typeof f!="object"||!("length"in f))throw new Error("Invalid "+m+" `"+f+"`, expected non-empty string");return f}},"./node_modules/bcp-47-normalize/index.js":(g,i,r)=>{g.exports=r("./node_modules/bcp-47-normalize/lib/index.js")},"./node_modules/bcp-47-normalize/lib/index.js":(g,i,r)=>{var d=r("./node_modules/bcp-47/index.js"),o=r("./node_modules/bcp-47-match/index.js"),l=r("./node_modules/bcp-47-normalize/lib/matches.json"),c=r("./node_modules/bcp-47-normalize/lib/fields.json"),E=r("./node_modules/bcp-47-normalize/lib/defaults.json"),m=r("./node_modules/bcp-47-normalize/lib/many.json");g.exports=P;var f={}.hasOwnProperty,T=new Intl.Collator,L={variants:[],extensions:[],privateuse:[],irregular:null,regular:null};function P(h,C){var v=C||{},I=d.parse(String(h||"").toLowerCase(),v),D=d.stringify(I),y=-1,A;if(!D)return D;for(;++y<l.length;)o.extendedFilter(D,l[y].from).length&&(O(I,l[y].from,l[y].to),D=d.stringify(I));for(y=-1;++y<c.length;)M(I,c[y].from.field,c[y].from.value)&&S(I,c[y].to.field,c[y].to.value);for(D=d.stringify(Object.assign({},I,L)),y=-1;++y<E.length;)D===E[y]&&(O(I,E[y],E[y].split("-").slice(0,-1).join("-")),D=d.stringify(Object.assign({},I,L)));if(I.extensions.sort(p),v.warning)for(A in m)f.call(m[A],I[A])&&v.warning("Deprecated "+A+" `"+I[A]+"`, expected one of `"+m[A][I[A]].join("`, `")+"`",null,7);return I.script&&(I.script=I.script.charAt(0).toUpperCase()+I.script.slice(1)),I.region&&(I.region=I.region.toUpperCase()),d.stringify(I)}function O(h,C,v){var I=d.parse(C),D=d.parse(v),y=[],A;for(A in I)I[A]&&I[A].length&&M(h,A,I[A])&&y.push(A);for(A in D)D[A]&&D[A].length&&(y.indexOf(A)>-1||!h[A]||!h[A].length)&&S(h,A,D[A])}function M(h,C,v){var I=!1,D,y,A,x;if(v){if(D=h[C],y=D,D&&typeof D=="object")for(y=[],A=-1;++A<D.length;)x=D[A],v.indexOf(x)<0?y.push(x):I=!0;else D===v&&(y=null,I=!0);h[C]=y}return I}function S(h,C,v){var I=h[C],D,y,A;if(I&&typeof I=="object")for(D=[].concat(v),y=-1;++y<D.length;)A=D[y],I.indexOf(A)<0&&I.push(A);else h[C]=v}function p(h,C){return T.compare(h.singleton,C.singleton)}},"./node_modules/bcp-47/index.js":(g,i,r)=>{i.parse=r("./node_modules/bcp-47/lib/parse.js"),i.stringify=r("./node_modules/bcp-47/lib/stringify.js")},"./node_modules/bcp-47/lib/parse.js":(g,i,r)=>{var d=r("./node_modules/is-alphanumerical/index.js"),o=r("./node_modules/is-alphabetical/index.js"),l=r("./node_modules/is-decimal/index.js"),c=r("./node_modules/bcp-47/lib/regular.json"),E=r("./node_modules/bcp-47/lib/normalize.json");g.exports=f;var m={}.hasOwnProperty;function f(L,P){var O=P||{},M=T(),S=String(L),p=S.toLowerCase(),h=0,C,v,I;if(L==null)throw new Error("Expected string, got `"+L+"`");if(m.call(E,p))return(O.normalize==null||O.normalize)&&E[p]?f(E[p]):(M[c.indexOf(p)===-1?"irregular":"regular"]=S,M);for(;o(p.charCodeAt(h))&&h<9;)h++;if(h>1&&h<9){if(M.language=S.slice(0,h),h<4)for(v=0;p.charCodeAt(h)===45&&o(p.charCodeAt(h+1))&&o(p.charCodeAt(h+2))&&o(p.charCodeAt(h+3))&&!o(p.charCodeAt(h+4));){if(v>2)return D(h,3,"Too many extended language subtags, expected at most 3 subtags");M.extendedLanguageSubtags.push(S.slice(h+1,h+4)),h+=4,v++}for(p.charCodeAt(h)===45&&o(p.charCodeAt(h+1))&&o(p.charCodeAt(h+2))&&o(p.charCodeAt(h+3))&&o(p.charCodeAt(h+4))&&!o(p.charCodeAt(h+5))&&(M.script=S.slice(h+1,h+5),h+=5),p.charCodeAt(h)===45&&(o(p.charCodeAt(h+1))&&o(p.charCodeAt(h+2))&&!o(p.charCodeAt(h+3))?(M.region=S.slice(h+1,h+3),h+=3):l(p.charCodeAt(h+1))&&l(p.charCodeAt(h+2))&&l(p.charCodeAt(h+3))&&!l(p.charCodeAt(h+4))&&(M.region=S.slice(h+1,h+4),h+=4));p.charCodeAt(h)===45;){for(I=C=h+1;d(p.charCodeAt(I));){if(I-C>7)return D(I,1,"Too long variant, expected at most 8 characters");I++}if(I-C>4||I-C>3&&l(p.charCodeAt(C)))M.variants.push(S.slice(C,I)),h=I;else break}for(;p.charCodeAt(h)===45&&!(p.charCodeAt(h+1)===120||!d(p.charCodeAt(h+1))||p.charCodeAt(h+2)!==45||!d(p.charCodeAt(h+3)));){for(I=h+2,v=0;p.charCodeAt(I)===45&&d(p.charCodeAt(I+1))&&d(p.charCodeAt(I+2));)for(C=I+1,I=C+2,v++;d(p.charCodeAt(I));){if(I-C>7)return D(I,2,"Too long extension, expected at most 8 characters");I++}if(!v)return D(I,4,"Empty extension, extensions must have at least 2 characters of content");M.extensions.push({singleton:S.charAt(h+1),extensions:S.slice(h+3,I).split("-")}),h=I}}else h=0;if(h===0&&p.charCodeAt(h)===120||p.charCodeAt(h)===45&&p.charCodeAt(h+1)===120)for(I=h=h?h+2:1;p.charCodeAt(I)===45&&d(p.charCodeAt(I+1));){for(I=C=h+1;d(p.charCodeAt(I));){if(I-C>7)return D(I,5,"Too long private-use area, expected at most 8 characters");I++}M.privateuse.push(S.slice(h+1,I)),h=I}if(h!==S.length)return D(h,6,"Found superfluous content after tag");return M;function D(y,A,x){return O.warning&&O.warning(x,A,y),O.forgiving?M:T()}}function T(){return{language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null}}},"./node_modules/bcp-47/lib/stringify.js":g=>{g.exports=i;function i(r){var d=r||{},o=[],l,c,E;if(d.irregular||d.regular)return d.irregular||d.regular;if(d.language)for(o=o.concat(d.language,d.extendedLanguageSubtags||[],d.script||[],d.region||[],d.variants||[]),l=d.extensions||[],c=-1;++c<l.length;)E=l[c],E.singleton&&E.extensions&&E.extensions.length&&(o=o.concat(E.singleton,E.extensions));return d.privateuse&&d.privateuse.length&&(o=o.concat("x",d.privateuse)),o.join("-")}},"./node_modules/buffer/index.js":(g,i,r)=>{/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var d=r("./node_modules/buffer/node_modules/base64-js/index.js"),o=r("./node_modules/buffer/node_modules/ieee754/index.js"),l=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;i.Buffer=f,i.SlowBuffer=I,i.INSPECT_MAX_BYTES=50;var c=2147483647;i.kMaxLength=c,f.TYPED_ARRAY_SUPPORT=E(),!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function E(){try{var U=new Uint8Array(1),B={foo:function(){return 42}};return Object.setPrototypeOf(B,Uint8Array.prototype),Object.setPrototypeOf(U,B),U.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function m(U){if(U>c)throw new RangeError('The value "'+U+'" is invalid for option "size"');var B=new Uint8Array(U);return Object.setPrototypeOf(B,f.prototype),B}function f(U,B,G){if(typeof U=="number"){if(typeof B=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return O(U)}return T(U,B,G)}f.poolSize=8192;function T(U,B,G){if(typeof U=="string")return M(U,B);if(ArrayBuffer.isView(U))return p(U);if(U==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U);if(w(U,ArrayBuffer)||U&&w(U.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(w(U,SharedArrayBuffer)||U&&w(U.buffer,SharedArrayBuffer)))return h(U,B,G);if(typeof U=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var z=U.valueOf&&U.valueOf();if(z!=null&&z!==U)return f.from(z,B,G);var fe=C(U);if(fe)return fe;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof U[Symbol.toPrimitive]=="function")return f.from(U[Symbol.toPrimitive]("string"),B,G);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof U)}f.from=function(U,B,G){return T(U,B,G)},Object.setPrototypeOf(f.prototype,Uint8Array.prototype),Object.setPrototypeOf(f,Uint8Array);function L(U){if(typeof U!="number")throw new TypeError('"size" argument must be of type number');if(U<0)throw new RangeError('The value "'+U+'" is invalid for option "size"')}function P(U,B,G){return L(U),U<=0?m(U):B!==void 0?typeof G=="string"?m(U).fill(B,G):m(U).fill(B):m(U)}f.alloc=function(U,B,G){return P(U,B,G)};function O(U){return L(U),m(U<0?0:v(U)|0)}f.allocUnsafe=function(U){return O(U)},f.allocUnsafeSlow=function(U){return O(U)};function M(U,B){if((typeof B!="string"||B==="")&&(B="utf8"),!f.isEncoding(B))throw new TypeError("Unknown encoding: "+B);var G=D(U,B)|0,z=m(G),fe=z.write(U,B);return fe!==G&&(z=z.slice(0,fe)),z}function S(U){for(var B=U.length<0?0:v(U.length)|0,G=m(B),z=0;z<B;z+=1)G[z]=U[z]&255;return G}function p(U){if(w(U,Uint8Array)){var B=new Uint8Array(U);return h(B.buffer,B.byteOffset,B.byteLength)}return S(U)}function h(U,B,G){if(B<0||U.byteLength<B)throw new RangeError('"offset" is outside of buffer bounds');if(U.byteLength<B+(G||0))throw new RangeError('"length" is outside of buffer bounds');var z;return B===void 0&&G===void 0?z=new Uint8Array(U):G===void 0?z=new Uint8Array(U,B):z=new Uint8Array(U,B,G),Object.setPrototypeOf(z,f.prototype),z}function C(U){if(f.isBuffer(U)){var B=v(U.length)|0,G=m(B);return G.length===0||U.copy(G,0,0,B),G}if(U.length!==void 0)return typeof U.length!="number"||j(U.length)?m(0):S(U);if(U.type==="Buffer"&&Array.isArray(U.data))return S(U.data)}function v(U){if(U>=c)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+c.toString(16)+" bytes");return U|0}function I(U){return+U!=U&&(U=0),f.alloc(+U)}f.isBuffer=function(B){return B!=null&&B._isBuffer===!0&&B!==f.prototype},f.compare=function(B,G){if(w(B,Uint8Array)&&(B=f.from(B,B.offset,B.byteLength)),w(G,Uint8Array)&&(G=f.from(G,G.offset,G.byteLength)),!f.isBuffer(B)||!f.isBuffer(G))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(B===G)return 0;for(var z=B.length,fe=G.length,ue=0,J=Math.min(z,fe);ue<J;++ue)if(B[ue]!==G[ue]){z=B[ue],fe=G[ue];break}return z<fe?-1:fe<z?1:0},f.isEncoding=function(B){switch(String(B).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(B,G){if(!Array.isArray(B))throw new TypeError('"list" argument must be an Array of Buffers');if(B.length===0)return f.alloc(0);var z;if(G===void 0)for(G=0,z=0;z<B.length;++z)G+=B[z].length;var fe=f.allocUnsafe(G),ue=0;for(z=0;z<B.length;++z){var J=B[z];if(w(J,Uint8Array))ue+J.length>fe.length?f.from(J).copy(fe,ue):Uint8Array.prototype.set.call(fe,J,ue);else if(f.isBuffer(J))J.copy(fe,ue);else throw new TypeError('"list" argument must be an Array of Buffers');ue+=J.length}return fe};function D(U,B){if(f.isBuffer(U))return U.length;if(ArrayBuffer.isView(U)||w(U,ArrayBuffer))return U.byteLength;if(typeof U!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof U);var G=U.length,z=arguments.length>2&&arguments[2]===!0;if(!z&&G===0)return 0;for(var fe=!1;;)switch(B){case"ascii":case"latin1":case"binary":return G;case"utf8":case"utf-8":return q(U).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G*2;case"hex":return G>>>1;case"base64":return N(U).length;default:if(fe)return z?-1:q(U).length;B=(""+B).toLowerCase(),fe=!0}}f.byteLength=D;function y(U,B,G){var z=!1;if((B===void 0||B<0)&&(B=0),B>this.length||((G===void 0||G>this.length)&&(G=this.length),G<=0)||(G>>>=0,B>>>=0,G<=B))return"";for(U||(U="utf8");;)switch(U){case"hex":return ae(this,B,G);case"utf8":case"utf-8":return Y(this,B,G);case"ascii":return ee(this,B,G);case"latin1":case"binary":return ne(this,B,G);case"base64":return K(this,B,G);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ce(this,B,G);default:if(z)throw new TypeError("Unknown encoding: "+U);U=(U+"").toLowerCase(),z=!0}}f.prototype._isBuffer=!0;function A(U,B,G){var z=U[B];U[B]=U[G],U[G]=z}f.prototype.swap16=function(){var B=this.length;if(B%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var G=0;G<B;G+=2)A(this,G,G+1);return this},f.prototype.swap32=function(){var B=this.length;if(B%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var G=0;G<B;G+=4)A(this,G,G+3),A(this,G+1,G+2);return this},f.prototype.swap64=function(){var B=this.length;if(B%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var G=0;G<B;G+=8)A(this,G,G+7),A(this,G+1,G+6),A(this,G+2,G+5),A(this,G+3,G+4);return this},f.prototype.toString=function(){var B=this.length;return B===0?"":arguments.length===0?Y(this,0,B):y.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(B){if(!f.isBuffer(B))throw new TypeError("Argument must be a Buffer");return this===B?!0:f.compare(this,B)===0},f.prototype.inspect=function(){var B="",G=i.INSPECT_MAX_BYTES;return B=this.toString("hex",0,G).replace(/(.{2})/g,"$1 ").trim(),this.length>G&&(B+=" ... "),"<Buffer "+B+">"},l&&(f.prototype[l]=f.prototype.inspect),f.prototype.compare=function(B,G,z,fe,ue){if(w(B,Uint8Array)&&(B=f.from(B,B.offset,B.byteLength)),!f.isBuffer(B))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof B);if(G===void 0&&(G=0),z===void 0&&(z=B?B.length:0),fe===void 0&&(fe=0),ue===void 0&&(ue=this.length),G<0||z>B.length||fe<0||ue>this.length)throw new RangeError("out of range index");if(fe>=ue&&G>=z)return 0;if(fe>=ue)return-1;if(G>=z)return 1;if(G>>>=0,z>>>=0,fe>>>=0,ue>>>=0,this===B)return 0;for(var J=ue-fe,ve=z-G,me=Math.min(J,ve),Ae=this.slice(fe,ue),be=B.slice(G,z),Be=0;Be<me;++Be)if(Ae[Be]!==be[Be]){J=Ae[Be],ve=be[Be];break}return J<ve?-1:ve<J?1:0};function x(U,B,G,z,fe){if(U.length===0)return-1;if(typeof G=="string"?(z=G,G=0):G>2147483647?G=2147483647:G<-2147483648&&(G=-2147483648),G=+G,j(G)&&(G=fe?0:U.length-1),G<0&&(G=U.length+G),G>=U.length){if(fe)return-1;G=U.length-1}else if(G<0)if(fe)G=0;else return-1;if(typeof B=="string"&&(B=f.from(B,z)),f.isBuffer(B))return B.length===0?-1:F(U,B,G,z,fe);if(typeof B=="number")return B=B&255,typeof Uint8Array.prototype.indexOf=="function"?fe?Uint8Array.prototype.indexOf.call(U,B,G):Uint8Array.prototype.lastIndexOf.call(U,B,G):F(U,[B],G,z,fe);throw new TypeError("val must be string, number or Buffer")}function F(U,B,G,z,fe){var ue=1,J=U.length,ve=B.length;if(z!==void 0&&(z=String(z).toLowerCase(),z==="ucs2"||z==="ucs-2"||z==="utf16le"||z==="utf-16le")){if(U.length<2||B.length<2)return-1;ue=2,J/=2,ve/=2,G/=2}function me(Ye,Oe){return ue===1?Ye[Oe]:Ye.readUInt16BE(Oe*ue)}var Ae;if(fe){var be=-1;for(Ae=G;Ae<J;Ae++)if(me(U,Ae)===me(B,be===-1?0:Ae-be)){if(be===-1&&(be=Ae),Ae-be+1===ve)return be*ue}else be!==-1&&(Ae-=Ae-be),be=-1}else for(G+ve>J&&(G=J-ve),Ae=G;Ae>=0;Ae--){for(var Be=!0,ke=0;ke<ve;ke++)if(me(U,Ae+ke)!==me(B,ke)){Be=!1;break}if(Be)return Ae}return-1}f.prototype.includes=function(B,G,z){return this.indexOf(B,G,z)!==-1},f.prototype.indexOf=function(B,G,z){return x(this,B,G,z,!0)},f.prototype.lastIndexOf=function(B,G,z){return x(this,B,G,z,!1)};function k(U,B,G,z){G=Number(G)||0;var fe=U.length-G;z?(z=Number(z),z>fe&&(z=fe)):z=fe;var ue=B.length;z>ue/2&&(z=ue/2);for(var J=0;J<z;++J){var ve=parseInt(B.substr(J*2,2),16);if(j(ve))return J;U[G+J]=ve}return J}function W(U,B,G,z){return R(q(B,U.length-G),U,G,z)}function V(U,B,G,z){return R(le(B),U,G,z)}function Q(U,B,G,z){return R(N(B),U,G,z)}function $(U,B,G,z){return R(te(B,U.length-G),U,G,z)}f.prototype.write=function(B,G,z,fe){if(G===void 0)fe="utf8",z=this.length,G=0;else if(z===void 0&&typeof G=="string")fe=G,z=this.length,G=0;else if(isFinite(G))G=G>>>0,isFinite(z)?(z=z>>>0,fe===void 0&&(fe="utf8")):(fe=z,z=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var ue=this.length-G;if((z===void 0||z>ue)&&(z=ue),B.length>0&&(z<0||G<0)||G>this.length)throw new RangeError("Attempt to write outside buffer bounds");fe||(fe="utf8");for(var J=!1;;)switch(fe){case"hex":return k(this,B,G,z);case"utf8":case"utf-8":return W(this,B,G,z);case"ascii":case"latin1":case"binary":return V(this,B,G,z);case"base64":return Q(this,B,G,z);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,B,G,z);default:if(J)throw new TypeError("Unknown encoding: "+fe);fe=(""+fe).toLowerCase(),J=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function K(U,B,G){return B===0&&G===U.length?d.fromByteArray(U):d.fromByteArray(U.slice(B,G))}function Y(U,B,G){G=Math.min(U.length,G);for(var z=[],fe=B;fe<G;){var ue=U[fe],J=null,ve=ue>239?4:ue>223?3:ue>191?2:1;if(fe+ve<=G){var me,Ae,be,Be;switch(ve){case 1:ue<128&&(J=ue);break;case 2:me=U[fe+1],(me&192)===128&&(Be=(ue&31)<<6|me&63,Be>127&&(J=Be));break;case 3:me=U[fe+1],Ae=U[fe+2],(me&192)===128&&(Ae&192)===128&&(Be=(ue&15)<<12|(me&63)<<6|Ae&63,Be>2047&&(Be<55296||Be>57343)&&(J=Be));break;case 4:me=U[fe+1],Ae=U[fe+2],be=U[fe+3],(me&192)===128&&(Ae&192)===128&&(be&192)===128&&(Be=(ue&15)<<18|(me&63)<<12|(Ae&63)<<6|be&63,Be>65535&&Be<1114112&&(J=Be))}}J===null?(J=65533,ve=1):J>65535&&(J-=65536,z.push(J>>>10&1023|55296),J=56320|J&1023),z.push(J),fe+=ve}return ie(z)}var re=4096;function ie(U){var B=U.length;if(B<=re)return String.fromCharCode.apply(String,U);for(var G="",z=0;z<B;)G+=String.fromCharCode.apply(String,U.slice(z,z+=re));return G}function ee(U,B,G){var z="";G=Math.min(U.length,G);for(var fe=B;fe<G;++fe)z+=String.fromCharCode(U[fe]&127);return z}function ne(U,B,G){var z="";G=Math.min(U.length,G);for(var fe=B;fe<G;++fe)z+=String.fromCharCode(U[fe]);return z}function ae(U,B,G){var z=U.length;(!B||B<0)&&(B=0),(!G||G<0||G>z)&&(G=z);for(var fe="",ue=B;ue<G;++ue)fe+=H[U[ue]];return fe}function ce(U,B,G){for(var z=U.slice(B,G),fe="",ue=0;ue<z.length-1;ue+=2)fe+=String.fromCharCode(z[ue]+z[ue+1]*256);return fe}f.prototype.slice=function(B,G){var z=this.length;B=~~B,G=G===void 0?z:~~G,B<0?(B+=z,B<0&&(B=0)):B>z&&(B=z),G<0?(G+=z,G<0&&(G=0)):G>z&&(G=z),G<B&&(G=B);var fe=this.subarray(B,G);return Object.setPrototypeOf(fe,f.prototype),fe};function X(U,B,G){if(U%1!==0||U<0)throw new RangeError("offset is not uint");if(U+B>G)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(B,G,z){B=B>>>0,G=G>>>0,z||X(B,G,this.length);for(var fe=this[B],ue=1,J=0;++J<G&&(ue*=256);)fe+=this[B+J]*ue;return fe},f.prototype.readUintBE=f.prototype.readUIntBE=function(B,G,z){B=B>>>0,G=G>>>0,z||X(B,G,this.length);for(var fe=this[B+--G],ue=1;G>0&&(ue*=256);)fe+=this[B+--G]*ue;return fe},f.prototype.readUint8=f.prototype.readUInt8=function(B,G){return B=B>>>0,G||X(B,1,this.length),this[B]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(B,G){return B=B>>>0,G||X(B,2,this.length),this[B]|this[B+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(B,G){return B=B>>>0,G||X(B,2,this.length),this[B]<<8|this[B+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(B,G){return B=B>>>0,G||X(B,4,this.length),(this[B]|this[B+1]<<8|this[B+2]<<16)+this[B+3]*16777216},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(B,G){return B=B>>>0,G||X(B,4,this.length),this[B]*16777216+(this[B+1]<<16|this[B+2]<<8|this[B+3])},f.prototype.readIntLE=function(B,G,z){B=B>>>0,G=G>>>0,z||X(B,G,this.length);for(var fe=this[B],ue=1,J=0;++J<G&&(ue*=256);)fe+=this[B+J]*ue;return ue*=128,fe>=ue&&(fe-=Math.pow(2,8*G)),fe},f.prototype.readIntBE=function(B,G,z){B=B>>>0,G=G>>>0,z||X(B,G,this.length);for(var fe=G,ue=1,J=this[B+--fe];fe>0&&(ue*=256);)J+=this[B+--fe]*ue;return ue*=128,J>=ue&&(J-=Math.pow(2,8*G)),J},f.prototype.readInt8=function(B,G){return B=B>>>0,G||X(B,1,this.length),this[B]&128?(255-this[B]+1)*-1:this[B]},f.prototype.readInt16LE=function(B,G){B=B>>>0,G||X(B,2,this.length);var z=this[B]|this[B+1]<<8;return z&32768?z|4294901760:z},f.prototype.readInt16BE=function(B,G){B=B>>>0,G||X(B,2,this.length);var z=this[B+1]|this[B]<<8;return z&32768?z|4294901760:z},f.prototype.readInt32LE=function(B,G){return B=B>>>0,G||X(B,4,this.length),this[B]|this[B+1]<<8|this[B+2]<<16|this[B+3]<<24},f.prototype.readInt32BE=function(B,G){return B=B>>>0,G||X(B,4,this.length),this[B]<<24|this[B+1]<<16|this[B+2]<<8|this[B+3]},f.prototype.readFloatLE=function(B,G){return B=B>>>0,G||X(B,4,this.length),o.read(this,B,!0,23,4)},f.prototype.readFloatBE=function(B,G){return B=B>>>0,G||X(B,4,this.length),o.read(this,B,!1,23,4)},f.prototype.readDoubleLE=function(B,G){return B=B>>>0,G||X(B,8,this.length),o.read(this,B,!0,52,8)},f.prototype.readDoubleBE=function(B,G){return B=B>>>0,G||X(B,8,this.length),o.read(this,B,!1,52,8)};function oe(U,B,G,z,fe,ue){if(!f.isBuffer(U))throw new TypeError('"buffer" argument must be a Buffer instance');if(B>fe||B<ue)throw new RangeError('"value" argument is out of bounds');if(G+z>U.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(B,G,z,fe){if(B=+B,G=G>>>0,z=z>>>0,!fe){var ue=Math.pow(2,8*z)-1;oe(this,B,G,z,ue,0)}var J=1,ve=0;for(this[G]=B&255;++ve<z&&(J*=256);)this[G+ve]=B/J&255;return G+z},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(B,G,z,fe){if(B=+B,G=G>>>0,z=z>>>0,!fe){var ue=Math.pow(2,8*z)-1;oe(this,B,G,z,ue,0)}var J=z-1,ve=1;for(this[G+J]=B&255;--J>=0&&(ve*=256);)this[G+J]=B/ve&255;return G+z},f.prototype.writeUint8=f.prototype.writeUInt8=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,1,255,0),this[G]=B&255,G+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,2,65535,0),this[G]=B&255,this[G+1]=B>>>8,G+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,2,65535,0),this[G]=B>>>8,this[G+1]=B&255,G+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,4,4294967295,0),this[G+3]=B>>>24,this[G+2]=B>>>16,this[G+1]=B>>>8,this[G]=B&255,G+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,4,4294967295,0),this[G]=B>>>24,this[G+1]=B>>>16,this[G+2]=B>>>8,this[G+3]=B&255,G+4},f.prototype.writeIntLE=function(B,G,z,fe){if(B=+B,G=G>>>0,!fe){var ue=Math.pow(2,8*z-1);oe(this,B,G,z,ue-1,-ue)}var J=0,ve=1,me=0;for(this[G]=B&255;++J<z&&(ve*=256);)B<0&&me===0&&this[G+J-1]!==0&&(me=1),this[G+J]=(B/ve>>0)-me&255;return G+z},f.prototype.writeIntBE=function(B,G,z,fe){if(B=+B,G=G>>>0,!fe){var ue=Math.pow(2,8*z-1);oe(this,B,G,z,ue-1,-ue)}var J=z-1,ve=1,me=0;for(this[G+J]=B&255;--J>=0&&(ve*=256);)B<0&&me===0&&this[G+J+1]!==0&&(me=1),this[G+J]=(B/ve>>0)-me&255;return G+z},f.prototype.writeInt8=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,1,127,-128),B<0&&(B=255+B+1),this[G]=B&255,G+1},f.prototype.writeInt16LE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,2,32767,-32768),this[G]=B&255,this[G+1]=B>>>8,G+2},f.prototype.writeInt16BE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,2,32767,-32768),this[G]=B>>>8,this[G+1]=B&255,G+2},f.prototype.writeInt32LE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,4,2147483647,-2147483648),this[G]=B&255,this[G+1]=B>>>8,this[G+2]=B>>>16,this[G+3]=B>>>24,G+4},f.prototype.writeInt32BE=function(B,G,z){return B=+B,G=G>>>0,z||oe(this,B,G,4,2147483647,-2147483648),B<0&&(B=4294967295+B+1),this[G]=B>>>24,this[G+1]=B>>>16,this[G+2]=B>>>8,this[G+3]=B&255,G+4};function ge(U,B,G,z,fe,ue){if(G+z>U.length)throw new RangeError("Index out of range");if(G<0)throw new RangeError("Index out of range")}function _e(U,B,G,z,fe){return B=+B,G=G>>>0,fe||ge(U,B,G,4),o.write(U,B,G,z,23,4),G+4}f.prototype.writeFloatLE=function(B,G,z){return _e(this,B,G,!0,z)},f.prototype.writeFloatBE=function(B,G,z){return _e(this,B,G,!1,z)};function he(U,B,G,z,fe){return B=+B,G=G>>>0,fe||ge(U,B,G,8),o.write(U,B,G,z,52,8),G+8}f.prototype.writeDoubleLE=function(B,G,z){return he(this,B,G,!0,z)},f.prototype.writeDoubleBE=function(B,G,z){return he(this,B,G,!1,z)},f.prototype.copy=function(B,G,z,fe){if(!f.isBuffer(B))throw new TypeError("argument should be a Buffer");if(z||(z=0),!fe&&fe!==0&&(fe=this.length),G>=B.length&&(G=B.length),G||(G=0),fe>0&&fe<z&&(fe=z),fe===z||B.length===0||this.length===0)return 0;if(G<0)throw new RangeError("targetStart out of bounds");if(z<0||z>=this.length)throw new RangeError("Index out of range");if(fe<0)throw new RangeError("sourceEnd out of bounds");fe>this.length&&(fe=this.length),B.length-G<fe-z&&(fe=B.length-G+z);var ue=fe-z;return this===B&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(G,z,fe):Uint8Array.prototype.set.call(B,this.subarray(z,fe),G),ue},f.prototype.fill=function(B,G,z,fe){if(typeof B=="string"){if(typeof G=="string"?(fe=G,G=0,z=this.length):typeof z=="string"&&(fe=z,z=this.length),fe!==void 0&&typeof fe!="string")throw new TypeError("encoding must be a string");if(typeof fe=="string"&&!f.isEncoding(fe))throw new TypeError("Unknown encoding: "+fe);if(B.length===1){var ue=B.charCodeAt(0);(fe==="utf8"&&ue<128||fe==="latin1")&&(B=ue)}}else typeof B=="number"?B=B&255:typeof B=="boolean"&&(B=Number(B));if(G<0||this.length<G||this.length<z)throw new RangeError("Out of range index");if(z<=G)return this;G=G>>>0,z=z===void 0?this.length:z>>>0,B||(B=0);var J;if(typeof B=="number")for(J=G;J<z;++J)this[J]=B;else{var ve=f.isBuffer(B)?B:f.from(B,fe),me=ve.length;if(me===0)throw new TypeError('The value "'+B+'" is invalid for argument "value"');for(J=0;J<z-G;++J)this[J+G]=ve[J%me]}return this};var se=/[^+/0-9A-Za-z-_]/g;function Z(U){if(U=U.split("=")[0],U=U.trim().replace(se,""),U.length<2)return"";for(;U.length%4!==0;)U=U+"=";return U}function q(U,B){B=B||1/0;for(var G,z=U.length,fe=null,ue=[],J=0;J<z;++J){if(G=U.charCodeAt(J),G>55295&&G<57344){if(!fe){if(G>56319){(B-=3)>-1&&ue.push(239,191,189);continue}else if(J+1===z){(B-=3)>-1&&ue.push(239,191,189);continue}fe=G;continue}if(G<56320){(B-=3)>-1&&ue.push(239,191,189),fe=G;continue}G=(fe-55296<<10|G-56320)+65536}else fe&&(B-=3)>-1&&ue.push(239,191,189);if(fe=null,G<128){if((B-=1)<0)break;ue.push(G)}else if(G<2048){if((B-=2)<0)break;ue.push(G>>6|192,G&63|128)}else if(G<65536){if((B-=3)<0)break;ue.push(G>>12|224,G>>6&63|128,G&63|128)}else if(G<1114112){if((B-=4)<0)break;ue.push(G>>18|240,G>>12&63|128,G>>6&63|128,G&63|128)}else throw new Error("Invalid code point")}return ue}function le(U){for(var B=[],G=0;G<U.length;++G)B.push(U.charCodeAt(G)&255);return B}function te(U,B){for(var G,z,fe,ue=[],J=0;J<U.length&&!((B-=2)<0);++J)G=U.charCodeAt(J),z=G>>8,fe=G%256,ue.push(fe),ue.push(z);return ue}function N(U){return d.toByteArray(Z(U))}function R(U,B,G,z){for(var fe=0;fe<z&&!(fe+G>=B.length||fe>=U.length);++fe)B[fe+G]=U[fe];return fe}function w(U,B){return U instanceof B||U!=null&&U.constructor!=null&&U.constructor.name!=null&&U.constructor.name===B.name}function j(U){return U!==U}var H=function(){for(var U="0123456789abcdef",B=new Array(256),G=0;G<16;++G)for(var z=G*16,fe=0;fe<16;++fe)B[z+fe]=U[G]+U[fe];return B}()},"./node_modules/buffer/node_modules/base64-js/index.js":(g,i)=>{i.byteLength=f,i.toByteArray=L,i.fromByteArray=M;for(var r=[],d=[],o=typeof Uint8Array<"u"?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,E=l.length;c<E;++c)r[c]=l[c],d[l.charCodeAt(c)]=c;d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63;function m(S){var p=S.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var h=S.indexOf("=");h===-1&&(h=p);var C=h===p?0:4-h%4;return[h,C]}function f(S){var p=m(S),h=p[0],C=p[1];return(h+C)*3/4-C}function T(S,p,h){return(p+h)*3/4-h}function L(S){var p,h=m(S),C=h[0],v=h[1],I=new o(T(S,C,v)),D=0,y=v>0?C-4:C,A;for(A=0;A<y;A+=4)p=d[S.charCodeAt(A)]<<18|d[S.charCodeAt(A+1)]<<12|d[S.charCodeAt(A+2)]<<6|d[S.charCodeAt(A+3)],I[D++]=p>>16&255,I[D++]=p>>8&255,I[D++]=p&255;return v===2&&(p=d[S.charCodeAt(A)]<<2|d[S.charCodeAt(A+1)]>>4,I[D++]=p&255),v===1&&(p=d[S.charCodeAt(A)]<<10|d[S.charCodeAt(A+1)]<<4|d[S.charCodeAt(A+2)]>>2,I[D++]=p>>8&255,I[D++]=p&255),I}function P(S){return r[S>>18&63]+r[S>>12&63]+r[S>>6&63]+r[S&63]}function O(S,p,h){for(var C,v=[],I=p;I<h;I+=3)C=(S[I]<<16&16711680)+(S[I+1]<<8&65280)+(S[I+2]&255),v.push(P(C));return v.join("")}function M(S){for(var p,h=S.length,C=h%3,v=[],I=16383,D=0,y=h-C;D<y;D+=I)v.push(O(S,D,D+I>y?y:D+I));return C===1?(p=S[h-1],v.push(r[p>>2]+r[p<<4&63]+"==")):C===2&&(p=(S[h-2]<<8)+S[h-1],v.push(r[p>>10]+r[p>>4&63]+r[p<<2&63]+"=")),v.join("")}},"./node_modules/buffer/node_modules/ieee754/index.js":(g,i)=>{/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */i.read=function(r,d,o,l,c){var E,m,f=c*8-l-1,T=(1<<f)-1,L=T>>1,P=-7,O=o?c-1:0,M=o?-1:1,S=r[d+O];for(O+=M,E=S&(1<<-P)-1,S>>=-P,P+=f;P>0;E=E*256+r[d+O],O+=M,P-=8);for(m=E&(1<<-P)-1,E>>=-P,P+=l;P>0;m=m*256+r[d+O],O+=M,P-=8);if(E===0)E=1-L;else{if(E===T)return m?NaN:(S?-1:1)*(1/0);m=m+Math.pow(2,l),E=E-L}return(S?-1:1)*m*Math.pow(2,E-l)},i.write=function(r,d,o,l,c,E){var m,f,T,L=E*8-c-1,P=(1<<L)-1,O=P>>1,M=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=l?0:E-1,p=l?1:-1,h=d<0||d===0&&1/d<0?1:0;for(d=Math.abs(d),isNaN(d)||d===1/0?(f=isNaN(d)?1:0,m=P):(m=Math.floor(Math.log(d)/Math.LN2),d*(T=Math.pow(2,-m))<1&&(m--,T*=2),m+O>=1?d+=M/T:d+=M*Math.pow(2,1-O),d*T>=2&&(m++,T/=2),m+O>=P?(f=0,m=P):m+O>=1?(f=(d*T-1)*Math.pow(2,c),m=m+O):(f=d*Math.pow(2,O-1)*Math.pow(2,c),m=0));c>=8;r[o+S]=f&255,S+=p,f/=256,c-=8);for(m=m<<c|f,L+=c;L>0;r[o+S]=m&255,S+=p,m/=256,L-=8);r[o+S-p]|=h*128}},"./node_modules/codem-isoboxer/dist/iso_boxer.js":(g,i)=>{/*! codem-isoboxer v0.3.6 https://github.com/madebyhiro/codem-isoboxer/blob/master/LICENSE.txt */var r={};r.parseBuffer=function(l){return new d(l).parse()},r.addBoxProcessor=function(l,c){typeof l!="string"||typeof c!="function"||(o.prototype._boxProcessors[l]=c)},r.createFile=function(){return new d},r.createBox=function(l,c,E){var m=o.create(l);return c&&c.append(m,E),m},r.createFullBox=function(l,c,E){var m=r.createBox(l,c,E);return m.version=0,m.flags=0,m},r.Utils={},r.Utils.dataViewToString=function(l,c){var E=c||"utf-8";if(typeof TextDecoder<"u")return new TextDecoder(E).decode(l);var m=[],f=0;if(E==="utf-8")for(;f<l.byteLength;){var T=l.getUint8(f++);T<128||(T<224?(T=(T&31)<<6,T|=l.getUint8(f++)&63):T<240?(T=(T&15)<<12,T|=(l.getUint8(f++)&63)<<6,T|=l.getUint8(f++)&63):(T=(T&7)<<18,T|=(l.getUint8(f++)&63)<<12,T|=(l.getUint8(f++)&63)<<6,T|=l.getUint8(f++)&63)),m.push(String.fromCharCode(T))}else for(;f<l.byteLength;)m.push(String.fromCharCode(l.getUint8(f++)));return m.join("")},r.Utils.utf8ToByteArray=function(l){var c,E;if(typeof TextEncoder<"u")c=new TextEncoder().encode(l);else for(c=[],E=0;E<l.length;++E){var m=l.charCodeAt(E);m<128?c.push(m):m<2048?(c.push(192|m>>6),c.push(128|63&m)):m<65536?(c.push(224|m>>12),c.push(128|63&m>>6),c.push(128|63&m)):(c.push(240|m>>18),c.push(128|63&m>>12),c.push(128|63&m>>6),c.push(128|63&m))}return c},r.Utils.appendBox=function(l,c,E){if(c._offset=l._cursor.offset,c._root=l._root?l._root:l,c._raw=l._raw,c._parent=l,E!==-1){if(E==null){l.boxes.push(c);return}var m=-1,f;if(typeof E=="number")m=E;else{if(typeof E=="string")f=E;else if(typeof E=="object"&&E.type)f=E.type;else{l.boxes.push(c);return}for(var T=0;T<l.boxes.length;T++)if(f===l.boxes[T].type){m=T+1;break}}l.boxes.splice(m,0,c)}},i.parseBuffer=r.parseBuffer,i.addBoxProcessor=r.addBoxProcessor,i.createFile=r.createFile,i.createBox=r.createBox,i.createFullBox=r.createFullBox,i.Utils=r.Utils,r.Cursor=function(l){this.offset=typeof l>"u"?0:l};var d=function(l){this._cursor=new r.Cursor,this.boxes=[],l&&(this._raw=new DataView(l))};d.prototype.fetch=function(l){var c=this.fetchAll(l,!0);return c.length?c[0]:null},d.prototype.fetchAll=function(l,c){var E=[];return d._sweep.call(this,l,E,c),E},d.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var l=o.parse(this);if(typeof l.type>"u")break;this.boxes.push(l)}return this},d._sweep=function(l,c,E){this.type&&this.type==l&&c.push(this);for(var m in this.boxes){if(c.length&&E)return;d._sweep.call(this.boxes[m],l,c,E)}},d.prototype.write=function(){var l=0,c;for(c=0;c<this.boxes.length;c++)l+=this.boxes[c].getLength(!1);var E=new Uint8Array(l);for(this._rawo=new DataView(E.buffer),this.bytes=E,this._cursor.offset=0,c=0;c<this.boxes.length;c++)this.boxes[c].write();return E.buffer},d.prototype.append=function(l,c){r.Utils.appendBox(this,l,c)};var o=function(){this._cursor=new r.Cursor};o.parse=function(l){var c=new o;return c._offset=l._cursor.offset,c._root=l._root?l._root:l,c._raw=l._raw,c._parent=l,c._parseBox(),l._cursor.offset=c._raw.byteOffset+c._raw.byteLength,c},o.create=function(l){var c=new o;return c.type=l,c.boxes=[],c},o.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],o.prototype._boxProcessors={},o.prototype._procField=function(l,c,E){this._parsing?this[l]=this._readField(c,E):this._writeField(c,E,this[l])},o.prototype._procFieldArray=function(l,c,E,m){var f;if(this._parsing)for(this[l]=[],f=0;f<c;f++)this[l][f]=this._readField(E,m);else for(f=0;f<this[l].length;f++)this._writeField(E,m,this[l][f])},o.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},o.prototype._procEntries=function(l,c,E){var m;if(this._parsing)for(this[l]=[],m=0;m<c;m++)this[l].push({}),E.call(this,this[l][m]);else for(m=0;m<c;m++)E.call(this,this[l][m])},o.prototype._procSubEntries=function(l,c,E,m){var f;if(this._parsing)for(l[c]=[],f=0;f<E;f++)l[c].push({}),m.call(this,l[c][f]);else for(f=0;f<E;f++)m.call(this,l[c][f])},o.prototype._procEntryField=function(l,c,E,m){this._parsing?l[c]=this._readField(E,m):this._writeField(E,m,l[c])},o.prototype._procSubBoxes=function(l,c){var E;if(this._parsing)for(this[l]=[],E=0;E<c;E++)this[l].push(o.parse(this));else for(E=0;E<c;E++)this._rawo?this[l][E].write():this.size+=this[l][E].getLength()},o.prototype._readField=function(l,c){switch(l){case"uint":return this._readUint(c);case"int":return this._readInt(c);case"template":return this._readTemplate(c);case"string":return c===-1?this._readTerminatedString():this._readString(c);case"data":return this._readData(c);case"utf8":return this._readUTF8String();default:return-1}},o.prototype._readInt=function(l){var c=null,E=this._cursor.offset-this._raw.byteOffset;switch(l){case 8:c=this._raw.getInt8(E);break;case 16:c=this._raw.getInt16(E);break;case 32:c=this._raw.getInt32(E);break;case 64:var m=this._raw.getInt32(E),f=this._raw.getInt32(E+4);c=m*Math.pow(2,32)+f;break}return this._cursor.offset+=l>>3,c},o.prototype._readUint=function(l){var c=null,E=this._cursor.offset-this._raw.byteOffset,m,f;switch(l){case 8:c=this._raw.getUint8(E);break;case 16:c=this._raw.getUint16(E);break;case 24:m=this._raw.getUint16(E),f=this._raw.getUint8(E+2),c=(m<<8)+f;break;case 32:c=this._raw.getUint32(E);break;case 64:m=this._raw.getUint32(E),f=this._raw.getUint32(E+4),c=m*Math.pow(2,32)+f;break}return this._cursor.offset+=l>>3,c},o.prototype._readString=function(l){for(var c="",E=0;E<l;E++){var m=this._readUint(8);c+=String.fromCharCode(m)}return c},o.prototype._readTemplate=function(l){var c=this._readUint(l/2),E=this._readUint(l/2);return c+E/Math.pow(2,l/2)},o.prototype._readTerminatedString=function(){for(var l="";this._cursor.offset-this._offset<this._raw.byteLength;){var c=this._readUint(8);if(c===0)break;l+=String.fromCharCode(c)}return l},o.prototype._readData=function(l){var c=l>0?l:this._raw.byteLength-(this._cursor.offset-this._offset);if(c>0){var E=new Uint8Array(this._raw.buffer,this._cursor.offset,c);return this._cursor.offset+=c,E}else return null},o.prototype._readUTF8String=function(){var l=this._raw.byteLength-(this._cursor.offset-this._offset),c=null;return l>0&&(c=new DataView(this._raw.buffer,this._cursor.offset,l),this._cursor.offset+=l),c&&r.Utils.dataViewToString(c)},o.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength){this._root._incomplete=!0;return}switch(this._procField("size","uint",32),this._procField("type","string",4),this.size===1&&this._procField("largesize","uint",64),this.type==="uuid"&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1?this._parseContainerBox():this._data=this._readData())},o.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},o.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(o.parse(this))},o.prototype.append=function(l,c){r.Utils.appendBox(this,l,c)},o.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),this.size===1&&this._procField("largesize","uint",64),this.type==="uuid"&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1)for(var l=0;l<this.boxes.length;l++)this.size+=this.boxes[l].getLength();return this._data&&this._writeData(this._data),this.size},o.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),this.size===1&&this._procField("largesize","uint",64),this.type==="uuid"&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1)for(var l=0;l<this.boxes.length;l++)this.boxes[l].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},o.prototype._writeInt=function(l,c){if(this._rawo){var E=this._cursor.offset-this._rawo.byteOffset;switch(l){case 8:this._rawo.setInt8(E,c);break;case 16:this._rawo.setInt16(E,c);break;case 32:this._rawo.setInt32(E,c);break;case 64:var m=Math.floor(c/Math.pow(2,32)),f=c-m*Math.pow(2,32);this._rawo.setUint32(E,m),this._rawo.setUint32(E+4,f);break}this._cursor.offset+=l>>3}else this.size+=l>>3},o.prototype._writeUint=function(l,c){if(this._rawo){var E=this._cursor.offset-this._rawo.byteOffset,m,f;switch(l){case 8:this._rawo.setUint8(E,c);break;case 16:this._rawo.setUint16(E,c);break;case 24:m=(c&16776960)>>8,f=c&255,this._rawo.setUint16(E,m),this._rawo.setUint8(E+2,f);break;case 32:this._rawo.setUint32(E,c);break;case 64:m=Math.floor(c/Math.pow(2,32)),f=c-m*Math.pow(2,32),this._rawo.setUint32(E,m),this._rawo.setUint32(E+4,f);break}this._cursor.offset+=l>>3}else this.size+=l>>3},o.prototype._writeString=function(l,c){for(var E=0;E<l;E++)this._writeUint(8,c.charCodeAt(E))},o.prototype._writeTerminatedString=function(l){if(l.length!==0){for(var c=0;c<l.length;c++)this._writeUint(8,l.charCodeAt(c));this._writeUint(8,0)}},o.prototype._writeTemplate=function(l,c){var E=Math.floor(c),m=(c-E)*Math.pow(2,l/2);this._writeUint(l/2,E),this._writeUint(l/2,m)},o.prototype._writeData=function(l){var c;if(l)if(this._rawo){if(l instanceof Array){for(var E=this._cursor.offset-this._rawo.byteOffset,c=0;c<l.length;c++)this._rawo.setInt8(E+c,l[c]);this._cursor.offset+=l.length}l instanceof Uint8Array&&(this._root.bytes.set(l,this._cursor.offset),this._cursor.offset+=l.length)}else this.size+=l.length},o.prototype._writeUTF8String=function(l){var c=r.Utils.utf8ToByteArray(l);if(this._rawo)for(var E=new DataView(this._rawo.buffer,this._cursor.offset,c.length),m=0;m<c.length;m++)E.setUint8(m,c[m]);else this.size+=c.length},o.prototype._writeField=function(l,c,E){switch(l){case"uint":this._writeUint(c,E);break;case"int":this._writeInt(c,E);break;case"template":this._writeTemplate(c,E);break;case"string":c==-1?this._writeTerminatedString(E):this._writeString(c,E);break;case"data":this._writeData(E);break;case"utf8":this._writeUTF8String(E);break}},o.prototype._boxProcessors.avc1=o.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},o.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},o.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(l){this._procEntryField(l,"segment_duration","uint",this.version===1?64:32),this._procEntryField(l,"media_time","int",this.version===1?64:32),this._procEntryField(l,"media_rate_integer","int",16),this._procEntryField(l,"media_rate_fraction","int",16)})},o.prototype._boxProcessors.emsg=function(){this._procFullBox(),this.version==1?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},o.prototype._boxProcessors.free=o.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},o.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},o.prototype._boxProcessors.ftyp=o.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var l=-1;this._parsing&&(l=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",l,"string",4)},o.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},o.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},o.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",this.version==1?64:32),this._procField("modification_time","uint",this.version==1?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",this.version==1?64:32),!this._parsing&&typeof this.language=="string"&&(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode((this.language>>10&31)+96,(this.language>>5&31)+96,(this.language&31)+96)),this._procField("pre_defined","uint",16)},o.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",this.version==1?64:32)},o.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},o.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},o.prototype._boxProcessors.mp4a=o.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},o.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",this.version==1?64:32),this._procField("modification_time","uint",this.version==1?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",this.version==1?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},o.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},o.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},o.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),this.flags&1&&this._procField("scheme_uri","string",-1)},o.prototype._boxProcessors.sdtp=function(){this._procFullBox();var l=-1;this._parsing&&(l=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",l,"uint",8)},o.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",this.version==1?64:32),this._procField("first_offset","uint",this.version==1?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,function(l){this._parsing||(l.reference=(l.reference_type&1)<<31,l.reference|=l.referenced_size&2147483647,l.sap=(l.starts_with_SAP&1)<<31,l.sap|=(l.SAP_type&3)<<28,l.sap|=l.SAP_delta_time&268435455),this._procEntryField(l,"reference","uint",32),this._procEntryField(l,"subsegment_duration","uint",32),this._procEntryField(l,"sap","uint",32),this._parsing&&(l.reference_type=l.reference>>31&1,l.referenced_size=l.reference&2147483647,l.starts_with_SAP=l.sap>>31&1,l.SAP_type=l.sap>>28&7,l.SAP_delta_time=l.sap&268435455)})},o.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},o.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,function(l){this._procEntryField(l,"ranges_count","uint",32),this._procSubEntries(l,"ranges",l.ranges_count,function(c){this._procEntryField(c,"level","uint",8),this._procEntryField(c,"range_size","uint",24)})})},o.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},o.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(l){this._procEntryField(l,"sample_delta","uint",32),this._procEntryField(l,"subsample_count","uint",16),this._procSubEntries(l,"subsamples",l.subsample_count,function(c){this._procEntryField(c,"subsample_size","uint",this.version===1?32:16),this._procEntryField(c,"subsample_priority","uint",8),this._procEntryField(c,"discardable","uint",8),this._procEntryField(c,"codec_specific_parameters","uint",32)})})},o.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},o.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",this.version==1?64:32)},o.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),this.flags&1&&this._procField("base_data_offset","uint",64),this.flags&2&&this._procField("sample_description_offset","uint",32),this.flags&8&&this._procField("default_sample_duration","uint",32),this.flags&16&&this._procField("default_sample_size","uint",32),this.flags&32&&this._procField("default_sample_flags","uint",32)},o.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(this.length_size_of_traf_num&48)<<4,this.reserved|=(this.length_size_of_trun_num&12)<<2,this.reserved|=this.length_size_of_sample_num&3),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(this.reserved&48)>>4,this.length_size_of_trun_num=(this.reserved&12)>>2,this.length_size_of_sample_num=this.reserved&3),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,function(l){this._procEntryField(l,"time","uint",this.version===1?64:32),this._procEntryField(l,"moof_offset","uint",this.version===1?64:32),this._procEntryField(l,"traf_number","uint",(this.length_size_of_traf_num+1)*8),this._procEntryField(l,"trun_number","uint",(this.length_size_of_trun_num+1)*8),this._procEntryField(l,"sample_number","uint",(this.length_size_of_sample_num+1)*8)})},o.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",this.version==1?64:32),this._procField("modification_time","uint",this.version==1?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",this.version==1?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},o.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},o.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),this.flags&1&&this._procField("data_offset","int",32),this.flags&4&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,function(l){this.flags&256&&this._procEntryField(l,"sample_duration","uint",32),this.flags&512&&this._procEntryField(l,"sample_size","uint",32),this.flags&1024&&this._procEntryField(l,"sample_flags","uint",32),this.flags&2048&&this._procEntryField(l,"sample_composition_time_offset",this.version===1?"int":"uint",32)})},o.prototype._boxProcessors["url "]=o.prototype._boxProcessors["urn "]=function(){this._procFullBox(),this.type==="urn "&&this._procField("name","string",-1),this._procField("location","string",-1)},o.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},o.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},o.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},o.prototype._boxProcessors.vtte=function(){}},"./node_modules/es6-promise/auto.js":(g,i,r)=>{g.exports=r("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},"./node_modules/es6-promise/dist/es6-promise.js":function(g,i,r){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(d,o){g.exports=o()})(this,function(){function d(J){var ve=typeof J;return J!==null&&(ve==="object"||ve==="function")}function o(J){return typeof J=="function"}var l=void 0;Array.isArray?l=Array.isArray:l=function(J){return Object.prototype.toString.call(J)==="[object Array]"};var c=l,E=0,m=void 0,f=void 0,T=function(ve,me){A[E]=ve,A[E+1]=me,E+=2,E===2&&(f?f(x):k())};function L(J){f=J}function P(J){T=J}var O=typeof window<"u"?window:void 0,M=O||{},S=M.MutationObserver||M.WebKitMutationObserver,p=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",h=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function C(){return function(){return process.nextTick(x)}}function v(){return typeof m<"u"?function(){m(x)}:y()}function I(){var J=0,ve=new S(x),me=document.createTextNode("");return ve.observe(me,{characterData:!0}),function(){me.data=J=++J%2}}function D(){var J=new MessageChannel;return J.port1.onmessage=x,function(){return J.port2.postMessage(0)}}function y(){var J=setTimeout;return function(){return J(x,1)}}var A=new Array(1e3);function x(){for(var J=0;J<E;J+=2){var ve=A[J],me=A[J+1];ve(me),A[J]=void 0,A[J+1]=void 0}E=0}function F(){try{var J=Function("return this")().require("vertx");return m=J.runOnLoop||J.runOnContext,v()}catch{return y()}}var k=void 0;p?k=C():S?k=I():h?k=D():O===void 0?k=F():k=y();function W(J,ve){var me=this,Ae=new this.constructor($);Ae[Q]===void 0&&R(Ae);var be=me._state;if(be){var Be=arguments[be-1];T(function(){return q(be,Ae,Be,me._result)})}else se(me,Ae,J,ve);return Ae}function V(J){var ve=this;if(J&&typeof J=="object"&&J.constructor===ve)return J;var me=new ve($);return oe(me,J),me}var Q=Math.random().toString(36).substring(2);function $(){}var K=void 0,Y=1,re=2;function ie(){return new TypeError("You cannot resolve a promise with itself")}function ee(){return new TypeError("A promises callback cannot return that same promise.")}function ne(J,ve,me,Ae){try{J.call(ve,me,Ae)}catch(be){return be}}function ae(J,ve,me){T(function(Ae){var be=!1,Be=ne(me,ve,function(ke){be||(be=!0,ve!==ke?oe(Ae,ke):_e(Ae,ke))},function(ke){be||(be=!0,he(Ae,ke))},"Settle: "+(Ae._label||" unknown promise"));!be&&Be&&(be=!0,he(Ae,Be))},J)}function ce(J,ve){ve._state===Y?_e(J,ve._result):ve._state===re?he(J,ve._result):se(ve,void 0,function(me){return oe(J,me)},function(me){return he(J,me)})}function X(J,ve,me){ve.constructor===J.constructor&&me===W&&ve.constructor.resolve===V?ce(J,ve):me===void 0?_e(J,ve):o(me)?ae(J,ve,me):_e(J,ve)}function oe(J,ve){if(J===ve)he(J,ie());else if(d(ve)){var me=void 0;try{me=ve.then}catch(Ae){he(J,Ae);return}X(J,ve,me)}else _e(J,ve)}function ge(J){J._onerror&&J._onerror(J._result),Z(J)}function _e(J,ve){J._state===K&&(J._result=ve,J._state=Y,J._subscribers.length!==0&&T(Z,J))}function he(J,ve){J._state===K&&(J._state=re,J._result=ve,T(ge,J))}function se(J,ve,me,Ae){var be=J._subscribers,Be=be.length;J._onerror=null,be[Be]=ve,be[Be+Y]=me,be[Be+re]=Ae,Be===0&&J._state&&T(Z,J)}function Z(J){var ve=J._subscribers,me=J._state;if(ve.length!==0){for(var Ae=void 0,be=void 0,Be=J._result,ke=0;ke<ve.length;ke+=3)Ae=ve[ke],be=ve[ke+me],Ae?q(me,Ae,be,Be):be(Be);J._subscribers.length=0}}function q(J,ve,me,Ae){var be=o(me),Be=void 0,ke=void 0,Ye=!0;if(be){try{Be=me(Ae)}catch(Oe){Ye=!1,ke=Oe}if(ve===Be){he(ve,ee());return}}else Be=Ae;ve._state!==K||(be&&Ye?oe(ve,Be):Ye===!1?he(ve,ke):J===Y?_e(ve,Be):J===re&&he(ve,Be))}function le(J,ve){try{ve(function(Ae){oe(J,Ae)},function(Ae){he(J,Ae)})}catch(me){he(J,me)}}var te=0;function N(){return te++}function R(J){J[Q]=te++,J._state=void 0,J._result=void 0,J._subscribers=[]}function w(){return new Error("Array Methods must be provided an Array")}var j=function(){function J(ve,me){this._instanceConstructor=ve,this.promise=new ve($),this.promise[Q]||R(this.promise),c(me)?(this.length=me.length,this._remaining=me.length,this._result=new Array(this.length),this.length===0?_e(this.promise,this._result):(this.length=this.length||0,this._enumerate(me),this._remaining===0&&_e(this.promise,this._result))):he(this.promise,w())}return J.prototype._enumerate=function(me){for(var Ae=0;this._state===K&&Ae<me.length;Ae++)this._eachEntry(me[Ae],Ae)},J.prototype._eachEntry=function(me,Ae){var be=this._instanceConstructor,Be=be.resolve;if(Be===V){var ke=void 0,Ye=void 0,Oe=!1;try{ke=me.then}catch(Me){Oe=!0,Ye=Me}if(ke===W&&me._state!==K)this._settledAt(me._state,Ae,me._result);else if(typeof ke!="function")this._remaining--,this._result[Ae]=me;else if(be===fe){var Se=new be($);Oe?he(Se,Ye):X(Se,me,ke),this._willSettleAt(Se,Ae)}else this._willSettleAt(new be(function(Me){return Me(me)}),Ae)}else this._willSettleAt(Be(me),Ae)},J.prototype._settledAt=function(me,Ae,be){var Be=this.promise;Be._state===K&&(this._remaining--,me===re?he(Be,be):this._result[Ae]=be),this._remaining===0&&_e(Be,this._result)},J.prototype._willSettleAt=function(me,Ae){var be=this;se(me,void 0,function(Be){return be._settledAt(Y,Ae,Be)},function(Be){return be._settledAt(re,Ae,Be)})},J}();function H(J){return new j(this,J).promise}function U(J){var ve=this;return c(J)?new ve(function(me,Ae){for(var be=J.length,Be=0;Be<be;Be++)ve.resolve(J[Be]).then(me,Ae)}):new ve(function(me,Ae){return Ae(new TypeError("You must pass an array to race."))})}function B(J){var ve=this,me=new ve($);return he(me,J),me}function G(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var fe=function(){function J(ve){this[Q]=N(),this._result=this._state=void 0,this._subscribers=[],$!==ve&&(typeof ve!="function"&&G(),this instanceof J?le(this,ve):z())}return J.prototype.catch=function(me){return this.then(null,me)},J.prototype.finally=function(me){var Ae=this,be=Ae.constructor;return o(me)?Ae.then(function(Be){return be.resolve(me()).then(function(){return Be})},function(Be){return be.resolve(me()).then(function(){throw Be})}):Ae.then(me,me)},J}();fe.prototype.then=W,fe.all=H,fe.race=U,fe.resolve=V,fe.reject=B,fe._setScheduler=L,fe._setAsap=P,fe._asap=T;function ue(){var J=void 0;if(typeof r.g<"u")J=r.g;else if(typeof self<"u")J=self;else try{J=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var ve=J.Promise;if(ve){var me=null;try{me=Object.prototype.toString.call(ve.resolve())}catch{}if(me==="[object Promise]"&&!ve.cast)return}J.Promise=fe}return fe.polyfill=ue,fe.Promise=fe,fe})},"./node_modules/events/events.js":g=>{var i=typeof Reflect=="object"?Reflect:null,r=i&&typeof i.apply=="function"?i.apply:function(y,A,x){return Function.prototype.apply.call(y,A,x)},d;i&&typeof i.ownKeys=="function"?d=i.ownKeys:Object.getOwnPropertySymbols?d=function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:d=function(y){return Object.getOwnPropertyNames(y)};function o(D){console&&console.warn&&console.warn(D)}var l=Number.isNaN||function(y){return y!==y};function c(){c.init.call(this)}g.exports=c,g.exports.once=C,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var E=10;function m(D){if(typeof D!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof D)}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return E},set:function(D){if(typeof D!="number"||D<0||l(D))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+D+".");E=D}}),c.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||l(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this};function f(D){return D._maxListeners===void 0?c.defaultMaxListeners:D._maxListeners}c.prototype.getMaxListeners=function(){return f(this)},c.prototype.emit=function(y){for(var A=[],x=1;x<arguments.length;x++)A.push(arguments[x]);var F=y==="error",k=this._events;if(k!==void 0)F=F&&k.error===void 0;else if(!F)return!1;if(F){var W;if(A.length>0&&(W=A[0]),W instanceof Error)throw W;var V=new Error("Unhandled error."+(W?" ("+W.message+")":""));throw V.context=W,V}var Q=k[y];if(Q===void 0)return!1;if(typeof Q=="function")r(Q,this,A);else for(var $=Q.length,K=S(Q,$),x=0;x<$;++x)r(K[x],this,A);return!0};function T(D,y,A,x){var F,k,W;if(m(A),k=D._events,k===void 0?(k=D._events=Object.create(null),D._eventsCount=0):(k.newListener!==void 0&&(D.emit("newListener",y,A.listener?A.listener:A),k=D._events),W=k[y]),W===void 0)W=k[y]=A,++D._eventsCount;else if(typeof W=="function"?W=k[y]=x?[A,W]:[W,A]:x?W.unshift(A):W.push(A),F=f(D),F>0&&W.length>F&&!W.warned){W.warned=!0;var V=new Error("Possible EventEmitter memory leak detected. "+W.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");V.name="MaxListenersExceededWarning",V.emitter=D,V.type=y,V.count=W.length,o(V)}return D}c.prototype.addListener=function(y,A){return T(this,y,A,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(y,A){return T(this,y,A,!0)};function L(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function P(D,y,A){var x={fired:!1,wrapFn:void 0,target:D,type:y,listener:A},F=L.bind(x);return F.listener=A,x.wrapFn=F,F}c.prototype.once=function(y,A){return m(A),this.on(y,P(this,y,A)),this},c.prototype.prependOnceListener=function(y,A){return m(A),this.prependListener(y,P(this,y,A)),this},c.prototype.removeListener=function(y,A){var x,F,k,W,V;if(m(A),F=this._events,F===void 0)return this;if(x=F[y],x===void 0)return this;if(x===A||x.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete F[y],F.removeListener&&this.emit("removeListener",y,x.listener||A));else if(typeof x!="function"){for(k=-1,W=x.length-1;W>=0;W--)if(x[W]===A||x[W].listener===A){V=x[W].listener,k=W;break}if(k<0)return this;k===0?x.shift():p(x,k),x.length===1&&(F[y]=x[0]),F.removeListener!==void 0&&this.emit("removeListener",y,V||A)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(y){var A,x,F;if(x=this._events,x===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[y]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete x[y]),this;if(arguments.length===0){var k=Object.keys(x),W;for(F=0;F<k.length;++F)W=k[F],W!=="removeListener"&&this.removeAllListeners(W);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=x[y],typeof A=="function")this.removeListener(y,A);else if(A!==void 0)for(F=A.length-1;F>=0;F--)this.removeListener(y,A[F]);return this};function O(D,y,A){var x=D._events;if(x===void 0)return[];var F=x[y];return F===void 0?[]:typeof F=="function"?A?[F.listener||F]:[F]:A?h(F):S(F,F.length)}c.prototype.listeners=function(y){return O(this,y,!0)},c.prototype.rawListeners=function(y){return O(this,y,!1)},c.listenerCount=function(D,y){return typeof D.listenerCount=="function"?D.listenerCount(y):M.call(D,y)},c.prototype.listenerCount=M;function M(D){var y=this._events;if(y!==void 0){var A=y[D];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}c.prototype.eventNames=function(){return this._eventsCount>0?d(this._events):[]};function S(D,y){for(var A=new Array(y),x=0;x<y;++x)A[x]=D[x];return A}function p(D,y){for(;y+1<D.length;y++)D[y]=D[y+1];D.pop()}function h(D){for(var y=new Array(D.length),A=0;A<y.length;++A)y[A]=D[A].listener||D[A];return y}function C(D,y){return new Promise(function(A,x){function F(W){D.removeListener(y,k),x(W)}function k(){typeof D.removeListener=="function"&&D.removeListener("error",F),A([].slice.call(arguments))}I(D,y,k,{once:!0}),y!=="error"&&v(D,F,{once:!0})})}function v(D,y,A){typeof D.on=="function"&&I(D,"error",y,A)}function I(D,y,A,x){if(typeof D.on=="function")x.once?D.once(y,A):D.on(y,A);else if(typeof D.addEventListener=="function")D.addEventListener(y,function F(k){x.once&&D.removeEventListener(y,F),A(k)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof D)}},"./node_modules/fast-deep-equal/index.js":g=>{var i=Array.isArray,r=Object.keys,d=Object.prototype.hasOwnProperty;g.exports=function o(l,c){if(l===c)return!0;if(l&&c&&typeof l=="object"&&typeof c=="object"){var E=i(l),m=i(c),f,T,L;if(E&&m){if(T=l.length,T!=c.length)return!1;for(f=T;f--!==0;)if(!o(l[f],c[f]))return!1;return!0}if(E!=m)return!1;var P=l instanceof Date,O=c instanceof Date;if(P!=O)return!1;if(P&&O)return l.getTime()==c.getTime();var M=l instanceof RegExp,S=c instanceof RegExp;if(M!=S)return!1;if(M&&S)return l.toString()==c.toString();var p=r(l);if(T=p.length,T!==r(c).length)return!1;for(f=T;f--!==0;)if(!d.call(c,p[f]))return!1;for(f=T;f--!==0;)if(L=p[f],!o(l[L],c[L]))return!1;return!0}return l!==l&&c!==c}},"./node_modules/imsc/src/main/js/doc.js":(g,i,r)=>{(function(d,o,l,c,E){d.fromXML=function(N,R,w){var j=o.parser(!0,{xmlns:!0}),H=[],U=[],B=[],G=0,z=null;j.onclosetag=function(me){if(H[0]instanceof P)for(var Ae in H[0].styles)_e(H[0],H[0].styles[Ae],R);else if(H[0]instanceof x||H[0]instanceof F){if(H[0].contents.length>1){var be=[H[0].contents[0]],Be;for(Be=1;Be<H[0].contents.length;Be++)H[0].contents[Be]instanceof k&&be[be.length-1]instanceof k?be[be.length-1].text+=H[0].contents[Be].text:be.push(H[0].contents[Be]);H[0].contents=be}H[0]instanceof F&&H[0].contents.length===1&&H[0].contents[0]instanceof k&&(H[0].text=H[0].contents[0].text,delete H[0].contents)}else H[0]instanceof f&&(H[0].node.uri===l.ns_tt&&H[0].node.local==="metadata"?G--:G>0&&w&&"onCloseTag"in w&&w.onCloseTag());B.shift(),U.shift(),H.shift()},j.ontext=function(me){if(H[0]!==void 0)if(H[0]instanceof F||H[0]instanceof x){var Ae=new k;Ae.initFromText(z,H[0],me,B[0],R),H[0].contents.push(Ae)}else H[0]instanceof f&&G>0&&w&&"onText"in w&&w.onText(me)},j.onopentag=function(me){var Ae=me.attributes["xml:space"];Ae?B.unshift(Ae.value):B.length===0?B.unshift("default"):B.unshift(B[0]);var be=me.attributes["xml:lang"];if(be?U.unshift(be.value):U.length===0?U.unshift(""):U.unshift(U[0]),me.uri===l.ns_tt)if(me.local==="tt")z!==null&&le(R,"Two <tt> elements at ("+this.line+","+this.column+")"),z=new T,z.initFromNode(me,R),H.unshift(z);else if(me.local==="head")H[0]instanceof T||le(R,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),z.head!==null&&le("Second <head> element at ("+this.line+","+this.column+")"),z.head=new L,H.unshift(z.head);else if(me.local==="styling")H[0]instanceof L||le(R,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),z.head.styling!==null&&le("Second <styling> element at ("+this.line+","+this.column+")"),z.head.styling=new P,H.unshift(z.head.styling);else if(me.local==="style"){var Be;H[0]instanceof P?(Be=new O,Be.initFromNode(me,R),Be.id?z.head.styling.styles[Be.id]=Be:q(R,"<style> element missing @id attribute"),H.unshift(Be)):H[0]instanceof V?(Be=new O,Be.initFromNode(me,R),se(Be.styleAttrs,H[0].styleAttrs),H.unshift(Be)):le(R,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if(me.local==="layout")H[0]instanceof L||le(R,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),z.head.layout!==null&&le(R,"Second <layout> element at "+this.line+","+this.column+")"),z.head.layout=new M,H.unshift(z.head.layout);else if(me.local==="region"){H[0]instanceof M||le(R,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var ke=new V;ke.initFromNode(z,me,R),!ke.id||ke.id in z.head.layout.regions?q(R,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):z.head.layout.regions[ke.id]=ke,H.unshift(ke)}else if(me.local==="body"){H[0]instanceof T||le(R,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),z.body!==null&&le(R,"Second <body> element at "+this.line+","+this.column+")");var Ye=new y;Ye.initFromNode(z,me,R),z.body=Ye,H.unshift(Ye)}else if(me.local==="div"){H[0]instanceof A||H[0]instanceof y||le(R,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var Oe=new A;Oe.initFromNode(z,H[0],me,R),H[0].contents.push(Oe),H.unshift(Oe)}else if(me.local==="p"){H[0]instanceof A||le(R,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var Se=new x;Se.initFromNode(z,H[0],me,R),H[0].contents.push(Se),H.unshift(Se)}else if(me.local==="span"){H[0]instanceof F||H[0]instanceof x||le(R,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var Me=new F;Me.initFromNode(z,H[0],me,B[0],R),H[0].contents.push(Me),H.unshift(Me)}else if(me.local==="br"){H[0]instanceof F||H[0]instanceof x||le(R,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var qe=new W;qe.initFromNode(z,H[0],me,R),H[0].contents.push(qe),H.unshift(qe)}else if(me.local==="set"){H[0]instanceof F||H[0]instanceof x||H[0]instanceof A||H[0]instanceof y||H[0]instanceof V||H[0]instanceof W||le(R,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var it=new Q;it.initFromNode(z,H[0],me,R),H[0].sets.push(it),H.unshift(it)}else H.unshift(new f(me));else H.unshift(new f(me));if(H[0]instanceof f){if(me.uri===l.ns_tt&&me.local==="metadata")G++;else if(G>0&&w&&"onOpenTag"in w){var at=[];for(var Ce in me.attributes)at[me.attributes[Ce].uri+" "+me.attributes[Ce].local]={uri:me.attributes[Ce].uri,local:me.attributes[Ce].local,value:me.attributes[Ce].value};w.onOpenTag(me.uri,me.local,at)}}},j.write(N).close(),z.head!==null?delete z.head.styling:z.head=new L,z.head.layout===null&&(z.head.layout=new M);var fe=!1;for(var ue in z.head.layout.regions){fe=!0;break}if(!fe){var J=V.prototype.createDefaultRegion();z.head.layout.regions[J.id]=J}for(var ve in z.head.layout.regions)m(z,z.head.layout.regions[ve],null,null);return z.body&&m(z,z.body,null,null),z};function m(N,R,w,j){var H=j&&j.timeContainer==="seq",U=0;j&&(H&&w?U=w.end:U=j.begin),R.begin=R.explicit_begin?R.explicit_begin+U:U;var B=R.begin,G=null;for(var z in R.sets)m(N,R.sets[z],G,R),R.timeContainer==="seq"?B=R.sets[z].end:B=Math.max(B,R.sets[z].end),G=R.sets[z];if(!("contents"in R))H?B=R.begin:B=Number.POSITIVE_INFINITY;else for(var fe in R.contents)m(N,R.contents[fe],G,R),R.timeContainer==="seq"?B=R.contents[fe].end:B=Math.max(B,R.contents[fe].end),G=R.contents[fe];R.explicit_end!==null&&R.explicit_dur!==null?R.end=Math.min(R.begin+R.explicit_dur,U+R.explicit_end):R.explicit_end===null&&R.explicit_dur!==null?R.end=R.begin+R.explicit_dur:R.explicit_end!==null&&R.explicit_dur===null?R.end=U+R.explicit_end:R.end=B,delete R.explicit_begin,delete R.explicit_dur,delete R.explicit_end,N._registerEvent(R)}function f(N){this.node=N}function T(){this.events=[],this.head=null,this.body=null}T.prototype.initFromNode=function(N,R){this.cellResolution=ae(N,R);var w=ce(N,R);this.effectiveFrameRate=w.effectiveFrameRate,this.tickRate=w.tickRate,this.aspectRatio=ne(N,R);var j=ee(N,l.ns_ttp,"timeBase");j!==null&&j!=="media"&&le(R,"Unsupported time base");var H=X(N,R);H===null?this.pxDimensions={h:480,w:640}:((H.h.unit!=="px"||H.w.unit!=="px")&&le(R,"Extent on TT must be in px or absent"),this.pxDimensions={h:H.h.value,w:H.w.value})},T.prototype._registerEvent=function(N){if(!(N.end<=N.begin)){var R=te(this.events,N.begin);if(R.found||this.events.splice(R.index,0,N.begin),N.end!==Number.POSITIVE_INFINITY){var w=te(this.events,N.end);w.found||this.events.splice(w.index,0,N.end)}}},T.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},T.prototype.getMediaTimeEvents=function(){return this.events};function L(){this.styling=null,this.layout=null}function P(){this.styles={}}function O(){this.id=null,this.styleAttrs=null,this.styleRefs=null}O.prototype.initFromNode=function(N,R){this.id=$(N),this.styleAttrs=ie(N,R),this.styleRefs=re(N)};function M(){this.regions={}}function S(N){this.kind=N}function p(N){this.id=N}p.prototype.initFromNode=function(N,R,w,j){this.id=$(w)};function h(N){this.regionID=N}h.prototype.initFromNode=function(N,R,w,j){this.regionID=K(w)};function C(N){this.styleAttrs=N}C.prototype.initFromNode=function(N,R,w,j){this.styleAttrs=ie(w,j),N.head!==null&&N.head.styling!==null&&he(N.head.styling,re(w),this.styleAttrs,j)};function v(N){this.sets=N}v.prototype.initFromNode=function(N,R,w,j){this.sets=[]};function I(N){this.contents=N}I.prototype.initFromNode=function(N,R,w,j){this.contents=[]};function D(N,R,w){this.explicit_begin=N,this.explicit_end=R,this.explicit_dur=w}D.prototype.initFromNode=function(N,R,w,j){var H=ge(N,R,w,j);this.explicit_begin=H.explicit_begin,this.explicit_end=H.explicit_end,this.explicit_dur=H.explicit_dur,this.timeContainer=Y(w,j)};function y(){S.call(this,"body")}y.prototype.initFromNode=function(N,R,w){C.prototype.initFromNode.call(this,N,null,R,w),D.prototype.initFromNode.call(this,N,null,R,w),v.prototype.initFromNode.call(this,N,null,R,w),h.prototype.initFromNode.call(this,N,null,R,w),I.prototype.initFromNode.call(this,N,null,R,w)};function A(){S.call(this,"div")}A.prototype.initFromNode=function(N,R,w,j){C.prototype.initFromNode.call(this,N,R,w,j),D.prototype.initFromNode.call(this,N,R,w,j),v.prototype.initFromNode.call(this,N,R,w,j),h.prototype.initFromNode.call(this,N,R,w,j),I.prototype.initFromNode.call(this,N,R,w,j)};function x(){S.call(this,"p")}x.prototype.initFromNode=function(N,R,w,j){C.prototype.initFromNode.call(this,N,R,w,j),D.prototype.initFromNode.call(this,N,R,w,j),v.prototype.initFromNode.call(this,N,R,w,j),h.prototype.initFromNode.call(this,N,R,w,j),I.prototype.initFromNode.call(this,N,R,w,j)};function F(){S.call(this,"span")}F.prototype.initFromNode=function(N,R,w,j,H){C.prototype.initFromNode.call(this,N,R,w,H),D.prototype.initFromNode.call(this,N,R,w,H),v.prototype.initFromNode.call(this,N,R,w,H),h.prototype.initFromNode.call(this,N,R,w,H),I.prototype.initFromNode.call(this,N,R,w,H),this.space=j};function k(){S.call(this,"span")}k.prototype.initFromText=function(N,R,w,j,H){D.prototype.initFromNode.call(this,N,R,null,H),this.text=w,this.space=j};function W(){S.call(this,"br")}W.prototype.initFromNode=function(N,R,w,j){h.prototype.initFromNode.call(this,N,R,w,j),D.prototype.initFromNode.call(this,N,R,w,j)};function V(){}V.prototype.createDefaultRegion=function(){var N=new V;return p.call(N,""),C.call(N,{}),v.call(N,[]),D.call(N,0,Number.POSITIVE_INFINITY,null),N},V.prototype.initFromNode=function(N,R,w){p.prototype.initFromNode.call(this,N,null,R,w),C.prototype.initFromNode.call(this,N,null,R,w),D.prototype.initFromNode.call(this,N,null,R,w),v.prototype.initFromNode.call(this,N,null,R,w),N.head!==null&&N.head.styling!==null&&he(N.head.styling,re(R),this.styleAttrs,w)};function Q(){}Q.prototype.initFromNode=function(N,R,w,j){D.prototype.initFromNode.call(this,N,R,w,j);var H=ie(w,j);this.qname=null,this.value=null;for(var U in H){if(this.qname){q(j,"More than one style specified on set");break}this.qname=U,this.value=H[U]}};function $(N){return N&&"xml:id"in N.attributes&&N.attributes["xml:id"].value||null}function K(N){return N&&"region"in N.attributes?N.attributes.region.value:""}function Y(N,R){var w=N&&"timeContainer"in N.attributes?N.attributes.timeContainer.value:null;return!w||w==="par"?"par":w==="seq"?"seq":(q(R,"Illegal value of timeContainer (assuming 'par')"),"par")}function re(N){return N&&"style"in N.attributes?N.attributes.style.value.split(" "):[]}function ie(N,R){var w={};if(N!==null)for(var j in N.attributes){var H=N.attributes[j].uri+" "+N.attributes[j].local,U=c.byQName[H];if(U!==void 0){var B=U.parse(N.attributes[j].value);B!==null?(w[H]=B,U===c.byName.zIndex&&Z(R,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):q(R,"Cannot parse styling attribute "+H+" --> "+N.attributes[j].value)}}return w}function ee(N,R,w){for(var j in N.attributes)if(N.attributes[j].uri===R&&N.attributes[j].local===w)return N.attributes[j].value;return null}function ne(N,R){var w=ee(N,l.ns_ittp,"aspectRatio"),j=null;if(w!==null){var H=/(\d+) (\d+)/,U=H.exec(w);if(U!==null){var B=parseInt(U[1]),G=parseInt(U[2]);B!==0&&G!==0?j=B/G:q(R,"Illegal aspectRatio values (ignoring)")}else q(R,"Malformed aspectRatio attribute (ignoring)")}return j}function ae(N,R){var w=ee(N,l.ns_ttp,"cellResolution"),j=15,H=32;if(w!==null){var U=/(\d+) (\d+)/,B=U.exec(w);B!==null?(H=parseInt(B[1]),j=parseInt(B[2])):Z(R,"Malformed cellResolution value (using initial value instead)")}return{w:H,h:j}}function ce(N,R){var w=ee(N,l.ns_ttp,"frameRate"),j=30,H;if(w!==null){var U=/(\d+)/;H=U.exec(w),H!==null?j=parseInt(H[1]):Z(R,"Malformed frame rate attribute (using initial value instead)")}var B=ee(N,l.ns_ttp,"frameRateMultiplier"),G=1;if(B!==null){var z=/(\d+) (\d+)/;H=z.exec(B),H!==null?G=parseInt(H[1])/parseInt(H[2]):Z(R,"Malformed frame rate multiplier attribute (using initial value instead)")}var fe=G*j,ue=1,J=ee(N,l.ns_ttp,"tickRate");if(J===null)w!==null&&(ue=fe);else{var ve=/(\d+)/;H=ve.exec(J),H!==null?ue=parseInt(H[1]):Z(R,"Malformed tick rate attribute (using initial value instead)")}return{effectiveFrameRate:fe,tickRate:ue}}function X(N,R){var w=ee(N,l.ns_tts,"extent");if(w===null)return null;var j=w.split(" ");if(j.length!==2)return Z(R,"Malformed extent (ignoring)"),null;var H=E.parseLength(j[0]),U=E.parseLength(j[1]);return!U||!H?(Z(R,"Malformed extent values (ignoring)"),null):{h:U,w:H}}function oe(N,R,w){var j=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/,H=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/,U=/^(\d+(?:\.\d+)?)f$/,B=/^(\d+(?:\.\d+)?)t$/,G=/^(\d+(?:\.\d+)?)ms$/,z=/^(\d+(?:\.\d+)?)s$/,fe=/^(\d+(?:\.\d+)?)h$/,ue=/^(\d+(?:\.\d+)?)m$/,J,ve=null;return(J=U.exec(w))!==null?R!==null&&(ve=parseFloat(J[1])/R):(J=B.exec(w))!==null?N!==null&&(ve=parseFloat(J[1])/N):(J=G.exec(w))!==null?ve=parseFloat(J[1])/1e3:(J=z.exec(w))!==null?ve=parseFloat(J[1]):(J=fe.exec(w))!==null?ve=parseFloat(J[1])*3600:(J=ue.exec(w))!==null?ve=parseFloat(J[1])*60:(J=j.exec(w))!==null?ve=parseInt(J[1])*3600+parseInt(J[2])*60+parseFloat(J[3]):(J=H.exec(w))!==null&&R!==null&&(ve=parseInt(J[1])*3600+parseInt(J[2])*60+parseInt(J[3])+(J[4]===null?0:parseInt(J[4])/R)),ve}function ge(N,R,w,j){var H=null;w&&"begin"in w.attributes&&(H=oe(N.tickRate,N.effectiveFrameRate,w.attributes.begin.value),H===null&&Z(j,"Malformed begin value "+w.attributes.begin.value+" (using 0)"));var U=null;w&&"dur"in w.attributes&&(U=oe(N.tickRate,N.effectiveFrameRate,w.attributes.dur.value),U===null&&Z(j,"Malformed dur value "+w.attributes.dur.value+" (ignoring)"));var B=null;return w&&"end"in w.attributes&&(B=oe(N.tickRate,N.effectiveFrameRate,w.attributes.end.value),B===null&&Z(j,"Malformed end value (ignoring)")),{explicit_begin:H,explicit_end:B,explicit_dur:U}}function _e(N,R,w){for(;R.styleRefs.length>0;){var j=R.styleRefs.pop();if(!(j in N.styles)){q(w,"Non-existant style id referenced");continue}_e(N,N.styles[j],w),se(N.styles[j].styleAttrs,R.styleAttrs)}}function he(N,R,w,j){for(var H=R.length-1;H>=0;H--){var U=R[H];if(!(U in N.styles)){q(j,"Non-existant style id referenced");continue}se(N.styles[U].styleAttrs,w)}}function se(N,R){for(var w in N)w in R||(R[w]=N[w])}function Z(N,R){if(N&&N.warn&&N.warn(R))throw R}function q(N,R){if(N&&N.error&&N.error(R))throw R}function le(N,R){throw N&&N.fatal&&N.fatal(R),R}function te(N,R){for(var w=0,j=N.length-1,H;w<=j;){H=Math.floor((w+j)/2);var U=N[H];if(U<R)w=H+1;else if(U>R)j=H-1;else return{found:!0,index:H}}return{found:!1,index:w}}})(i,typeof sax>"u"?r("./node_modules/sax/lib/sax.js"):sax,typeof imscNames>"u"?r("./node_modules/imsc/src/main/js/names.js"):imscNames,typeof imscStyles>"u"?r("./node_modules/imsc/src/main/js/styles.js"):imscStyles,typeof imscUtils>"u"?r("./node_modules/imsc/src/main/js/utils.js"):imscUtils)},"./node_modules/imsc/src/main/js/html.js":(g,i,r)=>{(function(d,o,l){d.render=function(v,I,D,y,A,x,F,k,W){var V=y||I.clientHeight,Q=A||I.clientWidth;if(v.aspectRatio!==null){var $=V*v.aspectRatio;$>Q?V=Math.round(Q/v.aspectRatio):Q=$}var K=document.createElement("div");K.style.position="relative",K.style.width=Q+"px",K.style.height=V+"px",K.style.margin="auto",K.style.top=0,K.style.bottom=0,K.style.left=0,K.style.right=0,K.style.zIndex=0;var Y={h:V,w:Q,regionH:null,regionW:null,imgResolver:D,displayForcedOnlyMode:x||!1,isd:v,errorHandler:F,previousISDState:k,enableRollUp:W||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null};I.appendChild(K);for(var re in v.contents)c(Y,K,v.contents[re]);return Y.currentISDState};function c(v,I,D){var y;if(D.kind==="region"?(y=document.createElement("div"),y.style.position="absolute"):D.kind==="body"||D.kind==="div"?y=document.createElement("div"):D.kind==="p"?y=document.createElement("p"):D.kind==="span"?y=document.createElement("span"):D.kind==="br"&&(y=document.createElement("br")),!y){C(v.errorHandler,"Error processing ISD element kind: "+D.kind);return}y.style.margin="0";for(var A in S){var x=S[A],F=D.styleAttrs[x.qname];F!==void 0&&x.map!==null&&x.map(v,y,D,F)}var k=y;if(D.kind==="region"){var W=D.styleAttrs[l.byName.writingMode.qname];W==="lrtb"||W==="lr"?(v.ipd="lr",v.bpd="tb"):W==="rltb"||W==="rl"?(v.ipd="rl",v.bpd="tb"):W==="tblr"?(v.ipd="tb",v.bpd="lr"):(W==="tbrl"||W==="tb")&&(v.ipd="tb",v.bpd="rl")}var V=D.styleAttrs[l.byName.linePadding.qname];if(V&&V>0){var Q=Math.ceil(V*v.h)+"px";v.bpd==="tb"?(k.style.paddingLeft=Q,k.style.paddingRight=Q):(k.style.paddingTop=Q,k.style.paddingBottom=Q),v.lp=V}var $=D.styleAttrs[l.byName.multiRowAlign.qname];if($&&$!=="auto"){var K=document.createElement("span");K.style.display="inline-block",K.style.textAlign=$,y.appendChild(K),k=K,v.mra=$}if(D.styleAttrs[l.byName.fillLineGap.qname]&&(v.flg=!0),D.kind==="span"&&D.text)if(v.lp||v.mra||v.flg)for(var Y="",re=0;re<D.text.length;re++){Y+=D.text.charAt(re);var ie=D.text.charCodeAt(re);if(ie<55296||ie>56319||re===D.text.length){var ee=document.createElement("span");ee.textContent=Y,y.appendChild(ee),Y=""}}else y.textContent=D.text;I.appendChild(y);for(var ne in D.contents)c(v,k,D.contents[ne]);var ae=[];if((v.lp||v.mra||v.flg)&&D.kind==="p"&&(P(v,k,ae,null),v.mra&&(m(ae),v.mra=null),v.lp&&(E(ae,v.lp*v.h,v),v.lp=null),v.flg)){var ce=L(k.getBoundingClientRect(),v);f(ae,ce.before,ce.after,v),v.flg=null}if(D.kind==="region"&&(P(v,k,ae),v.bpd==="tb"&&v.enableRollUp&&D.contents.length>0&&D.styleAttrs[l.byName.displayAlign.qname]==="after")){var X=D.id===""?"_":D.id,oe=new T(X,ae);if(v.currentISDState[oe.id]=oe,v.previousISDState&&oe.id in v.previousISDState&&v.previousISDState[oe.id].plist.length>0&&oe.plist.length>1&&oe.plist[oe.plist.length-2].text===v.previousISDState[oe.id].plist[v.previousISDState[oe.id].plist.length-1].text){var ge=y.firstElementChild,_e=oe.plist[oe.plist.length-1].after-oe.plist[oe.plist.length-1].before;ge.style.bottom="-"+_e+"px",ge.style.transition="transform 0.4s",ge.style.position="relative",ge.style.transform="translateY(-"+_e+"px)"}}}function E(v,I,D){for(var y in v){var A=v[y].elements.length,x=v[y].elements[v[y].start_elem],F=v[y].elements[v[y].end_elem],k=Math.ceil(I)+"px",W="-"+Math.ceil(I)+"px";A!==0&&(D.ipd==="lr"?(x.node.style.borderLeftColor=x.bgcolor||"#00000000",x.node.style.borderLeftStyle="solid",x.node.style.borderLeftWidth=k,x.node.style.marginLeft=W):D.ipd==="rl"?(x.node.style.borderRightColor=x.bgcolor||"#00000000",x.node.style.borderRightStyle="solid",x.node.style.borderRightWidth=k,x.node.style.marginRight=W):D.ipd==="tb"&&(x.node.style.borderTopColor=x.bgcolor||"#00000000",x.node.style.borderTopStyle="solid",x.node.style.borderTopWidth=k,x.node.style.marginTop=W),D.ipd==="lr"?(F.node.style.borderRightColor=F.bgcolor||"#00000000",F.node.style.borderRightStyle="solid",F.node.style.borderRightWidth=k,F.node.style.marginRight=W):D.ipd==="rl"?(F.node.style.borderLeftColor=F.bgcolor||"#00000000",F.node.style.borderLeftStyle="solid",F.node.style.borderLeftWidth=k,F.node.style.marginLeft=W):D.ipd==="tb"&&(F.node.style.borderBottomColor=F.bgcolor||"#00000000",F.node.style.borderBottomStyle="solid",F.node.style.borderBottomWidth=k,F.node.style.marginBottom=W))}}function m(v){for(var I=0;I<v.length-1;I++){var D=v[I].elements.length;if(D!==0&&v[I].br===!1){var y=document.createElement("br"),A=v[I].elements[D-1].node;A.parentElement.insertBefore(y,A.nextSibling)}}}function f(v,I,D,y){for(var A=Math.sign(D-I),x=0;x<=v.length;x++){var F;x===0?F=I:x===v.length?F=D:F=(v[x].before+v[x-1].after)/2;var k,W;if(x>0)for(var V=0;V<v[x-1].elements.length;V++)v[x-1].elements[V].bgcolor!==null&&(W=v[x-1].elements[V],A*(W.after-F)<0&&(k=Math.ceil(Math.abs(F-W.after))+"px",W.node.style.backgroundColor=W.bgcolor,y.bpd==="lr"?W.node.style.paddingRight=k:y.bpd==="rl"?W.node.style.paddingLeft=k:y.bpd==="tb"&&(W.node.style.paddingBottom=k)));if(x<v.length)for(var Q=0;Q<v[x].elements.length;Q++)W=v[x].elements[Q],W.bgcolor!==null&&A*(W.before-F)>0&&(k=Math.ceil(Math.abs(W.before-F))+"px",W.node.style.backgroundColor=W.bgcolor,y.bpd==="lr"?W.node.style.paddingLeft=k:y.bpd==="rl"?W.node.style.paddingRight=k:y.bpd==="tb"&&(W.node.style.paddingTop=k))}}function T(v,I){this.id=v,this.plist=I}function L(v,I){var D={before:null,after:null,start:null,end:null};return I.bpd==="tb"?(D.before=v.top,D.after=v.bottom,I.ipd==="lr"?(D.start=v.left,D.end=v.right):(D.start=v.right,D.end=v.left)):I.bpd==="lr"?(D.before=v.left,D.after=v.right,D.start=v.top,D.end=v.bottom):I.bpd==="rl"&&(D.before=v.right,D.after=v.left,D.start=v.top,D.end=v.bottom),D}function P(v,I,D,y){var A=I.style.backgroundColor||y;if(I.childElementCount===0)if(I.localName==="span"){var x=I.getBoundingClientRect();if(x.height===0||x.width===0)return;var F=L(x,v);if(D.length===0||!O(F.before,F.after,D[D.length-1].before,D[D.length-1].after))D.push({before:F.before,after:F.after,start:F.start,end:F.end,start_elem:0,end_elem:0,elements:[],text:"",br:!1});else{var k=Math.sign(F.after-F.before),W=Math.sign(F.end-F.start);k*(F.before-D[D.length-1].before)<0&&(D[D.length-1].before=F.before),k*(F.after-D[D.length-1].after)>0&&(D[D.length-1].after=F.after),W*(F.start-D[D.length-1].start)<0&&(D[D.length-1].start=F.start,D[D.length-1].start_elem=D[D.length-1].elements.length),W*(F.end-D[D.length-1].end)>0&&(D[D.length-1].end=F.end,D[D.length-1].end_elem=D[D.length-1].elements.length)}D[D.length-1].text+=I.textContent,D[D.length-1].elements.push({node:I,bgcolor:A,before:F.before,after:F.after})}else I.localName==="br"&&D.length!==0&&(D[D.length-1].br=!0);else for(var V=I.firstChild;V;)V.nodeType===Node.ELEMENT_NODE&&P(v,V,D,A),V=V.nextSibling}function O(v,I,D,y){return I<y&&v>D||y<=I&&D>=v}function M(v,I){this.qname=v,this.map=I}var S=[new M("http://www.w3.org/ns/ttml#styling backgroundColor",function(v,I,D,y){y[3]!==0&&(I.style.backgroundColor="rgba("+y[0].toString()+","+y[1].toString()+","+y[2].toString()+","+(y[3]/255).toString()+")")}),new M("http://www.w3.org/ns/ttml#styling color",function(v,I,D,y){I.style.color="rgba("+y[0].toString()+","+y[1].toString()+","+y[2].toString()+","+(y[3]/255).toString()+")"}),new M("http://www.w3.org/ns/ttml#styling direction",function(v,I,D,y){I.style.direction=y}),new M("http://www.w3.org/ns/ttml#styling display",function(v,I,D,y){}),new M("http://www.w3.org/ns/ttml#styling displayAlign",function(v,I,D,y){I.style.display="flex",I.style.flexDirection="column",y==="before"?I.style.justifyContent="flex-start":y==="center"?I.style.justifyContent="center":y==="after"&&(I.style.justifyContent="flex-end")}),new M("http://www.w3.org/ns/ttml#styling extent",function(v,I,D,y){v.regionH=y.h*v.h,v.regionW=y.w*v.w;var A=0,x=0,F=D.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];F&&(A=(F[0]+F[2])*v.h,x=(F[1]+F[3])*v.w),I.style.height=v.regionH-A+"px",I.style.width=v.regionW-x+"px"}),new M("http://www.w3.org/ns/ttml#styling fontFamily",function(v,I,D,y){var A=[];for(var x in y)y[x]==="monospaceSerif"?(A.push("Courier New"),A.push('"Liberation Mono"'),A.push("Courier"),A.push("monospace")):y[x]==="proportionalSansSerif"?(A.push("Arial"),A.push("Helvetica"),A.push('"Liberation Sans"'),A.push("sans-serif")):y[x]==="monospace"?A.push("monospace"):y[x]==="sansSerif"?A.push("sans-serif"):y[x]==="serif"?A.push("serif"):y[x]==="monospaceSansSerif"?(A.push("Consolas"),A.push("monospace")):y[x]==="proportionalSerif"?A.push("serif"):A.push(y[x]);I.style.fontFamily=A.join(",")}),new M("http://www.w3.org/ns/ttml#styling fontSize",function(v,I,D,y){I.style.fontSize=y*v.h+"px"}),new M("http://www.w3.org/ns/ttml#styling fontStyle",function(v,I,D,y){I.style.fontStyle=y}),new M("http://www.w3.org/ns/ttml#styling fontWeight",function(v,I,D,y){I.style.fontWeight=y}),new M("http://www.w3.org/ns/ttml#styling lineHeight",function(v,I,D,y){y==="normal"?I.style.lineHeight="normal":I.style.lineHeight=y*v.h+"px"}),new M("http://www.w3.org/ns/ttml#styling opacity",function(v,I,D,y){I.style.opacity=y}),new M("http://www.w3.org/ns/ttml#styling origin",function(v,I,D,y){I.style.top=y.h*v.h+"px",I.style.left=y.w*v.w+"px"}),new M("http://www.w3.org/ns/ttml#styling overflow",function(v,I,D,y){I.style.overflow=y}),new M("http://www.w3.org/ns/ttml#styling padding",function(v,I,D,y){var A=[];A[0]=y[0]*v.h+"px",A[1]=y[3]*v.w+"px",A[2]=y[2]*v.h+"px",A[3]=y[1]*v.w+"px",I.style.padding=A.join(" ")}),new M("http://www.w3.org/ns/ttml#styling showBackground",null),new M("http://www.w3.org/ns/ttml#styling textAlign",function(v,I,D,y){var A,x=D.styleAttrs[l.byName.direction.qname];y==="start"?A=x==="rtl"?"right":"left":y==="end"?A=x==="rtl"?"left":"right":A=y,I.style.textAlign=A}),new M("http://www.w3.org/ns/ttml#styling textDecoration",function(v,I,D,y){I.style.textDecoration=y.join(" ").replace("lineThrough","line-through")}),new M("http://www.w3.org/ns/ttml#styling textOutline",function(v,I,D,y){y==="none"?I.style.textShadow="":I.style.textShadow="rgba("+y.color[0].toString()+","+y.color[1].toString()+","+y.color[2].toString()+","+(y.color[3]/255).toString()+") 0px 0px "+y.thickness*v.h+"px"}),new M("http://www.w3.org/ns/ttml#styling unicodeBidi",function(v,I,D,y){var A;y==="bidiOverride"?A="bidi-override":A=y,I.style.unicodeBidi=A}),new M("http://www.w3.org/ns/ttml#styling visibility",function(v,I,D,y){I.style.visibility=y}),new M("http://www.w3.org/ns/ttml#styling wrapOption",function(v,I,D,y){y==="wrap"?D.space==="preserve"?I.style.whiteSpace="pre-wrap":I.style.whiteSpace="normal":D.space==="preserve"?I.style.whiteSpace="pre":I.style.whiteSpace="noWrap"}),new M("http://www.w3.org/ns/ttml#styling writingMode",function(v,I,D,y){y==="lrtb"||y==="lr"||y==="rltb"||y==="rl"?I.style.writingMode="horizontal-tb":y==="tblr"?I.style.writingMode="vertical-lr":(y==="tbrl"||y==="tb")&&(I.style.writingMode="vertical-rl")}),new M("http://www.w3.org/ns/ttml#styling zIndex",function(v,I,D,y){I.style.zIndex=y}),new M("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt backgroundImage",function(v,I,D,y){if(v.imgResolver!==null&&y!==null){var A=document.createElement("img"),x=v.imgResolver(y,A);x&&(A.src=x),A.height=v.regionH,A.width=v.regionW,I.appendChild(A)}}),new M("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",function(v,I,D,y){v.displayForcedOnlyMode&&y===!1&&(I.style.visibility="hidden")})],p={};for(var h in S)p[S[h].qname]=S[h];function C(v,I){if(v&&v.error&&v.error(I))throw I}})(i,typeof imscNames>"u"?r("./node_modules/imsc/src/main/js/names.js"):imscNames,typeof imscStyles>"u"?r("./node_modules/imsc/src/main/js/styles.js"):imscStyles)},"./node_modules/imsc/src/main/js/isd.js":(g,i,r)=>{(function(d,o,l){d.generateISD=function(P,O,M){var S=new f(P),p={};for(var h in P.head.layout.regions){var C=c(P,O,P.head.layout.regions[h],P.body,null,"",P.head.layout.regions[h],M,p);C!==null&&S.contents.push(C.element)}return S};function c(P,O,M,S,p,h,C,v,I){if(O<C.begin||O>=C.end)return null;var D="regionID"in C&&C.regionID!==""?C.regionID:h;if(p!==null&&D!==M.id&&(!("contents"in C)||"contents"in C&&C.contents.length===0||D!==""))return null;var y=new T(C);for(var A in C.sets)O<C.sets[A].begin||O>=C.sets[A].end||(y.styleAttrs[C.sets[A].qname]=C.sets[A].value);var x={};for(var F in y.styleAttrs)if(x[F]=!0,F===l.byName.writingMode.qname&&!(l.byName.direction.qname in y.styleAttrs)){var k=y.styleAttrs[F];k==="lrtb"||k==="lr"?y.styleAttrs[l.byName.direction.qname]="ltr":(k==="rltb"||k==="rl")&&(y.styleAttrs[l.byName.direction.qname]="rtl")}if(p!==null)for(var W in l.all){var V=l.all[W];if(V.qname===l.byName.textDecoration.qname){var Q=p.styleAttrs[V.qname],$=y.styleAttrs[V.qname],K=[];$===void 0?K=Q:$.indexOf("none")===-1?(($.indexOf("noUnderline")===-1&&Q.indexOf("underline")!==-1||$.indexOf("underline")!==-1)&&K.push("underline"),($.indexOf("noLineThrough")===-1&&Q.indexOf("lineThrough")!==-1||$.indexOf("lineThrough")!==-1)&&K.push("lineThrough"),($.indexOf("noOverline")===-1&&Q.indexOf("overline")!==-1||$.indexOf("overline")!==-1)&&K.push("overline")):K.push("none"),y.styleAttrs[V.qname]=K}else V.inherit&&V.qname in p.styleAttrs&&!(V.qname in y.styleAttrs)&&(y.styleAttrs[V.qname]=p.styleAttrs[V.qname])}for(var Y in l.all){var re=l.all[Y];re.qname in y.styleAttrs||(y.kind==="region"||re.inherit===!1&&re.initial!==null)&&(y.styleAttrs[re.qname]=re.parse(re.initial),x[re.qname]=!0)}for(var ie in l.all){var ee=l.all[ie];if(ee.qname in x&&ee.compute!==null){var ne=ee.compute(P,p,y,y.styleAttrs[ee.qname],I);ne!==null?y.styleAttrs[ee.qname]=ne:L(v,"Style '"+ee.qname+"' on element '"+y.kind+"' cannot be computed")}}if(y.styleAttrs[l.byName.display.qname]==="none")return null;var ae;p===null?S===null?ae=[]:ae=[S]:"contents"in C&&(ae=C.contents);for(var ce in ae){var X=c(P,O,M,S,y,D,ae[ce],v,I);X!==null&&y.contents.push(X.element)}for(var oe in y.styleAttrs){var ge=l.byQName[oe];ge.applies.indexOf(y.kind)===-1&&delete y.styleAttrs[oe]}if(y.kind==="span"&&y.text&&y.space==="default"){var _e=y.text.replace(/\s+/g," ");y.text=_e}if(y.kind==="p"){var he=[];E(y,he);for(var se=0,Z="after_br",q=0;;)if(Z==="after_br")se>=he.length||he[se].kind==="br"?(Z="before_br",q=se,se--):(he[se].space!=="preserve"&&(he[se].text=he[se].text.replace(/^\s+/g,"")),he[se].text.length>0?(Z="looking_br",se++):he.splice(se,1));else if(Z==="before_br")if(se<0||he[se].kind==="br"){if(Z="after_br",se=q+1,se>=he.length)break}else if(he[se].space!=="preserve"&&(he[se].text=he[se].text.replace(/\s+$/g,"")),he[se].text.length>0){if(Z="after_br",se=q+1,se>=he.length)break}else he.splice(se,1),se--;else se>=he.length||he[se].kind==="br"?(Z="before_br",q=se,se--):se++;m(y)}return y.kind==="div"&&l.byName.backgroundImage.qname in y.styleAttrs||y.kind==="br"||"contents"in y&&y.contents.length>0||y.kind==="span"&&y.text!==null||y.kind==="region"&&y.styleAttrs[l.byName.showBackground.qname]==="always"?{region_id:D,element:y}:null}function E(P,O){if("contents"in P)for(var M in P.contents)E(P.contents[M],O);else O.push(P)}function m(P){if(P.kind==="br")return!1;if("text"in P)return P.text.length===0;if("contents"in P){for(var O=P.contents.length;O--;)m(P.contents[O])&&P.contents.splice(O,1);return P.contents.length===0}}function f(P){this.contents=[],this.aspectRatio=P.aspectRatio}function T(P){this.kind=P.kind||"region",P.id&&(this.id=P.id),this.styleAttrs={};for(var O in P.styleAttrs)this.styleAttrs[O]=P.styleAttrs[O];"text"in P?this.text=P.text:P.kind!=="br"&&(this.contents=[]),"space"in P&&(this.space=P.space)}function L(P,O){if(P&&P.error&&P.error(O))throw O}})(i,typeof imscNames>"u"?r("./node_modules/imsc/src/main/js/names.js"):imscNames,typeof imscStyles>"u"?r("./node_modules/imsc/src/main/js/styles.js"):imscStyles)},"./node_modules/imsc/src/main/js/main.js":(g,i,r)=>{i.generateISD=r("./node_modules/imsc/src/main/js/isd.js").generateISD,i.fromXML=r("./node_modules/imsc/src/main/js/doc.js").fromXML,i.renderHTML=r("./node_modules/imsc/src/main/js/html.js").render},"./node_modules/imsc/src/main/js/names.js":(g,i)=>{(function(r){r.ns_tt="http://www.w3.org/ns/ttml",r.ns_tts="http://www.w3.org/ns/ttml#styling",r.ns_ttp="http://www.w3.org/ns/ttml#parameter",r.ns_xml="http://www.w3.org/XML/1998/namespace",r.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",r.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",r.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",r.ns_ebutts="urn:ebu:tt:style"})(i)},"./node_modules/imsc/src/main/js/styles.js":(g,i,r)=>{(function(d,o,l){function c(f,T,L,P,O,M,S,p){this.name=T,this.ns=f,this.qname=f+" "+T,this.inherit=O,this.animatable=M,this.initial=L,this.applies=P,this.parse=S,this.compute=p}d.all=[new c(o.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,l.parseColor,null),new c(o.ns_tts,"color","white",["span"],!0,!0,l.parseColor,null),new c(o.ns_tts,"direction","ltr",["p","span"],!0,!0,function(f){return f},null),new c(o.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,function(f){return f},null),new c(o.ns_tts,"displayAlign","before",["region"],!1,!0,function(f){return f},null),new c(o.ns_tts,"extent","auto",["tt","region"],!1,!0,function(f){if(f==="auto")return f;var T=f.split(" ");if(T.length!==2)return null;var L=l.parseLength(T[0]),P=l.parseLength(T[1]);return!P||!L?null:{h:P,w:L}},function(f,T,L,P,O){var M,S;if(P==="auto")M=1;else if(P.h.unit==="%")M=P.h.value/100;else if(P.h.unit==="px")M=P.h.value/f.pxDimensions.h;else return null;if(P==="auto")S=1;else if(P.w.unit==="%")S=P.w.value/100;else if(P.w.unit==="px")S=P.w.value/f.pxDimensions.w;else return null;return{h:M,w:S}}),new c(o.ns_tts,"fontFamily","default",["span"],!0,!0,function(f){var T=f.split(","),L=[];for(var P in T)T[P].charAt(0)!=="'"&&T[P].charAt(0)!=='"'&&T[P]==="default"?L.push("monospaceSerif"):L.push(T[P]);return L},null),new c(o.ns_tts,"fontSize","1c",["span"],!0,!0,l.parseLength,function(f,T,L,P,O){var M;if(P.unit==="%")T!==null?M=T.styleAttrs[d.byName.fontSize.qname]*P.value/100:M=P.value/100/f.cellResolution.h;else if(P.unit==="em")T!==null?M=T.styleAttrs[d.byName.fontSize.qname]*P.value:M=P.value/f.cellResolution.h;else if(P.unit==="c")M=P.value/f.cellResolution.h;else if(P.unit==="px")M=P.value/f.pxDimensions.h;else return null;return M}),new c(o.ns_tts,"fontStyle","normal",["span"],!0,!0,function(f){return f},null),new c(o.ns_tts,"fontWeight","normal",["span"],!0,!0,function(f){return f},null),new c(o.ns_tts,"lineHeight","normal",["p"],!0,!0,function(f){return f==="normal"?f:l.parseLength(f)},function(f,T,L,P,O){var M;if(P==="normal")M=P;else if(P.unit==="%")M=L.styleAttrs[d.byName.fontSize.qname]*P.value/100;else if(P.unit==="em")M=L.styleAttrs[d.byName.fontSize.qname]*P.value;else if(P.unit==="c")M=P.value/f.cellResolution.h;else if(P.unit==="px")M=P.value/f.pxDimensions.h;else return null;return M}),new c(o.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new c(o.ns_tts,"origin","auto",["region"],!1,!0,function(f){if(f==="auto")return f;var T=f.split(" ");if(T.length!==2)return null;var L=l.parseLength(T[0]),P=l.parseLength(T[1]);return!P||!L?null:{h:P,w:L}},function(f,T,L,P,O){var M,S;if(P==="auto")M=0;else if(P.h.unit==="%")M=P.h.value/100;else if(P.h.unit==="px")M=P.h.value/f.pxDimensions.h;else return null;if(P==="auto")S=0;else if(P.w.unit==="%")S=P.w.value/100;else if(P.w.unit==="px")S=P.w.value/f.pxDimensions.w;else return null;return{h:M,w:S}}),new c(o.ns_tts,"overflow","hidden",["region"],!1,!0,function(f){return f},null),new c(o.ns_tts,"padding","0px",["region"],!1,!0,function(f){var T=f.split(" ");if(T.length>4)return null;var L=[];for(var P in T){var O=l.parseLength(T[P]);if(!O)return null;L.push(O)}return L},function(f,T,L,P,O){var M;if(P.length===1)M=[P[0],P[0],P[0],P[0]];else if(P.length===2)M=[P[0],P[1],P[0],P[1]];else if(P.length===3)M=[P[0],P[1],P[2],P[1]];else if(P.length===4)M=[P[0],P[1],P[2],P[3]];else return null;var S=L.styleAttrs[d.byName.writingMode.qname];if(S==="lrtb"||S==="lr")M=[M[0],M[3],M[2],M[1]];else if(S==="rltb"||S==="rl")M=[M[0],M[1],M[2],M[3]];else if(S==="tblr")M=[M[3],M[0],M[1],M[2]];else if(S==="tbrl"||S==="tb")M=[M[3],M[2],M[1],M[0]];else return null;var p=[];for(var h in M)if(M[h].value===0)p[h]=0;else if(M[h].unit==="%")h==="0"||h==="2"?p[h]=L.styleAttrs[d.byName.extent.qname].h*M[h].value/100:p[h]=L.styleAttrs[d.byName.extent.qname].w*M[h].value/100;else if(M[h].unit==="em")p[h]=L.styleAttrs[d.byName.fontSize.qname]*M[h].value;else if(M[h].unit==="c")p[h]=M[h].value/f.cellResolution.h;else if(M[h].unit==="px")h==="0"||h==="2"?p[h]=M[h].value/f.pxDimensions.h:p[h]=M[h].value/f.pxDimensions.w;else return null;return p}),new c(o.ns_tts,"showBackground","always",["region"],!1,!0,function(f){return f},null),new c(o.ns_tts,"textAlign","start",["p"],!0,!0,function(f){return f},function(f,T,L,P,O){return P==="left"?"start":P==="right"?"end":P}),new c(o.ns_tts,"textDecoration","none",["span"],!0,!0,function(f){return f.split(" ")},null),new c(o.ns_tts,"textOutline","none",["span"],!0,!0,function(f){if(f==="none")return f;var T={},L=f.split(" ");if(L.length===0||L.length>2)return null;var P=l.parseColor(L[0]);if(T.color=P,P!==null&&L.shift(),L.length!==1)return null;var O=l.parseLength(L[0]);return O?(T.thickness=O,T):null},function(f,T,L,P,O){if(P==="none")return P;var M={};if(P.color===null?M.color=L.styleAttrs[d.byName.color.qname]:M.color=P.color,P.thickness.unit==="%")M.thickness=L.styleAttrs[d.byName.fontSize.qname]*P.thickness.value/100;else if(P.thickness.unit==="em")M.thickness=L.styleAttrs[d.byName.fontSize.qname]*P.thickness.value;else if(P.thickness.unit==="c")M.thickness=P.thickness.value/f.cellResolution.h;else if(P.thickness.unit==="px")M.thickness=P.thickness.value/f.pxDimensions.h;else return null;return M}),new c(o.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,function(f){return f},null),new c(o.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,function(f){return f},null),new c(o.ns_tts,"wrapOption","wrap",["span"],!0,!0,function(f){return f},null),new c(o.ns_tts,"writingMode","lrtb",["region"],!1,!0,function(f){return f},null),new c(o.ns_tts,"zIndex","auto",["region"],!1,!0,function(f){var T;return f==="auto"?T=f:(T=parseInt(f),isNaN(T)&&(T=null)),T},null),new c(o.ns_ebutts,"linePadding","0c",["p"],!0,!1,l.parseLength,function(f,T,L,P,O){return P.unit==="c"?P.value/f.cellResolution.h:null}),new c(o.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,function(f){return f},null),new c(o.ns_smpte,"backgroundImage",null,["div"],!1,!1,function(f){return f},null),new c(o.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,function(f){return f==="true"},null),new c(o.ns_itts,"fillLineGap","false",["p"],!0,!0,function(f){return f==="true"},null)],d.byQName={};for(var E in d.all)d.byQName[d.all[E].qname]=d.all[E];d.byName={};for(var m in d.all)d.byName[d.all[m].name]=d.all[m]})(i,typeof imscNames>"u"?r("./node_modules/imsc/src/main/js/names.js"):imscNames,typeof imscUtils>"u"?r("./node_modules/imsc/src/main/js/utils.js"):imscUtils)},"./node_modules/imsc/src/main/js/utils.js":(g,i)=>{(function(r){var d=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,o=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,l=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,c={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};r.parseColor=function(m){var f,T=null,L=c[m.toLowerCase()];return L!==void 0?T=L:(f=d.exec(m))!==null?T=[parseInt(f[1],16),parseInt(f[2],16),parseInt(f[3],16),f[4]!==void 0?parseInt(f[4],16):255]:(f=o.exec(m))!==null?T=[parseInt(f[1]),parseInt(f[2]),parseInt(f[3]),255]:(f=l.exec(m))!==null&&(T=[parseInt(f[1]),parseInt(f[2]),parseInt(f[3]),parseInt(f[4])]),T};var E=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%)$/;r.parseLength=function(m){var f,T=null;return(f=E.exec(m))!==null&&(T={value:parseFloat(f[1]),unit:f[2]}),T}})(i)},"./node_modules/is-alphabetical/index.js":g=>{g.exports=i;function i(r){var d=typeof r=="string"?r.charCodeAt(0):r;return d>=97&&d<=122||d>=65&&d<=90}},"./node_modules/is-alphanumerical/index.js":(g,i,r)=>{var d=r("./node_modules/is-alphabetical/index.js"),o=r("./node_modules/is-decimal/index.js");g.exports=l;function l(c){return d(c)||o(c)}},"./node_modules/is-decimal/index.js":g=>{g.exports=i;function i(r){var d=typeof r=="string"?r.charCodeAt(0):r;return d>=48&&d<=57}},"./node_modules/path-browserify/index.js":g=>{function i(l){if(typeof l!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(l))}function r(l,c){for(var E="",m=0,f=-1,T=0,L,P=0;P<=l.length;++P){if(P<l.length)L=l.charCodeAt(P);else{if(L===47)break;L=47}if(L===47){if(!(f===P-1||T===1))if(f!==P-1&&T===2){if(E.length<2||m!==2||E.charCodeAt(E.length-1)!==46||E.charCodeAt(E.length-2)!==46){if(E.length>2){var O=E.lastIndexOf("/");if(O!==E.length-1){O===-1?(E="",m=0):(E=E.slice(0,O),m=E.length-1-E.lastIndexOf("/")),f=P,T=0;continue}}else if(E.length===2||E.length===1){E="",m=0,f=P,T=0;continue}}c&&(E.length>0?E+="/..":E="..",m=2)}else E.length>0?E+="/"+l.slice(f+1,P):E=l.slice(f+1,P),m=P-f-1;f=P,T=0}else L===46&&T!==-1?++T:T=-1}return E}function d(l,c){var E=c.dir||c.root,m=c.base||(c.name||"")+(c.ext||"");return E?E===c.root?E+m:E+l+m:m}var o={resolve:function(){for(var c="",E=!1,m,f=arguments.length-1;f>=-1&&!E;f--){var T;f>=0?T=arguments[f]:(m===void 0&&(m=process.cwd()),T=m),i(T),T.length!==0&&(c=T+"/"+c,E=T.charCodeAt(0)===47)}return c=r(c,!E),E?c.length>0?"/"+c:"/":c.length>0?c:"."},normalize:function(c){if(i(c),c.length===0)return".";var E=c.charCodeAt(0)===47,m=c.charCodeAt(c.length-1)===47;return c=r(c,!E),c.length===0&&!E&&(c="."),c.length>0&&m&&(c+="/"),E?"/"+c:c},isAbsolute:function(c){return i(c),c.length>0&&c.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var c,E=0;E<arguments.length;++E){var m=arguments[E];i(m),m.length>0&&(c===void 0?c=m:c+="/"+m)}return c===void 0?".":o.normalize(c)},relative:function(c,E){if(i(c),i(E),c===E||(c=o.resolve(c),E=o.resolve(E),c===E))return"";for(var m=1;m<c.length&&c.charCodeAt(m)===47;++m);for(var f=c.length,T=f-m,L=1;L<E.length&&E.charCodeAt(L)===47;++L);for(var P=E.length,O=P-L,M=T<O?T:O,S=-1,p=0;p<=M;++p){if(p===M){if(O>M){if(E.charCodeAt(L+p)===47)return E.slice(L+p+1);if(p===0)return E.slice(L+p)}else T>M&&(c.charCodeAt(m+p)===47?S=p:p===0&&(S=0));break}var h=c.charCodeAt(m+p),C=E.charCodeAt(L+p);if(h!==C)break;h===47&&(S=p)}var v="";for(p=m+S+1;p<=f;++p)(p===f||c.charCodeAt(p)===47)&&(v.length===0?v+="..":v+="/..");return v.length>0?v+E.slice(L+S):(L+=S,E.charCodeAt(L)===47&&++L,E.slice(L))},_makeLong:function(c){return c},dirname:function(c){if(i(c),c.length===0)return".";for(var E=c.charCodeAt(0),m=E===47,f=-1,T=!0,L=c.length-1;L>=1;--L)if(E=c.charCodeAt(L),E===47){if(!T){f=L;break}}else T=!1;return f===-1?m?"/":".":m&&f===1?"//":c.slice(0,f)},basename:function(c,E){if(E!==void 0&&typeof E!="string")throw new TypeError('"ext" argument must be a string');i(c);var m=0,f=-1,T=!0,L;if(E!==void 0&&E.length>0&&E.length<=c.length){if(E.length===c.length&&E===c)return"";var P=E.length-1,O=-1;for(L=c.length-1;L>=0;--L){var M=c.charCodeAt(L);if(M===47){if(!T){m=L+1;break}}else O===-1&&(T=!1,O=L+1),P>=0&&(M===E.charCodeAt(P)?--P===-1&&(f=L):(P=-1,f=O))}return m===f?f=O:f===-1&&(f=c.length),c.slice(m,f)}else{for(L=c.length-1;L>=0;--L)if(c.charCodeAt(L)===47){if(!T){m=L+1;break}}else f===-1&&(T=!1,f=L+1);return f===-1?"":c.slice(m,f)}},extname:function(c){i(c);for(var E=-1,m=0,f=-1,T=!0,L=0,P=c.length-1;P>=0;--P){var O=c.charCodeAt(P);if(O===47){if(!T){m=P+1;break}continue}f===-1&&(T=!1,f=P+1),O===46?E===-1?E=P:L!==1&&(L=1):E!==-1&&(L=-1)}return E===-1||f===-1||L===0||L===1&&E===f-1&&E===m+1?"":c.slice(E,f)},format:function(c){if(c===null||typeof c!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof c);return d("/",c)},parse:function(c){i(c);var E={root:"",dir:"",base:"",ext:"",name:""};if(c.length===0)return E;var m=c.charCodeAt(0),f=m===47,T;f?(E.root="/",T=1):T=0;for(var L=-1,P=0,O=-1,M=!0,S=c.length-1,p=0;S>=T;--S){if(m=c.charCodeAt(S),m===47){if(!M){P=S+1;break}continue}O===-1&&(M=!1,O=S+1),m===46?L===-1?L=S:p!==1&&(p=1):L!==-1&&(p=-1)}return L===-1||O===-1||p===0||p===1&&L===O-1&&L===P+1?O!==-1&&(P===0&&f?E.base=E.name=c.slice(1,O):E.base=E.name=c.slice(P,O)):(P===0&&f?(E.name=c.slice(1,L),E.base=c.slice(1,O)):(E.name=c.slice(P,L),E.base=c.slice(P,O)),E.ext=c.slice(L,O)),P>0?E.dir=c.slice(0,P-1):f&&(E.dir="/"),E},sep:"/",delimiter:":",win32:null,posix:null};o.posix=o,g.exports=o},"./node_modules/safe-buffer/index.js":(g,i,r)=>{var d=r("./node_modules/buffer/index.js"),o=d.Buffer;function l(E,m){for(var f in E)m[f]=E[f]}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?g.exports=d:(l(d,i),i.Buffer=c);function c(E,m,f){return o(E,m,f)}l(o,c),c.from=function(E,m,f){if(typeof E=="number")throw new TypeError("Argument must not be a number");return o(E,m,f)},c.alloc=function(E,m,f){if(typeof E!="number")throw new TypeError("Argument must be a number");var T=o(E);return m!==void 0?typeof f=="string"?T.fill(m,f):T.fill(m):T.fill(0),T},c.allocUnsafe=function(E){if(typeof E!="number")throw new TypeError("Argument must be a number");return o(E)},c.allocUnsafeSlow=function(E){if(typeof E!="number")throw new TypeError("Argument must be a number");return d.SlowBuffer(E)}},"./node_modules/sax/lib/sax.js":(g,i,r)=>{(function(d){d.parser=function(N,R){return new l(N,R)},d.SAXParser=l,d.SAXStream=P,d.createStream=L,d.MAX_BUFFER_LENGTH=65536;var o=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];d.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function l(N,R){if(!(this instanceof l))return new l(N,R);var w=this;E(w),w.q=w.c="",w.bufferCheckPosition=d.MAX_BUFFER_LENGTH,w.opt=R||{},w.opt.lowercase=w.opt.lowercase||w.opt.lowercasetags,w.looseCase=w.opt.lowercase?"toLowerCase":"toUpperCase",w.tags=[],w.closed=w.closedRoot=w.sawRoot=!1,w.tag=w.error=null,w.strict=!!N,w.noscript=!!(N||w.opt.noscript),w.state=K.BEGIN,w.strictEntities=w.opt.strictEntities,w.ENTITIES=w.strictEntities?Object.create(d.XML_ENTITIES):Object.create(d.ENTITIES),w.attribList=[],w.opt.xmlns&&(w.ns=Object.create(y)),w.trackPosition=w.opt.position!==!1,w.trackPosition&&(w.position=w.line=w.column=0),re(w,"onready")}Object.create||(Object.create=function(N){function R(){}R.prototype=N;var w=new R;return w}),Object.keys||(Object.keys=function(N){var R=[];for(var w in N)N.hasOwnProperty(w)&&R.push(w);return R});function c(N){for(var R=Math.max(d.MAX_BUFFER_LENGTH,10),w=0,j=0,H=o.length;j<H;j++){var U=N[o[j]].length;if(U>R)switch(o[j]){case"textNode":ee(N);break;case"cdata":ie(N,"oncdata",N.cdata),N.cdata="";break;case"script":ie(N,"onscript",N.script),N.script="";break;default:ae(N,"Max buffer length exceeded: "+o[j])}w=Math.max(w,U)}var B=d.MAX_BUFFER_LENGTH-w;N.bufferCheckPosition=B+N.position}function E(N){for(var R=0,w=o.length;R<w;R++)N[o[R]]=""}function m(N){ee(N),N.cdata!==""&&(ie(N,"oncdata",N.cdata),N.cdata=""),N.script!==""&&(ie(N,"onscript",N.script),N.script="")}l.prototype={end:function(){ce(this)},write:te,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){m(this)}};var f;try{f=r("./node_modules/stream-browserify/index.js").Stream}catch{f=function(){}}var T=d.EVENTS.filter(function(N){return N!=="error"&&N!=="end"});function L(N,R){return new P(N,R)}function P(N,R){if(!(this instanceof P))return new P(N,R);f.apply(this),this._parser=new l(N,R),this.writable=!0,this.readable=!0;var w=this;this._parser.onend=function(){w.emit("end")},this._parser.onerror=function(j){w.emit("error",j),w._parser.error=null},this._decoder=null,T.forEach(function(j){Object.defineProperty(w,"on"+j,{get:function(){return w._parser["on"+j]},set:function(H){if(!H)return w.removeAllListeners(j),w._parser["on"+j]=H,H;w.on(j,H)},enumerable:!0,configurable:!1})})}P.prototype=Object.create(f.prototype,{constructor:{value:P}}),P.prototype.write=function(N){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(N)){if(!this._decoder){var R=r("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder;this._decoder=new R("utf8")}N=this._decoder.write(N)}return this._parser.write(N.toString()),this.emit("data",N),!0},P.prototype.end=function(N){return N&&N.length&&this.write(N),this._parser.end(),!0},P.prototype.on=function(N,R){var w=this;return!w._parser["on"+N]&&T.indexOf(N)!==-1&&(w._parser["on"+N]=function(){var j=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);j.splice(0,0,N),w.emit.apply(w,j)}),f.prototype.on.call(w,N,R)};var O=`\r
	 `,M="0124356789",S="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",p=`'"`,h=O+">",C="[CDATA[",v="DOCTYPE",I="http://www.w3.org/XML/1998/namespace",D="http://www.w3.org/2000/xmlns/",y={xml:I,xmlns:D};O=W(O),M=W(M),S=W(S);var A=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,x=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,F=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,k=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;p=W(p),h=W(h);function W(N){return N.split("").reduce(function(R,w){return R[w]=!0,R},{})}function V(N){return Object.prototype.toString.call(N)==="[object RegExp]"}function Q(N,R){return V(N)?!!R.match(N):N[R]}function $(N,R){return!Q(N,R)}var K=0;d.STATE={BEGIN:K++,BEGIN_WHITESPACE:K++,TEXT:K++,TEXT_ENTITY:K++,OPEN_WAKA:K++,SGML_DECL:K++,SGML_DECL_QUOTED:K++,DOCTYPE:K++,DOCTYPE_QUOTED:K++,DOCTYPE_DTD:K++,DOCTYPE_DTD_QUOTED:K++,COMMENT_STARTING:K++,COMMENT:K++,COMMENT_ENDING:K++,COMMENT_ENDED:K++,CDATA:K++,CDATA_ENDING:K++,CDATA_ENDING_2:K++,PROC_INST:K++,PROC_INST_BODY:K++,PROC_INST_ENDING:K++,OPEN_TAG:K++,OPEN_TAG_SLASH:K++,ATTRIB:K++,ATTRIB_NAME:K++,ATTRIB_NAME_SAW_WHITE:K++,ATTRIB_VALUE:K++,ATTRIB_VALUE_QUOTED:K++,ATTRIB_VALUE_CLOSED:K++,ATTRIB_VALUE_UNQUOTED:K++,ATTRIB_VALUE_ENTITY_Q:K++,ATTRIB_VALUE_ENTITY_U:K++,CLOSE_TAG:K++,CLOSE_TAG_SAW_WHITE:K++,SCRIPT:K++,SCRIPT_ENDING:K++},d.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},d.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(d.ENTITIES).forEach(function(N){var R=d.ENTITIES[N],w=typeof R=="number"?String.fromCharCode(R):R;d.ENTITIES[N]=w});for(var Y in d.STATE)d.STATE[d.STATE[Y]]=Y;K=d.STATE;function re(N,R,w){N[R]&&N[R](w)}function ie(N,R,w){N.textNode&&ee(N),re(N,R,w)}function ee(N){N.textNode=ne(N.opt,N.textNode),N.textNode&&re(N,"ontext",N.textNode),N.textNode=""}function ne(N,R){return N.trim&&(R=R.trim()),N.normalize&&(R=R.replace(/\s+/g," ")),R}function ae(N,R){return ee(N),N.trackPosition&&(R+=`
Line: `+N.line+`
Column: `+N.column+`
Char: `+N.c),R=new Error(R),N.error=R,re(N,"onerror",R),N}function ce(N){return N.sawRoot&&!N.closedRoot&&X(N,"Unclosed root tag"),N.state!==K.BEGIN&&N.state!==K.BEGIN_WHITESPACE&&N.state!==K.TEXT&&ae(N,"Unexpected end"),ee(N),N.c="",N.closed=!0,re(N,"onend"),l.call(N,N.strict,N.opt),N}function X(N,R){if(typeof N!="object"||!(N instanceof l))throw new Error("bad call to strictFail");N.strict&&ae(N,R)}function oe(N){N.strict||(N.tagName=N.tagName[N.looseCase]());var R=N.tags[N.tags.length-1]||N,w=N.tag={name:N.tagName,attributes:{}};N.opt.xmlns&&(w.ns=R.ns),N.attribList.length=0,ie(N,"onopentagstart",w)}function ge(N,R){var w=N.indexOf(":"),j=w<0?["",N]:N.split(":"),H=j[0],U=j[1];return R&&N==="xmlns"&&(H="xmlns",U=""),{prefix:H,local:U}}function _e(N){if(N.strict||(N.attribName=N.attribName[N.looseCase]()),N.attribList.indexOf(N.attribName)!==-1||N.tag.attributes.hasOwnProperty(N.attribName)){N.attribName=N.attribValue="";return}if(N.opt.xmlns){var R=ge(N.attribName,!0),w=R.prefix,j=R.local;if(w==="xmlns")if(j==="xml"&&N.attribValue!==I)X(N,"xml: prefix must be bound to "+I+`
Actual: `+N.attribValue);else if(j==="xmlns"&&N.attribValue!==D)X(N,"xmlns: prefix must be bound to "+D+`
Actual: `+N.attribValue);else{var H=N.tag,U=N.tags[N.tags.length-1]||N;H.ns===U.ns&&(H.ns=Object.create(U.ns)),H.ns[j]=N.attribValue}N.attribList.push([N.attribName,N.attribValue])}else N.tag.attributes[N.attribName]=N.attribValue,ie(N,"onattribute",{name:N.attribName,value:N.attribValue});N.attribName=N.attribValue=""}function he(N,R){if(N.opt.xmlns){var w=N.tag,j=ge(N.tagName);w.prefix=j.prefix,w.local=j.local,w.uri=w.ns[j.prefix]||"",w.prefix&&!w.uri&&(X(N,"Unbound namespace prefix: "+JSON.stringify(N.tagName)),w.uri=j.prefix);var H=N.tags[N.tags.length-1]||N;w.ns&&H.ns!==w.ns&&Object.keys(w.ns).forEach(function(be){ie(N,"onopennamespace",{prefix:be,uri:w.ns[be]})});for(var U=0,B=N.attribList.length;U<B;U++){var G=N.attribList[U],z=G[0],fe=G[1],ue=ge(z,!0),J=ue.prefix,ve=ue.local,me=J===""?"":w.ns[J]||"",Ae={name:z,value:fe,prefix:J,local:ve,uri:me};J&&J!=="xmlns"&&!me&&(X(N,"Unbound namespace prefix: "+JSON.stringify(J)),Ae.uri=J),N.tag.attributes[z]=Ae,ie(N,"onattribute",Ae)}N.attribList.length=0}N.tag.isSelfClosing=!!R,N.sawRoot=!0,N.tags.push(N.tag),ie(N,"onopentag",N.tag),R||(!N.noscript&&N.tagName.toLowerCase()==="script"?N.state=K.SCRIPT:N.state=K.TEXT,N.tag=null,N.tagName=""),N.attribName=N.attribValue="",N.attribList.length=0}function se(N){if(!N.tagName){X(N,"Weird empty close tag."),N.textNode+="</>",N.state=K.TEXT;return}if(N.script){if(N.tagName!=="script"){N.script+="</"+N.tagName+">",N.tagName="",N.state=K.SCRIPT;return}ie(N,"onscript",N.script),N.script=""}var R=N.tags.length,w=N.tagName;N.strict||(w=w[N.looseCase]());for(var j=w;R--;){var H=N.tags[R];if(H.name!==j)X(N,"Unexpected close tag");else break}if(R<0){X(N,"Unmatched closing tag: "+N.tagName),N.textNode+="</"+N.tagName+">",N.state=K.TEXT;return}N.tagName=w;for(var U=N.tags.length;U-- >R;){var B=N.tag=N.tags.pop();N.tagName=N.tag.name,ie(N,"onclosetag",N.tagName);var G={};for(var z in B.ns)G[z]=B.ns[z];var fe=N.tags[N.tags.length-1]||N;N.opt.xmlns&&B.ns!==fe.ns&&Object.keys(B.ns).forEach(function(ue){var J=B.ns[ue];ie(N,"onclosenamespace",{prefix:ue,uri:J})})}R===0&&(N.closedRoot=!0),N.tagName=N.attribValue=N.attribName="",N.attribList.length=0,N.state=K.TEXT}function Z(N){var R=N.entity,w=R.toLowerCase(),j,H="";return N.ENTITIES[R]?N.ENTITIES[R]:N.ENTITIES[w]?N.ENTITIES[w]:(R=w,R.charAt(0)==="#"&&(R.charAt(1)==="x"?(R=R.slice(2),j=parseInt(R,16),H=j.toString(16)):(R=R.slice(1),j=parseInt(R,10),H=j.toString(10))),R=R.replace(/^0+/,""),H.toLowerCase()!==R?(X(N,"Invalid character entity"),"&"+N.entity+";"):String.fromCodePoint(j))}function q(N,R){R==="<"?(N.state=K.OPEN_WAKA,N.startTagPosition=N.position):$(O,R)&&(X(N,"Non-whitespace before first tag."),N.textNode=R,N.state=K.TEXT)}function le(N,R){var w="";return R<N.length&&(w=N.charAt(R)),w}function te(N){var R=this;if(this.error)throw this.error;if(R.closed)return ae(R,"Cannot write after close. Assign an onready handler.");if(N===null)return ce(R);typeof N=="object"&&(N=N.toString());for(var w=0,j="";j=le(N,w++),R.c=j,!!j;)switch(R.trackPosition&&(R.position++,j===`
`?(R.line++,R.column=0):R.column++),R.state){case K.BEGIN:if(R.state=K.BEGIN_WHITESPACE,j==="\uFEFF")continue;q(R,j);continue;case K.BEGIN_WHITESPACE:q(R,j);continue;case K.TEXT:if(R.sawRoot&&!R.closedRoot){for(var H=w-1;j&&j!=="<"&&j!=="&";)j=le(N,w++),j&&R.trackPosition&&(R.position++,j===`
`?(R.line++,R.column=0):R.column++);R.textNode+=N.substring(H,w-1)}j==="<"&&!(R.sawRoot&&R.closedRoot&&!R.strict)?(R.state=K.OPEN_WAKA,R.startTagPosition=R.position):($(O,j)&&(!R.sawRoot||R.closedRoot)&&X(R,"Text data outside of root node."),j==="&"?R.state=K.TEXT_ENTITY:R.textNode+=j);continue;case K.SCRIPT:j==="<"?R.state=K.SCRIPT_ENDING:R.script+=j;continue;case K.SCRIPT_ENDING:j==="/"?R.state=K.CLOSE_TAG:(R.script+="<"+j,R.state=K.SCRIPT);continue;case K.OPEN_WAKA:if(j==="!")R.state=K.SGML_DECL,R.sgmlDecl="";else if(!Q(O,j))if(Q(A,j))R.state=K.OPEN_TAG,R.tagName=j;else if(j==="/")R.state=K.CLOSE_TAG,R.tagName="";else if(j==="?")R.state=K.PROC_INST,R.procInstName=R.procInstBody="";else{if(X(R,"Unencoded <"),R.startTagPosition+1<R.position){var U=R.position-R.startTagPosition;j=new Array(U).join(" ")+j}R.textNode+="<"+j,R.state=K.TEXT}continue;case K.SGML_DECL:(R.sgmlDecl+j).toUpperCase()===C?(ie(R,"onopencdata"),R.state=K.CDATA,R.sgmlDecl="",R.cdata=""):R.sgmlDecl+j==="--"?(R.state=K.COMMENT,R.comment="",R.sgmlDecl=""):(R.sgmlDecl+j).toUpperCase()===v?(R.state=K.DOCTYPE,(R.doctype||R.sawRoot)&&X(R,"Inappropriately located doctype declaration"),R.doctype="",R.sgmlDecl=""):j===">"?(ie(R,"onsgmldeclaration",R.sgmlDecl),R.sgmlDecl="",R.state=K.TEXT):(Q(p,j)&&(R.state=K.SGML_DECL_QUOTED),R.sgmlDecl+=j);continue;case K.SGML_DECL_QUOTED:j===R.q&&(R.state=K.SGML_DECL,R.q=""),R.sgmlDecl+=j;continue;case K.DOCTYPE:j===">"?(R.state=K.TEXT,ie(R,"ondoctype",R.doctype),R.doctype=!0):(R.doctype+=j,j==="["?R.state=K.DOCTYPE_DTD:Q(p,j)&&(R.state=K.DOCTYPE_QUOTED,R.q=j));continue;case K.DOCTYPE_QUOTED:R.doctype+=j,j===R.q&&(R.q="",R.state=K.DOCTYPE);continue;case K.DOCTYPE_DTD:R.doctype+=j,j==="]"?R.state=K.DOCTYPE:Q(p,j)&&(R.state=K.DOCTYPE_DTD_QUOTED,R.q=j);continue;case K.DOCTYPE_DTD_QUOTED:R.doctype+=j,j===R.q&&(R.state=K.DOCTYPE_DTD,R.q="");continue;case K.COMMENT:j==="-"?R.state=K.COMMENT_ENDING:R.comment+=j;continue;case K.COMMENT_ENDING:j==="-"?(R.state=K.COMMENT_ENDED,R.comment=ne(R.opt,R.comment),R.comment&&ie(R,"oncomment",R.comment),R.comment=""):(R.comment+="-"+j,R.state=K.COMMENT);continue;case K.COMMENT_ENDED:j!==">"?(X(R,"Malformed comment"),R.comment+="--"+j,R.state=K.COMMENT):R.state=K.TEXT;continue;case K.CDATA:j==="]"?R.state=K.CDATA_ENDING:R.cdata+=j;continue;case K.CDATA_ENDING:j==="]"?R.state=K.CDATA_ENDING_2:(R.cdata+="]"+j,R.state=K.CDATA);continue;case K.CDATA_ENDING_2:j===">"?(R.cdata&&ie(R,"oncdata",R.cdata),ie(R,"onclosecdata"),R.cdata="",R.state=K.TEXT):j==="]"?R.cdata+="]":(R.cdata+="]]"+j,R.state=K.CDATA);continue;case K.PROC_INST:j==="?"?R.state=K.PROC_INST_ENDING:Q(O,j)?R.state=K.PROC_INST_BODY:R.procInstName+=j;continue;case K.PROC_INST_BODY:if(!R.procInstBody&&Q(O,j))continue;j==="?"?R.state=K.PROC_INST_ENDING:R.procInstBody+=j;continue;case K.PROC_INST_ENDING:j===">"?(ie(R,"onprocessinginstruction",{name:R.procInstName,body:R.procInstBody}),R.procInstName=R.procInstBody="",R.state=K.TEXT):(R.procInstBody+="?"+j,R.state=K.PROC_INST_BODY);continue;case K.OPEN_TAG:Q(x,j)?R.tagName+=j:(oe(R),j===">"?he(R):j==="/"?R.state=K.OPEN_TAG_SLASH:($(O,j)&&X(R,"Invalid character in tag name"),R.state=K.ATTRIB));continue;case K.OPEN_TAG_SLASH:j===">"?(he(R,!0),se(R)):(X(R,"Forward-slash in opening tag not followed by >"),R.state=K.ATTRIB);continue;case K.ATTRIB:if(Q(O,j))continue;j===">"?he(R):j==="/"?R.state=K.OPEN_TAG_SLASH:Q(A,j)?(R.attribName=j,R.attribValue="",R.state=K.ATTRIB_NAME):X(R,"Invalid attribute name");continue;case K.ATTRIB_NAME:j==="="?R.state=K.ATTRIB_VALUE:j===">"?(X(R,"Attribute without value"),R.attribValue=R.attribName,_e(R),he(R)):Q(O,j)?R.state=K.ATTRIB_NAME_SAW_WHITE:Q(x,j)?R.attribName+=j:X(R,"Invalid attribute name");continue;case K.ATTRIB_NAME_SAW_WHITE:if(j==="=")R.state=K.ATTRIB_VALUE;else{if(Q(O,j))continue;X(R,"Attribute without value"),R.tag.attributes[R.attribName]="",R.attribValue="",ie(R,"onattribute",{name:R.attribName,value:""}),R.attribName="",j===">"?he(R):Q(A,j)?(R.attribName=j,R.state=K.ATTRIB_NAME):(X(R,"Invalid attribute name"),R.state=K.ATTRIB)}continue;case K.ATTRIB_VALUE:if(Q(O,j))continue;Q(p,j)?(R.q=j,R.state=K.ATTRIB_VALUE_QUOTED):(X(R,"Unquoted attribute value"),R.state=K.ATTRIB_VALUE_UNQUOTED,R.attribValue=j);continue;case K.ATTRIB_VALUE_QUOTED:if(j!==R.q){j==="&"?R.state=K.ATTRIB_VALUE_ENTITY_Q:R.attribValue+=j;continue}_e(R),R.q="",R.state=K.ATTRIB_VALUE_CLOSED;continue;case K.ATTRIB_VALUE_CLOSED:Q(O,j)?R.state=K.ATTRIB:j===">"?he(R):j==="/"?R.state=K.OPEN_TAG_SLASH:Q(A,j)?(X(R,"No whitespace between attributes"),R.attribName=j,R.attribValue="",R.state=K.ATTRIB_NAME):X(R,"Invalid attribute name");continue;case K.ATTRIB_VALUE_UNQUOTED:if($(h,j)){j==="&"?R.state=K.ATTRIB_VALUE_ENTITY_U:R.attribValue+=j;continue}_e(R),j===">"?he(R):R.state=K.ATTRIB;continue;case K.CLOSE_TAG:if(R.tagName)j===">"?se(R):Q(x,j)?R.tagName+=j:R.script?(R.script+="</"+R.tagName,R.tagName="",R.state=K.SCRIPT):($(O,j)&&X(R,"Invalid tagname in closing tag"),R.state=K.CLOSE_TAG_SAW_WHITE);else{if(Q(O,j))continue;$(A,j)?R.script?(R.script+="</"+j,R.state=K.SCRIPT):X(R,"Invalid tagname in closing tag."):R.tagName=j}continue;case K.CLOSE_TAG_SAW_WHITE:if(Q(O,j))continue;j===">"?se(R):X(R,"Invalid characters in closing tag");continue;case K.TEXT_ENTITY:case K.ATTRIB_VALUE_ENTITY_Q:case K.ATTRIB_VALUE_ENTITY_U:var B,G;switch(R.state){case K.TEXT_ENTITY:B=K.TEXT,G="textNode";break;case K.ATTRIB_VALUE_ENTITY_Q:B=K.ATTRIB_VALUE_QUOTED,G="attribValue";break;case K.ATTRIB_VALUE_ENTITY_U:B=K.ATTRIB_VALUE_UNQUOTED,G="attribValue";break}j===";"?(R[G]+=Z(R),R.entity="",R.state=B):Q(R.entity.length?k:F,j)?R.entity+=j:(X(R,"Invalid character in entity name"),R[G]+="&"+R.entity+j,R.entity="",R.state=B);continue;default:throw new Error(R,"Unknown state: "+R.state)}return R.position>=R.bufferCheckPosition&&c(R),R}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */String.fromCodePoint||function(){var N=String.fromCharCode,R=Math.floor,w=function(){var j=16384,H=[],U,B,G=-1,z=arguments.length;if(!z)return"";for(var fe="";++G<z;){var ue=Number(arguments[G]);if(!isFinite(ue)||ue<0||ue>1114111||R(ue)!==ue)throw RangeError("Invalid code point: "+ue);ue<=65535?H.push(ue):(ue-=65536,U=(ue>>10)+55296,B=ue%1024+56320,H.push(U,B)),(G+1===z||H.length>j)&&(fe+=N.apply(null,H),H.length=0)}return fe};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:w,configurable:!0,writable:!0}):String.fromCodePoint=w}()})(i)},"./node_modules/stream-browserify/index.js":(g,i,r)=>{g.exports=l;var d=r("./node_modules/events/events.js").EventEmitter,o=r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js");o(l,d),l.Readable=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_readable.js"),l.Writable=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_writable.js"),l.Duplex=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),l.Transform=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_transform.js"),l.PassThrough=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_passthrough.js"),l.finished=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"),l.pipeline=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/pipeline.js"),l.Stream=l;function l(){d.call(this)}l.prototype.pipe=function(c,E){var m=this;function f(p){c.writable&&c.write(p)===!1&&m.pause&&m.pause()}m.on("data",f);function T(){m.readable&&m.resume&&m.resume()}c.on("drain",T),!c._isStdio&&(!E||E.end!==!1)&&(m.on("end",P),m.on("close",O));var L=!1;function P(){L||(L=!0,c.end())}function O(){L||(L=!0,typeof c.destroy=="function"&&c.destroy())}function M(p){if(S(),d.listenerCount(this,"error")===0)throw p}m.on("error",M),c.on("error",M);function S(){m.removeListener("data",f),c.removeListener("drain",T),m.removeListener("end",P),m.removeListener("close",O),m.removeListener("error",M),c.removeListener("error",M),m.removeListener("end",S),m.removeListener("close",S),c.removeListener("close",S)}return m.on("end",S),m.on("close",S),c.on("close",S),c.emit("pipe",m),c}},"./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js":g=>{typeof Object.create=="function"?g.exports=function(r,d){d&&(r.super_=d,r.prototype=Object.create(d.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}))}:g.exports=function(r,d){if(d){r.super_=d;var o=function(){};o.prototype=d.prototype,r.prototype=new o,r.prototype.constructor=r}}},"./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js":g=>{function i(m,f){m.prototype=Object.create(f.prototype),m.prototype.constructor=m,m.__proto__=f}var r={};function d(m,f,T){T||(T=Error);function L(O,M,S){return typeof f=="string"?f:f(O,M,S)}var P=function(O){i(M,O);function M(S,p,h){return O.call(this,L(S,p,h))||this}return M}(T);P.prototype.name=T.name,P.prototype.code=m,r[m]=P}function o(m,f){if(Array.isArray(m)){var T=m.length;return m=m.map(function(L){return String(L)}),T>2?"one of ".concat(f," ").concat(m.slice(0,T-1).join(", "),", or ")+m[T-1]:T===2?"one of ".concat(f," ").concat(m[0]," or ").concat(m[1]):"of ".concat(f," ").concat(m[0])}else return"of ".concat(f," ").concat(String(m))}function l(m,f,T){return m.substr(!T||T<0?0:+T,f.length)===f}function c(m,f,T){return(T===void 0||T>m.length)&&(T=m.length),m.substring(T-f.length,T)===f}function E(m,f,T){return typeof T!="number"&&(T=0),T+f.length>m.length?!1:m.indexOf(f,T)!==-1}d("ERR_INVALID_OPT_VALUE",function(m,f){return'The value "'+f+'" is invalid for option "'+m+'"'},TypeError),d("ERR_INVALID_ARG_TYPE",function(m,f,T){var L;typeof f=="string"&&l(f,"not ")?(L="must not be",f=f.replace(/^not /,"")):L="must be";var P;if(c(m," argument"))P="The ".concat(m," ").concat(L," ").concat(o(f,"type"));else{var O=E(m,".")?"property":"argument";P='The "'.concat(m,'" ').concat(O," ").concat(L," ").concat(o(f,"type"))}return P+=". Received type ".concat(typeof T),P},TypeError),d("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),d("ERR_METHOD_NOT_IMPLEMENTED",function(m){return"The "+m+" method is not implemented"}),d("ERR_STREAM_PREMATURE_CLOSE","Premature close"),d("ERR_STREAM_DESTROYED",function(m){return"Cannot call "+m+" after a stream was destroyed"}),d("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),d("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),d("ERR_STREAM_WRITE_AFTER_END","write after end"),d("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),d("ERR_UNKNOWN_ENCODING",function(m){return"Unknown encoding: "+m},TypeError),d("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),g.exports.codes=r},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js":(g,i,r)=>{var d=Object.keys||function(P){var O=[];for(var M in P)O.push(M);return O};g.exports=f;var o=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_readable.js"),l=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_writable.js");r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(f,o);for(var c=d(l.prototype),E=0;E<c.length;E++){var m=c[E];f.prototype[m]||(f.prototype[m]=l.prototype[m])}function f(P){if(!(this instanceof f))return new f(P);o.call(this,P),l.call(this,P),this.allowHalfOpen=!0,P&&(P.readable===!1&&(this.readable=!1),P.writable===!1&&(this.writable=!1),P.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",T)))}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(f.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function T(){this._writableState.ended||process.nextTick(L,this)}function L(P){P.end()}Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(O){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=O,this._writableState.destroyed=O)}})},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_passthrough.js":(g,i,r)=>{g.exports=o;var d=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_transform.js");r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(o,d);function o(l){if(!(this instanceof o))return new o(l);d.call(this,l)}o.prototype._transform=function(l,c,E){E(null,l)}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_readable.js":(g,i,r)=>{g.exports=V;var d;V.ReadableState=W,r("./node_modules/events/events.js").EventEmitter;var o=function(w,j){return w.listeners(j).length},l=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/stream-browser.js"),c=r("./node_modules/buffer/index.js").Buffer,E=r.g.Uint8Array||function(){};function m(R){return c.from(R)}function f(R){return c.isBuffer(R)||R instanceof E}var T=r("?19e6"),L;T&&T.debuglog?L=T.debuglog("stream"):L=function(){};var P=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/buffer_list.js"),O=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/destroy.js"),M=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/state.js"),S=M.getHighWaterMark,p=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,h=p.ERR_INVALID_ARG_TYPE,C=p.ERR_STREAM_PUSH_AFTER_EOF,v=p.ERR_METHOD_NOT_IMPLEMENTED,I=p.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,D,y,A;r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(V,l);var x=O.errorOrDestroy,F=["error","close","destroy","pause","resume"];function k(R,w,j){if(typeof R.prependListener=="function")return R.prependListener(w,j);!R._events||!R._events[w]?R.on(w,j):Array.isArray(R._events[w])?R._events[w].unshift(j):R._events[w]=[j,R._events[w]]}function W(R,w,j){d=d||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),R=R||{},typeof j!="boolean"&&(j=w instanceof d),this.objectMode=!!R.objectMode,j&&(this.objectMode=this.objectMode||!!R.readableObjectMode),this.highWaterMark=S(this,R,"readableHighWaterMark",j),this.buffer=new P,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=R.emitClose!==!1,this.autoDestroy=!!R.autoDestroy,this.destroyed=!1,this.defaultEncoding=R.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,R.encoding&&(D||(D=r("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder),this.decoder=new D(R.encoding),this.encoding=R.encoding)}function V(R){if(d=d||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),!(this instanceof V))return new V(R);var w=this instanceof d;this._readableState=new W(R,this,w),this.readable=!0,R&&(typeof R.read=="function"&&(this._read=R.read),typeof R.destroy=="function"&&(this._destroy=R.destroy)),l.call(this)}Object.defineProperty(V.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(w){this._readableState&&(this._readableState.destroyed=w)}}),V.prototype.destroy=O.destroy,V.prototype._undestroy=O.undestroy,V.prototype._destroy=function(R,w){w(R)},V.prototype.push=function(R,w){var j=this._readableState,H;return j.objectMode?H=!0:typeof R=="string"&&(w=w||j.defaultEncoding,w!==j.encoding&&(R=c.from(R,w),w=""),H=!0),Q(this,R,w,!1,H)},V.prototype.unshift=function(R){return Q(this,R,null,!0,!1)};function Q(R,w,j,H,U){L("readableAddChunk",w);var B=R._readableState;if(w===null)B.reading=!1,ee(R,B);else{var G;if(U||(G=K(B,w)),G)x(R,G);else if(B.objectMode||w&&w.length>0)if(typeof w!="string"&&!B.objectMode&&Object.getPrototypeOf(w)!==c.prototype&&(w=m(w)),H)B.endEmitted?x(R,new I):$(R,B,w,!0);else if(B.ended)x(R,new C);else{if(B.destroyed)return!1;B.reading=!1,B.decoder&&!j?(w=B.decoder.write(w),B.objectMode||w.length!==0?$(R,B,w,!1):ce(R,B)):$(R,B,w,!1)}else H||(B.reading=!1,ce(R,B))}return!B.ended&&(B.length<B.highWaterMark||B.length===0)}function $(R,w,j,H){w.flowing&&w.length===0&&!w.sync?(w.awaitDrain=0,R.emit("data",j)):(w.length+=w.objectMode?1:j.length,H?w.buffer.unshift(j):w.buffer.push(j),w.needReadable&&ne(R)),ce(R,w)}function K(R,w){var j;return!f(w)&&typeof w!="string"&&w!==void 0&&!R.objectMode&&(j=new h("chunk",["string","Buffer","Uint8Array"],w)),j}V.prototype.isPaused=function(){return this._readableState.flowing===!1},V.prototype.setEncoding=function(R){D||(D=r("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder);var w=new D(R);this._readableState.decoder=w,this._readableState.encoding=this._readableState.decoder.encoding;for(var j=this._readableState.buffer.head,H="";j!==null;)H+=w.write(j.data),j=j.next;return this._readableState.buffer.clear(),H!==""&&this._readableState.buffer.push(H),this._readableState.length=H.length,this};var Y=1073741824;function re(R){return R>=Y?R=Y:(R--,R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,R|=R>>>16,R++),R}function ie(R,w){return R<=0||w.length===0&&w.ended?0:w.objectMode?1:R!==R?w.flowing&&w.length?w.buffer.head.data.length:w.length:(R>w.highWaterMark&&(w.highWaterMark=re(R)),R<=w.length?R:w.ended?w.length:(w.needReadable=!0,0))}V.prototype.read=function(R){L("read",R),R=parseInt(R,10);var w=this._readableState,j=R;if(R!==0&&(w.emittedReadable=!1),R===0&&w.needReadable&&((w.highWaterMark!==0?w.length>=w.highWaterMark:w.length>0)||w.ended))return L("read: emitReadable",w.length,w.ended),w.length===0&&w.ended?le(this):ne(this),null;if(R=ie(R,w),R===0&&w.ended)return w.length===0&&le(this),null;var H=w.needReadable;L("need readable",H),(w.length===0||w.length-R<w.highWaterMark)&&(H=!0,L("length less than watermark",H)),w.ended||w.reading?(H=!1,L("reading or ended",H)):H&&(L("do read"),w.reading=!0,w.sync=!0,w.length===0&&(w.needReadable=!0),this._read(w.highWaterMark),w.sync=!1,w.reading||(R=ie(j,w)));var U;return R>0?U=q(R,w):U=null,U===null?(w.needReadable=w.length<=w.highWaterMark,R=0):(w.length-=R,w.awaitDrain=0),w.length===0&&(w.ended||(w.needReadable=!0),j!==R&&w.ended&&le(this)),U!==null&&this.emit("data",U),U};function ee(R,w){if(L("onEofChunk"),!w.ended){if(w.decoder){var j=w.decoder.end();j&&j.length&&(w.buffer.push(j),w.length+=w.objectMode?1:j.length)}w.ended=!0,w.sync?ne(R):(w.needReadable=!1,w.emittedReadable||(w.emittedReadable=!0,ae(R)))}}function ne(R){var w=R._readableState;L("emitReadable",w.needReadable,w.emittedReadable),w.needReadable=!1,w.emittedReadable||(L("emitReadable",w.flowing),w.emittedReadable=!0,process.nextTick(ae,R))}function ae(R){var w=R._readableState;L("emitReadable_",w.destroyed,w.length,w.ended),!w.destroyed&&(w.length||w.ended)&&(R.emit("readable"),w.emittedReadable=!1),w.needReadable=!w.flowing&&!w.ended&&w.length<=w.highWaterMark,Z(R)}function ce(R,w){w.readingMore||(w.readingMore=!0,process.nextTick(X,R,w))}function X(R,w){for(;!w.reading&&!w.ended&&(w.length<w.highWaterMark||w.flowing&&w.length===0);){var j=w.length;if(L("maybeReadMore read 0"),R.read(0),j===w.length)break}w.readingMore=!1}V.prototype._read=function(R){x(this,new v("_read()"))},V.prototype.pipe=function(R,w){var j=this,H=this._readableState;switch(H.pipesCount){case 0:H.pipes=R;break;case 1:H.pipes=[H.pipes,R];break;default:H.pipes.push(R);break}H.pipesCount+=1,L("pipe count=%d opts=%j",H.pipesCount,w);var U=(!w||w.end!==!1)&&R!==process.stdout&&R!==process.stderr,B=U?z:Be;H.endEmitted?process.nextTick(B):j.once("end",B),R.on("unpipe",G);function G(ke,Ye){L("onunpipe"),ke===j&&Ye&&Ye.hasUnpiped===!1&&(Ye.hasUnpiped=!0,J())}function z(){L("onend"),R.end()}var fe=oe(j);R.on("drain",fe);var ue=!1;function J(){L("cleanup"),R.removeListener("close",Ae),R.removeListener("finish",be),R.removeListener("drain",fe),R.removeListener("error",me),R.removeListener("unpipe",G),j.removeListener("end",z),j.removeListener("end",Be),j.removeListener("data",ve),ue=!0,H.awaitDrain&&(!R._writableState||R._writableState.needDrain)&&fe()}j.on("data",ve);function ve(ke){L("ondata");var Ye=R.write(ke);L("dest.write",Ye),Ye===!1&&((H.pipesCount===1&&H.pipes===R||H.pipesCount>1&&N(H.pipes,R)!==-1)&&!ue&&(L("false write response, pause",H.awaitDrain),H.awaitDrain++),j.pause())}function me(ke){L("onerror",ke),Be(),R.removeListener("error",me),o(R,"error")===0&&x(R,ke)}k(R,"error",me);function Ae(){R.removeListener("finish",be),Be()}R.once("close",Ae);function be(){L("onfinish"),R.removeListener("close",Ae),Be()}R.once("finish",be);function Be(){L("unpipe"),j.unpipe(R)}return R.emit("pipe",j),H.flowing||(L("pipe resume"),j.resume()),R};function oe(R){return function(){var j=R._readableState;L("pipeOnDrain",j.awaitDrain),j.awaitDrain&&j.awaitDrain--,j.awaitDrain===0&&o(R,"data")&&(j.flowing=!0,Z(R))}}V.prototype.unpipe=function(R){var w=this._readableState,j={hasUnpiped:!1};if(w.pipesCount===0)return this;if(w.pipesCount===1)return R&&R!==w.pipes?this:(R||(R=w.pipes),w.pipes=null,w.pipesCount=0,w.flowing=!1,R&&R.emit("unpipe",this,j),this);if(!R){var H=w.pipes,U=w.pipesCount;w.pipes=null,w.pipesCount=0,w.flowing=!1;for(var B=0;B<U;B++)H[B].emit("unpipe",this,{hasUnpiped:!1});return this}var G=N(w.pipes,R);return G===-1?this:(w.pipes.splice(G,1),w.pipesCount-=1,w.pipesCount===1&&(w.pipes=w.pipes[0]),R.emit("unpipe",this,j),this)},V.prototype.on=function(R,w){var j=l.prototype.on.call(this,R,w),H=this._readableState;return R==="data"?(H.readableListening=this.listenerCount("readable")>0,H.flowing!==!1&&this.resume()):R==="readable"&&!H.endEmitted&&!H.readableListening&&(H.readableListening=H.needReadable=!0,H.flowing=!1,H.emittedReadable=!1,L("on readable",H.length,H.reading),H.length?ne(this):H.reading||process.nextTick(_e,this)),j},V.prototype.addListener=V.prototype.on,V.prototype.removeListener=function(R,w){var j=l.prototype.removeListener.call(this,R,w);return R==="readable"&&process.nextTick(ge,this),j},V.prototype.removeAllListeners=function(R){var w=l.prototype.removeAllListeners.apply(this,arguments);return(R==="readable"||R===void 0)&&process.nextTick(ge,this),w};function ge(R){var w=R._readableState;w.readableListening=R.listenerCount("readable")>0,w.resumeScheduled&&!w.paused?w.flowing=!0:R.listenerCount("data")>0&&R.resume()}function _e(R){L("readable nexttick read 0"),R.read(0)}V.prototype.resume=function(){var R=this._readableState;return R.flowing||(L("resume"),R.flowing=!R.readableListening,he(this,R)),R.paused=!1,this};function he(R,w){w.resumeScheduled||(w.resumeScheduled=!0,process.nextTick(se,R,w))}function se(R,w){L("resume",w.reading),w.reading||R.read(0),w.resumeScheduled=!1,R.emit("resume"),Z(R),w.flowing&&!w.reading&&R.read(0)}V.prototype.pause=function(){return L("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(L("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Z(R){var w=R._readableState;for(L("flow",w.flowing);w.flowing&&R.read()!==null;);}V.prototype.wrap=function(R){var w=this,j=this._readableState,H=!1;R.on("end",function(){if(L("wrapped end"),j.decoder&&!j.ended){var G=j.decoder.end();G&&G.length&&w.push(G)}w.push(null)}),R.on("data",function(G){if(L("wrapped data"),j.decoder&&(G=j.decoder.write(G)),!(j.objectMode&&G==null)&&!(!j.objectMode&&(!G||!G.length))){var z=w.push(G);z||(H=!0,R.pause())}});for(var U in R)this[U]===void 0&&typeof R[U]=="function"&&(this[U]=function(z){return function(){return R[z].apply(R,arguments)}}(U));for(var B=0;B<F.length;B++)R.on(F[B],this.emit.bind(this,F[B]));return this._read=function(G){L("wrapped _read",G),H&&(H=!1,R.resume())},this},typeof Symbol=="function"&&(V.prototype[Symbol.asyncIterator]=function(){return y===void 0&&(y=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/async_iterator.js")),y(this)}),Object.defineProperty(V.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(V.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(V.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(w){this._readableState&&(this._readableState.flowing=w)}}),V._fromList=q,Object.defineProperty(V.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function q(R,w){if(w.length===0)return null;var j;return w.objectMode?j=w.buffer.shift():!R||R>=w.length?(w.decoder?j=w.buffer.join(""):w.buffer.length===1?j=w.buffer.first():j=w.buffer.concat(w.length),w.buffer.clear()):j=w.buffer.consume(R,w.decoder),j}function le(R){var w=R._readableState;L("endReadable",w.endEmitted),w.endEmitted||(w.ended=!0,process.nextTick(te,w,R))}function te(R,w){if(L("endReadableNT",R.endEmitted,R.length),!R.endEmitted&&R.length===0&&(R.endEmitted=!0,w.readable=!1,w.emit("end"),R.autoDestroy)){var j=w._writableState;(!j||j.autoDestroy&&j.finished)&&w.destroy()}}typeof Symbol=="function"&&(V.from=function(R,w){return A===void 0&&(A=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/from-browser.js")),A(V,R,w)});function N(R,w){for(var j=0,H=R.length;j<H;j++)if(R[j]===w)return j;return-1}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_transform.js":(g,i,r)=>{g.exports=T;var d=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,o=d.ERR_METHOD_NOT_IMPLEMENTED,l=d.ERR_MULTIPLE_CALLBACK,c=d.ERR_TRANSFORM_ALREADY_TRANSFORMING,E=d.ERR_TRANSFORM_WITH_LENGTH_0,m=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js");r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(T,m);function f(O,M){var S=this._transformState;S.transforming=!1;var p=S.writecb;if(p===null)return this.emit("error",new l);S.writechunk=null,S.writecb=null,M!=null&&this.push(M),p(O);var h=this._readableState;h.reading=!1,(h.needReadable||h.length<h.highWaterMark)&&this._read(h.highWaterMark)}function T(O){if(!(this instanceof T))return new T(O);m.call(this,O),this._transformState={afterTransform:f.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,O&&(typeof O.transform=="function"&&(this._transform=O.transform),typeof O.flush=="function"&&(this._flush=O.flush)),this.on("prefinish",L)}function L(){var O=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(M,S){P(O,M,S)}):P(this,null,null)}T.prototype.push=function(O,M){return this._transformState.needTransform=!1,m.prototype.push.call(this,O,M)},T.prototype._transform=function(O,M,S){S(new o("_transform()"))},T.prototype._write=function(O,M,S){var p=this._transformState;if(p.writecb=S,p.writechunk=O,p.writeencoding=M,!p.transforming){var h=this._readableState;(p.needTransform||h.needReadable||h.length<h.highWaterMark)&&this._read(h.highWaterMark)}},T.prototype._read=function(O){var M=this._transformState;M.writechunk!==null&&!M.transforming?(M.transforming=!0,this._transform(M.writechunk,M.writeencoding,M.afterTransform)):M.needTransform=!0},T.prototype._destroy=function(O,M){m.prototype._destroy.call(this,O,function(S){M(S)})};function P(O,M,S){if(M)return O.emit("error",M);if(S!=null&&O.push(S),O._writableState.length)throw new E;if(O._transformState.transforming)throw new c;return O.push(null)}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_writable.js":(g,i,r)=>{g.exports=W;function d(Z){var q=this;this.next=null,this.entry=null,this.finish=function(){se(q,Z)}}var o;W.WritableState=F;var l={deprecate:r("./node_modules/util-deprecate/browser.js")},c=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/stream-browser.js"),E=r("./node_modules/buffer/index.js").Buffer,m=r.g.Uint8Array||function(){};function f(Z){return E.from(Z)}function T(Z){return E.isBuffer(Z)||Z instanceof m}var L=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/destroy.js"),P=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/state.js"),O=P.getHighWaterMark,M=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,S=M.ERR_INVALID_ARG_TYPE,p=M.ERR_METHOD_NOT_IMPLEMENTED,h=M.ERR_MULTIPLE_CALLBACK,C=M.ERR_STREAM_CANNOT_PIPE,v=M.ERR_STREAM_DESTROYED,I=M.ERR_STREAM_NULL_VALUES,D=M.ERR_STREAM_WRITE_AFTER_END,y=M.ERR_UNKNOWN_ENCODING,A=L.errorOrDestroy;r("./node_modules/stream-browserify/node_modules/inherits/inherits_browser.js")(W,c);function x(){}function F(Z,q,le){o=o||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js"),Z=Z||{},typeof le!="boolean"&&(le=q instanceof o),this.objectMode=!!Z.objectMode,le&&(this.objectMode=this.objectMode||!!Z.writableObjectMode),this.highWaterMark=O(this,Z,"writableHighWaterMark",le),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var te=Z.decodeStrings===!1;this.decodeStrings=!te,this.defaultEncoding=Z.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(N){ee(q,N)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=Z.emitClose!==!1,this.autoDestroy=!!Z.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new d(this)}F.prototype.getBuffer=function(){for(var q=this.bufferedRequest,le=[];q;)le.push(q),q=q.next;return le},function(){try{Object.defineProperty(F.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var k;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(k=Function.prototype[Symbol.hasInstance],Object.defineProperty(W,Symbol.hasInstance,{value:function(q){return k.call(this,q)?!0:this!==W?!1:q&&q._writableState instanceof F}})):k=function(q){return q instanceof this};function W(Z){o=o||r("./node_modules/stream-browserify/node_modules/readable-stream/lib/_stream_duplex.js");var q=this instanceof o;if(!q&&!k.call(W,this))return new W(Z);this._writableState=new F(Z,this,q),this.writable=!0,Z&&(typeof Z.write=="function"&&(this._write=Z.write),typeof Z.writev=="function"&&(this._writev=Z.writev),typeof Z.destroy=="function"&&(this._destroy=Z.destroy),typeof Z.final=="function"&&(this._final=Z.final)),c.call(this)}W.prototype.pipe=function(){A(this,new C)};function V(Z,q){var le=new D;A(Z,le),process.nextTick(q,le)}function Q(Z,q,le,te){var N;return le===null?N=new I:typeof le!="string"&&!q.objectMode&&(N=new S("chunk",["string","Buffer"],le)),N?(A(Z,N),process.nextTick(te,N),!1):!0}W.prototype.write=function(Z,q,le){var te=this._writableState,N=!1,R=!te.objectMode&&T(Z);return R&&!E.isBuffer(Z)&&(Z=f(Z)),typeof q=="function"&&(le=q,q=null),R?q="buffer":q||(q=te.defaultEncoding),typeof le!="function"&&(le=x),te.ending?V(this,le):(R||Q(this,te,Z,le))&&(te.pendingcb++,N=K(this,te,R,Z,q,le)),N},W.prototype.cork=function(){this._writableState.corked++},W.prototype.uncork=function(){var Z=this._writableState;Z.corked&&(Z.corked--,!Z.writing&&!Z.corked&&!Z.bufferProcessing&&Z.bufferedRequest&&ce(this,Z))},W.prototype.setDefaultEncoding=function(q){if(typeof q=="string"&&(q=q.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((q+"").toLowerCase())>-1))throw new y(q);return this._writableState.defaultEncoding=q,this},Object.defineProperty(W.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function $(Z,q,le){return!Z.objectMode&&Z.decodeStrings!==!1&&typeof q=="string"&&(q=E.from(q,le)),q}Object.defineProperty(W.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function K(Z,q,le,te,N,R){if(!le){var w=$(q,te,N);te!==w&&(le=!0,N="buffer",te=w)}var j=q.objectMode?1:te.length;q.length+=j;var H=q.length<q.highWaterMark;if(H||(q.needDrain=!0),q.writing||q.corked){var U=q.lastBufferedRequest;q.lastBufferedRequest={chunk:te,encoding:N,isBuf:le,callback:R,next:null},U?U.next=q.lastBufferedRequest:q.bufferedRequest=q.lastBufferedRequest,q.bufferedRequestCount+=1}else Y(Z,q,!1,j,te,N,R);return H}function Y(Z,q,le,te,N,R,w){q.writelen=te,q.writecb=w,q.writing=!0,q.sync=!0,q.destroyed?q.onwrite(new v("write")):le?Z._writev(N,q.onwrite):Z._write(N,R,q.onwrite),q.sync=!1}function re(Z,q,le,te,N){--q.pendingcb,le?(process.nextTick(N,te),process.nextTick(_e,Z,q),Z._writableState.errorEmitted=!0,A(Z,te)):(N(te),Z._writableState.errorEmitted=!0,A(Z,te),_e(Z,q))}function ie(Z){Z.writing=!1,Z.writecb=null,Z.length-=Z.writelen,Z.writelen=0}function ee(Z,q){var le=Z._writableState,te=le.sync,N=le.writecb;if(typeof N!="function")throw new h;if(ie(le),q)re(Z,le,te,q,N);else{var R=X(le)||Z.destroyed;!R&&!le.corked&&!le.bufferProcessing&&le.bufferedRequest&&ce(Z,le),te?process.nextTick(ne,Z,le,R,N):ne(Z,le,R,N)}}function ne(Z,q,le,te){le||ae(Z,q),q.pendingcb--,te(),_e(Z,q)}function ae(Z,q){q.length===0&&q.needDrain&&(q.needDrain=!1,Z.emit("drain"))}function ce(Z,q){q.bufferProcessing=!0;var le=q.bufferedRequest;if(Z._writev&&le&&le.next){var te=q.bufferedRequestCount,N=new Array(te),R=q.corkedRequestsFree;R.entry=le;for(var w=0,j=!0;le;)N[w]=le,le.isBuf||(j=!1),le=le.next,w+=1;N.allBuffers=j,Y(Z,q,!0,q.length,N,"",R.finish),q.pendingcb++,q.lastBufferedRequest=null,R.next?(q.corkedRequestsFree=R.next,R.next=null):q.corkedRequestsFree=new d(q),q.bufferedRequestCount=0}else{for(;le;){var H=le.chunk,U=le.encoding,B=le.callback,G=q.objectMode?1:H.length;if(Y(Z,q,!1,G,H,U,B),le=le.next,q.bufferedRequestCount--,q.writing)break}le===null&&(q.lastBufferedRequest=null)}q.bufferedRequest=le,q.bufferProcessing=!1}W.prototype._write=function(Z,q,le){le(new p("_write()"))},W.prototype._writev=null,W.prototype.end=function(Z,q,le){var te=this._writableState;return typeof Z=="function"?(le=Z,Z=null,q=null):typeof q=="function"&&(le=q,q=null),Z!=null&&this.write(Z,q),te.corked&&(te.corked=1,this.uncork()),te.ending||he(this,te,le),this},Object.defineProperty(W.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function X(Z){return Z.ending&&Z.length===0&&Z.bufferedRequest===null&&!Z.finished&&!Z.writing}function oe(Z,q){Z._final(function(le){q.pendingcb--,le&&A(Z,le),q.prefinished=!0,Z.emit("prefinish"),_e(Z,q)})}function ge(Z,q){!q.prefinished&&!q.finalCalled&&(typeof Z._final=="function"&&!q.destroyed?(q.pendingcb++,q.finalCalled=!0,process.nextTick(oe,Z,q)):(q.prefinished=!0,Z.emit("prefinish")))}function _e(Z,q){var le=X(q);if(le&&(ge(Z,q),q.pendingcb===0&&(q.finished=!0,Z.emit("finish"),q.autoDestroy))){var te=Z._readableState;(!te||te.autoDestroy&&te.endEmitted)&&Z.destroy()}return le}function he(Z,q,le){q.ending=!0,_e(Z,q),le&&(q.finished?process.nextTick(le):Z.once("finish",le)),q.ended=!0,Z.writable=!1}function se(Z,q,le){var te=Z.entry;for(Z.entry=null;te;){var N=te.callback;q.pendingcb--,N(le),te=te.next}q.corkedRequestsFree.next=Z}Object.defineProperty(W.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(q){this._writableState&&(this._writableState.destroyed=q)}}),W.prototype.destroy=L.destroy,W.prototype._undestroy=L.undestroy,W.prototype._destroy=function(Z,q){q(Z)}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/async_iterator.js":(g,i,r)=>{var d;function o(I,D,y){return D in I?Object.defineProperty(I,D,{value:y,enumerable:!0,configurable:!0,writable:!0}):I[D]=y,I}var l=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"),c=Symbol("lastResolve"),E=Symbol("lastReject"),m=Symbol("error"),f=Symbol("ended"),T=Symbol("lastPromise"),L=Symbol("handlePromise"),P=Symbol("stream");function O(I,D){return{value:I,done:D}}function M(I){var D=I[c];if(D!==null){var y=I[P].read();y!==null&&(I[T]=null,I[c]=null,I[E]=null,D(O(y,!1)))}}function S(I){process.nextTick(M,I)}function p(I,D){return function(y,A){I.then(function(){if(D[f]){y(O(void 0,!0));return}D[L](y,A)},A)}}var h=Object.getPrototypeOf(function(){}),C=Object.setPrototypeOf((d={get stream(){return this[P]},next:function(){var D=this,y=this[m];if(y!==null)return Promise.reject(y);if(this[f])return Promise.resolve(O(void 0,!0));if(this[P].destroyed)return new Promise(function(k,W){process.nextTick(function(){D[m]?W(D[m]):k(O(void 0,!0))})});var A=this[T],x;if(A)x=new Promise(p(A,this));else{var F=this[P].read();if(F!==null)return Promise.resolve(O(F,!1));x=new Promise(this[L])}return this[T]=x,x}},o(d,Symbol.asyncIterator,function(){return this}),o(d,"return",function(){var D=this;return new Promise(function(y,A){D[P].destroy(null,function(x){if(x){A(x);return}y(O(void 0,!0))})})}),d),h),v=function(D){var y,A=Object.create(C,(y={},o(y,P,{value:D,writable:!0}),o(y,c,{value:null,writable:!0}),o(y,E,{value:null,writable:!0}),o(y,m,{value:null,writable:!0}),o(y,f,{value:D._readableState.endEmitted,writable:!0}),o(y,L,{value:function(F,k){var W=A[P].read();W?(A[T]=null,A[c]=null,A[E]=null,F(O(W,!1))):(A[c]=F,A[E]=k)},writable:!0}),y));return A[T]=null,l(D,function(x){if(x&&x.code!=="ERR_STREAM_PREMATURE_CLOSE"){var F=A[E];F!==null&&(A[T]=null,A[c]=null,A[E]=null,F(x)),A[m]=x;return}var k=A[c];k!==null&&(A[T]=null,A[c]=null,A[E]=null,k(O(void 0,!0))),A[f]=!0}),D.on("readable",S.bind(null,A)),A};g.exports=v},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/buffer_list.js":(g,i,r)=>{function d(S,p){var h=Object.keys(S);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(S);p&&(C=C.filter(function(v){return Object.getOwnPropertyDescriptor(S,v).enumerable})),h.push.apply(h,C)}return h}function o(S){for(var p=1;p<arguments.length;p++){var h=arguments[p]!=null?arguments[p]:{};p%2?d(Object(h),!0).forEach(function(C){l(S,C,h[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(h)):d(Object(h)).forEach(function(C){Object.defineProperty(S,C,Object.getOwnPropertyDescriptor(h,C))})}return S}function l(S,p,h){return p in S?Object.defineProperty(S,p,{value:h,enumerable:!0,configurable:!0,writable:!0}):S[p]=h,S}function c(S,p){if(!(S instanceof p))throw new TypeError("Cannot call a class as a function")}function E(S,p){for(var h=0;h<p.length;h++){var C=p[h];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(S,C.key,C)}}function m(S,p,h){return p&&E(S.prototype,p),h&&E(S,h),S}var f=r("./node_modules/buffer/index.js"),T=f.Buffer,L=r("?3e83"),P=L.inspect,O=P&&P.custom||"inspect";function M(S,p,h){T.prototype.copy.call(S,p,h)}g.exports=function(){function S(){c(this,S),this.head=null,this.tail=null,this.length=0}return m(S,[{key:"push",value:function(h){var C={data:h,next:null};this.length>0?this.tail.next=C:this.head=C,this.tail=C,++this.length}},{key:"unshift",value:function(h){var C={data:h,next:this.head};this.length===0&&(this.tail=C),this.head=C,++this.length}},{key:"shift",value:function(){if(this.length!==0){var h=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,h}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(h){if(this.length===0)return"";for(var C=this.head,v=""+C.data;C=C.next;)v+=h+C.data;return v}},{key:"concat",value:function(h){if(this.length===0)return T.alloc(0);for(var C=T.allocUnsafe(h>>>0),v=this.head,I=0;v;)M(v.data,C,I),I+=v.data.length,v=v.next;return C}},{key:"consume",value:function(h,C){var v;return h<this.head.data.length?(v=this.head.data.slice(0,h),this.head.data=this.head.data.slice(h)):h===this.head.data.length?v=this.shift():v=C?this._getString(h):this._getBuffer(h),v}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(h){var C=this.head,v=1,I=C.data;for(h-=I.length;C=C.next;){var D=C.data,y=h>D.length?D.length:h;if(y===D.length?I+=D:I+=D.slice(0,h),h-=y,h===0){y===D.length?(++v,C.next?this.head=C.next:this.head=this.tail=null):(this.head=C,C.data=D.slice(y));break}++v}return this.length-=v,I}},{key:"_getBuffer",value:function(h){var C=T.allocUnsafe(h),v=this.head,I=1;for(v.data.copy(C),h-=v.data.length;v=v.next;){var D=v.data,y=h>D.length?D.length:h;if(D.copy(C,C.length-h,0,y),h-=y,h===0){y===D.length?(++I,v.next?this.head=v.next:this.head=this.tail=null):(this.head=v,v.data=D.slice(y));break}++I}return this.length-=I,C}},{key:O,value:function(h,C){return P(this,o({},C,{depth:0,customInspect:!1}))}}]),S}()},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/destroy.js":g=>{function i(E,m){var f=this,T=this._readableState&&this._readableState.destroyed,L=this._writableState&&this._writableState.destroyed;return T||L?(m?m(E):E&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(l,this,E)):process.nextTick(l,this,E)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(E||null,function(P){!m&&P?f._writableState?f._writableState.errorEmitted?process.nextTick(d,f):(f._writableState.errorEmitted=!0,process.nextTick(r,f,P)):process.nextTick(r,f,P):m?(process.nextTick(d,f),m(P)):process.nextTick(d,f)}),this)}function r(E,m){l(E,m),d(E)}function d(E){E._writableState&&!E._writableState.emitClose||E._readableState&&!E._readableState.emitClose||E.emit("close")}function o(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function l(E,m){E.emit("error",m)}function c(E,m){var f=E._readableState,T=E._writableState;f&&f.autoDestroy||T&&T.autoDestroy?E.destroy(m):E.emit("error",m)}g.exports={destroy:i,undestroy:o,errorOrDestroy:c}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js":(g,i,r)=>{var d=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes.ERR_STREAM_PREMATURE_CLOSE;function o(m){var f=!1;return function(){if(!f){f=!0;for(var T=arguments.length,L=new Array(T),P=0;P<T;P++)L[P]=arguments[P];m.apply(this,L)}}}function l(){}function c(m){return m.setHeader&&typeof m.abort=="function"}function E(m,f,T){if(typeof f=="function")return E(m,null,f);f||(f={}),T=o(T||l);var L=f.readable||f.readable!==!1&&m.readable,P=f.writable||f.writable!==!1&&m.writable,O=function(){m.writable||S()},M=m._writableState&&m._writableState.finished,S=function(){P=!1,M=!0,L||T.call(m)},p=m._readableState&&m._readableState.endEmitted,h=function(){L=!1,p=!0,P||T.call(m)},C=function(y){T.call(m,y)},v=function(){var y;if(L&&!p)return(!m._readableState||!m._readableState.ended)&&(y=new d),T.call(m,y);if(P&&!M)return(!m._writableState||!m._writableState.ended)&&(y=new d),T.call(m,y)},I=function(){m.req.on("finish",S)};return c(m)?(m.on("complete",S),m.on("abort",v),m.req?I():m.on("request",I)):P&&!m._writableState&&(m.on("end",O),m.on("close",O)),m.on("end",h),m.on("finish",S),f.error!==!1&&m.on("error",C),m.on("close",v),function(){m.removeListener("complete",S),m.removeListener("abort",v),m.removeListener("request",I),m.req&&m.req.removeListener("finish",S),m.removeListener("end",O),m.removeListener("close",O),m.removeListener("finish",S),m.removeListener("end",h),m.removeListener("error",C),m.removeListener("close",v)}}g.exports=E},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/from-browser.js":g=>{g.exports=function(){throw new Error("Readable.from is not available in the browser")}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/pipeline.js":(g,i,r)=>{var d;function o(S){var p=!1;return function(){p||(p=!0,S.apply(void 0,arguments))}}var l=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes,c=l.ERR_MISSING_ARGS,E=l.ERR_STREAM_DESTROYED;function m(S){if(S)throw S}function f(S){return S.setHeader&&typeof S.abort=="function"}function T(S,p,h,C){C=o(C);var v=!1;S.on("close",function(){v=!0}),d===void 0&&(d=r("./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/end-of-stream.js")),d(S,{readable:p,writable:h},function(D){if(D)return C(D);v=!0,C()});var I=!1;return function(D){if(!v&&!I){if(I=!0,f(S))return S.abort();if(typeof S.destroy=="function")return S.destroy();C(D||new E("pipe"))}}}function L(S){S()}function P(S,p){return S.pipe(p)}function O(S){return!S.length||typeof S[S.length-1]!="function"?m:S.pop()}function M(){for(var S=arguments.length,p=new Array(S),h=0;h<S;h++)p[h]=arguments[h];var C=O(p);if(Array.isArray(p[0])&&(p=p[0]),p.length<2)throw new c("streams");var v,I=p.map(function(D,y){var A=y<p.length-1,x=y>0;return T(D,A,x,function(F){v||(v=F),F&&I.forEach(L),!A&&(I.forEach(L),C(v))})});return p.reduce(P)}g.exports=M},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/state.js":(g,i,r)=>{var d=r("./node_modules/stream-browserify/node_modules/readable-stream/errors-browser.js").codes.ERR_INVALID_OPT_VALUE;function o(c,E,m){return c.highWaterMark!=null?c.highWaterMark:E?c[m]:null}function l(c,E,m,f){var T=o(E,f,m);if(T!=null){if(!(isFinite(T)&&Math.floor(T)===T)||T<0){var L=f?m:"highWaterMark";throw new d(L,T)}return Math.floor(T)}return c.objectMode?16:16384}g.exports={getHighWaterMark:l}},"./node_modules/stream-browserify/node_modules/readable-stream/lib/internal/streams/stream-browser.js":(g,i,r)=>{g.exports=r("./node_modules/events/events.js").EventEmitter},"./node_modules/string_decoder/lib/string_decoder.js":(g,i,r)=>{var d=r("./node_modules/safe-buffer/index.js").Buffer,o=d.isEncoding||function(I){switch(I=""+I,I&&I.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function l(I){if(!I)return"utf8";for(var D;;)switch(I){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return I;default:if(D)return;I=(""+I).toLowerCase(),D=!0}}function c(I){var D=l(I);if(typeof D!="string"&&(d.isEncoding===o||!o(I)))throw new Error("Unknown encoding: "+I);return D||I}i.StringDecoder=E;function E(I){this.encoding=c(I);var D;switch(this.encoding){case"utf16le":this.text=M,this.end=S,D=4;break;case"utf8":this.fillLast=L,D=4;break;case"base64":this.text=p,this.end=h,D=3;break;default:this.write=C,this.end=v;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=d.allocUnsafe(D)}E.prototype.write=function(I){if(I.length===0)return"";var D,y;if(this.lastNeed){if(D=this.fillLast(I),D===void 0)return"";y=this.lastNeed,this.lastNeed=0}else y=0;return y<I.length?D?D+this.text(I,y):this.text(I,y):D||""},E.prototype.end=O,E.prototype.text=P,E.prototype.fillLast=function(I){if(this.lastNeed<=I.length)return I.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);I.copy(this.lastChar,this.lastTotal-this.lastNeed,0,I.length),this.lastNeed-=I.length};function m(I){return I<=127?0:I>>5===6?2:I>>4===14?3:I>>3===30?4:I>>6===2?-1:-2}function f(I,D,y){var A=D.length-1;if(A<y)return 0;var x=m(D[A]);return x>=0?(x>0&&(I.lastNeed=x-1),x):--A<y||x===-2?0:(x=m(D[A]),x>=0?(x>0&&(I.lastNeed=x-2),x):--A<y||x===-2?0:(x=m(D[A]),x>=0?(x>0&&(x===2?x=0:I.lastNeed=x-3),x):0))}function T(I,D,y){if((D[0]&192)!==128)return I.lastNeed=0,"";if(I.lastNeed>1&&D.length>1){if((D[1]&192)!==128)return I.lastNeed=1,"";if(I.lastNeed>2&&D.length>2&&(D[2]&192)!==128)return I.lastNeed=2,""}}function L(I){var D=this.lastTotal-this.lastNeed,y=T(this,I);if(y!==void 0)return y;if(this.lastNeed<=I.length)return I.copy(this.lastChar,D,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);I.copy(this.lastChar,D,0,I.length),this.lastNeed-=I.length}function P(I,D){var y=f(this,I,D);if(!this.lastNeed)return I.toString("utf8",D);this.lastTotal=y;var A=I.length-(y-this.lastNeed);return I.copy(this.lastChar,0,A),I.toString("utf8",D,A)}function O(I){var D=I&&I.length?this.write(I):"";return this.lastNeed?D+"":D}function M(I,D){if((I.length-D)%2===0){var y=I.toString("utf16le",D);if(y){var A=y.charCodeAt(y.length-1);if(A>=55296&&A<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=I[I.length-2],this.lastChar[1]=I[I.length-1],y.slice(0,-1)}return y}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=I[I.length-1],I.toString("utf16le",D,I.length-1)}function S(I){var D=I&&I.length?this.write(I):"";if(this.lastNeed){var y=this.lastTotal-this.lastNeed;return D+this.lastChar.toString("utf16le",0,y)}return D}function p(I,D){var y=(I.length-D)%3;return y===0?I.toString("base64",D):(this.lastNeed=3-y,this.lastTotal=3,y===1?this.lastChar[0]=I[I.length-1]:(this.lastChar[0]=I[I.length-2],this.lastChar[1]=I[I.length-1]),I.toString("base64",D,I.length-y))}function h(I){var D=I&&I.length?this.write(I):"";return this.lastNeed?D+this.lastChar.toString("base64",0,3-this.lastNeed):D}function C(I){return I.toString(this.encoding)}function v(I){return I&&I.length?this.write(I):""}},"./node_modules/ua-parser-js/src/ua-parser.js":function(g,i,r){var d;(function(o,l){var c="1.0.2",E="",m="?",f="function",T="undefined",L="object",P="string",O="major",M="model",S="name",p="type",h="vendor",C="version",v="architecture",I="console",D="mobile",y="tablet",A="smarttv",x="wearable",F="embedded",k=255,W="Amazon",V="Apple",Q="ASUS",$="BlackBerry",K="Browser",Y="Chrome",re="Edge",ie="Firefox",ee="Google",ne="Huawei",ae="LG",ce="Microsoft",X="Motorola",oe="Opera",ge="Samsung",_e="Sony",he="Xiaomi",se="Zebra",Z="Facebook",q=function(J,ve){var me={};for(var Ae in J)ve[Ae]&&ve[Ae].length%2===0?me[Ae]=ve[Ae].concat(J[Ae]):me[Ae]=J[Ae];return me},le=function(J){for(var ve={},me=0;me<J.length;me++)ve[J[me].toUpperCase()]=J[me];return ve},te=function(J,ve){return typeof J===P?N(ve).indexOf(N(J))!==-1:!1},N=function(J){return J.toLowerCase()},R=function(J){return typeof J===P?J.replace(/[^\d\.]/g,E).split(".")[0]:l},w=function(J,ve){if(typeof J===P)return J=J.replace(/^\s\s*/,E).replace(/\s\s*$/,E),typeof ve===T?J:J.substring(0,k)},j=function(J,ve){for(var me=0,Ae,be,Be,ke,Ye,Oe;me<ve.length&&!Ye;){var Se=ve[me],Me=ve[me+1];for(Ae=be=0;Ae<Se.length&&!Ye;)if(Ye=Se[Ae++].exec(J),Ye)for(Be=0;Be<Me.length;Be++)Oe=Ye[++be],ke=Me[Be],typeof ke===L&&ke.length>0?ke.length===2?typeof ke[1]==f?this[ke[0]]=ke[1].call(this,Oe):this[ke[0]]=ke[1]:ke.length===3?typeof ke[1]===f&&!(ke[1].exec&&ke[1].test)?this[ke[0]]=Oe?ke[1].call(this,Oe,ke[2]):l:this[ke[0]]=Oe?Oe.replace(ke[1],ke[2]):l:ke.length===4&&(this[ke[0]]=Oe?ke[3].call(this,Oe.replace(ke[1],ke[2])):l):this[ke]=Oe||l;me+=2}},H=function(J,ve){for(var me in ve)if(typeof ve[me]===L&&ve[me].length>0){for(var Ae=0;Ae<ve[me].length;Ae++)if(te(ve[me][Ae],J))return me===m?l:me}else if(te(ve[me],J))return me===m?l:me;return J},U={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},B={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},G={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,C],[/opios[\/ ]+([\w\.]+)/i],[C,[S,oe+" Mini"]],[/\bopr\/([\w\.]+)/i],[C,[S,oe]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,C],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[S,"UC"+K]],[/\bqbcore\/([\w\.]+)/i],[C,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[C,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[C,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+K],C],[/\bfocus\/([\w\.]+)/i],[C,[S,ie+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[S,oe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[S,oe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[S,"MIUI "+K]],[/fxios\/([-\w\.]+)/i],[C,[S,ie]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+K]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+K],C],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,C],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,Z],C],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[S,Y+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,Y+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[S,"Android "+K]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,C],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[C,[S,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[C,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[C,H,U]],[/(webkit|khtml)\/([\w\.]+)/i],[S,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[S,ie+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[S,C]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[v,"amd64"]],[/(ia32(?=;))/i],[[v,N]],[/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[v,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[v,"armhf"]],[/windows (ce|mobile); ppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[v,/ower/,E,N]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[v,N]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[M,[h,ge],[p,y]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[M,[h,ge],[p,D]],[/\((ip(?:hone|od)[\w ]*);/i],[M,[h,V],[p,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[M,[h,V],[p,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[M,[h,ne],[p,y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[M,[h,ne],[p,D]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[M,/_/g," "],[h,he],[p,D]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[M,/_/g," "],[h,he],[p,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[M,[h,"OPPO"],[p,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[M,[h,"Vivo"],[p,D]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[M,[h,"Realme"],[p,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[M,[h,X],[p,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[M,[h,X],[p,y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[M,[h,ae],[p,y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[M,[h,ae],[p,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[M,[h,"Lenovo"],[p,y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[M,/_/g," "],[h,"Nokia"],[p,D]],[/(pixel c)\b/i],[M,[h,ee],[p,y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[M,[h,ee],[p,D]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[M,[h,_e],[p,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[M,"Xperia Tablet"],[h,_e],[p,y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[M,[h,"OnePlus"],[p,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[M,[h,W],[p,y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[M,/(.+)/g,"Fire Phone $1"],[h,W],[p,D]],[/(playbook);[-\w\),; ]+(rim)/i],[M,h,[p,y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[M,[h,$],[p,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[M,[h,Q],[p,y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[M,[h,Q],[p,D]],[/(nexus 9)/i],[M,[h,"HTC"],[p,y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[h,[M,/_/g," "],[p,D]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[M,[h,"Acer"],[p,y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[M,[h,"Meizu"],[p,D]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[M,[h,"Sharp"],[p,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,M,[p,D]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,M,[p,y]],[/(surface duo)/i],[M,[h,ce],[p,y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[M,[h,"Fairphone"],[p,D]],[/(u304aa)/i],[M,[h,"AT&T"],[p,D]],[/\bsie-(\w*)/i],[M,[h,"Siemens"],[p,D]],[/\b(rct\w+) b/i],[M,[h,"RCA"],[p,y]],[/\b(venue[\d ]{2,7}) b/i],[M,[h,"Dell"],[p,y]],[/\b(q(?:mv|ta)\w+) b/i],[M,[h,"Verizon"],[p,y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[M,[h,"Barnes & Noble"],[p,y]],[/\b(tm\d{3}\w+) b/i],[M,[h,"NuVision"],[p,y]],[/\b(k88) b/i],[M,[h,"ZTE"],[p,y]],[/\b(nx\d{3}j) b/i],[M,[h,"ZTE"],[p,D]],[/\b(gen\d{3}) b.+49h/i],[M,[h,"Swiss"],[p,D]],[/\b(zur\d{3}) b/i],[M,[h,"Swiss"],[p,y]],[/\b((zeki)?tb.*\b) b/i],[M,[h,"Zeki"],[p,y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],M,[p,y]],[/\b(ns-?\w{0,9}) b/i],[M,[h,"Insignia"],[p,y]],[/\b((nxa|next)-?\w{0,9}) b/i],[M,[h,"NextBook"],[p,y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],M,[p,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],M,[p,D]],[/\b(ph-1) /i],[M,[h,"Essential"],[p,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[M,[h,"Envizen"],[p,y]],[/\b(trio[-\w\. ]+) b/i],[M,[h,"MachSpeed"],[p,y]],[/\btu_(1491) b/i],[M,[h,"Rotor"],[p,y]],[/(shield[\w ]+) b/i],[M,[h,"Nvidia"],[p,y]],[/(sprint) (\w+)/i],[h,M,[p,D]],[/(kin\.[onetw]{3})/i],[[M,/\./g," "],[h,ce],[p,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[M,[h,se],[p,y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[M,[h,se],[p,D]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,M,[p,I]],[/droid.+; (shield) bui/i],[M,[h,"Nvidia"],[p,I]],[/(playstation [345portablevi]+)/i],[M,[h,_e],[p,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[M,[h,ce],[p,I]],[/smart-tv.+(samsung)/i],[h,[p,A]],[/hbbtv.+maple;(\d+)/i],[[M,/^/,"SmartTV"],[h,ge],[p,A]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,ae],[p,A]],[/(apple) ?tv/i],[h,[M,V+" TV"],[p,A]],[/crkey/i],[[M,Y+"cast"],[h,ee],[p,A]],[/droid.+aft(\w)( bui|\))/i],[M,[h,W],[p,A]],[/\(dtv[\);].+(aquos)/i],[M,[h,"Sharp"],[p,A]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[h,w],[M,w],[p,A]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,A]],[/((pebble))app/i],[h,M,[p,x]],[/droid.+; (glass) \d/i],[M,[h,ee],[p,x]],[/droid.+; (wt63?0{2,3})\)/i],[M,[h,se],[p,x]],[/(quest( 2)?)/i],[M,[h,Z],[p,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[p,F]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[M,[p,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[M,[p,y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,y]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[p,D]],[/(android[-\w\. ]{0,9});.+buil/i],[M,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[S,re+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,C],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,C],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[C,H,B]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[C,H,B]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,"Mac OS"],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[C,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,C],[/\(bb(10);/i],[C,[S,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[C,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[S,ie+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[S,"webOS"]],[/crkey\/([\d\.]+)/i],[C,[S,Y+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[S,"Chromium OS"],C],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,C],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,C]]},z=function(J,ve){if(typeof J===L&&(ve=J,J=l),!(this instanceof z))return new z(J,ve).getResult();var me=J||(typeof o!==T&&o.navigator&&o.navigator.userAgent?o.navigator.userAgent:E),Ae=ve?q(G,ve):G;return this.getBrowser=function(){var be={};return be[S]=l,be[C]=l,j.call(be,me,Ae.browser),be.major=R(be.version),be},this.getCPU=function(){var be={};return be[v]=l,j.call(be,me,Ae.cpu),be},this.getDevice=function(){var be={};return be[h]=l,be[M]=l,be[p]=l,j.call(be,me,Ae.device),be},this.getEngine=function(){var be={};return be[S]=l,be[C]=l,j.call(be,me,Ae.engine),be},this.getOS=function(){var be={};return be[S]=l,be[C]=l,j.call(be,me,Ae.os),be},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return me},this.setUA=function(be){return me=typeof be===P&&be.length>k?w(be,k):be,this},this.setUA(me),this};z.VERSION=c,z.BROWSER=le([S,C,O]),z.CPU=le([v]),z.DEVICE=le([M,h,p,I,D,A,y,x,F]),z.ENGINE=z.OS=le([S,C]),typeof i!==T?(g.exports&&(i=g.exports=z),i.UAParser=z):r.amdO?(d=function(){return z}.call(i,r,i,g),d!==l&&(g.exports=d)):typeof o!==T&&(o.UAParser=z);var fe=typeof o!==T&&(o.jQuery||o.Zepto);if(fe&&!fe.ua){var ue=new z;fe.ua=ue.getResult(),fe.ua.get=function(){return ue.getUA()},fe.ua.set=function(J){ue.setUA(J);var ve=ue.getResult();for(var me in ve)fe.ua[me]=ve[me]}}})(typeof window=="object"?window:this)},"./node_modules/util-deprecate/browser.js":(g,i,r)=>{g.exports=d;function d(l,c){if(o("noDeprecation"))return l;var E=!1;function m(){if(!E){if(o("throwDeprecation"))throw new Error(c);o("traceDeprecation")?console.trace(c):console.warn(c),E=!0}return l.apply(this,arguments)}return m}function o(l){try{if(!r.g.localStorage)return!1}catch{return!1}var c=r.g.localStorage[l];return c==null?!1:String(c).toLowerCase()==="true"}},"?3e83":()=>{},"?19e6":()=>{},"./node_modules/bcp-47-normalize/lib/defaults.json":g=>{g.exports=JSON.parse('["mni-beng-in","mni-mtei-in","sat-deva-in","sat-olck-in","shi-latn-ma","shi-tfng-ma","vai-latn-lr","vai-vaii-lr","yue-hans-cn","yue-hant-hk","az-arab-ir","az-cyrl-az","az-latn-az","bm-nkoo-ml","bs-cyrl-ba","bs-latn-ba","en-dsrt-us","ff-adlm-gn","ff-latn-sn","ha-arab-ng","hi-latn-in","iu-latn-ca","ks-arab-in","ks-deva-in","mn-mong-cn","ms-arab-my","pa-arab-pk","pa-guru-in","sd-arab-pk","sd-deva-in","sr-cyrl-rs","sr-latn-rs","su-latn-id","uz-arab-af","uz-cyrl-uz","uz-latn-uz","zh-hans-cn","zh-hant-tw","mni-beng","sat-olck","shi-tfng","vai-vaii","yue-hant","az-latn","bs-latn","ff-latn","jbo-001","ks-arab","pa-guru","prg-001","sd-arab","sr-cyrl","su-latn","uz-latn","zh-hans","agq-cm","ar-001","arn-cl","asa-tz","ast-es","bas-cm","bem-zm","bez-tz","bgn-pk","blt-vn","brx-in","bss-cm","byn-er","cad-us","cch-ng","ccp-bd","ceb-ph","cgg-ug","chr-us","cic-us","ckb-iq","dav-ke","dje-ne","doi-in","dsb-de","dua-cm","dyo-sn","ebu-ke","eo-001","ewo-cm","fil-ph","fur-it","gaa-gh","gez-et","gsw-ch","guz-ke","haw-us","hsb-de","ia-001","ife-tg","io-001","jgo-cm","jmc-tz","kab-dz","kaj-ng","kam-ke","kcg-ng","kde-tz","kea-cv","ken-cm","khq-ml","kkj-cm","kln-ke","kok-in","kpe-lr","ksb-tz","ksf-cm","ksh-de","lag-tz","lkt-us","lrc-ir","luo-ke","luy-ke","mai-in","mas-ke","mer-ke","mfe-mu","mgh-mz","mgo-cm","moh-ca","mua-cm","mus-us","myv-ru","mzn-ir","naq-na","nds-de","nmg-cm","nnh-cm","nqo-gn","nso-za","nus-ss","nyn-ug","osa-us","pcm-ng","quc-gt","rof-tz","rwk-tz","sah-ru","saq-ke","sbp-tz","scn-it","sdh-ir","seh-mz","ses-ml","sid-et","sma-se","smj-se","smn-fi","sms-fi","ssy-er","syr-iq","szl-pl","teo-ug","tig-er","trv-tw","trw-pk","twq-ne","tzm-ma","vo-001","vun-tz","wae-ch","wal-et","wbp-au","xog-ug","yav-cm","yi-001","zgh-ma","aa-et","af-za","ak-gh","am-et","an-es","as-in","ba-ru","be-by","bg-bg","bm-ml","bn-bd","bo-cn","br-fr","ca-es","ce-ru","co-fr","cs-cz","cu-ru","cv-ru","cy-gb","da-dk","de-de","dv-mv","dz-bt","ee-gh","el-gr","en-us","es-es","et-ee","eu-es","fa-ir","fi-fi","fo-fo","fr-fr","fy-nl","ga-ie","gd-gb","gl-es","gn-py","gu-in","gv-im","ha-ng","he-il","hi-in","hr-hr","hu-hu","hy-am","id-id","ig-ng","ii-cn","is-is","it-it","iu-ca","ja-jp","jv-id","ka-ge","ki-ke","kk-kz","kl-gl","km-kh","kn-in","ko-kr","ku-tr","kw-gb","ky-kg","lb-lu","lg-ug","ln-cd","lo-la","lt-lt","lu-cd","lv-lv","mg-mg","mi-nz","mk-mk","ml-in","mn-mn","mr-in","ms-my","mt-mt","my-mm","nb-no","nd-zw","ne-np","nl-nl","nn-no","nr-za","nv-us","ny-mw","oc-fr","om-et","or-in","os-ge","pl-pl","ps-af","pt-br","qu-pe","rm-ch","rn-bi","ro-ro","ru-ru","rw-rw","sa-in","sc-it","se-no","sg-cf","si-lk","sk-sk","sl-si","sn-zw","so-so","sq-al","ss-za","st-za","sv-se","sw-tz","ta-in","te-in","tg-tj","th-th","ti-et","tk-tm","tn-za","to-to","tr-tr","ts-za","tt-ru","ug-cn","uk-ua","ur-pk","ve-za","vi-vn","wa-be","wo-sn","xh-za","yo-ng","zu-za"]')},"./node_modules/bcp-47-normalize/lib/fields.json":g=>{g.exports=JSON.parse('[{"from":{"field":"script","value":"qaai"},"to":{"field":"script","value":"zinh"}},{"from":{"field":"region","value":"bu"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"ct"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"dd"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"dy"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"fx"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"hv"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"jt"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"mi"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"nh"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"nq"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"pu"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"pz"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"qu"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"rh"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"tp"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"uk"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"vd"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"wk"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"yd"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"zr"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"230"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"280"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"736"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"886"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"958"},"to":{"field":"region","value":"aa"}},{"from":{"field":"region","value":"020"},"to":{"field":"region","value":"ad"}},{"from":{"field":"region","value":"784"},"to":{"field":"region","value":"ae"}},{"from":{"field":"region","value":"004"},"to":{"field":"region","value":"af"}},{"from":{"field":"region","value":"028"},"to":{"field":"region","value":"ag"}},{"from":{"field":"region","value":"660"},"to":{"field":"region","value":"ai"}},{"from":{"field":"region","value":"008"},"to":{"field":"region","value":"al"}},{"from":{"field":"region","value":"051"},"to":{"field":"region","value":"am"}},{"from":{"field":"region","value":"024"},"to":{"field":"region","value":"ao"}},{"from":{"field":"region","value":"010"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"032"},"to":{"field":"region","value":"ar"}},{"from":{"field":"region","value":"016"},"to":{"field":"region","value":"as"}},{"from":{"field":"region","value":"040"},"to":{"field":"region","value":"at"}},{"from":{"field":"region","value":"036"},"to":{"field":"region","value":"au"}},{"from":{"field":"region","value":"533"},"to":{"field":"region","value":"aw"}},{"from":{"field":"region","value":"248"},"to":{"field":"region","value":"ax"}},{"from":{"field":"region","value":"031"},"to":{"field":"region","value":"az"}},{"from":{"field":"region","value":"070"},"to":{"field":"region","value":"ba"}},{"from":{"field":"region","value":"052"},"to":{"field":"region","value":"bb"}},{"from":{"field":"region","value":"050"},"to":{"field":"region","value":"bd"}},{"from":{"field":"region","value":"056"},"to":{"field":"region","value":"be"}},{"from":{"field":"region","value":"854"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"100"},"to":{"field":"region","value":"bg"}},{"from":{"field":"region","value":"048"},"to":{"field":"region","value":"bh"}},{"from":{"field":"region","value":"108"},"to":{"field":"region","value":"bi"}},{"from":{"field":"region","value":"204"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"652"},"to":{"field":"region","value":"bl"}},{"from":{"field":"region","value":"060"},"to":{"field":"region","value":"bm"}},{"from":{"field":"region","value":"096"},"to":{"field":"region","value":"bn"}},{"from":{"field":"region","value":"068"},"to":{"field":"region","value":"bo"}},{"from":{"field":"region","value":"535"},"to":{"field":"region","value":"bq"}},{"from":{"field":"region","value":"076"},"to":{"field":"region","value":"br"}},{"from":{"field":"region","value":"044"},"to":{"field":"region","value":"bs"}},{"from":{"field":"region","value":"064"},"to":{"field":"region","value":"bt"}},{"from":{"field":"region","value":"104"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"074"},"to":{"field":"region","value":"bv"}},{"from":{"field":"region","value":"072"},"to":{"field":"region","value":"bw"}},{"from":{"field":"region","value":"112"},"to":{"field":"region","value":"by"}},{"from":{"field":"region","value":"084"},"to":{"field":"region","value":"bz"}},{"from":{"field":"region","value":"124"},"to":{"field":"region","value":"ca"}},{"from":{"field":"region","value":"166"},"to":{"field":"region","value":"cc"}},{"from":{"field":"region","value":"180"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"140"},"to":{"field":"region","value":"cf"}},{"from":{"field":"region","value":"178"},"to":{"field":"region","value":"cg"}},{"from":{"field":"region","value":"756"},"to":{"field":"region","value":"ch"}},{"from":{"field":"region","value":"384"},"to":{"field":"region","value":"ci"}},{"from":{"field":"region","value":"184"},"to":{"field":"region","value":"ck"}},{"from":{"field":"region","value":"152"},"to":{"field":"region","value":"cl"}},{"from":{"field":"region","value":"120"},"to":{"field":"region","value":"cm"}},{"from":{"field":"region","value":"156"},"to":{"field":"region","value":"cn"}},{"from":{"field":"region","value":"170"},"to":{"field":"region","value":"co"}},{"from":{"field":"region","value":"188"},"to":{"field":"region","value":"cr"}},{"from":{"field":"region","value":"192"},"to":{"field":"region","value":"cu"}},{"from":{"field":"region","value":"132"},"to":{"field":"region","value":"cv"}},{"from":{"field":"region","value":"531"},"to":{"field":"region","value":"cw"}},{"from":{"field":"region","value":"162"},"to":{"field":"region","value":"cx"}},{"from":{"field":"region","value":"196"},"to":{"field":"region","value":"cy"}},{"from":{"field":"region","value":"203"},"to":{"field":"region","value":"cz"}},{"from":{"field":"region","value":"278"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"276"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"262"},"to":{"field":"region","value":"dj"}},{"from":{"field":"region","value":"208"},"to":{"field":"region","value":"dk"}},{"from":{"field":"region","value":"212"},"to":{"field":"region","value":"dm"}},{"from":{"field":"region","value":"214"},"to":{"field":"region","value":"do"}},{"from":{"field":"region","value":"012"},"to":{"field":"region","value":"dz"}},{"from":{"field":"region","value":"218"},"to":{"field":"region","value":"ec"}},{"from":{"field":"region","value":"233"},"to":{"field":"region","value":"ee"}},{"from":{"field":"region","value":"818"},"to":{"field":"region","value":"eg"}},{"from":{"field":"region","value":"732"},"to":{"field":"region","value":"eh"}},{"from":{"field":"region","value":"232"},"to":{"field":"region","value":"er"}},{"from":{"field":"region","value":"724"},"to":{"field":"region","value":"es"}},{"from":{"field":"region","value":"231"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"246"},"to":{"field":"region","value":"fi"}},{"from":{"field":"region","value":"242"},"to":{"field":"region","value":"fj"}},{"from":{"field":"region","value":"238"},"to":{"field":"region","value":"fk"}},{"from":{"field":"region","value":"583"},"to":{"field":"region","value":"fm"}},{"from":{"field":"region","value":"234"},"to":{"field":"region","value":"fo"}},{"from":{"field":"region","value":"250"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"249"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"266"},"to":{"field":"region","value":"ga"}},{"from":{"field":"region","value":"826"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"308"},"to":{"field":"region","value":"gd"}},{"from":{"field":"region","value":"268"},"to":{"field":"region","value":"ge"}},{"from":{"field":"region","value":"254"},"to":{"field":"region","value":"gf"}},{"from":{"field":"region","value":"831"},"to":{"field":"region","value":"gg"}},{"from":{"field":"region","value":"288"},"to":{"field":"region","value":"gh"}},{"from":{"field":"region","value":"292"},"to":{"field":"region","value":"gi"}},{"from":{"field":"region","value":"304"},"to":{"field":"region","value":"gl"}},{"from":{"field":"region","value":"270"},"to":{"field":"region","value":"gm"}},{"from":{"field":"region","value":"324"},"to":{"field":"region","value":"gn"}},{"from":{"field":"region","value":"312"},"to":{"field":"region","value":"gp"}},{"from":{"field":"region","value":"226"},"to":{"field":"region","value":"gq"}},{"from":{"field":"region","value":"300"},"to":{"field":"region","value":"gr"}},{"from":{"field":"region","value":"239"},"to":{"field":"region","value":"gs"}},{"from":{"field":"region","value":"320"},"to":{"field":"region","value":"gt"}},{"from":{"field":"region","value":"316"},"to":{"field":"region","value":"gu"}},{"from":{"field":"region","value":"624"},"to":{"field":"region","value":"gw"}},{"from":{"field":"region","value":"328"},"to":{"field":"region","value":"gy"}},{"from":{"field":"region","value":"344"},"to":{"field":"region","value":"hk"}},{"from":{"field":"region","value":"334"},"to":{"field":"region","value":"hm"}},{"from":{"field":"region","value":"340"},"to":{"field":"region","value":"hn"}},{"from":{"field":"region","value":"191"},"to":{"field":"region","value":"hr"}},{"from":{"field":"region","value":"332"},"to":{"field":"region","value":"ht"}},{"from":{"field":"region","value":"348"},"to":{"field":"region","value":"hu"}},{"from":{"field":"region","value":"360"},"to":{"field":"region","value":"id"}},{"from":{"field":"region","value":"372"},"to":{"field":"region","value":"ie"}},{"from":{"field":"region","value":"376"},"to":{"field":"region","value":"il"}},{"from":{"field":"region","value":"833"},"to":{"field":"region","value":"im"}},{"from":{"field":"region","value":"356"},"to":{"field":"region","value":"in"}},{"from":{"field":"region","value":"086"},"to":{"field":"region","value":"io"}},{"from":{"field":"region","value":"368"},"to":{"field":"region","value":"iq"}},{"from":{"field":"region","value":"364"},"to":{"field":"region","value":"ir"}},{"from":{"field":"region","value":"352"},"to":{"field":"region","value":"is"}},{"from":{"field":"region","value":"380"},"to":{"field":"region","value":"it"}},{"from":{"field":"region","value":"832"},"to":{"field":"region","value":"je"}},{"from":{"field":"region","value":"388"},"to":{"field":"region","value":"jm"}},{"from":{"field":"region","value":"400"},"to":{"field":"region","value":"jo"}},{"from":{"field":"region","value":"392"},"to":{"field":"region","value":"jp"}},{"from":{"field":"region","value":"404"},"to":{"field":"region","value":"ke"}},{"from":{"field":"region","value":"417"},"to":{"field":"region","value":"kg"}},{"from":{"field":"region","value":"116"},"to":{"field":"region","value":"kh"}},{"from":{"field":"region","value":"296"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"174"},"to":{"field":"region","value":"km"}},{"from":{"field":"region","value":"659"},"to":{"field":"region","value":"kn"}},{"from":{"field":"region","value":"408"},"to":{"field":"region","value":"kp"}},{"from":{"field":"region","value":"410"},"to":{"field":"region","value":"kr"}},{"from":{"field":"region","value":"414"},"to":{"field":"region","value":"kw"}},{"from":{"field":"region","value":"136"},"to":{"field":"region","value":"ky"}},{"from":{"field":"region","value":"398"},"to":{"field":"region","value":"kz"}},{"from":{"field":"region","value":"418"},"to":{"field":"region","value":"la"}},{"from":{"field":"region","value":"422"},"to":{"field":"region","value":"lb"}},{"from":{"field":"region","value":"662"},"to":{"field":"region","value":"lc"}},{"from":{"field":"region","value":"438"},"to":{"field":"region","value":"li"}},{"from":{"field":"region","value":"144"},"to":{"field":"region","value":"lk"}},{"from":{"field":"region","value":"430"},"to":{"field":"region","value":"lr"}},{"from":{"field":"region","value":"426"},"to":{"field":"region","value":"ls"}},{"from":{"field":"region","value":"440"},"to":{"field":"region","value":"lt"}},{"from":{"field":"region","value":"442"},"to":{"field":"region","value":"lu"}},{"from":{"field":"region","value":"428"},"to":{"field":"region","value":"lv"}},{"from":{"field":"region","value":"434"},"to":{"field":"region","value":"ly"}},{"from":{"field":"region","value":"504"},"to":{"field":"region","value":"ma"}},{"from":{"field":"region","value":"492"},"to":{"field":"region","value":"mc"}},{"from":{"field":"region","value":"498"},"to":{"field":"region","value":"md"}},{"from":{"field":"region","value":"499"},"to":{"field":"region","value":"me"}},{"from":{"field":"region","value":"663"},"to":{"field":"region","value":"mf"}},{"from":{"field":"region","value":"450"},"to":{"field":"region","value":"mg"}},{"from":{"field":"region","value":"584"},"to":{"field":"region","value":"mh"}},{"from":{"field":"region","value":"807"},"to":{"field":"region","value":"mk"}},{"from":{"field":"region","value":"466"},"to":{"field":"region","value":"ml"}},{"from":{"field":"region","value":"496"},"to":{"field":"region","value":"mn"}},{"from":{"field":"region","value":"446"},"to":{"field":"region","value":"mo"}},{"from":{"field":"region","value":"580"},"to":{"field":"region","value":"mp"}},{"from":{"field":"region","value":"474"},"to":{"field":"region","value":"mq"}},{"from":{"field":"region","value":"478"},"to":{"field":"region","value":"mr"}},{"from":{"field":"region","value":"500"},"to":{"field":"region","value":"ms"}},{"from":{"field":"region","value":"470"},"to":{"field":"region","value":"mt"}},{"from":{"field":"region","value":"480"},"to":{"field":"region","value":"mu"}},{"from":{"field":"region","value":"462"},"to":{"field":"region","value":"mv"}},{"from":{"field":"region","value":"454"},"to":{"field":"region","value":"mw"}},{"from":{"field":"region","value":"484"},"to":{"field":"region","value":"mx"}},{"from":{"field":"region","value":"458"},"to":{"field":"region","value":"my"}},{"from":{"field":"region","value":"508"},"to":{"field":"region","value":"mz"}},{"from":{"field":"region","value":"516"},"to":{"field":"region","value":"na"}},{"from":{"field":"region","value":"540"},"to":{"field":"region","value":"nc"}},{"from":{"field":"region","value":"562"},"to":{"field":"region","value":"ne"}},{"from":{"field":"region","value":"574"},"to":{"field":"region","value":"nf"}},{"from":{"field":"region","value":"566"},"to":{"field":"region","value":"ng"}},{"from":{"field":"region","value":"558"},"to":{"field":"region","value":"ni"}},{"from":{"field":"region","value":"528"},"to":{"field":"region","value":"nl"}},{"from":{"field":"region","value":"578"},"to":{"field":"region","value":"no"}},{"from":{"field":"region","value":"524"},"to":{"field":"region","value":"np"}},{"from":{"field":"region","value":"520"},"to":{"field":"region","value":"nr"}},{"from":{"field":"region","value":"570"},"to":{"field":"region","value":"nu"}},{"from":{"field":"region","value":"554"},"to":{"field":"region","value":"nz"}},{"from":{"field":"region","value":"512"},"to":{"field":"region","value":"om"}},{"from":{"field":"region","value":"591"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"604"},"to":{"field":"region","value":"pe"}},{"from":{"field":"region","value":"258"},"to":{"field":"region","value":"pf"}},{"from":{"field":"region","value":"598"},"to":{"field":"region","value":"pg"}},{"from":{"field":"region","value":"608"},"to":{"field":"region","value":"ph"}},{"from":{"field":"region","value":"586"},"to":{"field":"region","value":"pk"}},{"from":{"field":"region","value":"616"},"to":{"field":"region","value":"pl"}},{"from":{"field":"region","value":"666"},"to":{"field":"region","value":"pm"}},{"from":{"field":"region","value":"612"},"to":{"field":"region","value":"pn"}},{"from":{"field":"region","value":"630"},"to":{"field":"region","value":"pr"}},{"from":{"field":"region","value":"275"},"to":{"field":"region","value":"ps"}},{"from":{"field":"region","value":"620"},"to":{"field":"region","value":"pt"}},{"from":{"field":"region","value":"585"},"to":{"field":"region","value":"pw"}},{"from":{"field":"region","value":"600"},"to":{"field":"region","value":"py"}},{"from":{"field":"region","value":"634"},"to":{"field":"region","value":"qa"}},{"from":{"field":"region","value":"959"},"to":{"field":"region","value":"qm"}},{"from":{"field":"region","value":"960"},"to":{"field":"region","value":"qn"}},{"from":{"field":"region","value":"962"},"to":{"field":"region","value":"qp"}},{"from":{"field":"region","value":"963"},"to":{"field":"region","value":"qq"}},{"from":{"field":"region","value":"964"},"to":{"field":"region","value":"qr"}},{"from":{"field":"region","value":"965"},"to":{"field":"region","value":"qs"}},{"from":{"field":"region","value":"966"},"to":{"field":"region","value":"qt"}},{"from":{"field":"region","value":"967"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"968"},"to":{"field":"region","value":"qv"}},{"from":{"field":"region","value":"969"},"to":{"field":"region","value":"qw"}},{"from":{"field":"region","value":"970"},"to":{"field":"region","value":"qx"}},{"from":{"field":"region","value":"971"},"to":{"field":"region","value":"qy"}},{"from":{"field":"region","value":"972"},"to":{"field":"region","value":"qz"}},{"from":{"field":"region","value":"638"},"to":{"field":"region","value":"re"}},{"from":{"field":"region","value":"642"},"to":{"field":"region","value":"ro"}},{"from":{"field":"region","value":"688"},"to":{"field":"region","value":"rs"}},{"from":{"field":"region","value":"643"},"to":{"field":"region","value":"ru"}},{"from":{"field":"region","value":"646"},"to":{"field":"region","value":"rw"}},{"from":{"field":"region","value":"682"},"to":{"field":"region","value":"sa"}},{"from":{"field":"region","value":"090"},"to":{"field":"region","value":"sb"}},{"from":{"field":"region","value":"690"},"to":{"field":"region","value":"sc"}},{"from":{"field":"region","value":"729"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"752"},"to":{"field":"region","value":"se"}},{"from":{"field":"region","value":"702"},"to":{"field":"region","value":"sg"}},{"from":{"field":"region","value":"654"},"to":{"field":"region","value":"sh"}},{"from":{"field":"region","value":"705"},"to":{"field":"region","value":"si"}},{"from":{"field":"region","value":"744"},"to":{"field":"region","value":"sj"}},{"from":{"field":"region","value":"703"},"to":{"field":"region","value":"sk"}},{"from":{"field":"region","value":"694"},"to":{"field":"region","value":"sl"}},{"from":{"field":"region","value":"674"},"to":{"field":"region","value":"sm"}},{"from":{"field":"region","value":"686"},"to":{"field":"region","value":"sn"}},{"from":{"field":"region","value":"706"},"to":{"field":"region","value":"so"}},{"from":{"field":"region","value":"740"},"to":{"field":"region","value":"sr"}},{"from":{"field":"region","value":"728"},"to":{"field":"region","value":"ss"}},{"from":{"field":"region","value":"678"},"to":{"field":"region","value":"st"}},{"from":{"field":"region","value":"222"},"to":{"field":"region","value":"sv"}},{"from":{"field":"region","value":"534"},"to":{"field":"region","value":"sx"}},{"from":{"field":"region","value":"760"},"to":{"field":"region","value":"sy"}},{"from":{"field":"region","value":"748"},"to":{"field":"region","value":"sz"}},{"from":{"field":"region","value":"796"},"to":{"field":"region","value":"tc"}},{"from":{"field":"region","value":"148"},"to":{"field":"region","value":"td"}},{"from":{"field":"region","value":"260"},"to":{"field":"region","value":"tf"}},{"from":{"field":"region","value":"768"},"to":{"field":"region","value":"tg"}},{"from":{"field":"region","value":"764"},"to":{"field":"region","value":"th"}},{"from":{"field":"region","value":"762"},"to":{"field":"region","value":"tj"}},{"from":{"field":"region","value":"772"},"to":{"field":"region","value":"tk"}},{"from":{"field":"region","value":"626"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"795"},"to":{"field":"region","value":"tm"}},{"from":{"field":"region","value":"788"},"to":{"field":"region","value":"tn"}},{"from":{"field":"region","value":"776"},"to":{"field":"region","value":"to"}},{"from":{"field":"region","value":"792"},"to":{"field":"region","value":"tr"}},{"from":{"field":"region","value":"780"},"to":{"field":"region","value":"tt"}},{"from":{"field":"region","value":"798"},"to":{"field":"region","value":"tv"}},{"from":{"field":"region","value":"158"},"to":{"field":"region","value":"tw"}},{"from":{"field":"region","value":"834"},"to":{"field":"region","value":"tz"}},{"from":{"field":"region","value":"804"},"to":{"field":"region","value":"ua"}},{"from":{"field":"region","value":"800"},"to":{"field":"region","value":"ug"}},{"from":{"field":"region","value":"581"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"840"},"to":{"field":"region","value":"us"}},{"from":{"field":"region","value":"858"},"to":{"field":"region","value":"uy"}},{"from":{"field":"region","value":"860"},"to":{"field":"region","value":"uz"}},{"from":{"field":"region","value":"336"},"to":{"field":"region","value":"va"}},{"from":{"field":"region","value":"670"},"to":{"field":"region","value":"vc"}},{"from":{"field":"region","value":"862"},"to":{"field":"region","value":"ve"}},{"from":{"field":"region","value":"092"},"to":{"field":"region","value":"vg"}},{"from":{"field":"region","value":"850"},"to":{"field":"region","value":"vi"}},{"from":{"field":"region","value":"704"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"548"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"876"},"to":{"field":"region","value":"wf"}},{"from":{"field":"region","value":"882"},"to":{"field":"region","value":"ws"}},{"from":{"field":"region","value":"973"},"to":{"field":"region","value":"xa"}},{"from":{"field":"region","value":"974"},"to":{"field":"region","value":"xb"}},{"from":{"field":"region","value":"975"},"to":{"field":"region","value":"xc"}},{"from":{"field":"region","value":"976"},"to":{"field":"region","value":"xd"}},{"from":{"field":"region","value":"977"},"to":{"field":"region","value":"xe"}},{"from":{"field":"region","value":"978"},"to":{"field":"region","value":"xf"}},{"from":{"field":"region","value":"979"},"to":{"field":"region","value":"xg"}},{"from":{"field":"region","value":"980"},"to":{"field":"region","value":"xh"}},{"from":{"field":"region","value":"981"},"to":{"field":"region","value":"xi"}},{"from":{"field":"region","value":"982"},"to":{"field":"region","value":"xj"}},{"from":{"field":"region","value":"983"},"to":{"field":"region","value":"xk"}},{"from":{"field":"region","value":"984"},"to":{"field":"region","value":"xl"}},{"from":{"field":"region","value":"985"},"to":{"field":"region","value":"xm"}},{"from":{"field":"region","value":"986"},"to":{"field":"region","value":"xn"}},{"from":{"field":"region","value":"987"},"to":{"field":"region","value":"xo"}},{"from":{"field":"region","value":"988"},"to":{"field":"region","value":"xp"}},{"from":{"field":"region","value":"989"},"to":{"field":"region","value":"xq"}},{"from":{"field":"region","value":"990"},"to":{"field":"region","value":"xr"}},{"from":{"field":"region","value":"991"},"to":{"field":"region","value":"xs"}},{"from":{"field":"region","value":"992"},"to":{"field":"region","value":"xt"}},{"from":{"field":"region","value":"993"},"to":{"field":"region","value":"xu"}},{"from":{"field":"region","value":"994"},"to":{"field":"region","value":"xv"}},{"from":{"field":"region","value":"995"},"to":{"field":"region","value":"xw"}},{"from":{"field":"region","value":"996"},"to":{"field":"region","value":"xx"}},{"from":{"field":"region","value":"997"},"to":{"field":"region","value":"xy"}},{"from":{"field":"region","value":"998"},"to":{"field":"region","value":"xz"}},{"from":{"field":"region","value":"720"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"887"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"175"},"to":{"field":"region","value":"yt"}},{"from":{"field":"region","value":"710"},"to":{"field":"region","value":"za"}},{"from":{"field":"region","value":"894"},"to":{"field":"region","value":"zm"}},{"from":{"field":"region","value":"716"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"999"},"to":{"field":"region","value":"zz"}},{"from":{"field":"variants","value":"aaland"},"to":{"field":"region","value":"ax"}},{"from":{"field":"variants","value":"polytoni"},"to":{"field":"variants","value":"polyton"}},{"from":{"field":"variants","value":"heploc"},"to":{"field":"variants","value":"alalc97"}},{"from":{"field":"variants","value":"arevela"},"to":{"field":"language","value":"hy"}},{"from":{"field":"variants","value":"arevmda"},"to":{"field":"language","value":"hyw"}}]')},"./node_modules/bcp-47-normalize/lib/many.json":g=>{g.exports=JSON.parse('{"region":{"172":["ru","am","az","by","ge","kg","kz","md","tj","tm","ua","uz"],"200":["cz","sk"],"530":["cw","sx","bq"],"532":["cw","sx","bq"],"536":["sa","iq"],"582":["fm","mh","mp","pw"],"810":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"830":["je","gg"],"890":["rs","me","si","hr","mk","ba"],"891":["rs","me"],"an":["cw","sx","bq"],"cs":["rs","me"],"fq":["aq","tf"],"nt":["sa","iq"],"pc":["fm","mh","mp","pw"],"su":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yu":["rs","me"],"062":["034","143"],"ant":["cw","sx","bq"],"scg":["rs","me"],"ntz":["sa","iq"],"sun":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yug":["rs","me"]}}')},"./node_modules/bcp-47-normalize/lib/matches.json":g=>{g.exports=JSON.parse('[{"from":"in","to":"id"},{"from":"iw","to":"he"},{"from":"ji","to":"yi"},{"from":"jw","to":"jv"},{"from":"mo","to":"ro"},{"from":"scc","to":"sr"},{"from":"scr","to":"hr"},{"from":"aam","to":"aas"},{"from":"adp","to":"dz"},{"from":"aue","to":"ktz"},{"from":"ayx","to":"nun"},{"from":"bgm","to":"bcg"},{"from":"bjd","to":"drl"},{"from":"ccq","to":"rki"},{"from":"cjr","to":"mom"},{"from":"cka","to":"cmr"},{"from":"cmk","to":"xch"},{"from":"coy","to":"pij"},{"from":"cqu","to":"quh"},{"from":"drh","to":"mn"},{"from":"drw","to":"fa-af"},{"from":"gav","to":"dev"},{"from":"gfx","to":"vaj"},{"from":"ggn","to":"gvr"},{"from":"gti","to":"nyc"},{"from":"guv","to":"duz"},{"from":"hrr","to":"jal"},{"from":"ibi","to":"opa"},{"from":"ilw","to":"gal"},{"from":"jeg","to":"oyb"},{"from":"kgc","to":"tdf"},{"from":"kgh","to":"kml"},{"from":"koj","to":"kwv"},{"from":"krm","to":"bmf"},{"from":"ktr","to":"dtp"},{"from":"kvs","to":"gdj"},{"from":"kwq","to":"yam"},{"from":"kxe","to":"tvd"},{"from":"kzj","to":"dtp"},{"from":"kzt","to":"dtp"},{"from":"lii","to":"raq"},{"from":"lmm","to":"rmx"},{"from":"meg","to":"cir"},{"from":"mst","to":"mry"},{"from":"mwj","to":"vaj"},{"from":"myt","to":"mry"},{"from":"nad","to":"xny"},{"from":"ncp","to":"kdz"},{"from":"nnx","to":"ngv"},{"from":"nts","to":"pij"},{"from":"oun","to":"vaj"},{"from":"pcr","to":"adx"},{"from":"pmc","to":"huw"},{"from":"pmu","to":"phr"},{"from":"ppa","to":"bfy"},{"from":"ppr","to":"lcq"},{"from":"pry","to":"prt"},{"from":"puz","to":"pub"},{"from":"sca","to":"hle"},{"from":"skk","to":"oyb"},{"from":"tdu","to":"dtp"},{"from":"thc","to":"tpo"},{"from":"thx","to":"oyb"},{"from":"tie","to":"ras"},{"from":"tkk","to":"twm"},{"from":"tlw","to":"weo"},{"from":"tmp","to":"tyj"},{"from":"tne","to":"kak"},{"from":"tnf","to":"fa-af"},{"from":"tsf","to":"taj"},{"from":"uok","to":"ema"},{"from":"xba","to":"cax"},{"from":"xia","to":"acn"},{"from":"xkh","to":"waw"},{"from":"xsj","to":"suj"},{"from":"ybd","to":"rki"},{"from":"yma","to":"lrr"},{"from":"ymt","to":"mtm"},{"from":"yos","to":"zom"},{"from":"yuu","to":"yug"},{"from":"asd","to":"snz"},{"from":"dit","to":"dif"},{"from":"llo","to":"ngt"},{"from":"myd","to":"aog"},{"from":"nns","to":"nbr"},{"from":"sgn-br","to":"bzs"},{"from":"sgn-co","to":"csn"},{"from":"sgn-de","to":"gsg"},{"from":"sgn-dk","to":"dsl"},{"from":"sgn-fr","to":"fsl"},{"from":"sgn-gb","to":"bfi"},{"from":"sgn-gr","to":"gss"},{"from":"sgn-ie","to":"isg"},{"from":"sgn-it","to":"ise"},{"from":"sgn-jp","to":"jsl"},{"from":"sgn-mx","to":"mfs"},{"from":"sgn-ni","to":"ncs"},{"from":"sgn-nl","to":"dse"},{"from":"sgn-no","to":"nsi"},{"from":"sgn-pt","to":"psr"},{"from":"sgn-se","to":"swl"},{"from":"sgn-us","to":"ase"},{"from":"sgn-za","to":"sfs"},{"from":"no-bokmal","to":"nb"},{"from":"no-nynorsk","to":"nn"},{"from":"aa-saaho","to":"ssy"},{"from":"sh","to":"sr-latn"},{"from":"cnr","to":"sr-me"},{"from":"no","to":"nb"},{"from":"tl","to":"fil"},{"from":"az-az","to":"az-latn-az"},{"from":"bs-ba","to":"bs-latn-ba"},{"from":"ha-latn-gh","to":"ha-gh"},{"from":"ha-latn-ne","to":"ha-ne"},{"from":"ha-latn-ng","to":"ha-ng"},{"from":"kk-cyrl-kz","to":"kk-kz"},{"from":"ky-cyrl-kg","to":"ky-kg"},{"from":"ks-arab-in","to":"ks-in"},{"from":"mn-cyrl-mn","to":"mn-mn"},{"from":"ms-latn-bn","to":"ms-bn"},{"from":"ms-latn-my","to":"ms-my"},{"from":"ms-latn-sg","to":"ms-sg"},{"from":"pa-in","to":"pa-guru-in"},{"from":"pa-pk","to":"pa-arab-pk"},{"from":"shi-ma","to":"shi-tfng-ma"},{"from":"sr-ba","to":"sr-cyrl-ba"},{"from":"sr-me","to":"sr-latn-me"},{"from":"sr-rs","to":"sr-cyrl-rs"},{"from":"sr-xk","to":"sr-cyrl-xk"},{"from":"tzm-latn-ma","to":"tzm-ma"},{"from":"ug-arab-cn","to":"ug-cn"},{"from":"uz-af","to":"uz-arab-af"},{"from":"uz-uz","to":"uz-latn-uz"},{"from":"vai-lr","to":"vai-vaii-lr"},{"from":"yue-cn","to":"yue-hans-cn"},{"from":"yue-hk","to":"yue-hant-hk"},{"from":"zh-cn","to":"zh-hans-cn"},{"from":"zh-hk","to":"zh-hant-hk"},{"from":"zh-mo","to":"zh-hant-mo"},{"from":"zh-sg","to":"zh-hans-sg"},{"from":"zh-tw","to":"zh-hant-tw"},{"from":"aju","to":"jrb"},{"from":"als","to":"sq"},{"from":"arb","to":"ar"},{"from":"ayr","to":"ay"},{"from":"azj","to":"az"},{"from":"bcc","to":"bal"},{"from":"bcl","to":"bik"},{"from":"bxk","to":"luy"},{"from":"bxr","to":"bua"},{"from":"cld","to":"syr"},{"from":"cmn","to":"zh"},{"from":"cwd","to":"cr"},{"from":"dgo","to":"doi"},{"from":"dhd","to":"mwr"},{"from":"dik","to":"din"},{"from":"diq","to":"zza"},{"from":"lbk","to":"bnc"},{"from":"ekk","to":"et"},{"from":"emk","to":"man"},{"from":"esk","to":"ik"},{"from":"fat","to":"ak"},{"from":"fuc","to":"ff"},{"from":"gaz","to":"om"},{"from":"gbo","to":"grb"},{"from":"gno","to":"gon"},{"from":"gug","to":"gn"},{"from":"gya","to":"gba"},{"from":"hdn","to":"hai"},{"from":"hea","to":"hmn"},{"from":"ike","to":"iu"},{"from":"kmr","to":"ku"},{"from":"knc","to":"kr"},{"from":"kng","to":"kg"},{"from":"knn","to":"kok"},{"from":"kpv","to":"kv"},{"from":"lvs","to":"lv"},{"from":"mhr","to":"chm"},{"from":"mup","to":"raj"},{"from":"khk","to":"mn"},{"from":"npi","to":"ne"},{"from":"ojg","to":"oj"},{"from":"ory","to":"or"},{"from":"pbu","to":"ps"},{"from":"pes","to":"fa"},{"from":"plt","to":"mg"},{"from":"pnb","to":"lah"},{"from":"quz","to":"qu"},{"from":"rmy","to":"rom"},{"from":"spy","to":"kln"},{"from":"src","to":"sc"},{"from":"swh","to":"sw"},{"from":"ttq","to":"tmh"},{"from":"tw","to":"ak"},{"from":"umu","to":"del"},{"from":"uzn","to":"uz"},{"from":"xpe","to":"kpe"},{"from":"xsl","to":"den"},{"from":"ydd","to":"yi"},{"from":"zai","to":"zap"},{"from":"zsm","to":"ms"},{"from":"zyb","to":"za"},{"from":"him","to":"srx"},{"from":"mnk","to":"man"},{"from":"bh","to":"bho"},{"from":"prs","to":"fa-af"},{"from":"swc","to":"sw-cd"},{"from":"aar","to":"aa"},{"from":"abk","to":"ab"},{"from":"ave","to":"ae"},{"from":"afr","to":"af"},{"from":"aka","to":"ak"},{"from":"amh","to":"am"},{"from":"arg","to":"an"},{"from":"ara","to":"ar"},{"from":"asm","to":"as"},{"from":"ava","to":"av"},{"from":"aym","to":"ay"},{"from":"aze","to":"az"},{"from":"bak","to":"ba"},{"from":"bel","to":"be"},{"from":"bul","to":"bg"},{"from":"bih","to":"bho"},{"from":"bis","to":"bi"},{"from":"bam","to":"bm"},{"from":"ben","to":"bn"},{"from":"bod","to":"bo"},{"from":"bre","to":"br"},{"from":"bos","to":"bs"},{"from":"cat","to":"ca"},{"from":"che","to":"ce"},{"from":"cha","to":"ch"},{"from":"cos","to":"co"},{"from":"cre","to":"cr"},{"from":"ces","to":"cs"},{"from":"chu","to":"cu"},{"from":"chv","to":"cv"},{"from":"cym","to":"cy"},{"from":"dan","to":"da"},{"from":"deu","to":"de"},{"from":"div","to":"dv"},{"from":"dzo","to":"dz"},{"from":"ewe","to":"ee"},{"from":"ell","to":"el"},{"from":"eng","to":"en"},{"from":"epo","to":"eo"},{"from":"spa","to":"es"},{"from":"est","to":"et"},{"from":"eus","to":"eu"},{"from":"fas","to":"fa"},{"from":"ful","to":"ff"},{"from":"fin","to":"fi"},{"from":"fij","to":"fj"},{"from":"fao","to":"fo"},{"from":"fra","to":"fr"},{"from":"fry","to":"fy"},{"from":"gle","to":"ga"},{"from":"gla","to":"gd"},{"from":"glg","to":"gl"},{"from":"grn","to":"gn"},{"from":"guj","to":"gu"},{"from":"glv","to":"gv"},{"from":"hau","to":"ha"},{"from":"heb","to":"he"},{"from":"hin","to":"hi"},{"from":"hmo","to":"ho"},{"from":"hrv","to":"hr"},{"from":"hat","to":"ht"},{"from":"hun","to":"hu"},{"from":"hye","to":"hy"},{"from":"her","to":"hz"},{"from":"ina","to":"ia"},{"from":"ind","to":"id"},{"from":"ile","to":"ie"},{"from":"ibo","to":"ig"},{"from":"iii","to":"ii"},{"from":"ipk","to":"ik"},{"from":"ido","to":"io"},{"from":"isl","to":"is"},{"from":"ita","to":"it"},{"from":"iku","to":"iu"},{"from":"jpn","to":"ja"},{"from":"jav","to":"jv"},{"from":"kat","to":"ka"},{"from":"kon","to":"kg"},{"from":"kik","to":"ki"},{"from":"kua","to":"kj"},{"from":"kaz","to":"kk"},{"from":"kal","to":"kl"},{"from":"khm","to":"km"},{"from":"kan","to":"kn"},{"from":"kor","to":"ko"},{"from":"kau","to":"kr"},{"from":"kas","to":"ks"},{"from":"kur","to":"ku"},{"from":"kom","to":"kv"},{"from":"cor","to":"kw"},{"from":"kir","to":"ky"},{"from":"lat","to":"la"},{"from":"ltz","to":"lb"},{"from":"lug","to":"lg"},{"from":"lim","to":"li"},{"from":"lin","to":"ln"},{"from":"lao","to":"lo"},{"from":"lit","to":"lt"},{"from":"lub","to":"lu"},{"from":"lav","to":"lv"},{"from":"mlg","to":"mg"},{"from":"mah","to":"mh"},{"from":"mri","to":"mi"},{"from":"mkd","to":"mk"},{"from":"mal","to":"ml"},{"from":"mon","to":"mn"},{"from":"mol","to":"ro"},{"from":"mar","to":"mr"},{"from":"msa","to":"ms"},{"from":"mlt","to":"mt"},{"from":"mya","to":"my"},{"from":"nau","to":"na"},{"from":"nob","to":"nb"},{"from":"nde","to":"nd"},{"from":"nep","to":"ne"},{"from":"ndo","to":"ng"},{"from":"nld","to":"nl"},{"from":"nno","to":"nn"},{"from":"nor","to":"nb"},{"from":"nbl","to":"nr"},{"from":"nav","to":"nv"},{"from":"nya","to":"ny"},{"from":"oci","to":"oc"},{"from":"oji","to":"oj"},{"from":"orm","to":"om"},{"from":"ori","to":"or"},{"from":"oss","to":"os"},{"from":"pan","to":"pa"},{"from":"pli","to":"pi"},{"from":"pol","to":"pl"},{"from":"pus","to":"ps"},{"from":"por","to":"pt"},{"from":"que","to":"qu"},{"from":"roh","to":"rm"},{"from":"run","to":"rn"},{"from":"ron","to":"ro"},{"from":"rus","to":"ru"},{"from":"kin","to":"rw"},{"from":"san","to":"sa"},{"from":"srd","to":"sc"},{"from":"snd","to":"sd"},{"from":"sme","to":"se"},{"from":"sag","to":"sg"},{"from":"hbs","to":"sr-latn"},{"from":"sin","to":"si"},{"from":"slk","to":"sk"},{"from":"slv","to":"sl"},{"from":"smo","to":"sm"},{"from":"sna","to":"sn"},{"from":"som","to":"so"},{"from":"sqi","to":"sq"},{"from":"srp","to":"sr"},{"from":"ssw","to":"ss"},{"from":"sot","to":"st"},{"from":"sun","to":"su"},{"from":"swe","to":"sv"},{"from":"swa","to":"sw"},{"from":"tam","to":"ta"},{"from":"tel","to":"te"},{"from":"tgk","to":"tg"},{"from":"tha","to":"th"},{"from":"tir","to":"ti"},{"from":"tuk","to":"tk"},{"from":"tgl","to":"fil"},{"from":"tsn","to":"tn"},{"from":"ton","to":"to"},{"from":"tur","to":"tr"},{"from":"tso","to":"ts"},{"from":"tat","to":"tt"},{"from":"twi","to":"ak"},{"from":"tah","to":"ty"},{"from":"uig","to":"ug"},{"from":"ukr","to":"uk"},{"from":"urd","to":"ur"},{"from":"uzb","to":"uz"},{"from":"ven","to":"ve"},{"from":"vie","to":"vi"},{"from":"vol","to":"vo"},{"from":"wln","to":"wa"},{"from":"wol","to":"wo"},{"from":"xho","to":"xh"},{"from":"yid","to":"yi"},{"from":"yor","to":"yo"},{"from":"zha","to":"za"},{"from":"zho","to":"zh"},{"from":"zul","to":"zu"},{"from":"alb","to":"sq"},{"from":"arm","to":"hy"},{"from":"baq","to":"eu"},{"from":"bur","to":"my"},{"from":"chi","to":"zh"},{"from":"cze","to":"cs"},{"from":"dut","to":"nl"},{"from":"fre","to":"fr"},{"from":"geo","to":"ka"},{"from":"ger","to":"de"},{"from":"gre","to":"el"},{"from":"ice","to":"is"},{"from":"mac","to":"mk"},{"from":"mao","to":"mi"},{"from":"may","to":"ms"},{"from":"per","to":"fa"},{"from":"rum","to":"ro"},{"from":"slo","to":"sk"},{"from":"tib","to":"bo"},{"from":"wel","to":"cy"}]')},"./node_modules/bcp-47/lib/normalize.json":g=>{g.exports=JSON.parse('{"en-gb-oed":"en-GB-oxendict","i-ami":"ami","i-bnn":"bnn","i-default":null,"i-enochian":null,"i-hak":"hak","i-klingon":"tlh","i-lux":"lb","i-mingo":null,"i-navajo":"nv","i-pwn":"pwn","i-tao":"tao","i-tay":"tay","i-tsu":"tsu","sgn-be-fr":"sfb","sgn-be-nl":"vgt","sgn-ch-de":"sgg","art-lojban":"jbo","cel-gaulish":null,"no-bok":"nb","no-nyn":"nn","zh-guoyu":"cmn","zh-hakka":"hak","zh-min":null,"zh-min-nan":"nan","zh-xiang":"hsn"}')},"./node_modules/bcp-47/lib/regular.json":g=>{g.exports=JSON.parse('["art-lojban","cel-gaulish","no-bok","no-nyn","zh-guoyu","zh-hakka","zh-min","zh-min-nan","zh-xiang"]')}},n={};function u(g){var i=n[g];if(i!==void 0)return i.exports;var r=n[g]={exports:{}};return t[g].call(r.exports,r,r.exports,u),r.exports}u.amdO={},u.n=g=>{var i=g&&g.__esModule?()=>g.default:()=>g;return u.d(i,{a:i}),i},u.d=(g,i)=>{for(var r in i)u.o(i,r)&&!u.o(g,r)&&Object.defineProperty(g,r,{enumerable:!0,get:i[r]})},u.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),u.o=(g,i)=>Object.prototype.hasOwnProperty.call(g,i),u.r=g=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})};var _={};return(()=>{/*!******************!*\
  !*** ./index.js ***!
  \******************/u.r(_),u.d(_,{Debug:()=>l.default,MediaPlayer:()=>g.MediaPlayer,MediaPlayerFactory:()=>o.default,MetricsReporting:()=>r.default,Protection:()=>d.default,default:()=>c,supportsMediaSource:()=>i.supportsMediaSource});var g=u("./index_mediaplayerOnly.js"),i=u("./src/streaming/utils/Capabilities.js"),r=u("./src/streaming/metrics/MetricsReporting.js"),d=u("./src/streaming/protection/Protection.js"),o=u("./src/streaming/MediaPlayerFactory.js"),l=u("./src/core/Debug.js");dashjs.Protection=d.default,dashjs.MetricsReporting=r.default,dashjs.MediaPlayerFactory=o.default,dashjs.Debug=l.default,dashjs.supportsMediaSource=i.supportsMediaSource;const c=dashjs})(),_=_.default,_})())})(fc);const cc=Lo(xi);async function dc(b){let e;switch(b){case"mp4":e=await Xn.get("http://101.43.161.79:9002/media/mp4.json");break;case"hls":e=await Xn.get("http://101.43.161.79:9002/media/hls.json");break;case"dash":e=await Xn.get("http://101.43.161.79:9002/media/dash.json")}return e.data}const Vs=b=>(Bo("data-v-00cabda1"),b=b(),Uo(),b),hc={class:"main clearfix"},gc={class:"control"},mc=Vs(()=>Rr("span",{style:{"margin-right":"10px"}},"",-1)),Ec={key:0,style:{"margin-left":"50px"}},_c=Vs(()=>Rr("span",{style:{"margin-right":"10px"}},"Abr",-1)),vc={class:"flex"},pc={class:"v"},Tc=["src"],yc=["onClick"],Ac={style:{"text-align":"center"}},Sc={class:"name"},Rc={class:"desc"},Dc=Oo({__name:"VideoView",setup(b){const e=qi(),t=qi(),n=Fo(),u=bo({type:"mp4",algorithm:"abrThroughput",id:0,video:{},videos:[]}),_=[{value:"abrThroughput",label:"abrThroughput"},{value:"abrBola",label:"abrBola"},{value:"abrDynamic",label:"abrDynamic"},{value:"abrL2A",label:"abrL2A"},{value:"abrLoLP",label:"abrLoLP"}],g=[{value:"mp4",label:"MP4"},{value:"hls",label:"HLS"},{value:"dash",label:"DASH"}],i=async r=>{let d=await dc(r);u.videos=d,u.type=r,u.video=d[u.id];let o=d[u.id];switch(r){case"mp4":break;case"hls":if(Fr.isSupported()){const c=new Fr;c.attachMedia(e.value),c.on(Fr.Events.MEDIA_ATTACHED,function(){c.loadSource(o.feedurl)})}break;case"dash":let l=cc.MediaPlayer().create();l.updateSettings({streaming:{abr:{ABRStrategy:u.algorithm}}}),l.initialize(t.value,o.feedurl,!0);break}};return xo(()=>[u.type,u.id,u.algorithm],()=>{console.log("[video change]",u.type,u.id),i(u.type)}),No(()=>{const r=n.query.type||"mp4";i(r)}),(r,d)=>{const o=un("el-option"),l=un("el-select"),c=un("el-image"),E=un("el-scrollbar"),m=un("el-card");return Or(),Lr("div",hc,[Rr("div",gc,[Rr("div",null,[mc,Vr(l,{style:{width:"150px","background-color":"rgba(13, 22, 53, .5)"},modelValue:u.type,"onUpdate:modelValue":d[0]||(d[0]=f=>u.type=f),class:"m-2",placeholder:"Select",size:"large"},{default:ln(()=>[(Or(),Lr(Qn,null,Jn(g,f=>Vr(o,{key:f.value,label:f.label,value:f.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),u.type==="dash"?(Or(),Lr("div",Ec,[_c,Vr(l,{style:{width:"150px","background-color":"rgba(13, 22, 53, .5)"},modelValue:u.algorithm,"onUpdate:modelValue":d[1]||(d[1]=f=>u.algorithm=f),class:"m-2",placeholder:"Select",size:"large"},{default:ln(()=>[(Or(),Lr(Qn,null,Jn(_,f=>Vr(o,{key:f.value,label:f.label,value:f.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])):ea("",!0)]),Rr("div",vc,[Rr("div",pc,[u.type==="hls"?(Or(),Lr("video",{key:0,ref_key:"HlsVideoRef",ref:e,width:"1200",height:"700",controls:""},null,512)):u.type==="mp4"?(Or(),Lr("video",{key:1,width:"1200",height:"700",controls:"",src:u.video.feedurl||""},null,8,Tc)):u.type==="dash"?(Or(),Lr("video",{key:2,ref_key:"DashVideoRef",ref:t,width:"1200",height:"700",controls:""},null,512)):ea("",!0)]),Vr(m,{class:"list"},{header:ln(()=>[wo(" Video List ")]),default:ln(()=>[Vr(E,{height:"600px",class:"videos"},{default:ln(()=>[(Or(!0),Lr(Qn,null,Jn(u.videos,(f,T)=>(Or(),Lr("div",{class:"video",key:T},[Rr("div",{onClick:()=>u.id=T},[Vr(c,{src:f.avatar},null,8,["src"]),Rr("div",Ac,[Rr("span",Sc,ta(f.nickname),1),Rr("span",Rc,ta(f.description),1)])],8,yc)]))),128))]),_:1})]),_:1})])])}}});const Mc=ko(Dc,[["__scopeId","data-v-00cabda1"]]);export{Mc as default};
